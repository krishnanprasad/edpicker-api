
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="2aea942c-17a2-5201-af2b-d35f2f5d239c")}catch(e){}}();
const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Index-7_zWz3Yc.js","assets/vendor-BYCmmfc5.js","assets/sentry-CQNtvQBy.js","assets/index-UVYogKnR.js","assets/deferred-CrXD4vSG.js","assets/math.scalar.functions-C0i4R8fp.js","assets/animationGroup-DKWdWIkl.js","assets/skeleton-CHr8lJue.js","assets/rawTexture-Bv1_2dpu.js","assets/easing-CmwLolc_.js","assets/weightedsound-ChU1pnzD.js","assets/audioEngine-B5psh4rJ.js","assets/babylonFileParser.function-CWsVgwsY.js","assets/assetContainer-CUMQNHUe.js","assets/abstractAudioBus-C_xLEIJ9.js","assets/webAudioBaseSubGraph-C2cIbk1_.js","assets/abstractSoundInstance-BxUvGUUz.js","assets/abstractSoundSource-Vbq2qDrF.js","assets/webAudioBus-D9WaDxst.js","assets/spatialWebAudio-1cb7nY1l.js","assets/webAudioMainBus-4sL2dcwm.js","assets/webAudioStaticSound-AhttuDbv.js","assets/webAudioStreamingSound-B2eQNL-7.js","assets/webAudioSoundSource-DpannuFM.js","assets/backgroundMaterial-pizEOGHo.js","assets/ray-CxIf60Yv.js","assets/particleSystem-BbMsV5lR.js","assets/discBuilder-D9gpJrJr.js","assets/standardMaterial-DntdUcQm.js","assets/blurPostProcess-DuKtWl3e.js","assets/cubeTexture-DVvEoQQa.js","assets/abstractEngine.cubeTexture-F4kHh9pe.js","assets/dataReader-BtzWigjd.js","assets/dds-BcnsdhfX.js","assets/dumpTools-CT6dJDsH.js","assets/khronosTextureContainer2-C1eFcByy.js","assets/workerPool-H9Ji3mCo.js","assets/shaderMaterial-BwupvZ96.js","assets/timer-PYr-g-Zm.js","assets/math.scalar-BGJcYfq6.js","assets/clipPlaneFragment-KItNKS8v.js","assets/logDepthDeclaration-SY-Tgs1H.js","assets/fogFragmentDeclaration-BDYZsoS7.js","assets/sceneUboDeclaration-D7oKupya.js","assets/meshUboDeclaration-DR6R2fQu.js","assets/clipPlaneVertex-CruUfR2e.js","assets/logDepthVertex-DYrMSufp.js","assets/helperFunctions-CH80MRCU.js","assets/fogFragment-BUSx2bu5.js","assets/logDepthDeclaration-Bm2Quujg.js","assets/sceneUboDeclaration-p8FR78ps.js","assets/meshUboDeclaration-DzTvR-p1.js","assets/helperFunctions-BfSE68Cx.js","assets/logDepthVertex-D-Yf6fpg.js","assets/pointLight-BfjfL4BM.js","assets/fresnelFunction-t-z71skM.js","assets/proceduralTexture-Bnp_PooB.js","assets/webgpuEngine-_rmLALGJ.js","assets/bakedVertexAnimation-6ny51-ym.js","assets/fresnelFunction-XgrXHwx4.js","assets/decalFragment-B7LifIuV.js","assets/bonesVertex-D9lOJoRc.js","assets/bakedVertexAnimation-UYvoaY40.js","assets/morphTargetsVertex-cSNpwddj.js","assets/shadowsVertex-BhDLxobr.js","assets/morphTargetsVertex-lpOS5T8O.js","assets/shadowGeneratorSceneComponent-DA2ZMzUh.js","assets/shadowGenerator-Bw_fFvh-.js","assets/packingFunctions-BIPFPoIr.js","assets/pointCloudVertex-DmafDloU.js","assets/engine.multiRender-qxokXxKU.js","assets/environmentTextureTools-1GnN1IRv.js","assets/engine.multiRender-DwCvHdsq.js","assets/flowGraphParser-UosIi2Gy.js","assets/flowGraphRichTypes-C-rATcci.js","assets/flowGraphJsonPointerParserBlock-G4hmB2NU.js","assets/flowGraphCachedOperationBlock-BG4BtVbD.js","assets/flowGraphConsoleLogBlock-B8odPGCu.js","assets/flowGraphBranchBlock-Dxm9pRk4.js","assets/flowGraphDoNBlock-CURfdqLx.js","assets/flowGraphForLoopBlock-Ch7GzeKo.js","assets/flowGraphThrottleBlock-Co02o1cD.js","assets/flowGraphMultiGateBlock-Dsq7XIj0.js","assets/flowGraphSwitchBlock-D1LvLbrP.js","assets/flowGraphWaitAllBlock-B_ry4nsA.js","assets/flowGraphCounterBlock-5pg1Zo3d.js","assets/flowGraphWhileLoopBlock-BdU93KhT.js","assets/flowGraphDebounceBlock-B-HSHh9s.js","assets/flowGraphFlipFlopBlock-ChOiav1s.js","assets/flowGraphSequenceBlock-KIYms621.js","assets/flowGraphSetDelayBlock--M3uf3FH.js","assets/flowGraphCancelDelayBlock-CMzGPYxE.js","assets/flowGraphPlayAnimationBlock-D9ftJBNK.js","assets/flowGraphStopAnimationBlock-CsshOVS4.js","assets/flowGraphPauseAnimationBlock-CpEuhMtw.js","assets/flowGraphInterpolationBlock-CFsVGhsH.js","assets/flowGraphEasingBlock-6R6QXgWB.js","assets/flowGraphBezierCurveEasingBlock-mGQERaTI.js","assets/flowGraphConditionalDataBlock-BuYv2zTM.js","assets/flowGraphGetVariableBlock-0pSHgbNY.js","assets/flowGraphSetVariableBlock-DA01PbVx.js","assets/flowGraphTransformCoordinatesSystemBlock-DjAJrZQC.js","assets/flowGraphGetPropertyBlock-JcCUc2sf.js","assets/flowGraphSetPropertyBlock-KrcTR2vg.js","assets/flowGraphConstantBlock-BJeIwlU7.js","assets/flowGraphGetAssetBlock-ULhLTw29.js","assets/flowGraphDataSwitchBlock-B0GVUoZL.js","assets/flowGraphMathBlocks-ByeLQgrl.js","assets/flowGraphBinaryOperationBlock-CUpICav7.js","assets/flowGraphUnaryOperationBlock-B9u7qCFK.js","assets/flowGraphMathCombineExtractBlocks-C3LkSZyI.js","assets/flowGraphMatrixMathBlocks-CdB4yTCs.js","assets/flowGraphVectorMathBlocks-D7w0B_o7.js","assets/flowGraphTypeToTypeBlocks-Ky17w1iB.js","assets/flowGraphContextBlock-CvUXZPAl.js","assets/flowGraphArrayIndexBlock-BNFA1Mo8.js","assets/flowGraphCodeExecutionBlock-DE9YrMBV.js","assets/flowGraphIndexOfBlock-CBMW4rRH.js","assets/flowGraphFunctionReferenceBlock-DNYDYInW.js","assets/flowGraphMeshPickEventBlock-DI4OVUXo.js","assets/flowGraphSceneReadyEventBlock-CN1sNcsz.js","assets/flowGraphReceiveCustomEventBlock-BFAnIpRP.js","assets/flowGraphSendCustomEventBlock-e-NN4tFA.js","assets/flowGraphSceneTickEventBlock-mBciLzH2.js","assets/flowGraphPointerOutEventBlock-CQ6N5uu9.js","assets/flowGraphPointerOverEventBlock-2k04g3J5.js","assets/glowMapGeneration.fragment-DO3BFttP.js","assets/glowMapGeneration.vertex-kTUjY6Ql.js","assets/glowMapGeneration.fragment-BvhAGarC.js","assets/glowMapGeneration.vertex-BRVeP2ig.js","assets/glowMapMerge.fragment-5DULGnkP.js","assets/glowMapMerge.vertex-C7M_qcUI.js","assets/glowBlurPostProcess.fragment-DSj9_LJg.js","assets/glowMapMerge.fragment-B9Kugqz6.js","assets/glowMapMerge.vertex-BdLHFm5F.js","assets/glowBlurPostProcess.fragment-C-P1oTJ-.js","assets/iesTextureLoader-KeaDZ2QM.js","assets/hdrCubeTexture-Cyi-asy5.js","assets/hdr-uhmtc4aA.js","assets/iblCdfGenerator-D7146OGd.js","assets/background.vertex-fXF9BKYs.js","assets/backgroundUboDeclaration-BQGsyW__.js","assets/background.fragment-Do4ZzyGE.js","assets/lightFragment-Bh5wv_PO.js","assets/lightsFragmentFunctions-GakutWSo.js","assets/background.vertex-Bz6qUdsG.js","assets/backgroundUboDeclaration-y6QAlhwu.js","assets/shadowsVertex-B1QobJq8.js","assets/background.fragment-BTt2ZSHz.js","assets/lightFragment-CjYr14mS.js","assets/lightsFragmentFunctions-CWC6hwax.js","assets/color.fragment-a5tw2l8G.js","assets/color.vertex-DF4a87xy.js","assets/vertexColorMixing-BxtG0YVo.js","assets/pbr.vertex-BntKAhri.js","assets/harmonicsFunctions-Dw19vQ1E.js","assets/bumpVertex-YiCb3uUm.js","assets/mainUVVaryingDeclaration-CYD4uY2v.js","assets/vertexColorMixing-BT9mZqYs.js","assets/pbr.fragment-U2GP_XI_.js","assets/oitFragment-B_pGLNGl.js","assets/bumpFragment-C54DjO35.js","assets/pbr.vertex-CRoJIMVa.js","assets/samplerVertexImplementation-DmJilqNF.js","assets/harmonicsFunctions-BNymKSHA.js","assets/mainUVVaryingDeclaration-F0iw__Fw.js","assets/bumpVertex-Be6kVub1.js","assets/pbr.fragment-Ac6YHFEE.js","assets/oitFragment-oa93usND.js","assets/bumpFragment-DEiB9eis.js","assets/shaderLanguage-BjwqUAVi.js","assets/ddsTextureLoader-C2POXN9Q.js","assets/envTextureLoader-Bf1OvTNH.js","assets/ktxTextureLoader-Der6b-8t.js","assets/tgaTextureLoader-DFRq_eiY.js","assets/hdrTextureLoader--ivqFXKy.js","assets/basisTextureLoader-8wyXWgI5.js","assets/exrTextureLoader-D2ruYRYT.js","assets/iblShadowsRenderPipeline-KejXxlQ0.js","assets/rawCubeTexture-DRI5J0si.js","assets/procedural.vertex-DBjriIne.js","assets/procedural.vertex-BRVsV0ea.js","assets/default.fragment-xXn2p-xu.js","assets/defaultUboDeclaration-D8bMEWPC.js","assets/default.vertex-BQ78LqBB.js","assets/default.fragment-DzPiGlQk.js","assets/defaultUboDeclaration-Ca95hPeg.js","assets/default.vertex-Km-otrXH.js","assets/asyncLock-AYidQQjo.js","assets/dracoDecoder-DqH7ClUN.js","assets/meshoptCompression-BzKRz7rr.js","assets/mesh.vertexData.functions-BXkNVxNr.js","assets/thinInstanceMesh-q13ePUyM.js","assets/pointsCloudSystem-C5pAPFu-.js","assets/color.fragment-DfwenMsH.js","assets/color.vertex-CkJjryfU.js","assets/lodCube.fragment-RuwVE_de.js","assets/lod.fragment-CdL-RAF2.js","assets/lodCube.fragment-ChNh-PNw.js","assets/lod.fragment-CyUBKx9r.js","assets/rgbdDecode.fragment-DcsIwqfd.js","assets/rgbdEncode.fragment-BRMp-9At.js","assets/rgbdDecode.fragment-DoROcA_N.js","assets/rgbdEncode.fragment-DLGq0Mzs.js","assets/particles.fragment-tIl4C5jJ.js","assets/particles.vertex-DXM6FxVc.js","assets/particles.fragment-PepjV9Mu.js","assets/particles.vertex-nJfh3v1d.js","assets/postProcessRenderPipelineManagerSceneComponent-YEY2EvUV.js","assets/postprocess.vertex-cC0k14_J.js","assets/kernelBlur.fragment-C5-BqSVL.js","assets/kernelBlurVaryingDeclaration-CB4Rnwhv.js","assets/kernelBlur.vertex-DTjx0fnj.js","assets/kernelBlur.fragment-DO_VDY9X.js","assets/kernelBlurVaryingDeclaration-DkLqwgI7.js","assets/kernelBlur.vertex-Bmx_vqr8.js","assets/pass.fragment-DmVx4YwL.js","assets/passCube.fragment-B8VyKzdf.js","assets/pass.fragment-C77RzAyK.js","assets/passCube.fragment-DP5MYMBP.js","assets/vrDistortionCorrection.fragment-BqoQwdjg.js","assets/vrDistortionCorrection.fragment-CI8H-6ub.js","assets/index-Uwxtskni.js","assets/glTFLoader-CifGd5Jq.js","assets/glTFLoaderExtensionRegistry-B_WFvUqe.js","assets/objectModelMapping-Cw_joHOJ.js","assets/glTFLoaderAnimation-ogDhOiiH.js","assets/EXT_lights_image_based-DPPKx6LA.js","assets/EXT_mesh_gpu_instancing-CRDgrb8y.js","assets/EXT_meshopt_compression-Bx9XR_ax.js","assets/EXT_texture_webp-C41vqVc7.js","assets/EXT_texture_avif-DrP66sxV.js","assets/EXT_lights_ies-CkC55o2Q.js","assets/KHR_draco_mesh_compression-uljprYbF.js","assets/KHR_lights_punctual-BMVBC6Jj.js","assets/KHR_materials_pbrSpecularGlossiness-_98FwS4V.js","assets/KHR_materials_unlit-BzESik0N.js","assets/KHR_materials_clearcoat-CXpKgf7K.js","assets/KHR_materials_iridescence-5VQy9k4w.js","assets/KHR_materials_anisotropy-n6WqJZ8L.js","assets/KHR_materials_emissive_strength-XYMkNihW.js","assets/KHR_materials_sheen-DWAWlPZN.js","assets/KHR_materials_specular-PAvxmK1e.js","assets/KHR_materials_ior-DtO4IYjh.js","assets/KHR_materials_variants-UMub0Ixq.js","assets/KHR_materials_transmission-BLMxXo98.js","assets/KHR_materials_diffuse_transmission-C2tlGsef.js","assets/KHR_materials_volume-DCr1iYkm.js","assets/KHR_materials_dispersion-CT7RvQ_b.js","assets/EXT_materials_diffuse_roughness-BwE45une.js","assets/KHR_mesh_quantization-CULbOMsz.js","assets/KHR_texture_basisu-DMRDj31x.js","assets/KHR_texture_transform-DKv6x9-j.js","assets/KHR_xmp_json_ld-BKWXofmc.js","assets/KHR_animation_pointer-DFKLS2yh.js","assets/MSFT_audio_emitter-CSkHYTb6.js","assets/MSFT_lod-D_Yp2XjK.js","assets/MSFT_minecraftMesh-D7AJ5Exl.js","assets/MSFT_sRGBFactors-DsscOv1t.js","assets/KHR_interactivity-BnkohLrm.js","assets/declarationMapper-D-IGsWrG.js","assets/KHR_node_visibility-AhIT76pP.js","assets/KHR_node_selectability-CLcZpMz-.js","assets/KHR_node_hoverability-CTOM3Q0L.js","assets/ExtrasAsMetadata-y9kfOGdj.js","assets/index-CcqUjx7W.js","assets/stlFileLoader.metadata-2VxBZznk.js","assets/babylon.inspector.bundle-rqCPPOED.js","assets/index-DerCupKY.js","assets/bvhFileLoader-m8uCA-TK.js","assets/objFileLoader-HwzdpUr_.js","assets/stlFileLoader-CVhc_H2T.js","assets/splatFileLoader-gCy6fV8o.js","assets/index-02kl5kgv.js","assets/botd.esm-f6NAJeRQ.js","assets/sidebar-settings-CwQQy9Ss.js","assets/settings-button-Ce33I13V.js","assets/settings-B4g0Uh60.js","assets/voice-options-DxKAvKoJ.js","assets/use-key-up-B2oF-O72.js","assets/privacy-choices-BHPMvd7Y.js","assets/google-drive-DCc35MuS.js","assets/one-drive-CIEcjOUC.js","assets/utils-DhYeovDg.js","assets/order-details-view-Bnhz2q_6.js","assets/card-info-HjegoVR6.js","assets/visa-DNBWtMre.js","assets/constants-Rh-fZi2P.js","assets/product-info-CYjmh8nG.js","assets/wallet-icon-button-AADWW8lM.js","assets/minus-BZY4KIT7.js","assets/shipping-address-CXvkn0gA.js","assets/atoms-Bx24giVU.js","assets/use-price-tracking-DVZUjbQq.js","assets/conversion-tracking-disclaimer-Ctg5VngC.js","assets/info-Bs5pKeFT.js","assets/shopping-telemetry-BrpwbsgV.js","assets/shopping-utils-BubgjfTW.js","assets/format-money-5coY0IJJ.js","assets/shopping-api-Dn2kC0Vt.js","assets/faq-link-Cl9Ml3sh.js","assets/constants-BnxRz7co.js","assets/utils-FXZUqOus.js","assets/use-ocv-feedback-CY10ISV0.js","assets/rewards-link-B0MGjsKE.js","assets/gift-BPRoxMg8.js","assets/rewards-badge-background-dark-sA4rl61P.js","assets/rewards-badge-background-Cifhl8jl.js","assets/rewards-badge-container-dark-D4BnvhmI.js","assets/rewards-badge-container-Ie15vRU_.js","assets/rewards-badge-dark-Bho4hFCC.js","assets/rewards-badge-aC8JgUZI.js","assets/plus-CIwxqj2B.js","assets/alert-QZQ8T5mh.js","assets/error-4y5m4Ika.js","assets/mask-wrapper-CuC9B6X-.js","assets/moon-BosAqUQV.js","assets/sun-B8zU1jYx.js","assets/wallet-element-factory-DnUPVtYW.js","assets/pidl-pages-DIfs1w1t.js","assets/paypal-button-B0s6EfEA.js","assets/v4-CtRu48qb.js","assets/index-Cr3DIIUQ.js","assets/index-Chjiymov.js","assets/disconnect-qlnDtuo_.js","assets/external-link-B8cNTl-6.js","assets/sidebar-pages-HPD3_Y6S.js","assets/use-supports-hover-B2drtGqR.js","assets/conversations-BAe59OaB.js","assets/index.es-DAxxNzWm.js","assets/code-Brj9DbY8.js","assets/core-DtWfXB6c.js","assets/language-loader-C2m3MlwV.js","assets/index-uHmhofaq.js","assets/sender-share-conversation-modal-Cg_0r11Q.js","assets/sender-share-modal-cta-with-social-media-Bfw1nnX-.js","assets/babylon-modules-BTj6HoTY-DXNuzIIR.js","assets/babylon.nodeEditor-BlI-PA7w.js","assets/character-DHQl6qtp.js","assets/use-set-up-babylon-BzrimXdE.js","assets/starter-prompt-category-B2JvHO2f.js","assets/product-purchase-Cp20rw-c.js","assets/upsell-block-CkGnGMls.js","assets/cross-selling-strip-Darx-aFr.js","assets/price-tracking-block-B5K_sYOd.js","assets/use-shopping-telemetry-C1nb_14D.js","assets/chevron-bolded-D-SHffDz.js","assets/composer-auto-complete-Cy83IhAV.js","assets/composer-actions-prompt-suggestions-DomfoesL.js","assets/booking-DCDGyytU.js","assets/expedia-DFWCrR_H.js","assets/flower-D3B72TDB.js","assets/hotels-CDBPWiXv.js","assets/kayak-B_9QKx2k.js","assets/open-table-QcM__oh_.js","assets/priceline-BcER8N9P.js","assets/sky-scanner-Diu2fYeS.js","assets/trip-advisor-BNVxCbDP.js","assets/viator-CVchmKvV.js","assets/think-deeper-pro-subscription-hDXfmPU2.js","assets/over-task-quota-BFOIsIm4.js","assets/composer-action-CG02A44b.js","assets/computer-use-task-closed-Dl3CM-hL.js","assets/export-B6Bsc2Nl.js","assets/import-BBblyb18.js","assets/settings-Cs17RCwT.js","assets/speed-BeDd1szk.js","assets/audio-controls-CitbyuUG.js","assets/next-CyIIgeMp.js","assets/pause-DVa32OWN.js","assets/play-BNgOUdmh.js","assets/close-button-B1tUJjIe.js","assets/progress-bar-Cb7WADa6.js","assets/replay-DWI1GL7m.js","assets/safety-risk-card-CR5qMAr_.js","assets/use-send-action-command-DQRbjZx2.js","assets/add-to-page-BBg4g_V0.js","assets/cross-selling-strip-consumer-jnqe5IKe.js","assets/composer-prompt-review-Szsl-CCa.js","assets/biometric-consent-DFbXqkYc.js","assets/daily-briefing-chat-DuP34kXl.js","assets/contract-down-left-CSb-8WZ4.js","assets/dailly-briefing-composer-input-bMxjfjRq.js","assets/composer-sign-in-lfBDodYC.js","assets/merge-conversation-checkbox-D8SPFUmV.js","assets/daily-briefing-composer-player-ClMn_5OM.js","assets/settings-wrapper-CuzgNwki.js","assets/media-viewer-Bp7TRql3.js","assets/async-image-wrapper-DaPBzmeI.js","assets/utils-BeTeahkB.js","assets/picture-in-picture-Dn4A5EJf.js","assets/video-player-BtfKdI_H.js","assets/native-player-C-IO462d.js","assets/card-carousel-D1p4Qnt6.js","assets/use-carousel-B9DNrPFq.js","assets/utils-ifQmq0fb.js","assets/composer-large-screen-DPfyTO3a.js","assets/types-S47nI6MK.js","assets/discover-BTthi2yd.js","assets/collapse-pane-BbUdumy9.js","assets/use-discover-feed-Bceo7yaC.js","assets/block-Bz6jrbD0.js","assets/thumbs-up-filled-zvaB1uGy.js","assets/document-one-page-sparkle-JrQzcib4.js","assets/food-apple-DtJwM7uz.js","assets/lightbulb-HMkHc2Ek.js","assets/location-ripple-BLJcOTJ8.js","assets/podcast-Cj28iDlg.js","assets/scales-DKgkuCMf.js","assets/tag-C02tfYNQ.js","assets/play-outline-BHf35D6y.js","assets/weather-states-categories-CmeEET4X.js","assets/parseISO-BHGVum-w.js","assets/watchlist-bridge-BRw4GcWe.js","assets/widget-player-CoB6iHws.js","assets/generateCategoricalChart-BP4s9nw8.js","assets/headphones-btYREYR1.js","assets/use-podcasts-navigation-DSuauHKk.js","assets/audio-recorder-BSuABAbc.js","assets/actions-chat-detail-C4a7wVi5.js","assets/expand-pane-BLIWk2lS.js","assets/save-action-TkgpeEfz.js","assets/new-tab-aj68rHp6.js","assets/pause-outline-D4LEKS8z.js","assets/showroom-chat-detail-Cera3-JX.js","assets/contextual-shopping-card-hN7TcC-r.js","assets/product-rating-DxHEVlgd.js","assets/use-shopping-visibility-telemetry-K7uMeu6V.js","assets/citation-chips-row-CQM9rn4u.js","assets/bell-alert-C4RCquaV.js","assets/bell-CgBTGK-T.js","assets/star-XF-9W3ID.js","assets/arrow-trending-down-DwyQFZhy.js","assets/price-history-chart-CinRemLk.js","assets/appearance-chat-Coi1tSbn.js","assets/ai-message-CLMTDRmz.js","assets/globe-BfbcPuSf.js","assets/edit-line-horizontal-BROcKWBf.js","assets/use-page-nDxzHDat.js","assets/use-ads-card-operations-DP4OlJQu.js","assets/use-podcast-share-C82fl9CY.js","assets/topic-selection.lazy-CdR_KxSR.js","assets/login.lazy-9FBkvvWL.js","assets/library.lazy-EQH5tEnn.js","assets/gaming.lazy-C6uR7s9W.js","assets/gallery.lazy-1GLAMTi8.js","assets/gallery-schemas-Ccy38mlE.js","assets/daily.lazy-B_jExv77.js","assets/daily-briefing-BGFt799r.js","assets/formatDistanceToNow-DJXAO7WK.js","assets/constructNow--TaF5WLO.js","assets/use-scroll-element-into-view-CaVPpvYe.js","assets/arrow-maximize-ogU2HeN9.js","assets/arrow-minimize-BK8gOACW.js","assets/use-is-portrait-51D2jVs-.js","assets/wand-CMH-mnxu.js","assets/use-is-sidebar-expanded-on-the-side-DADT3FRh.js","assets/agents.lazy-cbhczogO.js","assets/index.lazy-CNfyqa1j.js","assets/arrow-referral-CkUJP3Z4.js","assets/copliot-referral--1rHu-0Z.js","assets/four-leaf-clover-Cu10CoOL.js","assets/hexagon-BDZsgYaT.js","assets/message-referral-Ez7qsqtU.js","assets/rewards-Cn-VuJgB.js","assets/index.lazy-BdHxjyc2.js","assets/use-labs-telemetry-CZODUV1-.js","assets/index-DEBstPtL.js","assets/labs-social-icon-discord-CCESVB-o.js","assets/labs-social-icon-instagram-GF4jBg-m.js","assets/labs-social-icon-x-BBgvNUY9.js","assets/labs-social-icon-youtube-CagPDkGh.js","assets/subscription.start.lazy-BXHMJ-Nz.js","assets/subscription.manage.lazy-C08MW6if.js","assets/shares._conversationId.lazy-BgjgJkrw.js","assets/rules.lazy-BsjnkSUs.js","assets/link-multiple-CxTDveKG.js","assets/pro.subscribe.lazy-DQfNPLJ0.js","assets/checkout-wrapper-FbfsIm4b.js","assets/paywall-container-YhSSSJS2.js","assets/add-address-BlDvn2zK.js","assets/address-DdN814Qz.js","assets/pidl-element-factory-DYNPooWG.js","assets/workflow-pi-dropdown-disabler-Yw2E1wa7.js","assets/react-number-format.es-BmXs6cDR.js","assets/dropdown-radio-hjscAS9L.js","assets/wallet-dropdown-BrTcJEJp.js","assets/wallet-list-D2Pms0jE.js","assets/current-DDGVAl_b.js","assets/pidl-element-factory-DikK38DI.css","assets/add-address-view-EmdBBeER.js","assets/form-field-skeleton-A3nOILSn.js","assets/add-payment-instrument-DwAAEqKo.js","assets/add-payment-instrument-view-CEiO2BOO.js","assets/add-ewallet-skeleton-D8XK_QaI.js","assets/select-payment-instrument--Og5PRkL.js","assets/start-line-BtsAyNBV.js","assets/credit-card-C29QG-_T.js","assets/pro.subscribe-DU9qjcuZ.css","assets/pages._pageId.lazy-DUelTzVl.js","assets/use-clean-history-state-0tN1J_A4.js","assets/text-bold-D_CCj9Db.js","assets/text-bullet-list-Dcml1SV2.js","assets/text-code-CvJ4NOtD.js","assets/text-italic-cmCy-frT.js","assets/text-numbered-list-JU11aZla.js","assets/text-paragraph-jJhUk0V4.js","assets/upload-image-CUCFKrnY.js","assets/pages-welcome-dark-r64A2mUI.js","assets/pages-welcome-light-DDUDcHxX.js","assets/arrow-enter-up-BrKXOSK6.js","assets/use-clean-history-state-DK-0OVGb.css","assets/copy-add-B72YT-_2.js","assets/memory.narrative.lazy-4F7d776S.js","assets/gallery._galleryItemId.lazy-TeUZ9jtE.js","assets/use-toggle-gallery-item-like-DOCZIls1.js","assets/like-filled-CDBj1Rb_.js","assets/like-DIb9i-4k.js","assets/share-url-modal-BHTbz9rO.js","assets/connector.callback.lazy-z7usjpkH.js","assets/chats.private.lazy-BYz4vHP9.js","assets/campaigns._campaignId.lazy-Dw5u-0R_.js","assets/index.lazy-MxHJ-6X0.js","assets/index.lazy-B4IbhNf9.js","assets/index.lazy-D3_ZPNwd.js","assets/labs-badge-CpFqPWwt.js","assets/shares.podcasts._shareId.lazy-Cx4_re_x.js","assets/shares.pages._shareId.lazy-BB-6mrjp.js","assets/eye-BFBZrea-.js","assets/shares.3d-generations._shareId.lazy-CeSO_8QC.js","assets/use-3d-generations-DFL99n8T.js","assets/cube-solid-CuQoI8U9.js","assets/cube-CdrnJRo0.js","assets/pro.redeem._redeemCode.lazy-imHRWvT0.js","assets/pro.ewallet.return.lazy-DoqCe-8t.js","assets/podcasts._podcastType._podcastId.lazy-OvLz0Rpc.js","assets/talk.lazy-ByTbS8jw.js","assets/audio-call-DWDhEUmq.js","assets/timer-iKU8CgDq.js","assets/voicemail-dark-BtARQIb1.js","assets/voicemail-light-DeMSWjpH.js","assets/experiments._experimentAlias.lazy-DltToVGk.js","assets/chats_._conversationId.talk.lazy-BtIA4mJc.js","assets/my-creations.lazy-Jl84Myq0.js","assets/use-responsive-masonry-ChDgmCjo.js","assets/my-creations-DV8PrLMj.css"])))=>i.map(i=>d[i]);
var kz=Object.defineProperty;var L_=n=>{throw TypeError(n)};var xz=(n,e,t)=>e in n?kz(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var B=(n,e,t)=>xz(n,typeof e!="symbol"?e+"":e,t),uS=(n,e,t)=>e.has(n)||L_("Cannot "+t);var fe=(n,e,t)=>(uS(n,e,"read from private field"),t?t.call(n):e.get(n)),ln=(n,e,t)=>e.has(n)?L_("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Vt=(n,e,t,r)=>(uS(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),Ke=(n,e,t)=>(uS(n,e,"access private method"),t);import{r as m,a as O,k as dt,u as N,j as d,T as _z,R as kl,b as pe,v as Mz,z as l,y as RT,J as _5,C as sy,Z as wv,e as Je,f as PT,U as Rz,V as Pz,H as Nz,W as Oz,X as D_,Y as Lz,_ as Dz,A as Mn,m as _e,l as qp,E as Wp,$ as M5,n as th,a0 as NT,a1 as OT,a2 as LT,a3 as jz,a4 as Uz,a5 as DT,F as cy,P as ly,w as uy,o as nh,G as rh,i as R5,D as P5,p as Fz,s as N5,t as O5,a6 as L5,N as D5,a7 as Rd,a8 as Bz,a9 as Hz,aa as $z,ab as Vh,q as j5,d as dy,M as U5,ac as zz,ad as Vz,O as Gz,ae as Kz,af as qz,g as Tt,ag as Wz,ah as Yz,ai as dS,h as Qz,aj as Jz,ak as Zz,al as Xz}from"./vendor-BYCmmfc5.js";import{g as eV}from"./sentry-CQNtvQBy.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const tV="modulepreload",nV=function(n){return"https://studiostaticassetsprod.azureedge.net/bundle-cmc/"+n},j_={},$=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let o=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),c=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=o(t.map(u=>{if(u=nV(u),u in j_)return;j_[u]=!0;const h=u.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":tV,h||(p.as="script"),p.crossOrigin="",p.href=u,c&&p.setAttribute("nonce",c),document.head.appendChild(p),h)return new Promise((g,v)=>{p.addEventListener("load",g),p.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${u}`)))})}))}function a(o){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o}return i.then(o=>{for(const s of o||[])s.status==="rejected"&&a(s.reason);return e().catch(a)})},rV=n=>{const e="input"in n?n.input:"input",t="output"in n?n.output:"output",r="schema"in n?n.schema._input:n._input,i="schema"in n?n.schema._output:n._output;return{types:{input:e==="output"?i:r,output:t==="input"?r:i},parse:a=>"schema"in n?n.schema.parse(a):n.parse(a)}},F5=m.createContext(null),hS={didCatch:!1,error:null};class B5 extends m.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=hS}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(e!==null){for(var t,r,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];(t=(r=this.props).onReset)===null||t===void 0||t.call(r,{args:a,reason:"imperative-api"}),this.setState(hS)}}componentDidCatch(e,t){var r,i;(r=(i=this.props).onError)===null||r===void 0||r.call(i,e,t)}componentDidUpdate(e,t){const{didCatch:r}=this.state,{resetKeys:i}=this.props;if(r&&t.error!==null&&iV(e.resetKeys,i)){var a,o;(a=(o=this.props).onReset)===null||a===void 0||a.call(o,{next:i,prev:e.resetKeys,reason:"keys"}),this.setState(hS)}}render(){const{children:e,fallbackRender:t,FallbackComponent:r,fallback:i}=this.props,{didCatch:a,error:o}=this.state;let s=e;if(a){const c={error:o,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")s=t(c);else if(r)s=m.createElement(r,c);else if(i!==void 0)s=i;else throw o}return m.createElement(F5.Provider,{value:{didCatch:a,error:o,resetErrorBoundary:this.resetErrorBoundary}},s)}}function iV(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return n.length!==e.length||n.some((t,r)=>!Object.is(t,e[r]))}function aV(n){if(n==null||typeof n.didCatch!="boolean"||typeof n.resetErrorBoundary!="function")throw new Error("ErrorBoundaryContext not found")}function H5(){const n=m.useContext(F5);aV(n);const[e,t]=m.useState({error:null,hasError:!1}),r=m.useMemo(()=>({resetBoundary:()=>{n.resetErrorBoundary(),t({error:null,hasError:!1})},showBoundary:i=>t({error:i,hasError:!0})}),[n.resetErrorBoundary]);if(e.hasError)throw e.error;return r}var fS,U_;function oV(){return U_||(U_=1,fS={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),fS}var sV=oV();const cV=eV(sV);var lV=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function F_(n){var e={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},t=n.match(/<\/?([^\s]+?)[/\s>]/);if(t&&(e.name=t[1],(cV[t[1]]||n.charAt(n.length-2)==="/")&&(e.voidElement=!0),e.name.startsWith("!--"))){var r=n.indexOf("-->");return{type:"comment",comment:r!==-1?n.slice(4,r):""}}for(var i=new RegExp(lV),a=null;(a=i.exec(n))!==null;)if(a[0].trim())if(a[1]){var o=a[1].trim(),s=[o,""];o.indexOf("=")>-1&&(s=o.split("=")),e.attrs[s[0]]=s[1],i.lastIndex--}else a[2]&&(e.attrs[a[2]]=a[3].trim().substring(1,a[3].length-1));return e}var uV=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,dV=/^\s*$/,hV=Object.create(null);function $5(n,e){switch(e.type){case"text":return n+e.content;case"tag":return n+="<"+e.name+(e.attrs?function(t){var r=[];for(var i in t)r.push(i+'="'+t[i]+'"');return r.length?" "+r.join(" "):""}(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?n:n+e.children.reduce($5,"")+"</"+e.name+">";case"comment":return n+"<!--"+e.comment+"-->"}}var fV={parse:function(n,e){e||(e={}),e.components||(e.components=hV);var t,r=[],i=[],a=-1,o=!1;if(n.indexOf("<")!==0){var s=n.indexOf("<");r.push({type:"text",content:s===-1?n:n.substring(0,s)})}return n.replace(uV,function(c,u){if(o){if(c!=="</"+t.name+">")return;o=!1}var h,f=c.charAt(1)!=="/",p=c.startsWith("<!--"),g=u+c.length,v=n.charAt(g);if(p){var y=F_(c);return a<0?(r.push(y),r):((h=i[a]).children.push(y),r)}if(f&&(a++,(t=F_(c)).type==="tag"&&e.components[t.name]&&(t.type="component",o=!0),t.voidElement||o||!v||v==="<"||t.children.push({type:"text",content:n.slice(g,n.indexOf("<",g))}),a===0&&r.push(t),(h=i[a-1])&&h.children.push(t),i[a]=t),(!f||t.voidElement)&&(a>-1&&(t.voidElement||t.name===c.slice(2,-1))&&(a--,t=a===-1?r:i[a]),!o&&v!=="<"&&v)){h=a===-1?r:i[a].children;var b=n.indexOf("<",g),C=n.slice(g,b===-1?void 0:b);dV.test(C)&&(C=" "),(b>-1&&a+h.length>=0||C!==" ")&&h.push({type:"text",content:C})}}),r},stringify:function(n){return n.reduce(function(e,t){return e+$5("",t)},"")}};function Gg(){if(console&&console.warn){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];Bi(e[0])&&(e[0]=`react-i18next:: ${e[0]}`),console.warn(...e)}}const B_={};function Ev(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];Bi(e[0])&&B_[e[0]]||(Bi(e[0])&&(B_[e[0]]=new Date),Gg(...e))}const z5=(n,e)=>()=>{if(n.isInitialized)e();else{const t=()=>{setTimeout(()=>{n.off("initialized",t)},0),e()};n.on("initialized",t)}},H_=(n,e,t)=>{n.loadNamespaces(e,z5(n,t))},$_=(n,e,t,r)=>{Bi(t)&&(t=[t]),t.forEach(i=>{n.options.ns.indexOf(i)<0&&n.options.ns.push(i)}),n.loadLanguages(e,z5(n,r))},pV=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=e.languages[0],i=e.options?e.options.fallbackLng:!1,a=e.languages[e.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const o=(s,c)=>{const u=e.services.backendConnector.state[`${s}|${c}`];return u===-1||u===2};return t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&e.services.backendConnector.backend&&e.isLanguageChangingTo&&!o(e.isLanguageChangingTo,n)?!1:!!(e.hasResourceBundle(r,n)||!e.services.backendConnector.backend||e.options.resources&&!e.options.partialBundledLanguages||o(r,n)&&(!i||o(a,n)))},mV=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return!e.languages||!e.languages.length?(Ev("i18n.languages were undefined or empty",e.languages),!0):e.options.ignoreJSONStructure!==void 0?e.hasLoadedNamespace(n,{lng:t.lng,precheck:(i,a)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!a(i.isLanguageChangingTo,n))return!1}}):pV(n,e,t)},Bi=n=>typeof n=="string",qu=n=>typeof n=="object"&&n!==null,gV=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,vV={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},bV=n=>vV[n],yV=n=>n.replace(gV,bV);let Vw={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:yV};const CV=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Vw={...Vw,...n}},V5=()=>Vw;let G5;const SV=n=>{G5=n},jT=()=>G5,pS=(n,e)=>{if(!n)return!1;const t=n.props?n.props.children:n.children;return e?t.length>0:!!t},mS=n=>{if(!n)return[];const e=n.props?n.props.children:n.children;return n.props&&n.props.i18nIsDynamicList?Wu(e):e},wV=n=>Array.isArray(n)&&n.every(m.isValidElement),Wu=n=>Array.isArray(n)?n:[n],EV=(n,e)=>{const t={...e};return t.props=Object.assign(n.props,e.props),t},K5=(n,e)=>{if(!n)return"";let t="";const r=Wu(n),i=e.transSupportBasicHtmlNodes&&e.transKeepBasicHtmlNodesFor?e.transKeepBasicHtmlNodesFor:[];return r.forEach((a,o)=>{if(Bi(a))t+=`${a}`;else if(m.isValidElement(a)){const{props:s,type:c}=a,u=Object.keys(s).length,h=i.indexOf(c)>-1,f=s.children;if(!f&&h&&!u)t+=`<${c}/>`;else if(!f&&(!h||u)||s.i18nIsDynamicList)t+=`<${o}></${o}>`;else if(h&&u===1&&Bi(f))t+=`<${c}>${f}</${c}>`;else{const p=K5(f,e);t+=`<${o}>${p}</${o}>`}}else if(a===null)Gg("Trans: the passed in value is invalid - seems you passed in a null child.");else if(qu(a)){const{format:s,...c}=a,u=Object.keys(c);if(u.length===1){const h=s?`${u[0]}, ${s}`:u[0];t+=`{{${h}}}`}else Gg("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",a)}else Gg("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",a)}),t},TV=(n,e,t,r,i,a)=>{if(e==="")return[];const o=r.transKeepBasicHtmlNodesFor||[],s=e&&new RegExp(o.map(b=>`<${b}`).join("|")).test(e);if(!n&&!s&&!a)return[e];const c={},u=b=>{Wu(b).forEach(S=>{Bi(S)||(pS(S)?u(mS(S)):qu(S)&&!m.isValidElement(S)&&Object.assign(c,S))})};u(n);const h=fV.parse(`<0>${e}</0>`),f={...c,...i},p=(b,C,S)=>{const E=mS(b),T=v(E,C.children,S);return wV(E)&&T.length===0||b.props&&b.props.i18nIsDynamicList?E:T},g=(b,C,S,E,T)=>{b.dummy?(b.children=C,S.push(m.cloneElement(b,{key:E},T?void 0:C))):S.push(...m.Children.map([b],A=>{const I={...A.props};return delete I.i18nIsDynamicList,m.createElement(A.type,{...I,key:E,ref:A.ref},T?null:C)}))},v=(b,C,S)=>{const E=Wu(b);return Wu(C).reduce((A,I,k)=>{const x=I.children&&I.children[0]&&I.children[0].content&&t.services.interpolator.interpolate(I.children[0].content,f,t.language);if(I.type==="tag"){let _=E[parseInt(I.name,10)];S.length===1&&!_&&(_=S[0][I.name]),_||(_={});const R=Object.keys(I.attrs).length!==0?EV({props:I.attrs},_):_,z=m.isValidElement(R),j=z&&pS(I,!0)&&!I.voidElement,J=s&&qu(R)&&R.dummy&&!z,D=qu(n)&&Object.hasOwnProperty.call(n,I.name);if(Bi(R)){const F=t.services.interpolator.interpolate(R,f,t.language);A.push(F)}else if(pS(R)||j){const F=p(R,I,S);g(R,F,A,k)}else if(J){const F=v(E,I.children,S);g(R,F,A,k)}else if(Number.isNaN(parseFloat(I.name)))if(D){const F=p(R,I,S);g(R,F,A,k,I.voidElement)}else if(r.transSupportBasicHtmlNodes&&o.indexOf(I.name)>-1)if(I.voidElement)A.push(m.createElement(I.name,{key:`${I.name}-${k}`}));else{const F=v(E,I.children,S);A.push(m.createElement(I.name,{key:`${I.name}-${k}`},F))}else if(I.voidElement)A.push(`<${I.name} />`);else{const F=v(E,I.children,S);A.push(`<${I.name}>${F}</${I.name}>`)}else if(qu(R)&&!z){const F=I.children[0]?x:null;F&&A.push(F)}else g(R,x,A,k,I.children.length!==1||!x)}else if(I.type==="text"){const _=r.transWrapTextNodes,R=a?r.unescape(t.services.interpolator.interpolate(I.content,f,t.language)):t.services.interpolator.interpolate(I.content,f,t.language);_?A.push(m.createElement(_,{key:`${I.name}-${k}`},R)):A.push(R)}return A},[])},y=v([{dummy:!0,children:n||[]}],h,Wu(n||[]));return mS(y[0])};function IV(n){let{children:e,count:t,parent:r,i18nKey:i,context:a,tOptions:o={},values:s,defaults:c,components:u,ns:h,i18n:f,t:p,shouldUnescape:g,...v}=n;const y=f||jT();if(!y)return Ev("You will need to pass in an i18next instance by using i18nextReactModule"),e;const b=p||y.t.bind(y)||(j=>j),C={...V5(),...y.options&&y.options.react};let S=h||b.ns||y.options&&y.options.defaultNS;S=Bi(S)?[S]:S||["translation"];const E=K5(e,C),T=c||E||C.transEmptyNodeValue||i,{hashTransKey:A}=C,I=i||(A?A(E||T):E||T);y.options&&y.options.interpolation&&y.options.interpolation.defaultVariables&&(s=s&&Object.keys(s).length>0?{...s,...y.options.interpolation.defaultVariables}:{...y.options.interpolation.defaultVariables});const k=s||t!==void 0||!e?o.interpolation:{interpolation:{...o.interpolation,prefix:"#$?",suffix:"?$#"}},x={...o,context:a||o.context,count:t,...s,...k,defaultValue:T,ns:S},_=I?b(I,x):T;u&&Object.keys(u).forEach(j=>{const J=u[j];if(typeof J.type=="function"||!J.props||!J.props.children||_.indexOf(`${j}/>`)<0&&_.indexOf(`${j} />`)<0)return;function D(){return m.createElement(m.Fragment,null,J)}u[j]=m.createElement(D)});const R=TV(u||e,_,y,C,x,g),z=r!==void 0?r:C.defaultTransParent;return z?m.createElement(z,v,R):R}const AV={type:"3rdParty",init(n){CV(n.options.react),SV(n)}},q5=m.createContext();class kV{constructor(){B(this,"getUsedNamespaces",()=>Object.keys(this.usedNamespaces));this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}}function Fr(n){let{children:e,count:t,parent:r,i18nKey:i,context:a,tOptions:o={},values:s,defaults:c,components:u,ns:h,i18n:f,t:p,shouldUnescape:g,...v}=n;const{i18n:y,defaultNS:b}=m.useContext(q5)||{},C=f||y||jT(),S=p||C&&C.t.bind(C);return IV({children:e,count:t,parent:r,i18nKey:i,context:a,tOptions:o,values:s,defaults:c,components:u,ns:h||S&&S.ns||b||C&&C.options&&C.options.defaultNS,i18n:C,t:p,shouldUnescape:g,...v})}const xV=(n,e)=>{const t=m.useRef();return m.useEffect(()=>{t.current=n},[n,e]),t.current},W5=(n,e,t,r)=>n.getFixedT(e,t,r),_V=(n,e,t,r)=>m.useCallback(W5(n,e,t,r),[n,e,t,r]),Ce=function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{i18n:t}=e,{i18n:r,defaultNS:i}=m.useContext(q5)||{},a=t||r||jT();if(a&&!a.reportNamespaces&&(a.reportNamespaces=new kV),!a){Ev("You will need to pass in an i18next instance by using initReactI18next");const T=(I,k)=>Bi(k)?k:qu(k)&&Bi(k.defaultValue)?k.defaultValue:Array.isArray(I)?I[I.length-1]:I,A=[T,{},!1];return A.t=T,A.i18n={},A.ready=!1,A}a.options.react&&a.options.react.wait!==void 0&&Ev("It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={...V5(),...a.options.react,...e},{useSuspense:s,keyPrefix:c}=o;let u=n||i||a.options&&a.options.defaultNS;u=Bi(u)?[u]:u||["translation"],a.reportNamespaces.addUsedNamespaces&&a.reportNamespaces.addUsedNamespaces(u);const h=(a.isInitialized||a.initializedStoreOnce)&&u.every(T=>mV(T,a,o)),f=_V(a,e.lng||null,o.nsMode==="fallback"?u:u[0],c),p=()=>f,g=()=>W5(a,e.lng||null,o.nsMode==="fallback"?u:u[0],c),[v,y]=m.useState(p);let b=u.join();e.lng&&(b=`${e.lng}${b}`);const C=xV(b),S=m.useRef(!0);m.useEffect(()=>{const{bindI18n:T,bindI18nStore:A}=o;S.current=!0,!h&&!s&&(e.lng?$_(a,e.lng,u,()=>{S.current&&y(g)}):H_(a,u,()=>{S.current&&y(g)})),h&&C&&C!==b&&S.current&&y(g);const I=()=>{S.current&&y(g)};return T&&a&&a.on(T,I),A&&a&&a.store.on(A,I),()=>{S.current=!1,T&&a&&T.split(" ").forEach(k=>a.off(k,I)),A&&a&&A.split(" ").forEach(k=>a.store.off(k,I))}},[a,b]),m.useEffect(()=>{S.current&&h&&y(p)},[a,c,h]);const E=[v,a,h];if(E.t=v,E.i18n=a,E.ready=h,h||!h&&!s)return E;throw new Promise(T=>{e.lng?$_(a,e.lng,u,()=>T()):H_(a,u,()=>T())})},Y5=O([]),z_=new Map,ec=n=>{let e=z_.get(n);return e||(e=O(t=>t(Y5).includes(n)),z_.set(n,e),e)};function ee(n){return N(ec(n))}function $e(n){return dt().get(ec(n))}function Ai(n){return N(ec(n))}function Ir(n){return dt().get(ec(n))}function UT(){return Ai("kill-domain-referrer")?"noopener noreferrer":"noopener"}function Q5(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(e=0;e<i;e++)n[e]&&(t=Q5(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function X(){for(var n,e,t=0,r="",i=arguments.length;t<i;t++)(n=arguments[t])&&(e=Q5(n))&&(r&&(r+=" "),r+=e);return r}const Yp={Namibia:"NA","South Africa":"ZA",Cameroon:"CM",Japan:"JP",Ghana:"GH",Ethiopia:"ET","United States":"US","United Arab Emirates":"AE",Bahrain:"BH",Djibouti:"DJ",Algeria:"DZ",Egypt:"EG","Western Sahara":"EH",Eritrea:"ER",Israel:"IL",Iraq:"IQ",Jordan:"JO",Comoros:"KM",Kuwait:"KW",Lebanon:"LB",Libya:"LY",Morocco:"MA",Mauritania:"MR",Oman:"OM","Palestinian Territories":"PS",Qatar:"QA","Saudi Arabia":"SA",Sudan:"SD",Somalia:"SO","South Sudan":"SS",Syria:"SY",Chad:"TD",Tunisia:"TN",Yemen:"YE",Chile:"CL",India:"IN",Tanzania:"TZ",Spain:"ES",Azerbaijan:"AZ",Russia:"RU",Belarus:"BY",Zambia:"ZM",Bulgaria:"BG",Mali:"ML",Bangladesh:"BD","China mainland":"CN",France:"FR","Bosnia & Herzegovina":"BA",Andorra:"AD",Italy:"IT",Philippines:"PH",Uganda:"UG",Iran:"IR",Czechia:"CZ","United Kingdom":"GB",Denmark:"DK",Greenland:"GL",Kenya:"KE",Austria:"AT",Belgium:"BE",Switzerland:"CH",Germany:"DE",Liechtenstein:"LI",Luxembourg:"LU",Niger:"NE",Maldives:"MV",Senegal:"SN",Bhutan:"BT",Togo:"TG",Cyprus:"CY",Greece:"GR","Antigua & Barbuda":"AG",Anguilla:"AI",Albania:"AL",Argentina:"AR","American Samoa":"AS",Australia:"AU",Barbados:"BB",Burundi:"BI",Bermuda:"BM",Brunei:"BN",Brazil:"BR",Bahamas:"BS",Botswana:"BW",Belize:"BZ",Canada:"CA","Cocos (Keeling) Islands":"CC","Cook Islands":"CK",Colombia:"CO","Cape Verde":"CV","Christmas Island":"CX","Diego Garcia":"DG",Dominica:"DM",Estonia:"EE",Finland:"FI",Fiji:"FJ","Falkland Islands":"FK",Micronesia:"FM",Grenada:"GD",Guernsey:"GG",Gibraltar:"GI",Gambia:"GM",Guam:"GU",Guyana:"GY","Hong Kong":"HK",Hungary:"HU",Indonesia:"ID",Ireland:"IE","Isle of Man":"IM","Chagos Archipelago":"IO",Jersey:"JE",Jamaica:"JM",Kiribati:"KI","St. Kitts & Nevis":"KN","South Korea":"KR","Cayman Islands":"KY","St. Lucia":"LC",Liberia:"LR",Lesotho:"LS",Lithuania:"LT",Latvia:"LV",Madagascar:"MG","Marshall Islands":"MH","Myanmar (Burma)":"MM",Macao:"MO","Northern Mariana Islands":"MP",Montserrat:"MS",Malta:"MT",Mauritius:"MU",Malawi:"MW",Mexico:"MX",Malaysia:"MY","Norfolk Island":"NF",Nigeria:"NG",Netherlands:"NL",Norway:"NO",Nauru:"NR",Niue:"NU","New Zealand":"NZ","Papua New Guinea":"PG",Pakistan:"PK",Poland:"PL","Pitcairn Islands":"PN","Puerto Rico":"PR",Portugal:"PT",Palau:"PW",Rwanda:"RW","Solomon Islands":"SB",Seychelles:"SC",Sweden:"SE",Singapore:"SG","St. Helena":"SH",Slovenia:"SI",Slovakia:"SK","Sierra Leone":"SL","Sint Maarten":"SX",Eswatini:"SZ","Turks & Caicos Islands":"TC",Thailand:"TH",Tokelau:"TK",Tonga:"TO",Türkiye:"TR","Trinidad & Tobago":"TT",Tuvalu:"TV",Taiwan:"TW",Ukraine:"UA","U.S. Outlying Islands":"UM","St. Vincent & Grenadines":"VC","British Virgin Islands":"VG","U.S. Virgin Islands":"VI",Vanuatu:"VU",Samoa:"WS",Zimbabwe:"ZW",Bolivia:"BO","Caribbean Netherlands":"BQ","Costa Rica":"CR",Cuba:"CU",Curaçao:"CW","Dominican Republic":"DO","Ceuta & Melilla":"EA",Ecuador:"EC","Equatorial Guinea":"GQ",Guatemala:"GT",Honduras:"HN",Haiti:"HT","Canary Islands":"IC",Nicaragua:"NI",Panama:"PA",Peru:"PE",Paraguay:"PY","El Salvador":"SV",Uruguay:"UY",Venezuela:"VE",Afghanistan:"AF","Burkina Faso":"BF",Guinea:"GN","Guinea-Bissau":"GW","Faroe Islands":"FO",Benin:"BJ","St. Barthélemy":"BL","Congo - Kinshasa":"CD","Central African Republic":"CF","Congo - Brazzaville":"CG","Côte d'Ivoire":"CI",Gabon:"GA","French Guiana":"GF",Guadeloupe:"GP",Monaco:"MC","St. Martin":"MF",Martinique:"MQ","New Caledonia":"NC","French Polynesia":"PF","St. Pierre & Miquelon":"PM",Réunion:"RE","Wallis & Futuna":"WF",Mayotte:"YT",Croatia:"HR",Armenia:"AM",Iceland:"IS","San Marino":"SM","Vatican City":"VA",Georgia:"GE",Kazakhstan:"KZ",Cambodia:"KH","North Korea":"KP",Kyrgyzstan:"KG",Angola:"AO",Laos:"LA",Mozambique:"MZ","North Macedonia":"MK",Mongolia:"MN","Svalbard & Jan Mayen":"SJ",Nepal:"NP",Aruba:"AW",Suriname:"SR","São Tomé & Príncipe":"ST","Timor-Leste":"TL",Moldova:"MD",Romania:"RO","Sri Lanka":"LK",Kosovo:"XK",Montenegro:"ME",Serbia:"RS","Åland Islands":"AX",Tajikistan:"TJ",Turkmenistan:"TM",Uzbekistan:"UZ",Vietnam:"VN"},J5=["blowing-dust","blowing-sand","blowing-snow","clear","clear-occasional-rain-or-thunderstorms","clear-then-cloudy","clear-then-occasional-rain","clear-then-occasional-snow","clear-then-rain","clear-then-rain-or-snow","clear-then-rain-or-thunderstorms","clear-then-snow","clear-then-snow-or-rain","clear-then-thunderstorms","clear-with-isolated-snow","clear-with-isolated-thunderstorms","clear-with-occasional-clouds","clear-with-occasional-rain","clear-with-occasional-rain-or-snow","clear-with-occasional-snow","clear-with-occasional-snow-or-rain","cloudy","cloudy-and-occasionally-clear","cloudy-occasional-rain-or-thunderstorms","cloudy-then-clear","cloudy-then-occasional-rain","cloudy-then-occasional-snow","cloudy-then-occasionally-clear","cloudy-then-rain","cloudy-then-rain-or-snow","cloudy-then-rain-or-thunderstorms","cloudy-then-snow","cloudy-then-snow-or-rain","cloudy-with-isolated-rain","cloudy-with-occasional-rain","cloudy-with-occasional-rain-or-snow","cloudy-with-occasional-snow","cloudy-with-occasional-snow-or-rain","cloudy-with-thundersnow-at-times","drifting-sand","drifting-snow","drizzle","duststorm","fair","fog","freezing-drizzle","freezing-fog","freezing-rain","hail","haze","heavy-drizzle","heavy-rain","heavy-snow","heavy-thunderstorms","ice-pellets","light-drizzle","light-fog","light-freezing-drizzle","light-freezing-rain","light-hail","light-rain","light-rain-and-snow","light-rain-and-snow-shower","light-rain-shower","light-snow","light-snow-shower","mostly-clear","mostly-cloudy","mostly-sunny","partly-cloudy","partly-sunny","patchy-fog","rain","rain-and-occasionally-clear","rain-and-occasionally-cloudy","rain-and-snow","rain-and-snow-shower","rain-or-snow","rain-or-snow-then-clear","rain-or-snow-then-cloudy","rain-showers","rain-then-clear","rain-then-cloudy","rain-then-occasional-snow","rain-turning-to-snow","rain-with-occasional-snow","severe-duststorm","sleet","smoke","snow","snow-and-occasionally-clear","snow-and-occasionally-cloudy","snow-or-rain","snow-or-rain-then-clear","snow-or-rain-then-cloudy","snow-showers","snow-then-clear","snow-then-cloudy","snow-then-rain","squalls","sunny","thundersnow","thunderstorms","unknown","windy-rainstorm","windy-with-heavy-snow"],MV=["adult","teen"],RV=["twenty-four-hours","one-day","five-days","one-week","one-month","one-year","five-years","max"],PV=["pro","m365-basic","m365-personal-classic","m365-family-classic-admin","m365-family-classic-guest","m365-personal","m365-family-admin","m365-family-guest","m365-premium-admin","m365-premium-guest"],NV=["direct","apple","google","retail"],OV=["guest","free","m365-personal","pro","m365-premium"],LV=["python"],DV=["connected","disconnected","disabled","sign-in-required","unavailable"],jV=["1p-onedrive","google-drive"],UV=5,FV=10240,GDe=100,BV=15e3,Pa=8,$t={mediaViewer:"z-10",composer:"z-10",composerBottomSlot:"z-20",coachmark:"z-30",chatScrollToBottomButton:"z-10",babylonCharacter:"z-10",citations:"z-20",settings:"z-30",audioBase:"z-10",audioDisplayContent:"z-40",modalBackground:"z-30",modal:"z-40",sidebar:"z-40",toastNotification:"z-50",dropdownMenuOverModal:"z-50",pages:{warning:"z-10",chat:"z-20"},shopping:{navigation:"z-10"},headerIcon:"z-30",header:"z-[60]",default:"z-0",labs3d:{errorPage:"z-20"}},Ei={default:.15,slow:.5,composerButton:.2,settings:.1,audio:{available:.5,unavailable:2,deepLinkLanding:.5},suggestions:.2,dailyBriefing:{background:.5,sourcePopoverScale:.2,sourcePopoverOpacity:.15}},KDe=.25,qDe=2,WDe=0,HV=1.5,Z5=2e3,$V=1e3,zV=.25,ct={opacity:0},Rt={opacity:1},VV=.2,GV=.025,YDe={initial:ct,animate:{...Rt,transition:{delayChildren:VV,staggerChildren:GV}}},QDe={initial:ct,animate:Rt},FT={willChange:"auto"},Tv="9188040d-6c67-4c5b-b112-36a304b66dad",gS="copilot.cloud.microsoft",JDe=X("mt-px text-end uppercase text-foreground-450 text-2xs dark:text-foreground-600"),ZDe="flex items-center justify-between text-start",KV=["Austria","Belgium","Brazil","Bulgaria","Canada","Croatia","Cyprus","Czechia","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Iceland","Ireland","Italy","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta","Netherlands","Norway","China mainland","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","Switzerland","Türkiye","United Kingdom"],hy=KV.map(n=>Yp[n]),qV=["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czechia","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Ireland","Italy","Latvia","Lithuania","Luxembourg","Malta","Netherlands","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden"],WV=qV.map(n=>Yp[n]),YV=["Belarus","China mainland","Lebanon","Macao","Russia","Venezuela","North Korea","Cuba","Syria","Iran"],QV=YV.map(n=>Yp[n]),JV="https://account.live.com/ep",X5="Think Deeper",ZV="Think Deeper (o4-mini)",eL="Smart",tL="Smart (GPT-5)",XDe=1500,Iv=24*60*60*1e3,XV=5,BT=451,nL="Not allowed child account",HT="LEGALLY_UNAVAILABLE_STATUS",Gw=3,vS=[80,100,110,125,150],Qp=100,eG=1e3,rL=!1,iL=!1,aL="/chats/private",Av=3,tG="https://www.copilot.com",nG="https://www.copilot-stg.com";function oL(){return typeof window>"u"?!1:window.location.origin===tG||window.location.origin===nG}function sL(){return oL()?`${window.location.origin}/c/api`:"https://copilot.microsoft.com/c/api"}function Ls(n){const e=n.split("://");return e.length===1?`https://${n}`:e[0]==="http"?`https://${e[1]}`:n}function rG(n){return n==="."||n==="!"||n==="?"}function iG(n){return n===" "||n===`
`||n==="	"}function aG(n){let e=n.length-1;for(;e>=0&&iG(n[e]);)e-=1;return[n.slice(0,e+1),n.slice(e+1)]}function oG(n,e,t){return n.slice(0,t)+e+n.slice(t)}const sG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-dark-aggressive-banner-Dtr5ysxQ.webp",cG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-dark-aggressive-copied-popup-BRVm_KWU.webp",lG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-dark-aggressive-engaging-popup-YSBImXns.webp",uG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-dark-aggressive-secondday-popup--nxha975.webp",dG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-dark-aggressive-setting-TTFEOcbN.webp",hG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-dark-aggressive-think-deeper-popup-FHodYGgC.webp",fG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-dark-aggressive-thumbsup-card-DH3zTT3T.webp",pG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-dark-aggressive-thumbsup-popup-D7hBD_1Q.webp",mG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-dark-desktop-discover-strip-DnlsnV3g.webp",gG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-dark-desktop-setting-banner-CqsoJ8gk.webp",vG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-dark-desktop-setting-menu-item-C25mGU_p.webp",bG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-aggressive-banner-CKv2a8_f.webp",yG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-aggressive-copied-popup-M4nhJM3H.webp",CG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-aggressive-engaging-popup-B-vXLUhP.webp",SG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-aggressive-secondday-popup-DBikSjcg.webp",wG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-aggressive-setting-D2OBsvlS.webp",EG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-aggressive-think-deeper-popup-D5tA7N2r.webp",TG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-aggressive-thumbsup-card-CwLVOvcv.webp",IG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-aggressive-thumbsup-popup-DM6aMFdv.webp",AG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-desktop-discover-strip-flsYDh7H.webp",kG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-desktop-setting-banner-C2lNCEe_.webp",xG="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-desktop-setting-menu-item-BzBe-XWV.webp",V_="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-qr-light-shopping-Dm2se5Rq.png",_G={appLayout:{showSettings:!0,showCookieBanner:!0,showSettingsRelyOnChatDetailLayout:!0,showMobileCrossSelling:!0},surfaceQueryParam:null,showScrollbarOnHover:!1,dailyBriefingOcid:"cp_web_daily",persistThemeChoice:!0,entraRedirectModalBehaviour:"replace",redirectBackEnabled:!0,crossPromotion:{discoverStrip:{dark:mG,light:AG,fontSize:"m"},settingMenuItem:{dark:vG,light:xG},settingBanner:{dark:gG,light:kG},aggressive:{banner:{dark:sG,light:bG},setting:{dark:dG,light:wG},card:{thumbsUp:{dark:fG,light:TG}},popup:{secondDay:{dark:uG,light:SG},thumbsUp:{dark:pG,light:IG},copied:{dark:cG,light:yG},engaging:{dark:lG,light:CG},thinkDeeper:{dark:hG,light:EG}}}},proSubscription:{enabled:!0,manageRefId:"cmc",urlParams:{client:"cmc",ocids:{ActionsLimit:{freeTrial:"cmmmcpyae96",buy:"cmm46gj0qnu"},VoiceLimit:{freeTrial:"cmm0ghcr8ka",buy:"cmmxki6wg02"},Settings:{freeTrial:"cmma4vbm2dq",buy:"cmmugsiwg58"},ChatReasoningLimit:{freeTrial:"cmmtjssvrv9",buy:"cmmzn5kdy9p"},MarketSelect:{freeTrial:"cmmxe0nad8b",buy:"cmmtbwi4652",market:"none"},PodcastLimit:{buy:"cmmtzkwxk60"},DeepResearchLimit:{buy:"cmmoe57pdco"}}},m365UrlParams:{ocids:{Management:{buy:"cmmuwkdmgrx"},"Management-FromWinNative":{buy:"cmm37as1oow"},Settings:{buy:"cmm7br2b8jz"},"Settings-FromWinNative":{buy:"cmmn7sj2u1h"},Unknown:{buy:"cmmquw3utd3"},VisionLimit:{buy:"cmmel7cuppc"},"VisionLimit-FromWinNative":{buy:"cmmkixaxk1s"},"VisionLimit-FromEdge":{buy:"cmm1jlg6uo0"},"VisionLimit-FromEdgeCopilotMode":{buy:"cmmrvmke5cp"},PodcastLimit:{buy:"cmmzh6u3s7s"},"PodcastLimit-FromWinNative":{buy:"cmmis92nwrv"},"PodcastLimit-FromEdgeCopilotMode":{buy:"cmmqak9uo3w"},ActionsLimit:{buy:"cmmmnsn10i7"},"ActionsLimit-FromWinNative":{buy:"cmmn7sj2u1h"},"ActionsLimit-FromEdgeCopilotMode":{buy:"cmmb2arb6s3"},DeepResearchLimit:{buy:"cmmfwtv3wop"},"DeepResearchLimit-FromWinNative":{buy:"cmm3x3vhgp4"},"DeepResearchLimit-FromEdgeCopilotMode":{buy:"cmm86lqbhrs"}}},upsellFromAuth0:{navigateToProSubPageAfterLogin:!0}},referralEnabled:!0,adsEnabled:!0,adsShowroomEnabled:!0,thinkDeeperFreemiumEnabled:!0,monitorAccountChangesAcrossTabs:!0,shopping:{upsell:{banner:{light:V_,dark:V_}}},sidebarNavigation:!0,showChatDetail:!0,enableAuth0:!0,settingsOverrides:{shouldShowActivityHistory:!0,shouldShowMemoryDelete:!0},enableCustom1DS:!0,actions:{enableActions:()=>Promise.resolve(!0)},landingPage:{enableLandingRoute:!0,enableCentralComposer:!0,enableStarterPrompts:!0,enableAutoSuggest:!0,enableWidgets:!0,enablePromptedGreetings:!0,shouldFetchWidgetsData:!0,regexForAutoSuggest:/\S+\s+/},supportsYouTubeVideos:!0,useMSALPwBApp:!0,isBotDetectionEnabled:!0,enableLabs:!0,pages:{enableEditorImageUpload:!0}},Rc=class Rc{constructor(){B(this,"cfg",_G)}static instance(){return Rc.singleton||(Rc.singleton=new Rc),Rc.singleton}config(){return this.cfg}setConfig(e){this.cfg=e}};B(Rc,"singleton",null);let me=Rc;const MG=/^(?:(?:https?):\/\/)?(?:(?:[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?\.))+[a-z]{2,}(?:\/[\w.-]*)*\/?(?:\?[^\s#]*)?(?:#[^\s]*)?$/,RG=/\b((https?:\/\/|www\.)?([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,})([/?#][\w\-._~:/?#@!$&'()*+,;=%]*)?(?=[\s<>()"'.,!?)}\]“”‘’《》「」『』【】]|$)/gi;function $T(n){return MG.test(n)}function PG(n){return n.startsWith("/attachments/onedrive/")}function e3e(n){return!!PG(n)}function NG(n){const[e,t]=aG(n),r=rG(e[e.length-1]),i=r?e.slice(0,-1):e;if($T(i)){const a=r?e[e.length-1]:"";return{url:Ls(i),word:i,suffix:`${a}${t}`}}return{word:n}}function Pd(n){let e="";try{e=new URL(n).hostname}catch{}return e}function OG(n,e,t){const{overwrite:r}=t??{};try{const i=new URL(n);for(const[a,o]of Object.entries(e))r&&i.searchParams.delete(a),i.searchParams.append(a,o);return i.toString()}catch{}return n}function tl(n){const{formCodeParamOnLinks:e}=me.instance().config();return e?OG(n,{form:e}):n}function LG(n){return n.replace(/[.,!?]+$/,"")}function DG(n,e){return!n||e<=0?!1:n[e-1]==="@"||/[\w.-]+@/.test(n.slice(Math.max(0,e-20),e+1))}function t3e(n){const e=[];if(!n)return e;for(const t of n.matchAll(RG)){const r=t[0],{index:i}=t;if(i<0||DG(n,i))continue;const a=LG(r),o=Ls(a),s=i+a.length;e.push({url:o,from:i,to:s})}return e}function n3e(n){return $T(n)?n:sL()+n}const to=m.forwardRef((n,e)=>{const{children:t,href:r,className:i,title:a,"aria-controls":o,"aria-expanded":s,"aria-haspopup":c,"aria-label":u,id:h,target:f,onClick:p,onPointerDown:g,onFocus:v}=n,y=UT();return d.jsx("a",{id:h,ref:e,"aria-controls":o,"aria-expanded":s,"aria-haspopup":c,"aria-label":u,className:i,title:a,href:r&&tl(r),target:f??"_blank",rel:y,onClick:p,onPointerDown:g,onFocus:v,children:t})});to.displayName="Link";const jG="SN:ROOT",UG=m.createContext(null);function FG(){return m.useContext(UG)}const zT=m.createContext(jG);zT.displayName="FocusContext";function BG(){return m.useContext(zT)}function Gh(){}function HG({focusable:n=!0,saveLastFocusedChild:e=!0,trackChildren:t=!1,autoRestoreFocus:r=!0,forceFocus:i=!1,isFocusBoundary:a=!1,focusBoundaryDirections:o,focusKey:s,preferredChildFocusKey:c,onEnterPress:u=Gh,onEnterRelease:h=Gh,onArrowPress:f=()=>!0,onArrowRelease:p=Gh,onFocus:g=Gh,onBlur:v=Gh}){const y=FG(),b=m.useCallback(D=>{D&&u(D)},[u]),C=m.useCallback(()=>{h()},[h]),S=m.useCallback((D,F)=>f(D,F),[f]),E=m.useCallback(D=>{p(D)},[p]),T=m.useCallback((D,F)=>{g(D,F)},[g]),A=m.useCallback((D,F)=>{v(D,F)},[v]),I=m.useRef(null),[k,x]=m.useState(!1),[_,R]=m.useState(!1),z=BG(),j=m.useMemo(()=>y?s??crypto.randomUUID():void 0,[s,y]),J=m.useCallback((D={})=>{j&&(y==null||y.setFocus(j,D))},[j,y]);return m.useEffect(()=>{const D=I.current;return D&&j&&(y==null||y.addFocusable({focusKey:j,node:D,parentFocusKey:z,preferredChildFocusKey:c,onEnterPress:b,onEnterRelease:C,onArrowPress:S,onArrowRelease:E,onFocus:T,onBlur:A,onUpdateFocus:(F=!1)=>x(F),onUpdateHasFocusedChild:(F=!1)=>R(F),saveLastFocusedChild:e,trackChildren:t,isFocusBoundary:a,focusBoundaryDirections:o,autoRestoreFocus:r,forceFocus:i,focusable:n})),()=>{j&&(y==null||y.removeFocusable({focusKey:j}))}},[]),m.useEffect(()=>{const D=I.current;D&&j&&(y==null||y.updateFocusable(j,{node:D,preferredChildFocusKey:c,focusable:n,isFocusBoundary:a,focusBoundaryDirections:o,onEnterPress:b,onEnterRelease:C,onArrowPress:S,onArrowRelease:E,onFocus:T,onBlur:A}))},[j,c,n,a,o,b,C,S,E,T,A,y]),{ref:I,focusSelf:J,focused:k,hasFocusedChild:_,focusKey:j}}function $G(...n){return e=>{for(const t of n)t&&(typeof t=="function"?t(e):t.current=e)}}function ih(n,...e){const t=HG({onEnterPress:()=>{var i;(i=t.ref.current)==null||i.click()},onFocus:()=>{var i,a;(i=t.ref.current)==null||i.focus(),n.scrollIntoViewOnFocus&&((a=t.ref.current)==null||a.scrollIntoView({block:"nearest"}))},onBlur:()=>{var i;(i=t.ref.current)==null||i.blur()},...n}),r=$G(...e,t.ref);return{focusable:t,refCallback:r}}const VT="-",zG=n=>{const e=GG(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=n;return{getClassGroupId:o=>{const s=o.split(VT);return s[0]===""&&s.length!==1&&s.shift(),cL(s,e)||VG(o)},getConflictingClassGroupIds:(o,s)=>{const c=t[o]||[];return s&&r[o]?[...c,...r[o]]:c}}},cL=(n,e)=>{var o;if(n.length===0)return e.classGroupId;const t=n[0],r=e.nextPart.get(t),i=r?cL(n.slice(1),r):void 0;if(i)return i;if(e.validators.length===0)return;const a=n.join(VT);return(o=e.validators.find(({validator:s})=>s(a)))==null?void 0:o.classGroupId},G_=/^\[(.+)\]$/,VG=n=>{if(G_.test(n)){const e=G_.exec(n)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},GG=n=>{const{theme:e,prefix:t}=n,r={nextPart:new Map,validators:[]};return qG(Object.entries(n.classGroups),t).forEach(([a,o])=>{Kw(o,r,a,e)}),r},Kw=(n,e,t,r)=>{n.forEach(i=>{if(typeof i=="string"){const a=i===""?e:K_(e,i);a.classGroupId=t;return}if(typeof i=="function"){if(KG(i)){Kw(i(r),e,t,r);return}e.validators.push({validator:i,classGroupId:t});return}Object.entries(i).forEach(([a,o])=>{Kw(o,K_(e,a),t,r)})})},K_=(n,e)=>{let t=n;return e.split(VT).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},KG=n=>n.isThemeGetter,qG=(n,e)=>e?n.map(([t,r])=>{const i=r.map(a=>typeof a=="string"?e+a:typeof a=="object"?Object.fromEntries(Object.entries(a).map(([o,s])=>[e+o,s])):a);return[t,i]}):n,WG=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,r=new Map;const i=(a,o)=>{t.set(a,o),e++,e>n&&(e=0,r=t,t=new Map)};return{get(a){let o=t.get(a);if(o!==void 0)return o;if((o=r.get(a))!==void 0)return i(a,o),o},set(a,o){t.has(a)?t.set(a,o):i(a,o)}}},lL="!",YG=n=>{const{separator:e,experimentalParseClassName:t}=n,r=e.length===1,i=e[0],a=e.length,o=s=>{const c=[];let u=0,h=0,f;for(let b=0;b<s.length;b++){let C=s[b];if(u===0){if(C===i&&(r||s.slice(b,b+a)===e)){c.push(s.slice(h,b)),h=b+a;continue}if(C==="/"){f=b;continue}}C==="["?u++:C==="]"&&u--}const p=c.length===0?s:s.substring(h),g=p.startsWith(lL),v=g?p.substring(1):p,y=f&&f>h?f-h:void 0;return{modifiers:c,hasImportantModifier:g,baseClassName:v,maybePostfixModifierPosition:y}};return t?s=>t({className:s,parseClassName:o}):o},QG=n=>{if(n.length<=1)return n;const e=[];let t=[];return n.forEach(r=>{r[0]==="["?(e.push(...t.sort(),r),t=[]):t.push(r)}),e.push(...t.sort()),e},JG=n=>({cache:WG(n.cacheSize),parseClassName:YG(n),...zG(n)}),ZG=/\s+/,XG=(n,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:i}=e,a=[],o=n.trim().split(ZG);let s="";for(let c=o.length-1;c>=0;c-=1){const u=o[c],{modifiers:h,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:g}=t(u);let v=!!g,y=r(v?p.substring(0,g):p);if(!y){if(!v){s=u+(s.length>0?" "+s:s);continue}if(y=r(p),!y){s=u+(s.length>0?" "+s:s);continue}v=!1}const b=QG(h).join(":"),C=f?b+lL:b,S=C+y;if(a.includes(S))continue;a.push(S);const E=i(y,v);for(let T=0;T<E.length;++T){const A=E[T];a.push(C+A)}s=u+(s.length>0?" "+s:s)}return s};function eK(){let n=0,e,t,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=uL(e))&&(r&&(r+=" "),r+=t);return r}const uL=n=>{if(typeof n=="string")return n;let e,t="";for(let r=0;r<n.length;r++)n[r]&&(e=uL(n[r]))&&(t&&(t+=" "),t+=e);return t};function tK(n,...e){let t,r,i,a=o;function o(c){const u=e.reduce((h,f)=>f(h),n());return t=JG(u),r=t.cache.get,i=t.cache.set,a=s,s(c)}function s(c){const u=r(c);if(u)return u;const h=XG(c,t);return i(c,h),h}return function(){return a(eK.apply(null,arguments))}}const un=n=>{const e=t=>t[n]||[];return e.isThemeGetter=!0,e},dL=/^\[(?:([a-z-]+):)?(.+)\]$/i,nK=/^\d+\/\d+$/,rK=new Set(["px","full","screen"]),iK=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,aK=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,oK=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,sK=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,cK=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,So=n=>ud(n)||rK.has(n)||nK.test(n),cs=n=>ah(n,"length",gK),ud=n=>!!n&&!Number.isNaN(Number(n)),bS=n=>ah(n,"number",ud),Kh=n=>!!n&&Number.isInteger(Number(n)),lK=n=>n.endsWith("%")&&ud(n.slice(0,-1)),St=n=>dL.test(n),ls=n=>iK.test(n),uK=new Set(["length","size","percentage"]),dK=n=>ah(n,uK,hL),hK=n=>ah(n,"position",hL),fK=new Set(["image","url"]),pK=n=>ah(n,fK,bK),mK=n=>ah(n,"",vK),qh=()=>!0,ah=(n,e,t)=>{const r=dL.exec(n);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):t(r[2]):!1},gK=n=>aK.test(n)&&!oK.test(n),hL=()=>!1,vK=n=>sK.test(n),bK=n=>cK.test(n),yK=()=>{const n=un("colors"),e=un("spacing"),t=un("blur"),r=un("brightness"),i=un("borderColor"),a=un("borderRadius"),o=un("borderSpacing"),s=un("borderWidth"),c=un("contrast"),u=un("grayscale"),h=un("hueRotate"),f=un("invert"),p=un("gap"),g=un("gradientColorStops"),v=un("gradientColorStopPositions"),y=un("inset"),b=un("margin"),C=un("opacity"),S=un("padding"),E=un("saturate"),T=un("scale"),A=un("sepia"),I=un("skew"),k=un("space"),x=un("translate"),_=()=>["auto","contain","none"],R=()=>["auto","hidden","clip","visible","scroll"],z=()=>["auto",St,e],j=()=>[St,e],J=()=>["",So,cs],D=()=>["auto",ud,St],F=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],ie=()=>["solid","dashed","dotted","double","none"],U=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],W=()=>["start","end","center","between","around","evenly","stretch"],ue=()=>["","0",St],te=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Z=()=>[ud,St];return{cacheSize:500,separator:":",theme:{colors:[qh],spacing:[So,cs],blur:["none","",ls,St],brightness:Z(),borderColor:[n],borderRadius:["none","","full",ls,St],borderSpacing:j(),borderWidth:J(),contrast:Z(),grayscale:ue(),hueRotate:Z(),invert:ue(),gap:j(),gradientColorStops:[n],gradientColorStopPositions:[lK,cs],inset:z(),margin:z(),opacity:Z(),padding:j(),saturate:Z(),scale:Z(),sepia:ue(),skew:Z(),space:j(),translate:j()},classGroups:{aspect:[{aspect:["auto","square","video",St]}],container:["container"],columns:[{columns:[ls]}],"break-after":[{"break-after":te()}],"break-before":[{"break-before":te()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...F(),St]}],overflow:[{overflow:R()}],"overflow-x":[{"overflow-x":R()}],"overflow-y":[{"overflow-y":R()}],overscroll:[{overscroll:_()}],"overscroll-x":[{"overscroll-x":_()}],"overscroll-y":[{"overscroll-y":_()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[y]}],"inset-x":[{"inset-x":[y]}],"inset-y":[{"inset-y":[y]}],start:[{start:[y]}],end:[{end:[y]}],top:[{top:[y]}],right:[{right:[y]}],bottom:[{bottom:[y]}],left:[{left:[y]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Kh,St]}],basis:[{basis:z()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",St]}],grow:[{grow:ue()}],shrink:[{shrink:ue()}],order:[{order:["first","last","none",Kh,St]}],"grid-cols":[{"grid-cols":[qh]}],"col-start-end":[{col:["auto",{span:["full",Kh,St]},St]}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":[qh]}],"row-start-end":[{row:["auto",{span:[Kh,St]},St]}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",St]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",St]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...W()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...W(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...W(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[S]}],px:[{px:[S]}],py:[{py:[S]}],ps:[{ps:[S]}],pe:[{pe:[S]}],pt:[{pt:[S]}],pr:[{pr:[S]}],pb:[{pb:[S]}],pl:[{pl:[S]}],m:[{m:[b]}],mx:[{mx:[b]}],my:[{my:[b]}],ms:[{ms:[b]}],me:[{me:[b]}],mt:[{mt:[b]}],mr:[{mr:[b]}],mb:[{mb:[b]}],ml:[{ml:[b]}],"space-x":[{"space-x":[k]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[k]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",St,e]}],"min-w":[{"min-w":[St,e,"min","max","fit"]}],"max-w":[{"max-w":[St,e,"none","full","min","max","fit","prose",{screen:[ls]},ls]}],h:[{h:[St,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[St,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[St,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[St,e,"auto","min","max","fit"]}],"font-size":[{text:["base",ls,cs]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",bS]}],"font-family":[{font:[qh]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",St]}],"line-clamp":[{"line-clamp":["none",ud,bS]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",So,St]}],"list-image":[{"list-image":["none",St]}],"list-style-type":[{list:["none","disc","decimal",St]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[n]}],"placeholder-opacity":[{"placeholder-opacity":[C]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[n]}],"text-opacity":[{"text-opacity":[C]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ie(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",So,cs]}],"underline-offset":[{"underline-offset":["auto",So,St]}],"text-decoration-color":[{decoration:[n]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:j()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",St]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",St]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[C]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...F(),hK]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",dK]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},pK]}],"bg-color":[{bg:[n]}],"gradient-from-pos":[{from:[v]}],"gradient-via-pos":[{via:[v]}],"gradient-to-pos":[{to:[v]}],"gradient-from":[{from:[g]}],"gradient-via":[{via:[g]}],"gradient-to":[{to:[g]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[C]}],"border-style":[{border:[...ie(),"hidden"]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[C]}],"divide-style":[{divide:ie()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...ie()]}],"outline-offset":[{"outline-offset":[So,St]}],"outline-w":[{outline:[So,cs]}],"outline-color":[{outline:[n]}],"ring-w":[{ring:J()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[n]}],"ring-opacity":[{"ring-opacity":[C]}],"ring-offset-w":[{"ring-offset":[So,cs]}],"ring-offset-color":[{"ring-offset":[n]}],shadow:[{shadow:["","inner","none",ls,mK]}],"shadow-color":[{shadow:[qh]}],opacity:[{opacity:[C]}],"mix-blend":[{"mix-blend":[...U(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":U()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[r]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",ls,St]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[h]}],invert:[{invert:[f]}],saturate:[{saturate:[E]}],sepia:[{sepia:[A]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[h]}],"backdrop-invert":[{"backdrop-invert":[f]}],"backdrop-opacity":[{"backdrop-opacity":[C]}],"backdrop-saturate":[{"backdrop-saturate":[E]}],"backdrop-sepia":[{"backdrop-sepia":[A]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",St]}],duration:[{duration:Z()}],ease:[{ease:["linear","in","out","in-out",St]}],delay:[{delay:Z()}],animate:[{animate:["none","spin","ping","pulse","bounce",St]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[T]}],"scale-x":[{"scale-x":[T]}],"scale-y":[{"scale-y":[T]}],rotate:[{rotate:[Kh,St]}],"translate-x":[{"translate-x":[x]}],"translate-y":[{"translate-y":[x]}],"skew-x":[{"skew-x":[I]}],"skew-y":[{"skew-y":[I]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",St]}],accent:[{accent:["auto",n]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",St]}],"caret-color":[{caret:[n]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":j()}],"scroll-mx":[{"scroll-mx":j()}],"scroll-my":[{"scroll-my":j()}],"scroll-ms":[{"scroll-ms":j()}],"scroll-me":[{"scroll-me":j()}],"scroll-mt":[{"scroll-mt":j()}],"scroll-mr":[{"scroll-mr":j()}],"scroll-mb":[{"scroll-mb":j()}],"scroll-ml":[{"scroll-ml":j()}],"scroll-p":[{"scroll-p":j()}],"scroll-px":[{"scroll-px":j()}],"scroll-py":[{"scroll-py":j()}],"scroll-ps":[{"scroll-ps":j()}],"scroll-pe":[{"scroll-pe":j()}],"scroll-pt":[{"scroll-pt":j()}],"scroll-pr":[{"scroll-pr":j()}],"scroll-pb":[{"scroll-pb":j()}],"scroll-pl":[{"scroll-pl":j()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",St]}],fill:[{fill:[n,"none"]}],"stroke-w":[{stroke:[So,cs,bS]}],stroke:[{stroke:[n,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},CK=tK(yK);function ke(...n){return CK(X(n))}const Jp="overflow-hidden",Jo="backdrop-blur-2xl backdrop-saturate-200",GT="bg-white/70 dark:bg-slate-800/70",Ea=X(Jp,Jo,GT),SK=X(Jp,Jo),wK=X(Jo,GT),EK="bg-acrylic-default-fallback-light/[98] dark:bg-acrylic-default-fallback-dark/[98]",TK="dark:bg-white/70  bg-slate-800/70",IK=X(Jp,Jo,TK);X(Jo,GT);const fL="bg-accent-100/60 dark:bg-slate-800/50",AK=X(Jo,fL),Ms=X(Jp,Jo,fL),kK="bg-acrylic-thin-fallback-light/95 dark:bg-acrylic-thin-fallback-dark/[92]",pL="dark:bg-accent-900/60 bg-slate-800/50";X(Jo,pL);const xK=X(Jp,Jo,pL),lp="relative flex items-center",ta="text-foreground-800 fill-foreground-800 active:text-foreground-600 active:fill-foreground-600 dark:active:text-foreground-650 dark:active:fill-foreground-650",q_="text-slate-200 fill-slate-200 active:text-slate-300 active:fill-slate-300 dark:text-stone-800 dark:fill-stone-800 dark:active:text-stone-600 dark:active:fill-stone-600",_K="text-foreground-250 fill-foreground-250 active:text-foreground-350 active:fill-foreground-350 dark:text-foreground-750 dark:fill-foreground-750 dark:active:text-foreground-650 dark:active:fill-foreground-650",MK="text-accent-550 fill-accent-550 active:text-accent-450/80 active:fill-accent-450/80 dark:text-accent-850 dark:fill-accent-850 dark:active:text-accent-700 dark:active:fill-accent-700",Wh="shadow-sm",W_="shadow-with-highlight-sm",RK="text-cocoa-550 safe-hover:text-caramel-450 dark:text-slate-300 dark:active:text-slate-200",PK="bg-white/70 safe-hover:bg-caramel-200 active:bg-caramel-200/20 dark:bg-slate-450/30 dark:safe-hover:bg-midnight-800 dark:active:bg-midnight-800/20",NK="border-[0.5px] border-transparent safe-hover:border-caramel-400 dark:safe-hover:border-midnight-350",OK="text-caramel-600 fill-caramel-600 active:text-caramel-400 active:fill-caramel-400 dark:text-slate-200 dark:fill-text-slate-200 dark:active:text-slate-100 dark:active:fill-slate-100",LK="bg-caramel-200 safe-hover:bg-caramel-300 active:bg-caramel-300 dark:bg-slate-650 dark:safe-hover:bg-slate-400 dark:active:bg-slate-400",yS="bg-transparent safe-hover:bg-white/50 active:bg-white/35 dark:safe-hover:bg-black/30 dark:active:bg-black/20",nl={default:`${ta} ${W_} bg-white/70 safe-hover:bg-white active:bg-white/60 dark:bg-slate-450/30 dark:safe-hover:bg-slate-450/40 dark:active:bg-slate-450/20`,strong:`${_K} ${Wh} bg-stone-800 safe-hover:bg-black active:bg-stone-750 dark:bg-slate-600 dark:safe-hover:bg-slate-550 dark:active:bg-slate-600/80`,accent:`${MK} bg-accent-250 safe-hover:bg-accent-300 active:bg-accent-200 dark:bg-accent-550 dark:safe-hover:bg-accent-450 dark:active:bg-accent-600/80`,"overlay-bright":`${ta} bg-white/40 safe-hover:bg-white/70 active:bg-white/30 dark:bg-white/8 dark:safe-hover:bg-white/10 dark:active:bg-white/5`,"overlay-bright-inverted":`${ta} bg-white/40 safe-hover:bg-white/70 active:bg-white/30 dark:bg-black/35 dark:safe-hover:bg-black/60 dark:active:bg-black/25`,"overlay-dimmed":`${ta} bg-black/8 safe-hover:bg-black/10 active:bg-black/5 dark:bg-black/35 dark:safe-hover:bg-black/60 dark:active:bg-black/25`,"overlay-dimmed-inverted":`${ta} bg-black/8 safe-hover:bg-black/10 active:bg-black/5 dark:bg-white/8 dark:safe-hover:bg-white/10 dark:active:bg-white/5`,"subtle-bright":`${ta} bg-transparent safe-hover:bg-white/50 active:bg-white/35 dark:safe-hover:bg-white/8 dark:active:bg-white/5`,"subtle-bright-inverted":`${ta} ${yS}`,"subtle-dimmed":`${ta} bg-transparent safe-hover:bg-black/5 active:bg-black/3 dark:safe-hover:bg-black/30 dark:active:bg-black/20`,"subtle-dimmed-inverted":`${ta} bg-transparent safe-hover:bg-black/5 active:bg-black/3 dark:safe-hover:bg-white/8 dark:active:bg-white/5`,acrylic:`${ta} ${Wh} ${yS}`,"acrylic-inverted":`${q_} ${Wh} bg-transparent dark:safe-hover:bg-white/50 dark:active:bg-white/35 safe-hover:bg-black/30 active:bg-black/20`,"acrylic-thin":`${ta} ${Wh} ${yS}`,"acrylic-thin-inverted":`${q_} ${Wh} bg-transparent dark:safe-hover:bg-white/50 dark:active:bg-white/35 safe-hover:bg-black/30 active:bg-black/20`,chip:`${RK} ${PK} ${W_} ${NK}`,alert:"bg-system-red-600 safe-hover:bg-system-red-650 active:bg-system-red-550","composer-selected":`${OK} ${LK}`},mL={acrylic:`${Ea}`,"acrylic-inverted":`${IK}`,"acrylic-thin":`${Ms}`,"acrylic-thin-inverted":`${xK}`};function DK(n){return n in mL}const jK={start:"justify-start",center:"justify-center",end:"justify-end"},KT={"28-xxs":"text-xs","32-xs":"text-xs","36-sm":"text-xs","40-base":"text-sm","48-lg":"text-base","56-xl":"text-base","64-xxl":"text-base"},Cs={"28-xxs":"gap-x-1.5","32-xs":"gap-x-1.5","36-sm":"gap-x-1.5","40-base":"gap-x-2","48-lg":"gap-x-3","56-xl":"gap-x-3","64-xxl":"gap-x-3"},qT={"28-xxs":`min-h-7 min-w-8 px-3 py-1 ${Cs["28-xxs"]}`,"32-xs":`min-h-8 min-w-8 px-2.5 py-1 ${Cs["32-xs"]}`,"36-sm":`min-h-9 min-w-9 px-2.5 py-1 ${Cs["36-sm"]}`,"40-base":`min-h-10 min-w-10 px-3 py-2 ${Cs["40-base"]}`,"48-lg":`min-h-12 min-w-12 px-3 py-2.5 ${Cs["48-lg"]}`,"56-xl":`min-h-14 min-w-14 px-4 py-3.5 ${Cs["56-xl"]}`,"64-xxl":`min-h-16 min-w-16 p-4 ${Cs["64-xxl"]}`},UK={"28-xxs":"size-7","32-xs":"size-8","36-sm":"size-9","40-base":"size-10","48-lg":"size-12","56-xl":"size-14","64-xxl":"size-16"},qw={"28-xxs":"rounded-lg before:rounded-lg","32-xs":"rounded-lg before:rounded-lg","36-sm":"rounded-xl before:rounded-xl","40-base":"rounded-xl before:rounded-xl","48-lg":"rounded-3xl before:rounded-3xl","56-xl":"rounded-4xl before:rounded-4xl","64-xxl":"rounded-4xl before:rounded-4xl"},FK={none:"",regular:"border border-solid border-stone-350 dark:border-slate-600",strong:"border border-solid border-2 border-stroke-750"},Y_="rounded-full before:rounded-full",BK="opacity-40 pointer-events-none",fy="before:absolute before:inset-0 before:pointer-events-none before:border before:border-transparent before:contrast-more:border-2 outline-2 outline-offset-1 focus-visible:z-[1] focus-visible:outline focus-visible:outline-stroke-900",Ee=m.forwardRef((n,e)=>{const{children:t,onClick:r,onFocus:i,onBlur:a,onKeyDown:o,onKeyUp:s,onMouseEnter:c,onMouseLeave:u,href:h,className:f,title:p,variant:g="rect",alignment:v="center",color:y="default",outline:b="none",size:C="40-base",disabled:S,id:E,role:T,testId:A,tabIndex:I,spatialNavigationAutofocus:k=!1,"aria-controls":x,"aria-expanded":_,"aria-haspopup":R,"aria-pressed":z,"aria-label":j,"aria-selected":J,onPointerDown:D}=n,F=g==="circle"||g==="square",ie=g==="circle"||g==="pill",U=ke(lp,nl[y],KT[C],jK[v],F?UK[C]:qT[C],ie?Y_:qw[C],fy,S&&BK,FK[b],f);let W=t;if(DK(y)){const Z=ke(mL[y],ie?Y_:qw[C]);W=d.jsxs(d.Fragment,{children:[d.jsx("div",{className:ke("absolute inset-0",Z)}),d.jsx("div",{className:`relative ${lp} ${Cs[C]}`,children:t})]})}const{refCallback:ue,focusable:te}=ih({autoRestoreFocus:!0,forceFocus:!0},e);return h!==void 0?d.jsx(to,{id:E,onPointerDown:D,"aria-controls":x,"aria-expanded":_,"aria-haspopup":R,href:h,ref:te.ref,onClick:r,title:p,className:U,"data-testid":A,"aria-label":j,"aria-selected":J,children:W}):d.jsx("button",{onPointerDown:D,ref:ue,id:E,"aria-controls":x,"aria-expanded":_,"aria-haspopup":R,"aria-pressed":z,"aria-selected":J,type:"button",className:U,title:p,role:T,disabled:S,onClick:r,onFocus:i,onBlur:a,onKeyDown:o,onKeyUp:s,onMouseEnter:c,onMouseLeave:u,"data-testid":A,"data-spatial-navigation-autofocus":k,"aria-label":j,"data-spatial-focus-key":te.focusKey,tabIndex:I,children:W})});Ee.displayName="Button";function HK({reason:n,onReload:e}){const{t}=Ce();return d.jsxs(d.Fragment,{children:[d.jsx("h1",{className:"pb-3 text-lg",children:t("authentication.accountChanged")}),d.jsx("p",{className:"pb-7",children:t(n==="login"?"authentication.signedInOtherTab":"authentication.signedOutOtherTab")}),d.jsx(Ee,{onClick:e,title:t("authentication.reloadToContinue"),variant:"pill",size:"48-lg",className:"w-full",children:t("authentication.reloadToContinue")})]})}const WT=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",...n},m.createElement("path",{fill:"currentColor",d:"M15.144 5.885c.62-.777 1.042-1.82.931-2.885-.909.045-2.018.6-2.66 1.377-.576.665-1.087 1.752-.954 2.772 1.02.089 2.04-.51 2.683-1.264ZM16.064 7.349c-1.482-.089-2.742.84-3.45.84-.707 0-1.79-.796-2.963-.774-1.525.022-2.94.884-3.714 2.256-1.592 2.744-.42 6.814 1.128 9.049.752 1.105 1.658 2.323 2.852 2.279 1.128-.044 1.57-.73 2.94-.73 1.371 0 1.77.73 2.963.708 1.238-.022 2.013-1.106 2.764-2.213.863-1.26 1.216-2.477 1.238-2.544-.022-.022-2.388-.93-2.41-3.65-.022-2.28 1.858-3.363 1.946-3.43-1.061-1.57-2.72-1.747-3.294-1.791Z"})),r3e=Object.freeze(Object.defineProperty({__proto__:null,default:WT},Symbol.toStringTag,{value:"Module"})),YT=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 25 24",...n},m.createElement("g",{clipPath:"url(#a)"},m.createElement("path",{fill:"#4285F4",d:"M20.5 12.2a8 8 0 0 0-.2-1.8h-8.1v3.3H17c-.1.8-.7 2-1.8 3l2.5 2 .2.1a9 9 0 0 0 2.6-6.6Z"}),m.createElement("path",{fill:"#34A853",d:"M12.2 21c2.3 0 4.3-.8 5.7-2.2l-2.7-2.2a5.2 5.2 0 0 1-8-2.8l-2.7 2.1v.1c1.4 3 4.3 5 7.7 5Z"}),m.createElement("path",{fill:"#FBBC05",d:"M7.2 13.8a5.7 5.7 0 0 1 0-3.6L4.5 7.8a9.2 9.2 0 0 0 0 8.1l2.7-2.2Z"}),m.createElement("path",{fill:"#EB4335",d:"M12.2 6.5c1.6 0 2.7.7 3.3 1.3L18 5.4A8.2 8.2 0 0 0 12.2 3C8.8 3 5.9 5 4.4 8l2.8 2.2a5.3 5.3 0 0 1 5-3.7Z"})),m.createElement("defs",null,m.createElement("clipPath",{id:"a"},m.createElement("path",{fill:"#fff",d:"M3.5 3h17v18h-17z"})))),i3e=Object.freeze(Object.defineProperty({__proto__:null,default:YT},Symbol.toStringTag,{value:"Module"})),py=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 25 24",...n},m.createElement("path",{fill:"#F25022",d:"M12.05 3H3.5v8.55h8.55V3Z"}),m.createElement("path",{fill:"#7FBA00",d:"M21.5 3h-8.55v8.55h8.55V3Z"}),m.createElement("path",{fill:"#00A4EF",d:"M12.05 12.45H3.5V21h8.55v-8.55Z"}),m.createElement("path",{fill:"#FFB900",d:"M21.5 12.45h-8.55V21h8.55v-8.55Z"})),a3e=Object.freeze(Object.defineProperty({__proto__:null,default:py},Symbol.toStringTag,{value:"Module"})),gL="140e65af-45d1-4427-bf08-3e7295db6836/ChatAI.ReadWrite",Q_={auth:{clientId:"14638111-3389-403d-b206-a6a71d9f8f16",authority:"https://login.microsoftonline.com/common",navigateToLoginRequestUrl:!1},system:{allowNativeBroker:!1},cache:{cacheLocation:"localStorage"}},QT={scopes:[gL],extraQueryParameters:{lw:"1",coa:"1",nopa:"2",fl:"easi2_nowld",cobrandid:"8c0b039e-5a73-4399-9b56-7e237be2cd06"},prompt:"select_account",redirectUri:typeof window<"u"?window.location.origin:void 0},$K={scopes:[gL],prompt:"none",authority:"https://login.microsoftonline.com/consumers",redirectUri:typeof window<"u"?window.location.origin:void 0},J_={scopes:["User.Read"]},zK={scopes:["OneDrive.ReadWrite"],authority:"https://login.microsoftonline.com/consumers"},JT={graphMeApiSuffix:"/me",graphMeImageApiSuffix:"/me/photo/$value",graphMeLicenseDetails:"/me/licenseDetails"},Z_={appName:"copilot_studio",enableMATS:!0,appVersion:"0.0.0"},VK="IalDS3vRtEI5X0zvsmGG7zJP9UrHTcei",GK="auth.copilot.microsoft.com",vL="https://copilot.microsoft.com",KK={clientId:VK,domain:GK,cacheLocation:"localstorage",useRefreshTokens:!0,useRefreshTokensFallback:!0},bL="openid profile email offline_access ChatAI.ReadWrite",yL=typeof window<"u"?window.location.origin:void 0,up={authorizationParams:{audience:vL,scope:bL,redirect_uri:yL}},qK={authorizationParams:{audience:vL,scope:bL,redirect_uri:yL,prompt:"select_account"}},Ww="cp-pro";function WK(n){switch(n){case"login":return QT;case"graph":return J_;case"oneDrive":return zK;default:return J_}}const YK={actAsBroker:!0,preferredInteractionType:"redirect"};function xl(){return!!me.instance().config().enableAuth0}var my=_z();const Rs=()=>{},pn=Rs(),CS=Object,He=n=>n===pn,Br=n=>typeof n=="function",wi=(n,e)=>({...n,...e}),QK=n=>Br(n.then),qm=new WeakMap;let JK=0;const dp=n=>{const e=typeof n,t=n&&n.constructor,r=t==Date;let i,a;if(CS(n)===n&&!r&&t!=RegExp){if(i=qm.get(n),i)return i;if(i=++JK+"~",qm.set(n,i),t==Array){for(i="@",a=0;a<n.length;a++)i+=dp(n[a])+",";qm.set(n,i)}if(t==CS){i="#";const o=CS.keys(n).sort();for(;!He(a=o.pop());)He(n[a])||(i+=a+":"+dp(n[a])+",");qm.set(n,i)}}else i=r?n.toJSON():e=="symbol"?n.toString():e=="string"?JSON.stringify(n):""+n;return i},Di=new WeakMap,SS={},Wm={},ZT="undefined",gy=typeof window!=ZT,Yw=typeof document!=ZT,ZK=()=>gy&&typeof window.requestAnimationFrame!=ZT,Ba=(n,e)=>{const t=Di.get(n);return[()=>!He(e)&&n.get(e)||SS,r=>{if(!He(e)){const i=n.get(e);e in Wm||(Wm[e]=i),t[5](e,wi(i,r),i||SS)}},t[6],()=>!He(e)&&e in Wm?Wm[e]:!He(e)&&n.get(e)||SS]};let Qw=!0;const XK=()=>Qw,[Jw,Zw]=gy&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[Rs,Rs],eq=()=>{const n=Yw&&document.visibilityState;return He(n)||n!=="hidden"},tq=n=>(Yw&&document.addEventListener("visibilitychange",n),Jw("focus",n),()=>{Yw&&document.removeEventListener("visibilitychange",n),Zw("focus",n)}),nq=n=>{const e=()=>{Qw=!0,n()},t=()=>{Qw=!1};return Jw("online",e),Jw("offline",t),()=>{Zw("online",e),Zw("offline",t)}},rq={isOnline:XK,isVisible:eq},iq={initFocus:tq,initReconnect:nq},rl=!kl.useId,Fo=!gy||"Deno"in window,XT=n=>ZK()?window.requestAnimationFrame(n):setTimeout(n,1),Hi=Fo?m.useEffect:m.useLayoutEffect,wS=typeof navigator<"u"&&navigator.connection,X_=!Fo&&wS&&(["slow-2g","2g"].includes(wS.effectiveType)||wS.saveData),Bo=n=>{if(Br(n))try{n=n()}catch{n=""}const e=n;return n=typeof n=="string"?n:(Array.isArray(n)?n.length:n)?dp(n):"",[n,e]};let aq=0;const il=()=>++aq,CL=0,SL=1,wL=2,oq=3;var Hr={__proto__:null,ERROR_REVALIDATE_EVENT:oq,FOCUS_EVENT:CL,MUTATE_EVENT:wL,RECONNECT_EVENT:SL};async function vy(...n){const[e,t,r,i]=n,a=wi({populateCache:!0,throwOnError:!0},typeof i=="boolean"?{revalidate:i}:i||{});let o=a.populateCache;const s=a.rollbackOnError;let c=a.optimisticData;const u=p=>typeof s=="function"?s(p):s!==!1,h=a.throwOnError;if(Br(t)){const p=t,g=[],v=e.keys();for(const y of v)!/^\$(inf|sub)\$/.test(y)&&p(e.get(y)._k)&&g.push(y);return Promise.all(g.map(f))}return f(t);async function f(p){const[g]=Bo(p);if(!g)return;const[v,y]=Ba(e,g),[b,C,S,E]=Di.get(e),T=()=>{const J=b[g];return(Br(a.revalidate)?a.revalidate(v().data,p):a.revalidate!==!1)&&(delete S[g],delete E[g],J&&J[0])?J[0](wL).then(()=>v().data):v().data};if(n.length<3)return T();let A=r,I;const k=il();C[g]=[k,0];const x=!He(c),_=v(),R=_.data,z=_._c,j=He(z)?R:z;if(x&&(c=Br(c)?c(j,R):c,y({data:c,_c:j})),Br(A))try{A=A(j)}catch(J){I=J}if(A&&QK(A))if(A=await A.catch(J=>{I=J}),k!==C[g][0]){if(I)throw I;return A}else I&&x&&u(I)&&(o=!0,y({data:j,_c:pn}));if(o&&!I)if(Br(o)){const J=o(A,j);y({data:J,error:pn,_c:pn})}else y({data:A,error:pn,_c:pn});if(C[g][1]=il(),Promise.resolve(T()).then(()=>{y({_c:pn})}),I){if(h)throw I;return}return A}}const eM=(n,e)=>{for(const t in n)n[t][0]&&n[t][0](e)},sq=(n,e)=>{if(!Di.has(n)){const t=wi(iq,e),r={},i=vy.bind(pn,n);let a=Rs;const o={},s=(h,f)=>{const p=o[h]||[];return o[h]=p,p.push(f),()=>p.splice(p.indexOf(f),1)},c=(h,f,p)=>{n.set(h,f);const g=o[h];if(g)for(const v of g)v(f,p)},u=()=>{if(!Di.has(n)&&(Di.set(n,[r,{},{},{},i,c,s]),!Fo)){const h=t.initFocus(setTimeout.bind(pn,eM.bind(pn,r,CL))),f=t.initReconnect(setTimeout.bind(pn,eM.bind(pn,r,SL)));a=()=>{h&&h(),f&&f(),Di.delete(n)}}};return u(),[n,i,u,a]}return[n,Di.get(n)[4]]},cq=(n,e,t,r,i)=>{const a=t.errorRetryCount,o=i.retryCount,s=~~((Math.random()+.5)*(1<<(o<8?o:8)))*t.errorRetryInterval;!He(a)&&o>a||setTimeout(r,s,i)},lq=(n,e)=>dp(n)==dp(e),[eI,uq]=sq(new Map),dq=wi({onLoadingSlow:Rs,onSuccess:Rs,onError:Rs,onErrorRetry:cq,onDiscarded:Rs,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:X_?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:X_?5e3:3e3,compare:lq,isPaused:()=>!1,cache:eI,mutate:uq,fallback:{}},rq),hq=(n,e)=>{const t=wi(n,e);if(e){const{use:r,fallback:i}=n,{use:a,fallback:o}=e;r&&a&&(t.use=r.concat(a)),i&&o&&(t.fallback=wi(i,o))}return t},fq=m.createContext({}),EL="$inf$",TL=gy&&window.__SWR_DEVTOOLS_USE__,pq=TL?window.__SWR_DEVTOOLS_USE__:[],mq=()=>{TL&&(window.__SWR_DEVTOOLS_REACT__=kl)},IL=n=>Br(n[1])?[n[0],n[1],n[2]||{}]:[n[0],null,(n[1]===null?n[2]:n[1])||{}],tI=()=>wi(dq,m.useContext(fq)),gq=n=>(e,t,r)=>n(e,t&&((...a)=>{const[o]=Bo(e),[,,,s]=Di.get(eI);if(o.startsWith(EL))return t(...a);const c=s[o];return He(c)?t(...a):(delete s[o],c)}),r),vq=pq.concat(gq),nI=n=>function(...t){const r=tI(),[i,a,o]=IL(t),s=hq(r,o);let c=n;const{use:u}=s,h=(u||[]).concat(vq);for(let f=h.length;f--;)c=h[f](c);return c(i,a||s.fetcher||null,s)},rI=(n,e,t)=>{const r=e[n]||(e[n]=[]);return r.push(t),()=>{const i=r.indexOf(t);i>=0&&(r[i]=r[r.length-1],r.pop())}},AL=(n,e)=>(...t)=>{const[r,i,a]=IL(t),o=(a.use||[]).concat(e);return n(r,i,{...a,use:o})};mq();const tM=kl.use||(n=>{if(n.status==="pending")throw n;if(n.status==="fulfilled")return n.value;throw n.status==="rejected"?n.reason:(n.status="pending",n.then(e=>{n.status="fulfilled",n.value=e},e=>{n.status="rejected",n.reason=e}),n)}),ES={dedupe:!0},bq=(n,e,t)=>{const{cache:r,compare:i,suspense:a,fallbackData:o,revalidateOnMount:s,revalidateIfStale:c,refreshInterval:u,refreshWhenHidden:h,refreshWhenOffline:f,keepPreviousData:p}=t,[g,v,y,b]=Di.get(r),[C,S]=Bo(n),E=m.useRef(!1),T=m.useRef(!1),A=m.useRef(C),I=m.useRef(e),k=m.useRef(t),x=()=>k.current,_=()=>x().isVisible()&&x().isOnline(),[R,z,j,J]=Ba(r,C),D=m.useRef({}).current,F=He(o)?t.fallback[C]:o,ie=(M,Y)=>{for(const Se in D){const P=Se;if(P==="data"){if(!i(M[P],Y[P])&&(!He(M[P])||!i(ce,Y[P])))return!1}else if(Y[P]!==M[P])return!1}return!0},U=m.useMemo(()=>{const M=!C||!e?!1:He(s)?x().isPaused()||a?!1:He(c)?!0:c:s,Y=q=>{const Te=wi(q);return delete Te._k,M?{isValidating:!0,isLoading:!0,...Te}:Te},Se=R(),P=J(),ne=Y(Se),ye=Se===P?ne:Y(P);let ae=ne;return[()=>{const q=Y(R());return ie(q,ae)?(ae.data=q.data,ae.isLoading=q.isLoading,ae.isValidating=q.isValidating,ae.error=q.error,ae):(ae=q,q)},()=>ye]},[r,C]),W=my.useSyncExternalStore(m.useCallback(M=>j(C,(Y,Se)=>{ie(Se,Y)||M()}),[r,C]),U[0],U[1]),ue=!E.current,te=g[C]&&g[C].length>0,Z=W.data,Q=He(Z)?F:Z,Ie=W.error,Ve=m.useRef(Q),ce=p?He(Z)?Ve.current:Z:Q,le=te&&!He(Ie)?!1:ue&&!He(s)?s:x().isPaused()?!1:a?He(Q)?!1:c:He(Q)||c,De=!!(C&&e&&ue&&le),We=He(W.isValidating)?De:W.isValidating,be=He(W.isLoading)?De:W.isLoading,Me=m.useCallback(async M=>{const Y=I.current;if(!C||!Y||T.current||x().isPaused())return!1;let Se,P,ne=!0;const ye=M||{},ae=!y[C]||!ye.dedupe,q=()=>rl?!T.current&&C===A.current&&E.current:C===A.current,Te={isValidating:!1,isLoading:!1},ze=()=>{z(Te)},ht=()=>{const Ye=y[C];Ye&&Ye[1]===P&&delete y[C]},vt={isValidating:!0};He(R().data)&&(vt.isLoading=!0);try{if(ae&&(z(vt),t.loadingTimeout&&He(R().data)&&setTimeout(()=>{ne&&q()&&x().onLoadingSlow(C,t)},t.loadingTimeout),y[C]=[Y(S),il()]),[Se,P]=y[C],Se=await Se,ae&&setTimeout(ht,t.dedupingInterval),!y[C]||y[C][1]!==P)return ae&&q()&&x().onDiscarded(C),!1;Te.error=pn;const Ye=v[C];if(!He(Ye)&&(P<=Ye[0]||P<=Ye[1]||Ye[1]===0))return ze(),ae&&q()&&x().onDiscarded(C),!1;const st=R().data;Te.data=i(st,Se)?st:Se,ae&&q()&&x().onSuccess(Se,C,t)}catch(Ye){ht();const st=x(),{shouldRetryOnError:Ot}=st;st.isPaused()||(Te.error=Ye,ae&&q()&&(st.onError(Ye,C,st),(Ot===!0||Br(Ot)&&Ot(Ye))&&(!x().revalidateOnFocus||!x().revalidateOnReconnect||_())&&st.onErrorRetry(Ye,C,st,Yt=>{const on=g[C];on&&on[0]&&on[0](Hr.ERROR_REVALIDATE_EVENT,Yt)},{retryCount:(ye.retryCount||0)+1,dedupe:!0})))}return ne=!1,ze(),!0},[C,r]),xe=m.useCallback((...M)=>vy(r,A.current,...M),[]);if(Hi(()=>{I.current=e,k.current=t,He(Z)||(Ve.current=Z)}),Hi(()=>{if(!C)return;const M=Me.bind(pn,ES);let Y=0;const P=rI(C,g,(ne,ye={})=>{if(ne==Hr.FOCUS_EVENT){const ae=Date.now();x().revalidateOnFocus&&ae>Y&&_()&&(Y=ae+x().focusThrottleInterval,M())}else if(ne==Hr.RECONNECT_EVENT)x().revalidateOnReconnect&&_()&&M();else{if(ne==Hr.MUTATE_EVENT)return Me();if(ne==Hr.ERROR_REVALIDATE_EVENT)return Me(ye)}});return T.current=!1,A.current=C,E.current=!0,z({_k:S}),le&&(He(Q)||Fo?M():XT(M)),()=>{T.current=!0,P()}},[C]),Hi(()=>{let M;function Y(){const P=Br(u)?u(R().data):u;P&&M!==-1&&(M=setTimeout(Se,P))}function Se(){!R().error&&(h||x().isVisible())&&(f||x().isOnline())?Me(ES).then(Y):Y()}return Y(),()=>{M&&(clearTimeout(M),M=-1)}},[u,h,f,C]),m.useDebugValue(ce),a&&He(Q)&&C){if(!rl&&Fo)throw new Error("Fallback data is required when using suspense in SSR.");I.current=e,k.current=t,T.current=!1;const M=b[C];if(!He(M)){const Y=xe(M);tM(Y)}if(He(Ie)){const Y=Me(ES);He(ce)||(Y.status="fulfilled",Y.value=!0),tM(Y)}else throw Ie}return{mutate:xe,get data(){return D.data=!0,ce},get error(){return D.error=!0,Ie},get isValidating(){return D.isValidating=!0,We},get isLoading(){return D.isLoading=!0,be}}},yq=nI(bq),nM=rl?n=>{n()}:kl.startTransition,Cq=n=>{const[,e]=m.useState({}),t=m.useRef(!1),r=m.useRef(n),i=m.useRef({data:!1,error:!1,isValidating:!1}),a=m.useCallback(o=>{let s=!1;const c=r.current;for(const u in o){const h=u;c[h]!==o[h]&&(c[h]=o[h],i.current[h]&&(s=!0))}s&&!t.current&&e({})},[]);return Hi(()=>(t.current=!1,()=>{t.current=!0})),[r,i.current,a]},Sq=()=>(n,e,t={})=>{const{mutate:r}=tI(),i=m.useRef(n),a=m.useRef(e),o=m.useRef(t),s=m.useRef(0),[c,u,h]=Cq({data:pn,error:pn,isMutating:!1}),f=c.current,p=m.useCallback(async(v,y)=>{const[b,C]=Bo(i.current);if(!a.current)throw new Error("Can’t trigger the mutation: missing fetcher.");if(!b)throw new Error("Can’t trigger the mutation: missing key.");const S=wi(wi({populateCache:!1,throwOnError:!0},o.current),y),E=il();s.current=E,h({isMutating:!0});try{const T=await r(b,a.current(C,{arg:v}),wi(S,{throwOnError:!0}));return s.current<=E&&(nM(()=>h({data:T,isMutating:!1,error:void 0})),S.onSuccess==null||S.onSuccess.call(S,T,b,S)),T}catch(T){if(s.current<=E&&(nM(()=>h({error:T,isMutating:!1})),S.onError==null||S.onError.call(S,T,b,S),S.throwOnError))throw T}},[]),g=m.useCallback(()=>{s.current=il(),h({data:pn,error:pn,isMutating:!1})},[]);return Hi(()=>{i.current=n,a.current=e,o.current=t}),{trigger:p,reset:g,get data(){return u.data=!0,f.data},get error(){return u.error=!0,f.error},get isMutating(){return u.isMutating=!0,f.isMutating}}},iI=AL(yq,Sq);var kL=Symbol.for("immer-nothing"),rM=Symbol.for("immer-draftable"),Kt=Symbol.for("immer-state");function ji(n,...e){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var Nd=Object.getPrototypeOf;function Od(n){return!!n&&!!n[Kt]}function Ho(n){var e;return n?xL(n)||Array.isArray(n)||!!n[rM]||!!((e=n.constructor)!=null&&e[rM])||yy(n)||Cy(n):!1}var wq=Object.prototype.constructor.toString();function xL(n){if(!n||typeof n!="object")return!1;const e=Nd(n);if(e===null)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===wq}function hp(n,e){by(n)===0?Reflect.ownKeys(n).forEach(t=>{e(t,n[t],n)}):n.forEach((t,r)=>e(r,t,n))}function by(n){const e=n[Kt];return e?e.type_:Array.isArray(n)?1:yy(n)?2:Cy(n)?3:0}function Xw(n,e){return by(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function _L(n,e,t){const r=by(n);r===2?n.set(e,t):r===3?n.add(t):n[e]=t}function Eq(n,e){return n===e?n!==0||1/n===1/e:n!==n&&e!==e}function yy(n){return n instanceof Map}function Cy(n){return n instanceof Set}function sr(n){return n.copy_||n.base_}function e1(n,e){if(yy(n))return new Map(n);if(Cy(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const t=xL(n);if(e===!0||e==="class_only"&&!t){const r=Object.getOwnPropertyDescriptors(n);delete r[Kt];let i=Reflect.ownKeys(r);for(let a=0;a<i.length;a++){const o=i[a],s=r[o];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(r[o]={configurable:!0,writable:!0,enumerable:s.enumerable,value:n[o]})}return Object.create(Nd(n),r)}else{const r=Nd(n);if(r!==null&&t)return{...n};const i=Object.create(r);return Object.assign(i,n)}}function aI(n,e=!1){return Sy(n)||Od(n)||!Ho(n)||(by(n)>1&&(n.set=n.add=n.clear=n.delete=Tq),Object.freeze(n),e&&Object.entries(n).forEach(([t,r])=>aI(r,!0))),n}function Tq(){ji(2)}function Sy(n){return Object.isFrozen(n)}var t1={};function al(n){const e=t1[n];return e||ji(0,n),e}function Iq(n,e){t1[n]||(t1[n]=e)}var fp;function kv(){return fp}function Aq(n,e){return{drafts_:[],parent_:n,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function iM(n,e){e&&(al("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=e)}function n1(n){r1(n),n.drafts_.forEach(kq),n.drafts_=null}function r1(n){n===fp&&(fp=n.parent_)}function aM(n){return fp=Aq(fp,n)}function kq(n){const e=n[Kt];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function oM(n,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return n!==void 0&&n!==t?(t[Kt].modified_&&(n1(e),ji(4)),Ho(n)&&(n=xv(e,n),e.parent_||_v(e,n)),e.patches_&&al("Patches").generateReplacementPatches_(t[Kt].base_,n,e.patches_,e.inversePatches_)):n=xv(e,t,[]),n1(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),n!==kL?n:void 0}function xv(n,e,t){if(Sy(e))return e;const r=e[Kt];if(!r)return hp(e,(i,a)=>sM(n,r,e,i,a,t)),e;if(r.scope_!==n)return e;if(!r.modified_)return _v(n,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const i=r.copy_;let a=i,o=!1;r.type_===3&&(a=new Set(i),i.clear(),o=!0),hp(a,(s,c)=>sM(n,r,i,s,c,t,o)),_v(n,i,!1),t&&n.patches_&&al("Patches").generatePatches_(r,t,n.patches_,n.inversePatches_)}return r.copy_}function sM(n,e,t,r,i,a,o){if(Od(i)){const s=a&&e&&e.type_!==3&&!Xw(e.assigned_,r)?a.concat(r):void 0,c=xv(n,i,s);if(_L(t,r,c),Od(c))n.canAutoFreeze_=!1;else return}else o&&t.add(i);if(Ho(i)&&!Sy(i)){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1)return;xv(n,i),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&Object.prototype.propertyIsEnumerable.call(t,r)&&_v(n,i)}}function _v(n,e,t=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&aI(e,t)}function xq(n,e){const t=Array.isArray(n),r={type_:t?1:0,scope_:e?e.scope_:kv(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,a=oI;t&&(i=[r],a=pp);const{revoke:o,proxy:s}=Proxy.revocable(i,a);return r.draft_=s,r.revoke_=o,s}var oI={get(n,e){if(e===Kt)return n;const t=sr(n);if(!Xw(t,e))return _q(n,t,e);const r=t[e];return n.finalized_||!Ho(r)?r:r===TS(n.base_,e)?(IS(n),n.copy_[e]=mp(r,n)):r},has(n,e){return e in sr(n)},ownKeys(n){return Reflect.ownKeys(sr(n))},set(n,e,t){const r=ML(sr(n),e);if(r!=null&&r.set)return r.set.call(n.draft_,t),!0;if(!n.modified_){const i=TS(sr(n),e),a=i==null?void 0:i[Kt];if(a&&a.base_===t)return n.copy_[e]=t,n.assigned_[e]=!1,!0;if(Eq(t,i)&&(t!==void 0||Xw(n.base_,e)))return!0;IS(n),ko(n)}return n.copy_[e]===t&&(t!==void 0||e in n.copy_)||Number.isNaN(t)&&Number.isNaN(n.copy_[e])||(n.copy_[e]=t,n.assigned_[e]=!0),!0},deleteProperty(n,e){return TS(n.base_,e)!==void 0||e in n.base_?(n.assigned_[e]=!1,IS(n),ko(n)):delete n.assigned_[e],n.copy_&&delete n.copy_[e],!0},getOwnPropertyDescriptor(n,e){const t=sr(n),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:n.type_!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty(){ji(11)},getPrototypeOf(n){return Nd(n.base_)},setPrototypeOf(){ji(12)}},pp={};hp(oI,(n,e)=>{pp[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});pp.deleteProperty=function(n,e){return pp.set.call(this,n,e,void 0)};pp.set=function(n,e,t){return oI.set.call(this,n[0],e,t,n[0])};function TS(n,e){const t=n[Kt];return(t?sr(t):n)[e]}function _q(n,e,t){var i;const r=ML(e,t);return r?"value"in r?r.value:(i=r.get)==null?void 0:i.call(n.draft_):void 0}function ML(n,e){if(!(e in n))return;let t=Nd(n);for(;t;){const r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=Nd(t)}}function ko(n){n.modified_||(n.modified_=!0,n.parent_&&ko(n.parent_))}function IS(n){n.copy_||(n.copy_=e1(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var Mq=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if(typeof e=="function"&&typeof t!="function"){const a=t;t=e;const o=this;return function(c=a,...u){return o.produce(c,h=>t.call(this,h,...u))}}typeof t!="function"&&ji(6),r!==void 0&&typeof r!="function"&&ji(7);let i;if(Ho(e)){const a=aM(this),o=mp(e,void 0);let s=!0;try{i=t(o),s=!1}finally{s?n1(a):r1(a)}return iM(a,r),oM(i,a)}else if(!e||typeof e!="object"){if(i=t(e),i===void 0&&(i=e),i===kL&&(i=void 0),this.autoFreeze_&&aI(i,!0),r){const a=[],o=[];al("Patches").generateReplacementPatches_(e,i,a,o),r(a,o)}return i}else ji(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(o,...s)=>this.produceWithPatches(o,c=>e(c,...s));let r,i;return[this.produce(e,t,(o,s)=>{r=o,i=s}),r,i]},typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof(n==null?void 0:n.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy)}createDraft(n){Ho(n)||ji(8),Od(n)&&(n=Rq(n));const e=aM(this),t=mp(n,void 0);return t[Kt].isManual_=!0,r1(e),t}finishDraft(n,e){const t=n&&n[Kt];(!t||!t.isManual_)&&ji(9);const{scope_:r}=t;return iM(r,e),oM(void 0,r)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}applyPatches(n,e){let t;for(t=e.length-1;t>=0;t--){const i=e[t];if(i.path.length===0&&i.op==="replace"){n=i.value;break}}t>-1&&(e=e.slice(t+1));const r=al("Patches").applyPatches_;return Od(n)?r(n,e):this.produce(n,i=>r(i,e))}};function mp(n,e){const t=yy(n)?al("MapSet").proxyMap_(n,e):Cy(n)?al("MapSet").proxySet_(n,e):xq(n,e);return(e?e.scope_:kv()).drafts_.push(t),t}function Rq(n){return Od(n)||ji(10,n),RL(n)}function RL(n){if(!Ho(n)||Sy(n))return n;const e=n[Kt];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=e1(n,e.scope_.immer_.useStrictShallowCopy_)}else t=e1(n,!0);return hp(t,(r,i)=>{_L(t,r,RL(i))}),e&&(e.finalized_=!1),t}function Pq(){class n extends Map{constructor(c,u){super(),this[Kt]={type_:2,parent_:u,scope_:u?u.scope_:kv(),modified_:!1,finalized_:!1,copy_:void 0,assigned_:void 0,base_:c,draft_:this,isManual_:!1,revoked_:!1}}get size(){return sr(this[Kt]).size}has(c){return sr(this[Kt]).has(c)}set(c,u){const h=this[Kt];return o(h),(!sr(h).has(c)||sr(h).get(c)!==u)&&(t(h),ko(h),h.assigned_.set(c,!0),h.copy_.set(c,u),h.assigned_.set(c,!0)),this}delete(c){if(!this.has(c))return!1;const u=this[Kt];return o(u),t(u),ko(u),u.base_.has(c)?u.assigned_.set(c,!1):u.assigned_.delete(c),u.copy_.delete(c),!0}clear(){const c=this[Kt];o(c),sr(c).size&&(t(c),ko(c),c.assigned_=new Map,hp(c.base_,u=>{c.assigned_.set(u,!1)}),c.copy_.clear())}forEach(c,u){const h=this[Kt];sr(h).forEach((f,p,g)=>{c.call(u,this.get(p),p,this)})}get(c){const u=this[Kt];o(u);const h=sr(u).get(c);if(u.finalized_||!Ho(h)||h!==u.base_.get(c))return h;const f=mp(h,u);return t(u),u.copy_.set(c,f),f}keys(){return sr(this[Kt]).keys()}values(){const c=this.keys();return{[Symbol.iterator]:()=>this.values(),next:()=>{const u=c.next();return u.done?u:{done:!1,value:this.get(u.value)}}}}entries(){const c=this.keys();return{[Symbol.iterator]:()=>this.entries(),next:()=>{const u=c.next();if(u.done)return u;const h=this.get(u.value);return{done:!1,value:[u.value,h]}}}}[Symbol.iterator](){return this.entries()}}function e(s,c){return new n(s,c)}function t(s){s.copy_||(s.assigned_=new Map,s.copy_=new Map(s.base_))}class r extends Set{constructor(c,u){super(),this[Kt]={type_:3,parent_:u,scope_:u?u.scope_:kv(),modified_:!1,finalized_:!1,copy_:void 0,base_:c,draft_:this,drafts_:new Map,revoked_:!1,isManual_:!1}}get size(){return sr(this[Kt]).size}has(c){const u=this[Kt];return o(u),u.copy_?!!(u.copy_.has(c)||u.drafts_.has(c)&&u.copy_.has(u.drafts_.get(c))):u.base_.has(c)}add(c){const u=this[Kt];return o(u),this.has(c)||(a(u),ko(u),u.copy_.add(c)),this}delete(c){if(!this.has(c))return!1;const u=this[Kt];return o(u),a(u),ko(u),u.copy_.delete(c)||(u.drafts_.has(c)?u.copy_.delete(u.drafts_.get(c)):!1)}clear(){const c=this[Kt];o(c),sr(c).size&&(a(c),ko(c),c.copy_.clear())}values(){const c=this[Kt];return o(c),a(c),c.copy_.values()}entries(){const c=this[Kt];return o(c),a(c),c.copy_.entries()}keys(){return this.values()}[Symbol.iterator](){return this.values()}forEach(c,u){const h=this.values();let f=h.next();for(;!f.done;)c.call(u,f.value,f.value,this),f=h.next()}}function i(s,c){return new r(s,c)}function a(s){s.copy_||(s.copy_=new Set,s.base_.forEach(c=>{if(Ho(c)){const u=mp(c,s);s.drafts_.set(c,u),s.copy_.add(u)}else s.copy_.add(c)}))}function o(s){s.revoked_&&ji(3,JSON.stringify(sr(s)))}Iq("MapSet",{proxyMap_:e,proxySet_:i})}var Ti=new Mq,zr=Ti.produce;Ti.produceWithPatches.bind(Ti);Ti.setAutoFreeze.bind(Ti);Ti.setUseStrictShallowCopy.bind(Ti);Ti.applyPatches.bind(Ti);Ti.createDraft.bind(Ti);Ti.finishDraft.bind(Ti);function wy(n){const e=O(n,(t,r,i)=>r(e,zr(t(e),typeof i=="function"?i:()=>i)));return e}function Zp(n,e){const t=pe(n);return m.useCallback(r=>t(zr(r)),[t])}const ni=()=>$e("smart-mode-default")?"smart":"chat",cM="mobileCrossSellingLastClosed",AS="mobilePromoCountClose",Mv="hasBeenAuthenticated",Ps="colorTheme",Ey="newConversationsStarted",Ld="timeOfNewConversationThreshold",i1="hasResetConversationDisclaimer",a1="banAppealSubmitted",Nq="hideDeleteConversationModal",Oq="hasBeenPromptedForLocation",Lq="hasSeenCharacter",lM="voiceAppearanceId",Dq="disableAppearanceOnHomeScreen",jq="hasSeenAppearance",Uq="hasSeenAppearanceEducationPopup",Fq="hasSeenAppearanceOnVoiceCall",uM="actionOnAppearanceDiscoveryCta",Bq="hasDismissedAppearanceModal",o1="crossPromoFirstVisit",sI="crossPromoDiscoverStripLastClosed",Rv="crossPromoDiscoverStripCountClose",o3e="crossPromoStripGetAppIsClicked",dM="reviewActiveDays",s1="reviewPromptResponse",PL="userSidebarOpen",s3e="referralEligibilityStatus",c3e="referralHasSeenEntryNewBadge",Hq="coachmark",c1="isEagerMSALEnabled",NL="isMsalSilentSsoEnabled",l1="isStartRetryEnabled",OL="user.UserFirstName",u1="loginStartTime",d1="reauthLoginFlag",l3e="subscription.m365SubscriberFRE",hM="userConversationVoiceSpeed",fM="authModuleRefactor",h1="authRfInitAuthAccount",f1="authRfMsalEventRemoval",$q="copilotBeta",zq="copilotBetaAnnouncementRequired",Vq="copilotVisionLastClicked",u3e="hasEnteredGalleryDetailFromHome";function br(n,e){typeof window<"u"&&localStorage.setItem(n,e)}function Pn(n){return typeof window<"u"?localStorage.getItem(n):null}function ur(n){typeof window<"u"&&localStorage.removeItem(n)}function dr(n,e){const t=Pn(n);if(!t)return null;try{const r=JSON.parse(t);return e.parse(r)}catch{return null}}function ca(n,e,t){try{e.parse(t),br(n,JSON.stringify(t))}catch{}}function tc(n){const{key:e,schema:t,initialValue:r}=n;return Mz(e,r,{getItem:()=>dr(e,t)??r,setItem:(a,o)=>{o===void 0?ur(e):ca(e,t,o)},removeItem:()=>ur(e)},{getOnInit:!0})}async function Gq(n){return new Promise(e=>{let t=!1;n.catch(r=>{r instanceof Error?(t=!0,e(`Type: ${r.name}, Message: ${r.message}, Stack: ${r.stack}`)):(t=!0,e(`Type: ${typeof r}, Value: ${JSON.stringify(r)}`))}),setTimeout(()=>{t||e("Promise.catch wasn't called. The Promise is not rejected.")},1e3)})}class Kq{constructor(){B(this,"latestClientExperimentationAssignmentRequestId",null);B(this,"latestApiExperimentationAssignmentRequestId",null)}getTraceIdAnalytics(){return{TraceId_LastClientAssignment:this.latestClientExperimentationAssignmentRequestId,TraceId_Latest:this.latestApiExperimentationAssignmentRequestId}}trackClientExperimentationAssignment(e){const t=this.getTraceIdFromResponseHeaders(e);t&&(this.latestClientExperimentationAssignmentRequestId=t)}trackLatestApiAssignment(e){const t=this.getTraceIdFromResponseHeaders(e);t&&(this.latestApiExperimentationAssignmentRequestId=t)}trackLatestChatConnectedAssignment(e){const{requestId:t}=e;this.latestApiExperimentationAssignmentRequestId=t}getTraceIdFromResponseHeaders(e){return(e.get("x-ceto-ref")??"").split("|")[0]??null}}const gp=new Kq;function cI(){return"cc414c1"}function qq(){return`mscmc@${cI().substring(0,7)}`}function cn(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function p1(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}function lI(n,e){const t=cn(n);return isNaN(e)?p1(n,NaN):(e&&t.setDate(t.getDate()+e),t)}function Wq(n){return document.cookie.split(";").find(e=>e.trim().startsWith(`${n}=`))}function Dd(n){const e=Wq(n),t=e==null?void 0:e.split("=")[1];if(t)return decodeURIComponent(t)}function Pv(n,e,t={}){const{expireDays:r,path:i="/",domain:a,secure:o=!0,host:s}=t;let c=n;o&&!a&&i==="/"&&s&&(c=`__Host-${n}`);let u=`${c}=${encodeURIComponent(e)}; path=${i}`;if(r){const h=lI(new Date,r);u+=`; expires=${h.toUTCString()}`}a&&(u+=`; domain=${a}`),o&&(u+="; secure"),document.cookie=u}function LL(n,e={}){Pv(n,"",{...e,expireDays:-1})}const Ou={name:"CMCCP",expirationDays:365},Ty={name:"BCP"},Yq="3PAdsOptOut";function uI(){return Dd(Ou.name)??Dd(Ty.name)}function pM(n,e){const{analytics:t,advertising:r,socialMedia:i}=n,a=new URLSearchParams;a.set("AD",r?"1":"0"),a.set("AL",t?"1":"0"),a.set("SM",i?"1":"0");const o=lI(new Date,e);return a.set("expires",o.getTime().toString()),a.toString()}function Qq(n){Pv(Ou.name,pM(n,Ou.expirationDays),{expireDays:Ou.expirationDays}),Pv(Ty.name,pM(n,Ou.expirationDays),{expireDays:Ou.expirationDays})}function _l(){const n=Dd(Ty.name);if(!n)return{advertising:!1,analytics:!1,socialMedia:!1};const e=new URLSearchParams(n),t=e.get("AD")==="1",r=e.get("AL")==="1",i=e.get("SM")==="1";return{advertising:t,analytics:r,socialMedia:i}}function DL(){const n=Dd(Yq)!=="1";return navigator.globalPrivacyControl?!1:n}const Pc=class Pc{constructor(){B(this,"listeners",new Map)}static getInstance(){return Pc.instance||(Pc.instance=new Pc),Pc.instance}on(e,t){var r;this.listeners.has(e)||this.listeners.set(e,[]),(r=this.listeners.get(e))==null||r.push(t)}emit(e,t){const r=this.listeners.get(e);if(r)for(const i of r)i(t)}off(e,t){const r=this.listeners.get(e);r&&this.listeners.set(e,r.filter(i=>i!==t))}};B(Pc,"instance",null);let m1=Pc;const _t=m1.getInstance();function Jq(n){let e="unknown";try{const t=/(?:CopilotNative|BingNative|MicrosoftLauncher)\/([0-9]+(?:\.[0-9]+)*(?:-[a-zA-Z0-9]+)?)/,r=n==null?void 0:n.match(t);if(r!=null&&r[1]){const[,i]=r;e=i}return e}catch{return e}}function $s(n,e){sessionStorage.setItem(n,e)}function $o(n){return sessionStorage.getItem(n)}function d3e(n){return $o(n)==="true"}function Zq(n){sessionStorage.removeItem(n)}function Rn(n){return new URLSearchParams(window.location.search).get(n)}function da(n){const e=new URL(window.location.href);e.searchParams.delete(n),window.history.replaceState(null,"",e)}function Xq(){const n=Rn("ocid")??Rn("OCID"),e=Rn("msclkid"),t=Rn("gclid"),r={};return n&&(r.OCID=n),e&&(r.msclkid=e),t&&(r.gclid=t),r}function jL(){da("ocid"),da("OCID"),da("msclkid"),da("gclid")}function eW(){const n=Rn("form");if(n)return da("form"),n;const e=Rn("FORM");return e&&da("FORM"),e}function tW(){return Rn("alias")}function nW(){const n=Rn("chat-mode");return n&&da("chat-mode"),n}function rW(){const n=Rn("q");return n&&da("q"),n}function iW(){const n=Rn("prompt");return n&&da("prompt"),n}function aW(){const n=Rn("sandbox");return n&&da("sandbox"),n==="1"}function oW(){if(typeof window>"u")return!1;const n=Rn("disable-all-features");return n!==null&&n!=="0"&&n!=="false"}function h3e(){return Rn("payflow-correlationId")}function f3e(){return Rn("entry-point")??""}function p3e(){const n=Rn("campaign");return n?($s("campaignId",n),n):null}function m3e(){const n=Rn("referral-code");return n?($s("referralCode",n),n):null}function sW(){return Rn("charid")}const cW=[["payflowCorrelationId","pfcid"],["payflowFrom","pff"],["payflowAuthHint","pfah"],["payflowEntry","pfe"],["payflowRequiresPremium","pfrp"]];function g3e(){const n={payflowCorrelationId:"",payflowFrom:"",payflowAuthHint:"",payflowEntry:"",payflowRequiresPremium:""};for(const[e,t]of cW){const r=Rn(t);r&&(n[e]=r)}return n}function lW(){return Rn("intent")}const uW=["text","queryParam"];function dW(n){return uW.includes(n)}function hW(){const n=Rn("input-method");return n?(da("input-method"),dW(n)?n:"queryParam"):"queryParam"}function v3e(){return[]}function Ml(n){const e=typeof navigator<"u"?navigator.userAgent:null;return e?n.test(e):!1}function UL(){return Ml(/BingSapphire/gi)}function fW(){return Ml(/NewsSapphire/gi)}function dI(){return!!(navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Macintosh/i.test(navigator.userAgent)&&"ontouchend"in document)}function FL(){return dI()||Ml(/iPad|iPhone|Android|iPod/gi)}function b3e(){return Ml(/macintosh|mac os x/gi)&&!dI()&&!BL()}function pW(){return Ml(/Android/gi)}function BL(){return dI()||Ml(/iPhone|iPad|iPod/gi)}function mW(){return Ml(/CopilotNative.*macOS/gi)}const hI=O(!1),gW=l.boolean().optional(),jd=tc({key:$q,schema:gW,initialValue:void 0}),vW=l.boolean().optional(),kS=tc({key:zq,schema:vW,initialValue:void 0});function Fe(n){return dt().get(n)}function bW(){return Fe(hI)&&!!Fe(jd)}const yW={"thumbs-up":"thumbsUp","thumbs-down":"thumbsDown",report:"reportMessage"},mM="homepage";class CW{constructor(e={}){B(this,"analytics",null);B(this,"features");B(this,"picassoId",null);B(this,"anid",null);B(this,"formCode",null);B(this,"landingPage",mM);B(this,"trafficAlias",null);B(this,"settings",null);B(this,"isAADUser",null);B(this,"isNewUser",null);B(this,"isCopilotMode",null);B(this,"accountType",null);B(this,"referrer",null);B(this,"deviceInfo",null);B(this,"anaheimId",null);B(this,"pluginProvider",null);B(this,"pluginCache",null);B(this,"isInitializing",!1);B(this,"pendingEvents",[]);B(this,"initRetryCount",0);B(this,"maxRetries");B(this,"maxPendingEvents");B(this,"delay");B(this,"onInitializeError");this.maxRetries=e.maxRetries??3,this.maxPendingEvents=e.maxPendingEvents??1e3,this.delay=e.delay??0,this.onInitializeError=e.onInitializeError}getSurface(){return this.getPlatformSurface("cmc")}getAppName(){return`CopilotN-${this.currentEnv}-web-${this.getSurface()}`}ensureInitialized(e){!this.isInitialized&&!this.isInitializing&&(this.pluginProvider=e,this.isInitializing=!0,this.initialize())}get plugin(){return this.pluginCache===null&&this.pluginProvider!==null&&this.analytics!==null&&(this.pluginCache=this.pluginProvider(),this.pluginCache&&this.analytics.addNotificationListener(this.pluginCache)),this.pluginCache}get isInitialized(){return this.analytics!==null&&this.analytics.isInitialized()}get currentEnv(){return"prod"}get initializationFailed(){return this.initRetryCount>=this.maxRetries}setFeatures(e){this.features=e.join(",")}setAnid(e){this.anid=e}getAnid(){return this.anid}setIsNewUser(e){this.isNewUser===null&&(this.isNewUser=e)}setIsAad(e){this.isAADUser=e}setCopilotMode(e){this.isCopilotMode=e}setSettings(e){this.settings={...this.settings,...e}}getPicassoId(){return this.picassoId}setPicassoId(e){this.picassoId=e}setFormCode(e){this.formCode=e}getFormCode(){return this.formCode}setDeviceInfo(e){this.deviceInfo=e}setLandingPage(e){this.landingPage===mM&&(this.landingPage=e)}getLandingPage(){return this.landingPage}isValidLowercaseUserAccountType(e){return["msa","aad","apple","google"].includes(e)}setUserAccountType(e){if(!e){this.accountType=null;return}const t=e.toLowerCase();this.isValidLowercaseUserAccountType(t)?this.accountType=t:this.accountType=null}getUserAccountType(){return this.accountType}processFormCode(){const e=eW();this.formCode=e}processAlias(){const e=tW();e&&(this.trafficAlias=e)}processReferrer(){this.referrer===null&&typeof document<"u"&&(this.referrer=document.referrer)}getAnaheimIdFromHTML(){try{const e=document.querySelector("meta[name='x-client-data']");if(!e)return null;const t=e.getAttribute("content");if(!t)return null;const r=atob(t),i=JSON.parse(r);if(typeof i!="object"||i===null)return null;const a=i;if(!("4"in a))return null;const o=a[4];return typeof o=="string"?o:null}catch{return null}}processAnaheimId(){const e=this.getAnaheimIdFromHTML();e&&(this.anaheimId=e)}initialize(){this.isInitialized||(this.processFormCode(),this.processAlias(),this.processReferrer(),this.processAnaheimId(),this.dynamicInitialization().catch(()=>{}))}async dynamicInitialization(){var t,r;this.delay>0&&await new Promise(i=>{setTimeout(i,this.delay)});const e=await $(()=>import("./Index-7_zWz3Yc.js"),__vite__mapDeps([0,1,2])).catch(i=>i instanceof Error?i:new Error(`Failed to load @microsoft/1ds-analytics-js: ${i}`));if(e instanceof Error)(t=this.onInitializeError)==null||t.call(this,e),this.initRetryCount+=1,this.initRetryCount>=this.maxRetries&&((r=this.onInitializeError)==null||r.call(this,new Error("ApplicationInsights initialization: Max retries reached")),this.pendingEvents.length=0);else{const{ApplicationInsights:i}=e;this.analytics=new i;const a={instrumentationKey:"be6e4c19699f4fdf9f8c0ec9f9b398ef-25d58bb9-9926-4df7-8e36-bc7afb4b2c34-7563",channelConfiguration:{eventsLimitInMem:5e3},propertyConfiguration:{populateBrowserInfo:!0},disableCookiesUsage:!0};this.analytics.initialize(a,[]),this.flushPendingEvents()}this.isInitializing=!1}flushPendingEvents(){for(let e=0,t=this.pendingEvents.length;e<t;e+=1){const r=this.pendingEvents[e];r&&this.trackEventInternal(r)}this.pendingEvents.length=0}getPlatformSurface(e){if(e==="pageseditor"){if(pW())return"android";if(BL())return"ios";if(mW())return"mac"}return e}getAppFlavor(){return bW()?{eventInfo_appFlavor:"beta"}:null}getFixEventProperties(){return{appName:this.getAppName(),appVersion:cI(),surface:this.getSurface(),surfaceVersion:Jq(navigator.userAgent),accountType:this.accountType,userMuid:Dd("MUID"),userAnid:this.anid,userPicassoId:this.picassoId,userFlightIds:this.features,trafficAlias:this.trafficAlias,eventInfo_entryPoint:this.formCode,eventInfo_surfaceVisible:document.visibilityState==="visible",eventInfo_isCopilotMode:this.isCopilotMode,isAADUser:this.isAADUser,isNewUser:this.isNewUser,pathname:window.location.pathname,referrer:this.referrer,anaheimId:this.anaheimId,"UserInfo.Id":this.picassoId,...gp.getTraceIdAnalytics(),...this.settings,...this.deviceInfo,...this.getAppFlavor()}}trackEvent(e){if(!this.initializationFailed){if(this.pendingEvents.length>=this.maxPendingEvents){console.warn(`Analytics pending events queue is full (${this.maxPendingEvents}). Dropping event: ${JSON.stringify(e)}`);return}if(this.ensureInitialized(this.pluginProvider),this.isInitializing||!this.isInitialized){this.pendingEvents.push(e);return}this.trackEventInternal(e)}}trackEventInternal(e){var s,c;const t=this.getFixEventProperties(),r=_l(),i=DL(),a=((s=this.plugin)==null?void 0:s.generateClientEventId(e))??void 0;if(!this.analytics){console.error("Failed to initialize AnalyticsService.");return}const o={name:e.name,data:{...t,eventInfo_clientEventId:a,...e.data},ext:{web:{consentDetails:JSON.stringify({Required:!0,Analytics:r.analytics,SocialMedia:r.socialMedia,Advertising:r.advertising,GPC_DataSharingOptIn:i})}}};(e.data.eventName==="copilotCompose"||e.data.eventName==="copilotAudioInput")&&_t.emit("composer:send-query",{isNewUser:this.isNewUser,event:e.data}),(c=this.plugin)==null||c.onBeforeTrackEvent(o),this.analytics.track(o)}}const H=new CW({maxRetries:3,maxPendingEvents:1e3,delay:200,onInitializeError:n=>{console.error("AnalyticsService initialization error:",n)}});function HL(n,e){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"ErrorBoundary",eventInfo_errorName:n.name,eventInfo_errorMessage:n.message,eventInfo_errorStack:n.stack??"",eventInfo_componentStack:e.componentStack??""}}),$(async()=>{const{captureReactException:t}=await import("./vendor-BYCmmfc5.js").then(r=>r.am);return{captureReactException:t}},__vite__mapDeps([1,2])).then(({captureReactException:t})=>t(n,e))}function vp(n,e,t=!1){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"APIResponseParseError",eventInfo_apiUrl:e,eventInfo_errors:JSON.stringify(n.format()),eventInfo_safe:t}})}async function gM(n){const e=await Gq(n.promise);H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"UnhandledRejection",eventInfo_reason:`${n.reason}`,eventInfo_customData:e}})}function SW(n,e,t){try{new URL(Ls(n)).hostname}catch(r){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"invalidCitationURL",eventInfo_url:n,eventInfo_errorMessage:r instanceof Error?r.message:"",eventInfo_conversationId:e,eventInfo_messageId:t}})}}function $L(n){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"PlaybackApiError",eventInfo_errorMessage:n instanceof Error?n.message:"",eventInfo_details:"An error occurred during media playback tracking api call."}})}function wW(n,e,t=void 0){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"InvalidJsonResponse",eventInfo_apiUrl:t,eventInfo_errorMessage:n.message,eventInfo_errorCode:e.statusText,eventInfo_details:JSON.stringify(Object.fromEntries(e.headers.entries()))}})}const EW=25,TW=25,IW=6e3,AW=12,kW=["mica","aqua","erin"];function zL(n){switch(n){case"mica":case"aqua":case"erin":return n;default:return null}}function xW(n,e){switch(n){case"mica":return e("characterAnimation.characterNameMica");case"aqua":return e("characterAnimation.characterNameAqua");case"erin":return e("characterAnimation.characterNameErin");default:return""}}function _W(n,e){return(t,r)=>{H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"CharacterError",eventInfo_details:`animatingMessageId: ${n}, characterId: ${e}, name: ${t.name}, info: ${r.componentStack}`,eventInfo_errorMessage:t.message}}),HL(t,r)}}const ii=l.object({partId:l.string()}),Xp=l.object({event:l.literal("invokeAction"),actionId:l.string()}),MW=l.enum(LV),RW=l.object({type:l.literal("code"),language:MW,content:l.string()}),PW=l.object({type:l.literal("file"),url:l.string().refine(n=>n.startsWith("/")||l.string().url().safeParse(n).success,{message:"Must be a valid URL or relative path"}),name:l.string(),contentType:l.string()}),NW=l.object({type:l.literal("browser"),screenshot:l.string().optional(),tabIds:l.number().array().optional(),activeTabId:l.number().optional()}),OW=l.discriminatedUnion("type",[RW,PW,NW]),VL=l.union([l.literal("running"),l.literal("completed"),l.literal("failed")]),LW=l.object({title:l.string(),status:VL}),GL=l.object({status:VL,title:l.string(),steps:l.array(LW),artifacts:l.array(OW)}),KL=ii.extend({type:l.literal("activity"),activity:GL}),Ar=l.object({amount:l.number(),currency:l.string().nullable(),currencySymbol:l.string().nullable()}),DW=l.enum(["current-search-term","recent-searches","age","gender","website-visits","interests","custom-audience","similar-audience","profile-targeting"]);l.enum(["multimedia","product","tourActivity","propertyPromotion","text","miniShowroom","mainShowroom","showroom","organic"]);const jW=l.enum(["top","bottom","left","right"]),UW=l.object({adDomain:l.string(),advertiser:l.object({name:l.string(),country:l.string()}),isVerified:l.boolean(),selectionReasons:l.array(DW)}),Rl=l.object({url:l.string(),urlPingSuffix:l.string()}),Zo=l.object({url:l.string(),width:l.number().nullish(),height:l.number().nullish(),link:Rl.nullish(),impressionToken:l.string().nullish()}),FW=l.object({downPayment:l.string(),description:l.string()}),BW=l.object({rating:l.number(),link:Rl,impressionToken:l.string()}),em=l.object({businessName:l.string(),image:Zo,impressionToken:l.string().nullish()}),qL=l.object({text:l.string(),url:l.string(),urlPingSuffix:l.string()}),HW=l.object({title:l.string(),text:l.string(),url:l.string(),layout:l.enum(["inline","overlay"])}),Pl=l.object({impressionToken:l.string(),selectionCriteria:UW}),Iy=l.object({rowIndex:l.number().int(),columnIndex:l.number().int(),textPosition:jW,imagesPerRow:l.number().int()}),WL=Pl.extend({type:l.literal("multimedia"),description:l.string(),title:l.string(),displayUrl:l.string(),link:Rl,image:Zo.nullish(),logo:em.nullish(),action:qL.nullish(),layout:Iy.nullish()});Pl.extend({type:l.literal("organic"),description:l.string(),title:l.string(),link:l.string(),image:Zo,layout:Iy});const Ay=l.object({category:l.string(),value:l.string()}),fI=Pl.extend({type:l.literal("product"),offer:l.object({seller:l.string(),link:Rl,price:Ar,lowPrice:Ar.nullish(),item:l.object({name:l.string(),image:Zo})}),tags:l.array(Ay).nullish(),shipping:l.object({isFree:l.boolean(),description:l.string()}).nullish(),productRating:BW.nullish(),installment:FW.nullish(),pricePerUnit:l.string().nullish(),energyRating:l.string().nullish(),layout:Iy.nullish()}),YL=Pl.extend({type:l.literal("tourActivity"),title:l.string(),domain:l.string(),startingPrice:Ar,image:Zo,link:Rl,tags:l.array(Ay).nullish()}),QL=Pl.extend({type:l.literal("propertyPromotion"),title:l.string(),domain:l.string(),price:Ar,image:Zo,link:Rl,tags:l.array(Ay).nullish()}),$W=Pl.extend({type:l.literal("text"),title:l.string(),description:l.string(),displayUrl:l.string(),link:Rl,image:Zo.nullish(),logo:em.nullish(),disclaimer:HW.nullish()}),zW=Pl.extend({type:l.literal("miniShowroom"),title:l.string(),description:l.string(),displayUrl:l.string(),image:Zo,logo:em.nullish(),brandId:l.string().nullish(),brandBackground:l.number().int().nullish()}),VW=l.object({ad:l.union([fI,WL]),adId:l.string().nullish()}),GW=l.object({isLoading:l.boolean().nullish(),isEmpty:l.boolean().nullish()}),JL=GW.extend({type:l.literal("mainShowroom"),id:l.string(),impressionToken:l.string(),brandId:l.string(),title:l.string().nullish(),description:l.string().nullish(),backgroundColor:l.number().int().nullish(),images:l.array(Zo).nullish(),logo:em.nullish(),slotAds:l.array(VW).nullish(),action:qL.nullish(),layout:Iy.nullish()}),KW=l.union([WL,fI,YL,QL,$W,zW,JL]);l.union([fI,YL,QL]);const ZL=l.object({pageLoadPingUrl:l.string(),visibilityPingUrlBase:l.string(),clickPingUrlBase:l.string()}),xS=l.object({tagsSupported:l.boolean()});l.object({supportedTypes:l.array(l.enum(["multimedia","product","tourActivity","propertyPromotion","text","showroom","miniShowroom","mainShowroom"])),product:xS.nullish(),propertyPromotion:xS.nullish(),tourActivity:xS.nullish(),optOutOfPersonalization:l.boolean().nullish()});const XL=l.enum(["open","expand","chat"]);l.object({showroom:l.object({scenario:XL,brandId:l.string(),brandName:l.string().nullish(),adId:l.string().nullish()})});const qW=l.object({brandBackground:l.number().int().nullish(),brandLogo:em.nullish(),conversationId:l.string(),theme:l.enum(["light","dark"]).nullish(),viewMode:l.enum(["cardView","extendedView"]),rguid:l.string().nullish(),rlink:l.string().nullish(),messageId:l.string(),triggerAt:l.number(),mainShowroomAdId:l.string().nullish()});qW.extend({brandId:l.string(),adId:l.string().nullish(),scenario:XL.nullish()});l.object({brandId:l.string(),brandName:l.string().nullish(),messageId:l.string(),conversationId:l.string(),visible:l.boolean()});const WW=l.object({requestId:l.string(),ads:l.array(JL),instrumentation:ZL}),YW=l.object({selectedTag:Ay.nullish(),collapsed:l.boolean().nullish(),showroomData:l.array(l.object({fetchAdId:l.string(),response:WW})).nullish()}),QW=YW.extend({type:l.literal("ads"),requestId:l.string(),summary:l.string(),ads:l.array(KW).nullish(),instrumentation:ZL}),vM={OneDriveAccess:"one-drive-access",BrowserActions:"browser-actions"},JW=l.enum([vM.OneDriveAccess,vM.BrowserActions]),bM={active:"active",rejected:"rejected"},ZW=l.enum([bM.active,bM.rejected]),XW=l.object({type:l.literal("consent"),consentTypes:l.array(JW),status:ZW}),eY=l.object({type:l.literal("computerUseFeedback")}),Nl=l.union([l.literal("startTask"),l.literal("pauseTask"),l.literal("resumeTask"),l.literal("cancelTask"),l.literal("takeTaskControl"),l.literal("releaseTaskControl")]),tY=l.union([l.literal("bringAgentTabsToForeground"),l.literal("failedTask"),l.literal("completedTask"),l.literal("moveAgentTabsToBackground"),l.literal("showConsentDialog")]);l.union([Nl,tY]);const nY=l.union([l.literal("allSessionInfo"),l.literal("activeSessionInfo"),l.literal("failedTask"),l.literal("completedTask")]);l.union([Nl,nY]);const rY=l.union([l.literal("allSessionInfo"),l.literal("activeSessionInfo"),l.literal("failedTask"),l.literal("completedTask")]);l.union([Nl,rY]);const eD=l.union([l.literal("askUserInput"),l.literal("safetyRiskDetected"),l.literal("userTakeControl"),l.literal("giveBackControl"),l.literal("resumeFromInput"),l.literal("resumeFromRisk"),l.literal("pauseByClick"),l.literal("resumeByClick"),l.literal("taskCompleted")]),iY=l.object({reason:eD,title:l.string().optional(),text:l.string().optional()}),oh=l.object({taskId:l.string()}),aY=oh.extend({type:l.literal("startTask")}),oY=oh.extend({type:l.literal("pauseTask")}),sY=oh.extend({type:l.literal("resumeTask")}),cY=oh.extend({type:l.literal("cancelTask")}),lY=oh.extend({type:l.literal("takeTaskControl")}),uY=oh.extend({type:l.literal("releaseTaskControl")}),tD=l.object({title:l.string(),instruction:l.object({text:l.string(),websites:l.array(l.object({url:l.string().url(),iconUrl:l.string().url().optional()}))})}),y3e=tD.extend({id:l.string()});tD.extend({isActive:l.boolean()});const dY=l.enum(["choose","replay"]),hY=l.enum(["2","1","0.5"]),fY=l.object({isRunning:l.boolean().nullish(),speed:hY.nullish()}),pY=l.object({name:l.string(),url:l.string().nullish(),description:l.string().nullish(),phoneNumber:l.string().nullish(),smsNumber:l.string().nullish(),chatUrl:l.string().nullish(),whatsAppUrl:l.string().nullish()}),mY=l.object({type:l.literal("safetyHelpline"),countryEmergencyNumber:l.string().nullable(),helplines:l.array(pY)}),gY=l.object({type:l.literal("document"),attachmentId:l.string(),fileName:l.string(),contentType:l.string()}),vY=l.object({type:l.literal("file"),url:l.string().url(),name:l.string(),contentType:l.string()}),bY=l.object({name:l.string(),disclaimerUrl:l.string(),url:l.string()}),nD=l.object({price:l.number().nullish(),changeInPercentage:l.number().nullish(),changeInAmount:l.number().nullish()}),rD=l.object({id:l.string(),symbol:l.string(),displayName:l.string(),price:l.number(),previousClosePrice:l.number(),changeInPercentage:l.number(),changeInAmount:l.number(),updatedAt:l.string(),iconUrl:l.string(),provider:bY,isFollowed:l.boolean().nullish()}),yY=l.object({priceOpen:l.number().nullish(),priceHigh:l.number().nullish(),priceLow:l.number().nullish(),price52wHigh:l.number().nullish(),price52wLow:l.number().nullish()}),tm=rD.extend({intradayPricing:yY,isMarketLastSale:l.boolean(),exchangeTimeZoneId:l.string().nullish(),isMarketRegularHours:l.boolean().optional(),lastUpdatedAt:l.string(),tradingDayEndAt:l.string(),accumulatedVolume:l.number().nullish()}),CY=tm.extend({securityType:l.literal("stock"),marketCap:l.number().nullish(),marketCapCurrency:l.string().nullish(),averageVolume:l.number().nullish(),peRatio:l.number().nullish(),postMarket:nD.nullish()}),SY=tm.extend({securityType:l.literal("etf"),netAssets:l.number().nullish(),expenseRatio:l.number().nullish(),yieldPercent:l.number().nullish(),postMarket:nD.nullish()}),wY=tm.extend({securityType:l.literal("index")}),EY=rD.extend({securityType:l.literal("fund"),price52wHigh:l.number().nullish(),price52wLow:l.number().nullish(),netAssets:l.number().nullish(),expenseRatio:l.number().nullish(),yieldPercent:l.number().nullish(),oneYearReturn:l.number().nullish()}),iD=l.object({amount:l.number().nullish(),currency:l.string().nullish(),currencySymbol:l.string().nullish()}),yM=l.object({value:iD,fullName:l.string().nullish()}),TY=l.object({oneMonth:l.number().nullish(),sixMonths:l.number().nullish(),oneYear:l.number().nullish()}),IY=tm.extend({securityType:l.literal("currencyExchange"),fromCurrency:yM,toCurrency:yM,percentageReturns:TY}),AY=tm.extend({securityType:l.literal("cryptocurrency"),marketDominancePercentage:l.number().nullish(),circulatingSupply:l.number().nullish(),maxSupply:l.number().nullish(),oneYearReturn:l.number().nullish(),marketCap:iD,marketCapCurrency:l.string().nullish()}),kY=l.enum(RV),xY=l.object({price:l.number(),volume:l.number(),at:l.string()}),CM=l.array(xY),_Y=l.object({afterHoursSeries:CM,series:CM,chartType:kY}),MY=l.discriminatedUnion("securityType",[CY,SY,wY,EY,IY,AY]),RY=l.object({currency:l.string(),instrument:MY,chart:_Y.optional()}),PY=RY.extend({type:l.literal("financeChart")}),NY=l.discriminatedUnion("type",[PY]),OY=l.object({id:l.string()}),LY=l.array(OY),C3e=l.object({entities:LY}),DY=l.object({type:l.literal("basic"),front:l.string(),back:l.string()}),jY=l.object({type:l.literal("flashcard"),title:l.string(),flashcards:l.array(DY)}),UY=l.object({type:l.literal("generativeUI"),markup:l.string(),data:l.record(l.string(),l.any())}),FY=l.object({latitude:l.number(),longitude:l.number()}),Nv=l.object({name:l.string(),location:FY}),BY=l.enum(["DoesNotAcceptInsurance","AcceptsInsuranceCarrierUnknown","AcceptsInsuranceCarrierKnownPlanUnknown","AcceptsInsuranceCarrierKnownInNetwork","AcceptsInsuranceCarrierKnownOutOfNetwork"]),HY=Nv.extend({npi:l.string(),primarySpecialtyTitle:l.string().nullish(),ratingScore:l.number(),ratingCount:l.number(),professionalCredentials:l.array(l.string()).nullish(),location:Nv.shape.location.extend({uuid:l.string(),address:l.string().nullish(),name:l.string().nullish()}),insuranceStatus:BY,insuranceCarrierName:l.string().nullish(),url:l.string().nullish()}),$Y=l.object({type:l.literal("healthcareEntity"),entities:l.array(HY)}),aD=l.object({image:l.object({url:l.string(),thumbnailUrl:l.string(),altText:l.string(),width:l.number(),height:l.number()}),source:l.object({title:l.string(),url:l.string(),iconUrl:l.string().nullable()})}),zY=l.object({type:l.literal("image"),images:l.array(aD)}),VY=l.object({type:l.literal("inlineImage"),title:l.string(),description:l.string()}).merge(aD),GY=l.object({type:l.literal("inlineVideo"),title:l.string(),description:l.string(),video:l.object({url:l.string(),thumbnailUrl:l.string(),title:l.string(),isShort:l.boolean()}),source:l.object({url:l.string(),iconUrl:l.string().optional()})}),KY=l.object({name:l.string(),logoUrl:l.string().nullable(),postUrl:l.string()}),qY=l.object({title:l.string(),companyName:l.string(),companyLogoUrl:l.string().nullable(),postedAt:l.string(),location:l.string(),providers:l.array(KY),description:l.string(),salary:l.string().nullable(),type:l.string().nullable(),locationType:l.string().nullable(),tags:l.array(l.string()).nullable()}),WY=l.object({type:l.literal("job"),jobs:l.array(qY)}),YY=l.object({type:l.literal("localEntity"),entities:l.array(Nv.extend({phoneNumber:l.string().nullish(),url:l.string().nullish(),reviews:l.array(l.object({count:l.number(),rating:l.number(),providerName:l.string(),providerIconUrl:l.string().nullish(),url:l.string()})),location:Nv.shape.location.extend({address:l.string().nullish()}),photos:l.array(l.object({url:l.string(),altText:l.string().nullish(),providerName:l.string().nullish(),providerUrl:l.string()})),category:l.string().nullish(),price:l.string().nullish()}))}),QY=l.object({providerName:l.string(),url:l.string().nullish(),thumbnailUrl:l.string(),providerOptions:l.array(l.string()).nullish(),source:l.object({url:l.string(),name:l.string()}).nullish()}),JY=l.object({sourceName:l.string(),maxRating:l.number(),rating:l.number(),url:l.string()}),ZY=l.object({url:l.string(),source:l.object({url:l.string(),name:l.string()}).nullish()}),g1=l.object({url:l.string().nullish(),name:l.string().nullish()}),XY={thumbnail:l.object({url:l.string(),source:g1.nullish()}),source:g1.nullish()},eQ=l.object({type:l.literal("mediaSpotlight"),title:l.string(),label:l.string().nullish(),description:l.string(),thumbnail:ZY,facts:l.record(l.string(),l.string()).nullish(),criticRatings:l.array(JY).nullish(),watchLinks:l.array(QY).nullish(),featuredVideo:l.object(XY).nullish(),sources:l.array(g1).nullish()}),tQ=l.object({name:l.string(),thumbnailUrl:l.string()}),nQ=l.object({provider:tQ,title:l.string(),url:l.string(),thumbnailUrl:l.string(),updatedAt:l.string()}),rQ=l.object({title:l.string(),articles:l.array(nQ)}),iQ=rQ.extend({type:l.literal("newsCarousel")}),aQ=l.object({id:l.string(),type:l.literal("oneDrive"),name:l.string(),lastModifiedAt:l.string(),url:l.string(),webDavUrl:l.string().optional(),contentType:l.string(),size:l.number()}),oQ=l.object({type:l.literal("m365"),items:l.array(aQ)}),sQ=l.object({type:l.literal("person"),fullName:l.string(),thumbnailUrl:l.string()}),cQ=l.object({name:l.string(),url:l.string(),width:l.number().optional(),height:l.number().optional(),thumbnailUrl:l.string().optional()}),lQ=l.object({images:l.array(cQ)}),uQ=lQ.extend({type:l.literal("phoneImages")}),dQ=l.object({qrCodeUrl:l.string(),linkDeviceUrl:l.string()}),hQ=dQ.extend({type:l.literal("phoneLinking")}),fQ=l.union([l.literal("executing"),l.literal("completed"),l.literal("failed")]),pI=l.object({deviceName:l.string().optional(),state:fQ.optional(),disabled:l.boolean().optional(),completedAt:l.string().optional()}),pQ=l.enum(["sunday","monday","tuesday","wednesday","thursday","friday","saturday"]),mQ=pI.extend({triggerAt:l.string(),repeatDays:l.array(pQ).optional().nullable()}),gQ=mQ.extend({type:l.literal("phoneAlarm")}),vQ=pI.extend({seconds:l.number()}),bQ=vQ.extend({type:l.literal("phoneTimer")}),yQ=pI.extend({actionId:l.string(),text:l.string(),phoneNumber:l.string().nullable().optional(),contactName:l.string().nullable().optional(),deviceName:l.string().optional()}),CQ=yQ.extend({type:l.literal("phoneSendMessage")}),SQ=Xp.extend({actionName:l.literal("phone_send_message"),parameters:l.object({text:l.string(),phoneNumber:l.string().nullable().optional(),contactName:l.string().nullable().optional()})}),wQ=l.discriminatedUnion("type",[hQ,uQ,gQ,bQ,CQ]),EQ=l.object({type:l.literal("quiz"),title:l.string(),quiz:l.array(l.object({type:l.literal("singleSelect"),question:l.string(),options:l.array(l.string()),answer:l.number(),topics:l.array(l.string()).nullable(),explanation:l.string()}))}),TQ=l.object({value:l.number(),count:l.number().nullish(),maxRating:l.number().nullish()}),IQ=l.object({hours:l.number(),minutes:l.number()}),oD=l.object({name:l.string(),quantity:l.number().nullish(),unit:l.string().nullish()}),AQ=l.object({title:l.string(),url:l.string().url(),source:l.string(),imageUrl:l.string().url().nullish(),rating:TQ.nullish(),serving:l.number().nullish(),calories:l.number().nullish(),cookingTime:IQ.nullish(),instructions:l.array(l.string()).nullish(),ingredients:l.array(oD).nullish()}),kQ=l.object({type:l.literal("recipe"),recipes:l.array(AQ)});l.object({title:l.string(),url:l.string().url(),ingredients:l.array(oD),instructions:l.array(l.string()).nullish(),imageUrl:l.string().url().nullish(),messageId:l.string().nullish()});const mI=l.object({position:l.number(),url:l.string(),title:l.string(),iconUrl:l.string().nullish(),publisher:l.string().nullish(),snippet:l.string().nullish()}),sD=l.object({url:l.string(),name:l.string(),imageUrl:l.string(),images:l.array(l.string()).nullish(),price:Ar,seller:l.string().nullish()}),gI=l.object({value:l.number(),count:l.number()}).nullish(),xQ=sD.extend({type:l.literal("shopping"),id:l.string(),rating:gI}),_Q=sD.extend({isNotificationEnabled:l.boolean().nullish(),offerId:l.string(),currentPrice:Ar.nullish(),percentageDrop:l.number(),durationInWeeks:l.number()}),vI=l.object({title:l.string().nullish(),url:l.string()}),MQ=l.enum(["textual","visual"]),RQ=l.object({displayName:l.string(),value:l.string(),isActive:l.boolean(),isSelected:l.boolean(),thumbnailImage:vI.nullish()}),cD=l.object({id:l.string(),displayName:l.string(),filterValues:l.array(RQ),filterType:MQ}),lD=l.object({id:l.string().nullish(),groupId:l.string().nullish(),brandGroupId:l.string().nullish()}),uD=l.object({displayName:l.string(),values:l.array(l.string())}),dD=l.object({offerUrl:l.string(),domain:l.string()}),hD=l.object({summary:l.string(),attributions:l.array(dD)}),fD=l.object({pros:l.array(l.string()).nullish(),cons:l.array(l.string()).nullish(),attributions:l.array(dD)}),pD=l.discriminatedUnion("type",[l.object({type:l.literal("buyWithMerchant"),checkoutUrl:l.string().nullish(),merchant:l.string().nullish()}),l.object({type:l.literal("buyWithCopilot"),merchantProvider:l.string().nullish(),storeId:l.string().nullish()})]),bI=l.object({product:lD,offerId:l.string(),url:l.string(),name:l.string(),description:l.string().nullish(),images:l.array(vI).nullish(),filters:l.array(cD).nullish(),specifications:l.array(uD).nullish(),review:hD.nullish(),prosAndCons:fD.nullish(),price:Ar,discountPrice:Ar.nullish(),seller:l.string(),sellerLogoUrl:l.string().nullish(),brandName:l.string().nullish(),rating:gI.nullish(),checkoutOption:pD.nullish(),curation:l.string().nullish(),canTrackPrice:l.boolean()}),PQ=l.object({type:l.literal("shoppingProducts"),products:l.array(bI)}),yI=l.union([l.literal("lowest-price"),l.literal("free-shipping")]),mD=l.object({offerName:l.string(),offerId:l.string(),url:l.string(),price:Ar,discountPrice:Ar.nullish(),seller:l.string(),sellerLogoUrl:l.string().nullish(),tags:l.array(yI).nullish(),canTrackPrice:l.boolean()}),S3e=l.object({error:l.string(),message:l.string()}),gD=l.object({minPrice:Ar,maxPrice:Ar,averagePrice:Ar,timePeriodInDays:l.number()}),vD=l.object({date:l.coerce.date(),price:Ar}),bD=l.object({daily:vD.array()}),yD=l.object({label:l.string(),prompt:l.string()}),NQ=l.union([l.literal("nudge"),l.literal("flyout")]),OQ=l.object({edgeEntryPoint:NQ.optional()}),LQ=OQ.extend({scenario:l.literal("priceHistory"),priceHistory:l.object({dailyPrices:vD.array(),type:l.union([l.literal("increase"),l.literal("decrease")]),percentage:l.number()})}),CD=l.discriminatedUnion("scenario",[LQ]);l.object({muid:l.string(),anid:l.string().nullish(),isRebatesActive:l.boolean(),affiliateExpireTimeEpoch:l.number().nullish()});const SD=l.enum(["%","$"]),SM=l.object({category:l.string(),commissionType:SD,commissionValue:l.number(),priority:l.number()}),DQ=l.object({userCurrency:l.string()}),jQ=l.object({highestCashbackCategory:SM,userRebateResponse:DQ,merchantName:l.string(),merchantId:l.string(),merchantFullName:l.string(),merchantUri:l.string(),merchantImageUrl:l.string(),affiliateNetwork:l.string(),categories:l.array(SM),exclusions:l.string()}),UQ=l.enum(["Storewide","Product"]),FQ=l.object({adsCurrencySymbol:l.string(),commissionType:SD,commissionValue:l.number(),minPurchaseValue:l.number().nullish(),maxRebateValue:l.number().nullish(),destinationUrl:l.string(),domain:l.string(),merchantName:l.string(),expireTimeEpoch:l.number(),globalOfferId:l.string(),impressionGuid:l.string(),imageUrl:l.string(),productUrl:l.string(),scope:l.string(),offerType:UQ}),BQ=l.object({targetOffer:FQ,msClickId:l.string().nullish(),isAdClick:l.boolean().nullish(),ldData:l.string().nullish(),offerId:l.string().nullish(),rGuid:l.string().nullish(),scope:l.string().nullish()}),HQ=l.object({affiliateCashback:jQ.nullish(),adsCashback:BQ.nullish()}),w3e=bI.extend({otherBuyingOptions:l.array(mD).nullish(),priceInsight:gD.nullish(),tags:l.array(yI).nullish(),priceHistory:bD.nullish(),conversationStarters:l.array(yD).nullish(),insights:CD.nullish(),supportsPriceInsights:l.boolean(),cashback:HQ.nullish()}),$Q=l.object({product:lD.nullish(),offerId:l.string().nullish(),url:l.string().nullish(),name:l.string().nullish(),description:l.string().nullish(),images:l.array(vI).nullish(),filters:l.array(cD).nullish(),specifications:l.array(uD).nullish(),review:hD.nullish(),prosAndCons:fD.nullish(),price:Ar.nullish(),discountPrice:Ar.nullish(),seller:l.string().nullish(),sellerLogoUrl:l.string().nullish(),brandName:l.string().nullish(),rating:gI.nullish(),checkoutOption:pD.nullish(),curation:l.string().nullish(),canTrackPrice:l.boolean().nullish(),otherBuyingOptions:l.array(mD).nullish(),priceInsight:gD.nullish(),tags:l.array(yI).nullish(),priceHistory:bD.nullish(),conversationStarters:l.array(yD).nullish(),insights:CD.nullish()});l.object({metadata:$Q.nullish()});const E3e=l.object({products:_Q.array()}),zQ=l.object({category:l.string(),curationGroupId:l.string(),position:l.union([l.literal("top"),l.literal("middle"),l.literal("bottom")]).nullish()}),Kg=bI.extend({curationInfo:zQ.nullish()});l.object({product:Kg,messageId:l.string(),allProducts:l.array(Kg).nullish(),accessories:l.array(Kg).nullish()});const VQ=l.object({type:l.literal("shoppingCurated"),title:l.string().optional(),products:l.array(Kg),groupType:l.string().nullish()}),GQ=l.discriminatedUnion("type",[xQ,PQ,VQ]),T3e=l.object({emailNotificationEnabled:l.boolean()}),KQ=l.object({name:l.string(),url:l.string(),offerId:l.string()}),qQ=l.object({url:l.string(),source:l.string()}),WQ=l.object({reason:l.string(),references:l.array(qQ)}),YQ=l.enum(["buy-now","buy-later"]),I3e=l.object({whenToBuy:YQ,seller:KQ,supportingReasons:l.array(WQ)}),QQ=l.union([l.literal("top-highlight"),l.literal("buying-tip"),l.literal("ideal-for"),l.literal("review-snapshot")]),A3e=l.object({title:l.string(),content:l.string(),type:QQ,citations:l.array(mI)});l.object({isPDP:l.boolean(),name:l.string().nullish(),image:l.string().url().nullish(),base64_image:l.string().nullish(),price_currency:l.string().nullish(),price_value:l.coerce.number().nullish(),"aggregateRating/ratingValue":l.union([l.string(),l.nan()]).nullish(),"aggregateRating/reviewCount":l.union([l.string(),l.nan()]).nullish(),"offers/price":l.string().nullish()});l.object({name:l.string().optional(),rating:l.object({value:l.number(),count:l.number()}).optional(),images:l.array(l.object({url:l.string()})).optional(),price:l.object({amount:l.number(),currency:l.string().nullable(),currencySymbol:l.string().nullable()}).optional(),offerPrice:l.string().optional(),isPDP:l.boolean().optional()});const JQ=l.enum(["home","away"]),ba=l.enum(["win","loss","tie","no-game"]),wD=l.enum(["pre-game","in-progress","final","postponed","delayed","abandoned","cancelled"]),ZQ=l.enum(["test","odi","t20"]),XQ=l.enum(["test","limited-overs","super-over"]),eJ=l.enum([...wD.options,"drinks","dinner","tea","lunch","innings-break","super-over","toss","stumps","strategic-timeout","forfeited"]),tJ=l.enum([...wD.options,"bye","retired","forfeited","unscheduled","suspended"]),nJ=l.enum(["men-singles","men-doubles","women-singles","women-doubles","mixed-doubles"]),rJ=l.enum(["round-of256","round-of128","round-of64","round-of32","round-of16","quarter-final","semi-final","final"]),ED=l.object({name:l.string(),city:l.string().nullish()}),iJ=l.object({name:l.string(),thumbnailUrl:l.string().nullish(),seasonPhase:l.string().nullish(),seasonStartsAt:l.string().nullish(),seasonEndsAt:l.string().nullish(),leagueId:l.string()}),aJ=l.object({type:l.literal("league"),league:iJ}),Ov=l.object({name:l.string(),thumbnailUrl:l.string().nullish()}),oJ=l.object({type:l.literal("team"),team:Ov}),sJ=l.object({type:l.literal("matchup"),matchup:l.object({teamA:Ov,teamB:Ov})}),nm=l.discriminatedUnion("type",[aJ,oJ,sJ]),cJ=l.object({name:l.string(),alias:l.string().nullish(),thumbnailUrl:l.string().nullish()}),lJ=l.object({playerName:l.string(),clock:l.object({minutes:l.number(),seconds:l.number()})}),uJ=l.object({ballPossessionPercentage:l.number().nullish(),goals:l.array(lJ).nullish()}),ky=l.object({wins:l.number(),losses:l.number(),overtimeLosses:l.number().nullish()}),dJ=l.enum(["quarter","half","halftime","extra","penalties","shoot-out","overtime","inning","period"]),hJ=l.enum(["top","bottom"]),Xo=l.object({type:dJ,period:l.number().nullish(),division:hJ.nullish()}),rm=l.object({playingPeriod:Xo,score:l.string()}),Wr=cJ.extend({primaryColorHex:l.string().nullish(),venueType:JQ.nullish(),previousGameOutcomes:l.array(ba).nullish(),seed:l.number().nullish(),gameOutcome:ba.nullish(),score:l.string().nullish(),record:ky.nullish(),winProbability:l.number().nullish(),playingPeriodScores:l.array(rm).nullish()}),CI=Wr.extend({winProbability:l.number().nullish()}),TD=Wr.extend({score:l.string(),gameStats:uJ.nullish()}),fJ=TD.extend({gameOutcome:ba}),pJ=l.object({wins:l.number(),participantName:l.string()}),mJ=l.enum(["final","not-started","in-progress"]),gJ=l.enum(["national-championship","first-four","first-round","second-round","conference-semifinal","conference-final","sweet16","sweet-sixteen","elite-eight","final-four","final"]),vJ=l.object({state:mJ,winsInfo:l.array(pJ).nullish(),gameNumber:l.number().nullish(),conference:l.string().nullish()}),ID=vJ.extend({phase:gJ}),SI=l.object({name:l.string(),score:l.string()}),bJ=l.object({current:l.number(),total:l.number(),aggregatedScores:l.array(SI).nullish()}),wI=l.object({startsAt:l.string(),status:l.string(),leagueName:l.string(),legInfo:bJ.nullish(),leagueId:l.string().nullish(),gameId:l.string().nullish(),startTimeToBeAnnounced:l.boolean().nullish(),seasonPhase:l.string().nullish()}),Ol=l.object({minutes:l.number(),seconds:l.number()}),yJ=CI.extend({record:ky.nullish(),gameOutcome:ba.nullish(),score:l.string().nullish(),playingPeriodScores:l.array(rm).nullish(),gameStats:l.null().nullish()}),Ll=wI.extend({name:l.string().nullish(),week:l.number().nullish(),clock:Ol.nullish(),bracket:l.null().nullish(),currentPlayingPeriod:Xo.nullish()}),Dl=wI.extend({name:l.string().nullish(),bracket:ID.nullish(),week:l.number().nullish(),clock:Ol.nullish(),currentPlayingPeriod:Xo.nullish()}),CJ=Ll.extend({status:l.literal("pre-game"),participants:l.array(CI)}),EI=l.object({clock:Ol,description:l.string(),team:Ov,participantScores:l.array(SI).nullish()}),AD=EI.extend({type:l.enum(["score-change","yellow-card","red-card"])}),TI=EI.extend({type:l.enum(["three-point-made","two-point-made","touchdown","field-goal","extra-point","safety","two-point-conversion","blocked-punt-safety","blocked-field-goal-safety","fumble-safety"])}),jl=l.object({url:l.string(),thumbnailUrl:l.string(),title:l.string(),durationInSeconds:l.number().nullish()}),SJ=Dl.extend({status:l.literal("pre-game"),participants:l.array(yJ),timeline:l.object({events:l.array(TI)}).nullish(),videos:l.array(jl).nullish()}),wJ=Ll.extend({status:l.literal("in-progress"),participants:l.array(TD),clock:Ol,currentPlayingPeriod:Xo.nullish(),timeline:l.object({events:l.array(AD)}).nullish(),videos:l.array(jl).nullish()}),EJ=Ll.extend({status:l.literal("final"),participants:l.array(fJ),videos:l.array(jl).nullish(),timeline:l.object({events:l.array(AD)}).nullish()}),TJ=Ll.extend({status:l.literal("postponed"),participants:l.array(Wr)}),IJ=Ll.extend({status:l.literal("delayed"),participants:l.array(Wr)}),AJ=Ll.extend({status:l.literal("abandoned"),participants:l.array(Wr)}),kJ=Ll.extend({status:l.literal("cancelled"),participants:l.array(Wr)}),v1=l.discriminatedUnion("status",[CJ,wJ,EJ,AJ,kJ,IJ,TJ]),kD=Wr.extend({playingPeriodScores:l.array(rm).nullish(),score:l.string(),record:ky.nullish(),gameOutcome:ba.nullish(),winProbability:l.number().nullish(),gameStats:l.null().nullish()}),xJ=kD.extend({gameOutcome:ba}),_J=Dl.extend({status:l.literal("in-progress"),participants:l.array(kD),clock:Ol,currentPlayingPeriod:Xo,timeline:l.object({events:l.array(TI)}).nullish(),videos:l.array(jl).nullish()}),MJ=Dl.extend({status:l.literal("final"),participants:l.array(xJ),videos:l.array(jl).nullish(),clock:Ol.nullish(),currentPlayingPeriod:Xo.nullish(),timeline:l.object({events:l.array(TI)}).nullish()}),RJ=Dl.extend({status:l.literal("postponed"),participants:l.array(Wr)}),PJ=Dl.extend({status:l.literal("delayed"),participants:l.array(Wr)}),NJ=Dl.extend({status:l.literal("abandoned"),participants:l.array(Wr)}),OJ=Dl.extend({status:l.literal("cancelled"),participants:l.array(Wr)}),b1=l.discriminatedUnion("status",[SJ,_J,MJ,NJ,OJ,PJ,RJ]),LJ=l.object({type:l.literal("sportsSchedule"),sport:l.enum(["basketball","ice-hockey","football"]),games:l.array(b1),header:nm.nullish(),heroGame:b1.nullish()}),DJ=l.object({type:l.literal("sportsSchedule"),sport:l.literal("soccer"),games:l.array(v1),header:nm.nullish(),heroGame:v1.nullish()}),jJ=l.object({type:l.literal("sportsGame"),sport:l.enum(["basketball","ice-hockey","football"]),game:b1}),UJ=l.object({type:l.literal("sportsGame"),sport:l.literal("soccer"),game:v1}),Ul=wI.extend({name:l.string().nullish(),week:l.number().nullish(),videos:l.array(jl).nullish(),bracket:ID.nullish(),clock:Ol.nullish(),currentPlayingPeriod:Xo.nullish()}),xD=l.object({hits:l.number(),errors:l.number(),runs:l.number()}),II=EI.extend({type:l.enum(["conversion","bat"]),playingPeriod:Xo,participantScores:l.array(SI)}),_D=CI.extend({record:ky.nullish(),gameOutcome:ba.nullish(),score:l.string().nullish(),playingPeriodScores:l.array(rm).nullish(),gameStats:xD.nullish()}),MD=_D.extend({playingPeriodScores:l.array(rm).nullish(),score:l.string(),gameStats:xD.nullish()}),FJ=MD.extend({gameOutcome:ba}),BJ=Ul.extend({status:l.literal("pre-game"),participants:l.array(_D),timeline:l.object({events:l.array(II)}).nullish()}),HJ=Ul.extend({status:l.literal("in-progress"),participants:l.array(MD),currentPlayingPeriod:Xo.nullish(),timeline:l.object({events:l.array(II)}).nullish()}),$J=Ul.extend({status:l.literal("final"),participants:l.array(FJ),videos:l.array(jl).nullish(),timeline:l.object({events:l.array(II)}).nullish()}),zJ=Ul.extend({status:l.literal("postponed"),participants:l.array(Wr)}),VJ=Ul.extend({status:l.literal("delayed"),participants:l.array(Wr)}),GJ=Ul.extend({status:l.literal("abandoned"),participants:l.array(Wr)}),KJ=Ul.extend({status:l.literal("cancelled"),participants:l.array(Wr)}),y1=l.discriminatedUnion("status",[BJ,HJ,$J,zJ,VJ,GJ,KJ]),qJ=l.object({type:l.literal("sportsSchedule"),sport:l.literal("baseball"),games:l.array(y1),header:nm.nullish(),heroGame:y1.nullish()}),WJ=l.object({type:l.literal("sportsGame"),sport:l.literal("baseball"),game:y1}),YJ=l.object({ballsFaced:l.number(),runsScored:l.number(),isBatting:l.boolean()}),QJ=l.object({oversBowled:l.string(),wicketsTaken:l.number(),runsConceded:l.number(),isBowling:l.boolean()}),JJ=YJ.extend({type:l.literal("batting")}),ZJ=QJ.extend({type:l.literal("bowling")}),RD=l.discriminatedUnion("type",[JJ,ZJ]),XJ=l.object({name:l.string(),stats:RD}),eZ=l.object({playerName:l.string(),teamName:l.string(),gameStats:l.array(RD).nullish()}),tZ=l.object({current:l.number(),required:l.number().nullish()}),nZ=l.object({name:l.string(),currentMatch:l.number(),totalMatches:l.number(),roundName:l.string().nullish(),equation:l.string().nullish()}),PD=l.object({type:XQ,runs:l.number(),wickets:l.number(),oversPlayed:l.string(),isFollowedOn:l.boolean(),isDeclared:l.boolean(),duckworthLewisEquation:l.object({target:l.number(),revisedOvers:l.string()}).nullish()}),AI=l.object({name:l.string(),alias:l.string().nullish(),thumbnailUrl:l.string().nullish()}),rZ=AI.extend({previousGameOutcomes:l.array(ba).nullish()}),iZ=AI.extend({inningScores:l.array(PD).nullish(),playersStats:l.array(XJ).nullish(),yetToBat:l.boolean()}),aZ=AI.extend({gameOutcome:ba,didNotBat:l.boolean(),inningScores:l.array(PD).nullish()}),oZ=l.object({startsAt:l.string(),startTimeToBeAnnounced:l.boolean(),tossInfo:l.string().nullish(),participants:l.array(rZ),type:l.literal("pre")}),sZ=l.object({gameSummary:l.string(),runRate:tZ.nullish(),participants:l.array(iZ),type:l.literal("live")}),cZ=l.object({startsAt:l.string(),gameSummary:l.string(),playerOfTheMatch:eZ.nullish(),participants:l.array(aZ),type:l.literal("final")}),lZ=l.discriminatedUnion("type",[oZ,sZ,cZ]),C1=l.object({gameId:l.string(),leagueId:l.string(),venue:ED.nullish(),format:ZQ,status:eJ,seriesInfo:nZ,phase:lZ}),uZ=l.object({type:l.literal("sportsGame"),sport:l.literal("cricket"),game:C1}),dZ=l.object({type:l.literal("sportsSchedule"),sport:l.literal("cricket"),games:l.array(C1),header:nm.nullish(),heroGame:C1.nullable()}),hZ=l.object({name:l.string(),countryFlagThumbnailUrl:l.string().nullish(),seed:l.number().nullish()}),fZ=l.object({points:l.number(),isServing:l.boolean(),tieBreakerPoints:l.number().nullish(),currentGamePoints:l.string().nullish(),setWon:l.boolean().nullish()}),ND=l.object({players:l.array(hZ)}),pZ=ND,OD=ND.extend({setPoints:l.array(fZ)}),mZ=OD.extend({gameOutcome:ba}),gZ=l.object({type:l.literal("pre"),participants:l.array(pZ)}),vZ=l.object({type:l.literal("live"),participants:l.array(OD)}),bZ=l.object({type:l.literal("final"),participants:l.array(mZ)}),yZ=l.discriminatedUnion("type",[gZ,vZ,bZ]),wM=l.object({gameId:l.string(),leagueId:l.string(),status:tJ,startsAt:l.string().nullish(),startTimeToBeAnnounced:l.boolean(),venue:ED.nullish(),matchType:nJ,round:rJ.nullish(),phase:yZ}),CZ=l.object({type:l.literal("sportsSchedule"),sport:l.literal("tennis"),games:l.array(wM),header:nm.nullish(),heroGame:wM.nullish()}),SZ=l.union([LJ,DJ,qJ,dZ,CZ]),wZ=l.discriminatedUnion("sport",[UJ,jJ,WJ,uZ]),EZ=l.union([SZ,wZ]),TZ=l.object({title:l.string(),description:l.string(),startTime:l.number(),endTime:l.number()}),IZ=l.object({video:l.object({url:l.string(),thumbnailUrl:l.string(),duration:l.number(),title:l.string(),isShort:l.boolean()}),source:l.object({url:l.string(),iconUrl:l.string().optional()}),bestMomentIndex:l.number().optional(),moments:l.array(TZ).optional()}),AZ=l.object({type:l.literal("video"),videos:l.array(IZ)}),kZ=l.enum(["c","f"]),xZ=l.enum(["mm","cm","in"]),_Z=l.enum(["hPa","inHg","mb","mmHg"]),MZ=l.enum(["bft","kph","mph","ms"]),RZ=l.enum(["m","km","mi"]),PZ=l.object({temperature:kZ,height:xZ,pressure:_Z.optional(),speed:MZ.optional(),distance:RZ.optional()}),kI=l.enum(J5),NZ=l.enum(["rain","snow"]),xI=l.object({type:NZ.nullish(),amount:l.number().nullish(),chance:l.number()}),OZ=l.object({current:l.number(),high:l.number().optional(),low:l.number().optional()}),LZ=l.object({at:l.string(),state:kI,summary:l.string(),description:l.string().optional(),temperature:OZ,precipitation:xI.optional()}),LD=l.object({high:l.number(),low:l.number()}),DZ=l.object({date:l.string(),state:kI,temperature:LD,precipitation:xI.optional()}),jZ=l.object({at:l.string(),state:kI,temperature:LD,precipitation:xI.optional()}),UZ=l.object({daily:l.array(DZ),hourly:l.array(jZ).nullish().optional()}),FZ=l.object({type:l.literal("weather"),location:l.string(),units:PZ,spotlight:LZ.optional(),forecast:UZ}),bp=l.enum(J5),BZ=l.object({type:l.literal("weatherTemperatureHourly"),location:l.string(),unit:l.union([l.literal("f"),l.literal("c")]),spotlight:l.object({date:l.string(),state:bp,summary:l.string(),temperature:l.number().optional(),high:l.number(),low:l.number()}),forecast:l.array(l.object({at:l.string(),state:bp,temperature:l.number(),precipitationChance:l.number()}))}),HZ=l.object({type:l.literal("weatherTemperatureDaily"),location:l.string(),unit:l.union([l.literal("f"),l.literal("c")]),forecast:l.array(l.object({date:l.string(),state:bp,high:l.number(),low:l.number(),precipitationChance:l.number()}))}),DD=l.union([l.literal("rain"),l.literal("snow")]),jD=l.union([l.literal("in"),l.literal("mm")]),$Z=l.object({type:l.literal("weatherPrecipitationHourly"),location:l.string(),unit:jD,precipitationType:DD,spotlight:l.object({date:l.string(),summary:l.string(),amount:l.number(),chance:l.number()}),forecast:l.array(l.object({at:l.string(),state:bp,amount:l.number(),chance:l.number()}))}),zZ=l.object({type:l.literal("weatherPrecipitationDaily"),location:l.string(),unit:jD,precipitationType:DD,forecast:l.array(l.object({date:l.string(),state:bp,amount:l.number(),chance:l.number()}))}),VZ=l.union([FZ,BZ,HZ,$Z,zZ]),UD=l.union([QW,XW,NY,UY,$Y,zY,VY,WY,YY,oQ,eQ,sQ,wQ,EQ,vY,mY,GQ,GY,EZ,AZ,VZ,kQ,eY,gY,iQ,jY]),GZ=l.object({id:l.string(),imageUrl:l.string(),voiceId:l.string()}),us=l.object({light:l.string(),dark:l.string()}),KZ=l.object({foreground1:us,foreground2:us,accent:us,shape:us,shapeInverse:us,background1:us,background2:us,background3:us}),EM=l.object({name:l.enum(["ginto-copilot-nord-bold","ginto-copilot-nord-medium-italic","ginto-copilot-480","kari-regular"]),url:l.string().url()}),qZ=l.object({name:l.string(),url:l.string().url()}),Ud=l.object({url:l.string().url()}),Fd=l.object({urlLight:l.string().url(),urlDark:l.string().url()}),S1=l.object({url:l.string().url()}),sh=l.object({type:l.string(),title:l.string()}),WZ=sh.extend({type:l.literal("coverPage"),content:l.string(),template:l.enum(["image-background","fuzzy-image"]),image0:Ud,sticker0:Fd.nullish(),sticker1:Fd.nullish()}),YZ=sh.extend({type:l.literal("heroImage"),content:l.string(),template:l.enum(["noisy-circle","macaron","wavy-shape"]),image0:Ud}),QZ=sh.extend({type:l.literal("stickerSheet"),content:l.string(),template:l.enum(["sticker1","sticker2"]),sticker0:Fd,sticker1:Fd,accent0:S1,accent1:S1}),JZ=sh.extend({type:l.literal("simpleText"),content:l.string(),template:l.string().nullish()}),ZZ=sh.extend({type:l.literal("photoJournal"),content:l.string().nullish(),template:l.enum(["shapes-only","shapes-accents"]),variation:l.enum(["shape-group1","shape-group2"]),label0:l.string(),label1:l.string(),image0:Ud,image1:Ud,sticker0:Fd.nullish(),accent0:S1.nullish()}),XZ=sh.extend({type:l.literal("endPage"),content:l.string(),template:l.enum(["wide-cards","tall-cards"]),variation:l.enum(["shape-group1","shape-group2"]),questions:l.array(l.string()),image0:Ud,image1:Ud.nullish(),sticker0:Fd}),eX=l.object({type:l.literal("shareDefault"),template:l.string().nullish()}),tX=l.discriminatedUnion("type",[WZ,YZ,QZ,JZ,ZZ,XZ,eX]),nX=l.object({id:l.string(),modifiedAt:l.string(),theme:KZ,font:EM,fontHandwriting:EM.nullish(),masks:l.array(qZ),sections:l.array(tX)}),rX=l.object({type:l.literal("chatAboutNarrative"),narrativeId:l.string(),messageIndex:l.number()}),iX=l.object({id:l.string(),text:l.string(),createdAt:l.string()}),aX=l.object({results:l.array(iX),next:l.string().nullable()}),oX=l.object({type:l.literal("provideImageFeedback"),messageId:l.string(),feedbackTypes:l.array(l.string())}),sX=l.object({type:l.literal("createPage"),messageId:l.string()}),cX=l.object({type:l.literal("appendToPage"),messageId:l.string(),pageId:l.string()}),lX=l.object({id:l.string(),conversationId:l.string()}),k3e=l.object({title:l.string().nullish(),content:l.string().nullish(),conversationId:l.string()}),uX=ii.extend({type:l.literal("page"),page:l.object({id:l.string(),conversationId:l.string(),title:l.string().nullish()})}),dX=l.object({id:l.string(),title:l.string().nullish(),updatedAt:l.string(),conversationId:l.string().optional(),type:l.enum(["page","sharedPage"]).optional()}),hX=l.object({results:l.array(dX),next:l.string().nullish()}),x3e=l.object({title:l.string().nullish(),content:l.string().nullish(),page:l.object({id:l.string()}).nullable()}),_3e=l.object({id:l.string(),url:l.string()}),fX=l.enum(["page-count-exceeded","page-content-length-exceeded"]),pX=l.object({errorCode:fX}),M3e=l.enum(["public","user"]),R3e=l.object({id:l.string(),url:l.string()});l.object({type:l.literal("podcast"),id:l.string().min(1)});const FD=l.literal("generatePodcast"),mX=l.object({type:FD,taskId:l.string().min(1)}),gX=l.object({prompt:l.string()}),xy=l.literal("executeTask"),vX=l.object({type:xy,taskId:l.string(),context:gX.optional()}),bX=l.string(),yX=l.object({currentConversationId:l.string().nullable(),isNewUser:l.boolean(),banExpiresAt:l.string().nullable(),remainingTurns:l.number().nullable(),features:l.array(bX),allowBeta:l.boolean().nullish(),userId:l.string().nullish(),inDataUseWaitingPeriod:l.boolean().nullish()}),CX=l.object({id:l.string(),name:l.string(),previewUrl:l.string(),voicemails:l.array(l.string())}),SX=l.object({id:l.string(),backgroundImageUrl:l.string()}),wX=l.object({id:l.string(),name:l.string(),location:SX.nullish()}),ha=l.object({type:l.string(),label:l.string()}),EX=l.array(ha),TX=l.object({positive:l.array(ha),negative:l.array(ha)}),na=l.union([EX,TX]),dc=l.object({type:l.string(),label:l.string(),subOptions:l.array(ha).nullish()}),BD=l.object({local:na,ads:na,video:na,image:na,sports:na,job:na,shopping:na,recipe:na,finance:na,quiz:na,weather:na}),IX=l.object({positive:l.array(ha).nullish(),negative:l.array(ha)});BD.keyof();const HD=l.object({newsArticle:l.array(dc),newsVideo:l.array(dc),newsGem:l.array(dc),chat:l.array(dc),dailyBriefing:l.array(dc),podcast:l.array(dc),default:l.array(dc)});HD.keyof();const AX=l.object({computerUse:l.array(ha)}),kX=l.object({text:l.array(ha),image:l.array(ha),call:l.array(ha),appearance:l.array(ha),card:BD,showroom:IX.nullish(),discover:HD.nullish(),task:AX.nullish()}),xX=l.object({maxFilesPerMessage:l.number(),maxFileNameLength:l.number(),image:l.object({mimeTypes:l.array(l.string()),maxBytes:l.number()}),document:l.object({mimeTypes:l.array(l.string()),maxBytes:l.number()}),binary:l.object({mimeTypes:l.array(l.string()),maxBytes:l.number()})}),_X=l.object({minTextLength:l.number().min(0),textDeltaPercent:l.number().min(0).max(100),debounceInMilliseconds:l.number().min(0)}),MX=l.object({signInPrompts:l.array(l.number()),voices:l.array(CX),maxTextMessageLength:l.number(),feedbackOptions:kX,characters:l.array(wX).nullish(),pageLimit:l.number(),maxPageContentLength:l.number(),maxPageTitleLength:l.number(),messagePreview:_X,attachments:xX,portraits:l.array(GZ).nullish()});l.object({hasVisionAccess:l.boolean(),allowedDomains:l.array(l.string()).nullable(),allowedDomainSuffixes:l.array(l.string()).nullable(),blockedDomains:l.array(l.string()).nullable(),blockedDomainSuffixes:l.array(l.string()).nullable()});const RX=l.object({startTime:l.string(),text:l.string()}),PX=l.object({startTime:l.string(),text:l.string(),words:l.array(RX)}),TM=l.object({url:l.string(),duration:l.number(),transcript:l.array(PX).nullish()}),NX=l.object({title:l.string(),image:l.string(),url:l.string(),createdAt:l.string()}),OX=l.object({publisherName:l.string(),publisherIcon:l.string(),articles:l.array(NX)}),IM=l.object({url:l.string(),foregroundColor:l.string(),backgroundColor:l.string()}),AM=l.object({name:l.string(),foregroundColor:l.string(),backgroundColor:l.string(),altText:l.string().nullish(),url:l.string()}),LX=l.object({landscape:AM,portrait:AM}),DX=l.object({id:l.string(),title:l.string(),image:l.object({landscape:IM,portrait:IM}),audio:l.record(l.string(),TM),transitionMusic:TM.nullable(),sources:l.array(OX)}),$D=l.object({topics:l.array(l.object({id:l.string(),label:l.string(),imageUrl:l.string(),isFollowed:l.boolean()}))}),jX=l.object({position:l.number(),chapterId:l.string()}),zD=l.object({isAvailable:l.boolean(),podcastId:l.string(),chapters:l.array(DX),topics:$D.optional(),playback:jX}),UX=l.object({positionInSeconds:l.number(),chapterId:l.string()}),FX=l.object({id:l.string(),title:l.string(),topic:l.string().nullable().optional(),image:LX,audio:l.object({name:l.string(),duration:l.number()})}),Lv=l.object({isAvailable:l.boolean(),podcastId:l.string(),chapters:l.array(FX),playback:UX}),BX=l.enum(OV),HX=l.enum(PV),$X=l.enum(NV),zX=l.object({channel:$X,tier:HX,isAutoRenew:l.boolean()}),VD=l.object({id:l.string(),firstName:l.string().nullable(),anid:l.string().nullable(),isPro:l.boolean(),isDeprecated:l.boolean().nullish(),inEeaPlusRegion:l.boolean(),regionCode:l.enum(Object.values(Yp)),isHistoryMigrationPending:l.boolean(),isEligibleForFreeTrial:l.boolean().optional(),phoneLink:l.object({deviceName:l.string().nullable()}).nullable(),ageGroup:l.enum(MV).nullable(),allowedToggles:l.object({textTraining:l.boolean(),voiceTraining:l.boolean(),personalization:l.boolean(),browserActions:l.boolean()}),remainingCalls:l.object({reasoning:l.number(),podcastGeneration:l.number(),research:l.number()}).nullish(),accountTier:BX.nullish(),subscriptions:l.array(zX).nullish()}),VX=l.object({preferredVoice:l.string().nullable(),preferredCharacter:l.string().nullable().optional(),optOutOfTraining:l.boolean(),optInToVoiceTraining:l.boolean(),optOutOfPersonalization:l.boolean(),optOutOfPhoneConnection:l.boolean(),optInToGenerativeUI:l.boolean().optional(),allowBiometricDataUse:l.boolean().optional(),allowOneDriveAccess:l.boolean().optional(),allowBrowserActions:l.boolean().optional(),features:l.object({suggestedFollowups:l.boolean().optional()}).nullish()}),GD=l.object({errorCode:l.union([l.literal("attachment-too-large"),l.literal("unsupported-content-type"),l.literal("empty-attachment"),l.literal("content-blocked"),l.literal("rate-limit-exceeded"),l.literal("not-signed-in")])}),GX=l.union([l.object({url:l.string()}),GD]),KD=l.union([l.object({id:l.string()}),GD]),KX=l.object({id:l.string(),title:l.string().optional(),updatedAt:l.string(),characterId:l.string().nullable().optional(),continuedAt:l.string().nullable()}),qX=l.object({results:l.array(KX),next:l.string().nullable()}),WX=l.object({id:l.string()}),qD=l.union([l.literal("thumbs-down"),l.literal("thumbs-up"),l.null()]),_y=l.union([l.literal("running"),l.literal("completed"),l.literal("failed"),l.literal("cancelled"),l.literal("pending"),l.literal("paused")]),YX=l.union([l.literal("research"),l.literal("computerUse"),l.literal("podcast")]),QX=l.object({type:l.literal("chainOfThought"),text:l.string()}),JX=l.object({type:l.literal("query"),text:l.string()}),ZX=l.object({type:l.literal("citation"),title:l.string(),url:l.string()}),XX=l.discriminatedUnion("type",[QX,JX,ZX]),eee=l.object({id:l.string(),title:l.string().nullish(),contents:l.array(XX).nullish(),inlineCitations:l.array(mI).nullish(),partialOutput:l.array(l.string()).nullish(),finalResponse:l.string().nullish(),type:l.literal("research"),status:_y,prompt:l.string().optional()}),WD=l.object({url:l.string(),createdAt:l.string()}),tee=l.object({type:l.literal("computerUse"),title:l.string().nullish(),conversationId:l.string().nullish(),id:l.string(),status:_y,lastScreenshot:WD.nullish(),updatedAt:l.string().nullish()}),YD=l.object({id:l.string(),title:l.string().nullish(),thumbnail:l.object({name:l.string().nullish()}).nullish()}),nee=l.object({type:l.literal("podcast"),id:l.string(),podcast:YD.nullish(),status:_y,updatedAt:l.string().nullish()}),QD=l.discriminatedUnion("type",[eee,tee,nee]),_I=l.object({id:l.string(),title:l.string().optional(),conversationId:l.string().optional(),updatedAt:l.string(),status:_y,type:YX}),ree=_I.extend({type:l.literal("research")}),iee=_I.extend({type:l.literal("computerUse"),screenshot:l.string().nullish(),lastScreenshot:WD.nullish(),chainOfThought:l.array(l.string()).nullish(),computerAction:l.string().nullish(),statusChange:iY.optional(),lastUserCommand:Nl.optional(),reaction:qD.optional(),activeTabFaviconUrl:l.string().nullish(),activeTabTitle:l.string().nullish(),viewMode:dY.nullish(),replay:fY.nullish()}),aee=_I.extend({type:l.literal("podcast"),podcast:YD.nullish()}),oee=l.discriminatedUnion("type",[ree,iee,aee]),P3e=l.object({results:l.array(oee),next:l.string().nullable()}),Fl=l.union([l.literal("report"),...qD.options]),see=l.union([l.literal("generating"),l.literal("generated"),l.literal("failed"),l.literal("non-complete")]),JD=l.object({id:l.string(),createdAt:l.string()}),cee=l.object({index:l.string(),title:l.string(),url:l.string(),iconUrl:l.string().nullable(),publisher:l.string().nullable(),snippet:l.string().nullable()}),lee=ii.extend({type:l.literal("image"),url:l.string().optional(),prompt:l.string().optional().nullable(),isPartiallyLoading:l.boolean().optional(),reaction:Fl.optional(),partialGenerationStep:l.number().optional(),status:see.optional(),progressionText:l.string().nullable().optional()}),uee=ii.extend({type:l.literal("citation"),...mI.shape}),dee=ii.extend({type:l.literal("text"),text:l.string(),citations:l.array(cee).optional(),reaction:Fl.optional()}),hee=ii.extend({type:l.literal("task"),task:QD.nullish(),reaction:Fl.optional()}),fee=ii.extend({type:l.literal("card"),card:UD,reaction:Fl.optional()}),pee=l.union([l.literal("loading"),l.literal("success"),l.literal("failed")]),mee=ii.extend({type:l.literal("indicator-ai-response"),text:l.string(),state:pee}),gee=ii.extend({type:l.literal("document"),attachmentId:l.string(),fileName:l.string(),contentType:l.string(),reaction:Fl.optional()}),vee=ii.extend({type:l.literal("deleted"),partType:l.enum(["page","task"])}),bee=ii.extend({type:l.literal("error"),text:l.string()});l.object({text:l.string(),title:l.string().optional(),lastSubActionScreenshotUrl:l.string().nullish()});const ZD=ii.extend({type:l.literal("chainOfThought"),text:l.string(),title:l.string().optional(),screenshotUrl:l.string().nullish(),reaction:Fl.optional(),partId:l.string()}),yee=l.union([ZD,KL]),Cee=ii.extend({type:l.literal("chainOfThoughtGroup"),items:l.array(yee).optional(),isComplete:l.boolean()}),See=ii.extend({type:l.literal("memorySignal"),text:l.string(),signalType:l.union([l.literal("remember"),l.literal("forget")]).nullish()}),wee=l.object({position:l.union([l.literal("left"),l.literal("right")]),isDefault:l.boolean(),isStreamingComplete:l.boolean().optional()}),Eee=l.discriminatedUnion("type",[dee,lee,uX,uee,bee,fee,gee,hee,vee,ZD,Cee,KL,See,mee]),Tee=l.object({type:l.literal("text"),text:l.string()}),Iee=l.object({type:l.literal("browserTabs"),tabs:l.array(l.object({title:l.string().optional(),url:l.string().optional(),id:l.number().optional(),favIconUrl:l.string().optional(),windowId:l.number()}))}),Aee=l.object({type:l.literal("image"),url:l.string()}),kee=l.object({type:l.literal("document"),partId:l.string(),fileName:l.string(),contentType:l.string()});l.object({type:l.literal("document"),attachmentId:l.string()});l.union([Nl,xy]);l.union([l.literal("provideImageFeedback"),l.literal("createPage"),l.literal("appendToPage"),l.literal("promptCharacterSpeech"),l.literal("chatAboutNarrative"),Nl,xy,FD]);const xee=l.object({type:l.literal("promptCharacterSpeech")}),_ee=l.discriminatedUnion("type",[oX,sX,cX,aY,oY,sY,cY,lY,uY,xee,rX,vX,mX]),Mee=l.object({type:l.literal("command"),command:_ee}),Ree=l.object({type:l.literal("dailyBriefing"),chapterId:l.string()}),Pee=l.object({type:l.literal("greeting"),greetingMessage:l.string()}),Nee=l.object({type:l.literal("news"),articleId:l.string()}),Oee=l.object({type:l.literal("newsGem"),gemId:l.string(),snapshotKey:l.string()}),Lee=l.discriminatedUnion("type",[Ree,Pee,Nee,Oee]);l.object({type:l.literal("reference"),reference:Lee});const Dee=l.discriminatedUnion("type",[Tee,Aee,kee,Mee,Iee]),XD=l.enum(["chat","smart","study","reasoning","research","computerUse"]),jee=JD.extend({author:l.literal("ai"),content:l.array(Eee),mode:XD.optional(),sideBySideConfig:wee.optional(),reaction:Fl.optional()}),Uee=JD.extend({author:l.literal("human"),content:l.array(Dee)}),e3=l.discriminatedUnion("author",[jee,Uee]),t3=l.object({results:l.array(e3),next:l.string().nullable()}),Fee=l.object({messages:l.array(e3),conversationTitle:l.string()}),N3e=l.object({url:l.string()}),Bee=l.object({conversation:l.object({id:l.string(),title:l.string()})});l.object({qc:l.object({q:l.string(),gt:l.string(),sc:l.string()}),s:l.array(l.object({st:l.string(),t:l.string()}))});const MI=l.union([l.literal("active"),l.literal("banned"),l.literal("ineligible")]),RI=l.union([l.literal("active"),l.literal("not-started"),l.literal("expired"),l.literal("paused")]),Hee=l.union([l.literal("not-started"),l.literal("completed"),l.literal("ineligible")]),$ee=l.object({id:l.string(),type:l.string(),points:l.number()}),zee=l.object({redeemableCount:l.number(),redeemedCount:l.number(),skus:l.array($ee)}),O3e=l.object({userStatus:MI,status:RI,startAt:l.string(),endAt:l.string(),referralCode:l.string().nullish(),referralTaskStatus:Hee.nullish(),rewards:zee.nullish()}),L3e=l.object({userStatus:MI.nullish(),programStatus:RI}),D3e=l.object({userStatus:MI.nullish(),programStatus:RI,lastRequestTime:l.string(),userId:l.string()}),_S=l.enum(["prefillComposer","sendMessage","deepLink"]),PI=l.discriminatedUnion("type",[l.object({type:l.literal(_S.enum.prefillComposer),prompt:l.string()}),l.object({type:l.literal(_S.enum.sendMessage),prompt:l.string()}),l.object({type:l.literal(_S.enum.deepLink),uri:l.string()})]),n3=l.object({id:l.string(),text:l.string(),action:PI}),Vee=l.object({id:l.string(),text:l.string(),thumbnail:l.object({url:l.string(),altText:l.string()}),action:PI}),Gee=l.object({id:l.string(),text:l.string(),action:PI}),Kee=l.object({id:l.string(),label:l.string(),items:l.array(n3)}),qee=l.discriminatedUnion("type",[l.object({type:l.literal("text"),id:l.literal("conversation-starter"),title:l.string().nullish(),items:l.array(n3)}),l.object({type:l.literal("textAndImage"),id:l.union([l.literal("feature-discovery"),l.literal("kickstarter"),l.literal("image-generation")]),title:l.string().nullish(),items:l.array(Vee)}),l.object({type:l.literal("textAndGreeting"),id:l.string(),title:l.string().nullish(),greeting:l.string().nullish(),items:l.array(Gee)}),l.object({type:l.literal("categories"),id:l.literal("categorized-conversation-starter"),title:l.string().nullish(),categories:l.array(Kee)})]),Wee=l.object({widgets:l.array(qee)});l.object({Questions:l.array(l.string()),Url:l.string(),NormalizedUrl:l.string().optional(),DebugInfo:l.string().optional()});l.object({tabId:l.number(),windowId:l.number(),url:l.string(),title:l.string(),content:l.string()});const Yee=l.object({id:l.string(),type:l.enum(jV),status:l.enum(DV)}),Qee=l.object({connections:l.array(Yee)}),Jee=l.object({id:l.string(),loginUrl:l.string()}),r3=["ActionsLimit","ActionsLimit-FromWinNative","ActionsLimit-FromEdgeCopilotMode","DeepResearchLimit","DeepResearchLimit-FromWinNative","DeepResearchLimit-FromEdgeCopilotMode","VisionLimit","VisionLimit-FromWinNative","VisionLimit-FromEdge","VisionLimit-FromEdgeCopilotMode","PodcastLimit","PodcastLimit-FromWinNative","PodcastLimit-FromEdgeCopilotMode","Management","Management-FromWinNative","MarketSelect","Settings","Settings-FromWinNative","ChatReasoningLimit","ProfileUpdateRequired","VoiceLimit","Unknown"],j3e={Pageseditor:"pageseditor-supported-features"},i3=l.discriminatedUnion("eventName",[l.object({eventName:l.literal("auth0.accountAdded")}),l.object({eventName:l.literal("auth0.accountRemoved")})]),Zee=["imagegeneration","f1","school"],wf={OPENED:0,RECENT:1,HISTORY:2},a3={connectorConsentFlowStartUrl:l.string(),parsedPayflowEntryPoint:l.enum(r3),payflowAuthHint:l.string(),payflowCorrelationId:l.string(),payflowRequiresPremium:l.string(),shouldStartSubscription:l.boolean(),"sticky-conversation-mode":XD};function NI(n,e){try{return a3[n].parse(e),sessionStorage.setItem(n,JSON.stringify(e)),!0}catch{return!1}}function yp(n){const e=sessionStorage.getItem(n);if(!e)return null;try{const t=JSON.parse(e);return a3[n].parse(t)}catch{return null}}function kM(n){sessionStorage.removeItem(n)}Pq();const Bl=O(!1),My=O(void 0),MS=O(ni()),Cn=O(n=>n(MS),(n,e,t)=>{if(n(MS)===t)return;e(MS,t),$e("sticky-conversation-mode")&&NI("sticky-conversation-mode",t)}),Sn=O(new Map),lt=O(void 0),Dv=O(null),RS=O(void 0),OI=O(n=>n(RS),(n,e,t)=>{const r=n(RS);r!==t&&(e(Sn,i=>{const a=new Map(i);return r&&a.delete(r),a}),e(RS,t))}),o3=O(null),ai=O(n=>{const e=n(lt);if(e)return n(Sn).get(e)}),Xee=RT(ai,n=>(n==null?void 0:n.streamingState)==="streaming",(n,e)=>n===e),U3e=n=>RT(Sn,e=>{var t;return((t=e.get(n))==null?void 0:t.streamingState)==="streaming"},(e,t)=>e===t),dd=O(!1),ya=O(new Map),F3e=O([]);O([]);const B3e=n=>O(e=>e(ya).get(n)),po=O(n=>{var e;return((e=n(ai))==null?void 0:e.history)??[]}),LI=O(n=>{const e=n(Sn);for(const t of e.values())if(!t.title&&!t.history.length&&t.isNew)return t.id}),DI=O(new Map),Ef=O(void 0),Ry=O([]),s3=O(!1),jI=O(n=>{var e;return zL((e=n(ai))==null?void 0:e.characterId)}),Gc=O("idle"),c3=O(!1),qi=O(null),ete=O("idle"),Df=O("checking-availability"),tte=O(null),l3=O([]),ol=O(null),UI=O(null),FI=O([]),nte=O([]),u3=O(null),rte=O(n=>n(ol)===0),BI=O(null),d3=O(null),ite=O(null),jf=O(!1),h3=O(!1),f3=O(FV),Cp=O(void 0),ate=O(!0),p3=O(null),ote=O(n=>!!n(p3)),ste=O(void 0);O(null);const ch=O(!1);O(null);const Py=O(void 0),cte=O(void 0),lte=O(void 0),ute=O(n=>{const e=n(ai);return e==null?void 0:e.suggestedFollowup}),H3e=O(void 0),m3=O(null),$3e=O(!1),dte=O(!1),HI=O(void 0),z3e=O(!1),V3e=O(void 0);O(null);const hte=O(null),$I=O(!1),Hl=O(void 0),G3e=wy({}),Ny=O(void 0),Vr=O("chat-only"),K3e=O(null),q3e=O(null),W3e=O(null),fte=O(null),g3=O({}),zI=O(!1),Mo=O(null),v3=O({data:void 0,isLoading:!1}),pte=O(n=>n(v3).data),b3=O(n=>n(v3).isLoading),qg=O(!1),y3=O(null);O(n=>{const e=n(y3);return(e==null?void 0:e.lcp)??null});const C3=O(null),mte=tc({key:Hq,schema:l.record(l.string()),initialValue:{}}),S3=O(null),w3=O(!1),gte=O([]),Y3e=O(null),vte=["m365-family-classic-guest","m365-family-guest","m365-premium-guest"],bte="App Store",yte="Google Play",Cte=["m365-personal","m365-family-admin"],E3=["m365-family-guest","m365-premium-guest","m365-premium-admin"],Ste=["m365-personal","m365-family-admin"],xM=["pro","m365-premium-admin","m365-family-admin","m365-personal","m365-personal-classic","m365-premium-guest","m365-family-guest","m365-family-classic-admin","m365-family-classic-guest","m365-basic"];function wte(n,e=!1){return n.length===0?e?"buypremium":"buym365":n.some(t=>t.tier==="pro")?"buypremium":n.some(t=>E3.includes(t.tier))?null:n.some(t=>Ste.includes(t.tier))||e?"upgradepremium":"upgradem365"}function Q3e(n){return n.length>0&&!n.some(e=>e.tier==="pro")}function J3e(n){return n.some(e=>Cte.includes(e.tier))&&!n.some(e=>E3.includes(e.tier))}function Ete(n){return n.slice().sort((e,t)=>xM.indexOf(e.tier)-xM.indexOf(t.tier))}function Z3e(n){const e=n.find(t=>t.tier==="pro");return(e==null?void 0:e.isAutoRenew)??!1}function Tte(n){const e=n==null?void 0:n.tier,t=n==null?void 0:n.channel,r=e!==void 0&&!vte.includes(e)&&(t==="apple"||t==="google");return{shouldRedirectMobile:r,redirectMobileSource:r?t:null}}function X3e({isM365SkuEnabled:n,isPro:e,subscriptions:t}){return n?t.length===0&&!e:!e}function Ite(n){return n.toLowerCase()==="zh-hant"?"zh-TW":n}function e4e(n,e){const t=e?`${n}-From${e}`:n;return r3.find(r=>r.toLowerCase()===t.toLowerCase())??"Unknown"}const im="ellie",T3=[im],_M=l.union([l.enum(T3),l.undefined()]),Ate=l.object({model:l.literal("vasa"),eyesOpenRatio:l.array(l.number()).min(1),eyesPose:l.array(l.number()).min(6),jawPose:l.array(l.number()).length(3),neckPose:l.array(l.number()).length(3),rotation:l.array(l.number()).length(3),translation:l.array(l.number()).length(3),viseme:l.array(l.number()).min(10)}),kte=l.object({model:l.literal("spda2e"),poseDiffusion:l.array(l.number())}),xte=l.object({type:l.literal("topicList"),id:l.string(),topics:l.array(l.object({text:l.string()})).nullable(),selectedIndex:l.number().nullable()}),_te=xte.nullable(),Mte=l.union([l.string(),l.number(),l.boolean(),l.null()]),Sp=l.lazy(()=>l.union([Mte,l.array(Sp),l.record(Sp)])),Rte=l.object({op:l.literal("add"),path:l.string(),value:Sp}),Pte=l.object({op:l.literal("remove"),path:l.string()}),Nte=l.object({op:l.literal("replace"),path:l.string(),value:Sp}),Ote=l.object({op:l.literal("move"),from:l.string(),path:l.string()}),Lte=l.object({op:l.literal("copy"),from:l.string(),path:l.string()}),Dte=l.object({op:l.literal("test"),path:l.string(),value:Sp}),jte=l.discriminatedUnion("op",[Rte,Pte,Nte,Ote,Lte,Dte]),MM=l.array(jte),Ute=l.union([l.literal("event-not-recognized"),l.literal("over-turn-limit"),l.literal("unknown-error"),l.literal("message-too-large"),l.literal("invalid-event"),l.literal("empty-message"),l.literal("empty-text"),l.literal("text-too-long"),l.literal("multiple-text-parts"),l.literal("multiple-image-parts"),l.literal("too-many-messages"),l.literal("over-reasoning-quota"),l.literal("over-lifetime-task-quota"),l.literal("over-task-quota"),l.literal("page-content-length-exceeded"),l.literal("page-count-exceeded"),l.literal("character-out-of-capacity"),l.string()]),Fte=l.union([l.literal("blocked"),l.literal("not-signed-in"),l.literal("failed"),l.string()]),I3=l.union([l.literal("quiz"),l.literal("generative-ui")]),A3=l.union([l.literal("throttled"),l.literal("throttled-non-pro"),l.literal("time-expired"),l.literal("time-expired-non-pro"),l.literal("not-in-flight"),l.literal("error"),l.literal("signed-out"),l.literal("region-not-available"),l.literal("time-expired-month"),l.literal("time-expired-month-non-pro")]),Bte=l.object({voice:l.string().optional(),speed:l.number().min(50).max(200).optional()}).partial(),RM=l.number().min(0).max(200).default(100),PM=l.union([l.literal("standard"),l.literal("character")]),NM=l.discriminatedUnion("event",[Xp,l.object({event:l.literal("pong"),id:l.string()}),l.object({event:l.literal("connected"),id:l.string(),requestId:l.string()}),l.object({event:l.literal("received"),conversationId:l.string(),messageId:l.string(),createdAt:l.string()}),l.object({event:l.literal("emojiReaction"),messageId:l.string(),emoji:l.string()}),l.object({event:l.literal("startMessage"),conversationId:l.string(),messageId:l.string(),createdAt:l.string()}),l.object({event:l.literal("appendText"),messageId:l.string(),text:l.string(),partId:l.string()}),l.object({event:l.literal("replaceText"),messageId:l.string(),text:l.string(),partId:l.string()}),l.object({event:l.literal("titleUpdate"),conversationId:l.string(),title:l.string()}),l.object({event:l.literal("generatingImage"),messageId:l.string(),prompt:l.string(),partId:l.string(),progressionText:l.string().nullable().optional()}),l.object({id:l.string(),event:l.literal("generatingImages"),messageId:l.string(),partIds:l.array(l.string()),prompt:l.string()}),l.object({event:l.literal("imageGenerated"),messageId:l.string(),url:l.string(),partId:l.string()}),l.object({event:l.literal("partialImageGenerated"),messageId:l.string(),url:l.string(),partId:l.string(),content:l.string()}),l.object({event:l.literal("page"),messageId:l.string(),partId:l.string(),page:l.object({id:l.string(),conversationId:l.string(),title:l.string().nullish()})}),l.object({event:l.literal("challenge"),method:l.literal("copilot").nullish(),parameter:l.string().nullish()}),l.object({event:l.literal("imageGenerationFailed"),messageId:l.string(),errorCode:Fte,partId:l.string()}),l.object({id:l.string(),event:l.literal("generatingCard"),messageId:l.string(),partId:l.string(),type:I3}),l.object({id:l.string(),event:l.literal("cardGenerationFailed"),messageId:l.string(),partId:l.string()}),l.object({event:l.literal("transcriptEvent")}),l.object({event:l.literal("audioStart"),conversationId:l.string()}),l.object({event:l.literal("audio"),audio:l.string()}),l.object({event:l.literal("audioStartFailed"),reason:A3}),l.object({event:l.literal("audioTimeRemaining"),seconds:l.number()}),l.object({event:l.literal("callTerminated"),reason:l.string().optional()}),l.object({event:l.literal("audioEnd")}),l.object({event:l.literal("callEnded"),id:l.string()}),l.object({event:l.literal("audioConfig"),options:Bte}),l.object({event:l.literal("interruptAudio")}),l.object({event:l.literal("speechEndDetected")}),l.object({event:l.literal("citation"),messageId:l.string(),url:l.string(),title:l.string(),partId:l.string(),iconUrl:l.string().nullable(),publisher:l.string().nullable(),snippet:l.string().nullable()}),l.object({event:l.literal("chainOfThought"),messageId:l.string(),partId:l.string(),text:l.string()}),l.object({event:l.literal("turnLimitReached"),id:l.string()}),l.object({event:l.literal("done"),messageId:l.string()}),l.object({event:l.literal("error"),errorCode:Ute}),l.object({event:l.literal("card"),messageId:l.string(),partId:l.string(),card:UD}),l.object({event:l.literal("document"),messageId:l.string(),partId:l.string(),attachmentId:l.string(),fileName:l.string(),contentType:l.string()}),l.object({event:l.literal("callUI"),id:l.string(),callUI:_te}),l.object({event:l.literal("banned"),expiresAt:l.string()}),l.object({id:l.string(),event:l.literal("suggestedFollowups"),messageId:l.string(),suggestions:l.array(l.string())}),l.object({event:l.literal("taskStart"),id:l.string(),messageId:l.string(),partId:l.string(),task:QD}),l.object({event:l.literal("taskUpdate"),id:l.string().nullish(),taskId:l.string(),update:MM}),l.object({event:l.literal("startSuggestion"),id:l.string(),pageId:l.string(),suggestionId:l.string(),editTargets:l.array(l.object({startIndex:l.number(),endIndex:l.number()}))}),l.object({event:l.literal("appendSuggestion"),id:l.string(),pageId:l.string(),suggestionId:l.string(),text:l.string()}),l.object({event:l.literal("characterAnimation"),id:l.string(),offsetInMilliseconds:l.number().nullable().optional(),frame:l.discriminatedUnion("model",[Ate,kte]).nullable().optional()}),l.object({event:l.literal("setCallType"),callType:PM}),l.object({event:l.literal("callTypeChanged"),callType:PM}),l.object({event:l.literal("activityStart"),activity:GL,id:l.string(),messageId:l.string(),partId:l.string()}),l.object({event:l.literal("activityUpdate"),id:l.string(),messageId:l.string(),partId:l.string(),update:MM}),l.object({event:l.literal("memorySignal"),messageId:l.string(),partId:l.string(),text:l.string(),signalType:l.union([l.literal("remember"),l.literal("forget")]).nullish()}),l.object({event:l.literal("sideBySideComparison"),id:l.string(),conversationId:l.string(),sideBySideComparisonId:l.string(),defaultMessageId:l.string(),options:l.array(l.object({messageId:l.string(),position:l.union([l.literal("left"),l.literal("right")])}))}),l.object({event:l.literal("characterEmotion"),emotion:l.string(),bodyReaction:l.string()}),l.object({event:l.literal("modeSelected"),id:l.string(),messageId:l.string(),mode:l.union([l.literal("chat"),l.literal("reasoning")])}),l.object({event:l.literal("partCompleted"),id:l.string(),messageId:l.string(),partId:l.string()})]),k3={kNotPresent:0};function t4e(n){return typeof n=="object"&&n!==null&&"eventName"in n&&"requestId"in n&&(!("isOutgoing"in n)||!n.isOutgoing)&&"args"in n}const hr=O(void 0),Oy=O(n=>n(hr)!==void 0),x3=tc({key:OL,schema:l.string().optional(),initialValue:void 0}),_3=O(n=>{const e=n(hr),t=n(x3);return e===void 0?t:e.firstName??e.givenName}),M3=O(n=>{var e;return(e=n(hr))==null?void 0:e.id}),am=O(void 0),n4e=O(n=>n(Ry).find(e=>e.id===n(am))),r4e=O(n=>{var r,i;const e=n(Ry),t=n(am)??((r=e[0])==null?void 0:r.id);return(i=e.find(a=>a.id===t))==null?void 0:i.voicemails}),Hte=tc({key:hM,schema:RM,initialValue:dr(hM,RM)??Qp}),$l=tc({key:lM,schema:_M,initialValue:dr(lM,_M)??void 0}),$te=tc({key:Dq,schema:l.boolean().optional(),initialValue:void 0}),R3=O(null),om=O(null),P3=O(n=>n(FI).find(e=>e.id===n(om))),i4e=O(!1),a4e=O(k3.kNotPresent),o4e=O(k3.kNotPresent),N3=O(void 0),VI=O(!1),GI=O(void 0),zte=O(!1),O3=O(void 0),Vte=O(!1),L3=O(void 0),KI=O(null),Ly=O(null),Gte=O(!0),s4e=O(!1),c4e=O(!1),zl=O(n=>{const e=n(hr),t=n(ec("cmc-m365-sku")),r=!!(e!=null&&e.isPro),i=(e==null?void 0:e.subscriptions)??[];return t&&i.some(a=>a.tier==="pro")||r}),Kte=O(n=>{var e;return(e=n(hr))==null?void 0:e.isStudent}),D3=O(n=>{var e;return(e=n(hr))==null?void 0:e.inEeaPlusRegion}),_r=O(void 0),qte=O(!1);O(n=>{const e=n(_r);return e&&WV.includes(e)});const j3=O(void 0),Dy=O(n=>{var e;return((e=n(hr))==null?void 0:e.isEligibleForFreeTrial)??!1}),U3=O(void 0),jy=O(n=>{var e;return((e=n(hr))==null?void 0:e.ageGroup)==="teen"}),l4e=O(n=>{var e;return(e=n(hr))==null?void 0:e.allowedToggles.browserActions}),Wte=O(n=>{var e;return(e=n(hr))==null?void 0:e.allowedToggles.personalization}),Yte=O(n=>{var e;return(e=n(hr))==null?void 0:e.allowedToggles.textTraining}),Qte=O(n=>{var e;return(e=n(hr))==null?void 0:e.allowedToggles.voiceTraining}),F3=O(!1),B3=O(null),H3=O(n=>{var e;return((e=n(hr))==null?void 0:e.subscriptions)??[]}),$3=O(n=>{const e=n(H3);return Ete(e)[0]}),z3=O(null),w1=O(0),Jte=O(0),V3=O(void 0),Uy=O(!1),qI=O(n=>{const e=n(pte),t=n(b3),r=n(V3),i=n(Uy);if(!(t||i))return e||r}),Vl=O(n=>{const e=n(qI),t=n(w1);if(!e||e.length===0)return;const r=Math.max(0,Math.min(t,e.length-1));return e[r]}),WI=O(n=>{const e=n(Vl),t=n(Uy),r=n(qI);return t||!r?null:(e==null?void 0:e.type)==="textAndGreeting"?e.greeting??null:null}),G3=O(!1),Zte=O(n=>{const e=n(Vl);return e==null?void 0:e.title}),K3=O(n=>{const e=n(Vl);return e==null?void 0:e.id}),Xte=O(n=>{const e=n(Vl),t=e==null?void 0:e.id;return t==="feature-discovery"||t==="image-generation"||t==="kickstarter"}),ene=O(null,(n,e)=>{const t=n(qI),r=n(w1);if(!t||t.length<=1)return;const i=(r+1)%t.length;e(w1,i)}),tne=O(void 0),u4e=O(!1),nne=O(void 0),YI=O(!1);O(void 0);const rne=wy(new Map),d4e=O(n=>{const e=n(rne);return Array.from(e.values()).some(t=>t.isTracked)});O(void 0);const h4e=O(null),f4e=wy(void 0);function sm(){const n=N(po),e=N(ai);return n.length===0&&!!(e!=null&&e.isNew)}function QI(){const n=N(YI),e=N(nne),r=sm()&&!!e,i=r&&!!(e!=null&&e.insights);return{isContextualShoppingCardExpanded:n,showShoppingCardInNewChat:r,shoppingProductMetadata:e,isCopilotOpenedViaEdgeCTAs:i}}function q3(){return!1}function ine(n){if(!n.length)return;const e=$o("greetingIndex"),t=n.length,r=e?(parseInt(e,10)+1)%t:0;return $s("greetingIndex",r.toString()),n[r]}const JI=O(!1),ane=O(!1),W3=dt(),one=["chat.launchMessage.authenticatedV3Type1","chat.launchMessage.authenticatedV3Type2","chat.launchMessage.authenticatedV3Type3"],sne=["chat.launchMessage.unauthenticatedV3Type1","chat.launchMessage.unauthenticatedV3Type2","chat.launchMessage.unauthenticatedV3Type3"],cne=["chat.launchMessage.authenticatedV4Type1","chat.launchMessage.authenticatedV4Type2","chat.launchMessage.authenticatedV4Type3","chat.launchMessage.authenticatedV4Type4","chat.launchMessage.authenticatedV4Type5","chat.launchMessage.authenticatedV4Type6","chat.launchMessage.authenticatedV4Type7","chat.launchMessage.authenticatedV4Type8","chat.launchMessage.authenticatedV4Type9","chat.launchMessage.authenticatedV4Type10"],lne=["chat.launchMessage.unauthenticatedV4Type1","chat.launchMessage.unauthenticatedV4Type2","chat.launchMessage.unauthenticatedV4Type3","chat.launchMessage.unauthenticatedV4Type4","chat.launchMessage.unauthenticatedV4Type5","chat.launchMessage.unauthenticatedV4Type6","chat.launchMessage.unauthenticatedV4Type7","chat.launchMessage.unauthenticatedV4Type8","chat.launchMessage.unauthenticatedV4Type9","chat.launchMessage.unauthenticatedV4Type10"];function Y3(){W3.set(JI,!0)}function une(){W3.set(JI,!1)}function Q3(){const{t:n}=Ce(),e=N(JI),t=N(_3),r=N(K3),i=N(WI),a=N(Zte),o=ee("landing-rotating-greeting"),{showShoppingCardInNewChat:s}=QI(),u=m.useCallback(()=>s?t?["chat.launchMessage.authenticatedShoppingType1"]:["chat.launchMessage.unauthenticatedShoppingType1"]:r&&r==="image-generation"?["chat.launchMessage.unauthenticatedImageWidgets"]:r&&r==="feature-discovery"?t?["chat.launchMessage.authenticatedWidgets"]:["chat.launchMessage.unauthenticatedWidgets"]:q3()&&r==="studentoffer"?["Hey, Welcome to Study and Learn."]:t?o?cne:one:o?lne:sne,[t,o,s,r])(),h=m.useMemo(()=>ine(u),[u]),f=Number($o("greetingIndex"))||0,p=m.useCallback(()=>a||(r==="feature-discovery"?n("chat.launchMessage.subheadingFeatureDiscoveryWidget"):r==="image-generation"?n("chat.launchMessage.subheadingImageGenWidget"):null),[a,r,n]);return{launchGreetingShown:e,greetingKey:h,widgetGreeting:i,widgetSubheading:p(),greetingIndex:f}}function Bt(){return _5({select:e=>e.pathname})}function ZI(){const n=Bt();return{isLivingPortraitEnabled:ee("labs-portrait-enabled")&&n.startsWith("/labs/portrait")}}async function cm({from:n,to:e,params:t,search:r,state:i}){var o;e.startsWith("/chats/")||dt().set(Dv,null);let a=e;e==="/"&&((o=me.instance().config().landingPage)!=null&&o.enableLandingRoute)&&(a="/discover"),await uu.navigate({to:a,params:t,state:s=>({...s,from:n,...i}),search:r})}function Ta(){return cm}async function J3(n){const{conversationId:e=Fe(lt),talk:t=!1,location:r}=n;e&&await cm({to:`/chats/$conversationId${t?"/talk":""}`,params:{conversationId:e},from:r.pathname,search:r.search?Object.fromEntries(new URLSearchParams(r.search)):{}})}async function XI(n={}){await J3({conversationId:n.conversationId,talk:n.talk,location:uu.state.location})}function Z3(){const n=sy(),{location:e}=n.state;return m.useCallback(async(t={})=>J3({conversationId:t.conversationId,talk:t.talk,location:{pathname:e.pathname,search:e.search}}),[e.search,e.pathname])}function xn(n,e){dt().set(n,e)}function X3(n){const{tasks:e,conversationId:t,taskType:r}=n;for(const i of e.values())if(i.conversationId===t){if(r&&i.type!==r)continue;return i.id}return""}function e4(n,e){return X3({tasks:n,conversationId:e,taskType:"computerUse"})!==""}function dne(n,e){if(!e)return n;const[t,r,i]=n.slice(-3);if(!(zs(i)&&zs(r)&&(t==null?void 0:t.author)==="human"))return n;const o={left:i.sideBySideConfig.position==="left"?i:r,right:i.sideBySideConfig.position==="right"?i:r,createdAt:i.createdAt,id:e};return[t,o]}function hne(n){return t4(n)||zs(n)}function t4(n){return"left"in n&&"right"in n}function zs(n){return!n||n.author!=="ai"?!1:!!n.sideBySideConfig}const jv=["completed","failed","cancelled"];function fne(n){return n.content.find(e=>{var r;if(e.type!=="task")return!1;const t=(r=e.task)==null?void 0:r.status;return t&&!jv.includes(t)})}function pne(n){for(let e=n.length-1;e>=0;e-=1){const t=n[e];if(t&&t.type==="task")return t}}function eA(n){for(const e of n){const t=fne(e);if(t)return{message:e,part:t}}return null}const mne=RT(po,n=>{if(!Uv()||n.length===0)return!1;const e=n[n.length-1];return(e==null?void 0:e.author)==="ai"&&e.content.some(t=>t.type==="activity"&&t.activity.status==="running")}),gne=["ceo-thinkdeeper","ceo-smart-mode","ceo","webretrieval","webcontent","browser-actions"];function Uv(){return gne.some($e)}const lh=dt();function Dn(n,e,t=!1){const r=n.at(-1),i=n.find(({id:a})=>a===e);if((t||(r==null?void 0:r.id)===(i==null?void 0:i.id)||zs(i))&&(i==null?void 0:i.author)==="ai")return i}function vne(n,e){const t=n.find(({author:r})=>r==="human");if((t==null?void 0:t.id)===e&&t.author==="human")return t}function n4(n){const e=n.at(-1);if((e==null?void 0:e.author)==="ai")return e}function hc(n,e){return n.find(t=>t.partId===e)}function bne(n){for(let e=n.length-1;e>=0;e-=1){const t=n[e];if(t&&t.type==="text")return t}}function p4e(n){return n.filter(e=>e.author==="ai").map(e=>({...e,content:e.content.filter(t=>t.type==="image")})).filter(e=>e.content.length>0)}function m4e(n,e,t){const r=n.find(i=>i.id===e);if(!(!r||r.author!=="ai")){for(const i of r.content)if("partId"in i&&i.partId===t)return i}}function r4(n){if(!n)return null;const e=lh.get(Sn).get(n);if(!e)return null;const{history:t}=e;return eA(t)}function Ht(n,e){lh.set(Sn,t=>zr(t,r=>{const i=r.get(n);i&&e(i.history)}))}function tA(n,e){lh.set(ya,t=>zr(t,r=>{const i=r.get(n);i&&e(i)}))}function ja(n,e){lh.set(Sn,t=>zr(t,r=>{const i=r.get(n);i&&e(i)}))}function Lu(n,e){lh.set(DI,t=>zr(t,r=>{if(!e)return;const i=r.get(n);i?i.add(e):r.set(n,new Set([e]))}))}function i4(n){lh.set(Cn,n)}function Tf(n,e){const t={type:"error",text:n,partId:"0"},r=Math.random().toString(),i={id:r,createdAt:new Date().toISOString(),author:"ai",content:[t],mode:ni()};Lu(e,r),Ht(e,a=>{a.push(i)}),ja(e,a=>{a.streamingState="idle"})}function yne(n){if(Uv())for(const e of n.content)e.type==="activity"&&e.activity.status==="running"&&(e.activity.status="completed")}function a4(n){ja(n,e=>{e.sideBySideComparisonId=void 0})}function o4(n,e){const t=!e;Ht(n,r=>{const[i,a]=r.slice(-2);if(!(zs(a)&&zs(i)))return;const s=t?!a.sideBySideConfig.isDefault:a.id!==e,c=t?!i.sideBySideConfig.isDefault:i.id!==e;s?r.splice(r.length-1,1):c&&r.splice(r.length-2,1)})}function Cne(n,e){o4(n,e),a4(n)}function nA(n){o4(n,void 0),a4(n)}function s4(n){var s,c;const{id:e,shouldNavigateToChat:t=!0,shouldClearParentConversation:r=!0}=n;r&&Fe(lt)!==Fe(Dv)&&xn(Dv,null),xn(lt,e),xn(ch,!1),xn(Sn,u=>zr(u,h=>{const f=h.get(e);if(f!=null&&f.history.length&&(f.isNew=!1),f!=null&&f.history.some(p=>p.content.some(g=>g.type==="card"&&g.card.type==="ads"))){for(const p of f.history)if(p.author==="ai"&&p.content.some(g=>g.type==="card"&&g.card.type==="ads")){const g=p.content.filter(v=>v.type!=="card"||v.card.type!=="ads");p.content=g}}}));const i=Fe(LI);if(i&&i!==e&&xn(Sn,u=>zr(u,h=>{h.delete(i)})),((c=(s=r4(e))==null?void 0:s.part.task)==null?void 0:c.type)==="research")xn(Cn,"research");else{let u=ni();$e("sticky-conversation-mode")&&(u=yp("sticky-conversation-mode")??ni()),xn(Cn,u)}const o=Fe(ya);e4(o,e)?xn(Vr,"side-by-side"):xn(Vr,"chat-only"),t&&XI({conversationId:e})}function Sne(){return n=>s4(n)}const c4=O(null),yt=n=>typeof n=="string",Yh=()=>{let n,e;const t=new Promise((r,i)=>{n=r,e=i});return t.resolve=n,t.reject=e,t},OM=n=>n==null?"":""+n,wne=(n,e,t)=>{n.forEach(r=>{e[r]&&(t[r]=e[r])})},Ene=/###/g,LM=n=>n&&n.indexOf("###")>-1?n.replace(Ene,"."):n,DM=n=>!n||yt(n),Uf=(n,e,t)=>{const r=yt(e)?e.split("."):e;let i=0;for(;i<r.length-1;){if(DM(n))return{};const a=LM(r[i]);!n[a]&&t&&(n[a]=new t),Object.prototype.hasOwnProperty.call(n,a)?n=n[a]:n={},++i}return DM(n)?{}:{obj:n,k:LM(r[i])}},jM=(n,e,t)=>{const{obj:r,k:i}=Uf(n,e,Object);if(r!==void 0||e.length===1){r[i]=t;return}let a=e[e.length-1],o=e.slice(0,e.length-1),s=Uf(n,o,Object);for(;s.obj===void 0&&o.length;)a=`${o[o.length-1]}.${a}`,o=o.slice(0,o.length-1),s=Uf(n,o,Object),s&&s.obj&&typeof s.obj[`${s.k}.${a}`]<"u"&&(s.obj=void 0);s.obj[`${s.k}.${a}`]=t},Tne=(n,e,t,r)=>{const{obj:i,k:a}=Uf(n,e,Object);i[a]=i[a]||[],i[a].push(t)},Fv=(n,e)=>{const{obj:t,k:r}=Uf(n,e);if(t)return t[r]},Ine=(n,e,t)=>{const r=Fv(n,t);return r!==void 0?r:Fv(e,t)},l4=(n,e,t)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in n?yt(n[r])||n[r]instanceof String||yt(e[r])||e[r]instanceof String?t&&(n[r]=e[r]):l4(n[r],e[r],t):n[r]=e[r]);return n},vu=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Ane={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const kne=n=>yt(n)?n.replace(/[&<>"'\/]/g,e=>Ane[e]):n;class xne{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const _ne=[" ",",","?","!",";"],Mne=new xne(20),Rne=(n,e,t)=>{e=e||"",t=t||"";const r=_ne.filter(o=>e.indexOf(o)<0&&t.indexOf(o)<0);if(r.length===0)return!0;const i=Mne.getRegExp(`(${r.map(o=>o==="?"?"\\?":o).join("|")})`);let a=!i.test(n);if(!a){const o=n.indexOf(t);o>0&&!i.test(n.substring(0,o))&&(a=!0)}return a},E1=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!n)return;if(n[e])return n[e];const r=e.split(t);let i=n;for(let a=0;a<r.length;){if(!i||typeof i!="object")return;let o,s="";for(let c=a;c<r.length;++c)if(c!==a&&(s+=t),s+=r[c],o=i[s],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&c<r.length-1)continue;a+=c-a+1;break}i=o}return i},Bv=n=>n&&n.replace("_","-"),Pne={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console&&console[n]&&console[n].apply(console,e)}};let Nne=class T1{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||Pne,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,r,i){return i&&!this.debug?null:(yt(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new T1(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new T1(this.logger,e)}};var Ya=new Nne;class Fy{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const i=this.observers[r].get(t)||0;this.observers[r].set(t,i+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[s,c]=o;for(let u=0;u<c;u++)s(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[s,c]=o;for(let u=0;u<c;u++)s.apply(s,[e,...r])})}}class UM extends Fy{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,o=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let s;e.indexOf(".")>-1?s=e.split("."):(s=[e,t],r&&(Array.isArray(r)?s.push(...r):yt(r)&&a?s.push(...r.split(a)):s.push(r)));const c=Fv(this.data,s);return!c&&!t&&!r&&e.indexOf(".")>-1&&(e=s[0],t=s[1],r=s.slice(2).join(".")),c||!o||!yt(r)?c:E1(this.data&&this.data[e]&&this.data[e][t],r,a)}addResource(e,t,r,i){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator;let s=[e,t];r&&(s=s.concat(o?r.split(o):r)),e.indexOf(".")>-1&&(s=e.split("."),i=t,t=s[1]),this.addNamespaces(t),jM(this.data,s,i),a.silent||this.emit("added",e,t,r,i)}addResources(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const a in r)(yt(r[a])||Array.isArray(r[a]))&&this.addResource(e,t,a,r[a],{silent:!0});i.silent||this.emit("added",e,t,r)}addResourceBundle(e,t,r,i,a){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},s=[e,t];e.indexOf(".")>-1&&(s=e.split("."),i=r,r=t,t=s[1]),this.addNamespaces(t);let c=Fv(this.data,s)||{};o.skipCopy||(r=JSON.parse(JSON.stringify(r))),i?l4(c,r,a):c={...c,...r},jM(this.data,s,c),o.silent||this.emit("added",e,t,r)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(i=>t[i]&&Object.keys(t[i]).length>0)}toJSON(){return this.data}}var u4={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,r,i){return n.forEach(a=>{this.processors[a]&&(e=this.processors[a].process(e,t,r,i))}),e}};const FM={};class Hv extends Fy{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),wne(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Ya.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const r=this.resolve(e,t);return r&&r.res!==void 0}extractFromKey(e,t){let r=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const i=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let a=t.ns||this.options.defaultNS||[];const o=r&&e.indexOf(r)>-1,s=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!Rne(e,r,i);if(o&&!s){const c=e.match(this.interpolator.nestingRegexp);if(c&&c.length>0)return{key:e,namespaces:a};const u=e.split(r);(r!==i||r===i&&this.options.ns.indexOf(u[0])>-1)&&(a=u.shift()),e=u.join(i)}return yt(a)&&(a=[a]),{key:e,namespaces:a}}translate(e,t,r){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const i=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,a=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:o,namespaces:s}=this.extractFromKey(e[e.length-1],t),c=s[s.length-1],u=t.lng||this.language,h=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&u.toLowerCase()==="cimode"){if(h){const T=t.nsSeparator||this.options.nsSeparator;return i?{res:`${c}${T}${o}`,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:c,usedParams:this.getUsedParamsDetails(t)}:`${c}${T}${o}`}return i?{res:o,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:c,usedParams:this.getUsedParamsDetails(t)}:o}const f=this.resolve(e,t);let p=f&&f.res;const g=f&&f.usedKey||o,v=f&&f.exactUsedKey||o,y=Object.prototype.toString.apply(p),b=["[object Number]","[object Function]","[object RegExp]"],C=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,S=!this.i18nFormat||this.i18nFormat.handleAsObject,E=!yt(p)&&typeof p!="boolean"&&typeof p!="number";if(S&&p&&E&&b.indexOf(y)<0&&!(yt(C)&&Array.isArray(p))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const T=this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,p,{...t,ns:s}):`key '${o} (${this.language})' returned an object instead of string.`;return i?(f.res=T,f.usedParams=this.getUsedParamsDetails(t),f):T}if(a){const T=Array.isArray(p),A=T?[]:{},I=T?v:g;for(const k in p)if(Object.prototype.hasOwnProperty.call(p,k)){const x=`${I}${a}${k}`;A[k]=this.translate(x,{...t,joinArrays:!1,ns:s}),A[k]===x&&(A[k]=p[k])}p=A}}else if(S&&yt(C)&&Array.isArray(p))p=p.join(C),p&&(p=this.extendTranslation(p,e,t,r));else{let T=!1,A=!1;const I=t.count!==void 0&&!yt(t.count),k=Hv.hasDefaultValue(t),x=I?this.pluralResolver.getSuffix(u,t.count,t):"",_=t.ordinal&&I?this.pluralResolver.getSuffix(u,t.count,{ordinal:!1}):"",R=I&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),z=R&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${x}`]||t[`defaultValue${_}`]||t.defaultValue;!this.isValidLookup(p)&&k&&(T=!0,p=z),this.isValidLookup(p)||(A=!0,p=o);const J=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&A?void 0:p,D=k&&z!==p&&this.options.updateMissing;if(A||T||D){if(this.logger.log(D?"updateKey":"missingKey",u,c,o,D?z:p),a){const W=this.resolve(o,{...t,keySeparator:!1});W&&W.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let F=[];const ie=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&ie&&ie[0])for(let W=0;W<ie.length;W++)F.push(ie[W]);else this.options.saveMissingTo==="all"?F=this.languageUtils.toResolveHierarchy(t.lng||this.language):F.push(t.lng||this.language);const U=(W,ue,te)=>{const Z=k&&te!==p?te:J;this.options.missingKeyHandler?this.options.missingKeyHandler(W,c,ue,Z,D,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(W,c,ue,Z,D,t),this.emit("missingKey",W,c,ue,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&I?F.forEach(W=>{const ue=this.pluralResolver.getSuffixes(W,t);R&&t[`defaultValue${this.options.pluralSeparator}zero`]&&ue.indexOf(`${this.options.pluralSeparator}zero`)<0&&ue.push(`${this.options.pluralSeparator}zero`),ue.forEach(te=>{U([W],o+te,t[`defaultValue${te}`]||z)})}):U(F,o,z))}p=this.extendTranslation(p,e,t,f,r),A&&p===o&&this.options.appendNamespaceToMissingKey&&(p=`${c}:${o}`),(A||T)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${c}:${o}`:o,T?p:void 0):p=this.options.parseMissingKeyHandler(p))}return i?(f.res=p,f.usedParams=this.getUsedParamsDetails(t),f):p}extendTranslation(e,t,r,i,a){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const u=yt(e)&&(r&&r.interpolation&&r.interpolation.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let h;if(u){const p=e.match(this.interpolator.nestingRegexp);h=p&&p.length}let f=r.replace&&!yt(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(f={...this.options.interpolation.defaultVariables,...f}),e=this.interpolator.interpolate(e,f,r.lng||this.language||i.usedLng,r),u){const p=e.match(this.interpolator.nestingRegexp),g=p&&p.length;h<g&&(r.nest=!1)}!r.lng&&this.options.compatibilityAPI!=="v1"&&i&&i.res&&(r.lng=this.language||i.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var p=arguments.length,g=new Array(p),v=0;v<p;v++)g[v]=arguments[v];return a&&a[0]===g[0]&&!r.context?(o.logger.warn(`It seems you are nesting recursively key: ${g[0]} in key: ${t[0]}`),null):o.translate(...g,t)},r)),r.interpolation&&this.interpolator.reset()}const s=r.postProcess||this.options.postProcess,c=yt(s)?[s]:s;return e!=null&&c&&c.length&&r.applyPostProcessor!==!1&&(e=u4.handle(c,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r,i,a,o,s;return yt(e)&&(e=[e]),e.forEach(c=>{if(this.isValidLookup(r))return;const u=this.extractFromKey(c,t),h=u.key;i=h;let f=u.namespaces;this.options.fallbackNS&&(f=f.concat(this.options.fallbackNS));const p=t.count!==void 0&&!yt(t.count),g=p&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),v=t.context!==void 0&&(yt(t.context)||typeof t.context=="number")&&t.context!=="",y=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);f.forEach(b=>{this.isValidLookup(r)||(s=b,!FM[`${y[0]}-${b}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(s)&&(FM[`${y[0]}-${b}`]=!0,this.logger.warn(`key "${i}" for languages "${y.join(", ")}" won't get resolved as namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),y.forEach(C=>{if(this.isValidLookup(r))return;o=C;const S=[h];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(S,h,C,b,t);else{let T;p&&(T=this.pluralResolver.getSuffix(C,t.count,t));const A=`${this.options.pluralSeparator}zero`,I=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(p&&(S.push(h+T),t.ordinal&&T.indexOf(I)===0&&S.push(h+T.replace(I,this.options.pluralSeparator)),g&&S.push(h+A)),v){const k=`${h}${this.options.contextSeparator}${t.context}`;S.push(k),p&&(S.push(k+T),t.ordinal&&T.indexOf(I)===0&&S.push(k+T.replace(I,this.options.pluralSeparator)),g&&S.push(k+A))}}let E;for(;E=S.pop();)this.isValidLookup(r)||(a=E,r=this.getResource(C,b,E,t))}))})}),{res:r,usedKey:i,exactUsedKey:a,usedLng:o,usedNS:s}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,r,i):this.resourceStore.getResource(e,t,r,i)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!yt(e.replace);let i=r?e.replace:e;if(r&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!r){i={...i};for(const a of t)delete i[a]}return i}static hasDefaultValue(e){const t="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t===r.substring(0,t.length)&&e[r]!==void 0)return!0;return!1}}const PS=n=>n.charAt(0).toUpperCase()+n.slice(1);class BM{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Ya.create("languageUtils")}getScriptPartFromCode(e){if(e=Bv(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=Bv(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(yt(e)&&e.indexOf("-")>-1){if(typeof Intl<"u"&&typeof Intl.getCanonicalLocales<"u")try{let i=Intl.getCanonicalLocales(e)[0];if(i&&this.options.lowerCaseLng&&(i=i.toLowerCase()),i)return i}catch{}const t=["hans","hant","latn","cyrl","cans","mong","arab"];let r=e.split("-");return this.options.lowerCaseLng?r=r.map(i=>i.toLowerCase()):r.length===2?(r[0]=r[0].toLowerCase(),r[1]=r[1].toUpperCase(),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=PS(r[1].toLowerCase()))):r.length===3&&(r[0]=r[0].toLowerCase(),r[1].length===2&&(r[1]=r[1].toUpperCase()),r[0]!=="sgn"&&r[2].length===2&&(r[2]=r[2].toUpperCase()),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=PS(r[1].toLowerCase())),t.indexOf(r[2].toLowerCase())>-1&&(r[2]=PS(r[2].toLowerCase()))),r.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(r=>{if(t)return;const i=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(i))&&(t=i)}),!t&&this.options.supportedLngs&&e.forEach(r=>{if(t)return;const i=this.getLanguagePartFromCode(r);if(this.isSupportedCode(i))return t=i;t=this.options.supportedLngs.find(a=>{if(a===i)return a;if(!(a.indexOf("-")<0&&i.indexOf("-")<0)&&(a.indexOf("-")>0&&i.indexOf("-")<0&&a.substring(0,a.indexOf("-"))===i||a.indexOf(i)===0&&i.length>1))return a})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),yt(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}toResolveHierarchy(e,t){const r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],a=o=>{o&&(this.isSupportedCode(o)?i.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return yt(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&a(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&a(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&a(this.getLanguagePartFromCode(e))):yt(e)&&a(this.formatLanguageCode(e)),r.forEach(o=>{i.indexOf(o)<0&&a(this.formatLanguageCode(o))}),i}}let One=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],Lne={1:n=>+(n>1),2:n=>+(n!=1),3:n=>0,4:n=>n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,5:n=>n==0?0:n==1?1:n==2?2:n%100>=3&&n%100<=10?3:n%100>=11?4:5,6:n=>n==1?0:n>=2&&n<=4?1:2,7:n=>n==1?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,8:n=>n==1?0:n==2?1:n!=8&&n!=11?2:3,9:n=>+(n>=2),10:n=>n==1?0:n==2?1:n<7?2:n<11?3:4,11:n=>n==1||n==11?0:n==2||n==12?1:n>2&&n<20?2:3,12:n=>+(n%10!=1||n%100==11),13:n=>+(n!==0),14:n=>n==1?0:n==2?1:n==3?2:3,15:n=>n%10==1&&n%100!=11?0:n%10>=2&&(n%100<10||n%100>=20)?1:2,16:n=>n%10==1&&n%100!=11?0:n!==0?1:2,17:n=>n==1||n%10==1&&n%100!=11?0:1,18:n=>n==0?0:n==1?1:2,19:n=>n==1?0:n==0||n%100>1&&n%100<11?1:n%100>10&&n%100<20?2:3,20:n=>n==1?0:n==0||n%100>0&&n%100<20?1:2,21:n=>n%100==1?1:n%100==2?2:n%100==3||n%100==4?3:0,22:n=>n==1?0:n==2?1:(n<0||n>10)&&n%10==0?2:3};const Dne=["v1","v2","v3"],jne=["v4"],HM={zero:0,one:1,two:2,few:3,many:4,other:5},Une=()=>{const n={};return One.forEach(e=>{e.lngs.forEach(t=>{n[t]={numbers:e.nr,plurals:Lne[e.fc]}})}),n};class Fne{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=Ya.create("pluralResolver"),(!this.options.compatibilityJSON||jne.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=Une(),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi())try{const r=Bv(e==="dev"?"en":e),i=t.ordinal?"ordinal":"cardinal",a=JSON.stringify({cleanedCode:r,type:i});if(a in this.pluralRulesCache)return this.pluralRulesCache[a];const o=new Intl.PluralRules(r,{type:i});return this.pluralRulesCache[a]=o,o}catch{return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.getRule(e,t);return this.shouldUseIntlApi()?r&&r.resolvedOptions().pluralCategories.length>1:r&&r.numbers.length>1}getPluralFormsOfKey(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,r).map(i=>`${t}${i}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.getRule(e,t);return r?this.shouldUseIntlApi()?r.resolvedOptions().pluralCategories.sort((i,a)=>HM[i]-HM[a]).map(i=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${i}`):r.numbers.map(i=>this.getSuffix(e,i,t)):[]}getSuffix(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=this.getRule(e,r);return i?this.shouldUseIntlApi()?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${i.select(t)}`:this.getSuffixRetroCompatible(i,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const r=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let i=e.numbers[r];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(i===2?i="plural":i===1&&(i=""));const a=()=>this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString();return this.options.compatibilityJSON==="v1"?i===1?"":typeof i=="number"?`_plural_${i.toString()}`:a():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?a():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}shouldUseIntlApi(){return!Dne.includes(this.options.compatibilityJSON)}}const $M=function(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=Ine(n,e,t);return!a&&i&&yt(t)&&(a=E1(n,t,r),a===void 0&&(a=E1(e,t,r))),a},NS=n=>n.replace(/\$/g,"$$$$");class Bne{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Ya.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(t=>t),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:r,useRawValueToEscape:i,prefix:a,prefixEscaped:o,suffix:s,suffixEscaped:c,formatSeparator:u,unescapeSuffix:h,unescapePrefix:f,nestingPrefix:p,nestingPrefixEscaped:g,nestingSuffix:v,nestingSuffixEscaped:y,nestingOptionsSeparator:b,maxReplaces:C,alwaysFormat:S}=e.interpolation;this.escape=t!==void 0?t:kne,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=a?vu(a):o||"{{",this.suffix=s?vu(s):c||"}}",this.formatSeparator=u||",",this.unescapePrefix=h?"":f||"-",this.unescapeSuffix=this.unescapePrefix?"":h||"",this.nestingPrefix=p?vu(p):g||vu("$t("),this.nestingSuffix=v?vu(v):y||vu(")"),this.nestingOptionsSeparator=b||",",this.maxReplaces=C||1e3,this.alwaysFormat=S!==void 0?S:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,r)=>t&&t.source===r?(t.lastIndex=0,t):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,r,i){let a,o,s;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=g=>{if(g.indexOf(this.formatSeparator)<0){const C=$M(t,c,g,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(C,void 0,r,{...i,...t,interpolationkey:g}):C}const v=g.split(this.formatSeparator),y=v.shift().trim(),b=v.join(this.formatSeparator).trim();return this.format($M(t,c,y,this.options.keySeparator,this.options.ignoreJSONStructure),b,r,{...i,...t,interpolationkey:y})};this.resetRegExp();const h=i&&i.missingInterpolationHandler||this.options.missingInterpolationHandler,f=i&&i.interpolation&&i.interpolation.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:g=>NS(g)},{regex:this.regexp,safeValue:g=>this.escapeValue?NS(this.escape(g)):NS(g)}].forEach(g=>{for(s=0;a=g.regex.exec(e);){const v=a[1].trim();if(o=u(v),o===void 0)if(typeof h=="function"){const b=h(e,a,i);o=yt(b)?b:""}else if(i&&Object.prototype.hasOwnProperty.call(i,v))o="";else if(f){o=a[0];continue}else this.logger.warn(`missed to pass in variable ${v} for interpolating ${e}`),o="";else!yt(o)&&!this.useRawValueToEscape&&(o=OM(o));const y=g.safeValue(o);if(e=e.replace(a[0],y),f?(g.regex.lastIndex+=o.length,g.regex.lastIndex-=a[0].length):g.regex.lastIndex=0,s++,s>=this.maxReplaces)break}}),e}nest(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i,a,o;const s=(c,u)=>{const h=this.nestingOptionsSeparator;if(c.indexOf(h)<0)return c;const f=c.split(new RegExp(`${h}[ ]*{`));let p=`{${f[1]}`;c=f[0],p=this.interpolate(p,o);const g=p.match(/'/g),v=p.match(/"/g);(g&&g.length%2===0&&!v||v.length%2!==0)&&(p=p.replace(/'/g,'"'));try{o=JSON.parse(p),u&&(o={...u,...o})}catch(y){return this.logger.warn(`failed parsing options string in nesting for key ${c}`,y),`${c}${h}${p}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,c};for(;i=this.nestingRegexp.exec(e);){let c=[];o={...r},o=o.replace&&!yt(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let u=!1;if(i[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(i[1])){const h=i[1].split(this.formatSeparator).map(f=>f.trim());i[1]=h.shift(),c=h,u=!0}if(a=t(s.call(this,i[1].trim(),o),o),a&&i[0]===e&&!yt(a))return a;yt(a)||(a=OM(a)),a||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),a=""),u&&(a=c.reduce((h,f)=>this.format(h,f,r.lng,{...r,interpolationkey:i[1].trim()}),a.trim())),e=e.replace(i[0],a),this.regexp.lastIndex=0}return e}}const Hne=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const r=n.split("(");e=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);e==="currency"&&i.indexOf(":")<0?t.currency||(t.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?t.range||(t.range=i.trim()):i.split(";").forEach(o=>{if(o){const[s,...c]=o.split(":"),u=c.join(":").trim().replace(/^'+|'+$/g,""),h=s.trim();t[h]||(t[h]=u),u==="false"&&(t[h]=!1),u==="true"&&(t[h]=!0),isNaN(u)||(t[h]=parseInt(u,10))}})}return{formatName:e,formatOptions:t}},bu=n=>{const e={};return(t,r,i)=>{let a=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(a={...a,[i.interpolationkey]:void 0});const o=r+JSON.stringify(a);let s=e[o];return s||(s=n(Bv(r),i),e[o]=s),s(t)}};class $ne{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Ya.create("formatter"),this.options=e,this.formats={number:bu((t,r)=>i=>new Intl.NumberFormat(t,{...r}).format(i)),currency:bu((t,r)=>i=>new Intl.NumberFormat(t,{...r,style:"currency"}).format(i)),datetime:bu((t,r)=>i=>new Intl.DateTimeFormat(t,{...r}).format(i)),relativetime:bu((t,r)=>i=>new Intl.RelativeTimeFormat(t,{...r}).format(i,r.range||"day")),list:bu((t,r)=>i=>new Intl.ListFormat(t,{...r}).format(i))},this.init(e)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=bu(t)}format(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=t.split(this.formatSeparator);if(a.length>1&&a[0].indexOf("(")>1&&a[0].indexOf(")")<0&&a.find(s=>s.indexOf(")")>-1)){const s=a.findIndex(c=>c.indexOf(")")>-1);a[0]=[a[0],...a.splice(1,s)].join(this.formatSeparator)}return a.reduce((s,c)=>{const{formatName:u,formatOptions:h}=Hne(c);if(this.formats[u]){let f=s;try{const p=i&&i.formatParams&&i.formatParams[i.interpolationkey]||{},g=p.locale||p.lng||i.locale||i.lng||r;f=this.formats[u](s,g,{...h,...i,...p})}catch(p){this.logger.warn(p)}return f}else this.logger.warn(`there was no format function for ${u}`);return s},e)}}const zne=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class Vne extends Fy{constructor(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=r,this.languageUtils=r.languageUtils,this.options=i,this.logger=Ya.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(r,i.backend,i)}queueLoad(e,t,r,i){const a={},o={},s={},c={};return e.forEach(u=>{let h=!0;t.forEach(f=>{const p=`${u}|${f}`;!r.reload&&this.store.hasResourceBundle(u,f)?this.state[p]=2:this.state[p]<0||(this.state[p]===1?o[p]===void 0&&(o[p]=!0):(this.state[p]=1,h=!1,o[p]===void 0&&(o[p]=!0),a[p]===void 0&&(a[p]=!0),c[f]===void 0&&(c[f]=!0)))}),h||(s[u]=!0)}),(Object.keys(a).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(a),pending:Object.keys(o),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(c)}}loaded(e,t,r){const i=e.split("|"),a=i[0],o=i[1];t&&this.emit("failedLoading",a,o,t),!t&&r&&this.store.addResourceBundle(a,o,r,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&r&&(this.state[e]=0);const s={};this.queue.forEach(c=>{Tne(c.loaded,[a],o),zne(c,e),t&&c.errors.push(t),c.pendingCount===0&&!c.done&&(Object.keys(c.loaded).forEach(u=>{s[u]||(s[u]={});const h=c.loaded[u];h.length&&h.forEach(f=>{s[u][f]===void 0&&(s[u][f]=!0)})}),c.done=!0,c.errors.length?c.callback(c.errors):c.callback())}),this.emit("loaded",s),this.queue=this.queue.filter(c=>!c.done)}read(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:r,tried:i,wait:a,callback:o});return}this.readingCalls++;const s=(u,h)=>{if(this.readingCalls--,this.waitingReads.length>0){const f=this.waitingReads.shift();this.read(f.lng,f.ns,f.fcName,f.tried,f.wait,f.callback)}if(u&&h&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,r,i+1,a*2,o)},a);return}o(u,h)},c=this.backend[r].bind(this.backend);if(c.length===2){try{const u=c(e,t);u&&typeof u.then=="function"?u.then(h=>s(null,h)).catch(s):s(null,u)}catch(u){s(u)}return}return c(e,t,s)}prepareLoading(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();yt(e)&&(e=this.languageUtils.toResolveHierarchy(e)),yt(t)&&(t=[t]);const a=this.queueLoad(e,t,r,i);if(!a.toLoad.length)return a.pending.length||i(),null;a.toLoad.forEach(o=>{this.loadOne(o)})}load(e,t,r){this.prepareLoading(e,t,{},r)}reload(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=e.split("|"),i=r[0],a=r[1];this.read(i,a,"read",void 0,void 0,(o,s)=>{o&&this.logger.warn(`${t}loading namespace ${a} for language ${i} failed`,o),!o&&s&&this.logger.log(`${t}loaded namespace ${a} for language ${i}`,s),this.loaded(e,o,s)})}saveMissing(e,t,r,i,a){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${r}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if(this.backend&&this.backend.create){const c={...o,isUpdate:a},u=this.backend.create.bind(this.backend);if(u.length<6)try{let h;u.length===5?h=u(e,t,r,i,c):h=u(e,t,r,i),h&&typeof h.then=="function"?h.then(f=>s(null,f)).catch(s):s(null,h)}catch(h){s(h)}else u(e,t,r,i,s,c)}!e||!e[0]||this.store.addResource(e[0],t,r,i)}}}const zM=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),yt(n[1])&&(e.defaultValue=n[1]),yt(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(r=>{e[r]=t[r]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),VM=n=>(yt(n.ns)&&(n.ns=[n.ns]),yt(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),yt(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs&&n.supportedLngs.indexOf("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),n),Ym=()=>{},Gne=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})};class wp extends Fy{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=VM(e),this.services={},this.logger=Ya,this.modules={external:[]},Gne(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(r=t,t={}),!t.defaultNS&&t.defaultNS!==!1&&t.ns&&(yt(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const i=zM();this.options={...i,...this.options,...VM(t)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...i.interpolation,...this.options.interpolation}),t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const a=h=>h?typeof h=="function"?new h:h:null;if(!this.options.isClone){this.modules.logger?Ya.init(a(this.modules.logger),this.options):Ya.init(null,this.options);let h;this.modules.formatter?h=this.modules.formatter:typeof Intl<"u"&&(h=$ne);const f=new BM(this.options);this.store=new UM(this.options.resources,this.options);const p=this.services;p.logger=Ya,p.resourceStore=this.store,p.languageUtils=f,p.pluralResolver=new Fne(f,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),h&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(p.formatter=a(h),p.formatter.init(p,this.options),this.options.interpolation.format=p.formatter.format.bind(p.formatter)),p.interpolator=new Bne(this.options),p.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},p.backendConnector=new Vne(a(this.modules.backend),p.resourceStore,p,this.options),p.backendConnector.on("*",function(g){for(var v=arguments.length,y=new Array(v>1?v-1:0),b=1;b<v;b++)y[b-1]=arguments[b];e.emit(g,...y)}),this.modules.languageDetector&&(p.languageDetector=a(this.modules.languageDetector),p.languageDetector.init&&p.languageDetector.init(p,this.options.detection,this.options)),this.modules.i18nFormat&&(p.i18nFormat=a(this.modules.i18nFormat),p.i18nFormat.init&&p.i18nFormat.init(this)),this.translator=new Hv(this.services,this.options),this.translator.on("*",function(g){for(var v=arguments.length,y=new Array(v>1?v-1:0),b=1;b<v;b++)y[b-1]=arguments[b];e.emit(g,...y)}),this.modules.external.forEach(g=>{g.init&&g.init(this)})}if(this.format=this.options.interpolation.format,r||(r=Ym),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const h=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);h.length>0&&h[0]!=="dev"&&(this.options.lng=h[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(h=>{this[h]=function(){return e.store[h](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(h=>{this[h]=function(){return e.store[h](...arguments),e}});const c=Yh(),u=()=>{const h=(f,p)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),c.resolve(p),r(f,p)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return h(null,this.t.bind(this));this.changeLanguage(this.options.lng,h)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),c}loadResources(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ym;const i=yt(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(i&&i.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const a=[],o=s=>{if(!s||s==="cimode")return;this.services.languageUtils.toResolveHierarchy(s).forEach(u=>{u!=="cimode"&&a.indexOf(u)<0&&a.push(u)})};i?o(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(c=>o(c)),this.options.preload&&this.options.preload.forEach(s=>o(s)),this.services.backendConnector.load(a,this.options.ns,s=>{!s&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(s)})}else r(null)}reloadResources(e,t,r){const i=Yh();return typeof e=="function"&&(r=e,e=void 0),typeof t=="function"&&(r=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),r||(r=Ym),this.services.backendConnector.reload(e,t,a=>{i.resolve(),r(a)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&u4.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const r=this.languages[t];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}changeLanguage(e,t){var r=this;this.isLanguageChangingTo=e;const i=Yh();this.emit("languageChanging",e);const a=c=>{this.language=c,this.languages=this.services.languageUtils.toResolveHierarchy(c),this.resolvedLanguage=void 0,this.setResolvedLanguage(c)},o=(c,u)=>{u?(a(u),this.translator.changeLanguage(u),this.isLanguageChangingTo=void 0,this.emit("languageChanged",u),this.logger.log("languageChanged",u)):this.isLanguageChangingTo=void 0,i.resolve(function(){return r.t(...arguments)}),t&&t(c,function(){return r.t(...arguments)})},s=c=>{!e&&!c&&this.services.languageDetector&&(c=[]);const u=yt(c)?c:this.services.languageUtils.getBestMatchFromCodes(c);u&&(this.language||a(u),this.translator.language||this.translator.changeLanguage(u),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(u)),this.loadResources(u,h=>{o(h,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?s(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(e),i}getFixedT(e,t,r){var i=this;const a=function(o,s){let c;if(typeof s!="object"){for(var u=arguments.length,h=new Array(u>2?u-2:0),f=2;f<u;f++)h[f-2]=arguments[f];c=i.options.overloadTranslationOptionHandler([o,s].concat(h))}else c={...s};c.lng=c.lng||a.lng,c.lngs=c.lngs||a.lngs,c.ns=c.ns||a.ns,c.keyPrefix!==""&&(c.keyPrefix=c.keyPrefix||r||a.keyPrefix);const p=i.options.keySeparator||".";let g;return c.keyPrefix&&Array.isArray(o)?g=o.map(v=>`${c.keyPrefix}${p}${v}`):g=c.keyPrefix?`${c.keyPrefix}${p}${o}`:o,i.t(g,c)};return yt(e)?a.lng=e:a.lngs=e,a.ns=t,a.keyPrefix=r,a}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=t.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,a=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const o=(s,c)=>{const u=this.services.backendConnector.state[`${s}|${c}`];return u===-1||u===0||u===2};if(t.precheck){const s=t.precheck(this,o);if(s!==void 0)return s}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(r,e)&&(!i||o(a,e)))}loadNamespaces(e,t){const r=Yh();return this.options.ns?(yt(e)&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{r.resolve(),t&&t(i)}),r):(t&&t(),Promise.resolve())}loadLanguages(e,t){const r=Yh();yt(e)&&(e=[e]);const i=this.options.preload||[],a=e.filter(o=>i.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return a.length?(this.options.preload=i.concat(a),this.loadResources(o=>{r.resolve(),t&&t(o)}),r):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=this.services&&this.services.languageUtils||new BM(zM());return t.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new wp(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ym;const r=e.forkResourceStore;r&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},a=new wp(i);return(e.debug!==void 0||e.prefix!==void 0)&&(a.logger=a.logger.clone(e)),["store","services","language"].forEach(s=>{a[s]=this[s]}),a.services={...this.services},a.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},r&&(a.store=new UM(this.store.data,i),a.services.resourceStore=a.store),a.translator=new Hv(a.services,i),a.translator.on("*",function(s){for(var c=arguments.length,u=new Array(c>1?c-1:0),h=1;h<c;h++)u[h-1]=arguments[h];a.emit(s,...u)}),a.init(i,t),a.translator.options=i,a.translator.backendConnector.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},a}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Dt=wp.createInstance();Dt.createInstance=wp.createInstance;Dt.createInstance;Dt.dir;Dt.init;Dt.loadResources;Dt.reloadResources;Dt.use;Dt.changeLanguage;Dt.getFixedT;const re=Dt.t,g4e=Dt.exists;Dt.setDefaultNamespace;Dt.hasLoadedNamespace;Dt.loadNamespaces;Dt.loadLanguages;const kc={UNDEFINED:"0",CHILD:"1",ADULT:"3",NOT_ADULT:"4",CHILD_NO_PARENTAL_CONSENT_REQUIRED:"5"},Kne=l.object({name:l.string(),email:l.string(),ageGroup:l.enum([kc.UNDEFINED,kc.CHILD,kc.ADULT,kc.NOT_ADULT,kc.CHILD_NO_PARENTAL_CONSENT_REQUIRED]),sub:l.string()}),mi={LOGIN_START:"auth0:loginStart",LOGIN_SUCCESS:"auth0:loginSuccess",LOGIN_FAILURE:"auth0:loginFailure",LOGOUT_SUCCESS:"auth0:logoutSuccess",LOGOUT_FAILURE:"auth0:logoutFailure",ACQUIRE_TOKEN_FAILURE:"auth0:acquireTokenFailure",REAUTH_START:"auth0:reauthStart",REAUTH_SUCCESS:"auth0:reauthSuccess",INITIALIZE_START:"auth0:initializeStart",INITIALIZE_END:"auth0:initializeEnd",ACQUIRE_TOKEN_OVERALL_SUCCESS:"auth0:acquireTokenOverallSuccess",ACQUIRE_TOKEN_OVERALL_FAILURE:"auth0:acquireTokenOverallFailure"},$v={ACQUIRE_TOKEN_OVERALL_SUCCESS:"msal:acquireTokenOverallSuccess",ACQUIRE_TOKEN_OVERALL_FAILURE:"msal:acquireTokenOverallFailure",INTERACTION_IN_PROGRESS:"msal:interactionInProgress"};function Ha(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]])}return t}var xc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rA(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function iA(n,e){return n(e={exports:{}},e.exports),e.exports}var wc=iA(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});var t=function(){function r(){var i=this;this.locked=new Map,this.addToLocked=function(a,o){var s=i.locked.get(a);s===void 0?o===void 0?i.locked.set(a,[]):i.locked.set(a,[o]):o!==void 0&&(s.unshift(o),i.locked.set(a,s))},this.isLocked=function(a){return i.locked.has(a)},this.lock=function(a){return new Promise(function(o,s){i.isLocked(a)?i.addToLocked(a,o):(i.addToLocked(a),o())})},this.unlock=function(a){var o=i.locked.get(a);if(o!==void 0&&o.length!==0){var s=o.pop();i.locked.set(a,o),s!==void 0&&setTimeout(s,0)}else i.locked.delete(a)}}return r.getInstance=function(){return r.instance===void 0&&(r.instance=new r),r.instance},r}();e.default=function(){return t.getInstance()}});rA(wc);var qne=rA(iA(function(n,e){var t=xc&&xc.__awaiter||function(h,f,p,g){return new(p||(p=Promise))(function(v,y){function b(E){try{S(g.next(E))}catch(T){y(T)}}function C(E){try{S(g.throw(E))}catch(T){y(T)}}function S(E){E.done?v(E.value):new p(function(T){T(E.value)}).then(b,C)}S((g=g.apply(h,f||[])).next())})},r=xc&&xc.__generator||function(h,f){var p,g,v,y,b={label:0,sent:function(){if(1&v[0])throw v[1];return v[1]},trys:[],ops:[]};return y={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function C(S){return function(E){return function(T){if(p)throw new TypeError("Generator is already executing.");for(;b;)try{if(p=1,g&&(v=2&T[0]?g.return:T[0]?g.throw||((v=g.return)&&v.call(g),0):g.next)&&!(v=v.call(g,T[1])).done)return v;switch(g=0,v&&(T=[2&T[0],v.value]),T[0]){case 0:case 1:v=T;break;case 4:return b.label++,{value:T[1],done:!1};case 5:b.label++,g=T[1],T=[0];continue;case 7:T=b.ops.pop(),b.trys.pop();continue;default:if(v=b.trys,!((v=v.length>0&&v[v.length-1])||T[0]!==6&&T[0]!==2)){b=0;continue}if(T[0]===3&&(!v||T[1]>v[0]&&T[1]<v[3])){b.label=T[1];break}if(T[0]===6&&b.label<v[1]){b.label=v[1],v=T;break}if(v&&b.label<v[2]){b.label=v[2],b.ops.push(T);break}v[2]&&b.ops.pop(),b.trys.pop();continue}T=f.call(h,b)}catch(A){T=[6,A],g=0}finally{p=v=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([S,E])}}},i=xc;Object.defineProperty(e,"__esModule",{value:!0});var a="browser-tabs-lock-key",o={key:function(h){return t(i,void 0,void 0,function(){return r(this,function(f){throw new Error("Unsupported")})})},getItem:function(h){return t(i,void 0,void 0,function(){return r(this,function(f){throw new Error("Unsupported")})})},clear:function(){return t(i,void 0,void 0,function(){return r(this,function(h){return[2,window.localStorage.clear()]})})},removeItem:function(h){return t(i,void 0,void 0,function(){return r(this,function(f){throw new Error("Unsupported")})})},setItem:function(h,f){return t(i,void 0,void 0,function(){return r(this,function(p){throw new Error("Unsupported")})})},keySync:function(h){return window.localStorage.key(h)},getItemSync:function(h){return window.localStorage.getItem(h)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(h){return window.localStorage.removeItem(h)},setItemSync:function(h,f){return window.localStorage.setItem(h,f)}};function s(h){return new Promise(function(f){return setTimeout(f,h)})}function c(h){for(var f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",p="",g=0;g<h;g++)p+=f[Math.floor(Math.random()*f.length)];return p}var u=function(){function h(f){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+c(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=f,h.waiters===void 0&&(h.waiters=[])}return h.prototype.acquireLock=function(f,p){return p===void 0&&(p=5e3),t(this,void 0,void 0,function(){var g,v,y,b,C,S,E;return r(this,function(T){switch(T.label){case 0:g=Date.now()+c(4),v=Date.now()+p,y=a+"-"+f,b=this.storageHandler===void 0?o:this.storageHandler,T.label=1;case 1:return Date.now()<v?[4,s(30)]:[3,8];case 2:return T.sent(),b.getItemSync(y)!==null?[3,5]:(C=this.id+"-"+f+"-"+g,[4,s(Math.floor(25*Math.random()))]);case 3:return T.sent(),b.setItemSync(y,JSON.stringify({id:this.id,iat:g,timeoutKey:C,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,s(30)];case 4:return T.sent(),(S=b.getItemSync(y))!==null&&(E=JSON.parse(S)).id===this.id&&E.iat===g?(this.acquiredIatSet.add(g),this.refreshLockWhileAcquired(y,g),[2,!0]):[3,7];case 5:return h.lockCorrector(this.storageHandler===void 0?o:this.storageHandler),[4,this.waitForSomethingToChange(v)];case 6:T.sent(),T.label=7;case 7:return g=Date.now()+c(4),[3,1];case 8:return[2,!1]}})})},h.prototype.refreshLockWhileAcquired=function(f,p){return t(this,void 0,void 0,function(){var g=this;return r(this,function(v){return setTimeout(function(){return t(g,void 0,void 0,function(){var y,b,C;return r(this,function(S){switch(S.label){case 0:return[4,wc.default().lock(p)];case 1:return S.sent(),this.acquiredIatSet.has(p)?(y=this.storageHandler===void 0?o:this.storageHandler,(b=y.getItemSync(f))===null?(wc.default().unlock(p),[2]):((C=JSON.parse(b)).timeRefreshed=Date.now(),y.setItemSync(f,JSON.stringify(C)),wc.default().unlock(p),this.refreshLockWhileAcquired(f,p),[2])):(wc.default().unlock(p),[2])}})})},1e3),[2]})})},h.prototype.waitForSomethingToChange=function(f){return t(this,void 0,void 0,function(){return r(this,function(p){switch(p.label){case 0:return[4,new Promise(function(g){var v=!1,y=Date.now(),b=!1;function C(){if(b||(window.removeEventListener("storage",C),h.removeFromWaiting(C),clearTimeout(S),b=!0),!v){v=!0;var E=50-(Date.now()-y);E>0?setTimeout(g,E):g(null)}}window.addEventListener("storage",C),h.addToWaiting(C);var S=setTimeout(C,Math.max(0,f-Date.now()))})];case 1:return p.sent(),[2]}})})},h.addToWaiting=function(f){this.removeFromWaiting(f),h.waiters!==void 0&&h.waiters.push(f)},h.removeFromWaiting=function(f){h.waiters!==void 0&&(h.waiters=h.waiters.filter(function(p){return p!==f}))},h.notifyWaiters=function(){h.waiters!==void 0&&h.waiters.slice().forEach(function(f){return f()})},h.prototype.releaseLock=function(f){return t(this,void 0,void 0,function(){return r(this,function(p){switch(p.label){case 0:return[4,this.releaseLock__private__(f)];case 1:return[2,p.sent()]}})})},h.prototype.releaseLock__private__=function(f){return t(this,void 0,void 0,function(){var p,g,v,y;return r(this,function(b){switch(b.label){case 0:return p=this.storageHandler===void 0?o:this.storageHandler,g=a+"-"+f,(v=p.getItemSync(g))===null?[2]:(y=JSON.parse(v)).id!==this.id?[3,2]:[4,wc.default().lock(y.iat)];case 1:b.sent(),this.acquiredIatSet.delete(y.iat),p.removeItemSync(g),wc.default().unlock(y.iat),h.notifyWaiters(),b.label=2;case 2:return[2]}})})},h.lockCorrector=function(f){for(var p=Date.now()-5e3,g=f,v=[],y=0;;){var b=g.keySync(y);if(b===null)break;v.push(b),y++}for(var C=!1,S=0;S<v.length;S++){var E=v[S];if(E.includes(a)){var T=g.getItemSync(E);if(T!==null){var A=JSON.parse(T);(A.timeRefreshed===void 0&&A.timeAcquired<p||A.timeRefreshed!==void 0&&A.timeRefreshed<p)&&(g.removeItemSync(E),C=!0)}}}C&&h.notifyWaiters()},h.waiters=void 0,h}();e.default=u}));const Wne={timeoutInSeconds:60},d4={name:"auth0-spa-js",version:"2.1.3"},h4=()=>Date.now();class cr extends Error{constructor(e,t){super(t),this.error=e,this.error_description=t,Object.setPrototypeOf(this,cr.prototype)}static fromPayload({error:e,error_description:t}){return new cr(e,t)}}let Yne=class f4 extends cr{constructor(e,t,r,i=null){super(e,t),this.state=r,this.appState=i,Object.setPrototypeOf(this,f4.prototype)}},I1=class p4 extends cr{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,p4.prototype)}},Qne=class m4 extends I1{constructor(e){super(),this.popup=e,Object.setPrototypeOf(this,m4.prototype)}},Jne=class g4 extends cr{constructor(e){super("cancelled","Popup closed"),this.popup=e,Object.setPrototypeOf(this,g4.prototype)}},Zne=class v4 extends cr{constructor(e,t,r){super(e,t),this.mfa_token=r,Object.setPrototypeOf(this,v4.prototype)}},b4=class y4 extends cr{constructor(e,t){super("missing_refresh_token",`Missing Refresh Token (audience: '${GM(e,["default"])}', scope: '${GM(t)}')`),this.audience=e,this.scope=t,Object.setPrototypeOf(this,y4.prototype)}};function GM(n,e=[]){return n&&!e.includes(n)?n:""}const Wg=()=>window.crypto,OS=()=>{const n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.";let e="";return Array.from(Wg().getRandomValues(new Uint8Array(43))).forEach(t=>e+=n[t%n.length]),e},KM=n=>btoa(n),A1=n=>{var{clientId:e}=n,t=Ha(n,["clientId"]);return new URLSearchParams((r=>Object.keys(r).filter(i=>r[i]!==void 0).reduce((i,a)=>Object.assign(Object.assign({},i),{[a]:r[a]}),{}))(Object.assign({client_id:e},t))).toString()},qM=n=>(e=>decodeURIComponent(atob(e).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))(n.replace(/_/g,"/").replace(/-/g,"+")),Xne=async(n,e)=>{const t=await fetch(n,e);return{ok:t.ok,json:await t.json()}},ere=async(n,e,t)=>{const r=new AbortController;let i;return e.signal=r.signal,Promise.race([Xne(n,e),new Promise((a,o)=>{i=setTimeout(()=>{r.abort(),o(new Error("Timeout when executing 'fetch'"))},t)})]).finally(()=>{clearTimeout(i)})},tre=async(n,e,t,r,i,a,o)=>{return s={auth:{audience:e,scope:t},timeout:i,fetchUrl:n,fetchOptions:r,useFormData:o},c=a,new Promise(function(u,h){const f=new MessageChannel;f.port1.onmessage=function(p){p.data.error?h(new Error(p.data.error)):u(p.data),f.port1.close()},c.postMessage(s,[f.port2])});var s,c},nre=async(n,e,t,r,i,a,o=1e4)=>i?tre(n,e,t,r,o,i,a):ere(n,r,o);async function rre(n,e){var{baseUrl:t,timeout:r,audience:i,scope:a,auth0Client:o,useFormData:s}=n,c=Ha(n,["baseUrl","timeout","audience","scope","auth0Client","useFormData"]);const u=s?A1(c):JSON.stringify(c);return await async function(h,f,p,g,v,y,b){let C,S=null;for(let x=0;x<3;x++)try{C=await nre(h,p,g,v,y,b,f),S=null;break}catch(_){S=_}if(S)throw S;const E=C.json,{error:T,error_description:A}=E,I=Ha(E,["error","error_description"]),{ok:k}=C;if(!k){const x=A||`HTTP error. Unable to fetch ${h}`;throw T==="mfa_required"?new Zne(T,x,I.mfa_token):T==="missing_refresh_token"?new b4(p,g):new cr(T||"request_error",x)}return I}(`${t}/oauth/token`,r,i||"default",a,{method:"POST",body:u,headers:{"Content-Type":s?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(o||d4))}},e,s)}const Qm=(...n)=>{return(e=n.filter(Boolean).join(" ").trim().split(/\s+/),Array.from(new Set(e))).join(" ");var e};let Dc=class k1{constructor(e,t="@@auth0spajs@@",r){this.prefix=t,this.suffix=r,this.clientId=e.clientId,this.scope=e.scope,this.audience=e.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(e){const[t,r,i,a]=e.split("::");return new k1({clientId:r,scope:a,audience:i},t)}static fromCacheEntry(e){const{scope:t,audience:r,client_id:i}=e;return new k1({scope:t,audience:r,clientId:i})}},ire=class{set(e,t){localStorage.setItem(e,JSON.stringify(t))}get(e){const t=window.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch{return}}remove(e){localStorage.removeItem(e)}allKeys(){return Object.keys(window.localStorage).filter(e=>e.startsWith("@@auth0spajs@@"))}},C4=class{constructor(){this.enclosedCache=function(){let e={};return{set(t,r){e[t]=r},get(t){const r=e[t];if(r)return r},remove(t){delete e[t]},allKeys:()=>Object.keys(e)}}()}},are=class{constructor(e,t,r){this.cache=e,this.keyManifest=t,this.nowProvider=r||h4}async setIdToken(e,t,r){var i;const a=this.getIdTokenCacheKey(e);await this.cache.set(a,{id_token:t,decodedToken:r}),await((i=this.keyManifest)===null||i===void 0?void 0:i.add(a))}async getIdToken(e){const t=await this.cache.get(this.getIdTokenCacheKey(e.clientId));if(!t&&e.scope&&e.audience){const r=await this.get(e);return!r||!r.id_token||!r.decodedToken?void 0:{id_token:r.id_token,decodedToken:r.decodedToken}}if(t)return{id_token:t.id_token,decodedToken:t.decodedToken}}async get(e,t=0){var r;let i=await this.cache.get(e.toKey());if(!i){const s=await this.getCacheKeys();if(!s)return;const c=this.matchExistingCacheKey(e,s);c&&(i=await this.cache.get(c))}if(!i)return;const a=await this.nowProvider(),o=Math.floor(a/1e3);return i.expiresAt-t<o?i.body.refresh_token?(i.body={refresh_token:i.body.refresh_token},await this.cache.set(e.toKey(),i),i.body):(await this.cache.remove(e.toKey()),void await((r=this.keyManifest)===null||r===void 0?void 0:r.remove(e.toKey()))):i.body}async set(e){var t;const r=new Dc({clientId:e.client_id,scope:e.scope,audience:e.audience}),i=await this.wrapCacheEntry(e);await this.cache.set(r.toKey(),i),await((t=this.keyManifest)===null||t===void 0?void 0:t.add(r.toKey()))}async clear(e){var t;const r=await this.getCacheKeys();r&&(await r.filter(i=>!e||i.includes(e)).reduce(async(i,a)=>{await i,await this.cache.remove(a)},Promise.resolve()),await((t=this.keyManifest)===null||t===void 0?void 0:t.clear()))}async wrapCacheEntry(e){const t=await this.nowProvider();return{body:e,expiresAt:Math.floor(t/1e3)+e.expires_in}}async getCacheKeys(){var e;return this.keyManifest?(e=await this.keyManifest.get())===null||e===void 0?void 0:e.keys:this.cache.allKeys?this.cache.allKeys():void 0}getIdTokenCacheKey(e){return new Dc({clientId:e},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(e,t){return t.filter(r=>{var i;const a=Dc.fromKey(r),o=new Set(a.scope&&a.scope.split(" ")),s=((i=e.scope)===null||i===void 0?void 0:i.split(" "))||[],c=a.scope&&s.reduce((u,h)=>u&&o.has(h),!0);return a.prefix==="@@auth0spajs@@"&&a.clientId===e.clientId&&a.audience===e.audience&&c})[0]}},ore=class{constructor(e,t,r){this.storage=e,this.clientId=t,this.cookieDomain=r,this.storageKey=`a0.spajs.txs.${this.clientId}`}create(e){this.storage.save(this.storageKey,e,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}};const Qh=n=>typeof n=="number",sre=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"],cre=n=>{if(!n.id_token)throw new Error("ID token is required but missing");const e=(a=>{const o=a.split("."),[s,c,u]=o;if(o.length!==3||!s||!c||!u)throw new Error("ID token could not be decoded");const h=JSON.parse(qM(c)),f={__raw:a},p={};return Object.keys(h).forEach(g=>{f[g]=h[g],sre.includes(g)||(p[g]=h[g])}),{encoded:{header:s,payload:c,signature:u},header:JSON.parse(qM(s)),claims:f,user:p}})(n.id_token);if(!e.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(e.claims.iss!==n.iss)throw new Error(`Issuer (iss) claim mismatch in the ID token; expected "${n.iss}", found "${e.claims.iss}"`);if(!e.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if(e.header.alg!=="RS256")throw new Error(`Signature algorithm of "${e.header.alg}" is not supported. Expected the ID token to be signed with "RS256".`);if(!e.claims.aud||typeof e.claims.aud!="string"&&!Array.isArray(e.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(e.claims.aud)){if(!e.claims.aud.includes(n.aud))throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${n.aud}" but was not one of "${e.claims.aud.join(", ")}"`);if(e.claims.aud.length>1){if(!e.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(e.claims.azp!==n.aud)throw new Error(`Authorized Party (azp) claim mismatch in the ID token; expected "${n.aud}", found "${e.claims.azp}"`)}}else if(e.claims.aud!==n.aud)throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${n.aud}" but found "${e.claims.aud}"`);if(n.nonce){if(!e.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(e.claims.nonce!==n.nonce)throw new Error(`Nonce (nonce) claim mismatch in the ID token; expected "${n.nonce}", found "${e.claims.nonce}"`)}if(n.max_age&&!Qh(e.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(e.claims.exp==null||!Qh(e.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!Qh(e.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");const t=n.leeway||60,r=new Date(n.now||Date.now()),i=new Date(0);if(i.setUTCSeconds(e.claims.exp+t),r>i)throw new Error(`Expiration Time (exp) claim error in the ID token; current time (${r}) is after expiration time (${i})`);if(e.claims.nbf!=null&&Qh(e.claims.nbf)){const a=new Date(0);if(a.setUTCSeconds(e.claims.nbf-t),r<a)throw new Error(`Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (${r}) is before ${a}`)}if(e.claims.auth_time!=null&&Qh(e.claims.auth_time)){const a=new Date(0);if(a.setUTCSeconds(parseInt(e.claims.auth_time)+n.max_age+t),r>a)throw new Error(`Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (${r}) is after last auth at ${a}`)}if(n.organization){const a=n.organization.trim();if(a.startsWith("org_")){const o=a;if(!e.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(o!==e.claims.org_id)throw new Error(`Organization ID (org_id) claim mismatch in the ID token; expected "${o}", found "${e.claims.org_id}"`)}else{const o=a.toLowerCase();if(!e.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(o!==e.claims.org_name)throw new Error(`Organization Name (org_name) claim mismatch in the ID token; expected "${o}", found "${e.claims.org_name}"`)}}return e};var jc=iA(function(n,e){var t=xc&&xc.__assign||function(){return t=Object.assign||function(c){for(var u,h=1,f=arguments.length;h<f;h++)for(var p in u=arguments[h])Object.prototype.hasOwnProperty.call(u,p)&&(c[p]=u[p]);return c},t.apply(this,arguments)};function r(c,u){if(!u)return"";var h="; "+c;return u===!0?h:h+"="+u}function i(c,u,h){return encodeURIComponent(c).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(u).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(f){if(typeof f.expires=="number"){var p=new Date;p.setMilliseconds(p.getMilliseconds()+864e5*f.expires),f.expires=p}return r("Expires",f.expires?f.expires.toUTCString():"")+r("Domain",f.domain)+r("Path",f.path)+r("Secure",f.secure)+r("SameSite",f.sameSite)}(h)}function a(c){for(var u={},h=c?c.split("; "):[],f=/(%[\dA-F]{2})+/gi,p=0;p<h.length;p++){var g=h[p].split("="),v=g.slice(1).join("=");v.charAt(0)==='"'&&(v=v.slice(1,-1));try{u[g[0].replace(f,decodeURIComponent)]=v.replace(f,decodeURIComponent)}catch{}}return u}function o(){return a(document.cookie)}function s(c,u,h){document.cookie=i(c,u,t({path:"/"},h))}e.__esModule=!0,e.encode=i,e.parse=a,e.getAll=o,e.get=function(c){return o()[c]},e.set=s,e.remove=function(c,u){s(c,"",t(t({},u),{expires:-1}))}});rA(jc),jc.encode,jc.parse,jc.getAll;var lre=jc.get,S4=jc.set,w4=jc.remove;const Du={get(n){const e=lre(n);if(e!==void 0)return JSON.parse(e)},save(n,e,t){let r={};window.location.protocol==="https:"&&(r={secure:!0,sameSite:"none"}),t!=null&&t.daysUntilExpire&&(r.expires=t.daysUntilExpire),t!=null&&t.cookieDomain&&(r.domain=t.cookieDomain),S4(n,JSON.stringify(e),r)},remove(n,e){let t={};e!=null&&e.cookieDomain&&(t.domain=e.cookieDomain),w4(n,t)}},ure={get(n){return Du.get(n)||Du.get(`_legacy_${n}`)},save(n,e,t){let r={};window.location.protocol==="https:"&&(r={secure:!0}),t!=null&&t.daysUntilExpire&&(r.expires=t.daysUntilExpire),t!=null&&t.cookieDomain&&(r.domain=t.cookieDomain),S4(`_legacy_${n}`,JSON.stringify(e),r),Du.save(n,e,t)},remove(n,e){let t={};e!=null&&e.cookieDomain&&(t.domain=e.cookieDomain),w4(n,t),Du.remove(n,e),Du.remove(`_legacy_${n}`,e)}},dre={get(n){if(typeof sessionStorage>"u")return;const e=sessionStorage.getItem(n);return e!=null?JSON.parse(e):void 0},save(n,e){sessionStorage.setItem(n,JSON.stringify(e))},remove(n){sessionStorage.removeItem(n)}};function hre(n,e,t){var r=e===void 0?null:e,i=function(c,u){var h=atob(c);if(u){for(var f=new Uint8Array(h.length),p=0,g=h.length;p<g;++p)f[p]=h.charCodeAt(p);return String.fromCharCode.apply(null,new Uint16Array(f.buffer))}return h}(n,t!==void 0&&t),a=i.indexOf(`
`,10)+1,o=i.substring(a)+(r?"//# sourceMappingURL="+r:""),s=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(s)}var WM,YM,QM,LS,fre=(WM="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHtlcnJvcjp0LGVycm9yX2Rlc2NyaXB0aW9uOnJ9KXtyZXR1cm4gbmV3IGUodCxyKX19Y2xhc3MgdCBleHRlbmRzIGV7Y29uc3RydWN0b3IoZSxzKXtzdXBlcigibWlzc2luZ19yZWZyZXNoX3Rva2VuIixgTWlzc2luZyBSZWZyZXNoIFRva2VuIChhdWRpZW5jZTogJyR7cihlLFsiZGVmYXVsdCJdKX0nLCBzY29wZTogJyR7cihzKX0nKWApLHRoaXMuYXVkaWVuY2U9ZSx0aGlzLnNjb3BlPXMsT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsdC5wcm90b3R5cGUpfX1mdW5jdGlvbiByKGUsdD1bXSl7cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDp0fT1lLHI9ZnVuY3Rpb24oZSx0KXt2YXIgcj17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmdC5pbmRleE9mKHMpPDAmJihyW3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspdC5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYocltzW29dXT1lW3Nbb11dKX1yZXR1cm4gcn0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PWVbdF0pKS5yZWR1Y2UoKCh0LHIpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse1tyXTplW3JdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnR9LHIpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSx0KT0+YCR7ZX18JHt0fWA7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jKHtkYXRhOnt0aW1lb3V0OmUsYXV0aDpyLGZldGNoVXJsOmksZmV0Y2hPcHRpb25zOmMsdXNlRm9ybURhdGE6YX0scG9ydHM6W3BdfSk9PntsZXQgZjtjb25zdHthdWRpZW5jZTp1LHNjb3BlOmx9PXJ8fHt9O3RyeXtjb25zdCByPWE/KGU9Pntjb25zdCB0PW5ldyBVUkxTZWFyY2hQYXJhbXMoZSkscj17fTtyZXR1cm4gdC5mb3JFYWNoKCgoZSx0KT0+e3JbdF09ZX0pKSxyfSkoYy5ib2R5KTpKU09OLnBhcnNlKGMuYm9keSk7aWYoIXIucmVmcmVzaF90b2tlbiYmInJlZnJlc2hfdG9rZW4iPT09ci5ncmFudF90eXBlKXtjb25zdCBlPSgoZSx0KT0+b1tuKGUsdCldKSh1LGwpO2lmKCFlKXRocm93IG5ldyB0KHUsbCk7Yy5ib2R5PWE/cyhPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scikse3JlZnJlc2hfdG9rZW46ZX0pKTpKU09OLnN0cmluZ2lmeShPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scikse3JlZnJlc2hfdG9rZW46ZX0pKX1sZXQgaCxnOyJmdW5jdGlvbiI9PXR5cGVvZiBBYm9ydENvbnRyb2xsZXImJihoPW5ldyBBYm9ydENvbnRyb2xsZXIsYy5zaWduYWw9aC5zaWduYWwpO3RyeXtnPWF3YWl0IFByb21pc2UucmFjZShbKGQ9ZSxuZXcgUHJvbWlzZSgoZT0+c2V0VGltZW91dChlLGQpKSkpLGZldGNoKGksT2JqZWN0LmFzc2lnbih7fSxjKSldKX1jYXRjaChlKXtyZXR1cm4gdm9pZCBwLnBvc3RNZXNzYWdlKHtlcnJvcjplLm1lc3NhZ2V9KX1pZighZylyZXR1cm4gaCYmaC5hYm9ydCgpLHZvaWQgcC5wb3N0TWVzc2FnZSh7ZXJyb3I6IlRpbWVvdXQgd2hlbiBleGVjdXRpbmcgJ2ZldGNoJyJ9KTtmPWF3YWl0IGcuanNvbigpLGYucmVmcmVzaF90b2tlbj8oKChlLHQscik9PntvW24odCxyKV09ZX0pKGYucmVmcmVzaF90b2tlbix1LGwpLGRlbGV0ZSBmLnJlZnJlc2hfdG9rZW4pOigoZSx0KT0+e2RlbGV0ZSBvW24oZSx0KV19KSh1LGwpLHAucG9zdE1lc3NhZ2Uoe29rOmcub2ssanNvbjpmfSl9Y2F0Y2goZSl7cC5wb3N0TWVzc2FnZSh7b2s6ITEsanNvbjp7ZXJyb3I6ZS5lcnJvcixlcnJvcl9kZXNjcmlwdGlvbjplLm1lc3NhZ2V9fSl9dmFyIGR9KSl9KCk7Cgo=",YM=null,QM=!1,function(n){return LS=LS||hre(WM,YM,QM),new Worker(LS,n)});const DS={};let pre=class{constructor(e,t){this.cache=e,this.clientId=t,this.manifestKey=this.createManifestKeyFrom(this.clientId)}async add(e){var t;const r=new Set(((t=await this.cache.get(this.manifestKey))===null||t===void 0?void 0:t.keys)||[]);r.add(e),await this.cache.set(this.manifestKey,{keys:[...r]})}async remove(e){const t=await this.cache.get(this.manifestKey);if(t){const r=new Set(t.keys);return r.delete(e),r.size>0?await this.cache.set(this.manifestKey,{keys:[...r]}):await this.cache.remove(this.manifestKey)}}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(e){return`@@auth0spajs@@::${e}`}};const mre={memory:()=>new C4().enclosedCache,localstorage:()=>new ire},JM=n=>mre[n],ZM=n=>{const{openUrl:e,onRedirect:t}=n,r=Ha(n,["openUrl","onRedirect"]);return Object.assign(Object.assign({},r),{openUrl:e===!1||e?e:t})},jS=new qne;let gre=class{constructor(e){let t,r;if(this.userCache=new C4().enclosedCache,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=async()=>{await jS.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)},this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),e),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),e.authorizationParams)}),typeof window<"u"&&(()=>{if(!Wg())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(Wg().subtle===void 0)throw new Error(`
      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.
    `)})(),e.cache&&e.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),e.cache)r=e.cache;else{if(t=e.cacheLocation||"memory",!JM(t))throw new Error(`Invalid cache location "${t}"`);r=JM(t)()}this.httpTimeoutMs=e.httpTimeoutInSeconds?1e3*e.httpTimeoutInSeconds:1e4,this.cookieStorage=e.legacySameSiteCookie===!1?Du:ure,this.orgHintCookieName=`auth0.${this.options.clientId}.organization_hint`,this.isAuthenticatedCookieName=(o=>`auth0.${o}.is.authenticated`)(this.options.clientId),this.sessionCheckExpiryDays=e.sessionCheckExpiryDays||1;const i=e.useCookiesForTransactions?this.cookieStorage:dre;var a;this.scope=Qm("openid",this.options.authorizationParams.scope,this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new ore(i,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||h4,this.cacheManager=new are(r,r.allKeys?void 0:new pre(r,this.options.clientId),this.nowProvider),this.domainUrl=(a=this.options.domain,/^https?:\/\//.test(a)?a:`https://${a}`),this.tokenIssuer=((o,s)=>o?o.startsWith("https://")?o:`https://${o}/`:`${s}/`)(this.options.issuer,this.domainUrl),typeof window<"u"&&window.Worker&&this.options.useRefreshTokens&&t==="memory"&&(this.options.workerUrl?this.worker=new Worker(this.options.workerUrl):this.worker=new fre)}_url(e){const t=encodeURIComponent(btoa(JSON.stringify(this.options.auth0Client||d4)));return`${this.domainUrl}${e}&auth0Client=${t}`}_authorizeUrl(e){return this._url(`/authorize?${A1(e)}`)}async _verifyIdToken(e,t,r){const i=await this.nowProvider();return cre({iss:this.tokenIssuer,aud:this.options.clientId,id_token:e,nonce:t,organization:r,leeway:this.options.leeway,max_age:(a=this.options.authorizationParams.max_age,typeof a!="string"?a:parseInt(a,10)||void 0),now:i});var a}_processOrgHint(e){e?this.cookieStorage.save(this.orgHintCookieName,e,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}async _prepareAuthorizeUrl(e,t,r){const i=KM(OS()),a=KM(OS()),o=OS(),s=(h=>{const f=new Uint8Array(h);return(p=>{const g={"+":"-","/":"_","=":""};return p.replace(/[+/=]/g,v=>g[v])})(window.btoa(String.fromCharCode(...Array.from(f))))})(await(async h=>await Wg().subtle.digest({name:"SHA-256"},new TextEncoder().encode(h)))(o)),c=((h,f,p,g,v,y,b,C)=>Object.assign(Object.assign(Object.assign({client_id:h.clientId},h.authorizationParams),p),{scope:Qm(f,p.scope),response_type:"code",response_mode:C||"query",state:g,nonce:v,redirect_uri:b||h.authorizationParams.redirect_uri,code_challenge:y,code_challenge_method:"S256"}))(this.options,this.scope,e,i,a,s,e.redirect_uri||this.options.authorizationParams.redirect_uri||r,t==null?void 0:t.response_mode),u=this._authorizeUrl(c);return{nonce:a,code_verifier:o,scope:c.scope,audience:c.audience||"default",redirect_uri:c.redirect_uri,state:i,url:u}}async loginWithPopup(e,t){var r;if(e=e||{},!(t=t||{}).popup&&(t.popup=(s=>{const c=window.screenX+(window.innerWidth-400)/2,u=window.screenY+(window.innerHeight-600)/2;return window.open(s,"auth0:authorize:popup",`left=${c},top=${u},width=400,height=600,resizable,scrollbars=yes,status=1`)})(""),!t.popup))throw new Error("Unable to open a popup for loginWithPopup - window.open returned `null`");const i=await this._prepareAuthorizeUrl(e.authorizationParams||{},{response_mode:"web_message"},window.location.origin);t.popup.location.href=i.url;const a=await(s=>new Promise((c,u)=>{let h;const f=setInterval(()=>{s.popup&&s.popup.closed&&(clearInterval(f),clearTimeout(p),window.removeEventListener("message",h,!1),u(new Jne(s.popup)))},1e3),p=setTimeout(()=>{clearInterval(f),u(new Qne(s.popup)),window.removeEventListener("message",h,!1)},1e3*(s.timeoutInSeconds||60));h=function(g){if(g.data&&g.data.type==="authorization_response"){if(clearTimeout(p),clearInterval(f),window.removeEventListener("message",h,!1),s.popup.close(),g.data.response.error)return u(cr.fromPayload(g.data.response));c(g.data.response)}},window.addEventListener("message",h)}))(Object.assign(Object.assign({},t),{timeoutInSeconds:t.timeoutInSeconds||this.options.authorizeTimeoutInSeconds||60}));if(i.state!==a.state)throw new cr("state_mismatch","Invalid state");const o=((r=e.authorizationParams)===null||r===void 0?void 0:r.organization)||this.options.authorizationParams.organization;await this._requestToken({audience:i.audience,scope:i.scope,code_verifier:i.code_verifier,grant_type:"authorization_code",code:a.code,redirect_uri:i.redirect_uri},{nonceIn:i.nonce,organization:o})}async getUser(){var e;const t=await this._getIdTokenFromCache();return(e=t==null?void 0:t.decodedToken)===null||e===void 0?void 0:e.user}async getIdTokenClaims(){var e;const t=await this._getIdTokenFromCache();return(e=t==null?void 0:t.decodedToken)===null||e===void 0?void 0:e.claims}async loginWithRedirect(e={}){var t;const r=ZM(e),{openUrl:i,fragment:a,appState:o}=r,s=Ha(r,["openUrl","fragment","appState"]),c=((t=s.authorizationParams)===null||t===void 0?void 0:t.organization)||this.options.authorizationParams.organization,u=await this._prepareAuthorizeUrl(s.authorizationParams||{}),{url:h}=u,f=Ha(u,["url"]);this.transactionManager.create(Object.assign(Object.assign(Object.assign({},f),{appState:o}),c&&{organization:c}));const p=a?`${h}#${a}`:h;i?await i(p):window.location.assign(p)}async handleRedirectCallback(e=window.location.href){const t=e.split("?").slice(1);if(t.length===0)throw new Error("There are no query params available for parsing.");const{state:r,code:i,error:a,error_description:o}=(f=>{f.indexOf("#")>-1&&(f=f.substring(0,f.indexOf("#")));const p=new URLSearchParams(f);return{state:p.get("state"),code:p.get("code")||void 0,error:p.get("error")||void 0,error_description:p.get("error_description")||void 0}})(t.join("")),s=this.transactionManager.get();if(!s)throw new cr("missing_transaction","Invalid state");if(this.transactionManager.remove(),a)throw new Yne(a,o||a,r,s.appState);if(!s.code_verifier||s.state&&s.state!==r)throw new cr("state_mismatch","Invalid state");const c=s.organization,u=s.nonce,h=s.redirect_uri;return await this._requestToken(Object.assign({audience:s.audience,scope:s.scope,code_verifier:s.code_verifier,grant_type:"authorization_code",code:i},h?{redirect_uri:h}:{}),{nonceIn:u,organization:c}),{appState:s.appState}}async checkSession(e){if(!this.cookieStorage.get(this.isAuthenticatedCookieName)){if(!this.cookieStorage.get("auth0.is.authenticated"))return;this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove("auth0.is.authenticated")}try{await this.getTokenSilently(e)}catch{}}async getTokenSilently(e={}){var t;const r=Object.assign(Object.assign({cacheMode:"on"},e),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),e.authorizationParams),{scope:Qm(this.scope,(t=e.authorizationParams)===null||t===void 0?void 0:t.scope)})}),i=await((a,o)=>{let s=DS[o];return s||(s=a().finally(()=>{delete DS[o],s=null}),DS[o]=s),s})(()=>this._getTokenSilently(r),`${this.options.clientId}::${r.authorizationParams.audience}::${r.authorizationParams.scope}`);return e.detailedResponse?i:i==null?void 0:i.access_token}async _getTokenSilently(e){const{cacheMode:t}=e,r=Ha(e,["cacheMode"]);if(t!=="off"){const i=await this._getEntryFromCache({scope:r.authorizationParams.scope,audience:r.authorizationParams.audience||"default",clientId:this.options.clientId});if(i)return i}if(t!=="cache-only"){if(!await(async(i,a=3)=>{for(let o=0;o<a;o++)if(await i())return!0;return!1})(()=>jS.acquireLock("auth0.lock.getTokenSilently",5e3),10))throw new I1;try{if(window.addEventListener("pagehide",this._releaseLockOnPageHide),t!=="off"){const u=await this._getEntryFromCache({scope:r.authorizationParams.scope,audience:r.authorizationParams.audience||"default",clientId:this.options.clientId});if(u)return u}const i=this.options.useRefreshTokens?await this._getTokenUsingRefreshToken(r):await this._getTokenFromIFrame(r),{id_token:a,access_token:o,oauthTokenScope:s,expires_in:c}=i;return Object.assign(Object.assign({id_token:a,access_token:o},s?{scope:s}:null),{expires_in:c})}finally{await jS.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)}}}async getTokenWithPopup(e={},t={}){var r;const i=Object.assign(Object.assign({},e),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),e.authorizationParams),{scope:Qm(this.scope,(r=e.authorizationParams)===null||r===void 0?void 0:r.scope)})});return t=Object.assign(Object.assign({},Wne),t),await this.loginWithPopup(i,t),(await this.cacheManager.get(new Dc({scope:i.authorizationParams.scope,audience:i.authorizationParams.audience||"default",clientId:this.options.clientId}))).access_token}async isAuthenticated(){return!!await this.getUser()}_buildLogoutUrl(e){e.clientId!==null?e.clientId=e.clientId||this.options.clientId:delete e.clientId;const t=e.logoutParams||{},{federated:r}=t,i=Ha(t,["federated"]),a=r?"&federated":"";return this._url(`/v2/logout?${A1(Object.assign({clientId:e.clientId},i))}`)+a}async logout(e={}){const t=ZM(e),{openUrl:r}=t,i=Ha(t,["openUrl"]);e.clientId===null?await this.cacheManager.clear():await this.cacheManager.clear(e.clientId||this.options.clientId),this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove(this.isAuthenticatedCookieName,{cookieDomain:this.options.cookieDomain}),this.userCache.remove("@@user@@");const a=this._buildLogoutUrl(i);r?await r(a):r!==!1&&window.location.assign(a)}async _getTokenFromIFrame(e){const t=Object.assign(Object.assign({},e.authorizationParams),{prompt:"none"}),r=this.cookieStorage.get(this.orgHintCookieName);r&&!t.organization&&(t.organization=r);const{url:i,state:a,nonce:o,code_verifier:s,redirect_uri:c,scope:u,audience:h}=await this._prepareAuthorizeUrl(t,{response_mode:"web_message"},window.location.origin);try{if(window.crossOriginIsolated)throw new cr("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");const f=e.timeoutInSeconds||this.options.authorizeTimeoutInSeconds,p=await((v,y,b=60)=>new Promise((C,S)=>{const E=window.document.createElement("iframe");E.setAttribute("width","0"),E.setAttribute("height","0"),E.style.display="none";const T=()=>{window.document.body.contains(E)&&(window.document.body.removeChild(E),window.removeEventListener("message",A,!1))};let A;const I=setTimeout(()=>{S(new I1),T()},1e3*b);A=function(k){if(k.origin!=y||!k.data||k.data.type!=="authorization_response")return;const x=k.source;x&&x.close(),k.data.response.error?S(cr.fromPayload(k.data.response)):C(k.data.response),clearTimeout(I),window.removeEventListener("message",A,!1),setTimeout(T,2e3)},window.addEventListener("message",A,!1),window.document.body.appendChild(E),E.setAttribute("src",v)}))(i,this.domainUrl,f);if(a!==p.state)throw new cr("state_mismatch","Invalid state");const g=await this._requestToken(Object.assign(Object.assign({},e.authorizationParams),{code_verifier:s,code:p.code,grant_type:"authorization_code",redirect_uri:c,timeout:e.authorizationParams.timeout||this.httpTimeoutMs}),{nonceIn:o,organization:t.organization});return Object.assign(Object.assign({},g),{scope:u,oauthTokenScope:g.scope,audience:h})}catch(f){throw f.error==="login_required"&&this.logout({openUrl:!1}),f}}async _getTokenUsingRefreshToken(e){const t=await this.cacheManager.get(new Dc({scope:e.authorizationParams.scope,audience:e.authorizationParams.audience||"default",clientId:this.options.clientId}));if(!(t&&t.refresh_token||this.worker)){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e);throw new b4(e.authorizationParams.audience||"default",e.authorizationParams.scope)}const r=e.authorizationParams.redirect_uri||this.options.authorizationParams.redirect_uri||window.location.origin,i=typeof e.timeoutInSeconds=="number"?1e3*e.timeoutInSeconds:null;try{const a=await this._requestToken(Object.assign(Object.assign(Object.assign({},e.authorizationParams),{grant_type:"refresh_token",refresh_token:t&&t.refresh_token,redirect_uri:r}),i&&{timeout:i}));return Object.assign(Object.assign({},a),{scope:e.authorizationParams.scope,oauthTokenScope:a.scope,audience:e.authorizationParams.audience||"default"})}catch(a){if((a.message.indexOf("Missing Refresh Token")>-1||a.message&&a.message.indexOf("invalid refresh token")>-1)&&this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e);throw a}}async _saveEntryInCache(e){const{id_token:t,decodedToken:r}=e,i=Ha(e,["id_token","decodedToken"]);this.userCache.set("@@user@@",{id_token:t,decodedToken:r}),await this.cacheManager.setIdToken(this.options.clientId,e.id_token,e.decodedToken),await this.cacheManager.set(i)}async _getIdTokenFromCache(){const e=this.options.authorizationParams.audience||"default",t=await this.cacheManager.getIdToken(new Dc({clientId:this.options.clientId,audience:e,scope:this.scope})),r=this.userCache.get("@@user@@");return t&&t.id_token===(r==null?void 0:r.id_token)?r:(this.userCache.set("@@user@@",t),t)}async _getEntryFromCache({scope:e,audience:t,clientId:r}){const i=await this.cacheManager.get(new Dc({scope:e,audience:t,clientId:r}),60);if(i&&i.access_token){const{access_token:a,oauthTokenScope:o,expires_in:s}=i,c=await this._getIdTokenFromCache();return c&&Object.assign(Object.assign({id_token:c.id_token,access_token:a},o?{scope:o}:null),{expires_in:s})}}async _requestToken(e,t){const{nonceIn:r,organization:i}=t||{},a=await rre(Object.assign({baseUrl:this.domainUrl,client_id:this.options.clientId,auth0Client:this.options.auth0Client,useFormData:this.options.useFormData,timeout:this.httpTimeoutMs},e),this.worker),o=await this._verifyIdToken(a.id_token,r,i);return await this._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},a),{decodedToken:o,scope:e.scope,audience:e.audience||"default"}),a.scope?{oauthTokenScope:a.scope}:null),{client_id:this.options.clientId})),this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this._processOrgHint(i||o.claims.org_id),Object.assign(Object.assign({},a),{decodedToken:o})}};async function vre(n){const e=new gre(n);return await e.checkSession(),e}const E4=O(!1),En=O(null),Gl=O(n=>{const e=n(En);return e?e.accountType==="AAD":!1}),E4e=O(n=>{const e=n(En);return e?e.accountType==="MSA":!1}),T4=O(n=>n(En)!==null),la=O(null),bre=O(!0);function I4(n,e="all"){const t=m.useRef(n),r=m.useMemo(()=>{const i=t.current.map(ec);return O(a=>e==="all"?i.every(o=>a(o)):i.some(o=>a(o)))},[e]);return N(r)}function Bd(n,e="all"){return e==="all"?n.every(t=>$e(t)):n.some(t=>$e(t))}const yre=["token-retry-max-1","token-retry-max-2"],Cre=["token-retry-max-1-auth0","token-retry-max-2-auth0"],Sre=["token-retry-max-1-auth0","token-retry-max-1"],wre=["token-retry-max-2-auth0","token-retry-max-2"];function A4(){const n={initialDelayMs:100,maxDelayMs:500,backoffFactor:2};return Bd(Sre,"any")?{...n,maxRetries:1}:Bd(wre,"any")?{...n,maxRetries:2}:{...n,maxRetries:0}}function k4(n,e,t){return t!==void 0?t:e&&!n}function fr(){const n=N(j3),e=N(Gl),t=!!N(En);return k4(e,t,n)}function Ep(){const n=dt(),e=n.get(j3),t=n.get(Gl),r=!!n.get(En);return k4(t,r,e)}async function Ere(n){var r;const e=(r=n.body)==null?void 0:r.getReader();if(!e)return 0;let t=0;try{const i=performance.now();for(;performance.now()-i<2e3;){const{value:a,done:o}=await e.read();if(o)break;t+=a.byteLength}return t}catch{return 0}}const x4=["character-animation-spda2e","character-animation-vasa","tv-lumi"];function _4(){return I4(x4,"any")}function Tre(){const n=N($l);return _4()&&!!n}function Es(){const n=dt().get($l);return Bd(x4,"any")&&!!n}function Jm(n){return T3.includes(n)}const Ire="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/meshopt_decoder-3Kt66jYv.js";var kn;let oo=(kn=class{static async loadLibraries(){const[e,,t]=await Promise.all([$(()=>import("./index-UVYogKnR.js").then(r=>r.c),__vite__mapDeps([3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,1,2,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221])),$(()=>import("./index-Uwxtskni.js").then(r=>r.b),__vite__mapDeps([222,223,4,5,32,7,8,13,224,225,28,37,1,2,54,226,227,179,71,34,30,31,228,192,229,190,230,231,232,233,189,36,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,10,11,12,256,257,258,259,73,74,260,261,262,263,264])),$(()=>import("./math.scalar.functions-C0i4R8fp.js").then(r=>r.f),[])]);e.MeshoptCompression.Configuration={decoder:{url:Ire}},e.Logger.LogLevels=e.Logger.NoneLogLevel,kn.Core=e,kn.Math=t,kn.isInitialized=!0}static async loadViewerLibraries(){const e=await $(()=>import("./index-CcqUjx7W.js"),__vite__mapDeps([265,24,4,5,9,188,266,224,1,2]));kn.Viewer=e}static async loadDebugLibraries(){await kn.loadLibraries(),await $(()=>import("./babylon.inspector.bundle-rqCPPOED.js").then(e=>e.b),__vite__mapDeps([267,2,268,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,1,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,269,266,223,224,225,222,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,270,271,272]))}static isLoaded(){return kn.isInitialized}static getCore(){return kn.throwIfNotInitialized("Core"),kn.Core}static getMath(){return kn.throwIfNotInitialized("Core"),kn.Math}static getViewer(){return kn.throwIfNotInitialized("Viewer"),kn.Viewer}static throwIfNotInitialized(e){if(!kn.isInitialized)throw new Error(`Libraries ${e} are not loaded yet. Call loadLibraries first.`)}},B(kn,"Core"),B(kn,"Math"),B(kn,"Viewer"),B(kn,"isInitialized",!1),kn);function T4e(n){const e=n.split(/[\\/]/),t=e.pop();return{basePath:`${e.join("/")}/`,fileName:t??""}}function I4e(n,e){H.trackEvent({name:"interaction",data:{eventName:"characterAnimation",eventInfo_characterAnimationState:n,eventInfo_characterId:e}})}function A4e(n,e){const{Texture:t}=oo.getCore();return new Promise((r,i)=>{const a=new t(n,e,!1,!1,1,()=>{r(a)},i)})}function k4e(n){const{Vector3:e}=oo.getCore();return new e(n[0],n[1]??0,n[2]??0)}function x4e(n){return Math.max(...n)-Math.min(...n)}function _4e(n){return n*Math.PI/180}function XM(n){const{Clamp:e}=oo.getMath();return e(n,0,1)}function Are(n,e,t){return Math.abs(n-e)>t?e:n}function M4e(n,e,t=.01,r=.2){const{MoveTowards:i}=oo.getMath();return i(n,Are(n,e,t),r)}let eR;function Jh(...n){eR===void 0&&(eR=$e("babylon-debug"))}class kre{constructor(){B(this,"resourceObserver");B(this,"entries",[]);B(this,"keyword",null);this.resourceObserver=new PerformanceObserver(e=>{this.handleResources(e)})}trackStart(e){this.keyword=e,this.resourceObserver.observe({type:"resource",buffered:!1})}trackEnd(){const{entries:e}=this,t=e[e.length-1];return this.resourceObserver.disconnect(),this.entries=[],this.keyword=null,t?{name:t.name,duration:Math.round(t.duration)}:null}handleResources(e){if(this.keyword)for(const t of e.getEntries())t.name.includes(this.keyword)&&this.entries.push(t)}}class xre{constructor(e=!0){B(this,"interactTime",0);B(this,"voiceChatToggledTime",0);B(this,"speechEndDetectedTime",0);B(this,"startMessageTime",0);B(this,"mountedTime",0);B(this,"libsLoadedTime",0);B(this,"sceneInitializedTime",0);B(this,"interactSource","");B(this,"currentConversationId","");B(this,"currentMessageId","");B(this,"visualizerEnabled",!1);B(this,"loadedEnd",!1);B(this,"voiceChatToggledOn",!1);B(this,"resourceMonitor",new kre);B(this,"isVoiceCall");B(this,"resetLoading",()=>{Jh("%c[] -> resetAppearanceEvent"),this.interactTime=0,this.visualizerEnabled=!1,this.loadedEnd=!1});B(this,"isAvailable",()=>this.isVoiceCall?Es()&&this.voiceChatToggledOn&&this.interactTime>0:Es()&&this.mountedTime>0);B(this,"trackLoadingEvent",e=>{if(!this.isAvailable())return;const{eventName:t,duration:r,characterId:i,networkDuration:a}=e;if(i&&!Jm(i))return;const s=["voiceChatToggled","appearanceVisible","appearanceLoadingComplete"].includes(t),c=!Pn(jq);H.trackEvent({name:"system",data:{eventName:t,eventInfo_duration:Math.round(r),eventInfo_conversationId:this.currentConversationId,eventInfo_firstTime:c,eventInfo_characterId:i,eventInfo_trigger:s?this.interactSource:void 0,eventInfo_networkDuration:a,eventInfo_customData:JSON.stringify({isVoiceCall:this.isVoiceCall})}}),Jh(`%c[] -> ${t} : `,"color: #691dc6",Math.round(r),c?"firstTime":"",i?`characterId: ${i}`:"",`isVoiceCall: ${this.isVoiceCall===!0}`)});B(this,"onUserInteract",e=>{this.resetLoading(),this.interactTime=performance.now(),this.interactSource=e,Jh("%c[] -> onUserInteract","color: #222222")});B(this,"onVoiceChatToggled",(e,t)=>{if(e==="end")this.voiceChatToggledOn=!1,this.speechEndDetectedTime=0,this.resourceMonitor.trackEnd();else{this.voiceChatToggledOn=!0,this.voiceChatToggledTime=performance.now(),this.currentConversationId=t??"";const r=this.voiceChatToggledTime-this.interactTime;this.trackLoadingEvent({eventName:"voiceChatToggled",duration:r})}});B(this,"onMounted",()=>{this.mountedTime=performance.now();let e;this.isVoiceCall?e=this.mountedTime-this.voiceChatToggledTime:(this.interactTime=this.mountedTime,e=0),this.trackLoadingEvent({eventName:"appearanceMounted",duration:e})});B(this,"onUnmounted",()=>{this.resourceMonitor.trackEnd()});B(this,"onBabylonLibrariesLoaded",e=>{if(!Jm(e))return;this.libsLoadedTime=performance.now();const t=this.libsLoadedTime-this.mountedTime;this.trackLoadingEvent({eventName:"appearanceBabylonLoaded",duration:t,characterId:e})});B(this,"onSceneInitializationStart",e=>{Jm(e)&&this.resourceMonitor.trackStart(".glb")});B(this,"onSceneInitialized",e=>{if(!Jm(e))return;this.sceneInitializedTime=performance.now();const t=this.sceneInitializedTime-this.libsLoadedTime,r=this.resourceMonitor.trackEnd();Jh("%c[] -> monitorResult : ","color: #5bb173",r),this.trackLoadingEvent({eventName:"appearanceSceneInitialized",duration:t,characterId:e,networkDuration:r?r.duration:void 0}),this.trackLoadingEvent({eventName:"appearanceLoadingComplete",duration:this.sceneInitializedTime-this.interactTime,characterId:e}),this.loadedEnd=!0,this.checkEnd()});B(this,"onVisualizerEnabled",()=>{if(this.visualizerEnabled)return;this.visualizerEnabled=!0;const e=Math.round(performance.now()-this.interactTime);this.trackLoadingEvent({eventName:"appearanceVisible",duration:e}),this.checkEnd()});B(this,"checkEnd",()=>{this.visualizerEnabled&&this.loadedEnd&&this.resetLoading()});B(this,"onStartMessage",(e,t)=>{this.currentMessageId=e,this.startMessageTime=t});B(this,"onSpeechEndDetected",e=>{this.speechEndDetectedTime=e});B(this,"onAnimationStart",()=>{const e=Math.round(performance.now()-(this.speechEndDetectedTime||this.startMessageTime));H.trackEvent({name:"system",data:{eventName:"copilotAnimationStart",eventInfo_conversationId:this.currentConversationId,eventInfo_messageId:this.currentMessageId,eventInfo_duration:e}}),Jh("%c[] -> onAnimationStart : ","color: #691dc6",Math.round(e))});this.isVoiceCall=e}}const US=new Map,_re=(n=!0)=>(US.has(n)||US.set(n,new xre(n)),US.get(n)),zv=_re(!0),Mre=1e3;function M4(n){(n.source==="audioCallButton"||n.source==="characterTalkToggleButton"||n.source==="AppearanceTryNowModal")&&zv.onUserInteract(n.source)}function bn(n){H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:n.source,eventInfo_clickScenario:n.scenario,eventInfo_clickDestination:n.destination,eventInfo_conversationId:n.conversationId,eventInfo_podcastId:n.podcastId,eventInfo_messageId:n.messageId,eventInfo_mode:n.chatMode,eventInfo_messageType:n.messageType,eventInfo_cardType:n.cardType,eventInfo_merchantPlatform:n.merchantPlatform,eventInfo_additionalData:n.additionalData?JSON.stringify(n.additionalData):void 0}}),M4(n)}function nt(n){H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_pageName:n.pageName,eventInfo_sectionName:n.sectionName,eventInfo_clickSource:n.source,eventInfo_clickScenario:n.scenario,eventInfo_clickDestination:n.destination,eventInfo_conversationId:n.conversationId,eventInfo_customData:n.customData}}),M4(n)}function nc(n){H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionScenario:n.scenario,eventInfo_impressionPage:n.page,eventInfo_impressionElement:n.element,eventInfo_status:n.status,eventInfo_customData:n.customData}})}function zo(n){H.trackEvent({name:"health",data:{eventName:"copilotFeatureSuccess",eventInfo_feature:n.feature,eventInfo_scenario:n.scenario,eventInfo_duration:n.duration,eventInfo_customData:n.customData}})}function Zn(n){H.trackEvent({name:"health",data:{eventName:"copilotError",eventInfo_feature:n.feature,eventInfo_scenario:n.scenario,eventInfo_errorType:n.errorType,eventInfo_errorMessage:n.errorMessage,eventInfo_exception:n.exception,eventInfo_customData:n.customData}})}function Rre(n){H.trackEvent({name:"interaction",data:{eventName:"copilotSettingChange",eventInfo_settingName:n.settingName,eventInfo_settingOldValue:n.oldValue,eventInfo_settingNewValue:n.newValue}})}function R4e(n,e=Mre){let t;function r(){t=window.setTimeout(()=>{n()},e)}function i(){window.clearTimeout(t)}return{onHoverStart:r,onHoverEnd:i}}function R4(n,e,t,r){setTimeout(async()=>{try{const{status:i}=r,a=await Ere(r),o=r.headers.get("x-ceto-ref")??"";H.trackEvent({name:"apiresponse",data:{eventName:"copilotApiResponse",eventInfo_path:n,eventInfo_method:e,eventInfo_status:i,eventInfo_duration:t,eventInfo_responseContentLength:a,eventInfo_cetoRef:o}})}catch{}},0)}function tR(){performance.mark("userSession-end",{startTime:performance.now()});const{duration:n}=performance.measure("userSession-duration","startupTime-begin","userSession-end");H.trackEvent({name:"system",data:{eventName:"copilotExitEvent",eventInfo_duration:n}})}function Pre(n,e,t){H.trackEvent({name:"interaction",data:{eventName:"copilotComposerInput",eventInfo_conversationId:n,eventInfo_inputMethod:e,eventInfo_customData:t}})}function Nre(n){H.trackEvent({name:"interaction",data:{eventName:"copilotScroll",eventInfo_ScrollSource:n.scrollSource,eventInfo_ScrollStartX:n.scrollStartX,eventInfo_ScrollStartY:n.scrollStartY,eventInfo_ScrollEndX:n.scrollEndX,eventInfo_ScrollEndY:n.scrollEndY,eventInfo_ScrollDuration:n.scrollDuration,eventInfo_userInitiated:n.userInitiated,eventInfo_customData:n.customData}})}const x1="authInitStartTime";function P4(n,e){if(Ep()){const r=dt().get(En),i=r==null?void 0:r.accountType;Zn({feature:"api",scenario:e,errorType:"missingToken",errorMessage:`User is authenticated but no token was available for ${e==="getWssAPIUrl"?"WebSocket connection":"API request"}`,customData:JSON.stringify({path:n,accountType:i})})}}function N4(n,e){const r=dt().get(En),i=r==null?void 0:r.accountType,a=r==null?void 0:r.provider,o=r==null?void 0:r.tenantId;i||Zn({feature:"api",scenario:e,errorType:"emptyAccountTypeWithToken",errorMessage:`Can get the token but with no user account type ${e==="getWssAPIUrl"?"WebSocket connection":"API request"}`,customData:JSON.stringify({path:n,provider:a,tenantId:o})})}function O4(n){const{providerType:e,apiName:t,extraInfo:r}=n,i=Date.now().toString();$s(x1,i),H.trackEvent({name:"health",data:{eventName:"copilotWebAuthSDKAPICall",eventInfo_apiName:t,eventInfo_success:!0,eventInfo_customData:JSON.stringify({eventInfo_providerType:e,...r})}})}function L4(n){const{providerType:e,apiName:t,extraInfo:r}=n,i=Date.now(),a=$o(x1);if(a){const o=parseFloat(a),s=i-o;sessionStorage.removeItem(x1),H.trackEvent({name:"health",data:{eventName:"copilotWebAuthSDKAPICall",eventInfo_apiName:t,eventInfo_success:!0,eventInfo_duration:s,eventInfo_customData:JSON.stringify({eventInfo_providerType:e,...r})}})}}function D4(n){const{authWorkflowAccountType:e,interactionType:t,correlationId:r,prompt:i,redirectUri:a,apiName:o,extraInfo:s}=n,c=Date.now().toString();br(u1,c),H.trackEvent({name:"health",data:{eventName:"copilotWebAuthSDKAPICall",eventInfo_apiName:o,eventInfo_success:!0,eventInfo_customData:JSON.stringify({eventInfo_authWorkflowAccountType:e??"unknown",eventInfo_interactionType:t??"",eventInfo_correlationId:r??"",eventInfo_prompt:i??"",eventInfo_redirectUri:a??"",...s})}})}function _1(n){const{authWorkflowAccountType:e,isMSA:t,authority:r,correlationId:i,interactionType:a,apiName:o,extraInfo:s}=n,c=Date.now(),u=Pn(u1);let h;if(u){const f=parseFloat(u);h=c-f,ur(u1)}H.trackEvent({name:"health",data:{eventName:"copilotWebAuthSDKAPICall",eventInfo_apiName:o,eventInfo_success:!0,eventInfo_customData:JSON.stringify({eventInfo_authWorkflowAccountType:e??"unknown",eventInfo_interactionType:a,eventInfo_correlationId:i,eventInfo_authority:r,eventInfo_isMSA:t??!1,...s}),eventInfo_duration:h??0}})}function j4(n){const{providerType:e,apiName:t,extraInfo:r}=n;H.trackEvent({name:"health",data:{eventName:"copilotWebAuthSDKAPICall",eventInfo_success:!0,eventInfo_apiName:t,eventInfo_customData:JSON.stringify({eventInfo_providerType:e,...r})}})}function Ds(n){const{authWorkflowAccountType:e,apiName:t,duration:r,extraInfo:i}=n;H.trackEvent({name:"health",data:{eventName:"copilotWebAuthSDKAPICall",eventInfo_success:!0,eventInfo_apiName:t,eventInfo_duration:r??0,eventInfo_customData:JSON.stringify({eventInfo_authWorkflowAccountType:e,eventInfo_wasInBackground:aA(),...i})}})}function Vs(n){const{authWorkflowAccountType:e,apiName:t,errorMessage:r,errorType:i,errorExtraInfo:a,errorCode:o,extraInfo:s}=n;H.trackEvent({name:"health",data:{eventName:"copilotWebAuthSDKAPICall",eventInfo_success:!1,eventInfo_apiName:t,eventInfo_errorType:i,eventInfo_errorMessage:r,eventInfo_errorCode:o,eventInfo_customData:JSON.stringify({eventInfo_authWorkflowAccountType:e??"unknown",eventInfo_wasInBackground:aA(),...s,...a})}})}function FS(n){const{authWorkflowAccountType:e,apiName:t}=n;br(d1,"1"),H.trackEvent({name:"health",data:{eventName:"copilotWebAuthSDKAPICall",eventInfo_success:!0,eventInfo_apiName:t,eventInfo_customData:JSON.stringify({eventInfo_authWorkflowAccountType:e})}})}function U4(n){const{authWorkflowAccountType:e,apiName:t,duration:r}=n,i=Pn(d1);i==="1"&&ur(d1),i==="1"&&H.trackEvent({name:"health",data:{eventName:"copilotWebAuthSDKAPICall",eventInfo_success:!0,eventInfo_apiName:t,eventInfo_duration:r??0,eventInfo_customData:JSON.stringify({eventInfo_authWorkflowAccountType:e})}})}function F4(n,e){return{eventInfo_requestType:e,eventInfo_retryAttemptCount:n.attemptCount,eventInfo_retryStartTime:n.startTime,eventInfo_retryEndDelay:n.endTime,eventInfo_retryDelayTimings:n.delayTimings.join(","),eventInfo_allErrors:JSON.stringify(n.errors),eventInfo_wasInBackground:aA()}}function B4(n,e,t){Ds({authWorkflowAccountType:t,apiName:t==="microsoft"?$v.ACQUIRE_TOKEN_OVERALL_SUCCESS:mi.ACQUIRE_TOKEN_OVERALL_SUCCESS,extraInfo:F4(n,e)})}function H4(n,e,t){const r=F4(n,e),i=n.errors[n.errors.length-1];Vs({authWorkflowAccountType:t,apiName:t==="microsoft"?$v.ACQUIRE_TOKEN_OVERALL_FAILURE:mi.ACQUIRE_TOKEN_OVERALL_FAILURE,errorType:(i==null?void 0:i.errorType)??"unknown",errorMessage:(i==null?void 0:i.errorMessage)??"unknown error",extraInfo:{...r,eventInfo_exitReason:n.exitReason}})}function Ore(n){const e=n instanceof Error?n.message:String(n);H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"GraphAPITimeout",eventInfo_errorMessage:e,eventInfo_details:"Student status check failed or timed out"}})}function aA(){return typeof document<"u"&&document.visibilityState==="hidden"}var Kp,_s,Sd,_o;class Kl{constructor(e,t){ln(this,Kp);ln(this,_s,null);ln(this,Sd);ln(this,_o,null);Vt(this,Kp,e),Vt(this,Sd,t)}async get(e){return(fe(this,_o)===null||fe(this,Sd)&&(!fe(this,_s)||fe(this,_s)<Date.now()-fe(this,Sd)))&&(Vt(this,_o,fe(this,Kp).call(this,e)),Vt(this,_s,Date.now())),fe(this,_o)}set(e){Vt(this,_o,e),Vt(this,_s,Date.now())}reset(){Vt(this,_o,null),Vt(this,_s,null)}get isInstantiated(){return fe(this,_o)!==null}}Kp=new WeakMap,_s=new WeakMap,Sd=new WeakMap,_o=new WeakMap;function oA(n){return new Promise(e=>{setTimeout(e,n)})}class By extends Error{constructor(t,r){super(r??`Request timed out after ${t}ms`);B(this,"name","RequestTimeoutError");B(this,"timeoutMs");this.timeoutMs=t,Object.setPrototypeOf(this,By.prototype)}}async function Lre(n,e){const t=new AbortController,r=setTimeout(()=>{t.abort()},e);try{const i=await n(t);return clearTimeout(r),i}catch(i){throw clearTimeout(r),t.signal.aborted||i instanceof Error&&i.name==="AbortError"?new By(e):i}}function Dre(n){return n instanceof By}const jre={maxRetries:2,initialDelayMs:100,maxDelayMs:500,backoffFactor:2,jitterFactor:.1};function Ure(n){return n instanceof Error?{errorType:n.name,errorMessage:n.message}:{errorType:"Unknown",errorMessage:String(n)}}function Fre(n,e,t,r){const i=n.maxDurationMs!==void 0&&r>=n.maxDurationMs;return t>n.maxRetries?{shouldExit:!0,exitReason:"maxRetriesReached"}:i?{shouldExit:!0,exitReason:"maxDurationReached"}:n.shouldRetry&&!n.shouldRetry(e)?{shouldExit:!0,exitReason:"shouldRetryFalse"}:{shouldExit:!1,exitReason:null}}function Bre(n,e){const t=e.jitterFactor?n*e.jitterFactor*(Math.random()*2-1):0,r=n+t;return Math.min(Math.max(r,0),e.maxDelayMs)}async function sA(n,e={}){var c,u,h,f;const t={...jre,...e},r=performance.now();let i=t.initialDelayMs,a=0;const o=[],s=[];for(let p=0;p<=t.maxRetries;p+=1)try{const g=await n(),v=performance.now();return(c=t.onSuccess)==null||c.call(t,{attemptCount:p+1,delayTimings:s,startTime:r,endTime:v,errors:o}),g}catch(g){a=p+1,o.push(Ure(g));const v=performance.now(),y=Dre(g);if(y&&t.onTimeout&&t.onTimeout({attemptCount:p+1,delayTimings:s,startTime:r,endTime:v,errors:o}),p===t.maxRetries)throw(u=t.onFailure)==null||u.call(t,{attemptCount:p+1,delayTimings:s,startTime:r,endTime:v,errors:o,exitReason:y?"requestTimeout":"maxRetriesReached"}),g;const b=v-r,{shouldExit:C,exitReason:S}=Fre(t,g,a,b);if(C)throw(h=t.onFailure)==null||h.call(t,{attemptCount:p+1,delayTimings:s,startTime:r,endTime:v,errors:o,exitReason:S}),g;let E=Bre(i,t);if(t.maxDurationMs!==void 0){const k=t.maxDurationMs-b;if(k<=0)throw(f=t.onFailure)==null||f.call(t,{attemptCount:p+1,delayTimings:s,startTime:r,endTime:v,errors:o,exitReason:"maxDurationReached"}),g;E=Math.min(E,k)}const T=performance.now();await oA(E);const I=performance.now()-T;s.push(I),i=Math.min(i*t.backoffFactor,t.maxDelayMs)}throw new Error("Unexpected end of retry loop")}const Ni=new Kl(Hre);async function Hre(){O4({apiName:mi.INITIALIZE_START,providerType:"auth0"});const n=await vre(KK);L4({apiName:mi.INITIALIZE_END,providerType:"auth0"});const e=new Map([["on",null],["off",null],["cache-only",null]]);async function t(a,o){const s=performance.now(),c=Bd(Cre,"any");try{if(!c){const g=await n.getTokenSilently(a),v=performance.now();return zo({feature:"auth0SdkUsage",scenario:"getAuth0AccessToken",duration:v-s,customData:JSON.stringify({cacheMode:a.cacheMode??"on"})}),g}const h={...A4(),shouldRetry:g=>!(g instanceof cr&&g.error==="login_required"),onSuccess:g=>B4(g,"graph",o??"google"),onFailure:g=>H4(g,"graph",o??"google")},f=await sA(()=>n.getTokenSilently(a),h),p=performance.now();return zo({feature:"auth0SdkUsage",scenario:"getAuth0AccessToken",duration:p-s,customData:JSON.stringify({cacheMode:a.cacheMode??"on"})}),f}catch(u){u instanceof cr?(i({options:a,startTime:s,authWorkflowAccountType:o,errorType:u.error,errorMessage:u.error_description,exception:u.stack}),u.error==="login_required"&&xn(la,{reason:"token-expired",provider:"auth0"})):u instanceof Error?i({options:a,startTime:s,authWorkflowAccountType:o,errorType:u.name,errorMessage:u.message,exception:u.stack}):i({options:a,startTime:s,authWorkflowAccountType:o,errorType:"unknown",errorMessage:`${u}`});return}}async function r(a){const o=await n.getUser();if(!o)return;const s=o.sub&&o.sub.startsWith("google")?"google":"apple",c=a.cacheMode??"on",u=e.get(c);if(!u){const h=t(a,s);e.set(c,h);const f=await h;return e.set(c,null),f}return u}function i(a){const{startTime:o,options:s,authWorkflowAccountType:c,errorType:u,errorMessage:h,exception:f}=a;Vs({authWorkflowAccountType:c,apiName:mi.ACQUIRE_TOKEN_FAILURE,errorType:u,errorMessage:h,errorExtraInfo:{eventInfo_providerType:"auth0",eventInfo_exception:f??"",cacheMode:s.cacheMode??"on",duration:performance.now()-o}})}return{auth0:n,getAuth0AccessToken:r}}function cA(n){const e=n.split(".")[1];if(e===void 0)return;const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(t).split("").map(i=>`%${`00${i.charCodeAt(0).toString(16)}`.slice(-2)}`).join(""));try{const i=JSON.parse(r);return Kne.parse(i)}catch{return}}async function $re(n,e){const{getAuth0AccessToken:t}=await Ni.get(),{authorizationParams:r}=up,i={...r,dob:n,ctry:e},a=await t({authorizationParams:i,cacheMode:"off"});if(!a)return;const o=cA(a);if(o)return o}async function zre(){const{getAuth0AccessToken:n}=await Ni.get(),e=await n(up);if(!e)return;const t=cA(e);if(t){if(t.sub.startsWith("google"))return"Google";if(t.sub.startsWith("apple"))return"Apple"}}function Vre(n){switch(n){case"apple":return"Apple";case"google":return"Google";case"msa":return"MSA";default:return}}const Ff=new BroadcastChannel("cp.broadcast");class Gre{constructor(){B(this,"hasTrackedRedirectError",!1);B(this,"CODE_RE",/[?&]code=[^&]+/);B(this,"STATE_RE",/[?&]state=[^&]+/);B(this,"ERROR_RE",/[?&]error=[^&]+/)}async handleRedirect(){try{const{auth0:e}=await Ni.get();if(!this.hasAuthParams())return null;const t=performance.now();await e.handleRedirectCallback();const r=performance.now();zo({feature:"auth0SdkUsage",scenario:"handleRedirect",duration:r-t});const i=await e.getUser();if(!i)return null;const a=i.sub?this.getTokenType(i.sub):void 0;return _1({apiName:mi.LOGIN_SUCCESS,authWorkflowAccountType:a}),U4({apiName:mi.REAUTH_SUCCESS,authWorkflowAccountType:a}),Ff.postMessage({eventName:"auth0.accountAdded"}),{id:i.sub,tenantId:crypto.randomUUID(),provider:"auth0",accountType:this.getAccountType(i.sub)}}catch(e){this.trackRedirectErrorOncePerSession(e)}return null}async handleRedirectWithoutAccount(){try{const{auth0:e}=await Ni.get();if(this.hasAuthParams()){const t=performance.now();await e.handleRedirectCallback();const r=performance.now();zo({feature:"auth0SdkUsage",scenario:"handleRedirect",duration:r-t});const i=await e.getUser();if(!i)return;const a=i.sub?this.getTokenType(i.sub):void 0;_1({apiName:mi.LOGIN_SUCCESS,authWorkflowAccountType:a}),Ff.postMessage({eventName:"auth0.accountAdded"})}}catch(e){this.trackRedirectErrorOncePerSession(e)}}async getCurrentActiveUserAccount(){const{auth0:e}=await Ni.get(),t=await e.getUser();if(!t)return null;const{sub:r}=t;return r?{id:r,tenantId:crypto.randomUUID(),provider:"auth0",accountType:this.getAccountType(r)}:null}async maybeInitializeAccountWithToken(){const{auth0:e,getAuth0AccessToken:t}=await Ni.get(),r=await t(up);if(!r)return null;const i=await e.getUser();if(!i)return null;const a=i.sub;return{userAccount:{id:a,tenantId:crypto.randomUUID(),provider:"auth0",accountType:this.getAccountType(a)},authToken:{accessToken:r,tokenType:this.getTokenType(a)}}}async logIn(e){const{connection:t}=e;if(!t)throw new Error("connection in LoginOpts are required");const{auth0:r}=await Ni.get();return D4({apiName:mi.LOGIN_START,authWorkflowAccountType:e.connection??void 0}),r.loginWithRedirect({authorizationParams:{...qK.authorizationParams,connection:this.getConnectionFromTokenType(t)}})}async logOut(){const{auth0:e}=await Ni.get(),t=await e.getUser(),r=t&&t.sub?this.getTokenType(t.sub):void 0;try{await e.logout({logoutParams:{returnTo:window.location.origin}}),Ff.postMessage({eventName:"auth0.accountRemoved"}),j4({apiName:mi.LOGOUT_SUCCESS,providerType:"auth0"})}catch(i){Vs({authWorkflowAccountType:r,apiName:mi.LOGOUT_FAILURE,errorMessage:`${i}`,errorExtraInfo:{eventInfo_providerType:"auth0"}}),console.error("Auth0 logout failed:",i)}}async getAuthToken(){try{const{auth0:e,getAuth0AccessToken:t}=await Ni.get(),r=await t(up);if(!r)return;const i=await e.getUser();if(i){const a=i.sub,o=this.getTokenType(a);return{accessToken:r,tokenType:o}}}catch{return}}async getUserInfo(){const{auth0:e}=await Ni.get(),t=await e.getUser();if(t)return{mail:t.email??"",givenName:t.given_name??"",surname:t.surname??"",imgSrc:t.picture,isStudent:!1}}async getUserInfoFromToken(e){const t=cA(e);if(!t)return;const{email:r,name:i}=t;return{mail:r,givenName:i.split(" ")[0]??"",surname:"",imgSrc:"",isStudent:!1}}supportsTokenType(e){return e==="apple"||e==="google"}getTokenType(e){return e.startsWith("google")?"google":"apple"}getAccountType(e){return e.startsWith("google")?"Google":"Apple"}getConnectionFromTokenType(e){return e==="apple"?"apple":"google-oauth2"}hasAuthParams(e=window.location.search){return(this.CODE_RE.test(e)||this.ERROR_RE.test(e))&&this.STATE_RE.test(e)}trackRedirectErrorOncePerSession(e){this.hasTrackedRedirectError||(H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"auth0HandleRedirectPromise",eventInfo_details:"Error handling redirect promise",eventInfo_errorMessage:`${e}`}}),Vs({apiName:mi.LOGIN_FAILURE,errorExtraInfo:{eventInfo_providerType:"auth0"},errorMessage:`${e}`})),this.hasTrackedRedirectError=!0}}function M1(){return dr(h1,l.boolean().nullable())===!0}function Kre(){return dr(f1,l.boolean().nullable())===!0}var R1=function(n,e){return R1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},R1(n,e)};function P4e(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");R1(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var nR=function(){return nR=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},nR.apply(this,arguments)};function N4e(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function en(n,e,t,r){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function s(h){try{u(r.next(h))}catch(f){o(f)}}function c(h){try{u(r.throw(h))}catch(f){o(f)}}function u(h){h.done?a(h.value):i(h.value).then(s,c)}u((r=r.apply(n,e||[])).next())})}function O4e(n,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(h){return c([u,h])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(r=1,i&&(a=u[0]&2?i.return:u[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,u[1])).done)return a;switch(i=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){t.label=u[1];break}if(u[0]===6&&t.label<a[1]){t.label=a[1],a=u;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(u);break}a[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(h){u=[6,h],i=0}finally{r=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function L4e(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function D4e(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,a=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return a}function j4e(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,a;r<i;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return n.concat(a||Array.prototype.slice.call(e))}var gi;(function(n){n.GET="GET",n.PATCH="PATCH",n.POST="POST",n.PUT="PUT",n.DELETE="DELETE"})(gi||(gi={}));const qre="v1.0",Wre="https://graph.microsoft.com/",Yre=new Set(["graph.microsoft.com","graph.microsoft.us","dod-graph.microsoft.us","graph.microsoft.de","microsoftgraph.chinacloudapi.cn","canary.graph.microsoft.com"]);class sl extends Error{static setGraphClientError(e){let t;return e instanceof Error?t=e:(t=new sl,t.customError=e),t}constructor(e){super(e),Object.setPrototypeOf(this,sl.prototype)}}const Qre=["$select","$expand","$orderby","$filter","$top","$skip","$skipToken","$count"],Jre=n=>{const e=a=>a.replace(/\/+$/,""),t=a=>a.replace(/^\/+/,""),r=(a,o)=>[e(a),t(o)].join("/");return Array.prototype.slice.call(n).reduce(r)},BS=n=>{const e=n&&n.constructor&&n.constructor.name;if(e==="Buffer"||e==="Blob"||e==="File"||e==="FormData"||typeof n=="string")return n;if(e==="ArrayBuffer")n=Buffer.from(n);else if(e==="Int8Array"||e==="Int16Array"||e==="Int32Array"||e==="Uint8Array"||e==="Uint16Array"||e==="Uint32Array"||e==="Uint8ClampedArray"||e==="Float32Array"||e==="Float64Array"||e==="DataView")n=Buffer.from(n.buffer);else try{n=JSON.stringify(n)}catch{throw new Error("Unable to stringify the content")}return n},$4=n=>V4(n),z4=(n,e)=>(e.forEach(t=>Zre(t)),V4(n,e)),V4=(n,e=Yre)=>{if(n=n.toLowerCase(),n.indexOf("https://")!==-1){n=n.replace("https://","");const t=n.indexOf(":"),r=n.indexOf("/");let i="";if(r!==-1)return t!==-1&&t<r?(i=n.substring(0,t),e.has(i)):(i=n.substring(0,r),e.has(i))}return!1},Zre=n=>{if(n.indexOf("/")!==-1)throw new sl("Please add only hosts or hostnames to the CustomHosts config. If the url is `http://example.com:3000/`, host is `example:3000`")};class cl{constructor(e=[]){this.middlewareOptions=new Map;for(const t of e){const r=t.constructor;this.middlewareOptions.set(r,t)}}getMiddlewareOptions(e){return this.middlewareOptions.get(e)}setMiddlewareOptions(e,t){this.middlewareOptions.set(e,t)}}const Xre=()=>{let n="";for(let e=0;e<32;e++)(e===8||e===12||e===16||e===20)&&(n+="-"),n+=Math.floor(Math.random()*16).toString(16);return n},G4=(n,e,t)=>{let r=null;if(typeof Request<"u"&&n instanceof Request)r=n.headers.get(t);else if(typeof e<"u"&&e.headers!==void 0)if(typeof Headers<"u"&&e.headers instanceof Headers)r=e.headers.get(t);else if(e.headers instanceof Array){const i=e.headers;for(let a=0,o=i.length;a<o;a++)if(i[a][0]===t){r=i[a][1];break}}else e.headers[t]!==void 0&&(r=e.headers[t]);return r},K4=(n,e,t,r)=>{if(typeof Request<"u"&&n instanceof Request)n.headers.set(t,r);else if(typeof e<"u")if(e.headers===void 0)e.headers=new Headers({[t]:r});else if(typeof Headers<"u"&&e.headers instanceof Headers)e.headers.set(t,r);else if(e.headers instanceof Array){let i=0;const a=e.headers.length;for(;i<a;i++){const o=e.headers[i];if(o[0]===t){o[1]=r;break}}i===a&&e.headers.push([t,r])}else Object.assign(e.headers,{[t]:r})},q4=(n,e,t,r)=>{typeof Request<"u"&&n instanceof Request?n.headers.append(t,r):typeof e<"u"&&(e.headers===void 0?e.headers=new Headers({[t]:r}):typeof Headers<"u"&&e.headers instanceof Headers?e.headers.append(t,r):e.headers instanceof Array?e.headers.push([t,r]):e.headers===void 0?e.headers={[t]:r}:e.headers[t]===void 0?e.headers[t]=r:e.headers[t]+=`, ${r}`)},eie=(n,e)=>en(void 0,void 0,void 0,function*(){const t=e.headers.get("Content-Type")?yield e.blob():yield Promise.resolve(void 0),{method:r,headers:i,referrer:a,referrerPolicy:o,mode:s,credentials:c,cache:u,redirect:h,integrity:f,keepalive:p,signal:g}=e;return new Request(n,{method:r,headers:i,body:t,referrer:a,referrerPolicy:o,mode:s,credentials:c,cache:u,redirect:h,integrity:f,keepalive:p,signal:g})});class tie{constructor(e,t){this.authenticationProvider=e,this.authenticationProviderOptions=t}}var Hd;(function(n){n[n.NONE=0]="NONE",n[n.REDIRECT_HANDLER_ENABLED=1]="REDIRECT_HANDLER_ENABLED",n[n.RETRY_HANDLER_ENABLED=2]="RETRY_HANDLER_ENABLED",n[n.AUTHENTICATION_HANDLER_ENABLED=4]="AUTHENTICATION_HANDLER_ENABLED"})(Hd||(Hd={}));class js{constructor(){this.featureUsage=Hd.NONE}static updateFeatureUsageFlag(e,t){let r;e.middlewareControl instanceof cl?r=e.middlewareControl.getMiddlewareOptions(js):e.middlewareControl=new cl,typeof r>"u"&&(r=new js,e.middlewareControl.setMiddlewareOptions(js,r)),r.setFeatureUsage(t)}setFeatureUsage(e){this.featureUsage=this.featureUsage|e}getFeatureUsage(){return this.featureUsage.toString(16)}}class Tp{constructor(e){this.authenticationProvider=e}execute(e){return en(this,void 0,void 0,function*(){const t=typeof e.request=="string"?e.request:e.request.url;if($4(t)||e.customHosts&&z4(t,e.customHosts)){let r;e.middlewareControl instanceof cl&&(r=e.middlewareControl.getMiddlewareOptions(tie));let i,a;r&&(i=r.authenticationProvider,a=r.authenticationProviderOptions),i||(i=this.authenticationProvider);const s=`Bearer ${yield i.getAccessToken(a)}`;q4(e.request,e.options,Tp.AUTHORIZATION_HEADER,s),js.updateFeatureUsageFlag(e,Hd.AUTHENTICATION_HANDLER_ENABLED)}else e.options.headers&&delete e.options.headers[Tp.AUTHORIZATION_HEADER];return yield this.nextMiddleware.execute(e)})}setNext(e){this.nextMiddleware=e}}Tp.AUTHORIZATION_HEADER="Authorization";class nie{execute(e){return en(this,void 0,void 0,function*(){e.response=yield fetch(e.request,e.options)})}}class wn{constructor(e=wn.DEFAULT_DELAY,t=wn.DEFAULT_MAX_RETRIES,r=wn.defaultShouldRetry){if(e>wn.MAX_DELAY&&t>wn.MAX_MAX_RETRIES){const i=new Error(`Delay and MaxRetries should not be more than ${wn.MAX_DELAY} and ${wn.MAX_MAX_RETRIES}`);throw i.name="MaxLimitExceeded",i}else if(e>wn.MAX_DELAY){const i=new Error(`Delay should not be more than ${wn.MAX_DELAY}`);throw i.name="MaxLimitExceeded",i}else if(t>wn.MAX_MAX_RETRIES){const i=new Error(`MaxRetries should not be more than ${wn.MAX_MAX_RETRIES}`);throw i.name="MaxLimitExceeded",i}else if(e<0&&t<0){const i=new Error("Delay and MaxRetries should not be negative");throw i.name="MinExpectationNotMet",i}else if(e<0){const i=new Error("Delay should not be negative");throw i.name="MinExpectationNotMet",i}else if(t<0){const i=new Error("MaxRetries should not be negative");throw i.name="MinExpectationNotMet",i}this.delay=Math.min(e,wn.MAX_DELAY),this.maxRetries=Math.min(t,wn.MAX_MAX_RETRIES),this.shouldRetry=r}getMaxDelay(){return wn.MAX_DELAY}}wn.DEFAULT_DELAY=3;wn.DEFAULT_MAX_RETRIES=3;wn.MAX_DELAY=180;wn.MAX_MAX_RETRIES=10;wn.defaultShouldRetry=()=>!0;class Us{constructor(e=new wn){this.options=e}isRetry(e){return Us.RETRY_STATUS_CODES.indexOf(e.status)!==-1}isBuffered(e,t){const r=typeof e=="string"?t.method:e.method;return!((r===gi.PUT||r===gi.PATCH||r===gi.POST)&&G4(e,t,"Content-Type")==="application/octet-stream")}getDelay(e,t,r){const i=()=>Number(Math.random().toFixed(3)),a=e.headers!==void 0?e.headers.get(Us.RETRY_AFTER_HEADER):null;let o;return a!==null?Number.isNaN(Number(a))?o=Math.round((new Date(a).getTime()-Date.now())/1e3):o=Number(a):o=t>=2?this.getExponentialBackOffTime(t)+r+i():r+i(),Math.min(o,this.options.getMaxDelay()+i())}getExponentialBackOffTime(e){return Math.round(1/2*(Math.pow(2,e)-1))}sleep(e){return en(this,void 0,void 0,function*(){const t=e*1e3;return new Promise(r=>setTimeout(r,t))})}getOptions(e){let t;return e.middlewareControl instanceof cl&&(t=e.middlewareControl.getMiddlewareOptions(this.options.constructor)),typeof t>"u"&&(t=Object.assign(new wn,this.options)),t}executeWithRetry(e,t,r){return en(this,void 0,void 0,function*(){if(yield this.nextMiddleware.execute(e),t<r.maxRetries&&this.isRetry(e.response)&&this.isBuffered(e.request,e.options)&&r.shouldRetry(r.delay,t,e.request,e.options,e.response)){++t,K4(e.request,e.options,Us.RETRY_ATTEMPT_HEADER,t.toString());const i=this.getDelay(e.response,t,r.delay);return yield this.sleep(i),yield this.executeWithRetry(e,t,r)}else return})}execute(e){return en(this,void 0,void 0,function*(){const r=this.getOptions(e);return js.updateFeatureUsageFlag(e,Hd.RETRY_HANDLER_ENABLED),yield this.executeWithRetry(e,0,r)})}setNext(e){this.nextMiddleware=e}}Us.RETRY_STATUS_CODES=[429,503,504];Us.RETRY_ATTEMPT_HEADER="Retry-Attempt";Us.RETRY_AFTER_HEADER="Retry-After";class Ui{constructor(e=Ui.DEFAULT_MAX_REDIRECTS,t=Ui.defaultShouldRedirect){if(e>Ui.MAX_MAX_REDIRECTS){const r=new Error(`MaxRedirects should not be more than ${Ui.MAX_MAX_REDIRECTS}`);throw r.name="MaxLimitExceeded",r}if(e<0){const r=new Error("MaxRedirects should not be negative");throw r.name="MinExpectationNotMet",r}this.maxRedirects=e,this.shouldRedirect=t}}Ui.DEFAULT_MAX_REDIRECTS=5;Ui.MAX_MAX_REDIRECTS=20;Ui.defaultShouldRedirect=()=>!0;let uh=class Ec{constructor(e=new Ui){this.options=e}isRedirect(e){return Ec.REDIRECT_STATUS_CODES.indexOf(e.status)!==-1}hasLocationHeader(e){return e.headers.has(Ec.LOCATION_HEADER)}getLocationHeader(e){return e.headers.get(Ec.LOCATION_HEADER)}isRelativeURL(e){return e.indexOf("://")===-1}shouldDropAuthorizationHeader(e,t){const r=/^[A-Za-z].+?:\/\/.+?(?=\/|$)/,i=r.exec(e);let a,o;i!==null&&(a=i[0]);const s=r.exec(t);return s!==null&&(o=s[0]),typeof a<"u"&&typeof o<"u"&&a!==o}updateRequestUrl(e,t){return en(this,void 0,void 0,function*(){t.request=typeof t.request=="string"?e:yield eie(e,t.request)})}getOptions(e){let t;return e.middlewareControl instanceof cl&&(t=e.middlewareControl.getMiddlewareOptions(Ui)),typeof t>"u"&&(t=Object.assign(new Ui,this.options)),t}executeWithRedirect(e,t,r){return en(this,void 0,void 0,function*(){yield this.nextMiddleware.execute(e);const i=e.response;if(t<r.maxRedirects&&this.isRedirect(i)&&this.hasLocationHeader(i)&&r.shouldRedirect(i)){if(++t,i.status===Ec.STATUS_CODE_SEE_OTHER)e.options.method=gi.GET,delete e.options.body;else{const a=this.getLocationHeader(i);!this.isRelativeURL(a)&&this.shouldDropAuthorizationHeader(i.url,a)&&delete e.options.headers[Ec.AUTHORIZATION_HEADER],yield this.updateRequestUrl(a,e)}yield this.executeWithRedirect(e,t,r)}else return})}execute(e){return en(this,void 0,void 0,function*(){const r=this.getOptions(e);return e.options.redirect=Ec.MANUAL_REDIRECT,js.updateFeatureUsageFlag(e,Hd.REDIRECT_HANDLER_ENABLED),yield this.executeWithRedirect(e,0,r)})}setNext(e){this.nextMiddleware=e}};uh.REDIRECT_STATUS_CODES=[301,302,303,307,308];uh.STATUS_CODE_SEE_OTHER=303;uh.LOCATION_HEADER="Location";uh.AUTHORIZATION_HEADER="Authorization";uh.MANUAL_REDIRECT="manual";const rie="3.0.7";class vi{execute(e){return en(this,void 0,void 0,function*(){const t=typeof e.request=="string"?e.request:e.request.url;if($4(t)||e.customHosts&&z4(t,e.customHosts)){let r=G4(e.request,e.options,vi.CLIENT_REQUEST_ID_HEADER);r||(r=Xre(),K4(e.request,e.options,vi.CLIENT_REQUEST_ID_HEADER,r));let i=`${vi.PRODUCT_NAME}/${rie}`,a;if(e.middlewareControl instanceof cl&&(a=e.middlewareControl.getMiddlewareOptions(js)),a){const o=a.getFeatureUsage();i+=` (${vi.FEATURE_USAGE_STRING}=${o})`}q4(e.request,e.options,vi.SDK_VERSION_HEADER,i)}else delete e.options.headers[vi.CLIENT_REQUEST_ID_HEADER],delete e.options.headers[vi.SDK_VERSION_HEADER];return yield this.nextMiddleware.execute(e)})}setNext(e){this.nextMiddleware=e}}vi.CLIENT_REQUEST_ID_HEADER="client-request-id";vi.SDK_VERSION_HEADER="SdkVersion";vi.PRODUCT_NAME="graph-js";vi.FEATURE_USAGE_STRING="featureUsage";function iie(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var rR;(function(n){n[n.MANUAL=0]="MANUAL",n[n.RANDOM=1]="RANDOM"})(rR||(rR={}));var Ua;(function(n){n.ARRAYBUFFER="arraybuffer",n.BLOB="blob",n.DOCUMENT="document",n.JSON="json",n.RAW="raw",n.STREAM="stream",n.TEXT="text"})(Ua||(Ua={}));var P1;(function(n){n.TEXT_HTML="text/html",n.TEXT_XML="text/xml",n.APPLICATION_XML="application/xml",n.APPLICATION_XHTML="application/xhtml+xml"})(P1||(P1={}));var Vv;(function(n){n.TEXT_PLAIN="text/plain",n.APPLICATION_JSON="application/json"})(Vv||(Vv={}));var Gv;(function(n){n.DOCUMENT="^(text\\/(html|xml))|(application\\/(xml|xhtml\\+xml))$",n.IMAGE="^image\\/.+"})(Gv||(Gv={}));class Bf{static parseDocumentResponse(e,t){return typeof DOMParser<"u"?new Promise((r,i)=>{e.text().then(a=>{try{const s=new DOMParser().parseFromString(a,t);r(s)}catch(o){i(o)}})}):Promise.resolve(e.body)}static convertResponse(e,t){return en(this,void 0,void 0,function*(){if(e.status===204)return Promise.resolve();let r;const i=e.headers.get("Content-type");switch(t){case Ua.ARRAYBUFFER:r=yield e.arrayBuffer();break;case Ua.BLOB:r=yield e.blob();break;case Ua.DOCUMENT:r=yield Bf.parseDocumentResponse(e,P1.TEXT_XML);break;case Ua.JSON:r=yield e.json();break;case Ua.STREAM:r=yield Promise.resolve(e.body);break;case Ua.TEXT:r=yield e.text();break;default:if(i!==null){const a=i.split(";")[0];new RegExp(Gv.DOCUMENT).test(a)?r=yield Bf.parseDocumentResponse(e,a):new RegExp(Gv.IMAGE).test(a)?r=e.blob():a===Vv.TEXT_PLAIN?r=yield e.text():a===Vv.APPLICATION_JSON?r=yield e.json():r=Promise.resolve(e.body)}else r=Promise.resolve(e.body);break}return r})}static getResponse(e,t,r){return en(this,void 0,void 0,function*(){if(t===Ua.RAW)return Promise.resolve(e);{const i=yield Bf.convertResponse(e,t);if(e.ok)if(typeof r=="function")r(null,i);else return i;else throw i}})}}class aie{constructor(e){this.provider=e}getAccessToken(){return en(this,void 0,void 0,function*(){return new Promise((e,t)=>{this.provider((r,i)=>en(this,void 0,void 0,function*(){if(i)e(i);else{if(!r){const o="Access token is undefined or empty.						Please provide a valid token.						For more help - https://github.com/microsoftgraph/msgraph-sdk-javascript/blob/dev/docs/CustomAuthenticationProvider.md";r=new sl(o)}const a=yield sl.setGraphClientError(r);t(a)}}))})})}}class Hf extends Error{constructor(e=-1,t,r){super(t||r&&r.message),Object.setPrototypeOf(this,Hf.prototype),this.statusCode=e,this.code=null,this.requestId=null,this.date=new Date,this.body=null,this.stack=r?r.stack:this.stack}}class Kv{static constructError(e,t,r){const i=new Hf(t,"",e);return e.name!==void 0&&(i.code=e.name),i.body=e.toString(),i.date=new Date,i.headers=r==null?void 0:r.headers,i}static constructErrorFromResponse(e,t,r){const i=e.error,a=new Hf(t,i.message);return a.code=i.code,i.innerError!==void 0&&(a.requestId=i.innerError["request-id"],a.date=new Date(i.innerError.date)),a.body=JSON.stringify(i),a.headers=r==null?void 0:r.headers,a}static getError(e=null,t=-1,r,i){return en(this,void 0,void 0,function*(){let a;if(e&&e.error?a=Kv.constructErrorFromResponse(e,t,i):e instanceof Error?a=Kv.constructError(e,t,i):(a=new Hf(t),a.body=e),typeof r=="function")r(a,null);else return a})}}class oie{constructor(e,t,r){this.parsePath=i=>{if(i.indexOf("https://")!==-1){i=i.replace("https://","");const o=i.indexOf("/");o!==-1&&(this.urlComponents.host="https://"+i.substring(0,o),i=i.substring(o+1,i.length));const s=i.indexOf("/");s!==-1&&(this.urlComponents.version=i.substring(0,s),i=i.substring(s+1,i.length))}i.charAt(0)==="/"&&(i=i.substr(1));const a=i.indexOf("?");if(a===-1)this.urlComponents.path=i;else{this.urlComponents.path=i.substr(0,a);const o=i.substring(a+1,i.length).split("&");for(const s of o)this.parseQueryParameter(s)}},this.httpClient=e,this.config=t,this.urlComponents={host:this.config.baseUrl,version:this.config.defaultVersion,oDataQueryParams:{},otherURLQueryParams:{},otherURLQueryOptions:[]},this._headers={},this._options={},this._middlewareOptions=[],this.parsePath(r)}addCsvQueryParameter(e,t,r){this.urlComponents.oDataQueryParams[e]=this.urlComponents.oDataQueryParams[e]?this.urlComponents.oDataQueryParams[e]+",":"";let i=[];r.length>1&&typeof t=="string"?i=Array.prototype.slice.call(r):typeof t=="string"?i.push(t):i=i.concat(t),this.urlComponents.oDataQueryParams[e]+=i.join(",")}buildFullUrl(){const e=Jre([this.urlComponents.host,this.urlComponents.version,this.urlComponents.path])+this.createQueryString();return this.config.debugLogging&&console.log(e),e}createQueryString(){const e=this.urlComponents,t=[];if(Object.keys(e.oDataQueryParams).length!==0)for(const r in e.oDataQueryParams)Object.prototype.hasOwnProperty.call(e.oDataQueryParams,r)&&t.push(r+"="+e.oDataQueryParams[r]);if(Object.keys(e.otherURLQueryParams).length!==0)for(const r in e.otherURLQueryParams)Object.prototype.hasOwnProperty.call(e.otherURLQueryParams,r)&&t.push(r+"="+e.otherURLQueryParams[r]);if(e.otherURLQueryOptions.length!==0)for(const r of e.otherURLQueryOptions)t.push(r);return t.length>0?"?"+t.join("&"):""}parseQueryParameter(e){if(typeof e=="string")if(e.charAt(0)==="?"&&(e=e.substring(1)),e.indexOf("&")!==-1){const t=e.split("&");for(const r of t)this.parseQueryParamenterString(r)}else this.parseQueryParamenterString(e);else if(e.constructor===Object)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&this.setURLComponentsQueryParamater(t,e[t]);return this}parseQueryParamenterString(e){if(this.isValidQueryKeyValuePair(e)){const t=e.indexOf("="),r=e.substring(0,t),i=e.substring(t+1);this.setURLComponentsQueryParamater(r,i)}else this.urlComponents.otherURLQueryOptions.push(e)}setURLComponentsQueryParamater(e,t){if(Qre.indexOf(e)!==-1){const r=this.urlComponents.oDataQueryParams[e],i=r&&(e==="$expand"||e==="$select"||e==="$orderby");this.urlComponents.oDataQueryParams[e]=i?r+","+t:t}else this.urlComponents.otherURLQueryParams[e]=t}isValidQueryKeyValuePair(e){const t=e.indexOf("=");return!(t===-1||e.indexOf("(")!==-1&&e.indexOf("(")<t)}updateRequestOptions(e){const t=Object.assign({},e.headers);if(this.config.fetchOptions!==void 0){const r=Object.assign({},this.config.fetchOptions);Object.assign(e,r),typeof this.config.fetchOptions.headers!==void 0&&(e.headers=Object.assign({},this.config.fetchOptions.headers))}Object.assign(e,this._options),e.headers!==void 0&&Object.assign(t,e.headers),Object.assign(t,this._headers),e.headers=t}send(e,t,r){var i;return en(this,void 0,void 0,function*(){let a;const o=new cl(this._middlewareOptions);this.updateRequestOptions(t);const s=(i=this.config)===null||i===void 0?void 0:i.customHosts;try{return a=(yield this.httpClient.sendRequest({request:e,options:t,middlewareControl:o,customHosts:s})).response,yield Bf.getResponse(a,this._responseType,r)}catch(c){if(c instanceof sl)throw c;let u;throw a&&(u=a.status),yield Kv.getError(c,u,r,a)}})}setHeaderContentType(){if(!this._headers){this.header("Content-Type","application/json");return}const e=Object.keys(this._headers);for(const t of e)if(t.toLowerCase()==="content-type")return;this.header("Content-Type","application/json")}header(e,t){return this._headers[e]=t,this}headers(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this._headers[t]=e[t]);return this}option(e,t){return this._options[e]=t,this}options(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this._options[t]=e[t]);return this}middlewareOptions(e){return this._middlewareOptions=e,this}version(e){return this.urlComponents.version=e,this}responseType(e){return this._responseType=e,this}select(e){return this.addCsvQueryParameter("$select",e,arguments),this}expand(e){return this.addCsvQueryParameter("$expand",e,arguments),this}orderby(e){return this.addCsvQueryParameter("$orderby",e,arguments),this}filter(e){return this.urlComponents.oDataQueryParams.$filter=e,this}search(e){return this.urlComponents.oDataQueryParams.$search=e,this}top(e){return this.urlComponents.oDataQueryParams.$top=e,this}skip(e){return this.urlComponents.oDataQueryParams.$skip=e,this}skipToken(e){return this.urlComponents.oDataQueryParams.$skipToken=e,this}count(e=!0){return this.urlComponents.oDataQueryParams.$count=e.toString(),this}query(e){return this.parseQueryParameter(e)}get(e){return en(this,void 0,void 0,function*(){const t=this.buildFullUrl(),r={method:gi.GET};return yield this.send(t,r,e)})}post(e,t){return en(this,void 0,void 0,function*(){const r=this.buildFullUrl(),i={method:gi.POST,body:BS(e)};return(e&&e.constructor&&e.constructor.name)==="FormData"?i.headers={}:(this.setHeaderContentType(),i.headers=this._headers),yield this.send(r,i,t)})}create(e,t){return en(this,void 0,void 0,function*(){return yield this.post(e,t)})}put(e,t){return en(this,void 0,void 0,function*(){const r=this.buildFullUrl();this.setHeaderContentType();const i={method:gi.PUT,body:BS(e)};return yield this.send(r,i,t)})}patch(e,t){return en(this,void 0,void 0,function*(){const r=this.buildFullUrl();this.setHeaderContentType();const i={method:gi.PATCH,body:BS(e)};return yield this.send(r,i,t)})}update(e,t){return en(this,void 0,void 0,function*(){return yield this.patch(e,t)})}delete(e){return en(this,void 0,void 0,function*(){const t=this.buildFullUrl(),r={method:gi.DELETE};return yield this.send(t,r,e)})}del(e){return en(this,void 0,void 0,function*(){return yield this.delete(e)})}getStream(e){return en(this,void 0,void 0,function*(){const t=this.buildFullUrl(),r={method:gi.GET};return this.responseType(Ua.STREAM),yield this.send(t,r,e)})}putStream(e,t){return en(this,void 0,void 0,function*(){const r=this.buildFullUrl(),i={method:gi.PUT,headers:{"Content-Type":"application/octet-stream"},body:e};return yield this.send(r,i,t)})}}class W4{constructor(...e){if(!e||!e.length){const t=new Error;throw t.name="InvalidMiddlewareChain",t.message="Please provide a default middleware chain or custom middleware chain",t}this.setMiddleware(...e)}setMiddleware(...e){e.length>1?this.parseMiddleWareArray(e):this.middleware=e[0]}parseMiddleWareArray(e){e.forEach((t,r)=>{r<e.length-1&&t.setNext(e[r+1])}),this.middleware=e[0]}sendRequest(e){return en(this,void 0,void 0,function*(){if(typeof e.request=="string"&&e.options===void 0){const t=new Error;throw t.name="InvalidRequestOptions",t.message="Unable to execute the middleware, Please provide valid options for a request",t}return yield this.middleware.execute(e),e})}}const sie=()=>typeof process=="object"&&typeof iie=="function";class lA{static createWithAuthenticationProvider(e){const t=new Tp(e),r=new Us(new wn),i=new vi,a=new nie;if(t.setNext(r),sie()){const o=new uh(new Ui);r.setNext(o),o.setNext(i)}else r.setNext(i);return i.setNext(a),lA.createWithMiddleware(t)}static createWithMiddleware(...e){return new W4(...e)}}const cie=()=>{if(typeof Promise>"u"&&typeof fetch>"u"){const n=new Error("Library cannot function without Promise and fetch. So, please provide polyfill for them.");throw n.name="PolyFillNotAvailable",n}else if(typeof Promise>"u"){const n=new Error("Library cannot function without Promise. So, please provide polyfill for it.");throw n.name="PolyFillNotAvailable",n}else if(typeof fetch>"u"){const n=new Error("Library cannot function without fetch. So, please provide polyfill for it.");throw n.name="PolyFillNotAvailable",n}return!0};class qv{static init(e){const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=r==="authProvider"?new aie(e[r]):e[r]);return qv.initWithMiddleware(t)}static initWithMiddleware(e){return new qv(e)}constructor(e){this.config={baseUrl:Wre,debugLogging:!1,defaultVersion:qre},cie();for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(this.config[r]=e[r]);let t;if(e.authProvider!==void 0&&e.middleware!==void 0){const r=new Error;throw r.name="AmbiguityInInitialization",r.message="Unable to Create Client, Please provide either authentication provider for default middleware chain or custom middleware chain not both",r}else if(e.authProvider!==void 0)t=lA.createWithAuthenticationProvider(e.authProvider);else if(e.middleware!==void 0)t=new W4(...[].concat(e.middleware));else{const r=new Error;throw r.name="InvalidMiddlewareChain",r.message="Unable to Create Client, Please provide either authentication provider for default middleware chain or custom middleware chain",r}this.httpClient=t}api(e){return new oie(this.httpClient,this.config,e)}}const lie=["CAREERCOACH_STUDENTS","EXCHANGESTANDARD_STUDENT","M365EDU_A3_STUDENT","M365EDU_A3_STUUSEBNFT","M365EDU_A3_STUUSEBNFT_RPA1","M365EDU_A5_STUDENT","M365EDU_A5_STUUSEBNFT","M365EDU_A5_NOPSTNCONF_STUUSEBNFT","OFFICESUBSCRIPTION_STUDENT","ATP_ENTERPRISE_STUDENT","ATP_ENTERPRISE_STUDENTS_USE_BENEFIT","POWER_BI_STANDARD_STUDENT","MCOEV_STUDENT","MEE_STUDENT","STANDARDWOFFPACK_STUDENT","STANDARDWOFFPACK_IW_STUDENT","ENTERPRISEPACKPLUS_STUDENT","ENTERPRISEPREMIUM_STUDENT","WIN10_ENT_A3_STU","MCO_TEAMS_EDU_HS_STUDENT","PROJECT_PROFESSIONAL_STUDENT","PROJECT_P1_STUDENT"];function uie(n){return qv.init({authProvider:e=>{e(null,n)}})}async function HS(n,e){const t=performance.now(),r=await e;return H.trackEvent({name:"system",data:{eventName:"externalApiResponse",eventInfo_id:n,eventInfo_duration:performance.now()-t,eventInfo_service:"microsoft-graph"}}),r}async function die(n){return n.api(JT.graphMeApiSuffix).get()}async function hie(n){try{const e=await n.api(JT.graphMeImageApiSuffix).get();return URL.createObjectURL(e)}catch{return}}async function fie(n){const e=Fe(Gl);if($e("aad-student")&&e)try{const t=await n.api(JT.graphMeLicenseDetails).get();return t&&t.value.some(i=>i.skuPartNumber&&lie.includes(i.skuPartNumber))}catch(t){return console.error("Error checking student status:",t),!1}else return!1}async function iR(n){const e=uie(n),[t,r,i]=await Promise.all([HS("user",die(e)),HS("user_photo",hie(e)),HS("is_student",fie(e))]);return{...t,imgSrc:r,isStudent:i}}/*! @azure/msal-common v14.15.0 2024-09-20 */const se={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},Zm={CLIENT_ERROR_RANGE_START:400,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR_RANGE_START:500,SERVER_ERROR_RANGE_END:599},Gs=[se.OPENID_SCOPE,se.PROFILE_SCOPE,se.OFFLINE_ACCESS_SCOPE],aR=[...Gs,se.EMAIL_SCOPE],Qa={CONTENT_TYPE:"Content-Type",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},ir={ID_TOKEN:"idtoken",CLIENT_INFO:"client.info",ADAL_ID_TOKEN:"adal.idtoken",ERROR:"error",ERROR_DESC:"error.description",ACTIVE_ACCOUNT:"active-account",ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},Fs={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},Xm={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},lr={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},oR={PLAIN:"plain",S256:"S256"},lm={QUERY:"query",FRAGMENT:"fragment"},pie={...lm},Y4={AUTHORIZATION_CODE_GRANT:"authorization_code",REFRESH_TOKEN_GRANT:"refresh_token"},eg={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",GENERIC_ACCOUNT_TYPE:"Generic"},Tr={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},pt={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},uA="appmetadata",mie="client_info",$f="1",Wv={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},fi={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},gr={SCHEMA_VERSION:5,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},Wt={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},zf={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},sR={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},cR={username:"username",password:"password"},tg={httpSuccess:200,httpBadRequest:400},yu={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},$S={CONFIGURED_NO_AUTO_DETECTION:"2",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},Ss={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},gie={Pop:"pop"},vie=300;/*! @azure/msal-common v14.15.0 2024-09-20 */const Hy="unexpected_error",bie="post_request_failed";/*! @azure/msal-common v14.15.0 2024-09-20 */const lR={[Hy]:"Unexpected error in authentication.",[bie]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class Mt extends Error{constructor(e,t,r){const i=t?`${e}: ${t}`:e;super(i),Object.setPrototypeOf(this,Mt.prototype),this.errorCode=e||se.EMPTY_STRING,this.errorMessage=t||se.EMPTY_STRING,this.subError=r||se.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function Q4(n,e){return new Mt(n,e?`${lR[n]} ${e}`:lR[n])}/*! @azure/msal-common v14.15.0 2024-09-20 */const dA="client_info_decoding_error",J4="client_info_empty_error",hA="token_parsing_error",Z4="null_or_empty_token",Ao="endpoints_resolution_error",X4="network_error",ej="openid_config_error",tj="hash_not_deserialized",$d="invalid_state",nj="state_mismatch",Yv="state_not_found",rj="nonce_mismatch",fA="auth_time_not_found",ij="max_age_transpired",yie="multiple_matching_tokens",Cie="multiple_matching_accounts",aj="multiple_matching_appMetadata",oj="request_cannot_be_made",sj="cannot_remove_empty_scope",cj="cannot_append_scopeset",N1="empty_input_scopeset",Sie="device_code_polling_cancelled",wie="device_code_expired",Eie="device_code_unknown_error",pA="no_account_in_silent_request",lj="invalid_cache_record",mA="invalid_cache_environment",O1="no_account_found",L1="no_crypto_object",D1="unexpected_credential_type",Tie="invalid_assertion",Iie="invalid_client_credential",Ja="token_refresh_required",Aie="user_timeout_reached",uj="token_claims_cnf_required_for_signedjwt",dj="authorization_code_missing_from_server_response",hj="binding_key_not_removed",fj="end_session_endpoint_not_supported",gA="key_id_missing",kie="no_network_connectivity",xie="user_canceled",_ie="missing_tenant_id_error",wt="method_not_implemented",Mie="nested_app_auth_bridge_disabled";/*! @azure/msal-common v14.15.0 2024-09-20 */const uR={[dA]:"The client info could not be parsed/decoded correctly",[J4]:"The client info was empty",[hA]:"Token cannot be parsed",[Z4]:"The token is null or empty",[Ao]:"Endpoints cannot be resolved",[X4]:"Network request failed",[ej]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[tj]:"The hash parameters could not be deserialized",[$d]:"State was not the expected format",[nj]:"State mismatch error",[Yv]:"State not found",[rj]:"Nonce mismatch error",[fA]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[ij]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[yie]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[Cie]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[aj]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[oj]:"Token request cannot be made without authorization code or refresh token.",[sj]:"Cannot remove null or empty scope from ScopeSet",[cj]:"Cannot append ScopeSet",[N1]:"Empty input ScopeSet cannot be processed",[Sie]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[wie]:"Device code is expired.",[Eie]:"Device code stopped polling for unknown reasons.",[pA]:"Please pass an account object, silent flow is not supported without account information",[lj]:"Cache record object was null or undefined.",[mA]:"Invalid environment when attempting to create cache entry",[O1]:"No account found in cache for given key.",[L1]:"No crypto object detected.",[D1]:"Unexpected credential type.",[Tie]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[Iie]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[Ja]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[Aie]:"User defined timeout for device code polling reached",[uj]:"Cannot generate a POP jwt if the token_claims are not populated",[dj]:"Server response does not contain an authorization code to proceed",[hj]:"Could not remove the credential's binding key from storage.",[fj]:"The provided authority does not support logout",[gA]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[kie]:"No network connectivity. Check your internet connection.",[xie]:"User cancelled the flow.",[_ie]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[wt]:"This method has not been implemented",[Mie]:"The nested app auth bridge is disabled"};class dh extends Mt{constructor(e,t){super(e,t?`${uR[e]}: ${t}`:uR[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,dh.prototype)}}function Ne(n,e){return new dh(n,e)}/*! @azure/msal-common v14.15.0 2024-09-20 */const Qv={createNewGuid:()=>{throw Ne(wt)},base64Decode:()=>{throw Ne(wt)},base64Encode:()=>{throw Ne(wt)},base64UrlEncode:()=>{throw Ne(wt)},encodeKid:()=>{throw Ne(wt)},async getPublicKeyThumbprint(){throw Ne(wt)},async removeTokenBindingKey(){throw Ne(wt)},async clearKeystore(){throw Ne(wt)},async signJwt(){throw Ne(wt)},async hashString(){throw Ne(wt)}};/*! @azure/msal-common v14.15.0 2024-09-20 */var vn;(function(n){n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace"})(vn||(vn={}));class Ca{constructor(e,t,r){this.level=vn.Info;const i=()=>{},a=e||Ca.createDefaultLoggerOptions();this.localCallback=a.loggerCallback||i,this.piiLoggingEnabled=a.piiLoggingEnabled||!1,this.level=typeof a.logLevel=="number"?a.logLevel:vn.Info,this.correlationId=a.correlationId||se.EMPTY_STRING,this.packageName=t||se.EMPTY_STRING,this.packageVersion=r||se.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:vn.Info}}clone(e,t,r){return new Ca({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const a=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${vn[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,a,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:vn.Error,containsPii:!1,correlationId:t||se.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:vn.Error,containsPii:!0,correlationId:t||se.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:vn.Warning,containsPii:!1,correlationId:t||se.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:vn.Warning,containsPii:!0,correlationId:t||se.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:vn.Info,containsPii:!1,correlationId:t||se.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:vn.Info,containsPii:!0,correlationId:t||se.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:vn.Verbose,containsPii:!1,correlationId:t||se.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:vn.Verbose,containsPii:!0,correlationId:t||se.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:vn.Trace,containsPii:!1,correlationId:t||se.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:vn.Trace,containsPii:!0,correlationId:t||se.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-common v14.15.0 2024-09-20 */const pj="@azure/msal-common",vA="14.15.0";/*! @azure/msal-common v14.15.0 2024-09-20 */const Ip={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net"};/*! @azure/msal-common v14.15.0 2024-09-20 */function ql(n,e){const t=Rie(n);try{const r=e(t);return JSON.parse(r)}catch{throw Ne(hA)}}function Rie(n){if(!n)throw Ne(Z4);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(n);if(!t||t.length<4)throw Ne(hA);return t[2]}function mj(n,e){if(e===0||Date.now()-3e5>n+e)throw Ne(ij)}/*! @azure/msal-common v14.15.0 2024-09-20 */function so(){return Math.round(new Date().getTime()/1e3)}function j1(n,e){const t=Number(n)||0;return so()+e>t}function Pie(n){return Number(n)>so()}/*! @azure/msal-common v14.15.0 2024-09-20 */function Yu(n){return[Nie(n),Oie(n),Lie(n),Die(n),jie(n)].join(Tr.CACHE_KEY_SEPARATOR).toLowerCase()}function $y(n,e,t,r,i){return{credentialType:pt.ID_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t,realm:i}}function zy(n,e,t,r,i,a,o,s,c,u,h,f,p,g,v){var b,C;const y={homeAccountId:n,credentialType:pt.ACCESS_TOKEN,secret:t,cachedAt:so().toString(),expiresOn:o.toString(),extendedExpiresOn:s.toString(),environment:e,clientId:r,realm:i,target:a,tokenType:h||Wt.BEARER};if(f&&(y.userAssertionHash=f),u&&(y.refreshOn=u.toString()),g&&(y.requestedClaims=g,y.requestedClaimsHash=v),((b=y.tokenType)==null?void 0:b.toLowerCase())!==Wt.BEARER.toLowerCase())switch(y.credentialType=pt.ACCESS_TOKEN_WITH_AUTH_SCHEME,y.tokenType){case Wt.POP:const S=ql(t,c);if(!((C=S==null?void 0:S.cnf)!=null&&C.kid))throw Ne(uj);y.keyId=S.cnf.kid;break;case Wt.SSH:y.keyId=p}return y}function gj(n,e,t,r,i,a,o){const s={credentialType:pt.REFRESH_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t};return a&&(s.userAssertionHash=a),i&&(s.familyId=i),o&&(s.expiresOn=o.toString()),s}function bA(n){return n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("credentialType")&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("secret")}function dR(n){return n?bA(n)&&n.hasOwnProperty("realm")&&n.hasOwnProperty("target")&&(n.credentialType===pt.ACCESS_TOKEN||n.credentialType===pt.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function hR(n){return n?bA(n)&&n.hasOwnProperty("realm")&&n.credentialType===pt.ID_TOKEN:!1}function fR(n){return n?bA(n)&&n.credentialType===pt.REFRESH_TOKEN:!1}function Nie(n){return[n.homeAccountId,n.environment].join(Tr.CACHE_KEY_SEPARATOR).toLowerCase()}function Oie(n){const e=n.credentialType===pt.REFRESH_TOKEN&&n.familyId||n.clientId;return[n.credentialType,e,n.realm||""].join(Tr.CACHE_KEY_SEPARATOR).toLowerCase()}function Lie(n){return(n.target||"").toLowerCase()}function Die(n){return(n.requestedClaimsHash||"").toLowerCase()}function jie(n){return n.tokenType&&n.tokenType.toLowerCase()!==Wt.BEARER.toLowerCase()?n.tokenType.toLowerCase():""}function Uie(n,e){const t=n.indexOf(gr.CACHE_KEY)===0;let r=!0;return e&&(r=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&r}function Fie(n,e){let t=!1;n&&(t=n.indexOf(zf.THROTTLING_PREFIX)===0);let r=!0;return e&&(r=e.hasOwnProperty("throttleTime")),t&&r}function Bie({environment:n,clientId:e}){return[uA,n,e].join(Tr.CACHE_KEY_SEPARATOR).toLowerCase()}function Hie(n,e){return e?n.indexOf(uA)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function $ie(n,e){return e?n.indexOf(Wv.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function pR(){return so()+Wv.REFRESH_TIME_SECONDS}function ng(n,e,t){n.authorization_endpoint=e.authorization_endpoint,n.token_endpoint=e.token_endpoint,n.end_session_endpoint=e.end_session_endpoint,n.issuer=e.issuer,n.endpointsFromNetwork=t,n.jwks_uri=e.jwks_uri}function zS(n,e,t){n.aliases=e.aliases,n.preferred_cache=e.preferred_cache,n.preferred_network=e.preferred_network,n.aliasesFromNetwork=t}function mR(n){return n.expiresAt<=so()}/*! @azure/msal-common v14.15.0 2024-09-20 */const vj="redirect_uri_empty",zie="claims_request_parsing_error",bj="authority_uri_insecure",If="url_parse_error",yj="empty_url_error",Cj="empty_input_scopes_error",Sj="invalid_prompt_value",yA="invalid_claims",wj="token_request_empty",Ej="logout_request_empty",Tj="invalid_code_challenge_method",CA="pkce_params_missing",SA="invalid_cloud_discovery_metadata",Ij="invalid_authority_metadata",Aj="untrusted_authority",Vy="missing_ssh_jwk",kj="missing_ssh_kid",Vie="missing_nonce_authentication_header",Gie="invalid_authentication_header",xj="cannot_set_OIDCOptions",_j="cannot_allow_native_broker",Mj="authority_mismatch";/*! @azure/msal-common v14.15.0 2024-09-20 */const Kie={[vj]:"A redirect URI is required for all calls, and none has been set.",[zie]:"Could not parse the given claims request object.",[bj]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[If]:"URL could not be parsed into appropriate segments.",[yj]:"URL was empty or null.",[Cj]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[Sj]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[yA]:"Given claims parameter must be a stringified JSON object.",[wj]:"Token request was empty and not found in cache.",[Ej]:"The logout request was null or undefined.",[Tj]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[CA]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[SA]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[Ij]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[Aj]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[Vy]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[kj]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[Vie]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[Gie]:"Invalid authentication header provided",[xj]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[_j]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[Mj]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class Gy extends Mt{constructor(e){super(e,Kie[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,Gy.prototype)}}function tn(n){return new Gy(n)}/*! @azure/msal-common v14.15.0 2024-09-20 */class ga{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},r=e.split("&"),i=a=>decodeURIComponent(a.replace(/\+/g," "));return r.forEach(a=>{if(a.trim()){const[o,s]=a.split(/=(.+)/g,2);o&&s&&(t[i(o)]=i(s))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class Un{constructor(e){const t=e?ga.trimArrayEntries([...e]):[],r=t?ga.removeEmptyStringsFromArray(t):[];this.validateInputScopes(r),this.scopes=new Set,r.forEach(i=>this.scopes.add(i))}static fromString(e){const r=(e||se.EMPTY_STRING).split(" ");return new Un(r)}static createSearchScopes(e){const t=new Un(e);return t.containsOnlyOIDCScopes()?t.removeScope(se.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw tn(Cj)}containsScope(e){const t=this.printScopesLowerCase().split(" "),r=new Un(t);return e?r.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return aR.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw Ne(cj)}}removeScope(e){if(!e)throw Ne(sj);this.scopes.delete(e.trim())}removeOIDCScopes(){aR.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw Ne(N1);const t=new Set;return e.scopes.forEach(r=>t.add(r.toLowerCase())),this.scopes.forEach(r=>t.add(r.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw Ne(N1);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),r=e.getScopeCount(),i=this.getScopeCount();return t.size<i+r}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):se.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}/*! @azure/msal-common v14.15.0 2024-09-20 */function Jv(n,e){if(!n)throw Ne(J4);try{const t=e(n);return JSON.parse(t)}catch{throw Ne(dA)}}function Qu(n){if(!n)throw Ne(dA);const e=n.split(Tr.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?se.EMPTY_STRING:e[1]}}/*! @azure/msal-common v14.15.0 2024-09-20 */function Zv(n,e){return!!n&&!!e&&n===e.split(".")[1]}function wA(n,e,t,r){if(r){const{oid:i,sub:a,tid:o,name:s,tfp:c,acr:u}=r,h=o||c||u||"";return{tenantId:h,localAccountId:i||a||"",name:s,isHomeTenant:Zv(h,n)}}else return{tenantId:t,localAccountId:e,isHomeTenant:Zv(t,n)}}function EA(n,e,t,r){let i=n;if(e){const{isHomeTenant:a,...o}=e;i={...n,...o}}if(t){const{isHomeTenant:a,...o}=wA(n.homeAccountId,n.localAccountId,n.tenantId,t);return i={...i,...o,idTokenClaims:t,idToken:r},i}return i}/*! @azure/msal-common v14.15.0 2024-09-20 */const oa={Default:0,Adfs:1,Dsts:2,Ciam:3};/*! @azure/msal-common v14.15.0 2024-09-20 */function Rj(n){return n&&(n.tid||n.tfp||n.acr)||null}/*! @azure/msal-common v14.15.0 2024-09-20 */const Po={AAD:"AAD",OIDC:"OIDC"};/*! @azure/msal-common v14.15.0 2024-09-20 */class Xn{generateAccountId(){return[this.homeAccountId,this.environment].join(Tr.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return Xn.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){const t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(Tr.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,r){var u,h,f,p,g,v;const i=new Xn;t.authorityType===oa.Adfs?i.authorityType=eg.ADFS_ACCOUNT_TYPE:t.protocolMode===Po.AAD?i.authorityType=eg.MSSTS_ACCOUNT_TYPE:i.authorityType=eg.GENERIC_ACCOUNT_TYPE;let a;e.clientInfo&&r&&(a=Jv(e.clientInfo,r)),i.clientInfo=e.clientInfo,i.homeAccountId=e.homeAccountId,i.nativeAccountId=e.nativeAccountId;const o=e.environment||t&&t.getPreferredCache();if(!o)throw Ne(mA);i.environment=o,i.realm=(a==null?void 0:a.utid)||Rj(e.idTokenClaims)||"",i.localAccountId=(a==null?void 0:a.uid)||((u=e.idTokenClaims)==null?void 0:u.oid)||((h=e.idTokenClaims)==null?void 0:h.sub)||"";const s=((f=e.idTokenClaims)==null?void 0:f.preferred_username)||((p=e.idTokenClaims)==null?void 0:p.upn),c=(g=e.idTokenClaims)!=null&&g.emails?e.idTokenClaims.emails[0]:null;if(i.username=s||c||"",i.name=((v=e.idTokenClaims)==null?void 0:v.name)||"",i.cloudGraphHostName=e.cloudGraphHostName,i.msGraphHost=e.msGraphHost,e.tenantProfiles)i.tenantProfiles=e.tenantProfiles;else{const y=wA(e.homeAccountId,i.localAccountId,i.realm,e.idTokenClaims);i.tenantProfiles=[y]}return i}static createFromAccountInfo(e,t,r){var a;const i=new Xn;return i.authorityType=e.authorityType||eg.GENERIC_ACCOUNT_TYPE,i.homeAccountId=e.homeAccountId,i.localAccountId=e.localAccountId,i.nativeAccountId=e.nativeAccountId,i.realm=e.tenantId,i.environment=e.environment,i.username=e.username,i.name=e.name,i.cloudGraphHostName=t,i.msGraphHost=r,i.tenantProfiles=Array.from(((a=e.tenantProfiles)==null?void 0:a.values())||[]),i}static generateHomeAccountId(e,t,r,i,a){if(!(t===oa.Adfs||t===oa.Dsts)){if(e)try{const o=Jv(e,i.base64Decode);if(o.uid&&o.utid)return`${o.uid}.${o.utid}`}catch{}r.warning("No client info in response")}return(a==null?void 0:a.sub)||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;let i=!0;if(r){const a=e.idTokenClaims||{},o=t.idTokenClaims||{};i=a.iat===o.iat&&a.nonce===o.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&i}}/*! @azure/msal-common v14.15.0 2024-09-20 */function Pj(n){return n.startsWith("#/")?n.substring(2):n.startsWith("#")||n.startsWith("?")?n.substring(1):n}function Xv(n){if(!n||n.indexOf("=")<0)return null;try{const e=Pj(n),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.error||t.error_description||t.state)return t}catch{throw Ne(tj)}return null}/*! @azure/msal-common v14.15.0 2024-09-20 */class Pt{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw tn(yj);e.includes("#")||(this._urlString=Pt.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return ga.endsWith(t,"?")?t=t.slice(0,-1):ga.endsWith(t,"?/")&&(t=t.slice(0,-2)),ga.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw tn(If)}if(!e.HostNameAndPort||!e.PathSegments)throw tn(If);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw tn(bj)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return Pt.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),r=t.PathSegments;return e&&r.length!==0&&(r[0]===Fs.COMMON||r[0]===Fs.ORGANIZATIONS)&&(r[0]=e),Pt.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw tn(If);const r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let i=r.AbsolutePath.split("/");return i=i.filter(a=>a&&a.length>0),r.PathSegments=i,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw tn(If);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===se.FORWARD_SLASH){const i=new Pt(t).getUrlComponents();return i.Protocol+"//"+i.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new Pt(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!Xv(e)}}/*! @azure/msal-common v14.15.0 2024-09-20 */const Nj={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},gR=Nj.endpointMetadata,TA=Nj.instanceDiscoveryMetadata,Oj=new Set;TA.metadata.forEach(n=>{n.aliases.forEach(e=>{Oj.add(e)})});function qie(n,e){var i;let t;const r=n.canonicalAuthority;if(r){const a=new Pt(r).getUrlComponents().HostNameAndPort;t=vR(a,(i=n.cloudDiscoveryMetadata)==null?void 0:i.metadata,fi.CONFIG,e)||vR(a,TA.metadata,fi.HARDCODED_VALUES,e)||n.knownAuthorities}return t||[]}function vR(n,e,t,r){if(r==null||r.trace(`getAliasesFromMetadata called with source: ${t}`),n&&e){const i=eb(e,n);if(i)return r==null||r.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),i.aliases;r==null||r.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function Wie(n){return eb(TA.metadata,n)}function eb(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(r.aliases.includes(e))return r}return null}/*! @azure/msal-common v14.15.0 2024-09-20 */const Lj="cache_quota_exceeded",IA="cache_error_unknown";/*! @azure/msal-common v14.15.0 2024-09-20 */const VS={[Lj]:"Exceeded cache storage capacity.",[IA]:"Unexpected error occurred when using cache storage."};class Kc extends Error{constructor(e,t){const r=t||(VS[e]?VS[e]:VS[IA]);super(`${e}: ${r}`),Object.setPrototypeOf(this,Kc.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}}/*! @azure/msal-common v14.15.0 2024-09-20 */class zd{constructor(e,t,r,i){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(pj,vA),this.staticAuthorityOptions=i}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){const t=this.getAllAccounts(e);return t.length>1?t.sort(i=>i.idTokenClaims?-1:1)[0]:t.length===1?t[0]:null}getBaseAccountInfo(e){const t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(r=>this.getTenantProfilesFromAccountEntity(r,t==null?void 0:t.tenantId,t))}getTenantedAccountInfoByFilter(e,t,r,i){let a=null,o;if(i&&!this.tenantProfileMatchesFilter(r,i))return null;const s=this.getIdToken(e,t,r.tenantId);return s&&(o=ql(s.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(o,i))?null:(a=EA(e,r,o,s==null?void 0:s.secret),a)}getTenantProfilesFromAccountEntity(e,t,r){const i=e.getAccountInfo();let a=i.tenantProfiles||new Map;const o=this.getTokenKeys();if(t){const c=a.get(t);if(c)a=new Map([[t,c]]);else return[]}const s=[];return a.forEach(c=>{const u=this.getTenantedAccountInfoByFilter(i,o,c,r);u&&s.push(u)}),s}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,r){var i,a,o,s;if(!e)throw Ne(lj);try{e.account&&this.setAccount(e.account),e.idToken&&(t==null?void 0:t.idToken)!==!1&&this.setIdTokenCredential(e.idToken),e.accessToken&&(t==null?void 0:t.accessToken)!==!1&&await this.saveAccessToken(e.accessToken),e.refreshToken&&(t==null?void 0:t.refreshToken)!==!1&&this.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&this.setAppMetadata(e.appMetadata)}catch(c){throw(i=this.commonLogger)==null||i.error("CacheManager.saveCacheRecord: failed"),c instanceof Error?((a=this.commonLogger)==null||a.errorPii(`CacheManager.saveCacheRecord: ${c.message}`,r),c.name==="QuotaExceededError"||c.name==="NS_ERROR_DOM_QUOTA_REACHED"||c.message.includes("exceeded the quota")?((o=this.commonLogger)==null||o.error("CacheManager.saveCacheRecord: exceeded storage quota",r),new Kc(Lj)):new Kc(c.name,c.message)):((s=this.commonLogger)==null||s.errorPii(`CacheManager.saveCacheRecord: ${c}`,r),new Kc(IA))}}async saveAccessToken(e){const t={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},r=this.getTokenKeys(),i=Un.fromString(e.target),a=[];r.accessToken.forEach(o=>{if(!this.accessTokenKeyMatchesFilter(o,t,!1))return;const s=this.getAccessTokenCredential(o);s&&this.credentialMatchesFilter(s,t)&&Un.fromString(s.target).intersectingScopeSets(i)&&a.push(this.removeAccessToken(o))}),await Promise.all(a),this.setAccessTokenCredential(e)}getAccountsFilteredBy(e){const t=this.getAccountKeys(),r=[];return t.forEach(i=>{var c;if(!this.isAccountKey(i,e.homeAccountId))return;const a=this.getAccount(i,this.commonLogger);if(!a||e.homeAccountId&&!this.matchHomeAccountId(a,e.homeAccountId)||e.username&&!this.matchUsername(a.username,e.username)||e.environment&&!this.matchEnvironment(a,e.environment)||e.realm&&!this.matchRealm(a,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(a,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(a,e.authorityType))return;const o={localAccountId:e==null?void 0:e.localAccountId,name:e==null?void 0:e.name},s=(c=a.tenantProfiles)==null?void 0:c.filter(u=>this.tenantProfileMatchesFilter(u,o));s&&s.length===0||r.push(a)}),r}isAccountKey(e,t,r){return!(e.split(Tr.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||r&&!e.toLowerCase().includes(r.toLowerCase()))}isCredentialKey(e){if(e.split(Tr.CACHE_KEY_SEPARATOR).length<6)return!1;const t=e.toLowerCase();if(t.indexOf(pt.ID_TOKEN.toLowerCase())===-1&&t.indexOf(pt.ACCESS_TOKEN.toLowerCase())===-1&&t.indexOf(pt.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&t.indexOf(pt.REFRESH_TOKEN.toLowerCase())===-1)return!1;if(t.indexOf(pt.REFRESH_TOKEN.toLowerCase())>-1){const r=`${pt.REFRESH_TOKEN}${Tr.CACHE_KEY_SEPARATOR}${this.clientId}${Tr.CACHE_KEY_SEPARATOR}`,i=`${pt.REFRESH_TOKEN}${Tr.CACHE_KEY_SEPARATOR}${$f}${Tr.CACHE_KEY_SEPARATOR}`;if(t.indexOf(r.toLowerCase())===-1&&t.indexOf(i.toLowerCase())===-1)return!1}else if(t.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===pt.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===Wt.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),r={};return t.forEach(i=>{if(!this.isAppMetadata(i))return;const a=this.getAppMetadata(i);a&&(e.environment&&!this.matchEnvironment(a,e.environment)||e.clientId&&!this.matchClientId(a,e.clientId)||(r[i]=a))}),r}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let r=null;return t.forEach(i=>{if(!this.isAuthorityMetadata(i)||i.indexOf(this.clientId)===-1)return;const a=this.getAuthorityMetadata(i);a&&a.aliases.indexOf(e)!==-1&&(r=a)}),r}async removeAllAccounts(){const e=this.getAccountKeys(),t=[];e.forEach(r=>{t.push(this.removeAccount(r))}),await Promise.all(t)}async removeAccount(e){const t=this.getAccount(e,this.commonLogger);t&&(await this.removeAccountContext(t),this.removeItem(e))}async removeAccountContext(e){const t=this.getTokenKeys(),r=e.generateAccountId(),i=[];t.idToken.forEach(a=>{a.indexOf(r)===0&&this.removeIdToken(a)}),t.accessToken.forEach(a=>{a.indexOf(r)===0&&i.push(this.removeAccessToken(a))}),t.refreshToken.forEach(a=>{a.indexOf(r)===0&&this.removeRefreshToken(a)}),await Promise.all(i)}updateOutdatedCachedAccount(e,t,r){var i;if(t&&t.isSingleTenant()){(i=this.commonLogger)==null||i.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");const a=this.getAccountKeys().filter(h=>h.startsWith(t.homeAccountId)),o=[];a.forEach(h=>{const f=this.getCachedAccountEntity(h);f&&o.push(f)});const s=o.find(h=>Zv(h.realm,h.homeAccountId))||o[0];s.tenantProfiles=o.map(h=>({tenantId:h.realm,localAccountId:h.localAccountId,name:h.name,isHomeTenant:Zv(h.realm,h.homeAccountId)}));const c=zd.toObject(new Xn,{...s}),u=c.generateAccountKey();return a.forEach(h=>{h!==u&&this.removeOutdatedAccount(e)}),this.setAccount(c),r==null||r.verbose("Updated an outdated account entity in the cache"),c}return t}async removeAccessToken(e){const t=this.getAccessTokenCredential(e);if(t){if(t.credentialType.toLowerCase()===pt.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&t.tokenType===Wt.POP){const i=t.keyId;if(i)try{await this.cryptoImpl.removeTokenBindingKey(i)}catch{throw Ne(hj)}}return this.removeItem(e)}}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readAccountFromCache(e){const t=Xn.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,r,i,a){this.commonLogger.trace("CacheManager - getIdToken called");const o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:pt.ID_TOKEN,clientId:this.clientId,realm:r},s=this.getIdTokensByFilter(o,t),c=s.size;if(c<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(c>1){let u=s;if(!r){const h=new Map;s.forEach((p,g)=>{p.realm===e.tenantId&&h.set(g,p)});const f=h.size;if(f<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),s.values().next().value;if(f===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),h.values().next().value;u=h}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),u.forEach((h,f)=>{this.removeIdToken(f)}),i&&a&&i.addFields({multiMatchedID:s.size},a),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),s.values().next().value}getIdTokensByFilter(e,t){const r=t&&t.idToken||this.getTokenKeys().idToken,i=new Map;return r.forEach(a=>{if(!this.idTokenKeyMatchesFilter(a,{clientId:this.clientId,...e}))return;const o=this.getIdTokenCredential(a);o&&this.credentialMatchesFilter(o,e)&&i.set(a,o)}),i}idTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,r,i,a,o){this.commonLogger.trace("CacheManager - getAccessToken called");const s=Un.createSearchScopes(t.scopes),c=t.authenticationScheme||Wt.BEARER,u=c.toLowerCase()!==Wt.BEARER.toLowerCase()?pt.ACCESS_TOKEN_WITH_AUTH_SCHEME:pt.ACCESS_TOKEN,h={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:u,clientId:this.clientId,realm:i||e.tenantId,target:s,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},f=r&&r.accessToken||this.getTokenKeys().accessToken,p=[];f.forEach(v=>{if(this.accessTokenKeyMatchesFilter(v,h,!0)){const y=this.getAccessTokenCredential(v);y&&this.credentialMatchesFilter(y,h)&&p.push(y)}});const g=p.length;return g<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):g>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),p.forEach(v=>{this.removeAccessToken(Yu(v))}),a&&o&&a.addFields({multiMatchedAT:p.length},o),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),p[0])}accessTokenKeyMatchesFilter(e,t,r){const i=e.toLowerCase();if(t.clientId&&i.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&i.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&i.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&i.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const a=t.target.asArray();for(let o=0;o<a.length;o++){if(r&&!i.includes(a[o].toLowerCase()))return!1;if(!r&&i.includes(a[o].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e){const t=this.getTokenKeys(),r=[];return t.accessToken.forEach(i=>{if(!this.accessTokenKeyMatchesFilter(i,e,!0))return;const a=this.getAccessTokenCredential(i);a&&this.credentialMatchesFilter(a,e)&&r.push(a)}),r}getRefreshToken(e,t,r,i,a){this.commonLogger.trace("CacheManager - getRefreshToken called");const o=t?$f:void 0,s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:pt.REFRESH_TOKEN,clientId:this.clientId,familyId:o},c=r&&r.refreshToken||this.getTokenKeys().refreshToken,u=[];c.forEach(f=>{if(this.refreshTokenKeyMatchesFilter(f,s)){const p=this.getRefreshTokenCredential(f);p&&this.credentialMatchesFilter(p,s)&&u.push(p)}});const h=u.length;return h<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(h>1&&i&&a&&i.addFields({multiMatchedRT:h},a),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),u[0])}refreshTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.familyId&&r.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(t),i=Object.keys(r).map(o=>r[o]),a=i.length;if(a<1)return null;if(a>1)throw Ne(aj);return i[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===$f)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const r=e.oid||e.sub;return t===r}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var r;return t.toLowerCase()===((r=e.name)==null?void 0:r.toLowerCase())}matchUsername(e,t){return!!(e&&typeof e=="string"&&(t==null?void 0:t.toLowerCase())===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const i=qie(this.staticAuthorityOptions,this.commonLogger);if(i.includes(t)&&i.includes(e.environment))return!0}const r=this.getAuthorityMetadataByAlias(t);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){var r;return((r=e.realm)==null?void 0:r.toLowerCase())===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==pt.ACCESS_TOKEN&&e.credentialType!==pt.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:Un.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(uA)!==-1}isAuthorityMetadata(e){return e.indexOf(Wv.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${Wv.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const r in t)e[r]=t[r];return e}}class Yie extends zd{setAccount(){throw Ne(wt)}getAccount(){throw Ne(wt)}getCachedAccountEntity(){throw Ne(wt)}setIdTokenCredential(){throw Ne(wt)}getIdTokenCredential(){throw Ne(wt)}setAccessTokenCredential(){throw Ne(wt)}getAccessTokenCredential(){throw Ne(wt)}setRefreshTokenCredential(){throw Ne(wt)}getRefreshTokenCredential(){throw Ne(wt)}setAppMetadata(){throw Ne(wt)}getAppMetadata(){throw Ne(wt)}setServerTelemetry(){throw Ne(wt)}getServerTelemetry(){throw Ne(wt)}setAuthorityMetadata(){throw Ne(wt)}getAuthorityMetadata(){throw Ne(wt)}getAuthorityMetadataKeys(){throw Ne(wt)}setThrottlingCache(){throw Ne(wt)}getThrottlingCache(){throw Ne(wt)}removeItem(){throw Ne(wt)}getKeys(){throw Ne(wt)}getAccountKeys(){throw Ne(wt)}getTokenKeys(){throw Ne(wt)}async clear(){throw Ne(wt)}updateCredentialCacheKey(){throw Ne(wt)}removeOutdatedAccount(){throw Ne(wt)}}/*! @azure/msal-common v14.15.0 2024-09-20 */const Dj={tokenRenewalOffsetSeconds:vie,preventCorsPreflight:!1},Qie={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:vn.Info,correlationId:se.EMPTY_STRING},Jie={claimsBasedCachingEnabled:!1},Zie={async sendGetRequestAsync(){throw Ne(wt)},async sendPostRequestAsync(){throw Ne(wt)}},Xie={sku:se.SKU,version:vA,cpu:se.EMPTY_STRING,os:se.EMPTY_STRING},eae={clientSecret:se.EMPTY_STRING,clientAssertion:void 0},tae={azureCloudInstance:Ip.None,tenant:`${se.DEFAULT_COMMON_TENANT}`},nae={application:{appName:"",appVersion:""}};function rae({authOptions:n,systemOptions:e,loggerOptions:t,cacheOptions:r,storageInterface:i,networkInterface:a,cryptoInterface:o,clientCredentials:s,libraryInfo:c,telemetry:u,serverTelemetryManager:h,persistencePlugin:f,serializableCache:p}){const g={...Qie,...t};return{authOptions:iae(n),systemOptions:{...Dj,...e},loggerOptions:g,cacheOptions:{...Jie,...r},storageInterface:i||new Yie(n.clientId,Qv,new Ca(g)),networkInterface:a||Zie,cryptoInterface:o||Qv,clientCredentials:s||eae,libraryInfo:{...Xie,...c},telemetry:{...nae,...u},serverTelemetryManager:h||null,persistencePlugin:f||null,serializableCache:p||null}}function iae(n){return{clientCapabilities:[],azureCloudOptions:tae,skipAuthorityMetadataCache:!1,instanceAware:!1,...n}}function U1(n){return n.authOptions.authority.options.protocolMode===Po.OIDC}/*! @azure/msal-common v14.15.0 2024-09-20 */class co extends Mt{constructor(e,t,r,i,a){super(e,t,r),this.name="ServerError",this.errorNo=i,this.status=a,Object.setPrototypeOf(this,co.prototype)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class za{static generateThrottlingStorageKey(e){return`${zf.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){var a;const r=za.generateThrottlingStorageKey(t),i=e.getThrottlingCache(r);if(i){if(i.throttleTime<Date.now()){e.removeItem(r);return}throw new co(((a=i.errorCodes)==null?void 0:a.join(" "))||se.EMPTY_STRING,i.errorMessage,i.subError)}}static postProcess(e,t,r){if(za.checkResponseStatus(r)||za.checkResponseForRetryAfter(r)){const i={throttleTime:za.calculateThrottleTime(parseInt(r.headers[Qa.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(za.generateThrottlingStorageKey(t),i)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(Qa.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(Math.min(r+(t||zf.DEFAULT_THROTTLE_TIME_SECONDS),r+zf.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,r,i){const a={clientId:t,authority:r.authority,scopes:r.scopes,homeAccountIdentifier:i,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid},o=this.generateThrottlingStorageKey(a);e.removeItem(o)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class aae{constructor(e,t){this.networkClient=e,this.cacheManager=t}async sendPostRequest(e,t,r){za.preProcess(this.cacheManager,e);let i;try{i=await this.networkClient.sendPostRequestAsync(t,r)}catch(a){throw a instanceof Mt?a:Ne(X4)}return za.postProcess(this.cacheManager,e,i),i}}/*! @azure/msal-common v14.15.0 2024-09-20 */const Ci={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};/*! @azure/msal-common v14.15.0 2024-09-20 */const Vd="client_id",oae="redirect_uri",bR="response_type",sae="response_mode",cae="grant_type",lae="claims",uae="scope",dae="refresh_token",hae="state",fae="nonce",pae="prompt",mae="code",gae="code_challenge",vae="code_challenge_method",bae="code_verifier",yae="client-request-id",Cae="x-client-SKU",Sae="x-client-VER",wae="x-client-OS",Eae="x-client-CPU",Tae="x-client-current-telemetry",Iae="x-client-last-telemetry",Aae="x-ms-lib-capability",kae="x-app-name",xae="x-app-ver",_ae="post_logout_redirect_uri",Mae="id_token_hint",Rae="device_code",Pae="client_secret",Nae="client_assertion",Oae="client_assertion_type",yR="token_type",CR="req_cnf",Lae="assertion",Dae="requested_token_use",SR="return_spa_code",jae="nativebroker",Uae="logout_hint",Fae="sid",Bae="login_hint",Hae="domain_hint",$ae="x-client-xtra-sku";/*! @azure/msal-common v14.15.0 2024-09-20 */class ju{static validateRedirectUri(e){if(!e)throw tn(vj)}static validatePrompt(e){const t=[];for(const r in lr)t.push(lr[r]);if(t.indexOf(e)<0)throw tn(Sj)}static validateClaims(e){try{JSON.parse(e)}catch{throw tn(yA)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw tn(CA);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([oR.PLAIN,oR.S256].indexOf(e)<0)throw tn(Tj)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class Vf{constructor(){this.parameters=new Map}addResponseTypeCode(){this.parameters.set(bR,encodeURIComponent(se.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(bR,encodeURIComponent(`${se.TOKEN_RESPONSE_TYPE} ${se.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set(sae,encodeURIComponent(e||pie.QUERY))}addNativeBroker(){this.parameters.set(jae,encodeURIComponent("1"))}addScopes(e,t=!0,r=Gs){t&&!r.includes("openid")&&!e.includes("openid")&&r.push("openid");const i=t?[...e||[],...r]:e||[],a=new Un(i);this.parameters.set(uae,encodeURIComponent(a.printScopes()))}addClientId(e){this.parameters.set(Vd,encodeURIComponent(e))}addRedirectUri(e){ju.validateRedirectUri(e),this.parameters.set(oae,encodeURIComponent(e))}addPostLogoutRedirectUri(e){ju.validateRedirectUri(e),this.parameters.set(_ae,encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set(Mae,encodeURIComponent(e))}addDomainHint(e){this.parameters.set(Hae,encodeURIComponent(e))}addLoginHint(e){this.parameters.set(Bae,encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(Qa.CCS_HEADER,encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set(Qa.CCS_HEADER,encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set(Fae,encodeURIComponent(e))}addClaims(e,t){const r=this.addClientCapabilitiesToClaims(e,t);ju.validateClaims(r),this.parameters.set(lae,encodeURIComponent(r))}addCorrelationId(e){this.parameters.set(yae,encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set(Cae,e.sku),this.parameters.set(Sae,e.version),e.os&&this.parameters.set(wae,e.os),e.cpu&&this.parameters.set(Eae,e.cpu)}addApplicationTelemetry(e){e!=null&&e.appName&&this.parameters.set(kae,e.appName),e!=null&&e.appVersion&&this.parameters.set(xae,e.appVersion)}addPrompt(e){ju.validatePrompt(e),this.parameters.set(`${pae}`,encodeURIComponent(e))}addState(e){e&&this.parameters.set(hae,encodeURIComponent(e))}addNonce(e){this.parameters.set(fae,encodeURIComponent(e))}addCodeChallengeParams(e,t){if(ju.validateCodeChallengeParams(e,t),e&&t)this.parameters.set(gae,encodeURIComponent(e)),this.parameters.set(vae,encodeURIComponent(t));else throw tn(CA)}addAuthorizationCode(e){this.parameters.set(mae,encodeURIComponent(e))}addDeviceCode(e){this.parameters.set(Rae,encodeURIComponent(e))}addRefreshToken(e){this.parameters.set(dae,encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set(bae,encodeURIComponent(e))}addClientSecret(e){this.parameters.set(Pae,encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set(Nae,encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set(Oae,encodeURIComponent(e))}addOboAssertion(e){this.parameters.set(Lae,encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set(Dae,encodeURIComponent(e))}addGrantType(e){this.parameters.set(cae,encodeURIComponent(e))}addClientInfo(){this.parameters.set(mie,"1")}addExtraQueryParameters(e){Object.entries(e).forEach(([t,r])=>{!this.parameters.has(t)&&r&&this.parameters.set(t,r)})}addClientCapabilitiesToClaims(e,t){let r;if(!e)r={};else try{r=JSON.parse(e)}catch{throw tn(yA)}return t&&t.length>0&&(r.hasOwnProperty(Xm.ACCESS_TOKEN)||(r[Xm.ACCESS_TOKEN]={}),r[Xm.ACCESS_TOKEN][Xm.XMS_CC]={values:t}),JSON.stringify(r)}addUsername(e){this.parameters.set(cR.username,encodeURIComponent(e))}addPassword(e){this.parameters.set(cR.password,encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(yR,Wt.POP),this.parameters.set(CR,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(yR,Wt.SSH),this.parameters.set(CR,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set(Tae,e.generateCurrentRequestHeaderValue()),this.parameters.set(Iae,e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set(Aae,zf.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(e){this.parameters.set(Uae,encodeURIComponent(e))}createQueryString(){const e=new Array;return this.parameters.forEach((t,r)=>{e.push(`${r}=${t}`)}),e.join("&")}}/*! @azure/msal-common v14.15.0 2024-09-20 */function zae(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}/*! @azure/msal-common v14.15.0 2024-09-20 */function Vae(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}/*! @azure/msal-common v14.15.0 2024-09-20 */function Gae(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}/*! @azure/msal-common v14.15.0 2024-09-20 */const L={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues"},Kae=new Map([[L.AcquireTokenByCode,"ATByCode"],[L.AcquireTokenByRefreshToken,"ATByRT"],[L.AcquireTokenSilent,"ATS"],[L.AcquireTokenSilentAsync,"ATSAsync"],[L.AcquireTokenPopup,"ATPopup"],[L.AcquireTokenRedirect,"ATRedirect"],[L.CryptoOptsGetPublicKeyThumbprint,"CryptoGetPKThumb"],[L.CryptoOptsSignJwt,"CryptoSignJwt"],[L.SilentCacheClientAcquireToken,"SltCacheClientAT"],[L.SilentIframeClientAcquireToken,"SltIframeClientAT"],[L.SilentRefreshClientAcquireToken,"SltRClientAT"],[L.SsoSilent,"SsoSlt"],[L.StandardInteractionClientGetDiscoveredAuthority,"StdIntClientGetDiscAuth"],[L.FetchAccountIdWithNativeBroker,"FetchAccIdWithNtvBroker"],[L.NativeInteractionClientAcquireToken,"NtvIntClientAT"],[L.BaseClientCreateTokenRequestHeaders,"BaseClientCreateTReqHead"],[L.RefreshTokenClientExecutePostToTokenEndpoint,"RTClientExecPost"],[L.AuthorizationCodeClientExecutePostToTokenEndpoint,"AuthCodeClientExecPost"],[L.BrokerHandhshake,"BrokerHandshake"],[L.AcquireTokenByRefreshTokenInBroker,"ATByRTInBroker"],[L.AcquireTokenByBroker,"ATByBroker"],[L.RefreshTokenClientExecuteTokenRequest,"RTClientExecTReq"],[L.RefreshTokenClientAcquireToken,"RTClientAT"],[L.RefreshTokenClientAcquireTokenWithCachedRefreshToken,"RTClientATWithCachedRT"],[L.RefreshTokenClientAcquireTokenByRefreshToken,"RTClientATByRT"],[L.RefreshTokenClientCreateTokenRequestBody,"RTClientCreateTReqBody"],[L.AcquireTokenFromCache,"ATFromCache"],[L.SilentFlowClientAcquireCachedToken,"SltFlowClientATCached"],[L.SilentFlowClientGenerateResultFromCacheRecord,"SltFlowClientGenResFromCache"],[L.AcquireTokenBySilentIframe,"ATBySltIframe"],[L.InitializeBaseRequest,"InitBaseReq"],[L.InitializeSilentRequest,"InitSltReq"],[L.InitializeClientApplication,"InitClientApplication"],[L.SilentIframeClientTokenHelper,"SIClientTHelper"],[L.SilentHandlerInitiateAuthRequest,"SHandlerInitAuthReq"],[L.SilentHandlerMonitorIframeForHash,"SltHandlerMonitorIframeForHash"],[L.SilentHandlerLoadFrame,"SHandlerLoadFrame"],[L.SilentHandlerLoadFrameSync,"SHandlerLoadFrameSync"],[L.StandardInteractionClientCreateAuthCodeClient,"StdIntClientCreateAuthCodeClient"],[L.StandardInteractionClientGetClientConfiguration,"StdIntClientGetClientConf"],[L.StandardInteractionClientInitializeAuthorizationRequest,"StdIntClientInitAuthReq"],[L.StandardInteractionClientInitializeAuthorizationCodeRequest,"StdIntClientInitAuthCodeReq"],[L.GetAuthCodeUrl,"GetAuthCodeUrl"],[L.HandleCodeResponseFromServer,"HandleCodeResFromServer"],[L.HandleCodeResponse,"HandleCodeResp"],[L.UpdateTokenEndpointAuthority,"UpdTEndpointAuth"],[L.AuthClientAcquireToken,"AuthClientAT"],[L.AuthClientExecuteTokenRequest,"AuthClientExecTReq"],[L.AuthClientCreateTokenRequestBody,"AuthClientCreateTReqBody"],[L.AuthClientCreateQueryString,"AuthClientCreateQueryStr"],[L.PopTokenGenerateCnf,"PopTGenCnf"],[L.PopTokenGenerateKid,"PopTGenKid"],[L.HandleServerTokenResponse,"HandleServerTRes"],[L.DeserializeResponse,"DeserializeRes"],[L.AuthorityFactoryCreateDiscoveredInstance,"AuthFactCreateDiscInst"],[L.AuthorityResolveEndpointsAsync,"AuthResolveEndpointsAsync"],[L.AuthorityResolveEndpointsFromLocalSources,"AuthResolveEndpointsFromLocal"],[L.AuthorityGetCloudDiscoveryMetadataFromNetwork,"AuthGetCDMetaFromNet"],[L.AuthorityUpdateCloudDiscoveryMetadata,"AuthUpdCDMeta"],[L.AuthorityGetEndpointMetadataFromNetwork,"AuthUpdCDMetaFromNet"],[L.AuthorityUpdateEndpointMetadata,"AuthUpdEndpointMeta"],[L.AuthorityUpdateMetadataWithRegionalInformation,"AuthUpdMetaWithRegInfo"],[L.RegionDiscoveryDetectRegion,"RegDiscDetectReg"],[L.RegionDiscoveryGetRegionFromIMDS,"RegDiscGetRegFromIMDS"],[L.RegionDiscoveryGetCurrentVersion,"RegDiscGetCurrentVer"],[L.AcquireTokenByCodeAsync,"ATByCodeAsync"],[L.GetEndpointMetadataFromNetwork,"GetEndpointMetaFromNet"],[L.GetCloudDiscoveryMetadataFromNetworkMeasurement,"GetCDMetaFromNet"],[L.HandleRedirectPromiseMeasurement,"HandleRedirectPromise"],[L.HandleNativeRedirectPromiseMeasurement,"HandleNtvRedirectPromise"],[L.UpdateCloudDiscoveryMetadataMeasurement,"UpdateCDMeta"],[L.UsernamePasswordClientAcquireToken,"UserPassClientAT"],[L.NativeMessageHandlerHandshake,"NtvMsgHandlerHandshake"],[L.NativeGenerateAuthResult,"NtvGenAuthRes"],[L.RemoveHiddenIframe,"RemoveHiddenIframe"],[L.ClearTokensAndKeysWithClaims,"ClearTAndKeysWithClaims"],[L.CacheManagerGetRefreshToken,"CacheManagerGetRT"],[L.GeneratePkceCodes,"GenPkceCodes"],[L.GenerateCodeVerifier,"GenCodeVerifier"],[L.GenerateCodeChallengeFromVerifier,"GenCodeChallengeFromVerifier"],[L.Sha256Digest,"Sha256Digest"],[L.GetRandomValues,"GetRandomValues"]]),F1={InProgress:1,Completed:2},qae=new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","queuedTimeMs","startTimeMs","status","multiMatchedAT","multiMatchedID","multiMatchedRT"]);/*! @azure/msal-common v14.15.0 2024-09-20 */const Wl=(n,e,t,r,i)=>(...a)=>{t.trace(`Executing function ${e}`);const o=r==null?void 0:r.startMeasurement(e,i);if(i){const s=e+"CallCount";r==null||r.incrementFields({[s]:1},i)}try{const s=n(...a);return o==null||o.end({success:!0}),t.trace(`Returning result from ${e}`),s}catch(s){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(s))}catch{t.trace("Unable to print error message.")}throw o==null||o.end({success:!1},s),s}},Be=(n,e,t,r,i)=>(...a)=>{t.trace(`Executing function ${e}`);const o=r==null?void 0:r.startMeasurement(e,i);if(i){const s=e+"CallCount";r==null||r.incrementFields({[s]:1},i)}return r==null||r.setPreQueueTime(e,i),n(...a).then(s=>(t.trace(`Returning result from ${e}`),o==null||o.end({success:!0}),s)).catch(s=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(s))}catch{t.trace("Unable to print error message.")}throw o==null||o.end({success:!1},s),s})};/*! @azure/msal-common v14.15.0 2024-09-20 */class Ky{constructor(e,t,r,i){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=i}async detectRegion(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(L.RegionDiscoveryDetectRegion,this.correlationId);let r=e;if(r)t.region_source=yu.ENVIRONMENT_VARIABLE;else{const a=Ky.IMDS_OPTIONS;try{const o=await Be(this.getRegionFromIMDS.bind(this),L.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(se.IMDS_VERSION,a);if(o.status===tg.httpSuccess&&(r=o.body,t.region_source=yu.IMDS),o.status===tg.httpBadRequest){const s=await Be(this.getCurrentVersion.bind(this),L.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(a);if(!s)return t.region_source=yu.FAILED_AUTO_DETECTION,null;const c=await Be(this.getRegionFromIMDS.bind(this),L.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(s,a);c.status===tg.httpSuccess&&(r=c.body,t.region_source=yu.IMDS)}}catch{return t.region_source=yu.FAILED_AUTO_DETECTION,null}}return r||(t.region_source=yu.FAILED_AUTO_DETECTION),r||null}async getRegionFromIMDS(e,t){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(L.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${se.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,se.IMDS_TIMEOUT)}async getCurrentVersion(e){var t;(t=this.performanceClient)==null||t.addQueueMeasurement(L.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const r=await this.networkInterface.sendGetRequestAsync(`${se.IMDS_ENDPOINT}?format=json`,e);return r.status===tg.httpBadRequest&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}}}Ky.IMDS_OPTIONS={headers:{Metadata:"true"}};/*! @azure/msal-common v14.15.0 2024-09-20 */class wr{constructor(e,t,r,i,a,o,s,c){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=i,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=a,this.performanceClient=s,this.correlationId=o,this.managedIdentity=c||!1,this.regionDiscovery=new Ky(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(se.CIAM_AUTH_URL))return oa.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case se.ADFS:return oa.Adfs;case se.DSTS:return oa.Dsts}return oa.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new Pt(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw Ne(Ao)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw Ne(Ao)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw Ne(Ao)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw Ne(fj);return this.replacePath(this.metadata.end_session_endpoint)}else throw Ne(Ao)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw Ne(Ao)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw Ne(Ao)}canReplaceTenant(e){return e.PathSegments.length===1&&!wr.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===oa.Default&&this.protocolMode===Po.AAD}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const i=new Pt(this.metadata.canonical_authority).getUrlComponents(),a=i.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((s,c)=>{let u=a[c];if(c===0&&this.canReplaceTenant(i)){const h=new Pt(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];u!==h&&(this.logger.verbose(`Replacing tenant domain name ${u} with id ${h}`),u=h)}s!==u&&(t=t.replace(`/${u}/`,`/${s}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===oa.Adfs||this.protocolMode!==Po.AAD&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){var i,a;(i=this.performanceClient)==null||i.addQueueMeasurement(L.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await Be(this.updateCloudDiscoveryMetadata.bind(this),L.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const r=await Be(this.updateEndpointMetadata.bind(this),L.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),(a=this.performanceClient)==null||a.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:pR(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==fi.CACHE&&(r==null?void 0:r.source)!==fi.CACHE&&(e.expiresAt=pR(),e.canonical_authority=this.canonicalAuthority);const i=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(i,e),this.metadata=e}async updateEndpointMetadata(e){var i,a,o;(i=this.performanceClient)==null||i.addQueueMeasurement(L.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===fi.HARDCODED_VALUES&&(a=this.authorityOptions.azureRegionConfiguration)!=null&&a.azureRegion&&t.metadata){const s=await Be(this.updateMetadataWithRegionalInformation.bind(this),L.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);ng(e,s,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let r=await Be(this.getEndpointMetadataFromNetwork.bind(this),L.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return(o=this.authorityOptions.azureRegionConfiguration)!=null&&o.azureRegion&&(r=await Be(this.updateMetadataWithRegionalInformation.bind(this),L.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(r)),ng(e,r,!0),fi.NETWORK;throw Ne(ej,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),ng(e,t,!1),{source:fi.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const i=this.getEndpointMetadataFromHardcodedValues();if(i)return ng(e,i,!1),{source:fi.HARDCODED_VALUES,metadata:i};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const r=mR(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!r?(this.logger.verbose("Found endpoint metadata in the cache."),{source:fi.CACHE}):(r&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new Pt(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw tn(Ij)}return null}async getEndpointMetadataFromNetwork(){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(L.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const i=await this.networkInterface.sendGetRequestAsync(t,e);return zae(i.body)?i.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(i){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${i}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in gR?gR[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){var r,i,a;(r=this.performanceClient)==null||r.addQueueMeasurement(L.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=(i=this.authorityOptions.azureRegionConfiguration)==null?void 0:i.azureRegion;if(t){if(t!==se.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=$S.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,wr.replaceWithRegionalInformation(e,t);const o=await Be(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),L.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)((a=this.authorityOptions.azureRegionConfiguration)==null?void 0:a.environmentRegion,this.regionDiscoveryMetadata);if(o)return this.regionDiscoveryMetadata.region_outcome=$S.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=o,wr.replaceWithRegionalInformation(e,o);this.regionDiscoveryMetadata.region_outcome=$S.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(L.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const r=await Be(this.getCloudDiscoveryMetadataFromNetwork.bind(this),L.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return zS(e,r,!0),fi.NETWORK;throw tn(Aj)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||se.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||se.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||se.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),zS(e,t,!1),fi.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const i=Wie(this.hostnameAndPort);if(i)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),zS(e,i,!1),fi.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const r=mR(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!r?(this.logger.verbose("Found cloud discovery metadata in the cache."),fi.CACHE):(r&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===oa.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),wr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=eb(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),tn(SA)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),wr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(L.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${se.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let r=null;try{const a=await this.networkInterface.sendGetRequestAsync(e,t);let o,s;if(Vae(a.body))o=a.body,s=o.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${o.tenant_discovery_endpoint}`);else if(Gae(a.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${a.status}`),o=a.body,o.error===se.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${o.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${o.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),s=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=eb(s,this.hostnameAndPort)}catch(a){if(a instanceof Mt)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${a.errorCode}
Error Description: ${a.errorMessage}`);else{const o=a;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${o.name}
Error Description: ${o.message}`)}return null}return r||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),r=wr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&Pt.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==Ip.None){const i=t.tenant?t.tenant:se.DEFAULT_COMMON_TENANT;r=`${t.azureCloudInstance}/${i}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return se.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw Ne(Ao)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return Oj.has(e)}static isPublicCloudAuthority(e){return se.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){const i=new Pt(e);i.validateAsUri();const a=i.getUrlComponents();let o=`${t}.${a.HostNameAndPort}`;this.isPublicCloudAuthority(a.HostNameAndPort)&&(o=`${t}.${se.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const s=Pt.constructAuthorityUriFromObject({...i.getUrlComponents(),HostNameAndPort:o}).urlString;return r?`${s}?${r}`:s}static replaceWithRegionalInformation(e,t){const r={...e};return r.authorization_endpoint=wr.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=wr.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=wr.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e;const i=new Pt(e).getUrlComponents();if(i.PathSegments.length===0&&i.HostNameAndPort.endsWith(se.CIAM_AUTH_URL)){const a=i.HostNameAndPort.split(".")[0];t=`${t}${a}${se.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}wr.reservedTenantDomains=new Set(["{tenant}","{tenantid}",Fs.COMMON,Fs.CONSUMERS,Fs.ORGANIZATIONS]);function Wae(n){var i;const r=(i=new Pt(n).getUrlComponents().PathSegments.slice(-1)[0])==null?void 0:i.toLowerCase();switch(r){case Fs.COMMON:case Fs.ORGANIZATIONS:case Fs.CONSUMERS:return;default:return r}}function jj(n){return n.endsWith(se.FORWARD_SLASH)?n:`${n}${se.FORWARD_SLASH}`}function Yae(n){const e=n.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw tn(SA)}return{canonicalAuthority:n.authority?jj(n.authority):void 0,knownAuthorities:n.knownAuthorities,cloudDiscoveryMetadata:t}}/*! @azure/msal-common v14.15.0 2024-09-20 */async function Uj(n,e,t,r,i,a,o){o==null||o.addQueueMeasurement(L.AuthorityFactoryCreateDiscoveredInstance,a);const s=wr.transformCIAMAuthority(jj(n)),c=new wr(s,e,t,r,i,a,o);try{return await Be(c.resolveEndpointsAsync.bind(c),L.AuthorityResolveEndpointsAsync,i,o,a)(),c}catch{throw Ne(Ao)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class AA{constructor(e,t){this.config=rae(e),this.logger=new Ca(this.config.loggerOptions,pj,vA),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new aae(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[Qa.CONTENT_TYPE]=se.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Ci.HOME_ACCOUNT_ID:try{const r=Qu(e.credential);t[Qa.CCS_HEADER]=`Oid:${r.uid}@${r.utid}`}catch(r){this.logger.verbose("Could not parse home account ID for CCS Header: "+r)}break;case Ci.UPN:t[Qa.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,r,i,a,o){var c,u,h,f;o&&((c=this.performanceClient)==null||c.addQueueMeasurement(o,a));const s=await this.networkManager.sendPostRequest(i,e,{body:t,headers:r});return(f=this.performanceClient)==null||f.addFields({refreshTokenSize:((u=s.body.refresh_token)==null?void 0:u.length)||0,httpVerToken:((h=s.headers)==null?void 0:h[Qa.X_MS_HTTP_VERSION])||""},a),this.config.serverTelemetryManager&&s.status<500&&s.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),s}async updateAuthority(e,t){var a;(a=this.performanceClient)==null||a.addQueueMeasurement(L.UpdateTokenEndpointAuthority,t);const r=`https://${e}/${this.authority.tenant}/`,i=await Uj(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=i}createTokenQueryParameters(e){const t=new Vf;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()}}/*! @azure/msal-common v14.15.0 2024-09-20 */const tb="no_tokens_found",Fj="native_account_unavailable",kA="refresh_token_expired",Qae="interaction_required",Jae="consent_required",Zae="login_required",qy="bad_token";/*! @azure/msal-common v14.15.0 2024-09-20 */const wR=[Qae,Jae,Zae,qy],Xae=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],eoe={[tb]:"No refresh token found in the cache. Please sign-in.",[Fj]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[kA]:"Refresh token has expired.",[qy]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class Gr extends Mt{constructor(e,t,r,i,a,o,s,c){super(e,t,r),Object.setPrototypeOf(this,Gr.prototype),this.timestamp=i||se.EMPTY_STRING,this.traceId=a||se.EMPTY_STRING,this.correlationId=o||se.EMPTY_STRING,this.claims=s||se.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=c}}function ER(n,e,t){const r=!!n&&wR.indexOf(n)>-1,i=!!t&&Xae.indexOf(t)>-1,a=!!e&&wR.some(o=>e.indexOf(o)>-1);return r||a||i}function B1(n){return new Gr(n,eoe[n])}/*! @azure/msal-common v14.15.0 2024-09-20 */class va{static setRequestState(e,t,r){const i=va.generateLibraryState(e,r);return t?`${i}${se.RESOURCE_DELIM}${t}`:i}static generateLibraryState(e,t){if(!e)throw Ne(L1);const r={id:e.createNewGuid()};t&&(r.meta=t);const i=JSON.stringify(r);return e.base64Encode(i)}static parseRequestState(e,t){if(!e)throw Ne(L1);if(!t)throw Ne($d);try{const r=t.split(se.RESOURCE_DELIM),i=r[0],a=r.length>1?r.slice(1).join(se.RESOURCE_DELIM):se.EMPTY_STRING,o=e.base64Decode(i),s=JSON.parse(o);return{userRequestState:a||se.EMPTY_STRING,libraryState:s}}catch{throw Ne($d)}}}/*! @azure/msal-common v14.15.0 2024-09-20 */const toe={SW:"sw"};class ll{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){var a;(a=this.performanceClient)==null||a.addQueueMeasurement(L.PopTokenGenerateCnf,e.correlationId);const r=await Be(this.generateKid.bind(this),L.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),i=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:i}}async generateKid(e){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(L.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:toe.SW}}async signPopToken(e,t,r){return this.signPayload(e,t,r)}async signPayload(e,t,r,i){const{resourceRequestMethod:a,resourceRequestUri:o,shrClaims:s,shrNonce:c,shrOptions:u}=r,h=o?new Pt(o):void 0,f=h==null?void 0:h.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:so(),m:a==null?void 0:a.toUpperCase(),u:f==null?void 0:f.HostNameAndPort,nonce:c||this.cryptoUtils.createNewGuid(),p:f==null?void 0:f.AbsolutePath,q:f!=null&&f.QueryString?[[],f.QueryString]:void 0,client_claims:s||void 0,...i},t,u,r.correlationId)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class noe{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}/*! @azure/msal-common v14.15.0 2024-09-20 */function roe(n){var r,i;const e="code=",t=(r=n.error_uri)==null?void 0:r.lastIndexOf(e);return t&&t>=0?(i=n.error_uri)==null?void 0:i.substring(t+e.length):void 0}class ul{constructor(e,t,r,i,a,o,s){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=i,this.serializableCache=a,this.persistencePlugin=o,this.performanceClient=s}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw e.state?Ne(Yv,"Cached State"):Ne(Yv,"Server State");let r,i;try{r=decodeURIComponent(e.state)}catch{throw Ne($d,e.state)}try{i=decodeURIComponent(t)}catch{throw Ne($d,e.state)}if(r!==i)throw Ne(nj);if(e.error||e.error_description||e.suberror){const a=roe(e);throw ER(e.error,e.error_description,e.suberror)?new Gr(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",a):new co(e.error||"",e.error_description,e.suberror,a)}}validateTokenResponse(e,t){var r;if(e.error||e.error_description||e.suberror){const i=`Error(s): ${e.error_codes||se.NOT_AVAILABLE} - Timestamp: ${e.timestamp||se.NOT_AVAILABLE} - Description: ${e.error_description||se.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||se.NOT_AVAILABLE} - Trace ID: ${e.trace_id||se.NOT_AVAILABLE}`,a=(r=e.error_codes)!=null&&r.length?e.error_codes[0]:void 0,o=new co(e.error,i,e.suberror,a,e.status);if(t&&e.status&&e.status>=Zm.SERVER_ERROR_RANGE_START&&e.status<=Zm.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${o}`);return}else if(t&&e.status&&e.status>=Zm.CLIENT_ERROR_RANGE_START&&e.status<=Zm.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${o}`);return}throw ER(e.error,e.error_description,e.suberror)?new Gr(e.error,e.error_description,e.suberror,e.timestamp||se.EMPTY_STRING,e.trace_id||se.EMPTY_STRING,e.correlation_id||se.EMPTY_STRING,e.claims||se.EMPTY_STRING,a):o}}async handleServerTokenResponse(e,t,r,i,a,o,s,c,u){var v;(v=this.performanceClient)==null||v.addQueueMeasurement(L.HandleServerTokenResponse,e.correlation_id);let h;if(e.id_token){if(h=ql(e.id_token||se.EMPTY_STRING,this.cryptoObj.base64Decode),a&&a.nonce&&h.nonce!==a.nonce)throw Ne(rj);if(i.maxAge||i.maxAge===0){const y=h.auth_time;if(!y)throw Ne(fA);mj(y,i.maxAge)}}this.homeAccountIdentifier=Xn.generateHomeAccountId(e.client_info||se.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,h);let f;a&&a.state&&(f=va.parseRequestState(this.cryptoObj,a.state)),e.key_id=e.key_id||i.sshKid||void 0;const p=this.generateCacheRecord(e,t,r,i,h,o,a);let g;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),g=new noe(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(g)),s&&!c&&p.account){const y=p.account.generateAccountKey();if(!this.cacheStorage.getAccount(y,this.logger))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await ul.generateAuthenticationResult(this.cryptoObj,t,p,!1,i,h,f,void 0,u)}await this.cacheStorage.saveCacheRecord(p,i.storeInCache,i.correlationId)}finally{this.persistencePlugin&&this.serializableCache&&g&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(g))}return ul.generateAuthenticationResult(this.cryptoObj,t,p,!1,i,h,f,e,u)}generateCacheRecord(e,t,r,i,a,o,s){const c=t.getPreferredCache();if(!c)throw Ne(mA);const u=Rj(a);let h,f;e.id_token&&a&&(h=$y(this.homeAccountIdentifier,c,e.id_token,this.clientId,u||""),f=xA(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,a,e.client_info,c,u,s,void 0,this.logger));let p=null;if(e.access_token){const y=e.scope?Un.fromString(e.scope):new Un(i.scopes||[]),b=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,C=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,S=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,E=r+b,T=E+C,A=S&&S>0?r+S:void 0;p=zy(this.homeAccountIdentifier,c,e.access_token,this.clientId,u||t.tenant||"",y.printScopes(),E,T,this.cryptoObj.base64Decode,A,e.token_type,o,e.key_id,i.claims,i.requestedClaimsHash)}let g=null;if(e.refresh_token){let y;if(e.refresh_token_expires_in){const b=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;y=r+b}g=gj(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,o,y)}let v=null;return e.foci&&(v={clientId:this.clientId,environment:c,familyId:e.foci}),{account:f,idToken:h,accessToken:p,refreshToken:g,appMetadata:v}}static async generateAuthenticationResult(e,t,r,i,a,o,s,c,u){var E,T,A,I,k;let h=se.EMPTY_STRING,f=[],p=null,g,v,y=se.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType===Wt.POP&&!a.popKid){const x=new ll(e),{secret:_,keyId:R}=r.accessToken;if(!R)throw Ne(gA);h=await x.signPopToken(_,R,a)}else h=r.accessToken.secret;f=Un.fromString(r.accessToken.target).asArray(),p=new Date(Number(r.accessToken.expiresOn)*1e3),g=new Date(Number(r.accessToken.extendedExpiresOn)*1e3),r.accessToken.refreshOn&&(v=new Date(Number(r.accessToken.refreshOn)*1e3))}r.appMetadata&&(y=r.appMetadata.familyId===$f?$f:"");const b=(o==null?void 0:o.oid)||(o==null?void 0:o.sub)||"",C=(o==null?void 0:o.tid)||"";c!=null&&c.spa_accountid&&r.account&&(r.account.nativeAccountId=c==null?void 0:c.spa_accountid);const S=r.account?EA(r.account.getAccountInfo(),void 0,o,(E=r.idToken)==null?void 0:E.secret):null;return{authority:t.canonicalAuthority,uniqueId:b,tenantId:C,scopes:f,account:S,idToken:((T=r==null?void 0:r.idToken)==null?void 0:T.secret)||"",idTokenClaims:o||{},accessToken:h,fromCache:i,expiresOn:p,extExpiresOn:g,refreshOn:v,correlationId:a.correlationId,requestId:u||se.EMPTY_STRING,familyId:y,tokenType:((A=r.accessToken)==null?void 0:A.tokenType)||se.EMPTY_STRING,state:s?s.userRequestState:se.EMPTY_STRING,cloudGraphHostName:((I=r.account)==null?void 0:I.cloudGraphHostName)||se.EMPTY_STRING,msGraphHost:((k=r.account)==null?void 0:k.msGraphHost)||se.EMPTY_STRING,code:c==null?void 0:c.spa_code,fromNativeBroker:!1}}}function xA(n,e,t,r,i,a,o,s,c,u,h){h==null||h.verbose("setCachedAccount called");const p=n.getAccountKeys().find(C=>C.startsWith(t));let g=null;p&&(g=n.getAccount(p,h));const v=g||Xn.createAccount({homeAccountId:t,idTokenClaims:i,clientInfo:a,environment:o,cloudGraphHostName:c==null?void 0:c.cloud_graph_host_name,msGraphHost:c==null?void 0:c.msgraph_host,nativeAccountId:u},e,r),y=v.tenantProfiles||[],b=s||v.realm;if(b&&!y.find(C=>C.tenantId===b)){const C=wA(t,v.localAccountId,b,i);y.push(C)}return v.tenantProfiles=y,v}/*! @azure/msal-common v14.15.0 2024-09-20 */async function Bj(n,e,t){return typeof n=="string"?n:n({clientId:e,tokenEndpoint:t})}/*! @azure/msal-common v14.15.0 2024-09-20 */class Hj extends AA{constructor(e,t){var r;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=(r=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:r.defaultScopes}async getAuthCodeUrl(e){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(L.GetAuthCodeUrl,e.correlationId);const t=await Be(this.createAuthCodeUrlQueryString.bind(this),L.AuthClientCreateQueryString,this.logger,this.performanceClient,e.correlationId)(e);return Pt.appendQueryString(this.authority.authorizationEndpoint,t)}async acquireToken(e,t){var s,c;if((s=this.performanceClient)==null||s.addQueueMeasurement(L.AuthClientAcquireToken,e.correlationId),!e.code)throw Ne(oj);const r=so(),i=await Be(this.executeTokenRequest.bind(this),L.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),a=(c=i.headers)==null?void 0:c[Qa.X_MS_REQUEST_ID],o=new ul(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return o.validateTokenResponse(i.body),Be(o.handleServerTokenResponse.bind(o),L.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(i.body,this.authority,r,e,t,void 0,void 0,void 0,a)}handleFragmentResponse(e,t){if(new ul(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw Ne(dj);return e}getLogoutUri(e){if(!e)throw tn(Ej);const t=this.createLogoutUrlQueryString(e);return Pt.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){var u,h;(u=this.performanceClient)==null||u.addQueueMeasurement(L.AuthClientExecuteTokenRequest,t.correlationId);const r=this.createTokenQueryParameters(t),i=Pt.appendQueryString(e.tokenEndpoint,r),a=await Be(this.createTokenRequestBody.bind(this),L.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let o;if(t.clientInfo)try{const f=Jv(t.clientInfo,this.cryptoUtils.base64Decode);o={credential:`${f.uid}${Tr.CLIENT_INFO_SEPARATOR}${f.utid}`,type:Ci.HOME_ACCOUNT_ID}}catch(f){this.logger.verbose("Could not parse client info for CCS Header: "+f)}const s=this.createTokenRequestHeaders(o||t.ccsCredential),c={clientId:((h=t.tokenBodyParameters)==null?void 0:h.clientId)||this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return Be(this.executePostToTokenEndpoint.bind(this),L.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(i,a,s,c,t.correlationId,L.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var a,o;(a=this.performanceClient)==null||a.addQueueMeasurement(L.AuthClientCreateTokenRequestBody,e.correlationId);const t=new Vf;if(t.addClientId(((o=e.tokenBodyParameters)==null?void 0:o[Vd])||this.config.authOptions.clientId),this.includeRedirectUri?t.addRedirectUri(e.redirectUri):ju.validateRedirectUri(e.redirectUri),t.addScopes(e.scopes,!0,this.oidcDefaultScopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addThrottling(),this.serverTelemetryManager&&!U1(this.config)&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&t.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const s=this.config.clientCredentials.clientAssertion;t.addClientAssertion(await Bj(s.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),t.addClientAssertionType(s.assertionType)}if(t.addGrantType(Y4.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),e.authenticationScheme===Wt.POP){const s=new ll(this.cryptoUtils,this.performanceClient);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await Be(s.generateCnf.bind(s),L.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,t.addPopToken(c)}else if(e.authenticationScheme===Wt.SSH)if(e.sshJwk)t.addSshJwk(e.sshJwk);else throw tn(Vy);const r=e.correlationId||this.config.cryptoInterface.createNewGuid();t.addCorrelationId(r),(!ga.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities);let i;if(e.clientInfo)try{const s=Jv(e.clientInfo,this.cryptoUtils.base64Decode);i={credential:`${s.uid}${Tr.CLIENT_INFO_SEPARATOR}${s.utid}`,type:Ci.HOME_ACCOUNT_ID}}catch(s){this.logger.verbose("Could not parse client info for CCS Header: "+s)}else i=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&i)switch(i.type){case Ci.HOME_ACCOUNT_ID:try{const s=Qu(i.credential);t.addCcsOid(s)}catch(s){this.logger.verbose("Could not parse home account ID for CCS Header: "+s)}break;case Ci.UPN:t.addCcsUpn(i.credential);break}return e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[SR])&&t.addExtraQueryParameters({[SR]:"1"}),t.createQueryString()}async createAuthCodeUrlQueryString(e){var a,o;(a=this.performanceClient)==null||a.addQueueMeasurement(L.AuthClientCreateQueryString,e.correlationId);const t=new Vf;t.addClientId(((o=e.extraQueryParameters)==null?void 0:o[Vd])||this.config.authOptions.clientId);const r=[...e.scopes||[],...e.extraScopesToConsent||[]];t.addScopes(r,!0,this.oidcDefaultScopes),t.addRedirectUri(e.redirectUri);const i=e.correlationId||this.config.cryptoInterface.createNewGuid();if(t.addCorrelationId(i),t.addResponseMode(e.responseMode),t.addResponseTypeCode(),t.addLibraryInfo(this.config.libraryInfo),U1(this.config)||t.addApplicationTelemetry(this.config.telemetry.application),t.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&t.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&t.addPrompt(e.prompt),e.domainHint&&t.addDomainHint(e.domainHint),e.prompt!==lr.SELECT_ACCOUNT)if(e.sid&&e.prompt===lr.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),t.addSid(e.sid);else if(e.account){const s=this.extractAccountSid(e.account);let c=this.extractLoginHint(e.account);if(c&&e.domainHint&&(this.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),c=null),c){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),t.addLoginHint(c);try{const u=Qu(e.account.homeAccountId);t.addCcsOid(u)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(s&&e.prompt===lr.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),t.addSid(s);try{const u=Qu(e.account.homeAccountId);t.addCcsOid(u)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),t.addLoginHint(e.account.username);try{const u=Qu(e.account.homeAccountId);t.addCcsOid(u)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&t.addNonce(e.nonce),e.state&&t.addState(e.state),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.addExtraQueryParams(e,t),e.nativeBroker&&(t.addNativeBroker(),e.authenticationScheme===Wt.POP)){const s=new ll(this.cryptoUtils);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await Be(s.generateCnf.bind(s),L.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,t.addPopToken(c)}return t.createQueryString()}createLogoutUrlQueryString(e){const t=new Vf;return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),this.addExtraQueryParams(e,t),t.createQueryString()}addExtraQueryParams(e,t){!(e.extraQueryParameters&&e.extraQueryParameters.hasOwnProperty("instance_aware"))&&this.config.authOptions.instanceAware&&(e.extraQueryParameters=e.extraQueryParameters||{},e.extraQueryParameters.instance_aware="true"),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters)}extractAccountSid(e){var t;return((t=e.idTokenClaims)==null?void 0:t.sid)||null}extractLoginHint(e){var t;return((t=e.idTokenClaims)==null?void 0:t.login_hint)||null}}/*! @azure/msal-common v14.15.0 2024-09-20 */const ioe=300;class H1 extends AA{constructor(e,t){super(e,t)}async acquireToken(e){var o,s;(o=this.performanceClient)==null||o.addQueueMeasurement(L.RefreshTokenClientAcquireToken,e.correlationId);const t=so(),r=await Be(this.executeTokenRequest.bind(this),L.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),i=(s=r.headers)==null?void 0:s[Qa.X_MS_REQUEST_ID],a=new ul(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return a.validateTokenResponse(r.body),Be(a.handleServerTokenResponse.bind(a),L.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,i)}async acquireTokenByRefreshToken(e){var r;if(!e)throw tn(wj);if((r=this.performanceClient)==null||r.addQueueMeasurement(L.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw Ne(pA);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await Be(this.acquireTokenWithCachedRefreshToken.bind(this),L.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(i){const a=i instanceof Gr&&i.errorCode===tb,o=i instanceof co&&i.errorCode===sR.INVALID_GRANT_ERROR&&i.subError===sR.CLIENT_MISMATCH_ERROR;if(a||o)return Be(this.acquireTokenWithCachedRefreshToken.bind(this),L.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw i}return Be(this.acquireTokenWithCachedRefreshToken.bind(this),L.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){var a;(a=this.performanceClient)==null||a.addQueueMeasurement(L.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const r=Wl(this.cacheManager.getRefreshToken.bind(this.cacheManager),L.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,void 0,this.performanceClient,e.correlationId);if(!r)throw B1(tb);if(r.expiresOn&&j1(r.expiresOn,e.refreshTokenExpirationOffsetSeconds||ioe))throw B1(kA);const i={...e,refreshToken:r.secret,authenticationScheme:e.authenticationScheme||Wt.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Ci.HOME_ACCOUNT_ID}};try{return await Be(this.acquireToken.bind(this),L.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(i)}catch(o){if(o instanceof Gr&&o.subError===qy){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const s=Yu(r);this.cacheManager.removeRefreshToken(s)}throw o}}async executeTokenRequest(e,t){var c,u;(c=this.performanceClient)==null||c.addQueueMeasurement(L.RefreshTokenClientExecuteTokenRequest,e.correlationId);const r=this.createTokenQueryParameters(e),i=Pt.appendQueryString(t.tokenEndpoint,r),a=await Be(this.createTokenRequestBody.bind(this),L.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),o=this.createTokenRequestHeaders(e.ccsCredential),s={clientId:((u=e.tokenBodyParameters)==null?void 0:u.clientId)||this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return Be(this.executePostToTokenEndpoint.bind(this),L.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(i,a,o,s,e.correlationId,L.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var i,a,o;(i=this.performanceClient)==null||i.addQueueMeasurement(L.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=e.correlationId,r=new Vf;if(r.addClientId(((a=e.tokenBodyParameters)==null?void 0:a[Vd])||this.config.authOptions.clientId),e.redirectUri&&r.addRedirectUri(e.redirectUri),r.addScopes(e.scopes,!0,(o=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:o.defaultScopes),r.addGrantType(Y4.REFRESH_TOKEN_GRANT),r.addClientInfo(),r.addLibraryInfo(this.config.libraryInfo),r.addApplicationTelemetry(this.config.telemetry.application),r.addThrottling(),this.serverTelemetryManager&&!U1(this.config)&&r.addServerTelemetry(this.serverTelemetryManager),r.addCorrelationId(t),r.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&r.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const s=this.config.clientCredentials.clientAssertion;r.addClientAssertion(await Bj(s.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),r.addClientAssertionType(s.assertionType)}if(e.authenticationScheme===Wt.POP){const s=new ll(this.cryptoUtils,this.performanceClient);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await Be(s.generateCnf.bind(s),L.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,r.addPopToken(c)}else if(e.authenticationScheme===Wt.SSH)if(e.sshJwk)r.addSshJwk(e.sshJwk);else throw tn(Vy);if((!ga.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Ci.HOME_ACCOUNT_ID:try{const s=Qu(e.ccsCredential.credential);r.addCcsOid(s)}catch(s){this.logger.verbose("Could not parse home account ID for CCS Header: "+s)}break;case Ci.UPN:r.addCcsUpn(e.ccsCredential.credential);break}return e.tokenBodyParameters&&r.addExtraQueryParameters(e.tokenBodyParameters),r.createQueryString()}}/*! @azure/msal-common v14.15.0 2024-09-20 */class aoe extends AA{constructor(e,t){super(e,t)}async acquireToken(e){var t;try{const[r,i]=await this.acquireCachedToken({...e,scopes:(t=e.scopes)!=null&&t.length?e.scopes:[...Gs]});return i===Ss.PROACTIVELY_REFRESHED&&(this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new H1(this.config,this.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),r}catch(r){if(r instanceof dh&&r.errorCode===Ja)return new H1(this.config,this.performanceClient).acquireTokenByRefreshToken(e);throw r}}async acquireCachedToken(e){var c;(c=this.performanceClient)==null||c.addQueueMeasurement(L.SilentFlowClientAcquireCachedToken,e.correlationId);let t=Ss.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!ga.isEmptyObj(e.claims))throw this.setCacheOutcome(Ss.FORCE_REFRESH_OR_CLAIMS,e.correlationId),Ne(Ja);if(!e.account)throw Ne(pA);const r=e.account.tenantId||Wae(e.authority),i=this.cacheManager.getTokenKeys(),a=this.cacheManager.getAccessToken(e.account,e,i,r,this.performanceClient,e.correlationId);if(a){if(Pie(a.cachedAt)||j1(a.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(Ss.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),Ne(Ja);a.refreshOn&&j1(a.refreshOn,0)&&(t=Ss.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(Ss.NO_CACHED_ACCESS_TOKEN,e.correlationId),Ne(Ja);const o=e.authority||this.authority.getPreferredCache(),s={account:this.cacheManager.readAccountFromCache(e.account),accessToken:a,idToken:this.cacheManager.getIdToken(e.account,i,r,this.performanceClient,e.correlationId),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(o)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await Be(this.generateResultFromCacheRecord.bind(this),L.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(s,e),t]}setCacheOutcome(e,t){var r,i;(r=this.serverTelemetryManager)==null||r.setCacheOutcome(e),(i=this.performanceClient)==null||i.addFields({cacheOutcome:e},t),e!==Ss.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(L.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let r;if(e.idToken&&(r=ql(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const a=r==null?void 0:r.auth_time;if(!a)throw Ne(fA);mj(a,t.maxAge)}return ul.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)}}/*! @azure/msal-common v14.15.0 2024-09-20 */const ooe={sendGetRequestAsync:()=>Promise.reject(Ne(wt)),sendPostRequestAsync:()=>Promise.reject(Ne(wt))};/*! @azure/msal-common v14.15.0 2024-09-20 */const TR=",",$j="|";function soe(n){const{skus:e,libraryName:t,libraryVersion:r,extensionName:i,extensionVersion:a}=n,o=new Map([[0,[t,r]],[2,[i,a]]]);let s=[];if(e!=null&&e.length){if(s=e.split(TR),s.length<4)return e}else s=Array.from({length:4},()=>$j);return o.forEach((c,u)=>{var h,f;c.length===2&&((h=c[0])!=null&&h.length)&&((f=c[1])!=null&&f.length)&&coe({skuArr:s,index:u,skuName:c[0],skuVersion:c[1]})}),s.join(TR)}function coe(n){const{skuArr:e,index:t,skuName:r,skuVersion:i}=n;t>=e.length||(e[t]=[r,i].join($j))}class Ap{constructor(e,t){this.cacheOutcome=Ss.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||se.EMPTY_STRING,this.wrapperVer=e.wrapperVer||se.EMPTY_STRING,this.telemetryCacheKey=gr.CACHE_KEY+Tr.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${gr.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r!=null&&r.length&&t.push(`broker_error=${r}`);const i=t.join(gr.VALUE_SEPARATOR),a=this.getRegionDiscoveryFields(),o=[e,a].join(gr.VALUE_SEPARATOR);return[gr.SCHEMA_VERSION,o,i].join(gr.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Ap.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(gr.VALUE_SEPARATOR),i=e.errors.slice(0,t).join(gr.VALUE_SEPARATOR),a=e.errors.length,o=t<a?gr.OVERFLOW_TRUE:gr.OVERFLOW_FALSE,s=[a,o].join(gr.VALUE_SEPARATOR);return[gr.SCHEMA_VERSION,e.cacheHits,r,i,s].join(gr.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=gr.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof Mt?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(gr.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=Ap.maxErrorsToSend(e),r=e.errors.length;if(t===r)this.cacheManager.removeItem(this.telemetryCacheKey);else{const i={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,i)}}static maxErrorsToSend(e){let t,r=0,i=0;const a=e.errors.length;for(t=0;t<a;t++){const o=e.failedRequests[2*t]||se.EMPTY_STRING,s=e.failedRequests[2*t+1]||se.EMPTY_STRING,c=e.errors[t]||se.EMPTY_STRING;if(i+=o.toString().length+s.toString().length+c.length+3,i<gr.MAX_LAST_HEADER_BYTES)r+=1;else break}return r}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||se.EMPTY_STRING),e.push(this.regionSource||se.EMPTY_STRING),e.push(this.regionOutcome||se.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e)}static makeExtraSkuString(e){return soe(e)}}/*! @azure/msal-common v14.15.0 2024-09-20 */const zj="missing_kid_error",Vj="missing_alg_error";/*! @azure/msal-common v14.15.0 2024-09-20 */const loe={[zj]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[Vj]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class _A extends Mt{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,_A.prototype)}}function IR(n){return new _A(n,loe[n])}/*! @azure/msal-common v14.15.0 2024-09-20 */class MA{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw IR(zj);if(!e.alg)throw IR(Vj);const t=new MA({typ:e.typ||gie.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class $1{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class Gj{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:F1.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new $1}}startPerformanceMeasurement(){return new $1}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}/*! @azure/msal-common v14.15.0 2024-09-20 */function uoe(n,e,t){t&&t.push({name:e.get(n.name)||n.name})}function doe(n,e,t,r){if(!(t!=null&&t.length))return;const i=g=>g.length?g[g.length-1]:void 0,a=e.get(n.name)||n.name,o=i(t);if((o==null?void 0:o.name)!==a)return;const s=t==null?void 0:t.pop();if(!s)return;const c=r instanceof Mt?r.errorCode:r instanceof Error?r.name:void 0,u=r instanceof Mt?r.subError:void 0;c&&s.childErr!==c&&(s.err=c,u&&(s.subErr=u)),delete s.name,delete s.childErr;const h={...s,dur:n.durationMs};n.success||(h.fail=1);const f=i(t);if(!f)return{[a]:h};c&&(f.childErr=c);let p;if(!f[a])p=a;else{const g=Object.keys(f).filter(v=>v.startsWith(a)).length;p=`${a}_${g+1}`}return f[p]=h,f}function hoe(n,e,t,r=5){var i,a;if(n instanceof Error){if(n instanceof Mt){t.errorCode=n.errorCode,t.subErrorCode=n.subError,(n instanceof co||n instanceof Gr)&&(t.serverErrorNo=n.errorNo);return}else if(n instanceof Kc){t.errorCode=n.errorCode;return}else if((i=t.errorStack)!=null&&i.length){e.trace("PerformanceClient.addErrorStack: Stack already exist",t.correlationId);return}else if(!((a=n.stack)!=null&&a.length)){e.trace("PerformanceClient.addErrorStack: Input stack is empty",t.correlationId);return}}else{e.trace("PerformanceClient.addErrorStack: Input error is not instance of Error",t.correlationId);return}n.stack&&(t.errorStack=foe(n.stack,r)),t.errorName=n.name}function foe(n,e){if(e<0)return[];const t=n.split(`
`)||[];if(t.length<2)return[];const r=[];for(let i=Math.max(t.length-e-1,1);i<t.length;i++){const a=t[i];if(r.length>=e)break;r.push(poe(a))}return r}function poe(n){const e=n.lastIndexOf(" ")+1;if(e<1)return n;const t=n.substring(e);let r=t.lastIndexOf("/");return r=r<0?t.lastIndexOf("\\"):r,r>=0?(n.substring(0,e)+"("+t.substring(r+1)+(t.charAt(t.length-1)===")"?"":")")).trimStart():n.trimStart()}class moe{constructor(e,t,r,i,a,o,s,c){this.authority=t,this.libraryName=i,this.libraryVersion=a,this.applicationTelemetry=o,this.clientId=e,this.logger=r,this.callbacks=new Map,this.eventsByCorrelationId=new Map,this.eventStack=new Map,this.queueMeasurements=new Map,this.preQueueTimeByCorrelationId=new Map,this.intFields=s||new Set;for(const u of qae)this.intFields.add(u);this.abbreviations=c||new Map;for(const[u,h]of Kae)this.abbreviations.set(u,h)}startPerformanceMeasurement(e,t){return{}}getPreQueueTime(e,t){const r=this.preQueueTimeByCorrelationId.get(t);if(r){if(r.name!==e){this.logger.trace(`PerformanceClient.getPreQueueTime: no pre-queue time found for ${e}, unable to add queue measurement`);return}}else{this.logger.trace(`PerformanceClient.getPreQueueTime: no pre-queue times found for correlationId: ${t}, unable to add queue measurement`);return}return r.time}calculateQueuedTime(e,t){return e<1?(this.logger.trace(`PerformanceClient: preQueueTime should be a positive integer and not ${e}`),0):t<1?(this.logger.trace(`PerformanceClient: currentTime should be a positive integer and not ${t}`),0):t<e?(this.logger.trace("PerformanceClient: currentTime is less than preQueueTime, check how time is being retrieved"),0):t-e}addQueueMeasurement(e,t,r,i){if(!t){this.logger.trace(`PerformanceClient.addQueueMeasurement: correlationId not provided for ${e}, cannot add queue measurement`);return}if(r===0)this.logger.trace(`PerformanceClient.addQueueMeasurement: queue time provided for ${e} is ${r}`);else if(!r){this.logger.trace(`PerformanceClient.addQueueMeasurement: no queue time provided for ${e}`);return}const a={eventName:e,queueTime:i?0:r,manuallyCompleted:i},o=this.queueMeasurements.get(t);if(o)o.push(a),this.queueMeasurements.set(t,o);else{this.logger.trace(`PerformanceClient.addQueueMeasurement: adding correlationId ${t} to queue measurements`);const s=[a];this.queueMeasurements.set(t,s)}this.preQueueTimeByCorrelationId.delete(t)}startMeasurement(e,t){var a,o;const r=t||this.generateId();t||this.logger.info(`PerformanceClient: No correlation id provided for ${e}, generating`,r),this.logger.trace(`PerformanceClient: Performance measurement started for ${e}`,r);const i={eventId:this.generateId(),status:F1.InProgress,authority:this.authority,libraryName:this.libraryName,libraryVersion:this.libraryVersion,clientId:this.clientId,name:e,startTimeMs:Date.now(),correlationId:r,appName:(a=this.applicationTelemetry)==null?void 0:a.appName,appVersion:(o=this.applicationTelemetry)==null?void 0:o.appVersion};return this.cacheEventByCorrelationId(i),uoe(i,this.abbreviations,this.eventStack.get(r)),{end:(s,c)=>this.endMeasurement({...i,...s},c),discard:()=>this.discardMeasurements(i.correlationId),add:s=>this.addFields(s,i.correlationId),increment:s=>this.incrementFields(s,i.correlationId),event:i,measurement:new $1}}endMeasurement(e,t){var u,h;const r=this.eventsByCorrelationId.get(e.correlationId);if(!r)return this.logger.trace(`PerformanceClient: Measurement not found for ${e.eventId}`,e.correlationId),null;const i=e.eventId===r.eventId;let a={totalQueueTime:0,totalQueueCount:0,manuallyCompletedCount:0};e.durationMs=Math.round(e.durationMs||this.getDurationMs(e.startTimeMs));const o=JSON.stringify(doe(e,this.abbreviations,this.eventStack.get(r.correlationId),t));if(i?(a=this.getQueueInfo(e.correlationId),this.discardMeasurements(r.correlationId)):(u=r.incompleteSubMeasurements)==null||u.delete(e.eventId),this.logger.trace(`PerformanceClient: Performance measurement ended for ${e.name}: ${e.durationMs} ms`,e.correlationId),!i)return r[e.name+"DurationMs"]=Math.floor(e.durationMs),{...r};t&&hoe(t,this.logger,r);let s={...r,...e},c=0;return(h=s.incompleteSubMeasurements)==null||h.forEach(f=>{this.logger.trace(`PerformanceClient: Incomplete submeasurement ${f.name} found for ${e.name}`,s.correlationId),c++}),s.incompleteSubMeasurements=void 0,s={...s,queuedTimeMs:a.totalQueueTime,queuedCount:a.totalQueueCount,queuedManuallyCompletedCount:a.manuallyCompletedCount,status:F1.Completed,incompleteSubsCount:c,context:o},this.truncateIntegralFields(s),this.emitEvents([s],e.correlationId),s}addFields(e,t){this.logger.trace("PerformanceClient: Updating static fields");const r=this.eventsByCorrelationId.get(t);r?this.eventsByCorrelationId.set(t,{...r,...e}):this.logger.trace("PerformanceClient: Event not found for",t)}incrementFields(e,t){this.logger.trace("PerformanceClient: Updating counters");const r=this.eventsByCorrelationId.get(t);if(r)for(const i in e){if(!r.hasOwnProperty(i))r[i]=0;else if(isNaN(Number(r[i])))return;r[i]+=e[i]}else this.logger.trace("PerformanceClient: Event not found for",t)}cacheEventByCorrelationId(e){const t=this.eventsByCorrelationId.get(e.correlationId);t?(this.logger.trace(`PerformanceClient: Performance measurement for ${e.name} added/updated`,e.correlationId),t.incompleteSubMeasurements=t.incompleteSubMeasurements||new Map,t.incompleteSubMeasurements.set(e.eventId,{name:e.name,startTimeMs:e.startTimeMs})):(this.logger.trace(`PerformanceClient: Performance measurement for ${e.name} started`,e.correlationId),this.eventsByCorrelationId.set(e.correlationId,{...e}),this.eventStack.set(e.correlationId,[]))}getQueueInfo(e){const t=this.queueMeasurements.get(e);t||this.logger.trace(`PerformanceClient: no queue measurements found for for correlationId: ${e}`);let r=0,i=0,a=0;return t==null||t.forEach(o=>{r+=o.queueTime,i++,a+=o.manuallyCompleted?1:0}),{totalQueueTime:r,totalQueueCount:i,manuallyCompletedCount:a}}discardMeasurements(e){this.logger.trace("PerformanceClient: Performance measurements discarded",e),this.eventsByCorrelationId.delete(e),this.logger.trace("PerformanceClient: QueueMeasurements discarded",e),this.queueMeasurements.delete(e),this.logger.trace("PerformanceClient: Pre-queue times discarded",e),this.preQueueTimeByCorrelationId.delete(e),this.logger.trace("PerformanceClient: Event stack discarded",e),this.eventStack.delete(e)}addPerformanceCallback(e){for(const[r,i]of this.callbacks)if(i.toString()===e.toString())return this.logger.warning(`PerformanceClient: Performance callback is already registered with id: ${r}`),r;const t=this.generateId();return this.callbacks.set(t,e),this.logger.verbose(`PerformanceClient: Performance callback registered with id: ${t}`),t}removePerformanceCallback(e){const t=this.callbacks.delete(e);return t?this.logger.verbose(`PerformanceClient: Performance callback ${e} removed.`):this.logger.verbose(`PerformanceClient: Performance callback ${e} not removed.`),t}emitEvents(e,t){this.logger.verbose("PerformanceClient: Emitting performance events",t),this.callbacks.forEach((r,i)=>{this.logger.trace(`PerformanceClient: Emitting event to callback ${i}`,t),r.apply(null,[e])})}truncateIntegralFields(e){this.intFields.forEach(t=>{t in e&&typeof e[t]=="number"&&(e[t]=Math.floor(e[t]))})}getDurationMs(e){const t=Date.now()-e;return t<0?t:0}}/*! @azure/msal-browser v3.26.1 2024-10-08 */const RA="pkce_not_created",Kj="crypto_nonexistent",Wy="empty_navigate_uri",qj="hash_empty_error",PA="no_state_in_hash",Wj="hash_does_not_contain_known_properties",Yj="unable_to_parse_state",Qj="state_interaction_type_mismatch",Jj="interaction_in_progress",Zj="popup_window_error",Xj="empty_window_error",dl="user_cancelled",goe="monitor_popup_timeout",e6="monitor_window_timeout",t6="redirect_in_iframe",n6="block_iframe_reload",r6="block_nested_popups",voe="iframe_closed_prematurely",Yy="silent_logout_unsupported",i6="no_account_error",boe="silent_prompt_value_error",a6="no_token_request_cache_error",o6="unable_to_parse_token_request_cache_error",NA="no_cached_authority_error",yoe="auth_request_not_set_error",Coe="invalid_cache_type",OA="non_browser_environment",Uu="database_not_open",nb="no_network_connectivity",s6="post_request_failed",c6="get_request_failed",z1="failed_to_parse_response",l6="unable_to_load_token",LA="crypto_key_not_found",u6="auth_code_required",d6="auth_code_or_nativeAccountId_required",h6="spa_code_and_nativeAccountId_present",DA="database_unavailable",f6="unable_to_acquire_token_from_native_platform",p6="native_handshake_timeout",m6="native_extension_not_installed",um="native_connection_not_established",g6="uninitialized_public_client_application",v6="native_prompt_not_supported",b6="invalid_base64_string",y6="invalid_pop_token_request";/*! @azure/msal-browser v3.26.1 2024-10-08 */const wo="For more visit: aka.ms/msaljs/browser-errors",Soe={[RA]:"The PKCE code challenge and verifier could not be generated.",[Kj]:"The crypto object or function is not available.",[Wy]:"Navigation URI is empty. Please check stack trace for more info.",[qj]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${wo}`,[PA]:"Hash does not contain state. Please verify that the request originated from msal.",[Wj]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${wo}`,[Yj]:"Unable to parse state. Please verify that the request originated from msal.",[Qj]:"Hash contains state but the interaction type does not match the caller.",[Jj]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${wo}`,[Zj]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[Xj]:"window.open returned null or undefined window object.",[dl]:"User cancelled the flow.",[goe]:`Token acquisition in popup failed due to timeout.  ${wo}`,[e6]:`Token acquisition in iframe failed due to timeout.  ${wo}`,[t6]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[n6]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${wo}`,[r6]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[voe]:"The iframe being monitored was closed prematurely.",[Yy]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[i6]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[boe]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[a6]:"No token request found in cache.",[o6]:"The cached token request could not be parsed.",[NA]:"No cached authority found.",[yoe]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[Coe]:"Invalid cache type",[OA]:"Login and token requests are not supported in non-browser environments.",[Uu]:"Database is not open!",[nb]:"No network connectivity. Check your internet connection.",[s6]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[c6]:"Network request failed. Please check the network trace to determine root cause.",[z1]:"Failed to parse network response. Check network trace.",[l6]:"Error loading token to cache.",[LA]:"Cryptographic Key or Keypair not found in browser storage.",[u6]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[d6]:"An authorization code or nativeAccountId must be provided to this flow.",[h6]:"Request cannot contain both spa code and native account id.",[DA]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[f6]:`Unable to acquire token from native platform.  ${wo}`,[p6]:"Timed out while attempting to establish connection to browser extension",[m6]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[um]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${wo}`,[g6]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${wo}`,[v6]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[b6]:"Invalid base64 encoded string.",[y6]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true."};class hh extends Mt{constructor(e){super(e,Soe[e]),Object.setPrototypeOf(this,hh.prototype),this.name="BrowserAuthError"}}function et(n){return new hh(n)}/*! @azure/msal-browser v3.26.1 2024-10-08 */const bi={INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},Ju={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},Uc={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},_n={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},AR={GET:"GET",POST:"POST"},Qt={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},ds={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},rg={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},fn={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var Ae;(function(n){n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none"})(Ae||(Ae={}));const kR={scopes:Gs},C6="jwk",V1="msal.db",woe=1,Eoe=`${V1}.keys`,Wn={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},Toe=[Wn.Default,Wn.Skip,Wn.RefreshTokenAndNetwork],Ioe="msal.browser.log.level",Aoe="msal.browser.log.pii",koe="msal.browser.performance.enabled";/*! @azure/msal-browser v3.26.1 2024-10-08 */function ig(n){return encodeURIComponent(jA(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Qy(n){return S6(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function jA(n){return S6(new TextEncoder().encode(n))}function S6(n){const e=Array.from(n,t=>String.fromCodePoint(t)).join("");return btoa(e)}/*! @azure/msal-browser v3.26.1 2024-10-08 */const xoe="RSASSA-PKCS1-v1_5",w6="SHA-256",_oe=2048,Moe=new Uint8Array([1,0,1]),xR="0123456789abcdef",_R=new Uint32Array(1),UA={name:xoe,hash:w6,modulusLength:_oe,publicExponent:Moe};function Roe(n){if("crypto"in window)n.verbose("BrowserCrypto: modern crypto interface available");else throw n.error("BrowserCrypto: crypto interface is unavailable"),et(Kj)}async function E6(n,e,t){e==null||e.addQueueMeasurement(L.Sha256Digest,t);const i=new TextEncoder().encode(n);return window.crypto.subtle.digest(w6,i)}function Poe(n){return window.crypto.getRandomValues(n)}function GS(){return window.crypto.getRandomValues(_R),_R[0]}function lo(){const n=Date.now(),e=GS()*1024+(GS()&1023),t=new Uint8Array(16),r=Math.trunc(e/2**30),i=e&2**30-1,a=GS();t[0]=n/2**40,t[1]=n/2**32,t[2]=n/2**24,t[3]=n/2**16,t[4]=n/2**8,t[5]=n,t[6]=112|r>>>8,t[7]=r,t[8]=128|i>>>24,t[9]=i>>>16,t[10]=i>>>8,t[11]=i,t[12]=a>>>24,t[13]=a>>>16,t[14]=a>>>8,t[15]=a;let o="";for(let s=0;s<t.length;s++)o+=xR.charAt(t[s]>>>4),o+=xR.charAt(t[s]&15),(s===3||s===5||s===7||s===9)&&(o+="-");return o}async function Noe(n,e){return window.crypto.subtle.generateKey(UA,n,e)}async function KS(n){return window.crypto.subtle.exportKey(C6,n)}async function Ooe(n,e,t){return window.crypto.subtle.importKey(C6,n,UA,e,t)}async function Loe(n,e){return window.crypto.subtle.sign(UA,n,e)}async function T6(n){const e=await E6(n),t=new Uint8Array(e);return Qy(t)}/*! @azure/msal-browser v3.26.1 2024-10-08 */const I6="storage_not_supported",Doe="stubbed_public_client_application_called",A6="in_mem_redirect_unavailable";/*! @azure/msal-browser v3.26.1 2024-10-08 */const joe={[I6]:"Given storage configuration option was not supported.",[Doe]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[A6]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class Jy extends Mt{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,Jy.prototype)}}function k6(n){return new Jy(n,joe[n])}/*! @azure/msal-browser v3.26.1 2024-10-08 */function Uoe(n){n.location.hash="",typeof n.history.replaceState=="function"&&n.history.replaceState(null,"",`${n.location.origin}${n.location.pathname}${n.location.search}`)}function Foe(n){const e=n.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function FA(){return window.parent!==window}function Boe(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${bi.POPUP_NAME_PREFIX}.`)===0}function fa(){return window.location.href.split("?")[0].split("#")[0]}function Hoe(){const e=new Pt(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function $oe(){if(Pt.hashContainsKnownProperties(window.location.hash)&&FA())throw et(n6)}function zoe(n){if(FA()&&!n)throw et(t6)}function Voe(){if(Boe())throw et(r6)}function x6(){if(typeof window>"u")throw et(OA)}function BA(n){if(!n)throw et(g6)}function No(n){x6(),$oe(),Voe(),BA(n)}function MR(n,e){if(No(n),zoe(e.system.allowRedirectInIframe),e.cache.cacheLocation===_n.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw k6(A6)}function _6(n){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(n).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function Fi(){return lo()}/*! @azure/msal-browser v3.26.1 2024-10-08 */class rb{navigateInternal(e,t){return rb.defaultNavigateWindow(e,t)}navigateExternal(e,t){return rb.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(r=>{setTimeout(()=>{r(!0)},t.timeout)})}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class Goe{async sendGetRequestAsync(e,t){let r;try{r=await fetch(e,{method:AR.GET,headers:this.getFetchHeaders(t)})}catch{throw window.navigator.onLine?et(c6):et(nb)}try{return{headers:this.getHeaderDict(r.headers),body:await r.json(),status:r.status}}catch{throw et(z1)}}async sendPostRequestAsync(e,t){const r=t&&t.body||se.EMPTY_STRING;let i;try{i=await fetch(e,{method:AR.POST,headers:this.getFetchHeaders(t),body:r})}catch{throw window.navigator.onLine?et(s6):et(nb)}try{return{headers:this.getHeaderDict(i.headers),body:await i.json(),status:i.status}}catch{throw et(z1)}}getFetchHeaders(e){const t=new Headers;if(!(e&&e.headers))return t;const r=e.headers;return Object.keys(r).forEach(i=>{t.append(i,r[i])}),t}getHeaderDict(e){const t={};return e.forEach((r,i)=>{t[i]=r}),t}}/*! @azure/msal-browser v3.26.1 2024-10-08 */const Koe=6e4,ib=1e4,qoe=3e4,Woe=2e3;function Yoe({auth:n,cache:e,system:t,telemetry:r},i){const a={clientId:se.EMPTY_STRING,authority:`${se.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:se.EMPTY_STRING,authorityMetadata:se.EMPTY_STRING,redirectUri:se.EMPTY_STRING,postLogoutRedirectUri:se.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:Po.AAD,OIDCOptions:{serverResponseType:lm.FRAGMENT,defaultScopes:[se.OPENID_SCOPE,se.PROFILE_SCOPE,se.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:Ip.None,tenant:se.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},o={cacheLocation:_n.SessionStorage,temporaryCacheLocation:_n.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===_n.LocalStorage),claimsBasedCachingEnabled:!1},s={loggerCallback:()=>{},logLevel:vn.Info,piiLoggingEnabled:!1},u={...{...Dj,loggerOptions:s,networkClient:i?new Goe:ooe,navigationClient:new rb,loadFrameTimeout:0,windowHashTimeout:(t==null?void 0:t.loadFrameTimeout)||Koe,iframeHashTimeout:(t==null?void 0:t.loadFrameTimeout)||ib,navigateFrameWait:0,redirectNavigationTimeout:qoe,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:(t==null?void 0:t.nativeBrokerHandshakeTimeout)||Woe,pollIntervalMilliseconds:bi.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:(t==null?void 0:t.loggerOptions)||s},h={application:{appName:se.EMPTY_STRING,appVersion:se.EMPTY_STRING},client:new Gj};if((n==null?void 0:n.protocolMode)!==Po.OIDC&&(n!=null&&n.OIDCOptions)&&new Ca(u.loggerOptions).warning(JSON.stringify(tn(xj))),n!=null&&n.protocolMode&&n.protocolMode!==Po.AAD&&(u!=null&&u.allowNativeBroker))throw tn(_j);return{auth:{...a,...n,OIDCOptions:{...a.OIDCOptions,...n==null?void 0:n.OIDCOptions}},cache:{...o,...e},system:u,telemetry:{...h,...r}}}/*! @azure/msal-browser v3.26.1 2024-10-08 */const ab="@azure/msal-browser",hl="3.26.1";/*! @azure/msal-browser v3.26.1 2024-10-08 */class HA{static loggerCallback(e,t){switch(e){case vn.Error:console.error(t);return;case vn.Info:console.info(t);return;case vn.Verbose:console.debug(t);return;case vn.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){var c;this.browserEnvironment=typeof window<"u",this.config=Yoe(e,this.browserEnvironment);let t;try{t=window[_n.SessionStorage]}catch{}const r=t==null?void 0:t.getItem(Ioe),i=(c=t==null?void 0:t.getItem(Aoe))==null?void 0:c.toLowerCase(),a=i==="true"?!0:i==="false"?!1:void 0,o={...this.config.system.loggerOptions},s=r&&Object.keys(vn).includes(r)?vn[r]:void 0;s&&(o.loggerCallback=HA.loggerCallback,o.logLevel=s),a!==void 0&&(o.piiLoggingEnabled=a),this.logger=new Ca(o,ab,hl),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class fl extends HA{getModuleName(){return fl.MODULE_NAME}getId(){return fl.ID}async initialize(){return this.available=typeof window<"u",this.available}}fl.MODULE_NAME="";fl.ID="StandardOperatingContext";/*! @azure/msal-browser v3.26.1 2024-10-08 */function no(n){return new TextDecoder().decode(Qoe(n))}function Qoe(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw et(b6)}const t=atob(e);return Uint8Array.from(t,r=>r.codePointAt(0)||0)}/*! @azure/msal-browser v3.26.1 2024-10-08 */class Joe{constructor(){this.dbName=V1,this.version=woe,this.tableName=Eoe,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",i=>{i.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",i=>{const a=i;this.db=a.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t(et(DA)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(et(Uu));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);o.addEventListener("success",s=>{const c=s;this.closeConnection(),t(c.target.result)}),o.addEventListener("error",s=>{this.closeConnection(),r(s)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((r,i)=>{if(!this.db)return i(et(Uu));const s=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);s.addEventListener("success",()=>{this.closeConnection(),r()}),s.addEventListener("error",c=>{this.closeConnection(),i(c)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(et(Uu));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);o.addEventListener("success",()=>{this.closeConnection(),t()}),o.addEventListener("error",s=>{this.closeConnection(),r(s)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(et(Uu));const a=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();a.addEventListener("success",o=>{const s=o;this.closeConnection(),e(s.target.result)}),a.addEventListener("error",o=>{this.closeConnection(),t(o)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(et(Uu));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);o.addEventListener("success",s=>{const c=s;this.closeConnection(),t(c.target.result===1)}),o.addEventListener("error",s=>{this.closeConnection(),r(s)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const r=window.indexedDB.deleteDatabase(V1),i=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(i),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(i),e(!0))),r.addEventListener("error",()=>(clearTimeout(i),t(!1)))})}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class ob{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class Zoe{constructor(e){this.inMemoryCache=new ob,this.indexedDBCache=new Joe,this.logger=e}handleDatabaseAccessError(e){if(e instanceof hh&&e.errorCode===DA)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(r){this.handleDatabaseAccessError(r)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(r){this.handleDatabaseAccessError(r)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(r){this.handleDatabaseAccessError(r)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class pl{constructor(e,t){this.logger=e,Roe(e),this.cache=new Zoe(this.logger),this.performanceClient=t}createNewGuid(){return lo()}base64Encode(e){return jA(e)}base64Decode(e){return no(e)}base64UrlEncode(e){return ig(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){var h;const t=(h=this.performanceClient)==null?void 0:h.startMeasurement(L.CryptoOptsGetPublicKeyThumbprint,e.correlationId),r=await Noe(pl.EXTRACTABLE,pl.POP_KEY_USAGES),i=await KS(r.publicKey),a={e:i.e,kty:i.kty,n:i.n},o=RR(a),s=await this.hashString(o),c=await KS(r.privateKey),u=await Ooe(c,!1,["sign"]);return await this.cache.setItem(s,{privateKey:u,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),s}async removeTokenBindingKey(e){return await this.cache.removeItem(e),!await this.cache.containsKey(e)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,r,i){var E;const a=(E=this.performanceClient)==null?void 0:E.startMeasurement(L.CryptoOptsSignJwt,i),o=await this.cache.getItem(t);if(!o)throw et(LA);const s=await KS(o.publicKey),c=RR(s),u=ig(JSON.stringify({kid:t})),h=MA.getShrHeaderString({...r==null?void 0:r.header,alg:s.alg,kid:u}),f=ig(h);e.cnf={jwk:JSON.parse(c)};const p=ig(JSON.stringify(e)),g=`${f}.${p}`,y=new TextEncoder().encode(g),b=await Loe(o.privateKey,y),C=Qy(new Uint8Array(b)),S=`${g}.${C}`;return a&&a.end({success:!0}),S}async hashString(e){return T6(e)}}pl.POP_KEY_USAGES=["sign","verify"];pl.EXTRACTABLE=!0;function RR(n){return JSON.stringify(n,Object.keys(n).sort())}/*! @azure/msal-browser v3.26.1 2024-10-08 */class sb{constructor(e){this.validateWindowStorage(e),this.windowStorage=window[e]}validateWindowStorage(e){if(e!==_n.LocalStorage&&e!==_n.SessionStorage||!window[e])throw k6(I6)}getItem(e){return this.windowStorage.getItem(e)}setItem(e,t){this.windowStorage.setItem(e,t)}removeItem(e){this.windowStorage.removeItem(e)}getKeys(){return Object.keys(this.windowStorage)}containsKey(e){return this.windowStorage.hasOwnProperty(e)}}/*! @azure/msal-browser v3.26.1 2024-10-08 */function M6(n,e){if(!e)return null;try{return va.parseRequestState(n,e).libraryState.meta}catch{throw Ne($d)}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class G1 extends zd{constructor(e,t,r,i,a,o){super(e,r,i,a),this.COOKIE_LIFE_MULTIPLIER=24*60*60*1e3,this.cacheConfig=t,this.logger=i,this.internalStorage=new ob,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupTemporaryCacheStorage(this.cacheConfig.temporaryCacheLocation,this.cacheConfig.cacheLocation),t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=o}setupBrowserStorage(e){switch(e){case _n.LocalStorage:case _n.SessionStorage:try{return new sb(e)}catch(t){this.logger.verbose(t);break}}return this.cacheConfig.cacheLocation=_n.MemoryStorage,new ob}setupTemporaryCacheStorage(e,t){switch(t){case _n.LocalStorage:case _n.SessionStorage:try{return new sb(e||_n.SessionStorage)}catch(r){return this.logger.verbose(r),this.internalStorage}case _n.MemoryStorage:default:return this.internalStorage}}migrateCacheEntries(){const e=`${se.CACHE_PREFIX}.${ir.ID_TOKEN}`,t=`${se.CACHE_PREFIX}.${ir.CLIENT_INFO}`,r=`${se.CACHE_PREFIX}.${ir.ERROR}`,i=`${se.CACHE_PREFIX}.${ir.ERROR_DESC}`,a=this.browserStorage.getItem(e),o=this.browserStorage.getItem(t),s=this.browserStorage.getItem(r),c=this.browserStorage.getItem(i),u=[a,o,s,c];[ir.ID_TOKEN,ir.CLIENT_INFO,ir.ERROR,ir.ERROR_DESC].forEach((f,p)=>{const g=u[p];g&&this.setTemporaryCache(f,g,!0)})}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");const e=this.getItem(ds.ACCOUNT_KEYS),t=this.getItem(`${ds.TOKEN_KEYS}.${this.clientId}`);if(e&&t){this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration.");return}this.browserStorage.getKeys().forEach(i=>{if(this.isCredentialKey(i)){const a=this.getItem(i);if(a){const o=this.validateAndParseJson(a);if(o&&o.hasOwnProperty("credentialType"))switch(o.credentialType){case pt.ID_TOKEN:if(hR(o)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${i} found, saving key to token key map`);const s=o,c=this.updateCredentialCacheKey(i,s);this.addTokenKey(c,pt.ID_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${i}`);break;case pt.ACCESS_TOKEN:case pt.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(dR(o)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${i} found, saving key to token key map`);const s=o,c=this.updateCredentialCacheKey(i,s);this.addTokenKey(c,pt.ACCESS_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${i}`);break;case pt.REFRESH_TOKEN:if(fR(o)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${i} found, saving key to token key map`);const s=o,c=this.updateCredentialCacheKey(i,s);this.addTokenKey(c,pt.REFRESH_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${i}`);break}}}if(this.isAccountKey(i)){const a=this.getItem(i);if(a){const o=this.validateAndParseJson(a);o&&Xn.isAccountEntity(o)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${i} found, saving key to account key map`),this.addAccountKeyToMap(i))}}})}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t){this.browserStorage.setItem(e,t)}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const r=this.getCachedAccountEntity(e);return this.updateOutdatedCachedAccount(e,r,t)}getCachedAccountEntity(e){const t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;const r=this.validateAndParseJson(t);return!r||!Xn.isAccountEntity(r)?(this.removeAccountKeyFromMap(e),null):zd.toObject(new Xn,r)}setAccount(e){this.logger.trace("BrowserCacheManager.setAccount called");const t=e.generateAccountKey();this.setItem(t,JSON.stringify(e)),this.addAccountKeyToMap(t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");const e=this.getItem(ds.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const t=this.getAccountKeys();t.indexOf(e)===-1?(t.push(e),this.setItem(ds.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const t=this.getAccountKeys(),r=t.indexOf(e);r>-1?(t.splice(r,1),this.setItem(ds.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}async removeAccount(e){super.removeAccount(e),this.removeAccountKeyFromMap(e)}removeOutdatedAccount(e){this.removeItem(e),this.removeAccountKeyFromMap(e)}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,pt.ID_TOKEN)}async removeAccessToken(e){super.removeAccessToken(e),this.removeTokenKey(e,pt.ACCESS_TOKEN)}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,pt.REFRESH_TOKEN)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");const e=this.getItem(`${ds.TOKEN_KEYS}.${this.clientId}`);if(e){const t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");const r=this.getTokenKeys();switch(t){case pt.ID_TOKEN:r.idToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),r.idToken.push(e));break;case pt.ACCESS_TOKEN:r.accessToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),r.accessToken.push(e));break;case pt.REFRESH_TOKEN:r.refreshToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),r.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),Ne(D1)}this.setItem(`${ds.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");const r=this.getTokenKeys();switch(t){case pt.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const i=r.idToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),r.idToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case pt.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const a=r.accessToken.indexOf(e);a>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),r.accessToken.splice(a,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case pt.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const o=r.refreshToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),r.refreshToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),Ne(D1)}this.setItem(`${ds.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}getIdTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,pt.ID_TOKEN),null;const r=this.validateAndParseJson(t);return!r||!hR(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,pt.ID_TOKEN),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),r)}setIdTokenCredential(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const t=Yu(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,pt.ID_TOKEN)}getAccessTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,pt.ACCESS_TOKEN),null;const r=this.validateAndParseJson(t);return!r||!dR(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,pt.ACCESS_TOKEN),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),r)}setAccessTokenCredential(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const t=Yu(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,pt.ACCESS_TOKEN)}getRefreshTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,pt.REFRESH_TOKEN),null;const r=this.validateAndParseJson(t);return!r||!fR(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,pt.REFRESH_TOKEN),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),r)}setRefreshTokenCredential(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const t=Yu(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,pt.REFRESH_TOKEN)}getAppMetadata(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!Hie(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");const t=Bie(e);this.setItem(t,JSON.stringify(e))}getServerTelemetry(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!Uie(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&$ie(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(rg.WRAPPER_SKU,e),this.internalStorage.setItem(rg.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(rg.WRAPPER_SKU)||se.EMPTY_STRING,t=this.internalStorage.getItem(rg.WRAPPER_VER)||se.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){const e=this.generateCacheKey(ir.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(e);if(!t){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");const i=this.generateCacheKey(ir.ACTIVE_ACCOUNT),a=this.getItem(i);if(!a)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;const o=this.getAccountInfoFilteredBy({localAccountId:a});return o?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(o),o):null}const r=this.validateAndParseJson(t);return r?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:r.homeAccountId,localAccountId:r.localAccountId,tenantId:r.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){const t=this.generateCacheKey(ir.ACTIVE_ACCOUNT_FILTERS),r=this.generateCacheKey(ir.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");const i={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.browserStorage.setItem(t,JSON.stringify(i)),this.browserStorage.setItem(r,e.localAccountId)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(r)}getThrottlingCache(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!Fie(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){const r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const a=this.getItemCookie(r);if(a)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),a}const i=this.temporaryCacheStorage.getItem(r);if(!i){if(this.cacheConfig.cacheLocation===_n.LocalStorage){const a=this.browserStorage.getItem(r);if(a)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),a}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),i}setTemporaryCache(e,t,r){const i=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(i,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(i,t))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(e))}getKeys(){return this.browserStorage.getKeys()}async clear(){await this.removeAllAccounts(),this.removeAppMetadata(),this.temporaryCacheStorage.getKeys().forEach(e=>{(e.indexOf(se.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{(e.indexOf(se.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(e)}),this.internalStorage.clear()}async clearTokensAndKeysWithClaims(e,t){e.addQueueMeasurement(L.ClearTokensAndKeysWithClaims,t);const r=this.getTokenKeys(),i=[];r.accessToken.forEach(a=>{const o=this.getAccessTokenCredential(a);o!=null&&o.requestedClaimsHash&&a.includes(o.requestedClaimsHash.toLowerCase())&&i.push(this.removeAccessToken(a))}),await Promise.all(i),i.length>0&&this.logger.warning(`${i.length} access tokens with claims in the cache keys have been removed from the cache.`)}setItemCookie(e,t,r){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;if(r){const a=this.getCookieExpirationTime(r);i+=`expires=${a};`}this.cacheConfig.secureCookies&&(i+="Secure;"),document.cookie=i}getItemCookie(e){const t=`${encodeURIComponent(e)}=`,r=document.cookie.split(";");for(let i=0;i<r.length;i++){let a=r[i];for(;a.charAt(0)===" ";)a=a.substring(1);if(a.indexOf(t)===0)return decodeURIComponent(a.substring(t.length,a.length))}return se.EMPTY_STRING}clearMsalCookies(){const e=`${se.CACHE_PREFIX}.${this.clientId}`;document.cookie.split(";").forEach(r=>{for(;r.charAt(0)===" ";)r=r.substring(1);if(r.indexOf(e)===0){const i=r.split("=")[0];this.clearItemCookie(i)}})}clearItemCookie(e){this.setItemCookie(e,se.EMPTY_STRING,-1)}getCookieExpirationTime(e){const t=new Date;return new Date(t.getTime()+e*this.COOKIE_LIFE_MULTIPLIER).toUTCString()}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):ga.startsWith(e,se.CACHE_PREFIX)||ga.startsWith(e,ir.ADAL_ID_TOKEN)?e:`${se.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=va.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${Qt.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=va.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${Qt.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=va.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${Qt.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),r=this.getTemporaryCache(t);if(!r)return null;const i=this.generateAuthorityKey(r);return this.getTemporaryCache(i)}updateCacheEntries(e,t,r,i,a){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const o=this.generateStateKey(e);this.setTemporaryCache(o,e,!1);const s=this.generateNonceKey(e);this.setTemporaryCache(s,t,!1);const c=this.generateAuthorityKey(e);if(this.setTemporaryCache(c,r,!1),a){const u={credential:a.homeAccountId,type:Ci.HOME_ACCOUNT_ID};this.setTemporaryCache(Qt.CCS_CREDENTIAL,JSON.stringify(u),!0)}else if(i){const u={credential:i,type:Ci.UPN};this.setTemporaryCache(Qt.CCS_CREDENTIAL,JSON.stringify(u),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{t.indexOf(e)!==-1&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(Qt.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(Qt.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(Qt.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(Qt.CORRELATION_ID)),this.removeTemporaryItem(this.generateCacheKey(Qt.CCS_CREDENTIAL)),this.removeTemporaryItem(this.generateCacheKey(Qt.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),r=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r||se.EMPTY_STRING)}this.clearMsalCookies()}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(t.indexOf(Qt.REQUEST_STATE)===-1)return;const r=this.temporaryCacheStorage.getItem(t);if(!r)return;const i=M6(this.cryptoImpl,r);i&&i.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r))}),this.clearMsalCookies(),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=jA(JSON.stringify(e));this.setTemporaryCache(Qt.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(Qt.REQUEST_PARAMS,!0);if(!t)throw et(a6);let r;try{r=JSON.parse(no(t))}catch(i){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${i}`),et(o6)}if(this.removeTemporaryItem(this.generateCacheKey(Qt.REQUEST_PARAMS)),!r.authority){const i=this.generateAuthorityKey(e),a=this.getTemporaryCache(i);if(!a)throw et(NA);r.authority=a}return r}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(Qt.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${se.CACHE_PREFIX}.${Qt.INTERACTION_STATUS_KEY}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){const t=`${se.CACHE_PREFIX}.${Qt.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw et(Jj);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}getLegacyLoginHint(){const e=this.getTemporaryCache(ir.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(ir.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));const t=this.getTemporaryCache(ir.ID_TOKEN,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(ir.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));const r=t||e;if(r){const i=ql(r,no);if(i.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),i.preferred_username;if(i.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),i.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t){const r=Yu(t);if(e!==r){const i=this.getItem(e);if(i)return this.browserStorage.removeItem(e),this.setItem(r,i),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),r;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}async hydrateCache(e,t){var s,c,u;const r=$y((s=e.account)==null?void 0:s.homeAccountId,(c=e.account)==null?void 0:c.environment,e.idToken,this.clientId,e.tenantId);let i;t.claims&&(i=await this.cryptoImpl.hashString(t.claims));const a=zy((u=e.account)==null?void 0:u.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,no,void 0,e.tokenType,void 0,t.sshKid,t.claims,i),o={idToken:r,accessToken:a};return this.saveCacheRecord(o)}async saveCacheRecord(e,t,r){try{await super.saveCacheRecord(e,t,r)}catch(i){if(i instanceof Kc&&this.performanceClient&&r)try{const a=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:a.refreshToken.length,cacheIdCount:a.idToken.length,cacheAtCount:a.accessToken.length},r)}catch{}throw i}}}const Xoe=(n,e)=>{const t={cacheLocation:_n.MemoryStorage,temporaryCacheLocation:_n.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new G1(n,t,Qv,e)};/*! @azure/msal-browser v3.26.1 2024-10-08 */function ese(n,e,t,r){return n.verbose("getAllAccounts called"),t?e.getAllAccounts(r):[]}function tse(n,e,t){if(e.trace("getAccount called"),Object.keys(n).length===0)return e.warning("getAccount: No accountFilter provided"),null;const r=t.getAccountInfoFilteredBy(n);return r?(e.verbose("getAccount: Account matching provided filter found, returning"),r):(e.verbose("getAccount: No matching account found, returning null"),null)}function nse(n,e,t){if(e.trace("getAccountByUsername called"),!n)return e.warning("getAccountByUsername: No username provided"),null;const r=t.getAccountInfoFilteredBy({username:n});return r?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${n}`),r):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function rse(n,e,t){if(e.trace("getAccountByHomeId called"),!n)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const r=t.getAccountInfoFilteredBy({homeAccountId:n});return r?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${n}`),r):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function ise(n,e,t){if(e.trace("getAccountByLocalId called"),!n)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const r=t.getAccountInfoFilteredBy({localAccountId:n});return r?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${n}`),r):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function ase(n,e){e.setActiveAccount(n)}function ose(n){return n.getActiveAccount()}/*! @azure/msal-browser v3.26.1 2024-10-08 */const de={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"};/*! @azure/msal-browser v3.26.1 2024-10-08 */class R6{constructor(e){this.eventCallbacks=new Map,this.logger=e||new Ca({})}addEventCallback(e,t,r){if(typeof window<"u"){const i=r||Fi();return this.eventCallbacks.has(i)?(this.logger.error(`Event callback with id: ${i} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(i,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${i}`),i)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,r,i){if(typeof window<"u"){const a={eventType:e,interactionType:t||null,payload:r||null,error:i||null,timestamp:Date.now()};this.eventCallbacks.forEach(([o,s],c)=>{(s.length===0||s.includes(e))&&(this.logger.verbose(`Emitting event to callback ${c}: ${e}`),o.apply(null,[a]))})}}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class P6{constructor(e,t,r,i,a,o,s,c,u){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=a,this.navigationClient=o,this.nativeMessageHandler=c,this.correlationId=u||lo(),this.logger=i.clone(bi.MSAL_SKU,hl,this.correlationId),this.performanceClient=s}async clearCacheOnLogout(e){if(e){Xn.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null));try{await this.browserStorage.removeAccount(Xn.generateAccountCacheKey(e)),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),await this.browserStorage.clear(),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri||fa();return Pt.getAbsoluteUrl(t,fa())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Ap(r,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(L.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const i={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},a=e.requestAuthority||this.config.auth.authority,o=r!=null&&r.length?r==="true":this.config.auth.instanceAware,s=t&&o?this.config.auth.authority.replace(Pt.getDomainFromUrl(a),t.environment):a,c=wr.generateAuthority(s,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),u=await Be(Uj,L.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(c,this.config.system.networkClient,this.browserStorage,i,this.logger,this.correlationId,this.performanceClient);if(t&&!u.isAlias(t.environment))throw tn(Mj);return u}}/*! @azure/msal-browser v3.26.1 2024-10-08 */const sse=32;async function cse(n,e,t){n.addQueueMeasurement(L.GeneratePkceCodes,t);const r=Wl(lse,L.GenerateCodeVerifier,e,n,t)(n,e,t),i=await Be(use,L.GenerateCodeChallengeFromVerifier,e,n,t)(r,n,e,t);return{verifier:r,challenge:i}}function lse(n,e,t){try{const r=new Uint8Array(sse);return Wl(Poe,L.GetRandomValues,e,n,t)(r),Qy(r)}catch{throw et(RA)}}async function use(n,e,t,r){e.addQueueMeasurement(L.GenerateCodeChallengeFromVerifier,r);try{const i=await Be(E6,L.Sha256Digest,t,e,r)(n,e,r);return Qy(new Uint8Array(i))}catch{throw et(RA)}}/*! @azure/msal-browser v3.26.1 2024-10-08 */async function $A(n,e,t,r){t.addQueueMeasurement(L.InitializeBaseRequest,n.correlationId);const i=n.authority||e.auth.authority,a=[...n&&n.scopes||[]],o={...n,correlationId:n.correlationId,authority:i,scopes:a};if(!o.authenticationScheme)o.authenticationScheme=Wt.BEARER,r.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(o.authenticationScheme===Wt.SSH){if(!n.sshJwk)throw tn(Vy);if(!n.sshKid)throw tn(kj)}r.verbose(`Authentication Scheme set to "${o.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&n.claims&&!ga.isEmptyObj(n.claims)&&(o.requestedClaimsHash=await T6(n.claims)),o}async function dse(n,e,t,r,i){r.addQueueMeasurement(L.InitializeSilentRequest,n.correlationId);const a=await Be($A,L.InitializeBaseRequest,i,r,n.correlationId)(n,t,r,i);return{...n,...a,account:e,forceRefresh:n.forceRefresh||!1}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class fh extends P6{async initializeAuthorizationCodeRequest(e){this.performanceClient.addQueueMeasurement(L.StandardInteractionClientInitializeAuthorizationCodeRequest,this.correlationId);const t=await Be(cse,L.GeneratePkceCodes,this.logger,this.performanceClient,this.correlationId)(this.performanceClient,this.logger,this.correlationId),r={...e,redirectUri:e.redirectUri,code:se.EMPTY_STRING,codeVerifier:t.verifier};return e.codeChallenge=t.challenge,e.codeChallengeMethod=se.S256_CODE_CHALLENGE_METHOD,r}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e==null?void 0:e.correlationId);const t={correlationId:this.correlationId||lo(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=Pt.getAbsoluteUrl(e.postLogoutRedirectUri,fa())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=Pt.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,fa())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=Pt.getAbsoluteUrl(fa(),fa())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(L.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await Be(this.getClientConfiguration.bind(this),L.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new Hj(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:a,account:o}=e;this.performanceClient.addQueueMeasurement(L.StandardInteractionClientGetClientConfiguration,this.correlationId);const s=await Be(this.getDiscoveredAuthority.bind(this),L.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:a,account:o}),c=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:s,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:c.loggerCallback,piiLoggingEnabled:c.piiLoggingEnabled,logLevel:c.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:bi.MSAL_SKU,version:hl,cpu:se.EMPTY_STRING,os:se.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(L.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const r=this.getRedirectUri(e.redirectUri),i={interactionType:t},a=va.setRequestState(this.browserCrypto,e&&e.state||se.EMPTY_STRING,i),s={...await Be($A,L.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:r,state:a,nonce:e.nonce||lo(),responseMode:this.config.auth.OIDCOptions.serverResponseType},c=e.account||this.browserStorage.getActiveAccount();if(c&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${c.homeAccountId}`,this.correlationId),s.account=c),!s.loginHint&&!c){const u=this.browserStorage.getLegacyLoginHint();u&&(s.loginHint=u)}return s}}/*! @azure/msal-browser v3.26.1 2024-10-08 */const hse="ContentError",N6="user_switch";/*! @azure/msal-browser v3.26.1 2024-10-08 */const fse="USER_INTERACTION_REQUIRED",pse="USER_CANCEL",mse="NO_NETWORK",gse="PERSISTENT_ERROR",vse="DISABLED",bse="ACCOUNT_UNAVAILABLE";/*! @azure/msal-browser v3.26.1 2024-10-08 */const yse=-2147186943,Cse={[N6]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Va extends Mt{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,Va.prototype),this.name="NativeAuthError",this.ext=r}}function Fu(n){if(n.ext&&n.ext.status&&(n.ext.status===gse||n.ext.status===vse)||n.ext&&n.ext.error&&n.ext.error===yse)return!0;switch(n.errorCode){case hse:return!0;default:return!1}}function K1(n,e,t){if(t&&t.status)switch(t.status){case bse:return B1(Fj);case fse:return new Gr(n,e);case pse:return et(dl);case mse:return et(nb)}return new Va(n,Cse[n]||e,t)}/*! @azure/msal-browser v3.26.1 2024-10-08 */class O6 extends fh{async acquireToken(e){this.performanceClient.addQueueMeasurement(L.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(fn.acquireTokenSilent_silentFlow),r=await Be(this.getClientConfiguration.bind(this),L.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),i=new aoe(r,this.performanceClient);this.logger.verbose("Silent auth client created");try{const o=(await Be(i.acquireCachedToken.bind(i),L.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),o}catch(a){throw a instanceof hh&&a.errorCode===LA&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),a}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t==null?void 0:t.account)}}/*! @azure/msal-browser v3.26.1 2024-10-08 */const qS={BROKER_CLIENT_ID:"brk_client_id",BROKER_REDIRECT_URI:"brk_redirect_uri"};class hd extends P6{constructor(e,t,r,i,a,o,s,c,u,h,f,p){var v;super(e,t,r,i,a,o,c,u,p),this.apiId=s,this.accountId=h,this.nativeMessageHandler=u,this.nativeStorageManager=f,this.silentCacheClient=new O6(e,this.nativeStorageManager,r,i,a,o,c,u,p),this.serverTelemetryManager=this.initializeServerTelemetryManager(this.apiId);const g=this.nativeMessageHandler.getExtensionId()===Ju.PREFERRED_EXTENSION_ID?"chrome":(v=this.nativeMessageHandler.getExtensionId())!=null&&v.length?"unknown":void 0;this.skus=Ap.makeExtraSkuString({libraryName:bi.MSAL_SKU,libraryVersion:hl,extensionName:g,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[$ae]:this.skus}}async acquireToken(e){this.performanceClient.addQueueMeasurement(L.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const t=this.performanceClient.startMeasurement(L.NativeInteractionClientAcquireToken,e.correlationId),r=so();try{const i=await this.initializeNativeRequest(e);try{const u=await this.acquireTokensFromCache(this.accountId,i);return t.end({success:!0,isNativeBroker:!1,fromCache:!0}),u}catch{this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const{...a}=i,o={method:Uc.GetToken,request:a},s=await this.nativeMessageHandler.sendMessage(o),c=this.validateNativeResponse(s);return await this.handleNativeResponse(c,i,r).then(u=>(t.end({success:!0,isNativeBroker:!0,requestId:u.requestId}),this.serverTelemetryManager.clearNativeBrokerErrorCode(),u)).catch(u=>{throw t.end({success:!1,errorCode:u.errorCode,subErrorCode:u.subError,isNativeBroker:!0}),u})}catch(i){throw i instanceof Va&&this.serverTelemetryManager.setNativeBrokerErrorCode(i.errorCode),i}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:Un.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),Ne(O1);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!r)throw Ne(O1);try{const i=this.createSilentCacheRequest(t,r),a=await this.silentCacheClient.acquireToken(i),o={...r,idTokenClaims:a==null?void 0:a.idTokenClaims,idToken:a==null?void 0:a.idToken};return{...a,account:o}}catch(i){throw i}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...r}=e;delete r.onRedirectNavigate;const i=await this.initializeNativeRequest(r),a={method:Uc.GetToken,request:i};try{const c=await this.nativeMessageHandler.sendMessage(a);this.validateNativeResponse(c)}catch(c){if(c instanceof Va&&(this.serverTelemetryManager.setNativeBrokerErrorCode(c.errorCode),Fu(c)))throw c}this.browserStorage.setTemporaryCache(Qt.NATIVE_REQUEST,JSON.stringify(i),!0);const o={apiId:fn.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},s=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(s,o)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(e==null||e.addFields({errorCode:"no_cached_request"},t)),null;const{prompt:i,...a}=r;i&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Qt.NATIVE_REQUEST));const o={method:Uc.GetToken,request:a},s=so();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const c=await this.nativeMessageHandler.sendMessage(o);this.validateNativeResponse(c);const u=this.handleNativeResponse(c,a,s);this.browserStorage.setInteractionInProgress(!1);const h=await u;return this.serverTelemetryManager.clearNativeBrokerErrorCode(),h}catch(c){throw this.browserStorage.setInteractionInProgress(!1),c}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){var h;this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const i=ql(e.id_token,no),a=this.createHomeAccountIdentifier(e,i),o=(h=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId}))==null?void 0:h.homeAccountId;if(a!==o&&e.account.id!==t.accountId)throw K1(N6);const s=await this.getDiscoveredAuthority({requestAuthority:t.authority}),c=xA(this.browserStorage,s,a,no,i,e.client_info,void 0,i.tid,void 0,e.account.id,this.logger),u=await this.generateAuthenticationResult(e,t,i,c,s.canonicalAuthority,r);return this.cacheAccount(c),this.cacheNativeTokens(e,t,a,i,e.access_token,u.tenantId,r),u}createHomeAccountIdentifier(e,t){return Xn.generateHomeAccountId(e.client_info||se.EMPTY_STRING,oa.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?Un.fromString(e.scope):Un.fromString(t.scope)}async generatePopAccessToken(e,t){if(t.tokenType===Wt.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const r=new ll(this.browserCrypto),i={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw Ne(gA);return r.signPopToken(e.access_token,t.keyId,i)}else return e.access_token}async generateAuthenticationResult(e,t,r,i,a,o){const s=this.addTelemetryFromNativeResponse(e),c=e.scope?Un.fromString(e.scope):Un.fromString(t.scope),u=e.account.properties||{},h=u.UID||r.oid||r.sub||se.EMPTY_STRING,f=u.TenantId||r.tid||se.EMPTY_STRING,p=EA(i.getAccountInfo(),void 0,r,e.id_token);p.nativeAccountId!==e.account.id&&(p.nativeAccountId=e.account.id);const g=await this.generatePopAccessToken(e,t),v=t.tokenType===Wt.POP?Wt.POP:Wt.BEARER;return{authority:a,uniqueId:h,tenantId:f,scopes:c.asArray(),account:p,idToken:e.id_token,idTokenClaims:r,accessToken:g,fromCache:s?this.isResponseFromCache(s):!1,expiresOn:new Date(Number(o+e.expires_in)*1e3),tokenType:v,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}cacheAccount(e){this.browserStorage.setAccount(e),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,r,i,a,o,s){const c=$y(r,t.authority,e.id_token||"",t.clientId,i.tid||""),u=t.tokenType===Wt.POP?se.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,h=s+u,f=this.generateScopes(e,t),p=zy(r,t.authority,a,t.clientId,i.tid||o,f.printScopes(),h,0,no,void 0,t.tokenType,void 0,t.keyId),g={idToken:c,accessToken:p};this.nativeStorageManager.saveCacheRecord(g,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw Q4(Hy,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const r=new Pt(t);r.validateAsUri();const{scopes:i,...a}=e,o=new Un(i||[]);o.appendScopes(Gs);const s=()=>{switch(this.apiId){case fn.ssoSilent:case fn.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),lr.NONE}if(!e.prompt){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e.prompt){case lr.NONE:case lr.CONSENT:case lr.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),et(v6)}},c={...a,accountId:this.accountId,clientId:this.config.auth.clientId,authority:r.urlString,scope:o.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:s(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(c.signPopToken&&e.popKid)throw et(y6);if(this.handleExtraBrokerParams(c),c.extraParameters=c.extraParameters||{},c.extraParameters.telemetry=Ju.MATS_TELEMETRY,e.authenticationScheme===Wt.POP){const u={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},h=new ll(this.browserCrypto);let f;if(c.keyId)f=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:c.keyId})),c.signPopToken=!1;else{const p=await Be(h.generateCnf.bind(h),L.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(u,this.logger);f=p.reqCnfString,c.keyId=p.kid,c.signPopToken=!0}c.reqCnf=f}return this.addRequestSKUs(c),c}handleExtraBrokerParams(e){if(e.extraParameters&&e.extraParameters.hasOwnProperty(qS.BROKER_CLIENT_ID)&&e.extraParameters.hasOwnProperty(qS.BROKER_REDIRECT_URI)&&e.extraParameters.hasOwnProperty(Vd)){const t=e.extraParameters[Vd],r=e.redirectUri,i=e.extraParameters[qS.BROKER_REDIRECT_URI];e.extraParameters={child_client_id:t,child_redirect_uri:r},e.redirectUri=i}}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class Za{constructor(e,t,r,i){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=i,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(L.NativeMessageHandlerHandshake)}async sendMessage(e){this.logger.trace("NativeMessageHandler - sendMessage called.");const t={channel:Ju.CHANNEL_ID,extensionId:this.extensionId,responseId:lo(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise((r,i)=>{this.resolvers.set(t.responseId,{resolve:r,reject:i})})}static async createProvider(e,t,r){e.trace("NativeMessageHandler - createProvider called.");try{const i=new Za(e,t,r,Ju.PREFERRED_EXTENSION_ID);return await i.sendHandshakeRequest(),i}catch{const a=new Za(e,t,r);return await a.sendHandshakeRequest(),a}}async sendHandshakeRequest(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:Ju.CHANNEL_ID,extensionId:this.extensionId,responseId:lo(),body:{method:Uc.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(et(p6)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==Ju.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===Uc.HandshakeRequest){const r=this.handshakeResolvers.get(t.responseId);if(!r){this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),r.reject(et(m6))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,r=this.resolvers.get(t.responseId),i=this.handshakeResolvers.get(t.responseId);try{const a=t.body.method;if(a===Uc.Response){if(!r)return;const o=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(o)}`),o.status!=="Success")r.reject(K1(o.code,o.description,o.ext));else if(o.result)o.result.code&&o.result.description?r.reject(K1(o.result.code,o.result.description,o.result.ext)):r.resolve(o.result);else throw Q4(Hy,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(a===Uc.HandshakeResponse){if(!i){this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(a){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${a}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(a):i&&i.reject(a)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,r,i){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!r)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(i)switch(i){case Wt.BEARER:case Wt.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class zA{constructor(e,t,r,i,a){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=a}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(L.HandleCodeResponse,t.correlationId);let r;try{r=this.authModule.handleFragmentResponse(e,t.state)}catch(i){throw i instanceof co&&i.subError===dl?et(dl):i}return Be(this.handleCodeResponseFromServer.bind(this),L.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(r,t)}async handleCodeResponseFromServer(e,t,r=!0){if(this.performanceClient.addQueueMeasurement(L.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await Be(this.authModule.updateAuthority.bind(this.authModule),L.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const a=this.createCcsCredentials(t);a&&(this.authCodeRequest.ccsCredential=a)}return await Be(this.authModule.acquireToken.bind(this.authModule),L.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Ci.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:Ci.UPN}:null}}/*! @azure/msal-browser v3.26.1 2024-10-08 */function L6(n,e,t){const r=Xv(n);if(!r)throw Pj(n)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${n}`),et(Wj)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),et(qj));return r}function Sse(n,e,t){if(!n.state)throw et(PA);const r=M6(e,n.state);if(!r)throw et(Yj);if(r.interactionType!==t)throw et(Qj)}/*! @azure/msal-browser v3.26.1 2024-10-08 */class wse extends fh{constructor(e,t,r,i,a,o,s,c,u,h){super(e,t,r,i,a,o,s,u,h),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=c}acquireToken(e){try{const r={popupName:this.generatePopupName(e.scopes||Gs,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(e,r))}catch(t){return Promise.reject(t)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:(e==null?void 0:e.popupWindowAttributes)||{},popupWindowParent:(e==null?void 0:e.popupWindowParent)??window},i=e&&e.authority,a=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,i,a)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,i,a))}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t){var a;this.logger.verbose("acquireTokenPopupAsync called");const r=this.initializeServerTelemetryManager(fn.acquireTokenPopup),i=await Be(this.initializeAuthorizationRequest.bind(this),L.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,Ae.Popup);_6(i.authority);try{const o=await Be(this.initializeAuthorizationCodeRequest.bind(this),L.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(i),s=await Be(this.createAuthCodeClient.bind(this),L.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account}),c=Za.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let u;c&&(u=this.performanceClient.startMeasurement(L.FetchAccountIdWithNativeBroker,e.correlationId));const h=await s.getAuthCodeUrl({...i,nativeBroker:c}),f=new zA(s,this.browserStorage,o,this.logger,this.performanceClient),p=this.initiateAuthRequest(h,t);this.eventHandler.emitEvent(de.POPUP_OPENED,Ae.Popup,{popupWindow:p},null);const g=await this.monitorPopupForHash(p,t.popupWindowParent),v=Wl(L6,L.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(g,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(za.removeThrottle(this.browserStorage,this.config.auth.clientId,o),v.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),u&&u.end({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw et(um);const b=new hd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,fn.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,v.accountId,this.nativeStorage,i.correlationId),{userRequestState:C}=va.parseRequestState(this.browserCrypto,i.state);return await b.acquireToken({...i,state:C,prompt:void 0})}return await f.handleCodeResponse(v,i)}catch(o){throw(a=t.popup)==null||a.close(),o instanceof Mt&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),o}}async logoutPopupAsync(e,t,r,i){var o,s,c,u;this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(de.LOGOUT_START,Ae.Popup,e);const a=this.initializeServerTelemetryManager(fn.logoutPopup);try{await this.clearCacheOnLogout(e.account);const h=await Be(this.createAuthCodeClient.bind(this),L.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:a,requestAuthority:r,account:e.account||void 0});try{h.authority.endSessionEndpoint}catch{if((o=e.account)!=null&&o.homeAccountId&&e.postLogoutRedirectUri&&h.authority.protocolMode===Po.OIDC){if(this.browserStorage.removeAccount((s=e.account)==null?void 0:s.homeAccountId),this.eventHandler.emitEvent(de.LOGOUT_SUCCESS,Ae.Popup,e),i){const g={apiId:fn.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},v=Pt.getAbsoluteUrl(i,fa());await this.navigationClient.navigateInternal(v,g)}(c=t.popup)==null||c.close();return}}const f=h.getLogoutUri(e);this.eventHandler.emitEvent(de.LOGOUT_SUCCESS,Ae.Popup,e);const p=this.openPopup(f,t);if(this.eventHandler.emitEvent(de.POPUP_OPENED,Ae.Popup,{popupWindow:p},null),await this.monitorPopupForHash(p,t.popupWindowParent).catch(()=>{}),i){const g={apiId:fn.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},v=Pt.getAbsoluteUrl(i,fa());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${v}`),await this.navigationClient.navigateInternal(v,g)}else this.logger.verbose("No main window navigation requested")}catch(h){throw(u=t.popup)==null||u.close(),h instanceof Mt&&(h.setCorrelationId(this.correlationId),a.cacheFailedRequest(h)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(de.LOGOUT_FAILURE,Ae.Popup,null,h),this.eventHandler.emitEvent(de.LOGOUT_END,Ae.Popup),h}this.eventHandler.emitEvent(de.LOGOUT_END,Ae.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),et(Wy)}monitorPopupForHash(e,t){return new Promise((r,i)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const a=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(a),i(et(dl));return}let o="";try{o=e.location.href}catch{}if(!o||o==="about:blank")return;clearInterval(a);let s="";const c=this.config.auth.OIDCOptions.serverResponseType;e&&(c===lm.QUERY?s=e.location.search:s=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),r(s)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw et(Xj);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(r){throw this.logger.error("error opening popup "+r.message),this.browserStorage.setInteractionInProgress(!1),et(Zj)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:i}){var g,v,y,b;const a=i.screenLeft?i.screenLeft:i.screenX,o=i.screenTop?i.screenTop:i.screenY,s=i.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=i.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let u=(g=r.popupSize)==null?void 0:g.width,h=(v=r.popupSize)==null?void 0:v.height,f=(y=r.popupPosition)==null?void 0:y.top,p=(b=r.popupPosition)==null?void 0:b.left;return(!u||u<0||u>s)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),u=bi.POPUP_WIDTH),(!h||h<0||h>c)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),h=bi.POPUP_HEIGHT),(!f||f<0||f>c)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),f=Math.max(0,c/2-bi.POPUP_HEIGHT/2+o)),(!p||p<0||p>s)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),p=Math.max(0,s/2-bi.POPUP_WIDTH/2+a)),i.open(e,t,`width=${u}, height=${h}, top=${f}, left=${p}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(Ae.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${bi.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${bi.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class PR{constructor(e,t,r,i,a){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=a}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(Qt.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(Qt.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const r={apiId:fn.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};if(typeof t.onRedirectNavigate=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),t.onRedirectNavigate(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await t.navigationClient.navigateExternal(e,r);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await t.navigationClient.navigateExternal(e,r);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),et(Wy)}async handleCodeResponse(e,t){this.logger.verbose("RedirectHandler.handleCodeResponse called"),this.browserStorage.setInteractionInProgress(!1);const r=this.browserStorage.generateStateKey(t),i=this.browserStorage.getTemporaryCache(r);if(!i)throw Ne(Yv,"Cached State");let a;try{a=this.authModule.handleFragmentResponse(e,i)}catch(u){throw u instanceof co&&u.subError===dl?et(dl):u}const o=this.browserStorage.generateNonceKey(i),s=this.browserStorage.getTemporaryCache(o);if(this.authCodeRequest.code=a.code,a.cloud_instance_host_name&&await Be(this.authModule.updateAuthority.bind(this.authModule),L.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,this.authCodeRequest.correlationId)(a.cloud_instance_host_name,this.authCodeRequest.correlationId),a.nonce=s||void 0,a.state=i,a.client_info)this.authCodeRequest.clientInfo=a.client_info;else{const u=this.checkCcsCredentials();u&&(this.authCodeRequest.ccsCredential=u)}const c=await this.authModule.acquireToken(this.authCodeRequest,a);return this.browserStorage.cleanRequestByState(t),c}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(Qt.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}/*! @azure/msal-browser v3.26.1 2024-10-08 */function Ese(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;const n=window.performance.getEntriesByType("navigation"),e=n.length?n[0]:void 0;return e==null?void 0:e.type}class Tse extends fh{constructor(e,t,r,i,a,o,s,c,u,h){super(e,t,r,i,a,o,s,u,h),this.nativeStorage=c}async acquireToken(e){const t=await Be(this.initializeAuthorizationRequest.bind(this),L.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,Ae.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null);const r=this.initializeServerTelemetryManager(fn.acquireTokenRedirect),i=a=>{a.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent(de.RESTORE_FROM_BFCACHE,Ae.Redirect))};try{const a=await Be(this.initializeAuthorizationCodeRequest.bind(this),L.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(t),o=await Be(this.createAuthCodeClient.bind(this),L.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),s=new PR(o,this.browserStorage,a,this.logger,this.performanceClient),c=await o.getAuthCodeUrl({...t,nativeBroker:Za.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}),u=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${u}`),window.addEventListener("pageshow",i),await s.initiateAuthRequest(c,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:u,onRedirectNavigate:e.onRedirectNavigate||this.config.auth.onRedirectNavigate})}catch(a){throw a instanceof Mt&&(a.setCorrelationId(this.correlationId),r.cacheFailedRequest(a)),window.removeEventListener("pageshow",i),this.browserStorage.cleanRequestByState(t.state),a}}async handleRedirectPromise(e="",t){const r=this.initializeServerTelemetryManager(fn.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[i,a]=this.getRedirectResponse(e||"");if(!i)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(Ae.Redirect),Ese()!=="back_forward"?t.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const o=this.browserStorage.getTemporaryCache(Qt.ORIGIN_URI,!0)||se.EMPTY_STRING,s=Pt.removeHashFromUrl(o),c=Pt.removeHashFromUrl(window.location.href);if(s===c&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),o.indexOf("#")>-1&&Foe(o),await this.handleResponse(i,r);if(this.config.auth.navigateToLoginRequestUrl){if(!FA()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(Qt.URL_HASH,a,!0);const u={apiId:fn.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let h=!0;if(!o||o==="null"){const f=Hoe();this.browserStorage.setTemporaryCache(Qt.ORIGIN_URI,f,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),h=await this.navigationClient.navigateInternal(f,u)}else this.logger.verbose(`Navigating to loginRequestUrl: ${o}`),h=await this.navigationClient.navigateInternal(o,u);if(!h)return await this.handleResponse(i,r)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(i,r);return null}catch(i){throw i instanceof Mt&&(i.setCorrelationId(this.correlationId),r.cacheFailedRequest(i)),this.browserStorage.cleanRequestByInteractionType(Ae.Redirect),i}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===lm.QUERY?t=window.location.search:t=window.location.hash);let r=Xv(t);if(r){try{Sse(r,this.browserCrypto,Ae.Redirect)}catch(a){return a instanceof Mt&&this.logger.error(`Interaction type validation failed due to ${a.errorCode}: ${a.errorMessage}`),[null,""]}return Uoe(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}const i=this.browserStorage.getTemporaryCache(Qt.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Qt.URL_HASH)),i&&(r=Xv(i),r)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,i]):[null,""]}async handleResponse(e,t){const r=e.state;if(!r)throw et(PA);const i=this.browserStorage.getCachedRequest(r);if(this.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw et(um);const c=new hd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,fn.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,e.accountId,this.nativeStorage,i.correlationId),{userRequestState:u}=va.parseRequestState(this.browserCrypto,r);return c.acquireToken({...i,state:u,prompt:void 0}).finally(()=>{this.browserStorage.cleanRequestByState(r)})}const a=this.browserStorage.getCachedAuthority(r);if(!a)throw et(NA);const o=await Be(this.createAuthCodeClient.bind(this),L.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:a});return za.removeThrottle(this.browserStorage,this.config.auth.clientId,i),new PR(o,this.browserStorage,i,this.logger,this.performanceClient).handleCodeResponse(e,r)}async logout(e){var i,a;this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(fn.logout);try{this.eventHandler.emitEvent(de.LOGOUT_START,Ae.Redirect,e),await this.clearCacheOnLogout(t.account);const o={apiId:fn.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},s=await Be(this.createAuthCodeClient.bind(this),L.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e==null?void 0:e.extraQueryParameters,account:e&&e.account||void 0});if(s.authority.protocolMode===Po.OIDC)try{s.authority.endSessionEndpoint}catch{if((i=t.account)!=null&&i.homeAccountId){this.browserStorage.removeAccount((a=t.account)==null?void 0:a.homeAccountId),this.eventHandler.emitEvent(de.LOGOUT_SUCCESS,Ae.Redirect,t);return}}const c=s.getLogoutUri(t);if(this.eventHandler.emitEvent(de.LOGOUT_SUCCESS,Ae.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(c)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(c,o);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(c,o);return}}catch(o){throw o instanceof Mt&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),this.eventHandler.emitEvent(de.LOGOUT_FAILURE,Ae.Redirect,null,o),this.eventHandler.emitEvent(de.LOGOUT_END,Ae.Redirect),o}this.eventHandler.emitEvent(de.LOGOUT_END,Ae.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return Pt.getAbsoluteUrl(t,fa())}}/*! @azure/msal-browser v3.26.1 2024-10-08 */async function Ise(n,e,t,r,i){if(e.addQueueMeasurement(L.SilentHandlerInitiateAuthRequest,r),!n)throw t.info("Navigate url is empty"),et(Wy);return i?Be(kse,L.SilentHandlerLoadFrame,t,e,r)(n,i,e,r):Wl(xse,L.SilentHandlerLoadFrameSync,t,e,r)(n)}async function Ase(n,e,t,r,i,a,o){return r.addQueueMeasurement(L.SilentHandlerMonitorIframeForHash,a),new Promise((s,c)=>{e<ib&&i.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${ib}ms). This may result in timeouts.`);const u=window.setTimeout(()=>{window.clearInterval(h),c(et(e6))},e),h=window.setInterval(()=>{let f="";const p=n.contentWindow;try{f=p?p.location.href:""}catch{}if(!f||f==="about:blank")return;let g="";p&&(o===lm.QUERY?g=p.location.search:g=p.location.hash),window.clearTimeout(u),window.clearInterval(h),s(g)},t)}).finally(()=>{Wl(_se,L.RemoveHiddenIframe,i,r,a)(n)})}function kse(n,e,t,r){return t.addQueueMeasurement(L.SilentHandlerLoadFrame,r),new Promise((i,a)=>{const o=D6();window.setTimeout(()=>{if(!o){a("Unable to load iframe");return}o.src=n,i(o)},e)})}function xse(n){const e=D6();return e.src=n,e}function D6(){const n=document.createElement("iframe");return n.className="msalSilentIframe",n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(n),n}function _se(n){document.body===n.parentNode&&document.body.removeChild(n)}/*! @azure/msal-browser v3.26.1 2024-10-08 */class Mse extends fh{constructor(e,t,r,i,a,o,s,c,u,h,f){super(e,t,r,i,a,o,c,h,f),this.apiId=s,this.nativeStorage=u}async acquireToken(e){this.performanceClient.addQueueMeasurement(L.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==lr.NONE&&t.prompt!==lr.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${lr.NONE}`),t.prompt=lr.NONE):t.prompt=lr.NONE;const r=await Be(this.initializeAuthorizationRequest.bind(this),L.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,Ae.Silent);_6(r.authority);const i=this.initializeServerTelemetryManager(this.apiId);let a;try{return a=await Be(this.createAuthCodeClient.bind(this),L.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:i,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),await Be(this.silentTokenHelper.bind(this),L.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(a,r)}catch(o){if(o instanceof Mt&&(o.setCorrelationId(this.correlationId),i.cacheFailedRequest(o)),!a||!(o instanceof Mt)||o.errorCode!==bi.INVALID_GRANT_ERROR)throw o;this.performanceClient.addFields({retryError:o.errorCode},this.correlationId);const s=await Be(this.initializeAuthorizationRequest.bind(this),L.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,Ae.Silent);return await Be(this.silentTokenHelper.bind(this),L.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(a,s)}}logout(){return Promise.reject(et(Yy))}async silentTokenHelper(e,t){const r=t.correlationId;this.performanceClient.addQueueMeasurement(L.SilentIframeClientTokenHelper,r);const i=await Be(this.initializeAuthorizationCodeRequest.bind(this),L.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,r)(t),a=await Be(e.getAuthCodeUrl.bind(e),L.GetAuthCodeUrl,this.logger,this.performanceClient,r)({...t,nativeBroker:Za.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}),o=new zA(e,this.browserStorage,i,this.logger,this.performanceClient),s=await Be(Ise,L.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(a,this.performanceClient,this.logger,r,this.config.system.navigateFrameWait),c=this.config.auth.OIDCOptions.serverResponseType,u=await Be(Ase,L.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(s,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,r,c),h=Wl(L6,L.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(u,c,this.logger);if(h.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw et(um);const f=new hd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,h.accountId,this.browserStorage,r),{userRequestState:p}=va.parseRequestState(this.browserCrypto,t.state);return Be(f.acquireToken.bind(f),L.NativeInteractionClientAcquireToken,this.logger,this.performanceClient,r)({...t,state:p,prompt:t.prompt||lr.NONE})}return Be(o.handleCodeResponse.bind(o),L.HandleCodeResponse,this.logger,this.performanceClient,r)(h,t)}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class Rse extends fh{async acquireToken(e){this.performanceClient.addQueueMeasurement(L.SilentRefreshClientAcquireToken,e.correlationId);const t=await Be($A,L.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),r={...e,...t};e.redirectUri&&(r.redirectUri=this.getRedirectUri(e.redirectUri));const i=this.initializeServerTelemetryManager(fn.acquireTokenSilent_silentFlow),a=await this.createRefreshTokenClient({serverTelemetryManager:i,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return Be(a.acquireTokenByRefreshToken.bind(a),L.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(r).catch(o=>{throw o.setCorrelationId(this.correlationId),i.cacheFailedRequest(o),o})}logout(){return Promise.reject(et(Yy))}async createRefreshTokenClient(e){const t=await Be(this.getClientConfiguration.bind(this),L.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new H1(t,this.performanceClient)}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class Pse{constructor(e,t,r,i){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=i}loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw et(OA);const i=t.id_token?ql(t.id_token,no):void 0,a={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},o=e.authority?new wr(wr.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,a,this.logger,e.correlationId||lo()):void 0,s=this.loadAccount(e,r.clientInfo||t.client_info||"",i,o),c=this.loadIdToken(t,s.homeAccountId,s.environment,s.realm),u=this.loadAccessToken(e,t,s.homeAccountId,s.environment,s.realm,r),h=this.loadRefreshToken(t,s.homeAccountId,s.environment);return this.generateAuthenticationResult(e,{account:s,idToken:c,accessToken:u,refreshToken:h},i,o)}loadAccount(e,t,r,i){if(this.logger.verbose("TokenCache - loading account"),e.account){const c=Xn.createFromAccountInfo(e.account);return this.storage.setAccount(c),c}else if(!i||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),et(l6);const a=Xn.generateHomeAccountId(t,i.authorityType,this.logger,this.cryptoObj,r),o=r==null?void 0:r.tid,s=xA(this.storage,i,a,no,r,t,i.hostnameAndPort,o,void 0,void 0,this.logger);return this.storage.setAccount(s),s}loadIdToken(e,t,r,i){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const a=$y(t,r,e.id_token,this.config.auth.clientId,i);return this.storage.setIdTokenCredential(a),a}loadAccessToken(e,t,r,i,a,o){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");const s=t.scope?Un.fromString(t.scope):new Un(e.scopes),c=o.expiresOn||t.expires_in+new Date().getTime()/1e3,u=o.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+new Date().getTime()/1e3,h=zy(r,i,t.access_token,this.config.auth.clientId,a,s.printScopes(),c,u,no);return this.storage.setAccessTokenCredential(h),h}loadRefreshToken(e,t,r){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const i=gj(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return this.storage.setRefreshTokenCredential(i),i}generateAuthenticationResult(e,t,r,i){var h,f,p;let a="",o=[],s=null,c;t!=null&&t.accessToken&&(a=t.accessToken.secret,o=Un.fromString(t.accessToken.target).asArray(),s=new Date(Number(t.accessToken.expiresOn)*1e3),c=new Date(Number(t.accessToken.extendedExpiresOn)*1e3));const u=t.account;return{authority:i?i.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:o,account:u.getAccountInfo(),idToken:((h=t.idToken)==null?void 0:h.secret)||"",idTokenClaims:r||{},accessToken:a,fromCache:!0,expiresOn:s,correlationId:e.correlationId||"",requestId:"",extExpiresOn:c,familyId:((f=t.refreshToken)==null?void 0:f.familyId)||"",tokenType:((p=t==null?void 0:t.accessToken)==null?void 0:p.tokenType)||"",state:e.state||"",cloudGraphHostName:u.cloudGraphHostName||"",msGraphHost:u.msGraphHost||"",fromNativeBroker:!1}}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class Nse extends Hj{constructor(e){super(e),this.includeRedirectUri=!1}}/*! @azure/msal-browser v3.26.1 2024-10-08 */class Ose extends fh{constructor(e,t,r,i,a,o,s,c,u,h){super(e,t,r,i,a,o,c,u,h),this.apiId=s}async acquireToken(e){if(!e.code)throw et(u6);const t=await Be(this.initializeAuthorizationRequest.bind(this),L.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,Ae.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{const i={...t,code:e.code},a=await Be(this.getClientConfiguration.bind(this),L.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),o=new Nse(a);this.logger.verbose("Auth code client created");const s=new zA(o,this.browserStorage,i,this.logger,this.performanceClient);return await Be(s.handleCodeResponseFromServer.bind(s),L.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(i){throw i instanceof Mt&&(i.setCorrelationId(this.correlationId),r.cacheFailedRequest(i)),i}}logout(){return Promise.reject(et(Yy))}}/*! @azure/msal-browser v3.26.1 2024-10-08 */function xa(n){const e=n==null?void 0:n.idTokenClaims;if(e!=null&&e.tfp||e!=null&&e.acr)return"B2C";if(e!=null&&e.tid){if((e==null?void 0:e.tid)==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}function ag(n,e){try{No(n)}catch(t){throw e.end({success:!1},t),t}}class Zy{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new pl(this.logger,this.performanceClient):Qv,this.eventHandler=new R6(this.logger),this.browserStorage=this.isBrowserEnvironment?new G1(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,Yae(this.config.auth),this.performanceClient):Xoe(this.config.auth.clientId,this.logger);const t={cacheLocation:_n.MemoryStorage,temporaryCacheLocation:_n.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new G1(this.config.auth.clientId,t,this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new Pse(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this),this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}static async createController(e,t){const r=new Zy(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,this.eventHandler.emitEvent(de.INITIALIZE_END);return}const t=(e==null?void 0:e.correlationId)||this.getRequestCorrelationId(),r=this.config.system.allowNativeBroker,i=this.performanceClient.startMeasurement(L.InitializeClientApplication,t);if(this.eventHandler.emitEvent(de.INITIALIZE_START),r)try{this.nativeExtensionProvider=await Za.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(a){this.logger.verbose(a)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),await Be(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),L.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,t)(this.performanceClient,t)),this.initialized=!0,this.eventHandler.emitEvent(de.INITIALIZE_END),i.end({allowNativeBroker:r,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),BA(this.initialized),this.isBrowserEnvironment){const t=e||"";let r=this.redirectResponse.get(t);return typeof r>"u"?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){const t=this.getAllAccounts(),r=this.browserStorage.getCachedNativeRequest(),i=r&&Za.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e,a=i?r==null?void 0:r.correlationId:this.browserStorage.getTemporaryCache(Qt.CORRELATION_ID,!0)||"",o=this.performanceClient.startMeasurement(L.AcquireTokenRedirect,a);this.eventHandler.emitEvent(de.HANDLE_REDIRECT_START,Ae.Redirect);let s;if(i&&this.nativeExtensionProvider){this.logger.trace("handleRedirectPromise - acquiring token from native platform");const c=new hd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,fn.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,r.accountId,this.nativeInternalStorage,r.correlationId);s=Be(c.handleRedirectPromise.bind(c),L.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,o.event.correlationId)(this.performanceClient,o.event.correlationId)}else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");const c=this.createRedirectClient(a);s=Be(c.handleRedirectPromise.bind(c),L.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,o.event.correlationId)(e,o)}return s.then(c=>(c?(t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(de.LOGIN_SUCCESS,Ae.Redirect,c),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_SUCCESS,Ae.Redirect,c),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),o.end({success:!0,accountType:xa(c.account)})):o.event.errorCode?o.end({success:!1}):o.discard(),this.eventHandler.emitEvent(de.HANDLE_REDIRECT_END,Ae.Redirect),c)).catch(c=>{const u=c;throw t.length>0?this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_FAILURE,Ae.Redirect,null,u):this.eventHandler.emitEvent(de.LOGIN_FAILURE,Ae.Redirect,null,u),this.eventHandler.emitEvent(de.HANDLE_REDIRECT_END,Ae.Redirect),o.end({success:!1},u),c})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const r=this.performanceClient.startMeasurement(L.AcquireTokenPreRedirect,t);r.add({accountType:xa(e.account),scenarioId:e.scenarioId});const i=e.onRedirectNavigate;if(i)e.onRedirectNavigate=o=>{const s=typeof i=="function"?i(o):void 0;return s!==!1?r.end({success:!0}):r.discard(),s};else{const o=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=s=>{const c=typeof o=="function"?o(s):void 0;return c!==!1?r.end({success:!0}):r.discard(),c}}const a=this.getAllAccounts().length>0;try{MR(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),a?this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_START,Ae.Redirect,e):this.eventHandler.emitEvent(de.LOGIN_START,Ae.Redirect,e);let o;return this.nativeExtensionProvider&&this.canUseNative(e)?o=new hd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,fn.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch(c=>{if(c instanceof Va&&Fu(c))return this.nativeExtensionProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(c instanceof Gr)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),c}):o=this.createRedirectClient(t).acquireToken(e),await o}catch(o){throw r.end({success:!1},o),a?this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_FAILURE,Ae.Redirect,null,o):this.eventHandler.emitEvent(de.LOGIN_FAILURE,Ae.Redirect,null,o),o}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(L.AcquireTokenPopup,t);r.add({scenarioId:e.scenarioId,accountType:xa(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),ag(this.initialized,r),this.browserStorage.setInteractionInProgress(!0)}catch(o){return Promise.reject(o)}const i=this.getAllAccounts();i.length>0?this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_START,Ae.Popup,e):this.eventHandler.emitEvent(de.LOGIN_START,Ae.Popup,e);let a;return this.canUseNative(e)?a=this.acquireTokenNative({...e,correlationId:t},fn.acquireTokenPopup).then(o=>(this.browserStorage.setInteractionInProgress(!1),r.end({success:!0,isNativeBroker:!0,requestId:o.requestId,accountType:xa(o.account)}),o)).catch(o=>{if(o instanceof Va&&Fu(o))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(o instanceof Gr)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),o}):a=this.createPopupClient(t).acquireToken(e),a.then(o=>(i.length<this.getAllAccounts().length?this.eventHandler.emitEvent(de.LOGIN_SUCCESS,Ae.Popup,o):this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_SUCCESS,Ae.Popup,o),r.end({success:!0,requestId:o.requestId,accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length,accountType:xa(o.account)}),o)).catch(o=>(i.length>0?this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_FAILURE,Ae.Popup,null,o):this.eventHandler.emitEvent(de.LOGIN_FAILURE,Ae.Popup,null,o),r.end({success:!1},o),Promise.reject(o)))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){var a,o;const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(L.SsoSilent,t),(a=this.ssoSilentMeasurement)==null||a.add({scenarioId:e.scenarioId,accountType:xa(e.account)}),ag(this.initialized,this.ssoSilentMeasurement),(o=this.ssoSilentMeasurement)==null||o.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(de.SSO_SILENT_START,Ae.Silent,r);let i;return this.canUseNative(r)?i=this.acquireTokenNative(r,fn.ssoSilent).catch(s=>{if(s instanceof Va&&Fu(s))return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw s}):i=this.createSilentIframeClient(r.correlationId).acquireToken(r),i.then(s=>{var c;return this.eventHandler.emitEvent(de.SSO_SILENT_SUCCESS,Ae.Silent,s),(c=this.ssoSilentMeasurement)==null||c.end({success:!0,isNativeBroker:s.fromNativeBroker,requestId:s.requestId,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:xa(s.account)}),s}).catch(s=>{var c;throw this.eventHandler.emitEvent(de.SSO_SILENT_FAILURE,Ae.Silent,null,s),(c=this.ssoSilentMeasurement)==null||c.end({success:!1},s),s}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const r=this.performanceClient.startMeasurement(L.AcquireTokenByCode,t);ag(this.initialized,r),this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_BY_CODE_START,Ae.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw et(h6);if(e.code){const i=e.code;let a=this.hybridAuthCodeResponses.get(i);return a?(this.logger.verbose("Existing acquireTokenByCode request found",t),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),a=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(o=>(this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_BY_CODE_SUCCESS,Ae.Silent,o),this.hybridAuthCodeResponses.delete(i),r.end({success:!0,isNativeBroker:o.fromNativeBroker,requestId:o.requestId,accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length,accountType:xa(o.account)}),o)).catch(o=>{throw this.hybridAuthCodeResponses.delete(i),this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_BY_CODE_FAILURE,Ae.Silent,null,o),r.end({success:!1},o),o}),this.hybridAuthCodeResponses.set(i,a)),await a}else if(e.nativeAccountId)if(this.canUseNative(e,e.nativeAccountId)){const i=await this.acquireTokenNative({...e,correlationId:t},fn.acquireTokenByCode,e.nativeAccountId).catch(a=>{throw a instanceof Va&&Fu(a)&&(this.nativeExtensionProvider=void 0),a});return r.end({accountType:xa(i.account),success:!0}),i}else throw et(f6);else throw et(d6)}catch(i){throw this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_BY_CODE_FAILURE,Ae.Silent,null,i),r.end({success:!1},i),i}}async acquireTokenByCodeAsync(e){var i;return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(L.AcquireTokenByCodeAsync,e.correlationId),(i=this.acquireTokenByCodeAsyncMeasurement)==null||i.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(a=>{var o;return(o=this.acquireTokenByCodeAsyncMeasurement)==null||o.end({success:!0,fromCache:a.fromCache,isNativeBroker:a.fromNativeBroker,requestId:a.requestId}),a}).catch(a=>{var o;throw(o=this.acquireTokenByCodeAsyncMeasurement)==null||o.end({success:!1},a),a}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(L.AcquireTokenFromCache,e.correlationId),t){case Wn.Default:case Wn.AccessToken:case Wn.AccessTokenAndRefreshToken:const r=this.createSilentCacheClient(e.correlationId);return Be(r.acquireToken.bind(r),L.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw Ne(Ja)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(L.AcquireTokenByRefreshToken,e.correlationId),t){case Wn.Default:case Wn.AccessTokenAndRefreshToken:case Wn.RefreshToken:case Wn.RefreshTokenAndNetwork:const r=this.createSilentRefreshClient(e.correlationId);return Be(r.acquireToken.bind(r),L.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw Ne(Ja)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(L.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return Be(t.acquireToken.bind(t),L.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return MR(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return No(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(t){return Promise.reject(t)}}async clearCache(e){if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, returning early.");return}const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return ese(this.logger,this.browserStorage,this.isBrowserEnvironment,e)}getAccount(e){return tse(e,this.logger,this.browserStorage)}getAccountByUsername(e){return nse(e,this.logger,this.browserStorage)}getAccountByHomeId(e){return rse(e,this.logger,this.browserStorage)}getAccountByLocalId(e){return ise(e,this.logger,this.browserStorage)}setActiveAccount(e){ase(e,this.browserStorage)}getActiveAccount(){return ose(this.browserStorage)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=Xn.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return this.browserStorage.setAccount(r),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw et(um);return new hd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!Za.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case lr.NONE:case lr.CONSENT:case lr.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new wse(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new Tse(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new Mse(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,fn.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new O6(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new Rse(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new Ose(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,fn.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return x6(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}handleAccountCacheChange(e){var t;try{(t=e.key)!=null&&t.includes(ir.ACTIVE_ACCOUNT_FILTERS)&&this.eventHandler.emitEvent(de.ACTIVE_ACCOUNT_CHANGED);const r=e.newValue||e.oldValue;if(!r)return;const i=JSON.parse(r);if(typeof i!="object"||!Xn.isAccountEntity(i))return;const o=zd.toObject(new Xn,i).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.eventHandler.emitEvent(de.ACCOUNT_ADDED,void 0,o)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.eventHandler.emitEvent(de.ACCOUNT_REMOVED,void 0,o))}catch{return}}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?lo():se.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||kR})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||kR})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(L.AcquireTokenSilent,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),ag(this.initialized,r),this.logger.verbose("acquireTokenSilent called",t);const i=e.account||this.getActiveAccount();if(!i)throw et(i6);r.add({accountType:xa(i)});const a={clientId:this.config.auth.clientId,authority:e.authority||se.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:i.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},o=JSON.stringify(a),s=this.activeSilentTokenRequests.get(o);if(typeof s>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t);const c=Be(this.acquireTokenSilentAsync.bind(this),L.AcquireTokenSilentAsync,this.logger,this.performanceClient,t)({...e,correlationId:t},i).then(u=>(this.activeSilentTokenRequests.delete(o),r.end({success:!0,fromCache:u.fromCache,isNativeBroker:u.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,requestId:u.requestId,accessTokenSize:u.accessToken.length,idTokenSize:u.idToken.length}),u)).catch(u=>{throw this.activeSilentTokenRequests.delete(o),r.end({success:!1},u),u});return this.activeSilentTokenRequests.set(o,c),{...await c,state:e.state}}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),r.discard(),{...await s,state:e.state}}async acquireTokenSilentAsync(e,t){const r=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(L.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_START,Ae.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const i=await Be(dse,L.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),a=e.cacheLookupPolicy||Wn.Default;return this.acquireTokenSilentNoIframe(i,a).catch(async s=>{if(Lse(s,a))if(this.activeIframeRequest)if(a!==Wn.Skip){const[u,h]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${h}`,i.correlationId);const f=this.performanceClient.startMeasurement(L.AwaitConcurrentIframe,i.correlationId);f.add({awaitIframeCorrelationId:h});const p=await u;if(f.end({success:p}),p)return this.logger.verbose(`Parallel iframe request with correlationId: ${h} succeeded. Retrying cache and/or RT redemption`,i.correlationId),this.acquireTokenSilentNoIframe(i,a);throw this.logger.info(`Iframe request with correlationId: ${h} failed. Interaction is required.`),s}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",i.correlationId),Be(this.acquireTokenBySilentIframe.bind(this),L.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i);else{let u;return this.activeIframeRequest=[new Promise(h=>{u=h}),i.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",i.correlationId),Be(this.acquireTokenBySilentIframe.bind(this),L.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i).then(h=>(u(!0),h)).catch(h=>{throw u(!1),h}).finally(()=>{this.activeIframeRequest=void 0})}else throw s}).then(s=>(this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_SUCCESS,Ae.Silent,s),e.correlationId&&this.performanceClient.addFields({fromCache:s.fromCache,isNativeBroker:s.fromNativeBroker,requestId:s.requestId},e.correlationId),s)).catch(s=>{throw this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_FAILURE,Ae.Silent,null,s),s}).finally(()=>{document.removeEventListener("visibilitychange",r)})}async acquireTokenSilentNoIframe(e,t){return Za.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.acquireTokenNative(e,fn.acquireTokenSilent_silentFlow).catch(async r=>{throw r instanceof Va&&Fu(r)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,Ne(Ja)):r})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),Be(this.acquireTokenFromCache.bind(this),L.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(r=>{if(t===Wn.AccessToken)throw r;return this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_NETWORK_START,Ae.Silent,e),Be(this.acquireTokenByRefreshToken.bind(this),L.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}}function Lse(n,e){const t=!(n instanceof Gr&&n.subError!==qy),r=n.errorCode===bi.INVALID_GRANT_ERROR||n.errorCode===Ja,i=t&&r||n.errorCode===tb||n.errorCode===kA,a=Toe.includes(e);return i&&a}/*! @azure/msal-browser v3.26.1 2024-10-08 */async function Dse(n,e){const t=new fl(n);return await t.initialize(),Zy.createController(t,e)}/*! @azure/msal-browser v3.26.1 2024-10-08 */let jse=class j6{static async createPublicClientApplication(e){const t=await Dse(e);return new j6(e,t)}constructor(e,t){this.controller=t||new Zy(new fl(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}};/*! @azure/msal-browser v3.26.1 2024-10-08 */class NR{constructor(e,t){const r=t&&t.loggerOptions||{};this.logger=new Ca(r,ab,hl),this.cryptoOps=new pl(this.logger),this.popTokenGenerator=new ll(this.cryptoOps),this.shrParameters=e}async generatePublicKeyThumbprint(){const{kid:e}=await this.popTokenGenerator.generateKid(this.shrParameters);return e}async signRequest(e,t,r){return this.popTokenGenerator.signPayload(e,t,this.shrParameters,r)}async removeKeys(e){return this.cryptoOps.removeTokenBindingKey(e)}}function OR(){let n;try{n=window[_n.SessionStorage];const e=n==null?void 0:n.getItem(koe);if(Number(e)===1)return $(()=>import("./BrowserPerformanceMeasurement-CIsv1iQ0.js"),[])}catch{}}function Yg(){return typeof window<"u"&&typeof window.performance<"u"&&typeof window.performance.now=="function"}function Use(n){if(!(!n||!Yg()))return Math.round(window.performance.now()-n)}class Fse extends moe{constructor(e,t,r){var i,a;super(e.auth.clientId,e.auth.authority||`${se.DEFAULT_AUTHORITY}`,new Ca(((i=e.system)==null?void 0:i.loggerOptions)||{},ab,hl),ab,hl,((a=e.telemetry)==null?void 0:a.application)||{appName:"",appVersion:""},t,r)}generateId(){return lo()}getPageVisibility(){var e;return((e=document.visibilityState)==null?void 0:e.toString())||null}deleteIncompleteSubMeasurements(e){var t;(t=OR())==null||t.then(r=>{const i=this.eventsByCorrelationId.get(e.event.correlationId),a=i&&i.eventId===e.event.eventId,o=[];a&&(i!=null&&i.incompleteSubMeasurements)&&i.incompleteSubMeasurements.forEach(s=>{o.push({...s})}),r.BrowserPerformanceMeasurement.flushMeasurements(e.event.correlationId,o)})}startMeasurement(e,t){var s;const r=this.getPageVisibility(),i=super.startMeasurement(e,t),a=Yg()?window.performance.now():void 0,o=(s=OR())==null?void 0:s.then(c=>new c.BrowserPerformanceMeasurement(e,i.event.correlationId));return o==null||o.then(c=>c.startMeasurement()),{...i,end:(c,u)=>{const h=i.end({...c,startPageVisibility:r,endPageVisibility:this.getPageVisibility(),durationMs:Use(a)},u);return o==null||o.then(f=>f.endMeasurement()),this.deleteIncompleteSubMeasurements(i),h},discard:()=>{i.discard(),o==null||o.then(c=>c.flushMeasurement()),this.deleteIncompleteSubMeasurements(i)}}}setPreQueueTime(e,t){if(!Yg()){this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to set telemetry queue time for ${e}`);return}if(!t){this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to set telemetry queue time`);return}const r=this.preQueueTimeByCorrelationId.get(t);r&&(this.logger.trace(`BrowserPerformanceClient: Incomplete pre-queue ${r.name} found`,t),this.addQueueMeasurement(r.name,t,void 0,!0)),this.preQueueTimeByCorrelationId.set(t,{name:e,time:window.performance.now()})}addQueueMeasurement(e,t,r,i){if(!Yg()){this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to add queue measurement for ${e}`);return}if(!t){this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to add queue measurement`);return}const a=super.getPreQueueTime(e,t);if(!a)return;const o=window.performance.now(),s=r||super.calculateQueuedTime(a,o);return super.addQueueMeasurement(e,t,s,i)}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */const At={...L,PairwiseBrokerApplicationInitializeBrokering:"pairwiseBrokerApplicationInitializeBrokering",BrokerClientApplicationHandleBrokerHandshake:"brokerClientApplicationHandleBrokerHandshake",BrokerClientApplicationBrokeredSSOSilentRequest:"brokerClientApplicationBrokeredSSOSilentRequest",BrokerClientApplicationBrokeredSilentRequest:"brokerClientApplicationBrokeredSilentRequest",EmbeddedClientApplicationSendSSOSilentRequest:"embeddedSSOSilent",EmbeddedClientApplicationSendPopupRequest:"embeddedPopup",EmbeddedClientApplicationSendRedirectRequest:"embeddedRedirect",EmbeddedClientApplicationHandleRedirectRequest:"embeddedHandleRedirect",EmbeddedClientApplicationSendSilentRefreshRequest:"embeddedSilentRefresh"},Bse=new Map([[At.PairwiseBrokerApplicationInitializeBrokering,"PWBInitBrk"],[At.BrokerClientApplicationHandleBrokerHandshake,"BrkClientHandeBrkHandshake"],[At.BrokerClientApplicationBrokeredSSOSilentRequest,"BrkClientBrkSSOReq"],[At.BrokerClientApplicationBrokeredSilentRequest,"BrkClientBrkSltReq"],[At.EmbeddedClientApplicationSendSSOSilentRequest,"EmbClientSendSSOReq"],[At.EmbeddedClientApplicationSendPopupRequest,"EmbClientSendPopupReq"],[At.EmbeddedClientApplicationSendRedirectRequest,"EmbClientSendRedirectReq"],[At.EmbeddedClientApplicationHandleRedirectRequest,"EmbClientHandleRedirectReq"],[At.EmbeddedClientApplicationSendSilentRefreshRequest,"EmbClientSendSltRefreshReq"]]),Hse=new Set(["brokerInteractionTimeoutMs","brokerMessageTimeoutMs","brokerHandshakeTimeoutMs","brokerIframeTimeoutMs"]);var $se="function",VA="object",GA="undefined",Gf="prototype",KA=Object,zse=KA[Gf];/*! https://github.com/nevware21/ts-utils v0.11.5 */function es(n,e){return n||e}function Yr(n,e){return n[e]}var yi=void 0,Jn=null,qA="",Xy="function",dm="object",Oo="prototype",q1="__proto__",Fc="undefined",cb="constructor",WA="Symbol",Vse="_polyfill",qc="length",lb="name",yr="call",eC="toString",Wi=es(Object),YA=Yr(Wi,Oo),U6=es(String),Yl=Yr(U6,Oo),Gse=es(Math),F6=es(Array),B6=Yr(F6,Oo),Vo=Yr(B6,"slice");function Cr(n,e){try{return{v:n.apply(this,e)}}catch(t){return{e:t}}}function Kse(n,e){var t=Cr(n);return t.e?e:t.v}var WS;function tC(n){return function(e){return typeof e===n}}function H6(n){var e="[object "+n+"]";return function(t){return!!(t&&qse(t)===e)}}function qse(n){return YA[eC].call(n)}function Zt(n){return typeof n===Fc||n===Fc}function Wse(n){return!QA(n)}function Xt(n){return n===Jn||Zt(n)}function Yse(n){return n===Jn||!QA(n)}function QA(n){return!!n||n!==yi}function Qse(n){return!WS&&(WS=["string","number","boolean",Fc,"symbol","bigint"]),n!==dm&&WS.indexOf(n)!==-1}var kr=tC("string"),rn=tC(Xy);function Gd(n){return!n&&Xt(n)?!1:!!n&&typeof n===dm}var Nt=Yr(F6,"isArray"),Jse=H6("Date"),Ks=tC("number"),ml=tC("boolean"),Zse=H6("Error");function Kd(n){return!!(n&&n.then&&rn(n.then))}function LR(n){return!(!n||Kse(function(){return!(n&&0+n)},!n))}var JA=Yr(Wi,"getOwnPropertyDescriptor");function $i(n,e){return!!n&&YA.hasOwnProperty[yr](n,e)}var fd=es(Yr(Wi,"hasOwn"),Xse);function Xse(n,e){return $i(n,e)||!!JA(n,e)}function an(n,e,t){if(n&&Gd(n)){for(var r in n)if(fd(n,r)&&e[yr](n,r,n[r])===-1)break}}var og={e:"enumerable",c:"configurable",v:"value",w:"writable",g:"get",s:"set"};function $6(n){var e={};if(e[og.c]=!0,e[og.e]=!0,n.l){e.get=function(){return n.l.v};var t=JA(n.l,"v");t&&t.set&&(e.set=function(r){n.l.v=r})}return an(n,function(r,i){e[og[r]]=Wse(i)?e[og[r]]:i}),e}var Go=Yr(Wi,"defineProperty"),ece=Yr(Wi,"defineProperties");function yn(n,e,t){return Go(n,e,$6(t))}function z6(n,e){var t={};return an(e,function(r,i){t[r]=$6(i)}),ece(n,t)}function V6(n,e,t,r,i){var a={};return an(n,function(o,s){ub(a,o,e?s:o),ub(a,s,o)}),r?r(a):a}function ub(n,e,t,r){Go(n,e,{value:t,enumerable:!0,writable:!1})}var pa=es(U6),tce="[object Error]";function Ft(n,e){var t=qA,r=YA[eC][yr](n);r===tce&&(n={stack:pa(n.stack),message:pa(n.message),name:pa(n.name)});try{t=JSON.stringify(n,Jn,e?typeof e=="number"?e:4:yi),t=(t?t.replace(/"(\w+)"\s*:\s{0,1}/g,"$1: "):Jn)||pa(n)}catch(i){t=" - "+Ft(i,e)}return r+": "+t}function Pi(n){throw new Error(n)}function Yi(n){throw new TypeError(n)}var G6=Yr(Wi,"freeze");function nce(n){return n}function rce(n){return n[q1]||Jn}var DR=Yr(Wi,"assign"),Lo=Yr(Wi,"keys");function ph(n){return G6&&an(n,function(e,t){(Nt(t)||Gd(t))&&ph(t)}),gl(n)}var gl=es(G6,nce),W1=es(Yr(Wi,"getPrototypeOf"),rce);function ice(n){return V6(n,1,0,gl)}function ace(n){return V6(n,0,0,gl)}function oce(n){var e={};return an(n,function(t,r){ub(e,t,r[1]),ub(e,r[0],r[1])}),gl(e)}function sce(n){return oce(n)}var K6=ace({asyncIterator:0,hasInstance:1,isConcatSpreadable:2,iterator:3,match:4,matchAll:5,replace:6,search:7,species:8,split:9,toPrimitive:10,toStringTag:11,unscopables:12}),jR="__tsUtils$gblCfg",YS;function q6(){var n;return typeof globalThis!==Fc&&(n=globalThis),!n&&typeof self!==Fc&&(n=self),!n&&typeof window!==Fc&&(n=window),!n&&typeof global!==Fc&&(n=global),n}function W6(){if(!YS){var n=Cr(q6).v||{};YS=n[jR]=n[jR]||{}}return YS}var nC=hm;function hm(n,e,t){var r=e?e[n]:Jn;return function(i){var a=(i?i[n]:Jn)||r;if(a||t){var o=arguments;return(a||t).apply(i,a?Vo[yr](o,1):o)}Yi('"'+pa(n)+'" not defined for '+Ft(i))}}function cce(n){return function(e){return e[n]}}var lce=Yr(Gse,"max"),UR=nC("slice",Yl),Ga=nC("substring",Yl),Bu=hm("substr",Yl,uce);function uce(n,e,t){return Xt(n)&&Yi("Invalid "+Ft(n)),t<0?qA:(e=e||0,e<0&&(e=lce(e+n[qc],0)),Zt(t)?UR(n,e):UR(n,e,e+t))}function ZA(n,e){return Ga(n,0,e)}var FR="_urid",QS;function dce(){if(!QS){var n=W6();QS=n.gblSym=n.gblSym||{k:{},s:{}}}return QS}var sg;function XA(n){var e={description:pa(n),toString:function(){return WA+"("+n+")"}};return e[Vse]=!0,e}function hce(n){var e=dce();if(!fd(e.k,n)){var t=XA(n),r=Lo(e.s).length;t[FR]=function(){return r+"_"+t[eC]()},e.k[n]=t,e.s[t[FR]()]=pa(n)}return e.k[n]}function fce(n){!sg&&(sg={});var e,t=K6[n];return t&&(e=sg[t]=sg[t]||XA(WA+"."+t)),e}var Hn;function rc(){Hn=W6()}function pce(n){var e={};return!Hn&&rc(),e.b=Hn.lzy,Go(e,"v",{configurable:!0,get:function(){var t=n();return Hn.lzy||Go(e,"v",{value:t}),e.b=Hn.lzy,t}}),e}function Qi(n){return Go({toJSON:function(){return n}},"v",{value:n})}var Y6="window",Kf;function rC(n,e){var t;return function(){return!Hn&&rc(),(!t||Hn.lzy)&&(t=Qi(Cr(n,e).v)),t.v}}function mh(n){return!Hn&&rc(),(!Kf||n===!1||Hn.lzy)&&(Kf=Qi(Cr(q6).v||Jn)),Kf.v}function $n(n,e){var t;if(!Kf||e===!1?t=mh(e):t=Kf.v,t&&t[n])return t[n];if(n===Y6)try{return window}catch{}return Jn}function Q6(){return!!Ko()}var Ko=rC($n,["document"]);function mce(){return!!ic()}var ic=rC($n,[Y6]);function gce(){return!!mo()}var mo=rC($n,["navigator"]),vce=rC(function(){return!!Cr(function(){return process&&(process.versions||{}).node}).v}),qd,JS;function iC(){return qd=Qi(Cr($n,[WA]).v),qd}function bce(n){var e=(Hn.lzy?0:qd)||iC();return e.v?e.v[n]:yi}function yce(){return!!Cce()}function Cce(){return!Hn&&rc(),((Hn.lzy?0:qd)||iC()).v}function ek(n,e){var t=K6[n];!Hn&&rc();var r=(Hn.lzy?0:qd)||iC();return r.v?r.v[t||n]:fce(n)}function Zh(n,e){!Hn&&rc();var t=(Hn.lzy?0:qd)||iC();return t.v?t.v(n):XA(n)}function tk(n){return!Hn&&rc(),JS=(Hn.lzy?0:JS)||Qi(Cr(bce,["for"]).v),(JS.v||hce)(n)}function Y1(n){return!!n&&rn(n.next)}function J6(n){return!Yse(n)&&rn(n[ek(3)])}var cg;function nk(n,e,t){if(n&&(Y1(n)||(!cg&&(cg=Qi(ek(3))),n=n[cg.v]?n[cg.v]():Jn),Y1(n))){var r=yi,i=yi;try{for(var a=0;!(i=n.next()).done&&e[yr](t||n,i.value,a,n)!==-1;)a++}catch(o){r={e:o},n.throw&&(i=Jn,n.throw(r))}finally{try{i&&!i.done&&n.return&&n.return(i)}finally{if(r)throw r.e}}}}function Zu(n,e,t){return n.apply(e,t)}function Ns(n,e){return!Zt(e)&&n&&(Nt(e)?Zu(n.push,n,e):Y1(e)||J6(e)?nk(e,function(t){n.push(t)}):n.push(e)),n}function it(n,e,t){if(n)for(var r=n[qc]>>>0,i=0;i<r&&!(i in n&&e[yr](n,n[i],i,n)===-1);i++);}var zi=nC("indexOf",B6);function aC(n,e,t){return((n?n.slice:Jn)||Vo).apply(n,Vo[yr](arguments,1))}var qs=es(Yr(Wi,"create"),Sce);function Sce(n){if(!n)return{};var e=typeof n;e!==dm&&e!==Xy&&Yi("Prototype must be an Object or function: "+Ft(n));function t(){}return t[Oo]=n,new t}var ZS;function Z6(n,e){var t=Wi.setPrototypeOf||function(r,i){var a;!ZS&&(ZS=Qi((a={},a[q1]=[],a instanceof Array))),ZS.v?r[q1]=i:an(i,function(o,s){return r[o]=s})};return t(n,e)}function wce(n,e,t){Cr(yn,[e,lb,{v:n,c:!0,e:!1}]),e=Z6(e,t);function r(){this[cb]=e,Cr(yn,[this,lb,{v:n,c:!0,e:!1}])}return e[Oo]=t===Jn?qs(t):(r[Oo]=t[Oo],new r),e}function BR(n,e){e&&(n[lb]=e)}function Ece(n,e,t){var r=Error,i=r[Oo][lb],a=Error.captureStackTrace;return wce(n,function(){var o=this,s=arguments;try{Cr(BR,[r,n]);var c=Zu(r,o,Vo[yr](s))||o;if(c!==o){var u=W1(o);u!==W1(c)&&Z6(c,u)}return a&&a(c,o[cb]),e&&e(c,s),c}finally{Cr(BR,[r,i])}},r)}function Ws(){return(Date.now||Tce)()}function Tce(){return new Date().getTime()}function Ice(n){return function(t){return Xt(t)&&Yi("strTrim called ["+Ft(t)+"]"),t&&t.replace&&(t=t.replace(n,qA)),t}}var Ace=Ice(/^\s+|(?=\s)\s+$/g),ei=hm("trim",Yl,Ace),XS,e0,t0;function ma(n){if(!n||typeof n!==dm)return!1;t0||(t0=mce()?ic():!0);var e=!1;if(n!==t0){e0||(XS=Function[Oo][eC],e0=XS[yr](Wi));try{var t=W1(n);e=!t,e||($i(t,cb)&&(t=t[cb]),e=!!(t&&typeof t===Xy&&XS[yr](t)===e0))}catch{}}return e}function kce(n){return n.value&&e7(n),!0}var HR=[Rce,e7,Nce,Pce];function xce(n,e,t,r){var i;return it(n,function(a){if(a.k===e)return i=a,-1}),i||(i={k:e,v:e},n.push(i),r(i)),i.v}function rk(n,e,t,r){var i=t.handler,a=t.path?r?t.path.concat(r):t.path:[],o={handler:t.handler,src:t.src,path:a},s=typeof e,c=!1,u=e===Jn;u||(e&&s===dm?c=ma(e):u=Qse(s));var h={type:s,isPrim:u,isPlain:c,value:e,result:e,path:a,origin:t.src,copy:function(f,p){return rk(n,f,p?o:t,p)},copyTo:function(f,p){return X6(n,f,p,o)}};return h.isPrim?i&&i[yr](t,h)?h.result:e:xce(n,e,a,function(f){yn(h,"result",{g:function(){return f.v},s:function(v){f.v=v}});for(var p=0,g=i;!(g||(p<HR.length?HR[p++]:kce))[yr](t,h);)g=Jn})}function X6(n,e,t,r){if(!Xt(t))for(var i in t)e[i]=rk(n,t[i],r,i);return e}function _ce(n,e,t){var r={handler:t,src:e,path:[]};return X6([],n,e,r)}function Mce(n,e){var t={handler:e,src:n};return rk([],n,t)}function Rce(n){var e=n.value;if(Nt(e)){var t=n.result=[];return t.length=e.length,n.copyTo(t,e),!0}return!1}function Pce(n){var e=n.value;return Jse(e)?(n.result=new Date(e.getTime()),!0):!1}function Nce(n){return n.type===Xy}function e7(n){var e=n.value;if(e&&n.isPlain){var t=n.result={};return n.copyTo(t,e),!0}return!1}function Oce(n,e){return it(e,function(t){_ce(n,t)}),n}function $R(n,e,t,r,i,a,o){return Oce(Mce(n)||{},Vo[yr](arguments))}var Lce=cce(qc),n0;function Dce(){return!Hn&&rc(),(!n0||Hn.lzy)&&(n0=Qi(Cr($n,["performance"]).v)),n0.v}function jce(){var n=Dce();return n&&n.now?n.now():Ws()}var Uce=hm("endsWith",Yl,Fce);function Fce(n,e,t){kr(n)||Yi("'"+Ft(n)+"' is not a string");var r=kr(e)?e:pa(e),i=!Zt(t)&&t<n[qc]?t:n[qc];return Ga(n,i-r[qc],i)===r}var oC=nC("indexOf",Yl),zR=hm("startsWith",Yl,Bce);function Bce(n,e,t){kr(n)||Yi("'"+Ft(n)+"' is not a string");var r=kr(e)?e:pa(e),i=t>0?t:0;return Ga(n,i,i+r[qc])===r}var r0="ref",i0="unref",a0="hasRef",Hce="enabled";function $ce(n,e,t){var r=!0,i=n?e(Jn):Jn,a;function o(){return r=!1,i&&i[i0]&&i[i0](),a}function s(){i&&t(i),i=Jn}function c(){return i=e(i),r||o(),a}function u(h){!h&&i&&s(),h&&!i&&c()}return a={cancel:s,refresh:c},a[a0]=function(){return i&&i[a0]?i[a0]():r},a[r0]=function(){return r=!0,i&&i[r0]&&i[r0](),a},a[i0]=o,a=Go(a,Hce,{get:function(){return!!i},set:u}),{h:a,dn:function(){i=Jn}}}function ik(n,e,t){var r=Nt(e),i=r?e.length:0,a=(i>0?e[0]:r?yi:e)||setTimeout,o=(i>1?e[1]:yi)||clearTimeout,s=t[0];t[0]=function(){c.dn(),Zu(s,yi,Vo[yr](arguments))};var c=$ce(n,function(u){if(u){if(u.refresh)return u.refresh(),u;Zu(o,yi,[u])}return Zu(a,yi,t)},function(u){Zu(o,yi,[u])});return c.h}function vl(n,e){return ik(!0,yi,Vo[yr](arguments))}function zce(n,e,t){return ik(!0,n,Vo[yr](arguments,1))}function Vce(n,e){return ik(!1,yi,Vo[yr](arguments))}(mh()||{}).Symbol;(mh()||{}).Reflect;var Gce="hasOwnProperty",Q1=function(n,e){return Q1=KA.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r[Gce](i)&&(t[i]=r[i])},Q1(n,e)};function fm(n,e){typeof e!==$se&&e!==null&&Yi("Class extends value "+String(e)+" is not a constructor or null"),Q1(n,e);function t(){this.constructor=n}n[Gf]=e===null?qs(e):(t[Gf]=e[Gf],new t)}function VR(n,e){for(var t=0,r=e.length,i=n.length;t<r;t++,i++)n[i]=e[t];return n}var lg,db="constructor",qo="prototype",hb="function",fb="_dynInstFuncs",J1="_isDynProxy",pd="_dynClass",Kce="_dynCls$",Z1="_dynInstChk",kp=Z1,t7="_dfOpts",GR="_unknown_",ak="__proto__",ug="_dyn"+ak,KR="__dynProto$Gbl",o0="_dynInstProto",Qg="useBaseInst",X1="setInstFuncs",ok=Object,xp=ok.getPrototypeOf,qR=ok.getOwnPropertyNames,WR=mh(),eE=WR[KR]||(WR[KR]={o:(lg={},lg[X1]=!0,lg[Qg]=!0,lg),n:1e3});function Jg(n){return n&&(n===ok[qo]||n===Array[qo])}function sk(n){return Jg(n)||n===Function[qo]}function bl(n){var e;if(n){if(xp)return xp(n);var t=n[ak]||n[qo]||(n[db]?n[db][qo]:null);e=n[ug]||t,$i(n,ug)||(delete n[o0],e=n[ug]=n[o0]||n[ug],n[o0]=t)}return e}function pb(n,e){var t=[];if(qR)t=qR(n);else for(var r in n)typeof r=="string"&&$i(n,r)&&t.push(r);if(t&&t.length>0)for(var i=0;i<t.length;i++)e(t[i])}function ck(n,e,t){return e!==db&&typeof n[e]===hb&&(t||$i(n,e))&&e!==ak&&e!==qo}function mb(n){Yi("DynamicProto: "+n)}function qce(n){var e=qs(null);return pb(n,function(t){!e[t]&&ck(n,t,!1)&&(e[t]=n[t])}),e}function lk(n,e){for(var t=n.length-1;t>=0;t--)if(n[t]===e)return!0;return!1}function Wce(n,e,t,r){function i(c,u,h){var f=u[h];if(f[J1]&&r){var p=c[fb]||{};p[kp]!==!1&&(f=(p[u[pd]]||{})[h]||f)}return function(){return f.apply(c,arguments)}}var a=qs(null);pb(t,function(c){a[c]=i(e,t,c)});for(var o=bl(n),s=[];o&&!sk(o)&&!lk(s,o);)pb(o,function(c){!a[c]&&ck(o,c,!xp)&&(a[c]=i(e,o,c))}),s.push(o),o=bl(o);return a}function Yce(n,e,t,r){var i=null;if(n&&$i(t,pd)){var a=n[fb]||qs(null);if(i=(a[t[pd]]||qs(null))[e],i||mb("Missing ["+e+"] "+hb),!i[Z1]&&a[kp]!==!1){for(var o=!$i(n,e),s=bl(n),c=[];o&&s&&!sk(s)&&!lk(c,s);){var u=s[e];if(u){o=u===r;break}c.push(s),s=bl(s)}try{o&&(n[e]=i),i[Z1]=1}catch{a[kp]=!1}}}return i}function Qce(n,e,t){var r=e[n];return r===t&&(r=bl(e)[n]),typeof r!==hb&&mb("["+n+"] is not a "+hb),r}function Jce(n,e,t,r,i){function a(c,u){var h=function(){var f=Yce(this,u,c,h)||Qce(u,c,h);return f.apply(this,arguments)};return h[J1]=1,h}if(!Jg(n)){var o=t[fb]=t[fb]||qs(null);if(!Jg(o)){var s=o[e]=o[e]||qs(null);o[kp]!==!1&&(o[kp]=!!i),Jg(s)||pb(t,function(c){ck(t,c,!1)&&t[c]!==r[c]&&(s[c]=t[c],delete t[c],(!$i(n,c)||n[c]&&!n[c][J1])&&(n[c]=a(n,c)))})}}}function Zce(n,e){if(xp){for(var t=[],r=bl(e);r&&!sk(r)&&!lk(t,r);){if(r===n)return!0;t.push(r),r=bl(r)}return!1}return!0}function s0(n,e){return $i(n,qo)?n.name||e||GR:((n||{})[db]||{}).name||e||GR}function mn(n,e,t,r){$i(n,qo)||mb("theClass is an invalid class definition.");var i=n[qo];Zce(i,e)||mb("["+s0(n)+"] not in hierarchy of ["+s0(e)+"]");var a=null;$i(i,pd)?a=i[pd]:(a=Kce+s0(n,"_")+"$"+eE.n,eE.n++,i[pd]=a);var o=mn[t7],s=!!o[Qg];s&&r&&r[Qg]!==void 0&&(s=!!r[Qg]);var c=qce(e),u=Wce(i,e,c,s);t(e,u);var h=!!xp&&!!o[X1];h&&r&&(h=!!r[X1]),Jce(i,a,e,c,h!==!1)}mn[t7]=eE.o;var n7=ice,oi=sce,fc=n7({Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5}),Cu=n7({NONE:0,PENDING:3,INACTIVE:1,ACTIVE:2}),uk="toLowerCase",gb="blkVal",Ct="length",vb="rdOnly",bb="notify",yb="warnToConsole",pm="throwInternal",gh="setDf",Bs="watch",jn="logger",sC="apply",qt="push",mm="splice",r7="hdlr",Xu="cancel",gm="initialize",As="identifier",Cb="removeNotificationListener",Sb="addNotificationListener",Xa="isInitialized",YR="instrumentationKey",c0="INACTIVE",qf="value",dg="getNotifyMgr",_p="getPlugin",Wc="name",Xh="iKey",md="time",$r="processNext",i7="getProcessTelContext",QR="pollInternalLogs",ed="enabled",JR="stopPollingInternalLogs",Ys="unload",hg="onComplete",ZR="version",a7="loggingLevelConsole",yl="createNew",xo="teardown",wb="messageId",Yc="message",Wd="isAsync",Do="diagLog",Eb="_doTeardown",Mp="update",ro="getNext",Rp="setNextPlugin",o7="protocol",tE="userAgent",cC="split",l0="nodeType",Qc="replace",Xce="logInternalMessage",jo="type",dk="handler",Af="status",XR="getResponseHeader",e2="getAllResponseHeaders",nE="isChildEvt",Hu="data",gd="getCtx",La="setCtx",rE="complete",ef="urlString",t2="sendPOST",u0="headers",Su="timeout",n2="setRequestHeader",r2="traceId",i2="spanId",a2="traceFlags",d0;function ele(n,e){d0||(d0=Ece("AggregationError",function(r,i){i[Ct]>1&&(r.errors=i[1])}));var t=n;throw it(e,function(r,i){t+=`
`.concat(i," > ").concat(Ft(r))}),new d0(t,e||[])}/*!
 * NevWare21 Solutions LLC - ts-async, 0.5.2
 * https://github.com/nevware21/ts-async
 * Copyright (c) NevWare21 Solutions LLC and contributors. All rights reserved.
 * Licensed under the MIT license.
 */var Tb="Promise",hk="rejected";function Yd(n,e){return s7(n,function(t){return e?e({status:"fulfilled",rejected:!1,value:t}):t},function(t){return e?e({status:hk,rejected:!0,reason:t}):t})}function s7(n,e,t,r){var i=n;try{if(Kd(n))(e||t)&&(i=n.then(e,t));else try{e&&(i=e(n))}catch(a){if(t)i=t(a);else throw a}}finally{}return i}var c7=["pending","resolving","resolved",hk],o2="dispatchEvent",fg;function tle(n){var e;return n&&n.createEvent&&(e=n.createEvent("Event")),!!e&&e.initEvent}function nle(n,e,t,r){var i=Ko();!fg&&(fg=Qi(!!Cr(tle,[i]).v));var a=fg.v?i.createEvent("Event"):r?new Event(e):{};if(t&&t(a),fg.v&&a.initEvent(e,!1,!0),a&&n[o2])n[o2](a);else{var o=n["on"+e];if(o)o(a);else{var s=$n("console");s&&(s.error||s.log)(e,Ft(a))}}}var l7="unhandledRejection",rle=l7.toLowerCase(),s2=[],ile=0,ale=10,h0;function c2(n){return rn(n)?n.toString():Ft(n)}function u7(n,e,t){var r=aC(arguments,3),i=0,a=!1,o,s=[],c=ile++,u=!1,h=null,f;function p(T,A){try{s2.push(c),u=!0,h&&h.cancel(),h=null;var I=n(function(k,x){s.push(function(){try{var _=i===2?T:A,R=Zt(_)?o:rn(_)?_(o):_;Kd(R)?R.then(k,x):_?k(R):i===3?x(R):k(R)}catch(z){x(z)}}),a&&b()},r);return I}finally{s2.pop()}}function g(T){return p(void 0,T)}function v(T){var A=T,I=T;return rn(T)&&(A=function(k){return T&&T(),k},I=function(k){throw T&&T(),k}),p(A,I)}function y(){return c7[i]}function b(){if(s.length>0){var T=s.slice();s=[],u=!0,h&&h.cancel(),h=null,e(T)}}function C(T,A){return function(I){if(i===A){if(T===2&&Kd(I)){i=1,I.then(C(2,1),C(3,1));return}i=T,a=!0,o=I,b(),!u&&T===3&&!h&&(h=vl(S,ale))}}}function S(){if(!u)if(u=!0,vce())process.emit(l7,o,f);else{var T=ic()||mh();!h0&&(h0=Qi(Cr($n,[Tb+"RejectionEvent"]).v)),nle(T,rle,function(A){return yn(A,"promise",{g:function(){return f}}),A.reason=o,A},!!h0.v)}}f={then:p,catch:g,finally:v},Go(f,"state",{get:y}),yce()&&(f[ek(11)]="IPromise");function E(){return"IPromise "+y()+(a?" - "+c2(o):"")}return f.toString=E,function(){rn(t)||Yi(Tb+": executor is not a function - "+c2(t));var A=C(3,0);try{t.call(f,C(2,0),A)}catch(I){A(I)}}(),f}function ole(n){return function(e){var t=aC(arguments,1);return n(function(r,i){try{var a=[],o=1;nk(e,function(s,c){s&&(o++,s7(s,function(u){a[c]=u,--o===0&&r(a)},i))}),o--,o===0&&r(a)}catch(s){i(s)}},t)}}function sle(n){return Qi(function(e){var t=aC(arguments,1);return n(function(r,i){var a=[],o=1;function s(c,u){o++,Yd(c,function(h){h.rejected?a[u]={status:hk,reason:h.reason}:a[u]={status:"fulfilled",value:h.value},--o===0&&r(a)})}try{Nt(e)?it(e,s):J6(e)?nk(e,s):Yi("Input is not an iterable"),o--,o===0&&r(a)}catch(c){i(c)}},t)})}function d7(n){it(n,function(e){try{e()}catch{}})}function cle(n){var e=Ks(n)?n:0;return function(t){vl(function(){d7(t)},e)}}function h7(n,e){return u7(h7,cle(e),n,e)}var f0;function lle(n,e){!f0&&(f0=Qi(Cr($n,[Tb]).v||null));var t=f0.v;if(!t)return h7(n);rn(n)||Yi(Tb+": executor is not a function - "+Ft(n));var r=0;function i(){return c7[r]}var a=new t(function(o,s){function c(h){r=2,o(h)}function u(h){r=3,s(h)}n(c,u)});return Go(a,"state",{get:i}),a}var p0;function f7(n){return u7(f7,d7,n)}function ule(n,e){return!p0&&(p0=sle(f7)),p0.v(n,e)}var m0;function Cl(n,e){return!m0&&(m0=Qi(lle)),m0.v.call(this,n,e)}var dle=ole(Cl),$a=void 0,Ut="",_c="channels",Yn="core",iE="createPerfMgr",aE="disabled",vd="extensionConfig",$u="extensions",uo="processTelemetry",Ib="priority",Zg="eventsSent",Wf="eventsDiscarded",Xg="eventsSendRequest",Bc="perfEvent",g0="offlineEventsStored",v0="offlineBatchSent",b0="offlineBatchDrop",Ab="getPerfMgr",oE="domain",y0="path",hle="Not dynamic - ",fle=/-([a-z])/g,ple=/([^\w\d_$])/g,mle=/^(\d+[\w\d_$])/;function kb(n){return!Xt(n)}function sE(n){var e=n;return e&&kr(e)&&(e=e[Qc](fle,function(t,r){return r.toUpperCase()}),e=e[Qc](ple,"_"),e=e[Qc](mle,function(t,r){return"_"+r})),e}function Jr(n,e){return n&&e?oC(n,e)!==-1:!1}function cE(n){return n&&n.toISOString()||""}function p7(n){return Zse(n)?n[Wc]:Ut}function wu(n,e,t,r,i){var a=t;return n&&(a=n[e],a!==t&&(!i||i(a))&&(!r||r(t))&&(a=t,n[e]=a)),a}function gle(n,e,t){var r;return n?(r=n[e],!r&&Xt(r)&&(r=Zt(t)?{}:t,n[e]=r)):r=Zt(t)?{}:t,r}function vle(n,e){var t=null,r=null;return rn(n)?t=n:r=n,function(){var i=arguments;if(t&&(r=t()),r)return r[e][sC](r,i)}}function xb(n,e,t,r,i){n&&e&&t&&(n[e]=vle(t,r))}function m7(n,e,t,r){return n&&e&&Gd(n)&&Nt(t)&&it(t,function(i){kr(i)&&xb(n,i,e,i)}),n}function zu(n){return n&&DR&&(n=KA(DR({},n))),n}function Qd(n){try{return n.responseText}catch{}return null}function ble(n,e){return n?"XDomainRequest,Response:"+Qd(n)||"":e}function l2(n,e){return n?"XMLHttpRequest,Status:"+n[Af]+",Response:"+Qd(n)||n.response||"":e}function u2(n,e){return e&&(Ks(e)?n=[e].concat(n):Nt(e)&&(n=e.concat(n))),n}var yle="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",d2="withCredentials",Cle="timeout";function Sle(n,e,t,r,i,a){i===void 0&&(i=!1);function o(c,u,h){try{c[u]=h}catch{}}var s=new XMLHttpRequest;return o(s,yle,r),t&&o(s,d2,t),s.open(n,e,!i),t&&o(s,d2,t),!i&&a&&o(s,Cle,a),s}function wle(n){var e={};if(kr(n)){var t=ei(n)[cC](/[\r\n]+/);it(t,function(r){if(r){var i=r.indexOf(": ");if(i!==-1){var a=ei(r.substring(0,i))[uk](),o=ei(r.substring(i+1));e[a]=o}else e[ei(r)]=1}})}return e}function C0(n,e,t){if(!n[t]&&e&&e[XR]){var r=e[XR](t);r&&(n[t]=ei(r))}return n}var Ele="kill-duration",Tle="kill-duration-seconds",Ile="time-delta-millis";function ev(n,e){var t={};return n[e2]?t=wle(n[e2]()):e&&(t=C0(t,n,Ile),t=C0(t,n,Ele),t=C0(t,n,Tle)),t}var Ale="location",kle="console",g7="JSON",xle="crypto",_le="msCrypto",Mle="ReactNative",Rle="msie",Ple="trident/",v7="XMLHttpRequest",S0=null,w0=null,Eu=null,E0=null;function b7(n,e){var t=!1;if(n){try{if(t=e in n,!t){var r=n[Gf];r&&(t=e in r)}}catch{}if(!t)try{var i=new n;t=!Zt(i[e])}catch{}}return t}function lC(n){return typeof location===VA&&location?location:$n(Ale)}function Nle(){return typeof console!==GA?console:$n(kle)}function y7(){return!!(typeof JSON===VA&&JSON||$n(g7)!==null)}function Ole(){return y7()?JSON||$n(g7):null}function Lle(){return $n(xle)}function Dle(){return $n(_le)}function lE(){var n=mo();return n&&n.product?n.product===Mle:!1}function uE(){var n=mo();if(n&&(n[tE]!==w0||S0===null)){w0=n[tE];var e=(w0||Ut)[uk]();S0=Jr(e,Rle)||Jr(e,Ple)}return S0}function C7(n){return(E0===null||n===!1)&&(E0=gce()&&!!mo().sendBeacon),E0}function S7(n){var e=!1;try{e=!!$n("fetch");var t=$n("Request");e&&n&&t&&(e=b7(t,"keepalive"))}catch{}return e}function jle(){return Eu===null&&(Eu=typeof XDomainRequest!==GA,Eu&&w7()&&(Eu=Eu&&!b7($n(v7),"withCredentials"))),Eu}function w7(){var n=!1;try{var e=$n(v7);n=!!e}catch{}return n}var E7=4294967296,Jc=4294967295,T7=123456789,I7=987654321,A7=!1,kf=T7,xf=I7;function Ule(n){n<0&&(n>>>=0),kf=T7+n&Jc,xf=I7-n&Jc,A7=!0}function Fle(){try{var n=Ws()&2147483647;Ule((Math.random()*E7^n)+n)}catch{}}function Pp(n){var e=0,t=Lle()||Dle();return t&&t.getRandomValues&&(e=t.getRandomValues(new Uint32Array(1))[0]&Jc),e===0&&uE()&&(A7||Fle(),e=Ble()&Jc),e===0&&(e=Math.floor(E7*Math.random()|0)),n||(e>>>=0),e}function Ble(n){xf=36969*(xf&65535)+(xf>>16)&Jc,kf=18e3*(kf&65535)+(kf>>16)&Jc;var e=(xf<<16)+(kf&65535)>>>0&Jc|0;return e>>>=0,e}function fk(n){n===void 0&&(n=22);for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=Pp()>>>0,r=0,i=Ut;i[Ct]<n;)r++,i+=e.charAt(t&63),t>>>=6,r===5&&(t=(Pp()<<2&4294967295|t&3)>>>0,r=0);return i}var k7="3.3.3",Hle="."+fk(6),$le=0;function x7(n){return n[l0]===1||n[l0]===9||!+n[l0]}function zle(n,e){var t=e[n.id];if(!t){t={};try{x7(e)&&yn(e,n.id,{e:!1,v:t})}catch{}}return t}function vh(n,e){return e===void 0&&(e=!1),sE(n+$le+++(e?"."+k7:Ut)+Hle)}function _7(n){var e={id:vh("_aiData-"+(n||Ut)+"."+k7),accept:function(t){return x7(t)},get:function(t,r,i,a){var o=t[e.id];return o?o[sE(r)]:(a&&(o=zle(e,t),o[sE(r)]=i),i)},kill:function(t,r){if(t&&t[r])try{delete t[r]}catch{}}};return e}function tv(n){return n&&Gd(n)&&(n.isVal||n.fb||fd(n,"v")||fd(n,"mrg")||fd(n,"ref")||n.set)}function M7(n,e,t){var r,i=t.dfVal||QA;if(e&&t.fb){var a=t.fb;Nt(a)||(a=[a]);for(var o=0;o<a[Ct];o++){var s=a[o],c=e[s];if(i(c)?r=c:n&&(c=n.cfg[s],i(c)&&(r=c),n.set(n.cfg,pa(s),c)),i(r))break}}return!i(r)&&i(t.v)&&(r=t.v),r}function dE(n,e,t){var r=t;if(t&&tv(t)&&(r=M7(n,e,t)),r){tv(r)&&(r=dE(n,e,r));var i;Nt(r)?(i=[],i[Ct]=r[Ct]):ma(r)&&(i={}),i&&(an(r,function(a,o){o&&tv(o)&&(o=dE(n,e,o)),i[a]=o}),r=i)}return r}function pk(n,e,t,r){var i,a,o,s=r,c,u,h,f;tv(s)?(i=s.isVal,a=s.set,h=s[vb],f=s[gb],c=s.mrg,u=s.ref,!u&&Zt(u)&&(u=!!c),o=M7(n,e,s)):o=r,f&&n[gb](e,t);var p,g=!0,v=e[t];(v||!Xt(v))&&(p=v,g=!1,i&&p!==o&&!i(p)&&(p=o,g=!0),a&&(p=a(p,o,e),g=p===o)),g?o?p=dE(n,e,o):p=o:(ma(p)||Nt(o))&&c&&o&&(ma(o)||Nt(o))&&an(o,function(y,b){pk(n,p,y,b)}),n.set(e,t,p),u&&n.ref(e,t),h&&n[vb](e,t)}var Qs=tk("[[ai_dynCfg_1]]"),R7=tk("[[ai_blkDynCfg_1]]"),Vle=tk("[[ai_frcDynCfg_1]]");function P7(n){if(n){var e;if(Nt(n)?(e=[],e[Ct]=n[Ct]):ma(n)&&(e={}),e)return an(n,function(t,r){e[t]=P7(r)}),e}return n}function Gle(n){if(n){var e=n[Qs]||n;if(e.cfg&&(e.cfg===n||e.cfg[Qs]===e))return e}return null}function Kle(n){if(n&&(ma(n)||Nt(n)))try{n[R7]=!0}catch{}return n}function T0(n,e,t){var r=!1;return t&&!n[e.blkVal]&&(r=t[Vle],!r&&!t[R7]&&(r=ma(t)||Nt(t))),r}function N7(n){Yi("InvalidAccess:"+n)}var qle=["push","pop","shift","unshift","splice"],Np=function(n,e,t,r){n&&n[pm](3,108,"".concat(t," [").concat(e,"] failed - ")+Ft(r))};function Wle(n,e,t){Nt(e)&&it(qle,function(r){var i=e[r];e[r]=function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var s=i[sC](this,a);return Mb(n,e,t,"Patching"),s}})}function _b(n,e){var t=JA(n,e);return t&&t.get}function Yle(n,e,t,r){var i={n:t,h:[],trk:function(u){u&&u.fn&&(zi(i.h,u)===-1&&i.h[qt](u),n.trk(u,i))},clr:function(u){var h=zi(i.h,u);h!==-1&&i.h[mm](h,1)}},a=!0,o=!1;function s(){a&&(o=o||T0(s,n,r),r&&!r[Qs]&&o&&(r=Mb(n,r,t,"Converting")),a=!1);var u=n.act;return u&&i.trk(u),r}s[n.prop]={chng:function(){n.add(i)}};function c(u){if(r!==u){s[n.ro]&&!n.upd&&N7("["+t+"] is read-only:"+Ft(e)),a&&(o=o||T0(s,n,r),a=!1);var h=o&&s[n.rf];if(o)if(h){an(r,function(p){r[p]=u?u[p]:$a});try{an(u,function(p,g){uC(n,r,p,g)}),u=r}catch(p){Np((n.hdlr||{})[jn],t,"Assigning",p),o=!1}}else r&&r[Qs]&&an(r,function(p){var g=_b(r,p);if(g){var v=g[n.prop];v&&v.chng()}});if(u!==r){var f=u&&T0(s,n,u);!h&&f&&(u=Mb(n,u,t,"Converting")),r=u,o=f}n.add(i)}}yn(e,i.n,{g:s,s:c})}function uC(n,e,t,r){if(e){var i=_b(e,t),a=i&&!!i[n.prop];a?e[t]=r:Yle(n,e,t,r)}return e}function I0(n,e,t,r){if(e){var i=_b(e,t),a=i&&!!i[n.prop],o=r&&r[0],s=r&&r[1],c=r&&r[2];if(!a){if(c)try{Kle(e)}catch(u){Np((n.hdlr||{})[jn],t,"Blocking",u)}try{uC(n,e,t,e[t]),i=_b(e,t)}catch(u){Np((n.hdlr||{})[jn],t,"State",u)}}o&&(i[n.rf]=o),s&&(i[n.ro]=s),c&&(i[n.blkVal]=!0)}return e}function Mb(n,e,t,r){try{an(e,function(i,a){uC(n,e,i,a)}),e[Qs]||(Go(e,Qs,{get:function(){return n[r7]}}),Wle(n,e,t))}catch(i){Np((n.hdlr||{})[jn],t,r,i)}return e}var tf="[[ai_",nf="]]";function Qle(n){var e,t=Zh(tf+"get"+n.uid+nf),r=Zh(tf+"ro"+n.uid+nf),i=Zh(tf+"rf"+n.uid+nf),a=Zh(tf+"blkVal"+n.uid+nf),o=Zh(tf+"dtl"+n.uid+nf),s=null,c=null,u;function h(v,y){var b=u.act;try{u.act=v,v&&v[o]&&(it(v[o],function(S){S.clr(v)}),v[o]=[]),y({cfg:n.cfg,set:n.set.bind(n),setDf:n[gh].bind(n),ref:n.ref.bind(n),rdOnly:n[vb].bind(n)})}catch(S){var C=n[jn];throw C&&C[pm](1,107,Ft(S)),S}finally{u.act=b||null}}function f(){if(s){var v=s;s=null,c&&c[Xu](),c=null;var y=[];if(it(v,function(b){if(b&&(b[o]&&(it(b[o],function(C){C.clr(b)}),b[o]=null),b.fn))try{h(b,b.fn)}catch(C){y[qt](C)}}),s)try{f()}catch(b){y[qt](b)}y[Ct]>0&&ele("Watcher error(s): ",y)}}function p(v){if(v&&v.h[Ct]>0){s||(s=[]),c||(c=vl(function(){c=null,f()},0));for(var y=0;y<v.h[Ct];y++){var b=v.h[y];b&&zi(s,b)===-1&&s[qt](b)}}}function g(v,y){if(v){var b=v[o]=v[o]||[];zi(b,y)===-1&&b[qt](y)}}return u=(e={prop:t,ro:r,rf:i},e[gb]=a,e[r7]=n,e.add=p,e[bb]=f,e.use=h,e.trk=g,e),u}function Jle(n,e){var t={fn:e,rm:function(){t.fn=null,n=null,e=null}};return yn(t,"toJSON",{v:function(){return"WatcherHandler"+(t.fn?"":"[X]")}}),n.use(t,e),t}function Zle(n,e,t){var r,i=Gle(e);if(i)return i;var a=vh("dyncfg",!0),o=e&&t!==!1?e:P7(e),s;function c(){s[bb]()}function u(C,S,E){try{C=uC(s,C,S,E)}catch(T){Np(n,S,"Setting value",T)}return C[S]}function h(C){return Jle(s,C)}function f(C,S){s.use(null,function(E){var T=s.upd;try{Zt(S)||(s.upd=S),C(E)}finally{s.upd=T}})}function p(C,S){var E;return I0(s,C,S,(E={},E[0]=!0,E))[S]}function g(C,S){var E;return I0(s,C,S,(E={},E[1]=!0,E))[S]}function v(C,S){var E;return I0(s,C,S,(E={},E[2]=!0,E))[S]}function y(C,S){return S&&an(S,function(E,T){pk(b,C,E,T)}),C}var b=(r={uid:null,cfg:o},r[jn]=n,r[bb]=c,r.set=u,r[gh]=y,r[Bs]=h,r.ref=p,r[vb]=g,r[gb]=v,r._block=f,r);return yn(b,"uid",{c:!1,e:!1,w:!1,v:a}),s=Qle(b),Mb(s,o,"config","Creating"),b}function Xle(n,e){n?(n[yb](e),n[pm](2,108,e)):N7(e)}function Ii(n,e,t,r){var i=Zle(t,n||{},r);return e&&i[gh](i.cfg,e),i}function Mr(n,e,t){var r=n[Qs]||n;return r.cfg&&(r.cfg===n||r.cfg[Qs]===r)?r[Bs](e):(Xle(t,hle+Ft(n)),Ii(n,null,t)[Bs](e))}function _f(n,e){if(n&&n[Ys])return n[Ys](e)}function O7(n,e,t){var r;return t||(r=Cl(function(i){t=i})),n&&Lce(n)>0?Yd(_f(n[0],e),function(){O7(aC(n,1),e,t)}):t(),r}var eue=500,h2="Microsoft_ApplicationInsights_BypassAjaxInstrumentation";function hE(n){return{mrg:!0,v:n}}function pc(n){return{isVal:kr,v:pa(Ut)}}var A0=[Zg,Wf,Xg,Bc],Rb=null,pg;function tue(n,e){return function(){var t=arguments,r=L7(e);if(r){var i=r.listener;i&&i[n]&&i[n][sC](i,t)}}}function nue(){var n=$n("Microsoft");return n&&(Rb=n.ApplicationInsights),Rb}function L7(n){var e=Rb;return!e&&n.disableDbgExt!==!0&&(e=Rb||nue()),e?e.ChromeDbgExt:null}function rue(n){if(!pg){pg={};for(var e=0;e<A0[Ct];e++)pg[A0[e]]=tue(A0[e],n)}return pg}var Tu,D7="warnToConsole",iue="AI (Internal): ",aue="AI: ",oue="AITR_",sue={loggingLevelConsole:0,loggingLevelTelemetry:1,maxMessageLimit:25,enableDebug:!1},cue=(Tu={},Tu[0]=null,Tu[1]="errorToConsole",Tu[2]=D7,Tu[3]="debugToConsole",Tu);function f2(n){return n?'"'+n[Qc](/\"/g,Ut)+'"':Ut}function k0(n,e){var t=Nle();if(t){var r="log";t[n]&&(r=n),rn(t[r])&&t[r](e)}}var fE=function(){function n(e,t,r,i){r===void 0&&(r=!1);var a=this;a[wb]=e,a[Yc]=(r?aue:iue)+e;var o=Ut;y7()&&(o=Ole().stringify(i));var s=(t?" message:"+f2(t):Ut)+(i?" props:"+f2(o):Ut);a[Yc]+=s}return n.dataType="MessageData",n}();function mk(n,e){return(n||{})[jn]||new Pb(e)}var Pb=function(){function n(e){this.identifier="DiagnosticLogger",this.queue=[];var t=0,r={},i,a,o,s,c;mn(n,this,function(u){c=f(e||{}),u.consoleLoggingLevel=function(){return i},u[pm]=function(v,y,b,C,S){S===void 0&&(S=!1);var E=new fE(y,b,S,C);if(s)throw Ft(E);var T=cue[v]||D7;if(Zt(E[Yc]))g("throw"+(v===1?"Critical":"Warning"),E);else{if(S){var A=+E[wb];!r[A]&&i>=v&&(u[T](E[Yc]),r[A]=!0)}else i>=v&&u[T](E[Yc]);h(v,E)}},u.debugToConsole=function(v){k0("debug",v),g("warning",v)},u[yb]=function(v){k0("warn",v),g("warning",v)},u.errorToConsole=function(v){k0("error",v),g("error",v)},u.resetInternalMessageCount=function(){t=0,r={}},u[Xce]=h,u[Ys]=function(v){c&&c.rm(),c=null};function h(v,y){if(!p()){var b=!0,C=oue+y[wb];if(r[C]?b=!1:r[C]=!0,b&&(v<=a&&(u.queue[qt](y),t++,g(v===1?"error":"warn",y)),t===o)){var S="Internal events throttle limit per PageView reached for this app.",E=new fE(23,S,!1);u.queue[qt](E),v===1?u.errorToConsole(S):u[yb](S)}}}function f(v){return Mr(Ii(v,sue,u).cfg,function(y){var b=y.cfg;i=b[a7],a=b.loggingLevelTelemetry,o=b.maxMessageLimit,s=b.enableDebug})}function p(){return t>=o}function g(v,y){var b=L7(e||{});b&&b[Do]&&b[Do](v,y)}})}return n.__ieDyn=1,n}();function j7(n){return n||new Pb}function nn(n,e,t,r,i,a){a===void 0&&(a=!1),j7(n)[pm](e,t,r,i,a)}function Yf(n,e){j7(n)[yb](e)}var x0,mc,p2="toGMTString",m2="toUTCString",gk="cookie",_0="expires",g2="isCookieUseDisabled",pE="disableCookiesUsage",td="_ckMgr",mg=null,M0=null,v2=null,io,b2={},Nb={},lue=(x0={cookieCfg:hE((mc={},mc[oE]={fb:"cookieDomain",dfVal:kb},mc.path={fb:"cookiePath",dfVal:kb},mc.enabled=$a,mc.ignoreCookies=$a,mc.blockedCookies=$a,mc)),cookieDomain:$a,cookiePath:$a},x0[pE]=$a,x0);function vk(){!io&&(io=pce(function(){return Ko()}))}function uue(n,e){var t=nv[td]||Nb[td];return t||(t=nv[td]=nv(n,e),Nb[td]=t),t}function gg(n){return n?n.isEnabled():!0}function U7(n,e){return e&&n&&Nt(n.ignoreCookies)?zi(n.ignoreCookies,e)!==-1:!1}function due(n,e){return e&&n&&Nt(n.blockedCookies)&&zi(n.blockedCookies,e)!==-1?!0:U7(n,e)}function y2(n,e){var t=e[ed];if(Xt(t)){var r=void 0;Zt(n[g2])||(r=!n[g2]),Zt(n[pE])||(r=!n[pE]),t=r}return t}function F7(n,e){var t;return n&&(t=n.getCookieMgr()),t||(t=uue(e,(n||{})[jn])),t}function nv(n,e){var t,r,i,a,o,s,c,u,h;n=Ii(n||Nb,null,e).cfg,o=Mr(n,function(p){p[gh](p.cfg,lue),r=p.ref(p.cfg,"cookieCfg"),i=r[y0]||"/",a=r[oE],s=y2(n,r)!==!1,c=r.getCookie||hue,u=r.setCookie||E2,h=r.delCookie||E2},e);var f=(t={isEnabled:function(){var p=y2(n,r)!==!1&&s&&C2(e),g=Nb[td];return p&&g&&f!==g&&(p=gg(g)),p},setEnabled:function(p){s=p!==!1,r[ed]=p},set:function(p,g,v,y,b){var C=!1;if(gg(f)&&!due(r,p)){var S={},E=ei(g||Ut),T=oC(E,";");if(T!==-1&&(E=ei(ZA(g,T)),S=B7(Ga(g,T+1))),wu(S,oE,y||a,LR,Zt),!Xt(v)){var A=uE();if(Zt(S[_0])){var I=Ws(),k=I+v*1e3;if(k>0){var x=new Date;x.setTime(k),wu(S,_0,S2(x,A?p2:m2)||S2(x,A?p2:m2)||Ut,LR)}}A||wu(S,"max-age",Ut+v,null,Zt)}var _=lC();_&&_[o7]==="https:"&&(wu(S,"secure",null,null,Zt),M0===null&&(M0=!fue((mo()||{})[tE])),M0&&wu(S,"SameSite","None",null,Zt)),wu(S,y0,b||i,null,Zt),u(p,w2(E,S)),C=!0}return C},get:function(p){var g=Ut;return gg(f)&&!U7(r,p)&&(g=c(p)),g},del:function(p,g){var v=!1;return gg(f)&&(v=f.purge(p,g)),v},purge:function(p,g){var v,y=!1;if(C2(e)){var b=(v={},v[y0]=g||"/",v[_0]="Thu, 01 Jan 1970 00:00:01 GMT",v);uE()||(b["max-age"]="0"),h(p,w2(Ut,b)),y=!0}return y}},t[Ys]=function(p){o&&o.rm(),o=null},t);return f[td]=f,f}function C2(n){if(mg===null){mg=!1,!io&&vk();try{var e=io.v||{};mg=e[gk]!==void 0}catch(t){nn(n,2,68,"Cannot access document.cookie - "+p7(t),{exception:Ft(t)})}}return mg}function B7(n){var e={};if(n&&n[Ct]){var t=ei(n)[cC](";");it(t,function(r){if(r=ei(r||Ut),r){var i=oC(r,"=");i===-1?e[r]=null:e[ei(ZA(r,i))]=ei(Ga(r,i+1))}})}return e}function S2(n,e){return rn(n[e])?n[e]():null}function w2(n,e){var t=n||Ut;return an(e,function(r,i){t+="; "+r+(Xt(i)?Ut:"="+i)}),t}function hue(n){var e=Ut;if(!io&&vk(),io.v){var t=io.v[gk]||Ut;v2!==t&&(b2=B7(t),v2=t),e=ei(b2[n]||Ut)}return e}function E2(n,e){!io&&vk(),io.v&&(io.v[gk]=n+"="+e)}function fue(n){return kr(n)?!!(Jr(n,"CPU iPhone OS 12")||Jr(n,"iPad; CPU OS 12")||Jr(n,"Macintosh; Intel Mac OS X 10_14")&&Jr(n,"Version/")&&Jr(n,"Safari")||Jr(n,"Macintosh; Intel Mac OS X 10_14")&&Uce(n,"AppleWebKit/605.1.15 (KHTML, like Gecko)")||Jr(n,"Chrome/5")||Jr(n,"Chrome/6")||Jr(n,"UnrealEngine")&&!Jr(n,"Chrome")||Jr(n,"UCBrowser/12")||Jr(n,"UCBrowser/11")):!1}var pue={perfEvtsSendAll:!1};function mue(n){n.h=null;var e=n.cb;n.cb=[],it(e,function(t){Cr(t.fn,[t.arg])})}function hs(n,e,t,r){it(n,function(i){i&&i[e]&&(t?(t.cb[qt]({fn:r,arg:i}),t.h=t.h||vl(mue,0,t)):Cr(r,[i]))})}var gue=function(){function n(e){this.listeners=[];var t,r,i=[],a={h:null,cb:[]},o=Ii(e,pue);r=o[Bs](function(s){t=!!s.cfg.perfEvtsSendAll}),mn(n,this,function(s){yn(s,"listeners",{g:function(){return i}}),s[Sb]=function(c){i[qt](c)},s[Cb]=function(c){for(var u=zi(i,c);u>-1;)i[mm](u,1),u=zi(i,c)},s[Zg]=function(c){hs(i,Zg,a,function(u){u[Zg](c)})},s[Wf]=function(c,u){hs(i,Wf,a,function(h){h[Wf](c,u)})},s[Xg]=function(c,u){hs(i,Xg,u?a:null,function(h){h[Xg](c,u)})},s[Bc]=function(c){c&&(t||!c[nE]())&&hs(i,Bc,null,function(u){c[Wd]?vl(function(){return u[Bc](c)},0):u[Bc](c)})},s[g0]=function(c){c&&c[Ct]&&hs(i,g0,a,function(u){u[g0](c)})},s[v0]=function(c){c&&c[Hu]&&hs(i,v0,a,function(u){u[v0](c)})},s[b0]=function(c,u){if(c>0){var h=u||0;hs(i,b0,a,function(f){f[b0](c,h)})}},s[Ys]=function(c){var u=function(){r&&r.rm(),r=null,i=[],a.h&&a.h[Xu](),a.h=null,a.cb=[]},h;if(hs(i,"unload",null,function(f){var p=f[Ys](c);p&&(h||(h=[]),h[qt](p))}),h)return Cl(function(f){return Yd(dle(h),function(){u(),f()})});u()}})}return n.__ieDyn=1,n}(),bd="ctx",mE="ParentContextKey",Qf="ChildrenContextKey",vue=null,rv=function(){function n(e,t,r){var i=this;if(i.start=Ws(),i[Wc]=e,i[Wd]=r,i[nE]=function(){return!1},rn(t)){var a;yn(i,"payload",{g:function(){return!a&&rn(t)&&(a=t(),t=null),a}})}i[gd]=function(o){return o?o===n[mE]||o===n[Qf]?i[o]:(i[bd]||{})[o]:null},i[La]=function(o,s){if(o)if(o===n[mE])i[o]||(i[nE]=function(){return!0}),i[o]=s;else if(o===n[Qf])i[o]=s;else{var c=i[bd]=i[bd]||{};c[o]=s}},i[rE]=function(){var o=0,s=i[gd](n[Qf]);if(Nt(s))for(var c=0;c<s[Ct];c++){var u=s[c];u&&(o+=u[md])}i[md]=Ws()-i.start,i.exTime=i[md]-o,i[rE]=function(){}}}return n.ParentContextKey="parent",n.ChildrenContextKey="childEvts",n}(),bue=function(){function n(e){this.ctx={},mn(n,this,function(t){t.create=function(r,i,a){return new rv(r,i,a)},t.fire=function(r){r&&(r[rE](),e&&rn(e[Bc])&&e[Bc](r))},t[La]=function(r,i){if(r){var a=t[bd]=t[bd]||{};a[r]=i}},t[gd]=function(r){return(t[bd]||{})[r]}})}return n.__ieDyn=1,n}(),R0="CoreUtils.doPerf";function Xr(n,e,t,r,i){if(n){var a=n;if(a[Ab]&&(a=a[Ab]()),a){var o=void 0,s=a[gd](R0);try{if(o=a.create(e(),r,i),o){if(s&&o[La]&&(o[La](rv[mE],s),s[gd]&&s[La])){var c=s[gd](rv[Qf]);c||(c=[],s[La](rv[Qf],c)),c[qt](o)}return a[La](R0,o),t(o)}}catch(u){o&&o[La]&&o[La]("exception",u)}finally{o&&a.fire(o),a[La](R0,s)}}}return t()}function yue(){return vue}function H7(){var n=gE();return Ga(n,0,8)+"-"+Ga(n,8,12)+"-"+Ga(n,12,16)+"-"+Ga(n,16,20)+"-"+Ga(n,20)}function gE(){for(var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],e=Ut,t,r=0;r<4;r++)t=Pp(),e+=n[t&15]+n[t>>4&15]+n[t>>8&15]+n[t>>12&15]+n[t>>16&15]+n[t>>20&15]+n[t>>24&15]+n[t>>28&15];var i=n[8+(Pp()&3)|0];return Bu(e,0,8)+Bu(e,9,4)+"4"+Bu(e,13,3)+i+Bu(e,16,3)+Bu(e,19,12)}var Cue="00000000000000000000000000000000",Sue="0000000000000000";function $7(n,e,t){return n&&n[Ct]===e&&n!==t?!!n.match(/^[\da-f]*$/i):!1}function z7(n){return $7(n,32,Cue)}function V7(n){return $7(n,16,Sue)}var wue=_7("plugin");function Zc(n){return wue.get(n,"state",{},!0)}function T2(n,e){for(var t=[],r=null,i=n[ro](),a;i;){var o=i[_p]();if(o){r&&r[Rp]&&o[uo]&&r[Rp](o),a=Zc(o);var s=!!a[Xa];o[Xa]&&(s=o[Xa]()),s||t[qt](o),r=o,i=i[ro]()}}it(t,function(c){var u=n[Yn]();c[gm](n.getCfg(),u,e,n[ro]()),a=Zc(c),!c[Yn]&&!a[Yn]&&(a[Yn]=u),a[Xa]=!0,delete a[xo]})}function P0(n){return n.sort(function(e,t){var r=0;if(t){var i=t[uo];e[uo]?r=i?e[Ib]-t[Ib]:1:i&&(r=-1)}else r=e?1:-1;return r})}function Eue(n){var e={};return{getName:function(){return e[Wc]},setName:function(t){e[Wc]=t},getTraceId:function(){return e[r2]},setTraceId:function(t){z7(t)&&(e[r2]=t)},getSpanId:function(){return e[i2]},setSpanId:function(t){V7(t)&&(e[i2]=t)},getTraceFlags:function(){return e[a2]},setTraceFlags:function(t){e[a2]=t}}}var Tue="TelemetryPluginChain",I2="_hasRun",A2="_getTelCtx",k2=0;function Iue(n,e,t){for(;n;){if(n[_p]()===t)return n;n=n[ro]()}return wl([t],e.config||{},e)}function bk(n,e,t,r){var i=null,a=[];e||(e=Ii({},null,t[jn])),r!==null&&(i=r?Iue(n,t,r):n);var o={_next:c,ctx:{core:function(){return t},diagLog:function(){return mk(t,e.cfg)},getCfg:function(){return e.cfg},getExtCfg:h,getConfig:f,hasNext:function(){return!!i},getNext:function(){return i},setNext:function(g){i=g},iterate:p,onComplete:s}};function s(g,v){for(var y=[],b=2;b<arguments.length;b++)y[b-2]=arguments[b];g&&a[qt]({func:g,self:Zt(v)?o.ctx:v,args:y})}function c(){var g=i;if(i=g?g[ro]():null,!g){var v=a;v&&v[Ct]>0&&(it(v,function(y){try{y.func.call(y.self,y.args)}catch(b){nn(t[jn],2,73,"Unexpected Exception during onComplete - "+Ft(b))}}),a=[])}return g}function u(g,v){var y=null,b=e.cfg;if(b&&g){var C=b[vd];!C&&v&&(C={}),b[vd]=C,C=e.ref(b,vd),C&&(y=C[g],!y&&v&&(y={}),C[g]=y,y=e.ref(C,g))}return y}function h(g,v){var y=u(g,!0);return v&&an(v,function(b,C){if(Xt(y[b])){var S=e.cfg[b];(S||!Xt(S))&&(y[b]=S)}pk(e,y,b,C)}),e[gh](y,v)}function f(g,v,y){y===void 0&&(y=!1);var b,C=u(g,!1),S=e.cfg;return C&&(C[v]||!Xt(C[v]))?b=C[v]:(S[v]||!Xt(S[v]))&&(b=S[v]),b||!Xt(b)?b:y}function p(g){for(var v;v=o._next();){var y=v[_p]();y&&g(y)}}return o}function Sl(n,e,t,r){var i=Ii(e),a=bk(n,i,t,r),o=a.ctx;function s(u){var h=a._next();return h&&h[uo](u,o),!h}function c(u,h){return u===void 0&&(u=null),Nt(u)&&(u=wl(u,i.cfg,t,h)),Sl(u||o[ro](),i.cfg,t,h)}return o[$r]=s,o[yl]=c,o}function Ob(n,e,t){var r=Ii(e.config),i=bk(n,r,e,t),a=i.ctx;function o(c){var u=i._next();return u&&u[Ys](a,c),!u}function s(c,u){return c===void 0&&(c=null),Nt(c)&&(c=wl(c,r.cfg,e,u)),Ob(c||a[ro](),e,u)}return a[$r]=o,a[yl]=s,a}function yk(n,e,t){var r=Ii(e.config),i=bk(n,r,e,t),a=i.ctx;function o(c){return a.iterate(function(u){rn(u[Mp])&&u[Mp](a,c)})}function s(c,u){return c===void 0&&(c=null),Nt(c)&&(c=wl(c,r.cfg,e,u)),yk(c||a[ro](),e,u)}return a[$r]=o,a[yl]=s,a}function wl(n,e,t,r){var i=null,a=!r;if(Nt(n)&&n[Ct]>0){var o=null;it(n,function(s){if(!a&&r===s&&(a=!0),a&&s&&rn(s[uo])){var c=Aue(s,e,t);i||(i=c),o&&o._setNext(c),o=c}})}return r&&!i?wl([r],e,t):i}function Aue(n,e,t){var r=null,i=rn(n[uo]),a=rn(n[Rp]),o;n?o=n[As]+"-"+n[Ib]+"-"+k2++:o="Unknown-0-"+k2++;var s={getPlugin:function(){return n},getNext:function(){return r},processTelemetry:h,unload:f,update:p,_id:o,_setNext:function(g){r=g}};function c(){var g;return n&&rn(n[A2])&&(g=n[A2]()),g||(g=Sl(s,e,t)),g}function u(g,v,y,b,C){var S=!1,E=n?n[As]:Tue,T=g[I2];return T||(T=g[I2]={}),g.setNext(r),n&&Xr(g[Yn](),function(){return E+":"+y},function(){T[o]=!0;try{var A=r?r._id:Ut;A&&(T[A]=!1),S=v(g)}catch(k){var I=r?T[r._id]:!0;I&&(S=!0),(!r||!I)&&nn(g[Do](),1,73,"Plugin ["+E+"] failed during "+y+" - "+Ft(k)+", run flags: "+Ft(T))}},b,C),S}function h(g,v){v=v||c();function y(b){if(!n||!i)return!1;var C=Zc(n);return C[xo]||C[aE]?!1:(a&&n[Rp](r),n[uo](g,b),!0)}u(v,y,"processTelemetry",function(){return{item:g}},!g.sync)||v[$r](g)}function f(g,v){function y(){var b=!1;if(n){var C=Zc(n),S=n[Yn]||C[Yn];n&&(!S||S===g.core())&&!C[xo]&&(C[Yn]=null,C[xo]=!0,C[Xa]=!1,n[xo]&&n[xo](g,v)===!0&&(b=!0))}return b}u(g,y,"unload",function(){},v[Wd])||g[$r](v)}function p(g,v){function y(){var b=!1;if(n){var C=Zc(n),S=n[Yn]||C[Yn];n&&(!S||S===g.core())&&!C[xo]&&n[Mp]&&n[Mp](g,v)===!0&&(b=!0)}return b}u(g,y,"update",function(){},!1)||g[$r](v)}return gl(s)}function G7(){var n=[];function e(r){r&&n[qt](r)}function t(r,i){it(n,function(a){try{a(r,i)}catch(o){nn(r[Do](),2,73,"Unexpected error calling unload handler - "+Ft(o))}}),n=[]}return{add:e,run:t}}function K7(){var n=[];function e(r){var i=n;n=[],it(i,function(a){try{(a.rm||a.remove).call(a)}catch(o){nn(r,2,73,"Unloading:"+Ft(o))}})}function t(r){r&&Ns(n,r)}return{run:e,add:t}}var N0,fs="getPlugin",kue=(N0={},N0[vd]={isVal:kb,v:{}},N0),Ck=function(){function n(){var e=this,t,r,i,a,o;u(),mn(n,e,function(h){h[gm]=function(f,p,g,v){c(f,p,v),t=!0},h[xo]=function(f,p){var g,v=h[Yn];if(!v||f&&v!==f[Yn]())return;var y,b=!1,C=f||Ob(null,v,i&&i[fs]?i[fs]():i),S=p||(g={reason:0},g[Wd]=!1,g);function E(){b||(b=!0,a.run(C,p),o.run(C[Do]()),y===!0&&C[$r](S),u())}return!h[Eb]||h[Eb](C,S,E)!==!0?E():y=!0,y},h[Mp]=function(f,p){var g=h[Yn];if(!g||f&&g!==f[Yn]())return;var v,y=!1,b=f||yk(null,g,i&&i[fs]?i[fs]():i),C=p||{reason:0};function S(){y||(y=!0,c(b.getCfg(),b.core(),b[ro]()))}return!h._doUpdate||h._doUpdate(b,C,S)!==!0?S():v=!0,v},xb(h,"_addUnloadCb",function(){return a},"add"),xb(h,"_addHook",function(){return o},"add"),yn(h,"_unloadHooks",{g:function(){return o}})}),e[Do]=function(h){return s(h)[Do]()},e[Xa]=function(){return t},e.setInitialized=function(h){t=h},e[Rp]=function(h){i=h},e[$r]=function(h,f){f?f[$r](h):i&&rn(i[uo])&&i[uo](h,null)},e._getTelCtx=s;function s(h){h===void 0&&(h=null);var f=h;if(!f){var p=r||Sl(null,{},e[Yn]);i&&i[fs]?f=p[yl](null,i[fs]):f=p[yl](null,i)}return f}function c(h,f,p){Ii(h,kue,mk(f)),!p&&f&&(p=f[i7]()[ro]());var g=i;i&&i[fs]&&(g=i[fs]()),e[Yn]=f,r=Sl(p,h,f,g)}function u(){t=!1,e[Yn]=null,r=null,i=null,o=K7(),a=G7()}}return n.__ieDyn=1,n}();function xue(n,e,t){var r={id:e,fn:t};Ns(n,r);var i={remove:function(){it(n,function(a,o){if(a.id===r.id)return n[mm](o,1),-1})}};return i}function _ue(n,e,t){for(var r=!1,i=n[Ct],a=0;a<i;++a){var o=n[a];if(o)try{if(o.fn[sC](null,[e])===!1){r=!0;break}}catch(s){nn(t,2,64,"Telemetry initializer failed: "+p7(s),{exception:Ft(s)},!0)}}return!r}var Mue=function(n){fm(e,n);function e(){var t=n.call(this)||this;t.identifier="TelemetryInitializerPlugin",t.priority=199;var r,i;a(),mn(e,t,function(o,s){o.addTelemetryInitializer=function(c){return xue(i,r++,c)},o[uo]=function(c,u){_ue(i,c,u?u[Do]():o[Do]())&&o[$r](c,u)},o[Eb]=function(){a()}});function a(){r=0,i=[]}return t}return e.__ieDyn=1,e}(Ck),ps,q7="Plugins must provide initialize method",Rue="_notificationManager",x2="SDK is still unloading...",Pue="SDK is not initialized",Nue=100,Oue=5e4,O0=ph((ps={cookieCfg:{}},ps[$u]={rdOnly:!0,ref:!0,v:[]},ps[_c]={rdOnly:!0,ref:!0,v:[]},ps[vd]={ref:!0,v:{}},ps[iE]=$a,ps.loggingLevelConsole=0,ps.diagnosticLogInterval=$a,ps));function Lue(n,e){return new bue(e)}function Due(n,e,t){var r,i=[],a=[],o={};return it(t,function(s){(Xt(s)||Xt(s[gm]))&&Pi(q7);var c=s[Ib],u=s[As];s&&c&&(Xt(o[c])?o[c]=u:Yf(n,"Two extensions have same priority #"+c+" - "+o[c]+", "+u)),!c||c<e?i[qt](s):a[qt](s)}),r={},r[Yn]=i,r[_c]=a,r}function _2(n,e){var t=!1;return it(e,function(r){if(r===n)return t=!0,-1}),t}function vE(n,e,t,r){t&&an(t,function(i,a){r&&ma(a)&&ma(e[i])&&vE(n,e[i],a,r),r&&ma(a)&&ma(e[i])?vE(n,e[i],a,r):n.set(e,i,a)})}function M2(n,e){var t=null,r=-1;return it(n,function(i,a){if(i.w===e)return t=i,r=a,-1}),{i:r,l:t}}function jue(n,e){var t=M2(n,e).l;return t||(t={w:e,rm:function(){var r=M2(n,e);r.i!==-1&&n[mm](r.i,1)}},n[qt](t)),t}function Uue(n,e,t){it(e,function(r){var i=Mr(n,r.w,t);delete r.w,r.rm=function(){i.rm()}})}function Fue(n,e,t,r){return e.add(n[Bs](function(i){var a=i.cfg.disableDbgExt;a===!0&&r&&(t[Cb](r),r=null),t&&!r&&a!==!0&&(r=rue(i.cfg),t[Sb](r))})),r}function Bue(n){return yn({rm:function(){n.rm()}},"toJSON",{v:function(){return"aicore::onCfgChange<"+JSON.stringify(n)+">"}})}var Hue=function(){function n(){var e,t,r,i,a,o,s,c,u,h,f,p,g,v,y,b,C,S,E,T,A,I,k,x,_,R,z,j,J,D,F,ie;mn(n,this,function(U){Q(),U._getDbgPlgTargets=function(){return[k,i]},U[Xa]=function(){return t},U.activeStatus=function(){return R},U._setPendingStatus=function(){R=3},U[gm]=function(P,ne,ye,ae){g&&Pi(x2),U[Xa]()&&Pi("Core cannot be initialized more than once"),e=Ii(P,O0,ye||U[jn],!1),P=e.cfg,Se(e[Bs](function(ze){var ht=ze.cfg,vt=R===3;if(!vt){j=ht.initInMemoMaxSize||Nue;var Ye=ht[YR],st=ht.endpointUrl;if(Xt(Ye)){A=null,R=Cu[c0];var Ot="Please provide instrumentation key";t?(nn(r,1,100,Ot),ue()):Pi(Ot);return}var Yt=[];if(Kd(Ye)?(Yt[qt](Ye),A=null):A=Ye,Kd(st)?(Yt[qt](st),z=null):z=st,Yt[Ct]){J=!1,R=3;var on=kb(ht.initTimeOut)?ht.initTimeOut:Oue,In=ule(Yt);vl(function(){J||W()},on),Yd(In,function(V){try{if(J)return;if(!V.rejected){var we=V[qf];if(we&&we[Ct]){var Re=we[0];if(A=Re&&Re[qf],we[Ct]>1){var Ue=we[1];z=Ue&&Ue[qf]}}A&&(P[YR]=A,P.endpointUrl=z)}W()}catch{J||W()}})}else W();var zn=ze.ref(ze.cfg,vd);an(zn,function(V){ze.ref(zn,V)})}})),a=ae,E=Fue(e,S,a&&U[dg](),E),Me(),U[jn]=ye;var q=P[$u];if(h=[],h[qt].apply(h,VR(VR([],ne,!1),q)),f=P[_c],Ve(null),(!p||p[Ct]===0)&&Pi("No "+_c+" available"),f&&f[Ct]>1){var Te=U[_p]("TeeChannelController");(!Te||!Te.plugin)&&nn(r,1,28,"TeeChannel required")}Uue(P,I,r),I=null,t=!0,R===Cu.ACTIVE&&ue()},U.getChannels=function(){var P=[];return p&&it(p,function(ne){P[qt](ne)}),gl(P)},U.track=function(P){Xr(U[Ab](),function(){return"AppInsightsCore:track"},function(){P===null&&(Y(P),Pi("Invalid telemetry item")),!P[Wc]&&Xt(P[Wc])&&(Y(P),Pi("telemetry name required")),P[Xh]=P[Xh]||A,P[md]=P[md]||cE(new Date),P.ver=P.ver||"4.0",!g&&U[Xa]()&&R===Cu.ACTIVE?Ie()[$r](P):R!==Cu[c0]&&i[Ct]<=j&&i[qt](P)},function(){return{item:P}},!P.sync)},U[i7]=Ie,U[dg]=function(){return a||(a=new gue(e.cfg),U[Rue]=a),a},U[Sb]=function(P){U.getNotifyMgr()[Sb](P)},U[Cb]=function(P){a&&a[Cb](P)},U.getCookieMgr=function(){return c||(c=nv(e.cfg,U[jn])),c},U.setCookieMgr=function(P){c!==P&&(_f(c,!1),c=P)},U[Ab]=function(){return o||s||yue()},U.setPerfMgr=function(P){o=P},U.eventCnt=function(){return i[Ct]},U.releaseQueue=function(){if(t&&i[Ct]>0){var P=i;i=[],R===2?it(P,function(ne){ne[Xh]=ne[Xh]||A,Ie()[$r](ne)}):nn(r,2,20,"core init status is not active")}},U[QR]=function(P){return y=P||null,ie=!1,D&&D[Xu](),te(!0)};function W(){J=!0,Xt(A)?(R=Cu[c0],nn(r,1,112,"ikey can't be resolved from promises")):R=Cu.ACTIVE,ue()}function ue(){t&&(U.releaseQueue(),U[QR]())}function te(P){if((!D||!D[ed])&&!ie){var ne=P||r&&r.queue[Ct]>0;ne&&(F||(F=!0,Se(e[Bs](function(ye){var ae=ye.cfg.diagnosticLogInterval;(!ae||!(ae>0))&&(ae=1e4);var q=!1;D&&(q=D[ed],D[Xu]()),D=Vce(We,ae),D.unref(),D[ed]=q}))),D[ed]=!0)}return D}U[JR]=function(){ie=!0,D&&D[Xu](),We()},m7(U,function(){return v},["addTelemetryInitializer"]),U[Ys]=function(P,ne,ye){var ae;P===void 0&&(P=!0),t||Pi(Pue),g&&Pi(x2);var q=(ae={reason:50},ae[Wd]=P,ae.flushComplete=!1,ae),Te;P&&!ne&&(Te=Cl(function(vt){ne=vt}));var ze=Ob(le(),U);ze[hg](function(){S.run(U[jn]),O7([c,a,r],P,function(){Q(),ne&&ne(q)})},U);function ht(vt){q.flushComplete=vt,g=!0,C.run(ze,q),U[JR](),ze[$r](q)}return We(),be(P,ht,6,ye),Te},U[_p]=ce,U.addPlugin=function(P,ne,ye,ae){if(!P){ae&&ae(!1),M(q7);return}var q=ce(P[As]);if(q&&!ne){ae&&ae(!1),M("Plugin ["+P[As]+"] is already loaded!");return}var Te={reason:16};function ze(Ye){h[qt](P),Te.added=[P],Ve(Te),ae&&ae(!0)}if(q){var ht=[q.plugin],vt={reason:2,isAsync:!!ye};De(ht,vt,function(Ye){Ye?(Te.removed=ht,Te.reason|=32,ze()):ae&&ae(!1)})}else ze()},U.updateCfg=function(P,ne){ne===void 0&&(ne=!0);var ye;if(U[Xa]()){ye={reason:1,cfg:e.cfg,oldCfg:$R({},e.cfg),newConfig:$R({},P),merge:ne},P=ye.newConfig;var ae=e.cfg;P[$u]=ae[$u],P[_c]=ae[_c]}e._block(function(q){var Te=q.cfg;vE(q,Te,P,ne),ne||an(Te,function(ze){fd(P,ze)||q.set(Te,ze,$a)}),q[gh](Te,O0)},!0),e[bb](),ye&&xe(ye)},U.evtNamespace=function(){return b},U.flush=be,U.getTraceCtx=function(P){return T||(T=Eue()),T},U.setTraceCtx=function(P){T=P||null},U.addUnloadHook=Se,xb(U,"addUnloadCb",function(){return C},"add"),U.onCfgChange=function(P){var ne;return t?ne=Mr(e.cfg,P,U[jn]):ne=jue(I,P),Bue(ne)},U.getWParam=function(){return Q6()||e.cfg.enableWParam?0:-1};function Z(){var P={};x=[];var ne=function(ye){ye&&it(ye,function(ae){if(ae[As]&&ae[ZR]&&!P[ae.identifier]){var q=ae[As]+"="+ae[ZR];x[qt](q),P[ae.identifier]=ae}})};ne(p),f&&it(f,function(ye){ne(ye)}),ne(h)}function Q(){t=!1,e=Ii({},O0,U[jn]),e.cfg[a7]=1,yn(U,"config",{g:function(){return e.cfg},s:function(ne){U.updateCfg(ne,!1)}}),yn(U,"pluginVersionStringArr",{g:function(){return x||Z(),x}}),yn(U,"pluginVersionString",{g:function(){return _||(x||Z(),_=x.join(";")),_||Ut}}),yn(U,"logger",{g:function(){return r||(r=new Pb(e.cfg),e[jn]=r),r},s:function(ne){e[jn]=ne,r!==ne&&(_f(r,!1),r=ne)}}),U[jn]=new Pb(e.cfg),k=[];var P=U.config[$u]||[];P.splice(0,P[Ct]),Ns(P,k),v=new Mue,i=[],_f(a,!1),a=null,o=null,s=null,_f(c,!1),c=null,u=null,h=[],f=null,p=null,g=!1,y=null,b=vh("AIBaseCore",!0),C=G7(),T=null,A=null,S=K7(),I=[],_=null,x=null,ie=!1,D=null,F=!1,R=0,z=null,j=null,J=!1}function Ie(){var P=Sl(le(),e.cfg,U);return P[hg](te),P}function Ve(P){var ne=Due(U[jn],eue,h);u=null,_=null,x=null,p=(f||[])[0]||[],p=P0(Ns(p,ne[_c]));var ye=Ns(P0(ne[Yn]),p);k=gl(ye);var ae=U.config[$u]||[];ae.splice(0,ae[Ct]),Ns(ae,k);var q=Ie();p&&p[Ct]>0&&T2(q[yl](p),ye),T2(q,ye),P&&xe(P)}function ce(P){var ne=null,ye=null,ae=[];return it(k,function(q){if(q[As]===P&&q!==v)return ye=q,-1;q.getChannel&&ae[qt](q)}),!ye&&ae[Ct]>0&&it(ae,function(q){if(ye=q.getChannel(P),!ye)return-1}),ye&&(ne={plugin:ye,setEnabled:function(q){Zc(ye)[aE]=!q},isEnabled:function(){var q=Zc(ye);return!q[xo]&&!q[aE]},remove:function(q,Te){var ze;q===void 0&&(q=!0);var ht=[ye],vt=(ze={reason:1},ze[Wd]=q,ze);De(ht,vt,function(Ye){Ye&&Ve({reason:32,removed:ht}),Te&&Te(Ye)})}}),ne}function le(){if(!u){var P=(k||[]).slice();zi(P,v)===-1&&P[qt](v),u=wl(P0(P),e.cfg,U)}return u}function De(P,ne,ye){if(P&&P[Ct]>0){var ae=wl(P,e.cfg,U),q=Ob(ae,U);q[hg](function(){var Te=!1,ze=[];it(h,function(vt,Ye){_2(vt,P)?Te=!0:ze[qt](vt)}),h=ze,_=null,x=null;var ht=[];f&&(it(f,function(vt,Ye){var st=[];it(vt,function(Ot){_2(Ot,P)?Te=!0:st[qt](Ot)}),ht[qt](st)}),f=ht),ye&&ye(Te),te()}),q[$r](ne)}else ye(!1)}function We(){if(r&&r.queue){var P=r.queue.slice(0);r.queue[Ct]=0,it(P,function(ne){var ye,ae=(ye={},ye[Wc]=y||"InternalMessageId: "+ne[wb],ye[Xh]=A,ye[md]=cE(new Date),ye.baseType=fE.dataType,ye.baseData={message:ne[Yc]},ye);U.track(ae)})}}function be(P,ne,ye,ae){var q=1,Te=!1,ze=null;ae=ae||5e3;function ht(){q--,Te&&q===0&&(ze&&ze[Xu](),ze=null,ne&&ne(Te),ne=null)}if(p&&p[Ct]>0){var vt=Ie()[yl](p);vt.iterate(function(Ye){if(Ye.flush){q++;var st=!1;Ye.flush(P,function(){st=!0,ht()},ye)||st||(P&&ze==null?ze=vl(function(){ze=null,ht()},ae):ht())}})}return Te=!0,ht(),!0}function Me(){var P;Se(e[Bs](function(ne){var ye=ne.cfg.enablePerfMgr;if(ye){var ae=ne.cfg[iE];P!==ae&&(ae||(ae=Lue),gle(ne.cfg,iE,ae),P=ae,s=null),!o&&!s&&rn(ae)&&(s=ae(U,U[dg]()))}else s=null,P=null}))}function xe(P){var ne=yk(le(),U);ne[hg](te),(!U._updateHook||U._updateHook(ne,P)!==!0)&&ne[$r](P)}function M(P){var ne=U[jn];ne?(nn(ne,2,73,P),te()):Pi(P)}function Y(P){var ne=U[dg]();ne&&ne[Wf]([P],2)}function Se(P){S.add(P)}})}return n.__ieDyn=1,n}(),_a="",$ue="NoResponseBody",R2="&"+$ue+"=true",L0="POST",zue=function(){function n(){var e=0,t,r,i,a,o,s,c,u,h,f,p,g,v,y;mn(n,this,function(b,C){var S=!0;J(),b[gm]=function(D,F){i=F,r&&nn(i,1,28,"Sender is already initialized"),b.SetConfig(D),r=!0},b._getDbgPlgTargets=function(){return[r,a,s,t]},b.SetConfig=function(D){try{if(o=D.senderOnCompleteCallBack||{},s=!!D.disableCredentials,c=D.fetchCredentials,a=!!D.isOneDs,t=!!D.enableSendPromise,h=!!D.disableXhr,f=!!D.disableBeacon,p=!!D.disableBeaconSync,y=D.timeWrapper,v=!!D.addNoResponse,g=!!D.disableFetchKeepAlive,u={sendPOST:R},a||(S=!1),s){var F=lC();F&&F.protocol&&F.protocol[uk]()==="file:"&&(S=!1)}return!0}catch{}return!1},b.getSyncFetchPayload=function(){return e},b.getSenderInst=function(D,F){return D&&D[Ct]?I(D,F):null},b.getFallbackInst=function(){return u},b[Eb]=function(D,F){J()};function E(D,F){k(F,200,{},D)}function T(D,F){nn(i,2,26,"Failed to send telemetry.",{message:D}),k(F,400,{})}function A(D){T("No endpoint url is provided for the batch",D)}function I(D,F){for(var ie,U=0,W=null,ue=0;W==null&&ue<D[Ct];)U=D[ue],!h&&U===1?jle()?W=j:w7()&&(W=R):U===2&&S7(F)&&(!F||!g)?W=z:U===3&&C7()&&(F?!p:!f)&&(W=_),ue++;return W?(ie={_transport:U,_isSync:F},ie[t2]=W,ie):null}function k(D,F,ie,U){try{D&&D(F,ie,U)}catch{}}function x(D,F){var ie=mo(),U=D[ef];if(!U)return A(F),!0;U=D[ef]+(v?R2:_a);var W=D[Hu],ue=a?W:new Blob([W],{type:"text/plain;charset=UTF-8"}),te=ie.sendBeacon(U,ue);return te}function _(D,F,ie){var U=D[Hu];try{if(U)if(x(D,F))E(_a,F);else{var W=o&&o.beaconOnRetry;W&&rn(W)?W(D,F,x):(u&&u[t2](D,F,!0),nn(i,2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}catch(ue){a&&Yf(i,"Failed to send telemetry using sendBeacon API. Ex:"+Ft(ue)),k(F,a?0:400,{},_a)}}function R(D,F,ie){var U,W,ue,te=D[u0]||{};!ie&&t&&(U=Cl(function(Ve,ce){W=Ve,ue=ce})),a&&ie&&D.disableXhrSync&&(ie=!1);var Z=D[ef];if(!Z){A(F),W&&W(!1);return}var Q=Sle(L0,Z,S,!0,ie,D[Su]);a||Q[n2]("Content-type","application/json"),it(Lo(te),function(Ve){Q[n2](Ve,te[Ve])}),Q.onreadystatechange=function(){a||(Ie(Q),Q.readyState===4&&W&&W(!0))},Q.onload=function(){a&&Ie(Q)};function Ie(Ve){var ce=o&&o.xhrOnComplete,le=ce&&rn(ce);if(le)ce(Ve,F,D);else{var De=Qd(Ve);k(F,Ve[Af],ev(Ve,a),De)}}return Q.onerror=function(Ve){k(F,a?Q[Af]:400,ev(Q,a),a?_a:l2(Q)),ue&&ue(Ve)},Q.ontimeout=function(){k(F,a?Q[Af]:500,ev(Q,a),a?_a:l2(Q)),W&&W(!1)},Q.send(D[Hu]),U}function z(D,F,ie){var U,W=D[ef],ue=D[Hu],te=a?ue:new Blob([ue],{type:"application/json"}),Z,Q,Ie,Ve=new Headers,ce=ue[Ct],le=!1,De=!1,We=D[u0]||{},be=(U={method:L0,body:te},U[h2]=!0,U);D.headers&&Lo(D.headers)[Ct]>0&&(it(Lo(We),function(Y){Ve.append(Y,We[Y])}),be[u0]=Ve),c?be.credentials=c:S&&a&&(be.credentials="include"),ie&&(be.keepalive=!0,e+=ce,a?D._sendReason===2&&(le=!0,v&&(W+=R2)):le=!0);var Me=new Request(W,be);try{Me[h2]=!0}catch{}if(!ie&&t&&(Z=Cl(function(Y,Se){Q=Y,Ie=Se})),!W){A(F),Q&&Q(!1);return}function xe(Y){k(F,a?0:400,{},a?_a:Y)}function M(Y,Se,P){var ne=Y[Af],ye=o.fetchOnComplete;ye&&rn(ye)?ye(Y,F,P||_a,Se):k(F,ne,{},P||_a)}try{Yd(fetch(a?W:Me,a?be:null),function(Y){if(ie&&(e-=ce,ce=0),!De)if(De=!0,Y.rejected)xe(Y.reason&&Y.reason[Yc]),Ie&&Ie(Y.reason);else{var Se=Y[qf];try{!a&&!Se.ok?(xe(Se.statusText),Q&&Q(!1)):a&&!Se.body?(M(Se,null,_a),Q&&Q(!0)):Yd(Se.text(),function(P){M(Se,D,P[qf]),Q&&Q(!0)})}catch(P){xe(Ft(P)),Ie&&Ie(P)}}})}catch(Y){De||(xe(Ft(Y)),Ie&&Ie(Y))}return le&&!De&&(De=!0,k(F,200,{}),Q&&Q(!0)),a&&!De&&D[Su]>0&&y&&y.set(function(){De||(De=!0,k(F,500,{}),Q&&Q(!0))},D[Su]),Z}function j(D,F,ie){var U=ic(),W=new XDomainRequest,ue=D[Hu];W.onload=function(){var Ve=Qd(W),ce=o&&o.xdrOnComplete;ce&&rn(ce)?ce(W,F,D):k(F,200,{},Ve)},W.onerror=function(){k(F,400,{},a?_a:ble(W))},W.ontimeout=function(){k(F,500,{})},W.onprogress=function(){};var te=U&&U.location&&U.location[o7]||"",Z=D[ef];if(!Z){A(F);return}if(!a&&Z.lastIndexOf(te,0)!==0){var Q="Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol.";nn(i,2,40,". "+Q),T(Q,F);return}var Ie=a?Z:Z[Qc](/^(https?:)/,"");W.open(L0,Ie),D[Su]&&(W[Su]=D[Su]),W.send(ue),a&&ie?y&&y.set(function(){W.send(ue)},0):W.send(ue)}function J(){e=0,r=!1,t=!1,i=null,a=null,o=null,s=null,c=null,u=null,h=!1,f=!1,p=!1,g=!1,v=!1,y=null}})}return n.__ieDyn=1,n}(),W7="on",P2="attachEvent",N2="addEventListener",O2="detachEvent",L2="removeEventListener",bE="events",Op="visibilitychange",dC="pagehide",Y7="pageshow",Q7="unload",J7="beforeunload",Z7=vh("aiEvtPageHide"),X7=vh("aiEvtPageShow"),Vue=/\.[\.]+/g,Gue=/[\.]+$/,Kue=1,Lb=_7("events"),que=/^([^.]*)(?:\.(.+)|)/;function D2(n){return n&&n[Qc]?n[Qc](/^[\s\.]+|(?=[\s\.])[\.\s]+$/g,Ut):n}function Sk(n,e){var t;if(e){var r=Ut;Nt(e)?(r=Ut,it(e,function(a){a=D2(a),a&&(a[0]!=="."&&(a="."+a),r+=a)})):r=D2(e),r&&(r[0]!=="."&&(r="."+r),n=(n||Ut)+r)}var i=que.exec(n||Ut)||[];return t={},t[jo]=i[1],t.ns=(i[2]||Ut).replace(Vue,".").replace(Gue,Ut)[cC](".").sort().join("."),t}function e8(n,e,t){t===void 0&&(t=!0);var r=Lb.get(n,bE,{},t),i=r[e];return i||(i=r[e]=[]),i}function t8(n,e,t,r){n&&e&&e[jo]&&(n[L2]?n[L2](e[jo],t,r):n[O2]&&n[O2](W7+e[jo],t))}function Wue(n,e,t,r){var i=!1;return n&&e&&e[jo]&&t&&(n[N2]?(n[N2](e[jo],t,r),i=!0):n[P2]&&(n[P2](W7+e[jo],t),i=!0)),i}function j2(n,e,t,r){for(var i=e[Ct];i--;){var a=e[i];a&&(!t.ns||t.ns===a.evtName.ns)&&(!r||r(a))&&(t8(n,a.evtName,a[dk],a.capture),e[mm](i,1))}}function Yue(n,e,t){if(e[jo])j2(n,e8(n,e[jo]),e,t);else{var r=Lb.get(n,bE,{});an(r,function(i,a){j2(n,a,e,t)}),Lo(r)[Ct]===0&&Lb.kill(n,bE)}}function vm(n,e){var t;return e?(Nt(e)?t=[n].concat(e):t=[n,e],t=Sk("xx",t).ns[cC](".")):t=n,t}function D0(n,e,t,r,i){var a;i===void 0&&(i=!1);var o=!1;if(n)try{var s=Sk(e,r);if(o=Wue(n,s,t,i),o&&Lb.accept(n)){var c=(a={guid:Kue++,evtName:s},a[dk]=t,a.capture=i,a);e8(n,s.type)[qt](c)}}catch{}return o}function j0(n,e,t,r,i){if(i===void 0&&(i=!1),n)try{var a=Sk(e,r),o=!1;Yue(n,a,function(s){return a.ns&&!t||s[dk]===t?(o=!0,!0):!1}),o||t8(n,a,t,i)}catch{}}function Que(n,e,t){var r=!1,i=ic();i&&(r=D0(i,n,e,t),r=D0(i.body,n,e,t)||r);var a=Ko();return a&&(r=D0(a,n,e,t)||r),r}function Jue(n,e,t){var r=ic();r&&(j0(r,n,e,t),j0(r.body,n,e,t));var i=Ko();i&&j0(i,n,e,t)}function Jd(n,e,t,r){var i=!1;return e&&n&&n[Ct]>0&&it(n,function(a){a&&(!t||zi(t,a)===-1)&&(i=Que(a,e,r)||i)}),i}function Zue(n,e,t,r){var i=!1;return e&&n&&Nt(n)&&(i=Jd(n,e,t,r),!i&&t&&t[Ct]>0&&(i=Jd(n,e,null,r))),i}function Lp(n,e,t){n&&Nt(n)&&it(n,function(r){r&&Jue(r,e,t)})}function Xue(n,e,t){return Zue([J7,Q7,dC],n,e,t)}function ede(n,e){Lp([J7,Q7,dC],n,e)}function n8(n,e,t){function r(o){var s=Ko();n&&s&&s.visibilityState==="hidden"&&n(o)}var i=vm(Z7,t),a=Jd([dC],n,e,i);return(!e||zi(e,Op)===-1)&&(a=Jd([Op],r,e,i)||a),!a&&e&&(a=n8(n,null,t)),a}function tde(n,e){var t=vm(Z7,e);Lp([dC],n,t),Lp([Op],null,t)}function r8(n,e,t){function r(o){var s=Ko();n&&s&&s.visibilityState==="visible"&&n(o)}var i=vm(X7,t),a=Jd([Y7],n,e,i);return a=Jd([Op],r,e,i)||a,!a&&e&&(a=r8(n,null,t)),a}function nde(n,e){var t=vm(X7,e);Lp([Y7],n,t),Lp([Op],null,t)}var bh="",rde="https://browser.events.data.microsoft.com/OneCollector/1.0/",U2="version",U0="properties",F2="initialize",B2="logger",iv="indexOf",ks="timings",H2="pollInternalLogs",_i="value",$2="kind",wk="length",F0="processTelemetryStart",Eo,ide="4.3.3",i8="1DS-Web-JS-"+ide,a8=zse.hasOwnProperty,ade=(Eo={},Eo[0]=0,Eo[2]=6,Eo[1]=1,Eo[3]=7,Eo[4098]=6,Eo[4097]=1,Eo[4099]=7,Eo),B0=null;function xs(n){return!(n===bh||Xt(n))}function ode(n){if(n){var e=oC(n,"-");if(e>-1)return ZA(n,e)}return bh}function U4e(){return B0===null&&(B0=!Zt(Uint8Array)&&!dde()&&!lE()),B0}function sde(n){return!!(n&&Ks(n)&&n>=1&&n<=4)}function cde(n,e,t){if(!e&&!xs(e)||typeof n!="string")return null;var r=typeof e;if(r==="string"||r==="number"||r==="boolean"||Nt(e))e={value:e};else if(r==="object"&&!a8.call(e,"value"))e={value:t?JSON.stringify(e):e};else if(Xt(e[_i])||e[_i]===bh||!kr(e[_i])&&!Ks(e[_i])&&!ml(e[_i])&&!Nt(e[_i]))return null;if(Nt(e[_i])&&!hde(e[_i]))return null;if(!Xt(e[$2])){if(Nt(e[_i])||!lde(e[$2]))return null;e[_i]=e[_i].toString()}return e}function o8(n,e,t){var r=-1;if(!Zt(n))if(e>0&&(e===32?r=8192:e<=13&&(r=e<<5)),ude(t))r===-1&&(r=0),r|=t;else{var i=ade[CE(n)]||-1;r!==-1&&i!==-1?r|=i:i===6&&(r=i)}return r}function Zd(n,e,t){t===void 0&&(t=!0);var r;return n&&(r=n.get(e),t&&r&&decodeURIComponent&&(r=decodeURIComponent(r))),r||bh}function z2(n){n===void 0&&(n="D");var e=H7();return n==="B"?e="{"+e+"}":n==="P"?e="("+e+")":n==="N"&&(e=e.replace(/-/g,bh)),e}function Db(n,e,t,r,i){var a={},o=!1,s=0,c=arguments[wk],u=arguments;for(ml(u[0])&&(o=u[0],s++);s<c;s++){var n=u[s];an(n,function(f,p){o&&p&&Gd(p)?Nt(p)?(a[f]=a[f]||[],it(p,function(g,v){g&&Gd(g)?a[f][v]=Db(!0,a[f][v],g):a[f][v]=g})):a[f]=Db(!0,a[f],p):a[f]=p})}return a}var Da=jce;function lde(n){return n===0||n>0&&n<=13||n===32}function ude(n){return n>=0&&n<=9}function dde(){var n=mo();if(!Zt(n)&&n.userAgent){var e=n.userAgent.toLowerCase();if((e[iv]("safari")>=0||e[iv]("firefox")>=0)&&e[iv]("chrome")<0)return!0}return!1}function hde(n){return n[wk]>0}function yE(n,e){var t=n;t[ks]=t[ks]||{},t[ks][F0]=t[ks][F0]||{},t[ks][F0][e]=Da()}function CE(n){var e=0;if(n!=null){var t=typeof n;t==="string"?e=1:t==="number"?e=2:t==="boolean"?e=3:t===VA&&(e=4,Nt(n)?(e=4096,n[wk]>0&&(e|=CE(n[0]))):a8.call(n,"value")&&(e=8192|CE(n[_i])))}return e}function fde(){return!!$n("chrome")}function Jf(n){return n>0}var pde=ph({endpointUrl:rde,propertyStorageOverride:{isVal:mde}});function mde(n){return n&&(!n.getProperty||!n.setProperty)&&Pi("Invalid property storage override passed."),!0}var gde=function(n){fm(e,n);function e(){var t=n.call(this)||this;return mn(e,t,function(r,i){r[F2]=function(a,o,s,c){Xr(r,function(){return"AppInsightsCore.initialize"},function(){try{i[F2](Ii(a,pde,s||r[B2],!1).cfg,o,s,c)}catch(f){var u=r[B2],h=Ft(f);h[iv]("channels")!==-1&&(h+=`
 - Channels must be provided through config.channels only!`),nn(u,1,514,"SDK Initialization Failed - no telemetry will be sent: "+h)}},function(){return{config:a,extensions:o,logger:s,notificationManager:c}})},r.track=function(a){Xr(r,function(){return"AppInsightsCore.track"},function(){var o=a;if(o){o[ks]=o[ks]||{},o[ks].trackStart=Da(),sde(o.latency)||(o.latency=1);var s=o.ext=o.ext||{};s.sdk=s.sdk||{},s.sdk.ver=i8;var c=o.baseData=o.baseData||{};c[U0]=c[U0]||{};var u=c[U0];u[U2]=u[U2]||r.pluginVersionString||bh}i.track(o)},function(){return{item:a}},!a.sync)},r[H2]=function(a){return i[H2](a||"InternalLog")}}),t}return e.__ieDyn=1,e}(Hue),vde="device",s8="locale",Ek="ver",bde="browser",yde="browserVer",Cde="popSample",Sde="eventFlags",Tk="name",wde="serviceName",hi=oi({UserExt:[0,"user"],DeviceExt:[1,vde],TraceExt:[2,"trace"],WebExt:[3,"web"],AppExt:[4,"app"],OSExt:[5,"os"],SdkExt:[6,"sdk"],IntWebExt:[7,"intweb"],UtcExt:[8,"utc"],LocExt:[9,"loc"],CloudExt:[10,"cloud"],DtExt:[11,"dt"]}),Ede=oi({id:[0,"id"],ver:[1,Ek],appName:[2,Tk],locale:[3,s8],expId:[4,"expId"],env:[5,"env"]}),Tde=oi({domain:[0,"domain"],browser:[1,bde],browserVer:[2,yde],screenRes:[3,"screenRes"],userConsent:[4,"userConsent"],consentDetails:[5,"consentDetails"]}),Ide=oi({locale:[0,s8],localId:[1,"localId"],id:[2,"id"]}),Ade=oi({osName:[0,Tk],ver:[1,Ek]}),kde=oi({ver:[0,Ek],seq:[1,"seq"],installId:[2,"installId"],epoch:[3,"epoch"]}),xde=oi({msfpc:[0,"msfpc"],anid:[1,"anid"],serviceName:[2,wde]}),_de=oi({popSample:[0,Cde],eventFlags:[1,Sde]}),Mde=oi({tz:[0,"tz"]}),Rde=oi({sessionId:[0,"sesId"]}),Pde=oi({localId:[0,"localId"],deviceClass:[1,"deviceClass"],make:[2,"make"],model:[3,"model"]}),Nde=oi({role:[0,"role"],roleInstance:[1,"roleInstance"],roleVer:[2,"roleVer"]}),Ode=oi({traceId:[0,"traceID"],traceName:[1,Tk],parentId:[2,"parentID"]}),Lde=oi({traceId:[0,"traceId"],spanId:[1,"spanId"],traceFlags:[2,"traceFlags"]}),Zf;function c8(){return Zf===void 0&&(Zf=!!u8(0)),Zf}function l8(){return c8()?u8(0):null}function u8(n){var e=null,t,r;try{var i=mh();if(!i)return null;r=new Date,e=n===0?i.localStorage:i.sessionStorage,e&&rn(e.setItem)&&(e.setItem(r,r),t=e.getItem(r)!==r,e.removeItem(r),t&&(e=null))}catch{e=null}return e}function Dde(n,e,t){var r=l8();if(r!==null)try{return r.setItem(e,t),!0}catch(i){Zf=!1,nn(n,1,504,"Browser failed write to local storage. "+i)}return!1}function jde(n,e){var t=l8();if(t!==null)try{return t.getItem(e)}catch(r){Zf=!1,nn(n,1,503,"Browser failed read of local storage. "+r)}return null}function Ude(){return this.getId()}function Fde(n){this.setId(n)}var d8=function(){function n(){mn(n,this,function(e){e.setId=function(t){e.customId=t},e.getId=function(){return kr(e.customId)?e.customId:e.automaticId}})}return n._staticInit=function(){yn(n.prototype,"id",{g:Ude,s:Fde})}(),n}(),V2="ai_session",Bde=function(){function n(e,t,r){var i,a=mk(e),o=F7(e),s,c;mn(n,this,function(u){var h=Mr(t,function(){c=t,u.config=c});r&&r.add(h),s=function(){return u.config.namePrefix?V2+u.config.namePrefix:V2},u.automaticSession=new d8,u.update=function(){u.automaticSession.getId()||f();var b=u.automaticSession,C=u.config,S=new Date().getTime(),E=S-b.acquisitionDate>C.sessionExpirationMs,T=S-b.renewalDate>C.sessionRenewalMs;if(E||T)g();else{var A=i;(!A||S-A>n.cookieUpdateInterval)&&(b.renewalDate=S,v(b.getId(),b.acquisitionDate,b.renewalDate))}},u.backup=function(){var b=u.automaticSession;y(b.getId(),b.acquisitionDate,b.renewalDate)};function f(){var b=o.get(s());if(b&&rn(b.split))p(b);else{var C=jde(a,s());C&&p(C)}u.automaticSession.getId()||g()}function p(b){var C=u.automaticSession,S=b.split("|");S.length>0&&C.setId(S[0]);try{if(S.length>1){var E=+S[1];C.acquisitionDate=+new Date(E),C.acquisitionDate=C.acquisitionDate>0?C.acquisitionDate:0}if(S.length>2){var T=+S[2];C.renewalDate=+new Date(T),C.renewalDate=C.renewalDate>0?C.renewalDate:0}}catch(A){nn(a,1,510,"Error parsing ai_session cookie, session will be reset: "+A)}C.renewalDate===0&&nn(a,2,517,"AI session renewal date is 0, session will be reset.")}function g(){var b=u.automaticSession,C=new Date().getTime(),S=u.config.sessionAsGuid;!Zt(S)&&S?ml(S)?b.setId(z2()):b.setId(z2(S)):b.setId(fk(c.idLength||22)),b.acquisitionDate=C,b.renewalDate=C,v(b.getId(),b.acquisitionDate,b.renewalDate),c8()||nn(a,2,505,"Browser does not support local storage. Session durations will be inaccurate.")}function v(b,C,S){var E=C+u.config.sessionExpirationMs,T=S+u.config.sessionRenewalMs,A=new Date,I=[b,C,S];E<T?A.setTime(E):A.setTime(T);var k=u.config.cookieDomain||null;o.set(s(),I.join("|")+";expires="+A.toUTCString(),null,k),i=new Date().getTime()}function y(b,C,S){Dde(a,s(),[b,C,S].join("|"))}})}return n.cookieUpdateInterval=6e4,n}(),Ik=["AX","EX","SF","CS","CF","CT","CU","DC","DF","H5","HL","WS","WP"];function G2(n,e){e===void 0&&(e=Ik);var t=null;if(n)for(var r=n.split(","),i=0;i<r.length;i++)Hde(r[i],e)&&(t?t+=","+r[i]:t=r[i]);return t}function Hde(n,e){if(e===void 0&&(e=Ik),!n||n.length<4)return!1;for(var t=!1,r=256,i=n.substring(0,3).toString().toUpperCase(),a=0;a<e.length;a++)if(e[a]+":"===i&&n.length<=r){t=!0;break}return t}function $de(){return this.getExpId()}var zde=function(){function n(e,t,r){var i=null,a=Ik.slice(0),o="Treatments",s,c=null;mn(n,this,function(u){if(y(e),Q6()){var h=Ko().documentElement;h&&(u.locale=h.lang)}u.getExpId=function(){return c.expId?v(c.expId):g()};function f(b){var C,S={},E=Ko();if(E){C=E&&E.querySelectorAll("meta");for(var T=0;T<C.length;T++){var A=C[T];if(A.name){var I=A.name.toLowerCase();if(I.indexOf(b)===0){var k=A.name.replace(b,"");S[k]=A.content}}}}return S}function p(b){b!==i&&(i=G2(b,a))}function g(){var b=Zd(s,o);return p(b),i}function v(b){return p(b),i}function y(b){var C=Mr(b,function(){s=t&&t.getCookieMgr(),c=b||{},u.env=c.env||f("awa-").env});r&&r.add(C)}})}return n.validateAppExpId=G2,n._staticInit=function(){yn(n.prototype,"expId",{g:$de})}(),n}(),Vde=function(){function n(){}return n}(),Gde=function(){function n(){}return n}();function Kde(){return this.getMsfpc()}function qde(){return this.getAnid()}var Wde=function(){function n(e,t,r){var i;mn(n,this,function(a){o(e),a.getMsfpc=function(){return Zd(i,"MSFPC")},a.getAnid=function(){return Zd(i,"ANON").slice(0,34)};function o(s){var c=Mr(s,function(){i=t&&t.getCookieMgr();var u=s||{};u.serviceName&&(a.serviceName=u.serviceName)});r&&r.add(c)}})}return n._staticInit=function(){var e=n.prototype;yn(e,"msfpc",{g:Kde}),yn(e,"anid",{g:qde})}(),n}(),Yde=function(){function n(){var e=new Date().getTimezoneOffset(),t=e%60,r=(e-t)/60,i="+";r>0&&(i="-"),r=Math.abs(r),t=Math.abs(t),this.tz=i+(r<10?"0"+r:r.toString())+":"+(t<10?"0"+t:t.toString())}return n}(),ms={WIN:/(windows|win32)/i,WINRT:/ arm;/i,WINPHONE:/windows\sphone\s\d+\.\d+/i,OSX:/(macintosh|mac os x)/i,IOS:/(ipad|iphone|ipod)(?=.*like mac os x)/i,LINUX:/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,ANDROID:/android/i,CROS:/CrOS/i},K2={"5.1":"XP","6.0":"Vista","6.1":"7","6.2":"8","6.3":"8.1","10.0":"10"},Qde="([\\d,.]+)",h8="([\\d,_,.]+)",yh="Unknown",q2=[{r:ms.WINPHONE,os:"Windows Phone"},{r:ms.WINRT,os:"Windows RT"},{r:ms.WIN,os:"Windows"},{r:ms.IOS,os:"iOS"},{r:ms.ANDROID,os:"Android"},{r:ms.LINUX,os:"Linux"},{r:ms.CROS,os:"Chrome OS"},{s:"x11",os:"Unix"},{s:"blackberry",os:"BlackBerry"},{s:"symbian",os:"Symbian"},{s:"nokia",os:"Nokia"},{r:ms.OSX,os:"Mac OS X"}];function Jde(n){for(var e=0;e<q2.length;e++){var t=q2[e];if(t.r&&n.match(t.r))return t.os;if(t.s&&n.indexOf(t.s)!==-1)return t.os}return yh}function Zde(n,e){return e==="Windows"?W2(n,"Windows NT"):e==="Android"?W2(n,e):e==="Mac OS X"?Xde(n):e==="iOS"?ehe(n):yh}function W2(n,e){var t=n.match(new RegExp(e+" "+Qde));return t?K2[t[1]]?K2[t[1]]:t[1]:yh}function Xde(n){var e=n.match(new RegExp("Mac OS X "+h8));if(e){var t=e[1].replace(/_/g,".");if(t){var r=f8(t);if(r){var i=t.split(r);return i[0]}else return t}}return yh}function ehe(n){var e=n.match(new RegExp("OS "+h8));if(e){var t=e[1].replace(/_/g,".");if(t){var r=f8(t);if(r){var i=t.split(r);return i[0]}else return t}}return yh}function f8(n){return n.indexOf(".")>-1?".":n.indexOf("_")>-1?"_":null}var the=function(){function n(e,t){var r=this,i,a=null,o=null,s=null,c=null,u=function(v){s=v},h=function(v){c=v},f=function(){return s||a},p=function(){return c||o},g=Mr(e,function(){if(i=e||{},i.populateOperatingSystemInfo){var v=mo()||{},y=e.userAgent||v.userAgent||"",b=(e.userAgentData||{}).platform||(v.userAgentData||{}).platform;if(y){var C=Jde(y.toLowerCase());a=C,o=Zde(y,C)}(!a||a===yh)&&kr(b)&&(a=b)}});t&&t.add(g),yn(r,"name",{s:u,g:f}),yn(r,"ver",{s:h,g:p})}return n}(),H0="MicrosoftApplicationsTelemetryDeviceId";function nhe(n,e,t,r){e?e.setProperty(t,r):n.set(t,r,31536e3)}function rhe(n,e,t){return e?e.getProperty(t)||"":Zd(n,t)}var ihe=function(){function n(e,t,r){var i=0,a;mn(n,this,function(o){o.seq=i,o.epoch=Pp(!1).toString(),o.getSequenceId=function(){return++i};var s=Mr(e,function(c){a=t&&t.getCookieMgr();var u=c.cfg,h=u.propertyStorageOverride,f=a.isEnabled();if(f||h){var p=rhe(a,h,H0);p||(p=H7()),nhe(a,h,H0,p),o.installId=p}else a.purge(H0)});r&&r.add(s)})}return n.__ieDyn=1,n}(),ahe=function(){function n(e,t,r,i,a){var o=this;o.traceId=t||gE();var s=Mr(e,function(){var c=e;if(c.enableDistributedTracing&&!r&&(r=gE().substring(0,16)),o.parentId=o.parentId||r,c.enableApplicationInsightsTrace&&!i){var u=lC();u&&u.pathname&&(i=u.pathname)}o.name=o.name||i});a&&a.add(s)}return n}(),p8="setLocalId";function ohe(){return this.getLocalId()}function she(n){this[p8](n)}var che=function(){function n(e,t,r,i){var a,o,s;mn(n,this,function(c){if(f(t),typeof navigator<"u"){var u=navigator;c.locale=u.userLanguage||u.language}c.getLocalId=function(){return o||h()},c[p8]=function(p){o=p};function h(){if(!a.hashIdentifiers&&!a.dropIdentifiers){var p=Zd(s,"MUID");p&&(o="t:"+p)}return o}function f(p){var g=Mr(p,function(){if(s=r&&r.getCookieMgr(),a=p,o=null,s&&s.isEnabled()&&(h(),a.enableApplicationInsightsUser)){var v=Zd(s,n.userCookieName);if(v){var y=v.split(n.cookieSeparator);y.length>0&&(c.id=y[0])}if(!c.id){c.id=fk(e&&!Zt(e.idLength)?e.idLength:22);var b=cE(new Date);c.accountAcquisitionDate=b;var C=[c.id,b],S=a.cookieDomain?a.cookieDomain:void 0;s.set(n.userCookieName,C.join(n.cookieSeparator),31536e3,S)}}});i&&i.add(g)}})}return n.cookieSeparator="|",n.userCookieName="ai_user",n._staticInit=function(){yn(n.prototype,"localId",{g:ohe,s:she})}(),n}(),lhe=1048576,uhe=2097152,dhe=4194304,hhe=function(){function n(e,t){var r=this;r.popSample=100;var i=Mr(e,function(){r.eventFlags=0,e.hashIdentifiers&&(r.eventFlags=r.eventFlags|lhe),e.dropIdentifiers&&(r.eventFlags=r.eventFlags|uhe),e.scrubIpOnly&&(r.eventFlags=r.eventFlags|dhe)});t&&t.add(i)}return n}(),Y2=["Required","Analytics","SocialMedia","Advertising"],jb="([\\d,.]+)",m8="Unknown",g8="Edg/",v8="EdgiOS/",$0=[{ua:"OPR/",b:"Opera"},{ua:"PhantomJS",b:"PhantomJS"},{ua:"Edge",b:"Edge"},{ua:g8,b:"Edge"},{ua:v8,b:"Edge"},{ua:"Electron",b:"Electron"},{ua:"Chrome",b:"Chrome"},{ua:"Trident",b:"MSIE"},{ua:"MSIE ",b:"MSIE"},{ua:"Firefox",b:"Firefox"},{ua:"Safari",b:"Safari"},{ua:"SkypeShell",b:"SkypeShell"}],z0=[{br:"Microsoft Edge",b:"Edge"},{br:"Google Chrome",b:"Chrome"},{br:"Opera",b:"Opera"}];function SE(n,e){return e.indexOf(n)>-1}function fhe(n,e){for(var t=0;t<e.length;t++)if(n==e[t].brand)return e[t].version;return null}function phe(n){if(n)for(var e=0;e<$0.length;e++){var t=$0[e].ua;if(SE(t,n))return $0[e].b}return m8}function mhe(n,e){return e==="MSIE"?ghe(n):vhe(e,n)}function ghe(n){var e=n.match(new RegExp("MSIE "+jb));if(e)return e[1];var t=n.match(new RegExp("rv:"+jb));if(t)return t[1]}function vhe(n,e){n==="Safari"?n="Version":n==="Edge"&&(SE(g8,e)?n="Edg":SE(v8,e)&&(n="EdgiOS"));var t=e.match(new RegExp(n+"/"+jb));return t||n==="Opera"&&(t=e.match(new RegExp("OPR/"+jb)),t)?t[1]:m8}function bhe(){var n={h:0,w:0},e=ic();return e&&e.screen&&(n.h=screen.height,n.w=screen.width),n}function yhe(){return this.getUserConsent()}var Che=function(){function n(e,t,r){F7(t);var i=e||{},a=null,o=null,s=null,c=null,u=null,h=null,f=null;mn(n,this,function(p){k(e);var g=lC();if(g){var v=g.hostname;v&&(p.domain=g.protocol==="file:"?"local":v)}var y=bhe();p.screenRes=y.w+"X"+y.h,p.getUserConsent=function(){return!1},p.getUserConsentDetails=function(){var x=null;try{var _=i.callback;if(_&&_.userConsentDetails){var R=_.userConsentDetails();if(R){i.disableConsentDetailsSanitize?x=R:x={};for(var z=0;z<Y2.length;z++){var j=Y2[z];x[j]=R[j]||!1}}}return f!==null&&(x=x||{},x.GPC_DataSharingOptIn=!!f),x?JSON.stringify(x):null}catch{}};function b(x,_){if(Nt(_))try{for(var R=0;R<z0.length;R++){var z=fhe(z0[R].br,_);if(z){u=z0[R].b,h=z;return}}}catch{}if(x){var j=phe(x);u=j,h=mhe(x,j)}}function C(x){s=x}function S(x){c=x}function E(){return s||u}function T(){return c||h}var A=function(){return f},I=function(x){f=ml(x)?x:null,i.gpcDataSharingOptIn=f};function k(x){var _=Mr(x,function(){if(i=x,i.populateBrowserInfo){var R=i.userAgent,z=(i.userAgentData||{}).brands;if(R!==a||z!==o){if(!R||!z||z.length===0){var j=mo();j&&(R=R||j.userAgent||"",z=z||(j.userAgentData||{}).brands)}b(R,z),a=R,o=z}}f=ml(i.gpcDataSharingOptIn)?i.gpcDataSharingOptIn:null});r&&r.add(_)}z6(p,{userConsent:{g:p.getUserConsent},browser:{s:C,g:E},browserVer:{s:S,g:T},gpcDataSharingOptIn:{g:A,s:I}})})}return n._staticInit=function(){yn(n.prototype,"userConsent",{g:yhe})}(),n}();function ui(n,e,t,r,i){var a=e.ext[hi[n]];if(a)try{an(r,function(o,s){if(kr(s)||Ks(s)||ml(s)){var c=a[t[o]];!i&&(c||kr(c)||Ks(c)||ml(c))&&(s=c),a[t[o]]=s}})}catch{}return a}var She=function(){function n(e,t,r,i){mn(n,this,function(a){a.app=new zde(t,r,i),a.cloud=new Vde,a.user=new che(e,t,r,i),a.os=new the(t,i),a.web=new Che(t,r,i);var o=new ihe(e,r,i),s=new Wde(t,r,i),c=new hhe(t,i);a.loc=new Yde,a.device=new Gde;var u=new Bde(r,t,i);a.session=new d8;var h=void 0,f=whe(new ahe(t,h,h,h,i),v()),p=!(t||{}).eventContainExtFields;function g(){var y=a.session;if(y&&kr(y.customId))return y.customId;u.update();var b=u.automaticSession;if(b){var C=b.getId();C&&kr(C)&&(y.automaticId=C)}return y.automaticId}a.getTraceCtx=function(){return f},a.getSessionId=g,a.applyApplicationContext=function(y){var b,C=a.app;ui(4,y,Ede,(b={},b[0]=C.id,b[1]=C.ver,b[2]=C.name,b[3]=C.locale,b[4]=C.getExpId(),b[5]=C.env,b),p)},a.applyUserContext=function(y){var b,C=a.user;ui(0,y,Ide,(b={},b[1]=C.getLocalId(),b[0]=C.locale,b[2]=C.id,b),p)},a.applyWebContext=function(y){var b,C=a.web;ui(3,y,Tde,(b={},b[0]=C.domain,b[1]=C.browser,b[2]=C.browserVer,b[3]=C.screenRes,b[5]=C.getUserConsentDetails(),b[4]=!1,b),p)},a.applyOsContext=function(y){var b,C=a.os;ui(5,y,Ade,(b={},b[0]=C.name,b[1]=C.ver,b),p)},a.applySdkContext=function(y){var b;ui(6,y,kde,(b={},b[2]=o.installId,b[1]=o.getSequenceId(),b[3]=o.epoch,b),p)},a.applyIntWebContext=function(y){var b;ui(7,y,xde,(b={},b[0]=s.getMsfpc(),b[1]=s.getAnid(),b[2]=s.serviceName,b),p)},a.applyUtcContext=function(y){var b,C=(b={},b[0]=c.popSample,b);c.eventFlags>0&&(C[1]=c.eventFlags),ui(8,y,_de,C,p)},a.applyLocContext=function(y){var b;ui(9,y,Mde,(b={},b[0]=a.loc.tz,b),p)},a.applySessionContext=function(y){var b;ui(4,y,Rde,(b={},b[0]=g(),b),p)},a.applyDeviceContext=function(y){var b,C=a.device;ui(1,y,Pde,(b={},b[0]=C.localId,b[2]=C.make,b[3]=C.model,b[1]=C.deviceClass,b),p)},a.applyCloudContext=function(y){var b,C=a.cloud;ui(10,y,Nde,(b={},b[0]=C.role,b[1]=C.roleInstance,b[2]=C.roleVer,b),p)},a.applyAITraceContext=function(y){var b;if(t.enableApplicationInsightsTrace){var C=v();C&&ui(2,y,Ode,(b={},b[0]=C.getTraceId(),b[1]=C.getName(),b[2]=C.getSpanId(),b),!1)}},a.applyDistributedTraceContext=function(y){var b,C=v();if(C){var S=(b={},b[0]=C.getTraceId(),b[1]=C.getSpanId(),b),E=C.getTraceFlags();Xt(E)||(S[2]=E),ui(11,y,Lde,S,!1)}};function v(){var y=f;return r&&r.getTraceCtx&&(y=r.getTraceCtx(!1)||f),y}})}return n.__ieDyn=1,n}();function whe(n,e){var t=n||{};return{getName:function(){return t.name},setName:function(r){e&&e.setName(r),t.name=r},getTraceId:function(){return t.traceId},setTraceId:function(r){e&&e.setTraceId(r),z7(r)&&(t.traceId=r)},getSpanId:function(){return t.parentId},setSpanId:function(r){e&&e.setSpanId(r),V7(r)&&(t.parentId=r)},getTraceFlags:function(){return t.traceFlags},setTraceFlags:function(r){e&&e.setTraceFlags(r),t.traceFlags=r}}}var vg,Ehe=[hi[4],hi[0],hi[3],hi[5],hi[6],hi[7],hi[8],hi[9],hi[1],hi[2],hi[11],hi[10]],The=ph({populateBrowserInfo:!1,populateOperatingSystemInfo:!1,userAgent:pc(),userAgentData:hE({brands:vg,mobile:vg,platform:vg}),userConsentCookieName:pc(),userConsented:!1,serviceName:pc(),env:pc(),expId:pc(),sessionRenewalMs:18e5,sessionExpirationMs:864e5,sessionAsGuid:null,cookieDomain:pc(),namePrefix:pc(),enableApplicationInsightsTrace:!1,enableApplicationInsightsUser:!1,hashIdentifiers:!1,dropIdentifiers:!1,scrubIpOnly:!1,callback:hE({userConsentDetails:null}),gpcDataSharingOptIn:vg,idLength:22,enableDistributedTracing:!1,eventContainExtFields:!1}),Ihe=function(n){fm(e,n);function e(){var t=n.call(this)||this;t.identifier="SystemPropertiesCollector",t.priority=3,t.version="4.3.3";var r,i,a;return mn(e,t,function(o,s){c(),o.initialize=function(f,p,g){s.initialize(f,p,g),u(f)},o.processTelemetry=function(f,p){yE(f,o.identifier),p=o._getTelCtx(p);var g=f.ext=f.ext?f.ext:{};f.data=f.data?f.data:{},it(Ehe,function(v){g[v]=g[v]||{}}),r&&(r.applyUtcContext(f),r.applyApplicationContext(f),r.applyUserContext(f),r.applyWebContext(f),r.applyOsContext(f),r.applySdkContext(f),r.applyIntWebContext(f),r.applyLocContext(f),r.applySessionContext(f),r.applyDeviceContext(f),a.enableApplicationInsightsTrace&&r.applyAITraceContext(f),a.enableDistributedTracing&&r.applyDistributedTraceContext(f),r.applyCloudContext(f)),it(Lo(g),function(v){Lo(g[v]).length===0&&delete g[v]}),h(i,f.data),o.processNext(f,p)},o.getPropertiesContext=function(){return r},o.setProperty=function(f,p){i[f]=p},o._doTeardown=function(f,p){var g=(f||{}).core();if(g&&g.getTraceCtx&&r){var v=g.getTraceCtx(!1);v&&v===r.getTraceCtx()&&g.setTraceCtx(null)}c()},o._getDbgPlgTargets=function(){return[a]};function c(){r=null,i={}}function u(f){var p=o.identifier,g=o.core;o._addHook(Mr(f,function(){var v=Sl(null,f,g);a=v.getExtCfg(p,The)})),r=new She(f,a,g,o._unloadHooks),g&&g.setTraceCtx&&g.setTraceCtx(r.getTraceCtx())}function h(f,p){f&&an(f,function(g,v){p[g]||(p[g]=v)})}}),t}return e.__ieDyn=1,e}(Ck),bg="REAL_TIME",Ahe="NEAR_REAL_TIME",khe="BEST_EFFORT",Ts="",wE="drop",xhe="send",Q2="requeue",_he="rspFail",Mhe="oth",J2="no-cache, no-store",EE="application/x-json-stream",yg="cache-control",Mf="content-type",Rhe="kill-tokens",Phe="kill-duration",Nhe="time-delta-millis",TE="client-version",b8="client-id",IE="time-delta-to-apply-millis",AE="upload-time",kE="apikey",xE="AuthMsaDeviceTicket",Z2="WebAuthToken",X2="AuthXToken",Ohe="NoResponseBody",Ub="msfpc",eP="trace",V0="user",_E="allowRequestSending",y8="firstRequestSent",C8="shouldAddClockSkewHeaders",S8="getClockSkewHeaderValue",ME="setClockSkew",It="length",Xc="concat",Ka="iKey",qn="count",Hc="events",Ur="push",yd="split",hC="splice",RE="toLowerCase",Vu="hdrs",PE="useHdrs",Xf="initialize",w8="setTimeoutOverride",E8="clearTimeoutOverride",Lhe="payloadPreprocessor",tP="overrideEndpointUrl",nP="avoidOptions",Dhe="disableEventTimings",jhe="stringifyObjects",G0="enableCompoundKey",rP="disableXhrSync",iP="disableFetchKeepAlive",Uhe="addNoResponse",Fhe="excludeCsMetaData",aP="useSendBeacon",oP="fetchCredentials",sP="alwaysUseXhrOverride",Bhe="unloadTransports",T8="serializeOfflineEvt",I8="getOfflineRequestDetails",K0="createPayload",NE="createOneDSPayload",cP="payloadBlob",Ma="headers",rf="_thePayload",lP="urlString",Zr="batches",di="sendType",OE="addHeader",LE="canSendRequest",Fb="sendQueuedRequests",A8="isCompletelyIdle",DE="setUnloading",Hhe="isTenantKilled",av="resume",k8="sendSynchronousBatch",q0="_transport",Bb="getWParam",uP="isBeacon",Cg="timings",W0="isTeardown",Y0="isSync",ov="data",$he="timeout",Q0="_sendReason",x8="setKillSwitchTenants",_8="_backOffTransmission",Sg="identifier",zhe="disableOptimizeObj",Vhe="ignoreMc1Ms0CookieProcessing",dP="eventsLimitInMem",hP="autoFlushEventsLimit",Ghe="disableAutoBatchFlushLimit",Khe="overrideInstrumentationKey",qhe="disableTelemetry",J0="baseData",wg="sendAttempt",gc="latency",Iu="sync";function M8(n){var e=(n.ext||{}).intweb;return e&&xs(e[Ub])?e[Ub]:null}function fP(n){for(var e=null,t=0;e===null&&t<n[It];t++)e=M8(n[t]);return e}var Dp=function(){function n(e,t){var r=t?[][Xc](t):[],i=this,a=fP(r);i[Ka]=function(){return e},i.Msfpc=function(){return a||Ts},i[qn]=function(){return r[It]},i[Hc]=function(){return r},i.addEvent=function(o){return o?(r[Ur](o),a||(a=M8(o)),!0):!1},i[yd]=function(o,s){var c;if(o<r[It]){var u=r[It]-o;Xt(s)||(u=s<u?s:u),c=r[hC](o,u),a=fP(r)}return new n(e,c)}}return n.create=function(e,t){return new n(e,t)},n}(),Whe=function(){function n(){var e=!0,t=!0,r=!0,i="use-collector-delta",a=!1;mn(n,this,function(o){o[_E]=function(){return e},o[y8]=function(){r&&(r=!1,a||(e=!1))},o[C8]=function(){return t},o[S8]=function(){return i},o[ME]=function(s){a||(s?(i=s,t=!0,a=!0):t=!1,e=!0)}})}return n.__ieDyn=1,n}(),Yhe=1e3,Qhe=function(){function n(){var e={};function t(r){var i=[];return r&&it(r,function(a){i[Ur](ei(a))}),i}mn(n,this,function(r){r[x8]=function(i,a){if(i&&a)try{var o=t(i[yd](","));if(a==="this-request-only")return o;for(var s=parseInt(a,10)*Yhe,c=0;c<o[It];++c)e[o[c]]=Ws()+s}catch{return[]}return[]},r[Hhe]=function(i){var a=e,o=ei(i);return a[o]!==void 0&&a[o]>Ws()?!0:(delete a[o],!1)}})}return n.__ieDyn=1,n}(),Jhe=.8,Zhe=1.2,pP=3e3,Xhe=6e5;function efe(n){return!(n>=300&&n<500&&n!=429||n==501||n==505)}function R8(n){var e=0,t=pP*Jhe,r=pP*Zhe,i=Math.floor(Math.random()*(r-t))+t;return e=Math.pow(2,n)*i,Math.min(e,Xhe)}var tfe=20,nfe=3984588,P8=65e3,N8=2e6,rfe=Math.min(N8,P8),mP="metadata",Eg="f",ife=/\./,afe=function(){function n(e,t,r,i,a,o){var s="data",c="baseData",u="ext",h=!!i,f=!0,p=t,g={},v=!!o,y=a||o8;mn(n,this,function(b){b.createPayload=function(E,T,A,I,k,x){return{apiKeys:[],payloadBlob:Ts,overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:E,isTeardown:T,isSync:A,isBeacon:I,sendType:x,sendReason:k}},b.appendPayload=function(E,T,A){var I=E&&T&&!E.overflow;return I&&Xr(e,function(){return"Serializer:appendPayload"},function(){for(var k=T.events(),x=E.payloadBlob,_=E.numEvents,R=!1,z=[],j=[],J=E.isBeacon,D=J?P8:nfe,F=J?rfe:N8,ie=0,U=0;ie<k.length;){var W=k[ie];if(W){if(_>=A){E.overflow=T.split(ie);break}var ue=b.getEventBlob(W);if(ue&&ue.length<=F){var te=ue.length,Z=x.length;if(Z+te>D){E.overflow=T.split(ie);break}x&&(x+=`
`),x+=ue,U++,U>tfe&&(Bu(x,0,1),U=0),R=!0,_++}else ue?z.push(W):j.push(W),k.splice(ie,1),ie--}ie++}if(z.length>0&&E.sizeExceed.push(Dp.create(T.iKey(),z)),j.length>0&&E.failedEvts.push(Dp.create(T.iKey(),j)),R){E.batches.push(T),E.payloadBlob=x,E.numEvents=_;var Q=T.iKey();zi(E.apiKeys,Q)===-1&&E.apiKeys.push(Q)}},function(){return{payload:E,theBatch:{iKey:T.iKey(),evts:T.events()},max:A}}),I},b.getEventBlob=function(E){try{return Xr(e,function(){return"Serializer.getEventBlob"},function(){var T={};T.name=E.name,T.time=E.time,T.ver=E.ver,T.iKey="o:"+ode(E.iKey);var A={},I;v||(I=function(R,z,j){ofe(y,A,R,z,j)});var k=E[u];k&&(T[u]=A,an(k,function(R,z){var j=A[R]={};S(z,j,"ext."+R,!0,null,null,!0)}));var x=T[s]={};x.baseType=E.baseType;var _=x[c]={};return S(E.baseData,_,c,!1,[c],I,f),S(E.data,x,s,!1,[],I,f),JSON.stringify(T)},function(){return{item:E}})}catch{return null}};function C(E,T){var A=g[E];return A===void 0&&(E.length>=7&&(A=zR(E,"ext.metadata")||zR(E,"ext.web")),g[E]=A),A}function S(E,T,A,I,k,x,_){an(E,function(R,z){var j=null;if(z||xs(z)){var J=A,D=R,F=k,ie=T;if(h&&!I&&ife.test(R)){var U=R.split("."),W=U.length;if(W>1){F&&(F=F.slice());for(var ue=0;ue<W-1;ue++){var te=U[ue];ie=ie[te]=ie[te]||{},J+="."+te,F&&F.push(te)}D=U[W-1]}}var Z=I&&C(J);if(!Z&&p&&p.handleField(J,D)?j=p.value(J,D,z,r):j=cde(D,z,r),j){var Q=j.value;if(ie[D]=Q,x&&x(F,D,j),typeof Q=="object"&&!Nt(Q)){var Ie=F;Ie&&(Ie=Ie.slice(),Ie.push(D)),S(z,Q,J+"."+D,I,Ie,x)}}}})}})}return n.__ieDyn=1,n}();function ofe(n,e,t,r,i){if(i&&e){var a=n(i.value,i.kind,i.propertyType);if(a>-1){var o=e[mP];o||(o=e[mP]={f:{}});var s=o[Eg];if(s||(s=o[Eg]={}),t)for(var c=0;c<t.length;c++){var u=t[c];s[u]||(s[u]={f:{}});var h=s[u][Eg];h||(h=s[u][Eg]={}),s=h}s=s[r]={},Nt(i.value)?s.a={t:a}:s.t=a}}}function Hb(n,e){return{set:function(t,r){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];return zce([n,e],t,r,i)}}}var vc,Z0="sendAttempt",sfe="&"+Ohe+"=true",cfe="?cors=true&"+Mf[RE]()+"="+EE,lfe=(vc={},vc[1]=Q2,vc[100]=Q2,vc[200]="sent",vc[8004]=wE,vc[8003]=wE,vc),jE={},UE={};function Ql(n,e,t){jE[n]=e,t!==!1&&(UE[e]=n)}Ql(xE,xE,!1);Ql(TE,TE);Ql(b8,"Client-Id");Ql(kE,kE);Ql(IE,IE);Ql(AE,AE);Ql(X2,X2);function Tg(n,e){var t=!1;if(n&&e){var r=Lo(n);if(r&&r[It]>0)for(var i=e[RE](),a=0;a<r[It];a++){var o=r[a];if(o&&$i(e,o)&&o[RE]()===i){t=!0;break}}}return t}function Au(n,e,t,r){e&&t&&t[It]>0&&(r&&jE[e]?(n[Vu][jE[e]]=t,n[PE]=!0):n.url+="&"+e+"="+t)}function ufe(n,e,t){for(var r=0;r<n[It];r++)if(n[r].name===e){n[r].value=t;return}n[Ur]({name:e,value:t})}function dfe(n,e){for(var t=0;t<n[It];t++)if(n[t].name===e){n[hC](t,1);return}}var hfe=function(){function n(e,t,r,i){var a,o,s,c,u=!1,h,f,p,g,v,y,b,C,S,E,T,A,I,k,x,_,R,z,j,J,D,F,ie,U,W,ue,te,Z;mn(n,this,function(Q){De();var Ie=!0;Q[Xf]=function(V,we,Re){U||(v=we,A=we.getCookieMgr(),f=Re,p=f.diagLog(),Ns(J,Mr(V,function(Ue){var Xe,mt=Ue.cfg,qe=Ue.cfg.extensionConfig[Re.identifier];W=Hb(qe[w8],qe[E8]),xs(mt.anonCookieName)?ufe(b,"anoncknm",mt.anonCookieName):dfe(b,"anoncknm"),D=qe[Lhe],F=qe.payloadListener;var K=qe.httpXHROverride,oe=qe[tP]?qe[tP]:mt.endpointUrl;a=oe+cfe,k=Zt(qe[nP])?!0:!qe[nP],T=!qe[Dhe];var ge=qe.valueSanitizer,Le=qe[jhe],Ge=!!mt[G0];Zt(qe[G0])||(Ge=!!qe[G0]),x=qe.xhrTimeout,_=!!qe[rP],R=!!qe[iP],j=qe[Uhe]!==!1,ue=!!qe[Fhe],we.getPlugin("LocalStorage")&&(R=!0),u=!lE(),E=new afe(v,ge,Le,Ge,o8,ue),Xt(qe[aP])||(u=!!qe[aP]),qe[oP]&&(Z=qe[oP]);var ot=ce();te?te.SetConfig(ot):(te=new zue,te[Xf](ot,p));var gt=K,ut=qe[sP]?K:null,ft=qe[sP]?K:null,tr=[3,2];if(!K){y=!1;var Vn=[];lE()?(Vn=[2,1],tr=[2,1,3]):Vn=[1,2,3],Vn=u2(Vn,qe.transports),K=Ve(Vn,!1),K||Yf(p,"No available transport to send events"),gt=Ve(Vn,!0)}ut||(tr=u2(tr,qe[Bhe]),ut=Ve(tr,!0)),z=!y&&(u&&C7()||!R&&S7(!0)),g=(Xe={},Xe[0]=K,Xe[1]=gt||Ve([1,2,3],!0),Xe[2]=ut||gt||Ve([1],!0),Xe[3]=ft||Ve([2,3],!0)||gt||Ve([1],!0),Xe)})),U=!0)},Q.addResponseHandler=function(V){return ie[Ur](V),{rm:function(){var we=ie.indexOf(V);we>=0&&ie[hC](we,1)}}},Q[T8]=function(V){try{if(E)return E.getEventBlob(V)}catch{}return Ts},Q[I8]=function(){try{var V=E&&E[K0](0,!1,!1,!1,1,0);return q(V,k)}catch{}return null},Q[NE]=function(V,we){try{var Re=[];it(V,function(K){we&&(K=zu(K));var oe=Dp.create(K[Ka],[K]);Re[Ur](oe)});for(var Ue=null;Re[It]>0&&E;){var Xe=Re.shift();Xe&&Xe[qn]()>0&&(Ue=Ue||E[K0](0,!1,!1,!1,1,0),E.appendPayload(Ue,Xe,e))}var mt=q(Ue,k),qe={data:Ue[cP],urlString:mt.url,headers:mt[Vu],timeout:x,disableXhrSync:_,disableFetchKeepAlive:R};return k&&(Tg(qe[Ma],yg)||(qe[Ma][yg]=J2),Tg(qe[Ma],Mf)||(qe[Ma][Mf]=EE)),qe}catch{}return null};function Ve(V,we){try{return te&&te.getSenderInst(V,we)}catch{}return null}Q._getDbgPlgTargets=function(){return[g[0],o,E,g,ce(),a]};function ce(){try{var V={xdrOnComplete:le,fetchOnComplete:We,xhrOnComplete:be,beaconOnRetry:xe},we={enableSendPromise:!1,isOneDs:!0,disableCredentials:!Ie,fetchCredentials:Z,disableXhr:!1,disableBeacon:!u,disableBeaconSync:!u,disableFetchKeepAlive:R,timeWrapper:W,addNoResponse:j,senderOnCompleteCallBack:V};return we}catch{}return null}function le(V,we,Re){var Ue=Qd(V);Me(we,200,{},Ue),on(Ue)}function De(){var V;a=null,o=new Qhe,s=!1,c=new Whe,u=!1,h=0,f=null,p=null,g=null,v=null,y=!0,b=[],C={},S=[],E=null,T=!1,A=null,I=!1,k=!1,x=V,_=V,R=V,z=V,j=V,J=[],D=V,F=V,ie=[],U=!1,W=Hb(),ue=!1,te=null}function We(V,we,Re,Ue){var Xe=function(K,oe,ge){Me(we,K,oe,ge),on(ge)},mt={},qe=V[Ma];qe&&qe.forEach(function(K,oe){mt[oe]=K}),Xe(V.status,mt,Re||Ts)}function be(V,we,Re){var Ue=Qd(V);Me(we,V.status,ev(V,!0),Ue),on(Ue)}function Me(V,we,Re,Ue){try{V(we,Re,Ue)}catch(Xe){nn(p,2,518,Ft(Xe))}}function xe(V,we,Re){var Ue=V,Xe=200,mt=Ue[rf],qe=V[lP]+(j?sfe:Ts);try{var K=mo();if(mt){var oe=!!v.getPlugin("LocalStorage"),ge=[],Le=[];it(mt[Zr],function(Ge){if(ge&&Ge&&Ge[qn]()>0)for(var ot=Ge[Hc](),gt=0;gt<ot[It];gt++)if(K.sendBeacon(qe,E.getEventBlob(ot[gt])))Le[Ur](Ge[gt]);else{ge[Ur](Ge[yd](gt));break}else ge[Ur](Ge[yd](0))}),Le[It]>0&&(mt.sentEvts=Le),oe||In(ge,8003,mt[di],!0)}else Xe=0}catch(Ge){Yf(p,"Failed to send telemetry using sendBeacon API. Ex:"+Ft(Ge)),Xe=0}finally{Me(we,Xe,{},Ts)}}function M(V){return V===2||V===3}function Y(V){return I&&M(V)&&(V=2),V}Q[OE]=function(V,we){C[V]=we},Q.removeHeader=function(V){delete C[V]},Q[LE]=function(){return Se()&&c[_E]()},Q[Fb]=function(V,we){Zt(V)&&(V=0),I&&(V=Y(V),we=2),ne(S,V,0)&&ae(P(),0,!1,V,we||0)},Q[A8]=function(){return!s&&h===0&&S[It]===0},Q[DE]=function(V){I=V},Q.addBatch=function(V){if(V&&V[qn]()>0){if(o.isTenantKilled(V[Ka]()))return!1;S[Ur](V)}return!0},Q.teardown=function(){S[It]>0&&ae(P(),0,!0,2,2),it(J,function(V){V&&V.rm&&V.rm()}),J=[]},Q.pause=function(){s=!0},Q[av]=function(){s=!1,Q[Fb](0,4)},Q[k8]=function(V,we,Re){V&&V[qn]()>0&&(Xt(we)&&(we=1),I&&(we=Y(we),Re=2),ae([V],0,!1,we,Re||0))};function Se(){return!s&&h<t}function P(){var V=S;return S=[],V}function ne(V,we,Re){var Ue=!1;return V&&V[It]>0&&!s&&g[we]&&E&&(Ue=we!==0||Se()&&(Re>0||c[_E]())),Ue}function ye(V){var we={};return V&&it(V,function(Re,Ue){we[Ue]={iKey:Re[Ka](),evts:Re[Hc]()}}),we}function ae(V,we,Re,Ue,Xe){if(!(!V||V[It]===0)){if(s){In(V,1,Ue);return}Ue=Y(Ue);try{var mt=V,qe=Ue!==0;Xr(v,function(){return"HttpManager:_sendBatches"},function(K){K&&(V=V.slice(0));for(var oe=[],ge=null,Le=Da(),Ge=g[Ue]||(qe?g[1]:g[0]),ot=Ge&&Ge[q0],gt=z&&(I||M(Ue)||ot===3||Ge._isSync&&ot===2);ne(V,Ue,we);){var ut=V.shift();ut&&ut[qn]()>0&&(o.isTenantKilled(ut[Ka]())?oe[Ur](ut):(ge=ge||E[K0](we,Re,qe,gt,Xe,Ue),E.appendPayload(ge,ut,e)?ge.overflow!==null&&(V=[ge.overflow][Xc](V),ge.overflow=null,ze(ge,Le,Da(),Xe),Le=Da(),ge=null):(ze(ge,Le,Da(),Xe),Le=Da(),V=[ut][Xc](V),ge=null)))}ge&&ze(ge,Le,Da(),Xe),V[It]>0&&(S=V[Xc](S)),In(oe,8004,Ue)},function(){return{batches:ye(mt),retryCount:we,isTeardown:Re,isSynchronous:qe,sendReason:Xe,useSendBeacon:M(Ue),sendType:Ue}},!qe)}catch(K){nn(p,2,48,"Unexpected Exception sending batch: "+Ft(K))}}}function q(V,we){var Re={url:a,hdrs:{},useHdrs:!1};we?(Re[Vu]=Db(Re[Vu],C),Re.useHdrs=Lo(Re.hdrs)[It]>0):an(C,function(K,oe){UE[K]?Au(Re,UE[K],oe,!1):(Re[Vu][K]=oe,Re[PE]=!0)}),Au(Re,b8,"NO_AUTH",we),Au(Re,TE,i8,we);var Ue=Ts;it(V.apiKeys,function(K){Ue[It]>0&&(Ue+=","),Ue+=K}),Au(Re,kE,Ue,we),Au(Re,AE,Ws().toString(),we);var Xe=Yt(V);if(xs(Xe)&&(Re.url+="&ext.intweb.msfpc="+Xe),c[C8]()&&Au(Re,IE,c[S8](),we),v[Bb]){var mt=v[Bb]();mt>=0&&(Re.url+="&w="+mt)}for(var qe=0;qe<b[It];qe++)Re.url+="&"+b[qe].name+"="+b[qe].value;return Re}function Te(V,we,Re){V[we]=V[we]||{},V[we][f.identifier]=Re}function ze(V,we,Re,Ue){if(V&&V.payloadBlob&&V.payloadBlob[It]>0){var Xe=!!D,mt=g[V.sendType];!M(V[di])&&V[uP]&&V.sendReason===2&&(mt=g[2]||g[3]||mt);var qe=k;(V.isBeacon||mt[q0]===3)&&(qe=!1);var K=q(V,qe);qe=qe||K[PE];var oe=Da();Xr(v,function(){return"HttpManager:_doPayloadSend"},function(){for(var ge=0;ge<V.batches[It];ge++)for(var Le=V[Zr][ge],Ge=Le[Hc](),ot=0;ot<Ge[It];ot++){var gt=Ge[ot];if(T){var ut=gt[Cg]=gt[Cg]||{};Te(ut,"sendEventStart",oe),Te(ut,"serializationStart",we),Te(ut,"serializationCompleted",Re)}gt[Z0]>0?gt[Z0]++:gt[Z0]=1}In(V[Zr],1e3+(Ue||0),V[di],!0);var ft={data:V[cP],urlString:K.url,headers:K[Vu],_thePayload:V,_sendReason:Ue,timeout:x,disableXhrSync:_,disableFetchKeepAlive:R};qe&&(Tg(ft[Ma],yg)||(ft[Ma][yg]=J2),Tg(ft[Ma],Mf)||(ft[Ma][Mf]=EE));var tr=null;mt&&(tr=function(Vn){c[y8]();var Rr=function(Ji,ka){vt(Ji,ka,V,Ue)},An=V[W0]||V[Y0];try{mt.sendPOST(Vn,Rr,An),F&&F(ft,Vn,An,V[uP])}catch(Ji){Yf(p,"Unexpected exception sending payload. Ex:"+Ft(Ji)),Me(Rr,0,{})}}),Xr(v,function(){return"HttpManager:_doPayloadSend.sender"},function(){if(tr)if(V[di]===0&&h++,Xe&&!V.isBeacon&&mt[q0]!==3){var Vn={data:ft[ov],urlString:ft[lP],headers:Db({},ft[Ma]),timeout:ft[$he],disableXhrSync:ft[rP],disableFetchKeepAlive:ft[iP]},Rr=!1;Xr(v,function(){return"HttpManager:_doPayloadSend.sendHook"},function(){try{D(Vn,function(An){Rr=!0,!y&&!An[rf]&&(An[rf]=An[rf]||ft[rf],An[Q0]=An[Q0]||ft[Q0]),tr(An)},V.isSync||V[W0])}catch{Rr||tr(ft)}})}else tr(ft)})},function(){return{thePayload:V,serializationStart:we,serializationCompleted:Re,sendReason:Ue}},V[Y0])}V.sizeExceed&&V.sizeExceed[It]>0&&In(V.sizeExceed,8003,V[di]),V.failedEvts&&V.failedEvts[It]>0&&In(V.failedEvts,8002,V[di])}function ht(V,we){T&&it(V,function(Re){var Ue=Re[Cg]=Re[Cg]||{};Te(Ue,"sendEventCompleted",we)})}function vt(V,we,Re,Ue){var Xe=9e3,mt=null,qe=!1,K=!1;try{var oe=!0;if(typeof V!==GA){if(we){c[ME](we[Nhe]);var ge=we[Phe]||we["kill-duration-seconds"];it(o[x8](we[Rhe],ge),function(Ge){it(Re[Zr],function(ot){if(ot[Ka]()===Ge){mt=mt||[];var gt=ot[yd](0);Re.numEvents-=gt[qn](),mt[Ur](gt)}})})}if(V==200||V==204){Xe=200;return}(!efe(V)||Re.numEvents<=0)&&(oe=!1),Xe=9e3+V%1e3}if(oe){Xe=100;var Le=Re.retryCnt;Re[di]===0&&(Le<r?(qe=!0,Ot(function(){Re[di]===0&&h--,ae(Re[Zr],Le+1,Re[W0],I?2:Re[di],5)},I,R8(Le))):(K=!0,I&&(Xe=8001)))}}finally{qe||(c[ME](),Ye(Re,Xe,Ue,K)),In(mt,8004,Re[di])}}function Ye(V,we,Re,Ue){try{Ue&&f[_8]();var Xe=V[Zr];we===200&&(Xe=V.sentEvts||V[Zr],!Ue&&!V[Y0]&&f._clearBackOff(),st(Xe)),In(Xe,we,V[di],!0)}finally{V[di]===0&&(h--,Re!==5&&Q.sendQueuedRequests(V[di],Re))}}function st(V){if(T){var we=Da();it(V,function(Re){Re&&Re[qn]()>0&&ht(Re[Hc](),we)})}}function Ot(V,we,Re){we?V():W.set(V,Re)}function Yt(V){for(var we=0;we<V.batches[It];we++){var Re=V[Zr][we].Msfpc();if(Re)return encodeURIComponent(Re)}return Ts}function on(V){var we=ie;try{for(var Re=0;Re<we[It];Re++)try{we[Re](V)}catch(Xe){nn(p,1,519,"Response handler failed: "+Xe)}if(V){var Ue=JSON.parse(V);xs(Ue.webResult)&&xs(Ue.webResult[Ub])&&A.set("MSFPC",Ue.webResult[Ub],365*86400)}}catch{}}function In(V,we,Re,Ue){if(V&&V[It]>0&&i){var Xe=i[zn(we)];if(Xe){var mt=Re!==0;Xr(v,function(){return"HttpManager:_sendBatchesNotification"},function(){Ot(function(){try{Xe.call(i,V,we,mt,Re)}catch(qe){nn(p,1,74,"send request notification failed: "+qe)}},Ue||mt,0)},function(){return{batches:ye(V),reason:we,isSync:mt,sendSync:Ue,sendType:Re}},!mt)}}}function zn(V){var we=lfe[V];return xs(we)||(we=Mhe,V>=9e3&&V<=9999?we=_he:V>=8e3&&V<=8999?we=wE:V>=1e3&&V<=1999&&(we=xhe)),we}})}return n.__ieDyn=1,n}(),ffe=.25,gP=500,pfe=20,O8=6,L8=2,mfe=4,vP=2,gfe=1,FE=1e4,bc="eventsDiscarded",bP="",Bn=void 0,vfe=ph({eventsLimitInMem:{isVal:Jf,v:FE},immediateEventLimit:{isVal:Jf,v:500},autoFlushEventsLimit:{isVal:Jf,v:0},disableAutoBatchFlushLimit:!1,httpXHROverride:{isVal:bfe,v:Bn},overrideInstrumentationKey:Bn,overrideEndpointUrl:Bn,disableTelemetry:!1,ignoreMc1Ms0CookieProcessing:!1,setTimeoutOverride:Bn,clearTimeoutOverride:Bn,payloadPreprocessor:Bn,payloadListener:Bn,disableEventTimings:Bn,valueSanitizer:Bn,stringifyObjects:Bn,enableCompoundKey:Bn,disableOptimizeObj:!1,fetchCredentials:Bn,transports:Bn,unloadTransports:Bn,useSendBeacon:Bn,disableFetchKeepAlive:Bn,avoidOptions:!1,xhrTimeout:Bn,disableXhrSync:Bn,alwaysUseXhrOverride:!1,maxEventRetryAttempts:{isVal:Ks,v:O8},maxUnloadEventRetryAttempts:{isVal:Ks,v:L8},addNoResponse:Bn,excludeCsMetaData:Bn});function bfe(n){return n&&n.sendPOST}var yfe=function(n){fm(e,n);function e(){var t=n.call(this)||this;t.identifier="PostChannel",t.priority=1011,t.version="4.3.3";var r,i=!1,a=[],o,s=!1,c=0,u,h=0,f,p={},g=bg,v,y,b,C,S,E,T,A,I,k,x,_,R,z,j,J,D,F,ie,U,W,ue;return mn(e,t,function(te,Z){Y(),te._getDbgPlgTargets=function(){return[S,r]},te[Xf]=function(K,oe,ge){Xr(oe,function(){return"PostChannel:initialize"},function(){Z[Xf](K,oe,ge),ie=oe.getNotifyMgr();try{j=vm(vh(te[Sg]),oe.evtNamespace&&oe.evtNamespace()),te._addHook(Mr(K,function(Le){var Ge=Le.cfg,ot=Sl(null,Ge,oe);r=ot.getExtCfg(te[Sg],vfe),J=Hb(r[w8],r[E8]),x=!r[zhe]&&fde(),D=r[Vhe],Ie(oe),f=r[dP],u=r.immediateEventLimit,T=r[hP],R=r.maxEventRetryAttempts,z=r.maxUnloadEventRetryAttempts,F=r[Ghe],Kd(Ge.endpointUrl)?te.pause():s&&te[av](),qe(),W=r[Khe],ue=!!r[qhe],U&&Q();var gt=Ge.disablePageUnloadEvents||[];U=Xue(le,gt,j),U=n8(le,gt,j)||U,U=r8(De,Ge.disablePageShowEvents,j)||U})),S[Xf](K,te.core,te)}catch(Le){throw te.setInitialized(!1),Le}},function(){return{theConfig:K,core:oe,extensions:ge}})},te.processTelemetry=function(K,oe){yE(K,te[Sg]),oe=oe||te._getTelCtx(oe);var ge=K;!ue&&!i&&(W&&(ge[Ka]=W),be(ge,!0),_?ne(2,2):M()),te.processNext(ge,oe)},te.getOfflineSupport=function(){try{var K=S&&S[I8]();if(S)return{getUrl:function(){return K?K.url:null},serialize:ce,batch:Ve,shouldProcess:function(oe){return!ue},createPayload:function(oe){return null},createOneDSPayload:function(oe){if(S[NE])return S[NE](oe,x)}}}catch{}return null},te._doTeardown=function(K,oe){ne(2,2),i=!0,S.teardown(),Q(),Y()};function Q(){ede(null,j),tde(null,j),nde(null,j)}function Ie(K){var oe=K[Bb];K[Bb]=function(){var ge=0;return D&&(ge=ge|2),ge|oe.call(K)}}function Ve(K){var oe=bP;return K&&K[It]&&it(K,function(ge){oe&&(oe+=`
`),oe+=ge}),oe}function ce(K){var oe=bP;try{We(K),oe=S[T8](K)}catch{}return oe}function le(K){var oe=K||ic().event;oe.type!=="beforeunload"&&(_=!0,S[DE](_)),ne(2,2)}function De(K){_=!1,S[DE](_)}function We(K){K.ext&&K.ext[eP]&&delete K.ext[eP],K.ext&&K.ext[V0]&&K.ext[V0].id&&delete K.ext[V0].id,x&&(K.ext=zu(K.ext),K[J0]&&(K[J0]=zu(K[J0])),K[ov]&&(K[ov]=zu(K[ov])))}function be(K,oe){if(K[wg]||(K[wg]=0),K[gc]||(K[gc]=1),We(K),K[Iu]){if(b||s)K[gc]=3,K[Iu]=!1;else if(S){x&&(K=zu(K)),S[k8](Dp.create(K[Ka],[K]),K[Iu]===!0?1:K[Iu],3);return}}var ge=K[gc],Le=h,Ge=f;ge===4&&(Le=c,Ge=u);var ot=!1;if(Le<Ge)ot=!Te(K,oe);else{var gt=1,ut=pfe;ge===4&&(gt=4,ut=1),ot=!0,ze(K[Ka],K[gc],gt,ut)&&(ot=!Te(K,oe))}ot&&zn(bc,[K],fc.QueueFull)}te.setEventQueueLimits=function(K,oe){r[dP]=f=Jf(K)?K:FE,r[hP]=T=Jf(oe)?oe:0,qe();var ge=h>K;if(!ge&&A>0)for(var Le=1;!ge&&Le<=3;Le++){var Ge=E[Le];Ge&&Ge[Zr]&&it(Ge[Zr],function(ot){ot&&ot[qn]()>=A&&(ge=!0)})}q(!0,ge)},te.pause=function(){P(),s=!0,S&&S.pause()},te[av]=function(){s=!1,S&&S[av](),M()},te._loadTransmitProfiles=function(K){Ot(),an(K,function(oe,ge){var Le=ge[It];if(Le>=2){var Ge=Le>2?ge[2]:0;if(ge[hC](0,Le-2),ge[1]<0&&(ge[0]=-1),ge[1]>0&&ge[0]>0){var ot=ge[0]/ge[1];ge[0]=Math.ceil(ot)*ge[1]}Ge>=0&&ge[1]>=0&&Ge>ge[1]&&(Ge=ge[1]),ge[Ur](Ge),p[oe]=ge}})},te.flush=function(K,oe,ge){K===void 0&&(K=!0);var Le;if(!s)if(ge=ge||1,K)oe||(Le=Cl(function(ot){oe=ot})),o==null?(P(),vt(1,0,ge),o=Se(function(){o=null,Ye(oe,ge)},0)):a[Ur](oe);else{var Ge=P();Me(1,1,ge),oe&&oe(),Ge&&M()}return Le},te.setMsaAuthTicket=function(K){S[OE](xE,K)},te.setAuthPluginHeader=function(K){S[OE](Z2,K)},te.removeAuthPluginHeader=function(){S.removeHeader(Z2)},te.hasEvents=xe,te._setTransmitProfile=function(K){g!==K&&p[K]!==void 0&&(P(),g=K,M())},m7(te,function(){return S},["addResponseHandler"]);function Me(K,oe,ge){var Le=vt(K,oe,ge);return S[Fb](oe,ge),Le}function xe(){return h>0}function M(){if(I>=0&&vt(I,0,k)&&S[Fb](0,k),c>0&&!y&&!s){var K=p[g][2];K>=0&&(y=Se(function(){y=null,Me(4,0,1),M()},K))}var oe=p[g][1];!v&&!o&&oe>=0&&!s&&(xe()?v=Se(function(){v=null,Me(C===0?3:1,0,1),C++,C%=2,M()},oe):C=0)}te[_8]=function(){b<mfe&&(b++,P(),M())},te._clearBackOff=function(){b&&(b=0,P(),M())};function Y(){r=null,i=!1,a=[],o=null,s=!1,c=0,u=500,h=0,f=FE,p={},g=bg,v=null,y=null,b=0,C=0,E={},T=0,U=!1,A=0,I=-1,k=null,x=!0,_=!1,R=O8,z=L8,j=null,W=null,ue=!1,J=Hb(),S=new hfe(gP,vP,gfe,{requeue:on,send:we,sent:Re,drop:Ue,rspFail:Xe,oth:mt}),Yt(),ye(),qe()}function Se(K,oe){oe===0&&b&&(oe=1);var ge=1e3;return b&&(ge=R8(b-1)),J.set(K,oe*ge)}function P(){return v!==null?(v.cancel(),v=null,C=0,!0):!1}function ne(K,oe){P(),o&&(o.cancel(),o=null),s||Me(1,K,oe)}function ye(){E[4]={batches:[],iKeyMap:{}},E[3]={batches:[],iKeyMap:{}},E[2]={batches:[],iKeyMap:{}},E[1]={batches:[],iKeyMap:{}}}function ae(K,oe,ge){var Le=E[oe];Le||(oe=1,Le=E[oe]);var Ge=Le.iKeyMap[K];return!Ge&&ge&&(Ge=Dp.create(K),Le.batches[Ur](Ge),Le.iKeyMap[K]=Ge),Ge}function q(K,oe){S[LE]()&&!b&&(T>0&&h>T&&(oe=!0),oe&&o==null&&te.flush(K,function(){},20))}function Te(K,oe){x&&(K=zu(K));var ge=K[gc],Le=ae(K[Ka],ge,!0);return Le.addEvent(K)?(ge!==4?(h++,oe&&K[wg]===0&&q(!K.sync,A>0&&Le[qn]()>=A)):c++,!0):!1}function ze(K,oe,ge,Le){for(;ge<=oe;){var Ge=ae(K,oe,!0);if(Ge&&Ge[qn]()>0){var ot=Ge[yd](0,Le),gt=ot[qn]();if(gt>0)return ge===4?c-=gt:h-=gt,V(bc,[ot],fc.QueueFull),!0}ge++}return ht(),!1}function ht(){for(var K=0,oe=0,ge=function(Ge){var ot=E[Ge];ot&&ot[Zr]&&it(ot[Zr],function(gt){Ge===4?K+=gt[qn]():oe+=gt[qn]()})},Le=1;Le<=4;Le++)ge(Le);h=oe,c=K}function vt(K,oe,ge){var Le=!1,Ge=oe===0;return!Ge||S[LE]()?Xr(te.core,function(){return"PostChannel._queueBatches"},function(){for(var ot=[],gt=4;gt>=K;){var ut=E[gt];ut&&ut.batches&&ut.batches[It]>0&&(it(ut[Zr],function(ft){S.addBatch(ft)?Le=Le||ft&&ft[qn]()>0:ot=ot[Xc](ft[Hc]()),gt===4?c-=ft[qn]():h-=ft[qn]()}),ut[Zr]=[],ut.iKeyMap={}),gt--}ot[It]>0&&zn(bc,ot,fc.KillSwitch),Le&&I>=K&&(I=-1,k=0)},function(){return{latency:K,sendType:oe,sendReason:ge}},!Ge):(I=I>=0?Math.min(I,K):K,k=Math.max(k,ge)),Le}function Ye(K,oe){Me(1,0,oe),ht(),st(function(){K&&K(),a[It]>0?o=Se(function(){o=null,Ye(a.shift(),oe)},0):(o=null,M())})}function st(K){S[A8]()?K():o=Se(function(){o=null,st(K)},ffe)}function Ot(){P(),Yt(),g=bg,M()}function Yt(){p={},p[bg]=[2,1,0],p[Ahe]=[6,3,0],p[khe]=[18,9,0]}function on(K,oe){var ge=[],Le=R;_&&(Le=z),it(K,function(Ge){Ge&&Ge[qn]()>0&&it(Ge[Hc](),function(ot){ot&&(ot[Iu]&&(ot[gc]=4,ot[Iu]=!1),ot[wg]<Le?(yE(ot,te[Sg]),be(ot,!1)):ge[Ur](ot))})}),ge[It]>0&&zn(bc,ge,fc.NonRetryableStatus),_&&ne(2,2)}function In(K,oe){var ge=ie||{},Le=ge[K];if(Le)try{Le.apply(ge,oe)}catch(Ge){nn(te.diagLog(),1,74,K+" notification failed: "+Ge)}}function zn(K,oe){for(var ge=[],Le=2;Le<arguments.length;Le++)ge[Le-2]=arguments[Le];oe&&oe[It]>0&&In(K,[oe][Xc](ge))}function V(K,oe){for(var ge=[],Le=2;Le<arguments.length;Le++)ge[Le-2]=arguments[Le];oe&&oe[It]>0&&it(oe,function(Ge){Ge&&Ge[qn]()>0&&In(K,[Ge.events()][Xc](ge))})}function we(K,oe,ge){K&&K[It]>0&&In("eventsSendRequest",[oe>=1e3&&oe<=1999?oe-1e3:0,ge!==!0])}function Re(K,oe){V("eventsSent",K,oe),M()}function Ue(K,oe){V(bc,K,oe>=8e3&&oe<=8999?oe-8e3:fc.Unknown)}function Xe(K){V(bc,K,fc.NonRetryableStatus),M()}function mt(K,oe){V(bc,K,fc.Unknown),M()}function qe(){F?A=0:A=Math.max(gP*(vP+1),f/6)}}),t}return e.__ieDyn=1,e}(Ck),Cfe=ph({cookieCfg:{ref:!0,v:{}},extensions:{rdOnly:!0,ref:!0,v:[]},channels:{rdOnly:!0,ref:!0,v:[]},extensionConfig:{ref:!0,v:{}}}),D8=function(n){fm(e,n);function e(){var t=n.call(this)||this,r,i;return mn(e,t,function(a,o){a.initialize=function(s,c){var u=t;Xr(t,function(){return"ApplicationInsights:initialize"},function(){s=Ii(s,Cfe,u.logger,!1).cfg,r=new yfe,i=new Ihe;var h=[i];c&&(h=h.concat(c)),s||Pi("You must provide a config object!");var f=s.channels;if(f&&f.length>0){for(var p=!1,g=0;g<f[0].length;g++)if(f[0][g].identifier===r.identifier){p=!0;break}p||Ns(f[0],r)}else s.channels.push([r]);var v=s.extensionConfig;v[r.identifier]=v[r.identifier]||s&&s.channelConfiguration||{},v[i.identifier]=v[i.identifier]||s&&s.propertyConfiguration||{};try{o.initialize(s,h),u.isInitialized()&&z6(s,{channelConfiguration:{g:function(){return s.extensionConfig[r.identifier]}},propertyConfiguration:{g:function(){return s.extensionConfig[i.identifier]}}})}catch(y){nn(u.logger,1,514,"Failed to initialize SDK."+Ft(y))}},function(){return{config:s,extensions:c}})},a.getPropertyManager=function(){return i},a.getPostChannel=function(){return r}}),t}return e.__ieDyn=1,e}(gde);/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */const j8="msal.request";function sv(n){var e;try{return new sb(((e=n.cache)==null?void 0:e.temporaryCacheLocation)||_n.SessionStorage)}catch{return new ob}}function BE(n){return`${j8}.${n}`}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */const Sfe="faab4ead691e451eb230afc98a28e0f2-698cf73d-7930-426b-87d8-d36936f6912f-7401",wfe="https://eu-mobile.events.data.microsoft.com/OneCollector/1.0/",yP=`${j8}.mats-telemetry-profile-id`;class Efe{constructor(e,t,r,i){this.logger=e,this.appName=r,this.appVersion=i,this.eventsToEmit=new Set(t),this.sessionId=Fi();const a={instrumentationKey:Sfe,endpointUrl:wfe,extensions:[],propertyConfiguration:{gpcDataSharingOptIn:!1},disableCookiesUsage:!0};this.appInsightsMATS=new D8,this.appInsightsMATS.initialize(a,[]),this.logger.verbose("MATSTelemetryReporter: Initialized");try{const o=new sb(_n.LocalStorage),s=o.getItem(yP);if(s!=null&&s.length)this.profileTelemetryId=s;else{const c=Fi();this.profileTelemetryId=c,o.setItem(yP,c)}}catch{e.warning("MATSTelemetryReporter: local storage is not available"),this.profileTelemetryId=""}}sendCustomEvent(e){if(!this.eventsToEmit.has(e.name)){this.logger.verbose(`MATSTelemetryReporter: Skipping telemetry for ${e.name}`,e.correlationId);return}const t={...e,appName:this.appName,appVersion:this.appVersion,libraryName:"MSAL-JS",profileTelemetryId:this.profileTelemetryId,sessionId:this.sessionId};delete t.context,delete t.errorStack;const r={name:"actionmsaljs".concat(e.name.toLowerCase()||""),data:t};this.logger.verbose(`MATSTelemetryReporter: Sending ${r.name} for tracking`),this.appInsightsMATS.track(r),e.name===At.AcquireTokenPreRedirect&&this.appInsightsMATS.flush()}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */const Tfe="d634483c08244c1ca09af2b2d952c92e-ab2bba03-2ba3-49d8-a82c-ef6da750d8ab-7725";function Ife(n){return Math.random()<=n}class Afe{constructor(e,t,r){this.synthetic=!1,this.redactionRatio=.1,this.logger=e,this.eventsToEmit=new Set(t);const i={instrumentationKey:Tfe,extensions:[],propertyConfiguration:{gpcDataSharingOptIn:!1},disableCookiesUsage:!0};this.appInsights=new D8,this.appInsights.initialize(i,[]),this.synthetic=r||!1,this.logger.verbose("PerformanceTelemetryReporter: Initialized")}sendCustomEvent(e){if(!this.eventsToEmit.has(e.name)){this.logger.verbose(`PerformanceTelemetryReporter: Skipping telemetry for ${e.name}`,e.correlationId);return}let t;!e.success||Ife(this.redactionRatio)?(t={...e,appName:void 0,synthetic:this.synthetic},this.logger.verbose(`PerformanceTelemetryReporter: Sending ${t.name} for tracking`)):(t={name:e.name,eventId:e.eventId,correlationId:e.correlationId,requestId:e.requestId,success:e.success,status:e.status,fromCache:e.fromCache,startPageVisibility:e.startPageVisibility,endPageVisibility:e.endPageVisibility,authority:e.authority,durationMs:e.durationMs,startTimeMs:e.startTimeMs,clientId:e.clientId,libraryName:e.libraryName,libraryVersion:e.libraryVersion,accountType:e.accountType,synthetic:this.synthetic,isBroker:e.isBroker,isBackground:e.isBackground},this.logger.verbose(`PerformanceTelemetryReporter: Sending redacted ${t.name} for tracking`));const r={name:e.name,data:t};this.appInsights.track(r),e.name===At.AcquireTokenPreRedirect&&this.appInsights.flush()}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */const Ig=new Set([At.AcquireTokenSilent,At.AcquireTokenByCode,At.AcquireTokenPopup,At.AcquireTokenRedirect,At.AcquireTokenPreRedirect,At.PairwiseBrokerApplicationInitializeBrokering,At.SsoSilent,At.EmbeddedClientApplicationSendSSOSilentRequest,At.EmbeddedClientApplicationSendPopupRequest,At.EmbeddedClientApplicationSendRedirectRequest,At.EmbeddedClientApplicationHandleRedirectRequest,At.EmbeddedClientApplicationSendSilentRefreshRequest]);class kfe{constructor(e,t){var i;this.logger=e;const r=((i=t==null?void 0:t.eventsToEmit)==null?void 0:i.filter(a=>Ig==null?void 0:Ig.has(a)))||[...Ig];this.matsTelemetryReporter=t!=null&&t.enableMATS?new Efe(e,r,t==null?void 0:t.appName,t==null?void 0:t.appVersion):null,this.perfTelemetryReporter=new Afe(e,r,t==null?void 0:t.synthetic)}sendCustomEvent(e){var t;this.perfTelemetryReporter.sendCustomEvent(e),(t=this.matsTelemetryReporter)==null||t.sendCustomEvent(e)}getTelemetryCallback(){this.logger.trace("TelemetryReporter: Attaching callback to send custom metrics.");const e=t=>{t.forEach(r=>{r.name===At.AcquireTokenByBroker&&(r.name=r.brokerEventName||r.name,r.isBroker=!0,delete r.brokerEventName,this.logger.verbosePii(`TelemetryReporter: Updated broker event ${JSON.stringify(r)}`,r.correlationId)),this.sendCustomEvent(r)})};return this.logger.verbose("TelemetryReporter: Returning callback as telemetry emitted."),e}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */const xfe=[Ip.AzurePublic,Ip.AzurePpe];function _fe(n){return n.auth.authority?xfe.some(e=>{var t;return((t=n.auth.authority)==null?void 0:t.indexOf(e.toString()))===0}):!0}class bm extends jse{constructor(e,t){var a;let r;const i=typeof window<"u";if(!(t!=null&&t.disabled)&&_fe(e)&&i?(r=((a=e.telemetry)==null?void 0:a.client)||new Fse(e,new Set(Hse),new Map(Bse)),super({...e,telemetry:{...e.telemetry,client:r}})):(super(e),r=new Gj),this.performanceClient=r,i){const o=new kfe(this.getLogger(),t);this.addPerformanceCallback(o.getTelemetryCallback())}}static async createPublicClientApplication(e,t,r){const i=new bm(e,t);return await i.initialize({correlationId:r}),i}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */const jt={BROKER_READY:"BrokerReady",HANDSHAKE_REQUEST:"BrokerHandshakeRequest",HANDSHAKE_RESPONSE:"BrokerHandshakeResponse",AUTH_REQUEST:"BrokerAuthRequest",REDIRECT_RESPONSE:"BrokerRedirectResponse",HANDLE_REDIRECT_REQUEST:"BrokerHandleRedirectRequest",AUTH_RESULT:"BrokerAuthResult",EMBEDDED_LOGOUT_REQUEST:"EmbeddedLogoutRequest",EMBEDDED_LOGOUT_RESPONSE:"EmbeddedLogoutResponse"},Io={BROKER_AUTH_ERROR_NAME:"BrokerAuthError",INTERACTION_REQ_ERROR_NAME:"InteractionRequiredAuthError",SERVER_ERROR_NAME:"ServerError",CLIENT_AUTH_ERR_NAME:"ClientAuthError",CLIENT_CONFIG_ERROR_NAME:"ClientConfigurationError",BROWSER_AUTH_ERROR_NAME:"BrowserAuthError",BROWSER_CONFIG_ERROR_NAME:"BrowserConfigurationError",AUTH_ERROR_NAME:"AuthError"},Mfe=2e3,Rfe=6e3,Pfe=3e5;/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */class Sa{constructor(e){this.messageType=e}static validateMessage(e){if(e.data&&e.data.messageType)switch(e.data.messageType){case jt.HANDSHAKE_REQUEST:case jt.HANDSHAKE_RESPONSE:case jt.HANDLE_REDIRECT_REQUEST:case jt.AUTH_REQUEST:case jt.AUTH_RESULT:case jt.REDIRECT_RESPONSE:case jt.EMBEDDED_LOGOUT_REQUEST:return e;default:return null}else return null}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */class fC extends Sa{constructor(e,t,r=!1,i){super(jt.HANDSHAKE_REQUEST),this.embeddedClientId=e,this.version=t,this.allowTelemetry=r,this.nonce=i}static validate(e){return e.data&&e.data.messageType===jt.HANDSHAKE_REQUEST&&e.data.embeddedClientId&&e.data.version?new fC(e.data.embeddedClientId,e.data.version,e.data.allowTelemetry,e.data.nonce):null}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */class pC extends Sa{constructor(e,t,r){super(jt.HANDSHAKE_RESPONSE),this.version=e,this.brokerOrigin=t,this.nonce=r}static validate(e,t){if(!t.includes(e.origin))return null;const r=Sa.validateMessage(e);return r&&r.data.messageType===jt.HANDSHAKE_RESPONSE&&r.data.version?new pC(r.data.version,r.origin,r.data.nonce):null}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */class mC extends Sa{get embeddedAppOrigin(){return this._embeddedAppOrigin}constructor(e,t,r,i){super(jt.AUTH_REQUEST),this.embeddedClientId=e,this._embeddedAppOrigin=i,this.interactionType=t,this.request=r}static validate(e,t){return e.data&&e.data.messageType===jt.AUTH_REQUEST&&e.data.embeddedClientId&&e.data.interactionType&&e.data.request?new mC(e.data.embeddedClientId,e.data.interactionType,e.data.request,t):null}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */class gC extends Sa{constructor(){super(jt.REDIRECT_RESPONSE)}static validate(e){return e.data&&e.data.messageType===jt.REDIRECT_RESPONSE?new gC:null}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */const rr={noEmbeddedAppError:{code:"no_embedded_app",desc:"The embedded application object was not created. Please ensure you have configured your application correctly for an embedded application: https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/broker-v2/lib/msal-browser/docs/broker.md#brokered-application-configuration"},brokerResponseInvalidError:{code:"broker_response_invalid",desc:"The broker response did not have the expected values."},brokeredPopupRequestRedirecting:{code:"broker_popup_will_redirect",desc:"The request for a brokered popup requires a redirect by the broker. If your app does not perform the redirect, please check the broker's logs."},brokerTimeoutError:{code:"broker_timeout",desc:"Message broker timed out."},brokerHandshakeTimeoutError:{code:"broker_handshake_timeout",desc:"Broker handshake response timed out."},brokerHandshakeFailed:{code:"broker_handshake_failed",desc:"Broker handshake failed. Please see logs for details."},noTrustedBrokersProvided:{code:"no_trusted_brokers_provided",desc:"No trusted brokers provided."},brokeringDisabledError:{code:"brokering_disabled",desc:"Brokering is not enabled for the client application. Please check logs to see if handshake was performed."},shrGenerationError:{code:"shr_generation_error",desc:"Error generating SHRs. Kid is missing in the request."}};class hn extends Mt{constructor(e,t){super(e,t),Object.setPrototypeOf(this,hn.prototype),this.name=Io.BROKER_AUTH_ERROR_NAME}static createNoEmbeddedAppError(){return new hn(rr.noEmbeddedAppError.code,rr.noEmbeddedAppError.desc)}static createBrokerResponseInvalidError(){return new hn(rr.brokerResponseInvalidError.code,`${rr.brokerResponseInvalidError.desc}`)}static createBrokerPopupRequestRedirectingError(){return new hn(rr.brokeredPopupRequestRedirecting.code,rr.brokeredPopupRequestRedirecting.desc)}static createNoTrustedBrokersProvidedError(){return new hn(rr.noTrustedBrokersProvided.code,rr.noTrustedBrokersProvided.desc)}static createBrokeringDisabledError(){return new hn(rr.brokeringDisabledError.code,`${rr.brokeringDisabledError.desc}`)}static createMessageBrokerTimeoutError(){return new hn(rr.brokerTimeoutError.code,rr.brokerTimeoutError.desc)}static createMessageBrokerHandshakeTimeoutError(){return new hn(rr.brokerHandshakeTimeoutError.code,rr.brokerHandshakeTimeoutError.desc)}static createBrokerHandshakeFailedError(){return new hn(rr.brokerHandshakeFailed.code,rr.brokerHandshakeFailed.desc)}static createShrGenerationError(){return new hn(rr.shrGenerationError.code,rr.shrGenerationError.desc)}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */class Oi extends Sa{constructor(e,t,r){if(super(jt.AUTH_RESULT),this.interactionType=e,this.result=t,r){const{setCorrelationId:i,...a}=r;this.errorPayload=a}}static validate(e){return e.data&&e.data.messageType===jt.AUTH_RESULT&&e.data.interactionType&&(e.data.result||e.data.errorPayload)?new Oi(e.data.interactionType,e.data.result,e.data.errorPayload):null}static detectError(e){let t;switch(e.name){case Io.INTERACTION_REQ_ERROR_NAME:t=new Gr(e.errorCode,e.errorMessage,e.subError);break;case Io.SERVER_ERROR_NAME:t=new co(e.errorCode,e.errorMessage,e.subError);break;case Io.CLIENT_AUTH_ERR_NAME:t=new dh(e.errorCode,e.errorMessage);break;case Io.CLIENT_CONFIG_ERROR_NAME:t=new Gy(e.errorCode);break;case Io.BROWSER_AUTH_ERROR_NAME:t=new hh(e.errorCode);break;case Io.BROWSER_CONFIG_ERROR_NAME:t=new Jy(e.errorCode,e.errorMessage);break;case Io.BROKER_AUTH_ERROR_NAME:t=new hn(e.errorCode,e.errorMessage);break;case Io.AUTH_ERROR_NAME:t=new Mt(e.errorCode,e.errorMessage,e.subError);break;default:t=new Mt(Hy,JSON.stringify(e));break}return t.setCorrelationId(e.correlationId),t}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */class vC extends Sa{constructor(e,t){super(jt.HANDLE_REDIRECT_REQUEST),this.embeddedClientId=e,this.version=t}static validate(e){return e.data&&e.data.messageType===jt.HANDLE_REDIRECT_REQUEST&&e.data.embeddedClientId&&e.data.version?new vC(e.data.embeddedClientId,e.data.version):null}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */function U8(n){return{...{preferredInteractionType:null,brokerRedirectParams:{},actAsBroker:!1,allowBrokering:!1,trustedBrokerDomains:[],brokerHandshakeTimeout:(n==null?void 0:n.brokerHandshakeTimeout)||Mfe,brokerMessageTimeout:(n==null?void 0:n.brokerMessageTimeout)||Rfe,brokerInteractionTimeout:(n==null?void 0:n.brokerInteractionTimeout)||Pfe},...n}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */class bC extends Sa{constructor(e,t){super(jt.EMBEDDED_LOGOUT_REQUEST),this.version=e,this.correlationId=t}static validate(e){const t=Sa.validateMessage(e);return t&&t.data&&t.data.version?new bC(t.data.version,t.data.correlationId):null}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */function Nfe(n,e){const t={userState:e,brokerState:{requestOrigin:n.embeddedAppOrigin,requestClientId:n.embeddedClientId}},r=JSON.stringify(t),i=new TextEncoder().encode(r);return window.btoa(Array.from(i,a=>String.fromCodePoint(a)).join(""))}function Ofe(n){if(!n)return null;try{const e=window.atob(n),t=new Uint8Array(e.length);for(let a=0;a<t.length;a++)t[a]=e.charCodeAt(a);const r=new TextDecoder().decode(t),i=JSON.parse(r);return i.hasOwnProperty("brokerState")?i:null}catch{return null}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */const Lfe="@azure/msal-browser-1p",Cd="3.26.0";/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */function F8(n){const e=n.split("-",1)[0].split(".",3);return{major:parseInt(e[0]),minor:parseInt(e[1]),patch:parseInt(e[2])}}function ku(n){n.port1.close(),n.port2.close()}function B8(n,e,t,r=20){if(n.length===0||t>r)return[0,t-1];let i=t,a=n.length;for(let o=0;o<n.length;o++){n[o].postMessage(e,"*");const[s,c]=B8(n[o],e,t+1,r);a+=s,c>i&&(i=c)}return[a,i]}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */class Dfe extends bm{constructor(e,t,r){var i;super(e),this.currentBrokerRedirectResponse=void 0,this.hybridAuthPromise=void 0,this.pwbBrokerAppConfiguration=U8(t),this.redirectResponseMap=new Map,this.embeddedAppConfigMap=new Map,this.telemetryAllowedEmbeddedClients=new Set,this.logger=new Ca(((i=e.system)==null?void 0:i.loggerOptions)||{},Lfe,Cd),this.eventHandler=r,this.messageListener=this.handleBrokerMessage.bind(this)}getRedirectCorrelationId(){const e=`msal.${this.getConfiguration().auth.clientId}`,t=sv(this.getConfiguration()).getItem(`${e}.request.native`);try{if(t){const r=JSON.parse(t);return r&&typeof r=="object"?r.correlationId:null}}catch{this.logger.error("BrokerClientApplication.getRedirectCorrelationId: Unable to parse native request")}return sv(this.getConfiguration()).getItem(`${e}.request.correlationId`)||""}async handleRedirectPromise(e){const t=this.getRedirectCorrelationId(),r=this.performanceClient.startMeasurement(At.AcquireTokenByBroker,t);r.add({brokerEventName:At.AcquireTokenRedirect});try{const i=super.handleRedirectPromise(e);this.currentBrokerRedirectResponse=i;const a=await this.currentBrokerRedirectResponse;if(this.currentBrokerRedirectResponse=void 0,a){const o=Ofe(a.state);if(this.setActiveAccount(a.account),o){const s={...a,state:o.userState};this.redirectResponseMap.set(o.brokerState.requestOrigin,s),r.add({embeddedClientId:o.brokerState.requestClientId,embeddedRedirectUri:o.brokerState.requestOrigin}),this.endBrokerPerformanceEvent(o.brokerState.requestClientId,r)}else return r.end({success:!0}),a}else r.discard();return null}catch(i){throw i instanceof Mt&&i.setCorrelationId(t),r.end({success:!1},i),i}}async listenForBrokerMessage(e,t){return this.logger.verbose("listening for child broker messages."),window.addEventListener("message",this.messageListener),this.broadcastBrokerReadyMessage(window.frames,e,t),e&&e.codeRequest&&(this.hybridAuthPromise=this.acquireTokenByCode(e.codeRequest)),this.hybridAuthPromise}broadcastBrokerReadyMessage(e,t,r){this.logger.trace("Broadcasting broker ready message to child frames.");const i={messageType:jt.BROKER_READY};window.postMessage(i,"*");const[a,o]=B8(e,i,1,t==null?void 0:t.maxChildFrameDepth);r==null||r.add({maxFrameDepthReached:o,framesNotified:a,maxFrameDepthConfigured:t==null?void 0:t.maxChildFrameDepth}),this.logger.trace(`Broadcasted broker ready message to ${a} child frames with a max depth of ${o}`)}stopListeningForBrokerMessage(){this.logger.verbose("stop listening for child broker messages."),window.removeEventListener("message",this.messageListener),this.embeddedAppConfigMap.forEach(([e,t])=>{this.logger.verbose(`closing message port for ${e}`),t.close()}),this.embeddedAppConfigMap.clear()}async handleBrokerMessage(e){var r,i;const t=Sa.validateMessage(e);if(!(!t||!t.data.messageType))switch(this.logger.verbose(`Broker received message with type: ${t.data.messageType}`),t.data.messageType){case jt.HANDSHAKE_REQUEST:return this.handleBrokerHandshake(t);case jt.HANDLE_REDIRECT_REQUEST:const a=vC.validate(t);return a?this.handleBrokerRedirectResponse(a,t):void 0;case jt.AUTH_REQUEST:const o=mC.validate(t,((r=this.embeddedAppConfigMap.get(t.data.embeddedClientId))==null?void 0:r[0])||t.origin);if(!o)return;o.request.correlationId||(o.request.correlationId=Fi());const s=this.performanceClient.startMeasurement(At.AcquireTokenByBroker,o.request.correlationId),c=(i=t.ports)==null?void 0:i[0];try{await this.handleBrokerAuthRequest(o,c),this.endBrokerPerformanceEvent(o.embeddedClientId,s);return}catch(u){throw this.endBrokerPerformanceEvent(o.embeddedClientId,s,u),u}default:return}}isDescendantFrame(e){const t=[];for(t.push(e.sourceFrame);t.length>0;){const r=t.pop();if(r)for(let i=0;i<r.frames.length;i++){const a=r.frames[i];if(a===e.targetFrame)return!0;a!==r&&t.push(a)}}return!1}async handleBrokerHandshake(e){var o,s;if(!(e.source&&e.source.window&&e.source.window===e.source)){this.logger.warning("Broker handshake request validation failed. Message origin is not an iframe");return}const t=e.source;window!==t&&!this.isDescendantFrame({sourceFrame:window,targetFrame:t})&&this.logger.warning("Broker handshake request validation failed. Message origin is not a descendant iframe");const r=fC.validate(e);if(!r){this.logger.warning("Broker handshake request validation failed. Message may not have come from MSAL.js.");return}const i=Fi(),a=this.performanceClient.startMeasurement(At.BrokerClientApplicationHandleBrokerHandshake,i);try{if(a.add({embeddedClientId:r.embeddedClientId}),r.allowTelemetry&&this.telemetryAllowedEmbeddedClients.add(r.embeddedClientId),this.logger.verbose(`${r.messageType} validated for AppId: ${r.embeddedClientId}`),this.hybridAuthPromise)try{await this.hybridAuthPromise}catch(f){this.logger.error(`Broker could not obtain tokens using authorization code initializer: ${f}`)}const c=new pC(Cd,"",e.data.nonce);this.logger.verbose(`Sending handshake response to ${e.origin}`);const u=(o=e.ports)==null?void 0:o[0];u&&(u.onmessage=this.messageListener,this.embeddedAppConfigMap.set(e.data.embeddedClientId,[e.origin,u]));const h=F8(e.data.version);u&&h.major===3&&h.minor>=15&&h.minor<=19?u==null||u.postMessage(c):(s=e.source)==null||s.postMessage(c,e.origin)}catch(c){throw this.endBrokerPerformanceEvent(r.embeddedClientId,a,c),c}}async handleBrokerRedirectResponse(e,t){var r;if(e){const i=this.embeddedAppConfigMap.get(e.embeddedClientId);let a,o;i?[o,a]=i:(o=t.origin,a=(r=t.ports)==null?void 0:r[0]),this.currentBrokerRedirectResponse&&await this.currentBrokerRedirectResponse;const s=this.redirectResponseMap.get(o),c=new Oi(Ae.Redirect,s||null);this.logger.verbose("Sending auth response"),a==null||a.postMessage(c);const u=`msal.${this.getConfiguration().auth.clientId}`;sv(this.getConfiguration()).removeItem(`${u}.request.native`);return}}async handleBrokerAuthRequest(e,t){this.currentBrokerRedirectResponse&&await this.currentBrokerRedirectResponse,e.request.correlationId||(e.request.correlationId=Fi());const r=e.request.correlationId,i=e.request.account||this.getActiveAccount();let a;switch(e.interactionType){case Ae.Silent:if(i){this.performanceClient.addFields({brokerEventName:At.AcquireTokenSilent},r),a=this.brokeredSilentRequest(e,i,t);break}this.performanceClient.addFields({brokerEventName:At.SsoSilent},r),a=this.brokeredSsoSilentRequest(e,t);break;case Ae.Redirect:case Ae.Popup:default:const o=this.getInteractionType(e.interactionType);this.performanceClient.addFields({brokerEventName:o===Ae.Redirect?At.AcquireTokenRedirect:At.AcquireTokenPopup},r),a=this.interactiveBrokerRequest(o,e,t);break}return a}getInteractionType(e){const t=this.pwbBrokerAppConfiguration.preferredInteractionType;return t||e}async interactiveBrokerRequest(e,t,r){switch(e){case Ae.Redirect:return this.brokeredRedirectRequest(t,r);case Ae.Popup:return this.brokeredPopupRequest(t,r);case Ae.Silent:this.logger.error("Invalid code path. interactiveBrokerRequest() should only be called for interactive requests.");return;case Ae.None:this.logger.error("Broker is blocking interactive requests. Please attempt a silent request or sign into the broker first.");return;default:this.logger.error("Invalid code path. interactiveBrokerRequest() should only be called for interactive requests.");return}}async brokeredRedirectRequest(e,t){var a;this.logger.verbose("Brokered redirect request initiated.");const r=this.getAllAccounts();this.eventHandler.emitEvent(r.length===0?de.LOGIN_START:de.ACQUIRE_TOKEN_START,Ae.Redirect,e.request);const i=((a=this.embeddedAppConfigMap.get(e.embeddedClientId))==null?void 0:a[1])||t;try{const o=new gC;i==null||i.postMessage(o),this.logger.verbose(`Sending redirect response: ${o}`);const s=this.addBrokerRequestProperties(e);return s.state=Nfe(e,s.state),await super.acquireTokenRedirect(s)}catch(o){const s=new Oi(Ae.Redirect,null,o);this.logger.verbose(`Found auth error in redirect: ${o}`),i==null||i.postMessage(s),this.eventHandler.emitEvent(r.length===0?de.LOGIN_FAILURE:de.ACQUIRE_TOKEN_FAILURE,Ae.Redirect,null,o)}}async brokeredPopupRequest(e,t){var a;this.logger.verbose("Brokered popup request initiated.");const r=this.getAllAccounts();this.eventHandler.emitEvent(r.length===0?de.LOGIN_START:de.ACQUIRE_TOKEN_START,Ae.Popup,e.request);const i=((a=this.embeddedAppConfigMap.get(e.embeddedClientId))==null?void 0:a[1])||t;try{const o=this.addBrokerRequestProperties(e),s=await super.acquireTokenPopup(o),c=new Oi(Ae.Popup,s);this.logger.verbosePii("Sending auth response"),i==null||i.postMessage(c);const u=r.length<this.getAllAccounts().length;this.eventHandler.emitEvent(u?de.LOGIN_SUCCESS:de.ACQUIRE_TOKEN_SUCCESS,Ae.Popup,s)}catch(o){const s=new Oi(Ae.Popup,null,o);this.logger.verbose(`Found auth error in popup: ${o}`),i==null||i.postMessage(s),this.eventHandler.emitEvent(r.length===0?de.LOGIN_FAILURE:de.ACQUIRE_TOKEN_FAILURE,Ae.Popup,null,o)}}async brokeredSsoSilentRequest(e,t){var i;this.logger.verbose("Brokered SSO Silent request initiated."),this.eventHandler.emitEvent(de.SSO_SILENT_START,Ae.Silent,e.request);const r=((i=this.embeddedAppConfigMap.get(e.embeddedClientId))==null?void 0:i[1])||t;try{const a=this.addBrokerRequestProperties(e),o=await super.ssoSilent(a),s=new Oi(Ae.Silent,o);this.logger.verbosePii("Sending auth response"),r==null||r.postMessage(s),this.eventHandler.emitEvent(de.SSO_SILENT_SUCCESS,Ae.Silent,o)}catch(a){const o=new Oi(Ae.Silent,null,a);this.logger.verbose(`Found auth error in ssoSilent: ${a}`),r==null||r.postMessage(o),this.eventHandler.emitEvent(de.SSO_SILENT_FAILURE,Ae.Silent,null,a)}}async brokeredSilentRequest(e,t,r){var a;this.logger.verbose("Brokered Silent request initiated."),this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_START,Ae.Silent,e.request);const i=((a=this.embeddedAppConfigMap.get(e.embeddedClientId))==null?void 0:a[1])||r;try{const o=this.addBrokerRequestProperties(e,t);o.cacheLookupPolicy=Wn.RefreshTokenAndNetwork;const s=await super.acquireTokenSilent(o),c=new Oi(Ae.Silent,s);i==null||i.postMessage(c),this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_SUCCESS,Ae.Silent,s)}catch(o){const s=new Oi(Ae.Silent,null,o);this.logger.verbose(`Found auth error in silent: ${o}`),i==null||i.postMessage(s),this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_FAILURE,Ae.Silent,null,o)}}getEmbeddedAppRedirectUri(e){const t=new Pt(e);return`brk-${this.getConfiguration().auth.clientId}://${t.getUrlComponents().HostNameAndPort}`}addBrokerRequestProperties(e,t){const r={...e.request};r.redirectUri=this.getEmbeddedAppRedirectUri(e.embeddedAppOrigin),r.extraQueryParameters={...r.extraQueryParameters,client_id:e.embeddedClientId,brk_client_id:this.getConfiguration().auth.clientId,brk_redirect_uri:this.getConfiguration().auth.redirectUri||fa()},r.tokenBodyParameters={...r.tokenBodyParameters,client_id:e.embeddedClientId,brk_client_id:this.getConfiguration().auth.clientId,brk_redirect_uri:this.getConfiguration().auth.redirectUri||fa()},r.storeInCache={idToken:!1,accessToken:!1};const i=t||this.getActiveAccount();return i&&(r.account=i),e.request.correlationId&&this.performanceClient.addFields({embeddedClientId:e.embeddedClientId,embeddedRedirectUri:e.embeddedAppOrigin},e.request.correlationId),r}async sendLogoutRequestToEmbeddedApps(e){this.logger.verbose("sendLogoutRequestToEmbeddedApps called"),await this.messageEmbeddedAppsToLogout(new bC(Cd,(e==null?void 0:e.correlationId)||Fi()))}async messageEmbeddedAppsToLogout(e){const t=[];this.embeddedAppConfigMap.forEach(r=>{t.push(new Promise((i,a)=>{var s;const o=window.setTimeout(()=>{i()},200);try{(s=r[1])==null||s.postMessage(e),r[1].addEventListener("message",c=>{c.data.messageType===jt.EMBEDDED_LOGOUT_RESPONSE&&(this.logger.info(`Received logout response from embedded app: ${c.data.embeddedClientId}`),i(),clearTimeout(o))})}catch(c){this.logger.error(`Could not logout application ${r[0]}. Error in message channel: ${c}`),a(c)}}))}),await Promise.all(t)}endBrokerPerformanceEvent(e,t,r){this.telemetryAllowedEmbeddedClients.has(e)||(this.logger.verbosePii(`TelemetryReporter: Skipping brokered event as not allowed by the client ${e}`,t.event.correlationId),t.discard()),r?t.end({success:!1},r):t.end({success:!0})}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */class jfe extends Sa{constructor(e,t,r){super(jt.EMBEDDED_LOGOUT_RESPONSE),this.version=e,this.correlationId=r,this.embeddedClientId=t}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */const af={Interaction:"brokerInteractionTimeoutMs",Message:"brokerMessageTimeoutMs",Iframe:"brokerIframeTimeoutMs"},of={Interaction:"brokerInteractionTimedOut",Message:"brokerMessageTimedOut",Iframe:"brokerIframeTimedOut"};class Ufe{get trustedBrokersProvided(){return!!this.pwbBrokeredAppConfiguration.trustedBrokerDomains&&this.pwbBrokeredAppConfiguration.trustedBrokerDomains.length>=1}get brokerConnectionEstablished(){return!!this.brokerMetadata}constructor(e,t,r,i,a,o,s,c){this.pwbBrokeredAppConfiguration=r,this.clientId=e,this.logger=i,this.brokerMetadata=null,this.performanceClient=a,this.hydrateCache=s,this.clearCache=c,this.messageChannelList=[],this.messageChannel=new MessageChannel,this.resolvers=new Map,this.temporaryBrokerStorage=o,this.onWindowMessageCb=this.onWindowMessage.bind(this),this.handshakeMetadata={correlationId:t}}getAncestors(){var r;const e=[];let t=window;for(;t&&t.parent&&t.parent.window!==t;)t=(r=t.parent)==null?void 0:r.window,e.push(t);return this.logger.verbose(`Attempting to send handshake request to ${e.length} ancestors`),e}async initiateHandshake(e){if(!this.trustedBrokersProvided)throw hn.createNoTrustedBrokersProvidedError();return this.initMeasurement&&this.initMeasurement.discard(),this.initMeasurement=e,new Promise((t,r)=>{const i=setTimeout(()=>{this.logger.warning("Broker handshake timed out"),e==null||e.add({brokerHandshakeTimedOut:!0,brokerHandshakeTimeoutMs:this.pwbBrokeredAppConfiguration.brokerHandshakeTimeout}),r(hn.createMessageBrokerHandshakeTimeoutError())},this.pwbBrokeredAppConfiguration.brokerHandshakeTimeout);this.handshakeMetadata.resolve=t,this.handshakeMetadata.reject=r,this.handshakeMetadata.timeoutId=i,window.addEventListener("message",this.onWindowMessageCb);const a=[];a.push(window),a.push(...this.getAncestors());for(let o=0;o<a.length;o++){const s=a[o],c=a.length-o-1;this.logger.verbose(`Sending handshake request to frame with depth = ${c}`),this.sendHandshakeRequest(s,c,void 0,e)}}).catch(t=>{const r=t;this.logger.error(r.message)})}async onWindowMessage(e){if(e.data&&e.origin&&this.pwbBrokeredAppConfiguration.trustedBrokerDomains.includes(e.origin))if(e.data.messageType===jt.BROKER_READY){this.logger.verbose("Broker is available.");const t=this.performanceClient.startMeasurement(At.PairwiseBrokerApplicationInitializeBrokering,this.handshakeMetadata.correlationId);return this.handshakeMetadata.performanceEvent&&this.handshakeMetadata.performanceEvent.discard(),this.handshakeMetadata.performanceEvent=t,t.add({isBackground:!0}),this.sendHandshakeRequest(e.source,this.getFrameDepth(e.source),e.origin,t)}else e.data.messageType===jt.HANDSHAKE_RESPONSE&&(this.handshakeMetadata.performanceEvent=this.initMeasurement,this.onHandshakeResponse(e))}getFrameDepth(e){const t=[];t.push(window),t.push(...this.getAncestors());for(let r=0;r<t.length;r++)if(t[r]===e)return t.length-r-1;return 0}closeBrokerConnection(){this.logger.verbose("Closing broker connection."),this.brokerMetadata=null,ku(this.messageChannel),this.messageChannelList.forEach(e=>ku(e.channel)),window.removeEventListener("message",this.onWindowMessageCb)}async sendSsoSilentRequest(e){this.performanceEvent=this.performanceClient.startMeasurement(At.EmbeddedClientApplicationSendSSOSilentRequest,e.correlationId),No(!0),this.performanceEvent.increment({visibilityChangeCount:0});const t=()=>{this.trackPageVisibility()};document.addEventListener("visibilitychange",t);try{const r=await this.sendRequest(e,Ae.Silent,{type:af.Iframe,error:of.Iframe,value:ib}),i=await this.handleResponse(r,e);if(i)this.performanceEvent.end({success:!0,fromCache:i.fromCache,accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length,isNativeBroker:i.fromNativeBroker,requestId:i.requestId},e.correlationId);else throw this.logger.errorPii(`Broker response is empty in brokered ssoSilent request: ${JSON.stringify(i)}`),hn.createBrokerResponseInvalidError();return i}catch(r){throw this.performanceEvent.end({success:!1},r),r}finally{document.removeEventListener("visibilitychange",t)}}async sendPopupRequest(e){this.performanceEvent=this.performanceClient.startMeasurement(At.EmbeddedClientApplicationSendPopupRequest,e.correlationId),No(!0);try{const t=await this.sendRequest(e,Ae.Popup,{type:af.Interaction,error:of.Interaction,value:this.pwbBrokeredAppConfiguration.brokerInteractionTimeout}),r=await this.handleResponse(t,e);if(r)this.performanceEvent.end({success:!0,fromCache:r.fromCache,accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length,isNativeBroker:r.fromNativeBroker,requestId:r.requestId});else throw gC.validate(t)?(this.logger.verbose("popupRequest requires a redirect by the broker, this app will now redirect."),hn.createBrokerPopupRequestRedirectingError()):(this.logger.errorPii(`Broker response is empty in brokered popup request: ${JSON.stringify(r)}`),hn.createBrokerResponseInvalidError());return r}catch(t){throw this.performanceEvent.end({success:!1},t),t}}async sendHandleRedirectRequest(e){this.performanceEvent=this.performanceClient.startMeasurement(At.EmbeddedClientApplicationHandleRedirectRequest);try{const t=new vC(this.clientId,Cd),r=await this.messageBroker(t,e.correlationId,{type:af.Message,error:of.Message,value:this.pwbBrokeredAppConfiguration.brokerMessageTimeout}),i=await this.handleResponse(r,e);return this.performanceEvent.end({success:!0,fromCache:i==null?void 0:i.fromCache,accessTokenSize:i==null?void 0:i.accessToken.length,idTokenSize:i==null?void 0:i.idToken.length,isNativeBroker:i==null?void 0:i.fromNativeBroker}),i}catch(t){throw this.performanceEvent.end({success:!1},t),t}}async sendSilentRefreshRequest(e){this.performanceEvent=this.performanceClient.startMeasurement(At.EmbeddedClientApplicationSendSilentRefreshRequest,e.correlationId),No(!0),this.performanceEvent.increment({visibilityChangeCount:0});const t=()=>this.trackPageVisibility();document.addEventListener("visibilitychange",t);try{const r=await this.sendRequest(e,Ae.Silent,{type:af.Message,error:of.Message,value:this.pwbBrokeredAppConfiguration.brokerMessageTimeout}),i=await this.handleResponse(r,e);if(i)this.performanceEvent.end({success:!0,fromCache:i.fromCache,accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length,isNativeBroker:i.fromNativeBroker,requestId:i.requestId});else throw this.logger.errorPii(`Broker response is empty in brokered silent refresh request: ${JSON.stringify(i)}`),hn.createBrokerResponseInvalidError();return i}catch(r){throw this.performanceEvent.end({success:!1},r),r}finally{document.removeEventListener("visibilitychange",t)}}async sendRequest(e,t,r){if(e.authenticationScheme===Wt.POP){const a=new NR(e);e.popKid=await a.generatePublicKeyThumbprint();const o=BE(this.clientId);this.temporaryBrokerStorage.containsKey(o)&&this.temporaryBrokerStorage.setItem(o,JSON.stringify(e))}const i=new mC(this.clientId,t,e,"");return this.messageBroker(i,e.correlationId,r)}getMessageChannelProperties(e){return e?this.messageChannelList.find(t=>t.nonce===e):this.getMessageChannelPropertiesByDepth(0)}getMessageChannelPropertiesByDepth(e){return this.messageChannelList.find(t=>t.depth===e)}onHandshakeResponse(e){const{resolve:t,reject:r,performanceEvent:i,timeoutId:a}=this.handshakeMetadata;try{const o=pC.validate(e,this.pwbBrokeredAppConfiguration.trustedBrokerDomains);if(o){const s=this.getMessageChannelProperties(o.nonce);if(!s){this.logger.trace("No MessageChannel found, ignoring this response"),i==null||i.increment({handshakeIgnoredCount:1});return}if(o.nonce&&o.nonce!==s.nonce){this.logger.trace("Received handshake response but there is a newer handshake request in flight, ignoring this one"),i==null||i.increment({handshakeIgnoredCount:1});return}a&&clearTimeout(a),this.logger.verbose("Received handshake response");const c=F8(o.version);this.brokerMetadata={origin:o.brokerOrigin,version:o.version,semver:c,frameDepth:s.depth},c.major<=3&&c.minor<15&&ku(s.channel),ku(this.messageChannel),this.messageChannel=s.channel,t&&t(),i==null||i.add({brokerFrameDepth:s.depth}),i==null||i.end({success:!0})}}catch(o){const s=o;r&&r(s),this.logger.error(s.message),i==null||i.end({success:!1},s)}}sendHandshakeRequest(e=window.top,t,r,i){if(this.logger.trace("Pairwise Broker - sendHandshakeRequest called."),!e)throw this.logger.error("Target frame is undefined."),hn.createBrokerHandshakeFailedError();let a=new MessageChannel;const o=Fi();a.port1.onmessage=async u=>{u.data&&(u.data.messageType===jt.HANDSHAKE_RESPONSE?(this.logger.warning("Received handshake response but the broker app is using a version of MSAL.js that does not report its origin, attempting direct communication with each trusted broker domain to resolve. This is a known issue with versions 3.15.0-3.19.1, consider asking the broker app to upgrade."),this.pwbBrokeredAppConfiguration.trustedBrokerDomains.forEach(h=>{const f=new MessageChannel;f.port1.onmessage=p=>{ku(a),a=f,this.onHandshakeResponse({...p,data:{...p.data},origin:h})},this.logger.verbose(`Sending handshake request to ${h}`),e==null||e.postMessage(s,h,[f.port2])})):await this.handleBrokerMessage(u))};const s=new fC(this.clientId,Cd,!0,o),c=this.getMessageChannelPropertiesByDepth(t);c?(ku(c.channel),c.channel=a,c.nonce=o):this.messageChannelList.push({channel:a,nonce:o,depth:t}),this.logger.verbose("Sending handshake request"),i==null||i.increment({handshakeSentCount:1}),e==null||e.postMessage(s,r||"*",[a.port2])}async handleBrokerMessage(e){var o,s,c,u;const t=((s=(o=e.data)==null?void 0:o.result)==null?void 0:s.correlationId)||((u=(c=e.data)==null?void 0:c.errorPayload)==null?void 0:u.correlationId),r=e.data.messageType;if(this.logger.verbose(`Received message from broker of type: ${r} with correlationId: ${t}`),!r)return;let i;if(r===jt.EMBEDDED_LOGOUT_REQUEST){this.logger.verbose("Received logout message from broker."),await this.handleLogoutMessageFromBroker(e),this.messageChannel.port1.postMessage(new jfe(Cd,this.clientId,t));return}else if(r===jt.AUTH_RESULT&&e.data.interactionType===Ae.Redirect)this.logger.verbose("Received redirect response from broker."),i=Ae.Redirect;else if(t)this.logger.verbose(`Resolving message for ${t}.`),i=t;else{this.logger.verbose(`No correlationId found in message: ${r}.`);return}const a=this.resolvers.get(i);a?(clearTimeout(a.timeoutId),a.resolve(e),this.resolvers.delete(i)):this.logger.warning(`Cannot resolve message for ${t}. Ignoring.`)}async messageBroker(e,t,r={type:af.Message,error:of.Message,value:this.pwbBrokeredAppConfiguration.brokerMessageTimeout}){return new Promise((i,a)=>{var h,f;if(!this.brokerMetadata){a(hn.createBrokeringDisabledError());return}const o=setTimeout(()=>{var v;const p={},g=r.error.toString();p[g]=!0,(v=this.performanceEvent)==null||v.add(p),a(hn.createMessageBrokerTimeoutError())},r.value),s={},c=r.type.toString();s[c]=r.value,(h=this.performanceEvent)==null||h.add(s);const u=e.messageType===jt.HANDLE_REDIRECT_REQUEST?Ae.Redirect:t;if(this.resolvers.set(u,{resolve:i,reject:a,timeoutId:o}),this.brokerMetadata.semver.major>=3&&this.brokerMetadata.semver.minor>=15)this.messageChannel.port1.postMessage(e);else{const p=new MessageChannel;p.port1.onmessage=this.handleBrokerMessage.bind(this),(f=window.top)==null||f.postMessage(e,this.brokerMetadata.origin,[p.port2])}})}async handleResponse(e,t){const r=Oi.validate(e);if(!r)return null;if(r.errorPayload)throw Oi.detectError(r.errorPayload);if(!r.result)throw hn.createBrokerResponseInvalidError();await this.hydrateCache(r.result,t);let i;if(t.authenticationScheme===Wt.POP){if(!t.popKid)throw hn.createShrGenerationError();i=await new NR(t).signRequest(r.result.accessToken,t.popKid)}return{...r.result,accessToken:i||r.result.accessToken}}async handleLogoutMessageFromBroker(e){bC.validate(e)&&(this.logger.verbose("Logout request received from broker and validated. Logging out embedded app."),await this.clearCache())}trackPageVisibility(){this.performanceEvent&&(this.logger.info("Embedded client: Visibility change detected"),this.performanceEvent.increment({visibilityChangeCount:1}))}}/*! @azure/msal-browser-1p v3.26.0 2024-10-08 */class Ffe extends bm{constructor(e,t,r){super(e,r),this.pwbBrokerAppConfig=U8(t),this.temporaryBrokerStorage=sv(e),this.eventHandler=new R6(this.getLogger()),this.redirectResponse=new Map,this.initialized=!1}async initialize(e){await super.initialize(e),this.initialized=!0}async initializeBrokering(e,t){if(typeof window>"u")return;const r={...t,correlationId:(t==null?void 0:t.correlationId)||Fi()},i=this.performanceClient.startMeasurement(At.PairwiseBrokerApplicationInitializeBrokering,r.correlationId);i.add({isBackground:!1});try{this.pwbBrokerAppConfig.actAsBroker?(this.pwbBrokerAppConfig.allowBrokering&&this.getLogger().verbose("Running in top frame and both actAsBroker, allowBrokering flags set to true. actAsBroker takes precedence."),this.broker=new Dfe(this.getConfiguration(),this.pwbBrokerAppConfig,this.eventHandler),this.getLogger().verbose("Acting as Broker"),this.getLogger().verbose("Initialize the extension for the new broker instance"),i.add({isBroker:!0}),await this.broker.initialize(r),await this.broker.listenForBrokerMessage(e,i),i.end({success:!0})):this.pwbBrokerAppConfig.allowBrokering&&(this.embeddedApp=new Ufe(this.getConfiguration().auth.clientId,r.correlationId,this.pwbBrokerAppConfig,this.getLogger(),this.performanceClient,this.temporaryBrokerStorage,this.hydrateCache.bind(this),this.clearCache.bind(this)),this.getLogger().verbose("Acting as child"),i.add({isBroker:!1}),await this.embeddedApp.initiateHandshake(i))}catch(a){throw i.end({success:!1},a),a}}async handleRedirectPromise(e){if(BA(this.initialized),typeof window<"u"){const t=e||"";let r=this.redirectResponse.get(t);if(typeof r>"u"){this.eventHandler.emitEvent(de.HANDLE_REDIRECT_START,Ae.Redirect);const i=this.getAllAccounts();r=this.handleRedirectPromiseInternal(e).then(a=>{if(!a)return null;const o=i.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(o?de.LOGIN_SUCCESS:de.ACQUIRE_TOKEN_SUCCESS,Ae.Redirect,a),a}).catch(a=>{throw this.eventHandler.emitEvent(i.length>0?de.ACQUIRE_TOKEN_FAILURE:de.LOGIN_FAILURE,Ae.Redirect,null,a),a}).finally(()=>{this.eventHandler.emitEvent(de.HANDLE_REDIRECT_END,Ae.Redirect)}),this.redirectResponse.set(t,r)}return r}return null}async handleRedirectPromiseInternal(e){var t;if((t=this.embeddedApp)!=null&&t.brokerConnectionEstablished){const r=BE(this.controller.getConfiguration().auth.clientId),i=this.temporaryBrokerStorage.getItem(r);if(i){const a=JSON.parse(i);return await this.embeddedApp.sendHandleRedirectRequest(a).catch(s=>{throw s instanceof Mt&&s.setCorrelationId(a.correlationId),s}).finally(()=>{this.temporaryBrokerStorage.removeItem(r)})}else return null}else return this.broker?this.broker.handleRedirectPromise(e):super.handleRedirectPromise(e)}async loginRedirect(e){return this.acquireTokenRedirect(e||{scopes:Gs})}async acquireTokenRedirect(e){const t=this.getAllAccounts().length===0;return this.eventHandler.emitEvent(t?de.LOGIN_START:de.ACQUIRE_TOKEN_START,Ae.Redirect,e),super.acquireTokenRedirect(e).catch(r=>(this.eventHandler.emitEvent(t?de.LOGIN_FAILURE:de.ACQUIRE_TOKEN_FAILURE,Ae.Redirect,null,r),Promise.reject(r)))}async loginPopup(e){return this.acquireTokenPopup(e||{scopes:Gs})}async acquireTokenPopup(e){No(!0);const t={...e,correlationId:e.correlationId||Fi()},r=this.getAllAccounts();return this.eventHandler.emitEvent(r.length===0?de.LOGIN_START:de.ACQUIRE_TOKEN_START,Ae.Popup,t),this.acquireTokenPopupInternal(t).then(i=>{const a=r.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(a?de.LOGIN_SUCCESS:de.ACQUIRE_TOKEN_SUCCESS,Ae.Popup,i),i}).catch(i=>{i instanceof Mt&&i.setCorrelationId(t.correlationId);const a=r.length===0;return this.eventHandler.emitEvent(a?de.LOGIN_FAILURE:de.ACQUIRE_TOKEN_FAILURE,Ae.Popup,null,i),Promise.reject(i)})}async acquireTokenPopupInternal(e){var t;if((t=this.embeddedApp)!=null&&t.brokerConnectionEstablished){if(this.getLogger().verbose("pairwise broker (embedded app) acquireTokenPopup called",e.correlationId),!this.embeddedApp)throw hn.createNoEmbeddedAppError();const r=BE(this.controller.getConfiguration().auth.clientId);return this.temporaryBrokerStorage.setItem(r,JSON.stringify(e)),this.embeddedApp.sendPopupRequest(e).then(i=>(this.temporaryBrokerStorage.removeItem(r),i))}return super.acquireTokenPopup(e)}async ssoSilent(e){No(!0);const t={...e,correlationId:e.correlationId||Fi()};return this.eventHandler.emitEvent(de.SSO_SILENT_START,Ae.Silent,t),this.ssoSilentInternal(t).then(r=>(this.eventHandler.emitEvent(de.SSO_SILENT_SUCCESS,Ae.Silent,r),r)).catch(r=>{throw r instanceof Mt&&r.setCorrelationId(t.correlationId),this.eventHandler.emitEvent(de.SSO_SILENT_FAILURE,Ae.Silent,null,r),r})}async ssoSilentInternal(e){return this.embeddedApp&&this.embeddedApp.brokerConnectionEstablished?(this.getLogger().verbose("ssoSilent called",e.correlationId),this.embeddedApp.sendSsoSilentRequest(e)):super.ssoSilent(e)}async acquireTokenSilent(e){No(!0);const t={...e,correlationId:e.correlationId||Fi()};return this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_START,Ae.Silent,t),this.acquireTokenSilentInternal(t).then(r=>(this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_SUCCESS,Ae.Silent,r),r)).catch(r=>(r instanceof Mt&&r.setCorrelationId(t.correlationId),this.eventHandler.emitEvent(de.ACQUIRE_TOKEN_FAILURE,Ae.Silent,null,r),Promise.reject(r)))}async acquireTokenSilentInternal(e){var i;if(!((i=this.embeddedApp)!=null&&i.brokerConnectionEstablished))return super.acquireTokenSilent(e);this.getLogger().verbose("acquireTokenSilent - attempting to acquire token from web flow");const t={...e,cacheLookupPolicy:Wn.AccessToken};let r;return e.cacheLookupPolicy===Wn.RefreshToken||e.cacheLookupPolicy===Wn.RefreshTokenAndNetwork||e.cacheLookupPolicy===Wn.Skip||e.forceRefresh?r=Promise.reject(new dh(Ja)):r=super.acquireTokenSilent(t),r.catch(async a=>{if(e.cacheLookupPolicy===Wn.AccessToken)throw a;if(!this.embeddedApp)throw hn.createNoEmbeddedAppError();return this.embeddedApp.sendSilentRefreshRequest(e)})}async logoutRedirect(e){if(this.embeddedApp&&this.embeddedApp.brokerConnectionEstablished)this.getLogger().error("Embedded app is not allowed to logout while the broker app is logged in.");else if(this.broker)return await this.broker.sendLogoutRequestToEmbeddedApps(),super.logoutRedirect(e)}async logoutPopup(e){if(this.embeddedApp&&this.embeddedApp.brokerConnectionEstablished)this.getLogger().error("Embedded app is not allowed to logout while the broker app is logged in.");else if(this.broker)return await this.broker.sendLogoutRequestToEmbeddedApps(),super.logoutPopup(e)}setActiveAccount(e){this.broker&&this.broker.setActiveAccount(e),super.setActiveAccount(e)}addEventCallback(e,t=Object.values(de)){const r=[de.ACQUIRE_TOKEN_START,de.ACQUIRE_TOKEN_SUCCESS,de.ACQUIRE_TOKEN_FAILURE,de.LOGIN_START,de.LOGIN_SUCCESS,de.LOGIN_FAILURE,de.SSO_SILENT_START,de.SSO_SILENT_SUCCESS,de.SSO_SILENT_FAILURE,de.HANDLE_REDIRECT_START,de.HANDLE_REDIRECT_END],i=[],a=[];t.forEach(s=>{r.includes(s)?i.push(s):a.push(s)});const o=super.addEventCallback(e,a);return o?(this.eventHandler.addEventCallback(e,i,o),o):null}removeEventCallback(e){super.removeEventCallback(e),this.eventHandler.removeEventCallback(e)}}class Bfe{supportsNaa(){return!1}supportsPwBBroker(){return!1}async handleInteractionRequiredError(e,t){var r;xn(En,null),xn(la,{reason:"token-expired",provider:"microsoft",loginHint:(r=t.account)==null?void 0:r.username})}}class Hfe extends Bfe{supportsPwBBroker(){return me.instance().config().useMSALPwBApp??!1}async instantiateMsal(){const e=this.supportsPwBBroker();O4({apiName:de.INITIALIZE_START,providerType:"microsoft",extraInfo:{eventInfo_isPwB:e}});let t;return e?(t=new Ffe(Q_,YK,Z_),await t.initialize(),await t.initializeBrokering()):t=await bm.createPublicClientApplication(Q_,Z_),L4({apiName:de.INITIALIZE_END,providerType:"microsoft",extraInfo:{eventInfo_isPwB:e}}),t}}const $fe=new Kl(zfe);async function zfe(){return new Hfe}function Vfe(n){return!(n instanceof Gr||n instanceof Mt&&(n.errorMessage===nL||parseInt(n.errorCode,10)===BT))}const Er=new Kl(Gfe);async function Gfe(){const n=await $fe.get(),e=await n.instantiateMsal(),t=new Map([["login",null],["graph",null],["oneDrive",null]]);async function r(a,o){const s=WK(a),c={account:o,...s},u=Bd(yre,"any");try{if(!u)return{accessToken:(await e.acquireTokenSilent(c)).accessToken};const f={...A4(),shouldRetry:g=>Vfe(g),onSuccess:g=>B4(g,a,"microsoft"),onFailure:g=>H4(g,a,"microsoft")};return await sA(async()=>({accessToken:(await e.acquireTokenSilent(c)).accessToken}),f)}catch(h){if(h instanceof Gr)return H.trackEvent({name:"system",data:{eventName:"copilotWebAcquireTokenRedirect",eventInfo_requestType:a,eventInfo_traceId:h.traceId,eventInfo_errorMessage:h.errorMessage,eventInfo_errorCode:h.errorCode,eventInfo_correlationId:h.correlationId,eventInfo_timeSinceStartMs:performance.now()-window.appStart}}),n.handleInteractionRequiredError(e,c);if(h instanceof Mt&&(h.errorMessage===nL||parseInt(h.errorCode,10)===BT))throw H.trackEvent({name:"system",data:{eventName:"copilotWebAcquireTokenUnderaged",eventInfo_requestType:a,eventInfo_errorMessage:h.errorMessage,eventInfo_errorCode:h.errorCode,eventInfo_correlationId:h.correlationId}}),new Error(HT);return}}return{msal:e,getMsalAccessToken:async a=>{const o=e.getActiveAccount();if(!o&&!n.supportsNaa())return;const s=t.get(a);if(!s){const c=r(a,o??void 0);t.set(a,c);const u=await c;return t.set(a,null),u}return s}}}function Kfe(n){var t;const e=(t=n.payload)==null?void 0:t.scopes;return Array.isArray(e)?e.some(r=>typeof r!="string"?!1:r==="ConsumerStore.Purchase"||r.endsWith("purchase.create")):!1}function H8(n){const e=Kfe(n);if(n.eventType===de.LOGIN_START){const t=n.payload;D4({apiName:de.LOGIN_START,authWorkflowAccountType:"microsoft",interactionType:n.interactionType??void 0,correlationId:t.correlationId,prompt:t.prompt,redirectUri:t.redirectUri,extraInfo:{eventInfo_isBrokered:e}})}else if(n.eventType===de.LOGIN_SUCCESS||n.eventType===de.SSO_SILENT_SUCCESS){const t=n.payload&&"account"in n.payload?n.payload.account:null,r=t?!ua(t.tenantId):void 0,i=n.payload;_1({apiName:n.eventType,authWorkflowAccountType:"microsoft",interactionType:n.interactionType??void 0,correlationId:i.correlationId,authority:i.authority,isMSA:r,extraInfo:{eventInfo_isBrokered:e}})}else if(n.eventType===de.LOGOUT_SUCCESS)j4({apiName:de.LOGOUT_SUCCESS,providerType:"microsoft",extraInfo:{eventInfo_isBrokered:e}});else if(n.eventType===de.ACQUIRE_TOKEN_START||n.eventType===de.ACQUIRE_TOKEN_NETWORK_START){$s("msalAcquireTokenStartTime",Date.now().toString());const t=n.payload;Ds({authWorkflowAccountType:"microsoft",apiName:n.eventType,extraInfo:{eventInfo_interactionType:n.interactionType??void 0,eventInfo_correlationId:t.correlationId,eventInfo_redirectUri:t.redirectUri,eventInfo_cacheLookupPolicy:t.cacheLookupPolicy,eventInfo_prompt:t.prompt,eventInfo_isBrokered:e}})}else if(n.eventType===de.ACQUIRE_TOKEN_SUCCESS){const t=Date.now()-parseInt($o("msalAcquireTokenStartTime")??"0",10);$s("msalAcquireTokenStartTime","");const r=n.payload;Ds({authWorkflowAccountType:"microsoft",apiName:n.eventType,extraInfo:{eventInfo_interactionType:n.interactionType??void 0,eventInfo_correlationId:r.correlationId,eventInfo_expiresOn:r.expiresOn,eventInfo_extExpiresOn:r.extExpiresOn,eventInfo_refreshOn:r.refreshOn,eventInfo_duration:t,eventInfo_fromCache:r.fromCache,eventInfo_isBrokered:e}})}else if(n.eventType===de.LOGIN_FAILURE||n.eventType===de.ACQUIRE_TOKEN_FAILURE||n.eventType===de.SSO_SILENT_FAILURE||n.eventType===de.ACQUIRE_TOKEN_BY_CODE_FAILURE||n.eventType===de.LOGOUT_FAILURE){let t;n.eventType===de.ACQUIRE_TOKEN_FAILURE&&(t=Date.now()-parseInt($o("msalAcquireTokenStartTime")??"0",10));const r=n.error;Vs({authWorkflowAccountType:"microsoft",apiName:n.eventType,errorType:(r==null?void 0:r.name)??"",errorMessage:(r==null?void 0:r.message)??"",extraInfo:{eventInfo_isBrokered:e},errorExtraInfo:{eventInfo_correlationId:r==null?void 0:r.correlationId,eventInfo_errorMessage:r==null?void 0:r.errorMessage,eventInfo_errorCode:r==null?void 0:r.errorCode,eventInfo_name:r==null?void 0:r.name,eventInfo_interactionType:n.interactionType??void 0,eventInfo_subError:r==null?void 0:r.subError,eventInfo_duration:t}})}else Ds({authWorkflowAccountType:"microsoft",apiName:n.eventType,extraInfo:{eventInfo_interactionType:n.interactionType??void 0,eventInfo_isBrokered:e}})}function ua(n){return n!==Tv}function qfe(n){Ds({apiName:"msal:silentSSOCustomSuccess",authWorkflowAccountType:"microsoft",duration:n.duration,extraInfo:{eventInfo_accountUpdate:n.accountUpdate,eventInfo_accountType:n.accountType,eventInfo_message:n.message}})}function X0(n){Vs({apiName:"msal:silentSsoCustomError",authWorkflowAccountType:"microsoft",errorMessage:n.message,errorCode:n.errorCode})}class Wfe{constructor(){B(this,"hasTrackedRedirectError",!1);B(this,"isHandlingRedirect",!1)}async handleRedirect(){var e;try{const{msal:t}=await Er.get();this.isHandlingRedirect&&Vs({authWorkflowAccountType:"microsoft",apiName:$v.INTERACTION_IN_PROGRESS,errorType:"interaction_in_progress",errorMessage:"Attempted to call handleRedirectPromise while already handling a redirect"}),this.isHandlingRedirect=!0;try{await t.handleRedirectPromise()&&U4({authWorkflowAccountType:"microsoft",apiName:"msal:reauthSuccess"});const i=await this.getAccount();return i?(t.setActiveAccount(i),{id:((e=i.idTokenClaims)==null?void 0:e.oid)??"",tenantId:i.tenantId,provider:"microsoft",accountType:ua(i.tenantId)?"AAD":"MSA"}):null}finally{this.isHandlingRedirect=!1}}catch(t){this.trackRedirectErrorOncePerSession(t)}return null}async handleRedirectWithoutAccount(){try{const{msal:e}=await Er.get();this.isHandlingRedirect&&Vs({authWorkflowAccountType:"microsoft",apiName:$v.INTERACTION_IN_PROGRESS,errorType:"interaction_in_progress",errorMessage:"Attempted to call handleRedirectPromise while already handling a redirect"}),this.isHandlingRedirect=!0;try{const t=await e.handleRedirectPromise();t&&e.setActiveAccount(t.account)}finally{this.isHandlingRedirect=!1}}catch(e){this.trackRedirectErrorOncePerSession(e)}}async maybeInitializeAccountWithToken(){var o;const{msal:e}=await Er.get(),t=e.getActiveAccount(),r=e.getAllAccounts(),i=Fe(En);Ds({authWorkflowAccountType:"microsoft",apiName:"msal:maybeInitializeAccountWithToken",extraInfo:{eventInfo_tenantId:t==null?void 0:t.tenantId,eventInfo_isAadTenant:t!=null&&t.tenantId?ua(t.tenantId):!1,eventInfo_accounts:r.map(s=>({type:ua(s.tenantId)?"AAD":"MSA"})),eventInfo_userAccount:i}});const a=await this.getAuthToken();if(a){const s=await this.getAccount();return s?(e.setActiveAccount(s),{userAccount:{id:((o=s.idTokenClaims)==null?void 0:o.oid)??"",tenantId:s.tenantId,provider:"microsoft",accountType:ua(s.tenantId)?"AAD":"MSA"},authToken:a}):null}return null}async logIn(){const{msal:e}=await Er.get(),t={...QT},r=this.buildRedirectUri();return r&&(t.redirectUri=r),e.loginRedirect(t)}buildRedirectUri(){const{surfaceQueryParam:e}=me.instance().config(),t=new URLSearchParams;let r;if(e!=null&&e.useForLoginRedirect)for(const[a,o]of Object.entries(e.params))t.set(a,o);const i=new URLSearchParams(window.location.search).get("back");return i&&t.set("back",i),t.toString()&&(r=`${window.location.origin}?${t}`),r}async logOut(){const{msal:e}=await Er.get(),t=e.getAllAccounts(),r=e.getActiveAccount();try{if($e("auth-rf-account-selection")){await e.logoutRedirect({account:r,onRedirectNavigate:()=>!1}),H.setPicassoId(null);return}for(const i of t)i.tenantId!==Tv&&(await e.logoutRedirect({account:i,onRedirectNavigate:()=>!1}),H.setPicassoId(null))}catch(i){console.error(i)}await e.logoutRedirect({account:r,onRedirectNavigate:()=>!1}),H.setPicassoId(null)}async getAuthToken(){return(await Er.get()).getMsalAccessToken("login")}async getUserInfo(){const e=await(await Er.get()).getMsalAccessToken("graph");if(e)return iR(e.accessToken)}async getUserInfoFromToken(e){return iR(e)}supportsTokenType(e){return e===void 0}trackRedirectErrorOncePerSession(e){this.hasTrackedRedirectError||H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"msalHandleRedirectPromise",eventInfo_details:"Error handling redirect promise",eventInfo_errorMessage:`${e}`}}),this.hasTrackedRedirectError=!0}async getAccount(){var i;const{msal:e}=await Er.get(),t=e.getAllAccounts(),r=e.getActiveAccount();if((t.length>1||t.length===1&&(r==null?void 0:r.homeAccountId)!==((i=t[0])==null?void 0:i.homeAccountId))&&Ds({authWorkflowAccountType:"microsoft",apiName:"msal:getAllAccounts",extraInfo:{eventInfo_accountCount:t.length,eventInfo_accountTypes:t.map(a=>ua(a.tenantId)?"AAD":"MSA")}}),t.length!==0){if($e("auth-rf-account-selection"))return t.length===0?void 0:t.length===1?t[0]:t.length>1&&r?r:void 0;for(const a of t)if(a.tenantId===Tv)return a;return t[0]}}async getCurrentActiveUserAccount(){var t;const e=await this.getAccount();return e?{id:((t=e.idTokenClaims)==null?void 0:t.oid)??"",tenantId:e.tenantId,provider:"microsoft",accountType:ua(e.tenantId)?"AAD":"MSA"}:null}}class er{constructor(){B(this,"middlewares",[])}add(e){this.middlewares.push(e)}async run(e){let t={...e};for(const r of this.middlewares)try{t=await r(t)}catch{continue}return t}}const Yfe=new er,CP=new er,F4e=new er,B4e=new er,Qfe=new er,Jfe=new er,Zfe=new er,Xfe=new er,epe=new er,tpe=new er,npe=new er,H4e=new er,rpe=new er,ipe=new er,ape=new er,ope=new er,spe=new er,cpe=new er,lpe=new er;var wd;const Nc=class Nc{constructor(){B(this,"providers");this.providers={microsoft:new Wfe,auth0:new Gre}}async handleRedirect(){const e=await this.providers.microsoft.handleRedirect();if(e)return e;if(!me.instance().config().enableAuth0)return null;const t=await this.providers.auth0.handleRedirect();return t||null}async handleRedirectWithoutAccount(){await this.providers.microsoft.handleRedirectWithoutAccount(),me.instance().config().enableAuth0&&await this.providers.auth0.handleRedirectWithoutAccount()}async getCurrentActiveUserAccountAndSetGlobalUserAccount(){const e=await this.providers.microsoft.getCurrentActiveUserAccount();if(e){this.setUserAccount(e);return}if(!me.instance().config().enableAuth0)return;const t=await this.providers.auth0.getCurrentActiveUserAccount();t&&this.setUserAccount(t)}static instance(){return fe(Nc,wd)||Vt(Nc,wd,new Nc),fe(Nc,wd)}getCurrentProvider(){const e=Fe(En);return e?this.providers[e.provider]:null}async getAccountFromProviders(){var e;return M1()?((e=this.getCurrentProvider())==null?void 0:e.getCurrentActiveUserAccount())??null:this.handleRedirect()}async maybeInitialize(){try{const e=await this.providers.microsoft.maybeInitializeAccountWithToken();if(e)return e;if(!me.instance().config().enableAuth0)return null;const t=await this.providers.auth0.maybeInitializeAccountWithToken();if(t)return t}catch(e){e instanceof Error&&Zn({feature:"accountInitialization",errorType:e.name,errorMessage:e.message,exception:e.stack})}return null}setUserAccount(e){xn(En,e),H.setUserAccountType(e==null?void 0:e.accountType)}async getAuthToken(){var r;const e=await CP.run({type:"login"});if(e.isHandled){if(((r=e.authToken)==null?void 0:r.tokenType)!==void 0){const i=Vre(e.authToken.tokenType);H.setUserAccountType(i)}return e.authToken}if(M1()){const i=this.getCurrentProvider();return i?i.getAuthToken():void 0}const t=this.getCurrentProvider();if(!t){const i=await this.handleRedirect();if(i)return this.setUserAccount(i),this.providers[i.provider].getAuthToken();const a=await this.maybeInitialize();if(a){const{authToken:o,userAccount:s}=a;return this.setUserAccount(s),o}return}return t.getAuthToken()}async getUserInfo(){const e=await CP.run({type:"graph"});if(e.isHandled){if(!e.authToken)return;const{tokenType:r,accessToken:i}=e.authToken,a=r!=="msa"?r:void 0;if(this.providers.microsoft.supportsTokenType(a))return this.providers.microsoft.getUserInfoFromToken(i);if(this.providers.auth0.supportsTokenType(a)){const o=await this.providers.auth0.getUserInfoFromToken(i);if(o)return o}return}const t=this.getCurrentProvider();if(t)return t.getUserInfo()}logIn(e,t){return this.providers[e].logIn(t)}async logOut(){const e=this.getCurrentProvider();return e&&(await e.logOut(),this.setUserAccount(null)),Promise.resolve()}async initAuthAccount(){await this.handleRedirectWithoutAccount(),await this.getCurrentActiveUserAccountAndSetGlobalUserAccount()}};wd=new WeakMap,ln(Nc,wd,null);let Wo=Nc;function $8(){return null}function upe(){return null}function z8({featureOverrides:n,localFeatureOverrides:e,serverFeatures:t,surfaceConfig:r}){var a,o,s;const i=new Set([...t]);(a=r.settingsOverrides)!=null&&a.shouldHideShopping&&i.delete("shopping-card"),r.startInVoice&&i.add("start-in-voice"),(o=r.pages)!=null&&o.enabled?i.add("pages"):((s=r.pages)==null?void 0:s.enabled)===!1&&i.delete("pages");for(const c of n)i.add(c);for(const c of e)i.add(c);return Array.from(i)}function V8(){return[]}async function Ak(){const{msal:n}=await Er.get();return n.getActiveAccount()}async function kk(){const n=await Ak();return n?ua(n.tenantId):!1}async function SP(){const n=await Ak();if(!(!n||!ua(n.tenantId)))return n}async function dpe(){const n=await Ak();if(!(!n||ua(n.tenantId)))return n}async function hpe(){return(await Er.get()).getMsalAccessToken("oneDrive")}async function fpe(){if(!await kk())return;const{msal:n}=await Er.get(),e=n.getActiveAccount();e&&n.clearCache({account:e})}const G8="urlFeatureOverrides";function ppe(){return typeof window>"u"?null:sessionStorage.getItem(G8)}function K8(){const n=ppe();return n?n.split(",").map(t=>t):[]}function mpe(){const n=Rn("features");return n!=null&&n.trim()&&typeof window<"u"&&sessionStorage.setItem(G8,n.trim()),K8()}const gpe={VITE_API_URL:"copilot.microsoft.com/c/api"};async function vpe(n,e){try{return await n.json()}catch(t){throw(t instanceof SyntaxError||t instanceof TypeError||t instanceof DOMException)&&wW(t,n,e),t}}function q8(n={}){const{query:e={}}=n,t=new URLSearchParams;for(const[o,s]of Object.entries(e))t.append(o,s);const r=z8({featureOverrides:K8(),localFeatureOverrides:V8(),serverFeatures:[],surfaceConfig:me.instance().config()}).join(",");r&&(t.append("features",r),t.append("setflight",r));const i=$8();i&&(t.append("promptBranch",i),upe()&&t.append("useSxs","true"));const{surfaceQueryParam:a}=me.instance().config();if(a)for(const[o,s]of Object.entries(a.params))t.append(o,s);return t}function W8(n){return n!==void 0&&n.tokenType!==void 0&&n.tokenType!=="msa"}async function wP(n,e){const{VITE_API_URL:t}=gpe;let r;if(oL()?r=`${window.location.host}/c/api`:r=t,!r)throw new Error("Cannot initialize websocket because the required env vars are not set: VITE_API_URL");const i={...e,"api-version":"2"},a=await Wo.instance().getAuthToken(),o=await kk();a&&!o&&(i.accessToken=a.accessToken,W8(a)&&(i["X-UserIdentityType"]=a.tokenType)),a===void 0?P4(n,"getWssAPIUrl"):N4(n,"getWssAPIUrl"),Fe(jd)&&(i.appFlavor="beta");const s=q8({query:i});return`wss://${r}/${n}?${s}`}function bpe(n,e){const t=[sL(),n],r=q8({query:e});return r.toString()&&t.push("?",String(r)),t.join("")}function ype(n,e,t){if(n.attemptCount>1){const r=n.errors.filter(i=>i.errorType==="RequestTimeoutError").length;H.trackEvent({name:"system",data:{eventName:"copilotFeatureSuccess",eventInfo_feature:"apiRetry",eventInfo_scenario:e,eventInfo_duration:n.endTime-n.startTime,eventInfo_customData:JSON.stringify({attemptCount:n.attemptCount,errorCount:n.errors.length,timeoutErrorCount:r,delayTimings:n.delayTimings})}})}t==null||t(n)}function Cpe(n,e,t){var a,o;const r=n.exitReason==="requestTimeout",i={path:e,attemptCount:n.attemptCount,totalDuration:n.endTime-n.startTime,exitReason:n.exitReason,errorCount:n.errors.length,isTimeoutFailure:r,lastErrorType:(a=n.errors[n.errors.length-1])==null?void 0:a.errorType,lastErrorMessage:(o=n.errors[n.errors.length-1])==null?void 0:o.errorMessage,delayTimings:n.delayTimings};H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"ApiRetryFailure",eventInfo_errorMessage:r?`API retry failed due to timeout after ${n.attemptCount} attempts`:`API retry failed after ${n.attemptCount} attempts. Exit reason: ${n.exitReason}`,eventInfo_details:JSON.stringify(i)}}),t==null||t(n)}function Spe(n,e,t){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"ApiRetryTimeout",eventInfo_errorMessage:`Request timed out after ${n.timeoutMs}ms (attempt ${n.attemptCount})`,eventInfo_details:JSON.stringify({timeoutMs:n.timeoutMs,attemptCount:n.attemptCount,errorCount:n.errors.length,delayTimings:n.delayTimings,scenario:e,duration:n.endTime-n.startTime})}}),t==null||t(n)}async function wa(n,e={}){const{options:t,query:r,analytics:i,retry:a,requestTimeoutMs:o}=e;if(a){const{onSuccess:s,onFailure:c,onTimeout:u}=a,h={...a,onSuccess:p=>{ype(p,(i==null?void 0:i.anonymousPath)??n,s)},onFailure:p=>{Cpe(p,(i==null?void 0:i.anonymousPath)??n,c)},onTimeout:p=>{Spe({...p,timeoutMs:o??-1},(i==null?void 0:i.anonymousPath)??n,u)}};return sA(o?()=>Lre(p=>ew({path:n,options:t,query:r,analytics:i,abortController:p}),o):()=>ew({path:n,options:t,query:r,analytics:i}),h)}return ew({path:n,options:t,query:r,analytics:i})}async function ew(n){const{path:e,options:t,query:r,analytics:i,abortController:a}=n,o=new Headers(t==null?void 0:t.headers);Dt.resolvedLanguage?o.set("X-Search-UILang",Dt.resolvedLanguage.toLowerCase()):Dt.language&&o.set("X-Search-UILang",Dt.language.toLowerCase());const s=await Wo.instance().getAuthToken(),c=await kk();s&&!c&&(o.set("Authorization",`Bearer ${s.accessToken}`),W8(s)&&o.set("X-UserIdentityType",s.tokenType)),s===void 0?P4(e,"fetchApi"):N4(e,"fetchApi"),Fe(jd)&&o.set("X-Copilot-App-Flavor","beta");const u=performance.now(),h=await fetch(bpe(e,r),{...t,credentials:"include",headers:o,signal:a==null?void 0:a.signal}),f=performance.now();return R4((i==null?void 0:i.anonymousPath)??e,(t==null?void 0:t.method)??"GET",f-u,h.clone()),gp.trackLatestApiAssignment(h.headers),h}async function xr({path:n,args:e={}}){var r;const t={method:"POST",...e.options,headers:{"Content-Type":"application/json",...(r=e.options)==null?void 0:r.headers},body:e.body?JSON.stringify(e.body):void 0};return wa(n,{...e,options:t})}async function Tn(n,e,t={}){const{analytics:r,onFailedRequest:i}=t,a=(r==null?void 0:r.anonymousPath)??n,o=await wa(n,t);let s=!0;if(!o.ok&&i&&(s=!!i(o)),!s)return{data:void 0,response:{ok:o.ok,status:o.status,headers:o.headers},zodError:void 0};const c=await vpe(o,a);let u,h;const{safe:f}=t.parseOptions??{};if(f){const p=e.safeParse(c);p.error&&vp(p.error,a,!0),u=c,h=p.error}else try{u=e.parse(c)}catch(p){throw p instanceof wv&&vp(p,a,!1),p}return{data:u,response:{ok:o.ok,status:o.status,headers:o.headers},zodError:h}}const wpe={headers:{"content-type":"application/json"},body:JSON.stringify({type:"private"})};function Y8(n,{arg:e}={}){const r=(e==null?void 0:e.isPrivate)??!1?wpe:void 0;return Tn(n,WX,{options:{method:"POST",...r}}).then(i=>i.data)}function xk(){const n=N(LI),{trigger:e}=iI("/conversations",Y8),t=N(Sn),r=Zp(Sn),i=pe(My),a=pe(OI),o=pe(ene),s=Sne(),{isLivingPortraitEnabled:c}=ZI(),u=N(c4),[h,f]=m.useState(!1);return{startConversationDisabled:h,createConversation:m.useCallback(async p=>{const{shouldNavigateToChat:g=!0,characterId:v,portraitId:y,isPrivate:b=!1}=p??{};if(n){const C=t.get(n);if(c?(u==null?void 0:u.id)!==void 0&&u.id===y:(C==null?void 0:C.characterId)===v)return s({id:n,shouldNavigateToChat:g}),n}if(!h)try{f(!0);const{id:C}=await e({isPrivate:b}),S={id:C,updatedAt:new Date().toISOString(),history:[],isNew:!0,characterId:v,streamingState:"idle",continuedAt:null};return b&&a(C),r(T=>{T.set(C,S)}),s({id:C,shouldNavigateToChat:!b&&g}),i(!0),une(),o(),C}catch(C){console.error(C)}finally{f(!1)}},[n,h,t,c,u,s,e,r,a,i,o])}}function yC(){const[n,e]=Je(ite),t=Bt();return m.useEffect(()=>{t.endsWith("/chats/new/talk")&&(H.setLandingPage("deepLinkVoiceCall"),e("audioCall"))},[t,e]),[n,()=>e(null)]}function Jl(){const n=Bt(),e=ee("enable-private-chat");return n===aL&&e}function _k(n){const e=n!=null&&n.length?n.includes("enable-private-chat"):$e("enable-private-chat");return window.location.pathname===aL&&e}const Epe=O(0),Tpe=O(null),Ipe=O(null),CC=O("center"),Q8=O(void 0),ri=O(null),Ape=O(null),ym=O(null),SC=O(null),kpe=O(n=>{var r;const e=n(po),t=eA(e);return((r=t==null?void 0:t.part.task)==null?void 0:r.type)==="research"}),J8=O(null),xpe=O(!1);O(new Map);const _pe=O(!1),$4e=O(!1),Mk=O(null),Cm=O(!1),HE=O(!1),Rk="shouldPerformUserMerge";function Mpe(n){$s(Rk,String(n))}function Rpe(){Zq(Rk)}function Ppe(){return $o(Rk)!=="false"}function z4e(){const n=N(po),e=fr(),[t,r]=Je(bre),i=ee("user-conversation-merge"),a=i&&!e&&n.length>0;return m.useEffect(()=>{i&&Mpe(t)},[i,t]),{shouldShowMergeCheckbox:a,shouldMerge:t,setShouldMerge:r}}function Z8(n){try{return new URL(n,window.location.origin).origin!==window.location.origin}catch{return!1}}function Ch(n){Fe(Bl)&&Z8(n)?dt().set(Py,n.toString()):window.location.href=n}function Sm(){Npe()}function Npe(n){const{surfaceQueryParam:e}=me.instance().config(),t=new URL(window.location.href);if(e)for(const[r,i]of Object.entries(e.params))t.searchParams.delete(r),t.searchParams.append(r,i);Ch(t.href)}const Ia=O(null),X8=O([]);function Pk(){var c;const[n,e]=Je(X8),t=m.useRef([]);m.useEffect(()=>{const u=t.current,h=n;if(u.length>h.length){const f=u.filter((g,v)=>v>=h.length),p=f.length;for(let g=p-1;g>=0;g-=1){const v=f[g];v!=null&&v.onPopPage&&v.onPopPage()}}t.current=n},[n]);const r=n.length>0?(c=n[n.length-1])==null?void 0:c.page:void 0,i=u=>a([u]),a=u=>{const h=u.map(f=>({page:f,onPopPage:void 0}));e(f=>[...f,...h])};return{currentPage:r,pushPage:i,pushPages:a,goBackOrClose:()=>{e(u=>u.length<=0?u:u.slice(0,-1))},closeSettings:()=>{e([])}}}function Ope(n,e){const t={page:n,onPopPage:e==null?void 0:e.onPopPageCallback};dt().set(X8,r=>[...r,t])}function wm(n){const{pages:e,className:t,children:r,disableLink:i,clickSource:a,onClick:o,pushPagesDelay:s=0}=n,{pushPages:c}=Pk(),u=()=>{setTimeout(()=>{_t.emit("disclaimer:open-settings"),c(e)},s),o==null||o(),nt({source:a??"settingsLink",destination:e[e.length-1]})};return i?d.jsx("span",{children:r}):d.jsx("button",{className:t,type:"button",title:"",onClick:u,children:r})}function Lpe(){const n=pe(Ia);return d.jsx("p",{children:d.jsx(Fr,{i18nKey:"settings.copilotBeta.announcementSubtitle",components:{settingsLink:d.jsx(wm,{pages:["menu","copilot-beta"],className:"underline",clickSource:"disclaimerSettingsLink",onClick:()=>n(null)})}})})}function Dpe(){if(!$e("copilot-beta-automatic-opt-in"))return;const n=Fe(jd);if(n===void 0)xn(kS,!0),xn(jd,!0),Sm();else if(n&&Fe(kS)){const t={title:re("settings.copilotBeta.announcementTitle"),subtitle:d.jsx(Lpe,{})};xn(Ia,t),xn(kS,void 0)}}function $E(n){if(window.clarity)for(const[e,t]of Object.entries(n))window.clarity("set",e,t)}function EP(n){if(window.clarity)for(const e of n)window.clarity("event",e)}function Nk(n){const e=sy(),t=m.useRef(n);t.current=n,m.useEffect(()=>e.subscribe("onBeforeNavigate",r=>{const{pathChanged:i}=r;i&&t.current(r)}),[e])}let e9=!0,t9=!0;function jpe(n){t9=n}function Ok(){return e9}function Upe(){Nk(()=>{t9||(e9=!1)})}const Fpe=(n,e,t)=>{const r=n[e];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((i,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})},{slice:Bpe,forEach:Hpe}=[];function $pe(n){return Hpe.call(Bpe.call(arguments,1),e=>{if(e)for(const t in e)n[t]===void 0&&(n[t]=e[t])}),n}const TP=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,zpe=(n,e,t)=>{const r=t||{};r.path=r.path||"/";const i=encodeURIComponent(e);let a=`${n}=${i}`;if(r.maxAge>0){const o=r.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");a+=`; Max-Age=${Math.floor(o)}`}if(r.domain){if(!TP.test(r.domain))throw new TypeError("option domain is invalid");a+=`; Domain=${r.domain}`}if(r.path){if(!TP.test(r.path))throw new TypeError("option path is invalid");a+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");a+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a},IP={create(n,e,t,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};t&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+t*60*1e3)),r&&(i.domain=r),document.cookie=zpe(n,encodeURIComponent(e),i)},read(n){const e=`${n}=`,t=document.cookie.split(";");for(let r=0;r<t.length;r++){let i=t[r];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return i.substring(e.length,i.length)}return null},remove(n){this.create(n,"",-1)}};var Vpe={name:"cookie",lookup(n){let{lookupCookie:e}=n;if(e&&typeof document<"u")return IP.read(e)||void 0},cacheUserLanguage(n,e){let{lookupCookie:t,cookieMinutes:r,cookieDomain:i,cookieOptions:a}=e;t&&typeof document<"u"&&IP.create(t,n,r,i,a)}},Gpe={name:"querystring",lookup(n){var r;let{lookupQuerystring:e}=n,t;if(typeof window<"u"){let{search:i}=window.location;!window.location.search&&((r=window.location.hash)==null?void 0:r.indexOf("?"))>-1&&(i=window.location.hash.substring(window.location.hash.indexOf("?")));const o=i.substring(1).split("&");for(let s=0;s<o.length;s++){const c=o[s].indexOf("=");c>0&&o[s].substring(0,c)===e&&(t=o[s].substring(c+1))}}return t}};let sf=null;const AP=()=>{if(sf!==null)return sf;try{sf=window!=="undefined"&&window.localStorage!==null;const n="i18next.translate.boo";window.localStorage.setItem(n,"foo"),window.localStorage.removeItem(n)}catch{sf=!1}return sf};var Kpe={name:"localStorage",lookup(n){let{lookupLocalStorage:e}=n;if(e&&AP())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupLocalStorage:t}=e;t&&AP()&&window.localStorage.setItem(t,n)}};let cf=null;const kP=()=>{if(cf!==null)return cf;try{cf=window!=="undefined"&&window.sessionStorage!==null;const n="i18next.translate.boo";window.sessionStorage.setItem(n,"foo"),window.sessionStorage.removeItem(n)}catch{cf=!1}return cf};var qpe={name:"sessionStorage",lookup(n){let{lookupSessionStorage:e}=n;if(e&&kP())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupSessionStorage:t}=e;t&&kP()&&window.sessionStorage.setItem(t,n)}},Wpe={name:"navigator",lookup(n){const e=[];if(typeof navigator<"u"){const{languages:t,userLanguage:r,language:i}=navigator;if(t)for(let a=0;a<t.length;a++)e.push(t[a]);r&&e.push(r),i&&e.push(i)}return e.length>0?e:void 0}},Ype={name:"htmlTag",lookup(n){let{htmlTag:e}=n,t;const r=e||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(t=r.getAttribute("lang")),t}},Qpe={name:"path",lookup(n){var i;let{lookupFromPathIndex:e}=n;if(typeof window>"u")return;const t=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(t)?(i=t[typeof e=="number"?e:0])==null?void 0:i.replace("/",""):void 0}},Jpe={name:"subdomain",lookup(n){var i,a;let{lookupFromSubdomainIndex:e}=n;const t=typeof e=="number"?e+1:1,r=typeof window<"u"&&((a=(i=window.location)==null?void 0:i.hostname)==null?void 0:a.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(r)return r[t]}};function Zpe(){return{order:["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:n=>n}}class n9{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e||{languageUtils:{}},this.options=$pe(t,this.options||{},Zpe()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=i=>i.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(Vpe),this.addDetector(Gpe),this.addDetector(Kpe),this.addDetector(qpe),this.addDetector(Wpe),this.addDetector(Ype),this.addDetector(Qpe),this.addDetector(Jpe)}addDetector(e){return this.detectors[e.name]=e,this}detect(e){e||(e=this.options.order);let t=[];return e.forEach(r=>{if(this.detectors[r]){let i=this.detectors[r].lookup(this.options);i&&typeof i=="string"&&(i=[i]),i&&(t=t.concat(i))}}),t=t.map(r=>this.options.convertDetectedLanguage(r)),this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e,t){t||(t=this.options.caches),t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(e,this.options)}))}}n9.type="languageDetector";const r9=[{name:"Arabic",i18nCode:"ar",direction:"rtl"},{name:"Basque",i18nCode:"eu",direction:"ltr"},{name:"Bengali",i18nCode:"bn-IN",direction:"ltr"},{name:"Bulgarian",i18nCode:"bg",direction:"ltr"},{name:"Catalan",i18nCode:"ca",direction:"ltr"},{name:"Chinese (Simplified)",i18nCode:"zh-Hans",direction:"ltr"},{name:"Chinese (Traditional)",i18nCode:"zh-Hant",direction:"ltr"},{name:"Croatian",i18nCode:"hr",direction:"ltr"},{name:"Czech",i18nCode:"cs",direction:"ltr"},{name:"Danish",i18nCode:"da",direction:"ltr"},{name:"Dutch",i18nCode:"nl",direction:"ltr"},{name:"English (US)",i18nCode:"en-US",direction:"ltr"},{name:"English (UK)",i18nCode:"en-GB",direction:"ltr"},{name:"Estonian",i18nCode:"et",direction:"ltr"},{name:"Finnish",i18nCode:"fi",direction:"ltr"},{name:"French",i18nCode:"fr",direction:"ltr"},{name:"Galician",i18nCode:"gl",direction:"ltr"},{name:"German",i18nCode:"de",direction:"ltr"},{name:"Gujarati",i18nCode:"gu",direction:"ltr"},{name:"Hebrew",i18nCode:"he",direction:"rtl"},{name:"Hindi",i18nCode:"hi",direction:"ltr"},{name:"Hungarian",i18nCode:"hu",direction:"ltr"},{name:"Icelandic",i18nCode:"is",direction:"ltr"},{name:"Indonesian",i18nCode:"id",direction:"ltr"},{name:"Italian",i18nCode:"it",direction:"ltr"},{name:"Japanese",i18nCode:"ja",direction:"ltr"},{name:"Kannada",i18nCode:"kn",direction:"ltr"},{name:"Korean",i18nCode:"ko",direction:"ltr"},{name:"Latvian",i18nCode:"lv",direction:"ltr"},{name:"Lithuanian",i18nCode:"lt",direction:"ltr"},{name:"Malay",i18nCode:"ms",direction:"ltr"},{name:"Malayalam",i18nCode:"ml",direction:"ltr"},{name:"Marathi",i18nCode:"mr",direction:"ltr"},{name:"Norwegian (Bokmål)",i18nCode:"nb-NO",direction:"ltr"},{name:"Polish",i18nCode:"pl",direction:"ltr"},{name:"Portuguese (Brazil)",i18nCode:"pt-BR",direction:"ltr"},{name:"Portuguese (Portugal)",i18nCode:"pt-PT",direction:"ltr"},{name:"Punjabi",i18nCode:"pa",direction:"ltr"},{name:"Romanian",i18nCode:"ro",direction:"ltr"},{name:"Russian",i18nCode:"ru",direction:"ltr"},{name:"Serbian (Latin)",i18nCode:"sr-Latn-RS",direction:"ltr"},{name:"Slovak",i18nCode:"sk",direction:"ltr"},{name:"Slovenian",i18nCode:"sl",direction:"ltr"},{name:"Spanish",i18nCode:"es",direction:"ltr"},{name:"Swedish",i18nCode:"sv",direction:"ltr"},{name:"Tamil",i18nCode:"ta",direction:"ltr"},{name:"Telugu",i18nCode:"te",direction:"ltr"},{name:"Thai",i18nCode:"th",direction:"ltr"},{name:"Turkish",i18nCode:"tr",direction:"ltr"},{name:"Ukrainian",i18nCode:"uk",direction:"ltr"},{name:"Vietnamese",i18nCode:"vi",direction:"ltr"}],i9=r9.map(n=>n.i18nCode);function Xpe(n){return Lk(n)[0]??n}async function a9(n={}){const e=Dt.use(n9).use(AV);return me.instance().config().useI18nHttpApi&&$(()=>import("./index-02kl5kgv.js"),__vite__mapDeps([273,2,1])).then(t=>{e.use(t.default)}),e.init({supportedLngs:r9.map(({i18nCode:t})=>t),fallbackLng:Lk,detection:{caches:["cookie"],convertDetectedLanguage:Xpe,...n},interpolation:{escapeValue:!1}}).then(async t=>(await eme(Dt.language),Dt.on("languageChanged",r=>{typeof document<"u"&&(document.body.dir=Dt.dir(r.toLowerCase()),document.documentElement.lang=r.toLowerCase())}),t))}async function eme(n){n&&(await Promise.all(Lk(n).map(async e=>{try{const t=await Fpe(Object.assign({"../../config/strings/af/strings.json":()=>$(()=>import("./strings-Djzjondq.js"),[]),"../../config/strings/am/strings.json":()=>$(()=>import("./strings-KJKVVX9r.js"),[]),"../../config/strings/ar/strings.json":()=>$(()=>import("./strings-BRWGyaZD.js"),[]),"../../config/strings/as/strings.json":()=>$(()=>import("./strings-BTS6tPBn.js"),[]),"../../config/strings/az/strings.json":()=>$(()=>import("./strings-CZ9KrntP.js"),[]),"../../config/strings/bg/strings.json":()=>$(()=>import("./strings-BHNsCIUD.js"),[]),"../../config/strings/bn-IN/strings.json":()=>$(()=>import("./strings-CcVkULET.js"),[]),"../../config/strings/bs/strings.json":()=>$(()=>import("./strings-CDLse6pV.js"),[]),"../../config/strings/ca-Es-VALENCIA/strings.json":()=>$(()=>import("./strings-141tO6MQ.js"),[]),"../../config/strings/ca/strings.json":()=>$(()=>import("./strings-CeavSyZ8.js"),[]),"../../config/strings/cs/strings.json":()=>$(()=>import("./strings-B7K9FxvX.js"),[]),"../../config/strings/cy/strings.json":()=>$(()=>import("./strings-BYmHskyz.js"),[]),"../../config/strings/da/strings.json":()=>$(()=>import("./strings-zJ31SaEn.js"),[]),"../../config/strings/de/strings.json":()=>$(()=>import("./strings-BQGrHsH1.js"),[]),"../../config/strings/el/strings.json":()=>$(()=>import("./strings-CDCzC3vs.js"),[]),"../../config/strings/en-GB/strings.json":()=>$(()=>import("./strings-BJxvV9iK.js"),[]),"../../config/strings/en-US/strings.json":()=>$(()=>import("./strings-yznxdAdF.js"),[]),"../../config/strings/es-MX/strings.json":()=>$(()=>import("./strings-BFw0rgHR.js"),[]),"../../config/strings/es/strings.json":()=>$(()=>import("./strings-DtdNMWYR.js"),[]),"../../config/strings/et/strings.json":()=>$(()=>import("./strings-DlNMz6RI.js"),[]),"../../config/strings/eu/strings.json":()=>$(()=>import("./strings-TfPt3H9v.js"),[]),"../../config/strings/fa/strings.json":()=>$(()=>import("./strings-dMKtjqM5.js"),[]),"../../config/strings/fi/strings.json":()=>$(()=>import("./strings-3rCtdtDs.js"),[]),"../../config/strings/fil/strings.json":()=>$(()=>import("./strings-B9BYlfZS.js"),[]),"../../config/strings/fr-CA/strings.json":()=>$(()=>import("./strings-CJbKuLJA.js"),[]),"../../config/strings/fr/strings.json":()=>$(()=>import("./strings-CN7pF8sJ.js"),[]),"../../config/strings/ga/strings.json":()=>$(()=>import("./strings-Bl6hIYlH.js"),[]),"../../config/strings/gd/strings.json":()=>$(()=>import("./strings-Du00auoi.js"),[]),"../../config/strings/gl/strings.json":()=>$(()=>import("./strings-CgXzEK9E.js"),[]),"../../config/strings/gu/strings.json":()=>$(()=>import("./strings-CaFZ8NwJ.js"),[]),"../../config/strings/he/strings.json":()=>$(()=>import("./strings-B_duHdKL.js"),[]),"../../config/strings/hi/strings.json":()=>$(()=>import("./strings-BmgyUWUK.js"),[]),"../../config/strings/hr/strings.json":()=>$(()=>import("./strings-B3yQFvRv.js"),[]),"../../config/strings/hu/strings.json":()=>$(()=>import("./strings-DM6EM3qe.js"),[]),"../../config/strings/hy/strings.json":()=>$(()=>import("./strings-BcHp4qwV.js"),[]),"../../config/strings/id/strings.json":()=>$(()=>import("./strings-Dalriibp.js"),[]),"../../config/strings/is/strings.json":()=>$(()=>import("./strings-CmVOqJ-r.js"),[]),"../../config/strings/it/strings.json":()=>$(()=>import("./strings-C1Ylv27o.js"),[]),"../../config/strings/ja/strings.json":()=>$(()=>import("./strings-BaQlpgqX.js"),[]),"../../config/strings/ka/strings.json":()=>$(()=>import("./strings-64Oc8-zf.js"),[]),"../../config/strings/kk/strings.json":()=>$(()=>import("./strings-De-oogFG.js"),[]),"../../config/strings/km-KH/strings.json":()=>$(()=>import("./strings-CVxsmr4A.js"),[]),"../../config/strings/kn/strings.json":()=>$(()=>import("./strings-HbcKB0hg.js"),[]),"../../config/strings/ko/strings.json":()=>$(()=>import("./strings-Bt5kbZf3.js"),[]),"../../config/strings/kok/strings.json":()=>$(()=>import("./strings-BrPMvVFD.js"),[]),"../../config/strings/lb/strings.json":()=>$(()=>import("./strings-CqGXuYKY.js"),[]),"../../config/strings/lo/strings.json":()=>$(()=>import("./strings-BbiGY_go.js"),[]),"../../config/strings/lt/strings.json":()=>$(()=>import("./strings-CQ1UJIEP.js"),[]),"../../config/strings/lv/strings.json":()=>$(()=>import("./strings-OSb8JwoN.js"),[]),"../../config/strings/mi/strings.json":()=>$(()=>import("./strings-BoVi6YC_.js"),[]),"../../config/strings/mk/strings.json":()=>$(()=>import("./strings-BkadsgyD.js"),[]),"../../config/strings/ml/strings.json":()=>$(()=>import("./strings-DaI0uGyl.js"),[]),"../../config/strings/mr/strings.json":()=>$(()=>import("./strings-DkhJ6vxm.js"),[]),"../../config/strings/ms/strings.json":()=>$(()=>import("./strings-CNUhWDwP.js"),[]),"../../config/strings/mt/strings.json":()=>$(()=>import("./strings-Dr_zJB90.js"),[]),"../../config/strings/nb-NO/strings.json":()=>$(()=>import("./strings-CYkpd_aj.js"),[]),"../../config/strings/ne/strings.json":()=>$(()=>import("./strings-JoTBvwxi.js"),[]),"../../config/strings/nl/strings.json":()=>$(()=>import("./strings-CmL9ADyq.js"),[]),"../../config/strings/nn-NO/strings.json":()=>$(()=>import("./strings-BpCxYmuo.js"),[]),"../../config/strings/or/strings.json":()=>$(()=>import("./strings-BEi2gRP_.js"),[]),"../../config/strings/pa/strings.json":()=>$(()=>import("./strings-W4fdplJE.js"),[]),"../../config/strings/pl/strings.json":()=>$(()=>import("./strings-DPKWqs5m.js"),[]),"../../config/strings/pt-BR/strings.json":()=>$(()=>import("./strings-CmZpS_pP.js"),[]),"../../config/strings/pt-PT/strings.json":()=>$(()=>import("./strings-952jNAKJ.js"),[]),"../../config/strings/quz/strings.json":()=>$(()=>import("./strings-r1t7eXGL.js"),[]),"../../config/strings/ro/strings.json":()=>$(()=>import("./strings-Cyn-yCcX.js"),[]),"../../config/strings/ru/strings.json":()=>$(()=>import("./strings-CnTDH7VI.js"),[]),"../../config/strings/sk/strings.json":()=>$(()=>import("./strings-BERwe4vf.js"),[]),"../../config/strings/sl/strings.json":()=>$(()=>import("./strings-CvOAIb_e.js"),[]),"../../config/strings/sq/strings.json":()=>$(()=>import("./strings-Y5YbnI9_.js"),[]),"../../config/strings/sr-Cyrl-BA/strings.json":()=>$(()=>import("./strings-Cwt-CHsc.js"),[]),"../../config/strings/sr-Cyrl-RS/strings.json":()=>$(()=>import("./strings-IKYApvrh.js"),[]),"../../config/strings/sr-Latn-RS/strings.json":()=>$(()=>import("./strings-BPkY1RA1.js"),[]),"../../config/strings/sv/strings.json":()=>$(()=>import("./strings-CHyJbn28.js"),[]),"../../config/strings/ta/strings.json":()=>$(()=>import("./strings-BcV28htu.js"),[]),"../../config/strings/te/strings.json":()=>$(()=>import("./strings-BDNNerVX.js"),[]),"../../config/strings/th/strings.json":()=>$(()=>import("./strings-CiUERc_K.js"),[]),"../../config/strings/tr/strings.json":()=>$(()=>import("./strings-MpeNlxuF.js"),[]),"../../config/strings/tt/strings.json":()=>$(()=>import("./strings-C5fE09aF.js"),[]),"../../config/strings/ug/strings.json":()=>$(()=>import("./strings-CbU5-cJ-.js"),[]),"../../config/strings/uk/strings.json":()=>$(()=>import("./strings-CvvAVARI.js"),[]),"../../config/strings/ur/strings.json":()=>$(()=>import("./strings-DxgqqflL.js"),[]),"../../config/strings/uz-Latn-UZ/strings.json":()=>$(()=>import("./strings-DY95t6N3.js"),[]),"../../config/strings/vi/strings.json":()=>$(()=>import("./strings-BLOemHIv.js"),[]),"../../config/strings/zh-Hans/strings.json":()=>$(()=>import("./strings-BsbbLHNX.js"),[]),"../../config/strings/zh-Hant/strings.json":()=>$(()=>import("./strings-DhjeCBck.js"),[])}),`../../config/strings/${e}/strings.json`,6);Dt.addResourceBundle(e,"translation",t,!0,!0)}catch{console.warn(`Translation file for '${e}' not found.`)}})),await Dt.changeLanguage(n))}function V4e(){return Dt.resolvedLanguage?Dt.resolvedLanguage.split("-")[0]==="en":!1}function Lk(n){const e="en-US";if(!n)return[e];const t=tme(n),r=nme(n),i=rme(n);return[t,r,i,e].filter(a=>!!a).filter((a,o,s)=>s.indexOf(a)===o)}function tme(n){return i9.find(e=>e.toLowerCase()===n.toLowerCase())}function nme(n){if(["en-AU","en-NZ","en-IE"].includes(n))return"en-GB";if(n.startsWith("zh-")){const e=n.toLocaleLowerCase();return e==="zh-TW".toLocaleLowerCase()||e==="zh-HK".toLocaleLowerCase()?"zh-Hant":"zh-Hans"}}function rme(n){var t;const e=(t=n.split("-")[0])==null?void 0:t.toLowerCase();if(e){const r=i9.find(i=>i.toLowerCase()===e||i.toLowerCase().startsWith(`${e}-`));if(r)return r}}async function ime(n){try{return(await Tn(`/conversations/${n}/history`,t3,{analytics:{anonymousPath:"/conversations/*/history"}}).then(t=>t.data)).results.length>0}catch{return!1}}const G4e=O([]),ame=O(null);function ome(n){return/\/gallery\/\w+/.test(n)}async function sme(n){const{id:e,isLiked:t}=n,r=await wa(`/gallery/${e}/react/like`,{options:{method:t?"POST":"DELETE"},analytics:{anonymousPath:"/gallery/*"}});if(!r.ok)throw new Error("Failed to fetch Gallery Like data");return r}async function K4e(n){try{const{id:e,isLiked:t,scenario:r}=n;nt({source:t?"like":"unlike",scenario:r,customData:JSON.stringify({eventInfo_galleryArtifactId:e})}),await sme(n)}catch{}}async function q4e(n,e,t="/gallery"){dt().set(ame,n);const{id:i}=e;await cm({from:t,to:`/gallery/${i}`})}function o9(){const n=Bt();return s9(n)}function s9(n){return/^\/shares\/[a-zA-Z0-9_-]+$/.test(n)}async function cme(n){const{conversationIdFromUrl:e,conversationIdFromStart:t}=n;return e&&e!=="new"&&await ime(e)?{conversationId:e,isNew:!1}:t?{conversationId:t,isNew:!0}:{conversationId:null,isNew:!0}}async function lme(n){const{pathname:e,conversationIdFromUrl:t,conversationFromUrlExists:r,urlPrompt:i,features:a,isBanned:o,enablePageRedirect:s,deepLinkTarget:c,search:u}=n;if(!s||o||_k(a)||navigator.userAgent.toLowerCase().includes("googlebot")&&e==="/")return null;if(i||t==="new")return{to:c==="audioCall"?"/chats/$conversationId/talk":"/chats/$conversationId",from:e,needsConversationId:!0};if(e.startsWith("/shares"))return e.startsWith("/shares/pages")?a.includes("pages")&&!a.includes("kill-shared-page")?null:gn(e):e.startsWith("/shares/podcasts")?null:e.startsWith("/shares/3d-generations")?a.includes("kill-share-3d-generations")?gn(e):null:a.includes("kill-share-conversation")||!s9(e)?gn(e):null;if(e.startsWith("/campaigns"))if(e.startsWith("/campaigns/gallery")){if(!a.includes("share-campaign-gallery"))return gn(e)}else if(e.startsWith("/campaigns/image-expression-tool")){if(!a.includes("gallery-expression-tool"))return gn(e)}else return a.includes("share-campaign")?null:gn(e);if(["/pro/subscribe","/pro/ewallet/return"].includes(e)||e==="/fang")return null;if(e.startsWith("/referrals")&&!a.includes("user-referral")||e.startsWith("/connector")&&!a.includes("google-drive-connector")||e.startsWith("/subscription")&&!a.includes("cmc-m365-sku"))return gn(e);if(e.startsWith("/memory/narrative"))return a.includes("memory-narrative")?null:gn(e);if(e.endsWith("/talk"))return e.startsWith("/labs/portrait/talk")&&a.includes("labs-portrait-enabled")?{from:e,to:"/labs/portrait",needsConversationId:!1}:gn(e);if(e.startsWith("/chats")&&!r)return gn(e);if(e.startsWith("/pages"))return a.includes("pages")?null:gn(e);if(e.startsWith("/labs")&&(e.startsWith("/labs/portrait")&&!a.includes("labs-portrait-enabled")||e.startsWith("/labs/career-coach")&&!a.includes("labs-career-coach")||e.startsWith("/labs/audio-expression")&&!a.includes("labs-audio-expression")||!me.instance().config().enableLabs)||e.startsWith("/login"))return gn(e);if(e.startsWith("/podcasts"))return e.startsWith("/podcasts/user")||e.startsWith("/podcasts/public")?null:gn(e);if(e.startsWith("/library")&&!a.includes("library"))return gn(e);if(e.includes("/w/landing"))return a.includes("cmc-landing")?null:gn(e);if(e==="/"){if(a.includes("start-in-voice"))return null;const h=u==null?void 0:u.get("back");return ume(h)&&me.instance().config().redirectBackEnabled?{from:"/login",to:new URL(h).pathname,needsConversationId:!1}:gn(e)}return ome(e)?a.includes("kill-gallery-detail")?gn(e):null:e.startsWith("/gallery")?a.includes("creator-gallery")?null:gn(e):null}function ume(n){if(!n)return!1;try{if(new URL(n).origin===window.location.origin)return!0;throw new Error("Invalid redirect URL: not from same origin")}catch{throw new Error("Invalid redirect URL, malformed URL")}}function gn(n){return me.instance().config().neverStartInChat?{from:n,to:"/"}:{from:n,to:"/chats/$conversationId",needsConversationId:!0}}function dme(){try{const{timeZone:n}=Intl.DateTimeFormat().resolvedOptions();return n}catch{return}}function hme(n){return e=>{const r=(n?Math[n]:Math.trunc)(e);return r===0?0:r}}const fme=864e5,W4e=6e4,pme=36e5,Y4e=43200,Q4e=1440,J4e=60;function mme(n,e){return+cn(n)-+cn(e)}function gme(n,e,t){const r=mme(n,e)/pme;return hme(t==null?void 0:t.roundingMethod)(r)}function Dk(n){if(!n)return null;let e=null;const t=new Date(n).toISOString(),r=new Date().toISOString(),i=gme(t,r,{roundingMethod:"ceil"});return i>24?e="permanent":i>1&&i<=24?e="24-hr":i>0&&i<=1&&(e="1-hr"),e}function jk(n,e,t){if(!n){ur(a1);return}const r=dt();H.trackEvent({name:"system",data:{eventName:"copilotUserBan",eventInfo_banDuration:n,eventInfo_banSource:e,eventInfo_banExpiryTimestamp:t}}),r.set(U3,n),r.set(Cp,"user-banned")}const vme=oW(),zE=1e4;function bme(){return setTimeout(()=>{Zn({feature:"start",scenario:"callStartTimeout",errorType:"timeout",errorMessage:`Start call exceeded ${zE}ms timeout`})},zE)}async function yme(n){let e=$o("sessionId");const t=$o("referralCode");!e&&t&&(e=crypto.randomUUID(),$s("sessionId",e));const r=Ppe(),i={timeZone:dme(),startNewConversation:!0,teenSupportEnabled:!0,deviceFingerprint:e??void 0,referralCode:t??void 0,correctPersonalizationSetting:!0,performUserMerge:r,deferredDataUseCapable:!0},a={};vme&&(a.overrideFeatures="1");const s=dr(l1,l.boolean())?{maxRetries:3,initialDelayMs:100,maxDelayMs:500,backoffFactor:2,jitterFactor:.1}:void 0,{data:c,response:u,zodError:h}=await Tn(n,yX,{options:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)},parseOptions:{safe:!0},query:a,...s&&{retry:s},requestTimeoutMs:zE});if(gp.trackClientExperimentationAssignment(u.headers),gp.trackLatestApiAssignment(u.headers),u.status===BT)throw new Error(HT);if(h)throw h;return c}function c9(){const{i18n:n}=Ce(),{showBoundary:e}=H5(),t=pe(Cp),r=pe(Y5),i=pe(Sn),a=pe(OI),o=pe(ol),s=pe(lt),c=pe(B3),u=pe(hI),h=pe(z3),f=Ta(),[p]=yC(),g=Bt(),v=m.useRef(g);v.current=g;const y=PT({strict:!1}),b=m.useRef(y);b.current=y;const C=m.useRef(Xq()),S=N(ym),E=m.useRef(S);E.current=S;const T=m.useRef(!0),A=m.useRef(!1),{trigger:I}=iI("/start",yme);return m.useCallback(async k=>{var z;if(!n.language||A.current&&!k.eventDriven)return!1;A.current=!0;const x=mpe(),{enablePageRedirect:_,overwriteData:R}=k;try{const j=bme(),{isNewUser:J,banExpiresAt:D,remainingTurns:F,features:ie,currentConversationId:U,allowBeta:W,userId:ue,inDataUseWaitingPeriod:te}=await I();clearTimeout(j),await a9(),_t.emit("app:start-complete");const Z=H.getPicassoId();Z!==null&&ue!==null&&Z!==ue&&H.trackEvent({name:"health",data:{eventName:"userIdMismatch",eventInfo_customData:JSON.stringify({existingPicassoId:Z,newPicassoId:ue??"",origin:"start"})}}),H.setFeatures(ie),H.setIsNewUser(J),$E({isNewUser:J.toString()});const Q=z8({featureOverrides:[],localFeatureOverrides:V8(),serverFeatures:ie,surfaceConfig:me.instance().config()});Q.includes("kill-picasso-id-on-start")||H.setPicassoId(ue??null),Q.includes("eager-msal")&&(ca(c1,l.boolean(),!0),Q.includes("msal-silent-sso")&&ca(NL,l.boolean(),!0)),Q.includes("kill-eager-msal")&&ur(c1),Q.includes("auth-module-refactor")?ca(fM,l.boolean(),!0):ur(fM),Q.includes("auth-rf-init-auth-account")?ca(h1,l.boolean(),!0):ur(h1),Q.includes("auth-rf-msal-event-removal")?ca(f1,l.boolean(),!0):ur(f1),Q.includes("start-retry")?ca(l1,l.boolean(),!0):ur(l1);const Ie=Dk(D),Ve=_k(Q),ce=await cme({conversationIdFromUrl:Ve?void 0:b.current.conversationId,conversationIdFromStart:Ve?void 0:U});let{conversationId:le}=ce;if(!le){const{id:We}=await Y8("/conversations",{arg:{isPrivate:Ve}});le=We,Ve&&a(We)}const De=await lme({pathname:v.current,conversationIdFromUrl:b.current.conversationId,conversationFromUrlExists:b.current.conversationId===le,urlPrompt:((z=E.current)==null?void 0:z.prompt)??null,features:Q,enablePageRedirect:_,isBanned:!!Ie,deepLinkTarget:p,search:new URLSearchParams(window.location.search)});i(We=>{if(!R&&We.size>0)return We;const be=new Map([[le,{id:le,updatedAt:new Date().toISOString(),history:[],isNew:ce.isNew,characterId:null,streamingState:"idle",continuedAt:null}]]);return!ce.isNew&&U&&be.set(U,{id:U,updatedAt:new Date().toISOString(),history:[],isNew:!0,characterId:null,streamingState:"idle",continuedAt:null}),be}),s(We=>We&&!R?We:le),r(We=>We.length>0&&!R?We:Q),o(F),c(J),h(te??null),u(W??!1),W&&Dpe(),jk(Ie,"start",D),T.current&&(T.current=!1,De&&await f({...De,params:De.needsConversationId?{conversationId:le}:{},search:C.current}))}catch(j){if(H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"StartEndpointError",eventInfo_errorMessage:j instanceof Error?j.message:"",eventInfo_details:j instanceof Error?j.stack??"":""}}),j instanceof Error&&j.message===HT)return t("age-verification"),!0;console.error(j),e(j)}finally{jpe(!1)}return!0},[I,i,s,a,t,r,o,c,u,h,f,n.language,e,p])}const xP=kl.use||(n=>{if(n.status==="pending")throw n;if(n.status==="fulfilled")return n.value;throw n.status==="rejected"?n.reason:(n.status="pending",n.then(e=>{n.status="fulfilled",n.value=e},e=>{n.status="rejected",n.reason=e}),n)}),tw={dedupe:!0},Cme=(n,e,t)=>{const{cache:r,compare:i,suspense:a,fallbackData:o,revalidateOnMount:s,revalidateIfStale:c,refreshInterval:u,refreshWhenHidden:h,refreshWhenOffline:f,keepPreviousData:p}=t,[g,v,y,b]=Di.get(r),[C,S]=Bo(n),E=m.useRef(!1),T=m.useRef(!1),A=m.useRef(C),I=m.useRef(e),k=m.useRef(t),x=()=>k.current,_=()=>x().isVisible()&&x().isOnline(),[R,z,j,J]=Ba(r,C),D=m.useRef({}).current,F=He(o)?t.fallback[C]:o,ie=(M,Y)=>{for(const Se in D){const P=Se;if(P==="data"){if(!i(M[P],Y[P])&&(!He(M[P])||!i(ce,Y[P])))return!1}else if(Y[P]!==M[P])return!1}return!0},U=m.useMemo(()=>{const M=!C||!e?!1:He(s)?x().isPaused()||a?!1:He(c)?!0:c:s,Y=q=>{const Te=wi(q);return delete Te._k,M?{isValidating:!0,isLoading:!0,...Te}:Te},Se=R(),P=J(),ne=Y(Se),ye=Se===P?ne:Y(P);let ae=ne;return[()=>{const q=Y(R());return ie(q,ae)?(ae.data=q.data,ae.isLoading=q.isLoading,ae.isValidating=q.isValidating,ae.error=q.error,ae):(ae=q,q)},()=>ye]},[r,C]),W=my.useSyncExternalStore(m.useCallback(M=>j(C,(Y,Se)=>{ie(Se,Y)||M()}),[r,C]),U[0],U[1]),ue=!E.current,te=g[C]&&g[C].length>0,Z=W.data,Q=He(Z)?F:Z,Ie=W.error,Ve=m.useRef(Q),ce=p?He(Z)?Ve.current:Z:Q,le=te&&!He(Ie)?!1:ue&&!He(s)?s:x().isPaused()?!1:a?He(Q)?!1:c:He(Q)||c,De=!!(C&&e&&ue&&le),We=He(W.isValidating)?De:W.isValidating,be=He(W.isLoading)?De:W.isLoading,Me=m.useCallback(async M=>{const Y=I.current;if(!C||!Y||T.current||x().isPaused())return!1;let Se,P,ne=!0;const ye=M||{},ae=!y[C]||!ye.dedupe,q=()=>rl?!T.current&&C===A.current&&E.current:C===A.current,Te={isValidating:!1,isLoading:!1},ze=()=>{z(Te)},ht=()=>{const Ye=y[C];Ye&&Ye[1]===P&&delete y[C]},vt={isValidating:!0};He(R().data)&&(vt.isLoading=!0);try{if(ae&&(z(vt),t.loadingTimeout&&He(R().data)&&setTimeout(()=>{ne&&q()&&x().onLoadingSlow(C,t)},t.loadingTimeout),y[C]=[Y(S),il()]),[Se,P]=y[C],Se=await Se,ae&&setTimeout(ht,t.dedupingInterval),!y[C]||y[C][1]!==P)return ae&&q()&&x().onDiscarded(C),!1;Te.error=pn;const Ye=v[C];if(!He(Ye)&&(P<=Ye[0]||P<=Ye[1]||Ye[1]===0))return ze(),ae&&q()&&x().onDiscarded(C),!1;const st=R().data;Te.data=i(st,Se)?st:Se,ae&&q()&&x().onSuccess(Se,C,t)}catch(Ye){ht();const st=x(),{shouldRetryOnError:Ot}=st;st.isPaused()||(Te.error=Ye,ae&&q()&&(st.onError(Ye,C,st),(Ot===!0||Br(Ot)&&Ot(Ye))&&(!x().revalidateOnFocus||!x().revalidateOnReconnect||_())&&st.onErrorRetry(Ye,C,st,Yt=>{const on=g[C];on&&on[0]&&on[0](Hr.ERROR_REVALIDATE_EVENT,Yt)},{retryCount:(ye.retryCount||0)+1,dedupe:!0})))}return ne=!1,ze(),!0},[C,r]),xe=m.useCallback((...M)=>vy(r,A.current,...M),[]);if(Hi(()=>{I.current=e,k.current=t,He(Z)||(Ve.current=Z)}),Hi(()=>{if(!C)return;const M=Me.bind(pn,tw);let Y=0;const P=rI(C,g,(ne,ye={})=>{if(ne==Hr.FOCUS_EVENT){const ae=Date.now();x().revalidateOnFocus&&ae>Y&&_()&&(Y=ae+x().focusThrottleInterval,M())}else if(ne==Hr.RECONNECT_EVENT)x().revalidateOnReconnect&&_()&&M();else{if(ne==Hr.MUTATE_EVENT)return Me();if(ne==Hr.ERROR_REVALIDATE_EVENT)return Me(ye)}});return T.current=!1,A.current=C,E.current=!0,z({_k:S}),le&&(He(Q)||Fo?M():XT(M)),()=>{T.current=!0,P()}},[C]),Hi(()=>{let M;function Y(){const P=Br(u)?u(R().data):u;P&&M!==-1&&(M=setTimeout(Se,P))}function Se(){!R().error&&(h||x().isVisible())&&(f||x().isOnline())?Me(tw).then(Y):Y()}return Y(),()=>{M&&(clearTimeout(M),M=-1)}},[u,h,f,C]),m.useDebugValue(ce),a&&He(Q)&&C){if(!rl&&Fo)throw new Error("Fallback data is required when using suspense in SSR.");I.current=e,k.current=t,T.current=!1;const M=b[C];if(!He(M)){const Y=xe(M);xP(Y)}if(He(Ie)){const Y=Me(tw);He(ce)||(Y.status="fulfilled",Y.value=!0),xP(Y)}else throw Ie}return{mutate:xe,get data(){return D.data=!0,ce},get error(){return D.error=!0,Ie},get isValidating(){return D.isValidating=!0,We},get isLoading(){return D.isLoading=!0,be}}},Zl=nI(Cme);function Sme(){const{cache:n,mutate:e}=tI(),t=m.useCallback(async()=>{for(const i of n.keys())await e(i,void 0,{revalidate:!1})},[n,e]),r=m.useCallback(async i=>{await e(i,void 0,{revalidate:!1})},[e]);return{clearAllSWRCache:t,clearOneSWRCache:r}}function l9(){ur(i1),ur(Ld),ur(Ey)}function wme(){ur(OL),l9()}function Sh(){const n=c9(),e=Bt(),t=Ta(),{clearAllSWRCache:r}=Sme(),i=async s=>{const{provider:c,opts:u={},onAuthComplete:h,onAuthError:f}=s;l9(),await Wo.instance().logIn(c,u).catch(p=>{console.error(p),f==null||f()})},a=async(s=!0)=>{await r(),wme(),Rpe(),await Wo.instance().logOut().then(async()=>{s&&(await t({to:"/",from:e}),await n({enablePageRedirect:!1,overwriteData:!0}))})};return{login:i,logout:a,switchMicrosoftAccount:async()=>{await a(),await i({provider:"microsoft"})}}}function Eme({accountActionRequired:n,onReload:e}){const{t}=Ce(),r=xl(),{login:i}=Sh(),{reason:a,provider:o,loginHint:s}=n,c=async p=>{nt({source:"sessionExpired",scenario:"continueWithMicrosoftWithLoginHint",destination:"continueWithMicrosoftRedirect"}),FS({authWorkflowAccountType:"microsoft",apiName:"msal:reauthStart"});const{msal:g}=await Er.get();await g.acquireTokenRedirect({...QT,loginHint:p,account:g.getAccountByUsername(p)??void 0,prompt:void 0})},u=async()=>{if(a==="token-expired"&&n.provider==="microsoft"){const{msal:p}=await Er.get();if(!$e("auth-rf-logout-clear"))await p.clearCache();else{const g=p.getActiveAccount();await p.clearCache({account:g})}}},h=async(p,g)=>{await u();let v="";switch(p==="microsoft"?(v="MSA",FS({authWorkflowAccountType:"microsoft",apiName:"msal:reauthStart"})):p==="auth0"&&(v=(g==null?void 0:g.connection)==="apple"?"Apple":"Google",FS({authWorkflowAccountType:(g==null?void 0:g.connection)??"google",apiName:mi.REAUTH_START})),nt({source:"sessionExpired",scenario:`continueWith${v}`,destination:`continueWith${v}Redirect`}),p){case"microsoft":i({provider:p});break;case"auth0":i({provider:p,opts:g});break}},f=async()=>{bn({source:"signin",scenario:"sessionExpired"}),await u(),i({provider:"microsoft"})};return d.jsxs(d.Fragment,{children:[d.jsx("h1",{className:"pb-3 text-lg",children:t("authentication.sessionExpired")}),d.jsx("p",{className:"pb-7",children:t("authentication.sessionExpiredMessage")}),a==="token-expired"&&o==="microsoft"&&s&&d.jsx(Ee,{onClick:()=>c(s),title:`${t("signInPrompt.continueAs",{name:s})}`,variant:"pill",size:"48-lg",className:"w-full",children:`${t("signInPrompt.continueAs",{name:s})}`}),r?d.jsxs(d.Fragment,{children:[d.jsxs(Ee,{onClick:()=>h("microsoft"),title:t("signInPrompt.continueWithMicrosoft"),variant:"pill",size:"48-lg",className:"mt-3 w-full",children:[d.jsx(py,{className:"size-6"}),t("signInPrompt.continueWithMicrosoft")]}),d.jsxs(Ee,{onClick:()=>h("auth0",{connection:"apple"}),title:t("signInPrompt.continueWithApple"),variant:"pill",size:"48-lg",className:"mt-3 w-full",children:[d.jsx(WT,{className:"size-6 text-black dark:text-white"}),t("signInPrompt.continueWithApple")]}),d.jsxs(Ee,{onClick:()=>h("auth0",{connection:"google"}),title:t("signInPrompt.continueWithGoogle"),variant:"pill",size:"48-lg",className:"mt-3 w-full",children:[d.jsx(YT,{className:"size-6"}),t("signInPrompt.continueWithGoogle")]})]}):d.jsx(Ee,{onClick:f,title:t("common.loginText"),variant:"pill",size:"48-lg",className:"mt-3 w-full",children:t("common.loginText")}),d.jsx(Ee,{onClick:e,title:t("signInPrompt.continueWithoutSignIn"),variant:"pill",color:"subtle-dimmed-inverted",size:"48-lg",className:"mt-3 w-full",children:t("signInPrompt.continueWithoutSignIn")})]})}const Tme=n=>n;function wC(n=Tme){const e=m.useRef(null);return m.useEffect(()=>{const t=typeof document<"u"?document:void 0,r=t==null?void 0:t.defaultView;if(!r)return()=>{};const i=Rz(r,{autoRoot:{}});return e.current=n(i),()=>{Pz(i),e.current=null}},[n]),e}const $b=n=>{wC();const e=Nz(n,!0);return m.useMemo(()=>({[Oz]:e}),[e])},Ime="data-tabster-never-hide",Ame=n=>n.hasAttribute(Ime);function kme(n){Lz(n,void 0,Ame),Dz(n)}const EC=(n={})=>{const{trapFocus:e,alwaysFocusable:t,legacyTrapFocus:r}=n;wC(kme);const i=m.useId(),a=n.id??`modal-${i}`,o=$b({restorer:{type:D_.Source},...e&&{modalizer:{id:a,isOthersAccessible:!e,isAlwaysAccessible:t,isTrapped:!!r&&!!e}}}),s=$b({restorer:{type:D_.Target}});return{modalAttributes:o,triggerAttributes:s}},Uk={type:"spring",mass:.5,stiffness:450,damping:35},xme={type:"spring",mass:.5,stiffness:450,damping:35},Z4e={type:"spring",mass:1.8,stiffness:440,damping:40},VE={type:"spring",mass:1.4,stiffness:320,damping:40},u9={type:"spring",mass:1,stiffness:1200,damping:40},d9={type:"spring",mass:1.8,stiffness:640,damping:40},X4e={type:"spring",mass:3.2,stiffness:640,damping:40},Vi={type:"spring",mass:.5,stiffness:450,damping:35},_P={duration:1.2,ease:"easeInOut",repeat:3,repeatType:"reverse",type:"tween"},h9=.2,f9=.25,_me=1.5,Mme=[.16,1,.3,1];function Rme(n,e){const{children:t,id:r,eleId:i,labelById:a,role:o,className:s,mode:c="wait",duration:u=Ei.default,exitDuration:h=Ei.default,exitDelay:f=0,delay:p=0,delayChildren:g=0,onAnimationComplete:v,"data-testid":y,initial:b="initial"}=n;return d.jsx(Mn,{mode:c,children:t&&d.jsx(_e.div,{id:i,"aria-labelledby":a,animate:"animate",exit:"exit",ref:e,role:o,initial:b,variants:{initial:ct,animate:Rt,exit:{...ct,transition:{duration:h,delay:f}}},transition:{duration:u,ease:"easeInOut",delay:p,delayChildren:g},className:s,onAnimationComplete:v,"data-testid":y,children:t},r)})}const On=m.forwardRef(Rme),Em=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M4.20889 10.7327C3.9232 11.0326 3.93475 11.5074 4.23467 11.7931C4.5346 12.0788 5.00933 12.0672 5.29502 11.7673L11.2495 5.516V20.25C11.2495 20.6642 11.5853 21 11.9995 21C12.4137 21 12.7495 20.6642 12.7495 20.25V5.51565L18.7043 11.7673C18.99 12.0672 19.4648 12.0788 19.7647 11.7931C20.0646 11.5074 20.0762 11.0326 19.7905 10.7327L12.7238 3.31379C12.5627 3.14474 12.3573 3.04477 12.1438 3.01386C12.0971 3.00477 12.0489 3 11.9995 3C11.9498 3 11.9012 3.00483 11.8543 3.01406C11.6412 3.04518 11.4363 3.14509 11.2756 3.31379L4.20889 10.7327Z"})),eje=Object.freeze(Object.defineProperty({__proto__:null,default:Em},Symbol.toStringTag,{value:"Module"})),vr=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M4.39705 4.55379L4.46967 4.46967C4.73594 4.2034 5.1526 4.1792 5.44621 4.39705L5.53033 4.46967L12 10.939L18.4697 4.46967C18.7626 4.17678 19.2374 4.17678 19.5303 4.46967C19.8232 4.76256 19.8232 5.23744 19.5303 5.53033L13.061 12L19.5303 18.4697C19.7966 18.7359 19.8208 19.1526 19.6029 19.4462L19.5303 19.5303C19.2641 19.7966 18.8474 19.8208 18.5538 19.6029L18.4697 19.5303L12 13.061L5.53033 19.5303C5.23744 19.8232 4.76256 19.8232 4.46967 19.5303C4.17678 19.2374 4.17678 18.7626 4.46967 18.4697L10.939 12L4.46967 5.53033C4.2034 5.26406 4.1792 4.8474 4.39705 4.55379L4.46967 4.46967L4.39705 4.55379Z",fill:"currentColor"})),tje=Object.freeze(Object.defineProperty({__proto__:null,default:vr},Symbol.toStringTag,{value:"Module"}));function wh(){const[n,e]=m.useState(document.body.dir==="rtl");return m.useEffect(()=>{const t=new MutationObserver(()=>{e(document.body.dir==="rtl")});return t.observe(document.body,{attributes:!0,attributeFilter:["dir"]}),()=>t.disconnect()},[]),n}const nw=Ei.default,Gi=m.forwardRef((n,e)=>{const{isOpen:t,onBack:r,headerText:i,children:a,onClose:o,className:s,disableCloseOutside:c,headerTextClassName:u,headerClassName:h,trapFocus:f=!1,variant:p="modal"}=n,{t:g}=Ce(),v=m.useId(),{modalAttributes:y}=EC({trapFocus:f,legacyTrapFocus:f,alwaysFocusable:f}),b=f?y:{},C=wh()?-1:1,S=I=>{(c??!o)||I.target===I.currentTarget&&o()},E=I=>{I.stopPropagation()},T=p==="drawer",A=T?{initial:{x:`${C*100}%`},animate:{x:0,transition:VE},exit:{x:`${C*100}%`,transition:{duration:nw}}}:void 0;return d.jsx(On,{id:String(t),mode:"sync",duration:nw,exitDuration:nw,className:X("fixed inset-0",$t.modal),children:t&&d.jsxs("div",{...b,role:"dialog","aria-modal":"true","aria-labelledby":i?v:void 0,children:[d.jsx("div",{className:X("fixed inset-0 bg-stone-850/30 backdrop-blur-[10px] dark:bg-midnight-850/70",$t.modalBackground)}),d.jsx("div",{className:X("fixed inset-0 flex",T?"items-start justify-end":"items-center justify-center",$t.modal),onClick:S,children:d.jsxs(_e.div,{...A,className:ke("t-custom-scrollbar flex flex-col gap-3 border border-white/10 bg-background-150 p-6 shadow-xl dark:bg-background-250",T?"h-full w-96":"min-h-[150px] rounded-4xl",s),onClick:E,ref:I=>{typeof e=="function"?e(I):e&&(e.current=I)},children:[d.jsxs("div",{className:X("flex items-center justify-between gap-2",h),children:[r&&d.jsx(Ee,{variant:"square",color:"subtle-dimmed-inverted",size:"32-xs",title:g("common.backText"),"aria-label":g("common.backText"),onClick:r,children:d.jsx(Em,{className:"size-5 -rotate-90"})}),i&&d.jsx("h2",{id:v,className:X("text-foreground-800 text-md-strong",u),children:i}),o&&d.jsx(Ee,{className:!r&&!i?"ms-auto":"",variant:"square",color:"subtle-dimmed-inverted",size:"32-xs",title:g("common.closeText"),"aria-label":g("common.closeText"),onClick:o,children:d.jsx(vr,{className:"size-5"})})]}),a]})})]})})});Gi.displayName="Modal";function p9(n){const{accountActionRequired:e}=n;return d.jsx(Gi,{isOpen:!0,children:d.jsx(Pme,{accountActionRequired:e})})}function Pme(n){const{accountActionRequired:e}=n,{reason:t}=e;m.useEffect(()=>{H.trackEvent({name:"system",data:{eventName:"copilotWebBackgroundAccountChange",eventInfo_action:"shown",eventInfo_reason:t}})},[t]);const r=async()=>{if(H.trackEvent({name:"system",data:{eventName:"copilotWebBackgroundAccountChange",eventInfo_action:"reload",eventInfo_reason:t}}),t==="token-expired"&&e.provider==="microsoft"){const{msal:i}=await Er.get();if(!$e("auth-rf-logout-clear"))await i.clearCache();else{const a=i.getActiveAccount();await i.clearCache({account:a})}}Sm()};return t==="login"||t==="logout"?d.jsx("div",{className:"flex max-w-72 flex-col items-center p-1 text-center",children:d.jsx(HK,{reason:t,onReload:r})}):d.jsx("div",{className:"flex max-w-96 flex-col items-center p-1 text-center",children:d.jsx(Eme,{accountActionRequired:e,onReload:r})})}function Nme(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function Ome(n){if(!Nme(n)&&typeof n!="number")return!1;const e=cn(n);return!isNaN(Number(e))}function m9(n,e){const t=cn(n);if(isNaN(e))return p1(n,NaN);if(!e)return t;const r=t.getDate(),i=p1(n,t.getTime());i.setMonth(t.getMonth()+e+1,0);const a=i.getDate();return r>=a?i:(t.setFullYear(i.getFullYear(),i.getMonth(),r),t)}function Lme(n,e){return m9(n,e*12)}function Dme(n,e){return Lme(n,-13)}function el(n,e,t="en-US"){var i,a;let r;if(n instanceof Date)r=n;else if(typeof n=="number")r=new Date(n<1e12?n*1e3:n);else if(typeof n=="string")r=new Date(n);else throw new Error(`Invalid date input: ${n}`);if(Number.isNaN(r.getTime()))throw new Error(`Invalid date: ${String(n)}`);switch(e){case"yyyyMMdd":{const o=r.getFullYear(),s=(r.getMonth()+1).toString().padStart(2,"0"),c=r.getDate().toString().padStart(2,"0");return`${o}${s}${c}`}case"yyyyMMdd_HHmmss":{const o=r.getFullYear(),s=(r.getMonth()+1).toString().padStart(2,"0"),c=r.getDate().toString().padStart(2,"0"),u=r.getHours().toString().padStart(2,"0"),h=r.getMinutes().toString().padStart(2,"0"),f=r.getSeconds().toString().padStart(2,"0");return`${o}${s}${c}_${u}${h}${f}`}case"h:mm aa":case"h:mm a":return new Intl.DateTimeFormat(t,{hour:"numeric",minute:"2-digit",hour12:!0}).format(r);case"h":return((i=new Intl.DateTimeFormat(t,{hour:"numeric",hour12:!0}).formatToParts(r).find(c=>c.type==="hour"))==null?void 0:i.value)??"";case"mm":return new Intl.DateTimeFormat(t,{minute:"2-digit"}).format(r).padStart(2,"0");case"a":return((a=new Intl.DateTimeFormat(t,{hour:"numeric",hour12:!0}).formatToParts(r).find(c=>c.type==="dayPeriod"))==null?void 0:a.value)??"";case"PP":return new Intl.DateTimeFormat(t,{year:"numeric",month:"short",day:"numeric"}).format(r);case"EEEE":return new Intl.DateTimeFormat(t,{weekday:"long"}).format(r);case"eeee":return new Intl.DateTimeFormat(t,{weekday:"long"}).format(r);case"MMMM":return new Intl.DateTimeFormat(t,{month:"long"}).format(r);case"d":return r.getDate().toString();case"MM/dd":{const o=(r.getMonth()+1).toString().padStart(2,"0"),s=r.getDate().toString().padStart(2,"0");return`${o}/${s}`}case"MMM d":return new Intl.DateTimeFormat(t,{month:"short",day:"numeric"}).format(r);case"MMM":return new Intl.DateTimeFormat(t,{month:"short"}).format(r);case"eee, MMM d":return new Intl.DateTimeFormat(t,{weekday:"short",month:"short",day:"numeric"}).format(r);case"eee":return new Intl.DateTimeFormat(t,{weekday:"short"}).format(r);case"EE":return new Intl.DateTimeFormat(t,{weekday:"short"}).format(r);case"h:mma":return new Intl.DateTimeFormat(t,{hour:"numeric",minute:"2-digit",hour12:!0}).format(r).replace(" ","");case"haaa":return new Intl.DateTimeFormat(t,{hour:"numeric",hour12:!0}).format(r).replace(/\s+/g,"").toLowerCase();case"yyyy":return r.getFullYear().toString();case"MM":return(r.getMonth()+1).toString().padStart(2,"0");case"dd":return r.getDate().toString().padStart(2,"0");case"HH":return r.getHours().toString().padStart(2,"0");case"HH:mm":{const o=r.getHours().toString().padStart(2,"0"),s=r.getMinutes().toString().padStart(2,"0");return`${o}:${s}`}case"HH:mm:ss":{const o=r.getHours().toString().padStart(2,"0"),s=r.getMinutes().toString().padStart(2,"0"),c=r.getSeconds().toString().padStart(2,"0");return`${o}:${s}:${c}`}case"ss":return r.getSeconds().toString().padStart(2,"0");default:return r.toLocaleString(t)}}function Fk(n,e){if(n){if(n.indexOf("-")!==-1)return n;if(e)return`${n}-${e}`}else if(e)return e;return"en-US"}const Xl=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("g",{id:"Chevron"},m.createElement("path",{id:"Shape",d:"M8.46967 4.21967C8.17678 4.51256 8.17678 4.98744 8.46967 5.28033L15.1893 12L8.46967 18.7197C8.17678 19.0126 8.17678 19.4874 8.46967 19.7803C8.76256 20.0732 9.23744 20.0732 9.53033 19.7803L16.7803 12.5303C17.0732 12.2374 17.0732 11.7626 16.7803 11.4697L9.53033 4.21967C9.23744 3.92678 8.76256 3.92678 8.46967 4.21967Z",fill:"currentColor"}))),nje=Object.freeze(Object.defineProperty({__proto__:null,default:Xl},Symbol.toStringTag,{value:"Module"})),jme={top:36,bottom:36,left:24,right:24};function Ag(n){const{ariaLabelId:e,options:t,renderOption:r,onSelect:i,value:a,id:o,actionLabel:s,placeholder:c,className:u,menuClassName:h,expandIconClassName:f,disabled:p=!1,isValid:g=!0,supportsBrowserAutofill:v,supportsTypeahead:y=!1,autoComplete:b,boundary:C,padding:S=jme}=n,[E,T]=m.useState(!1),[A,I]=m.useState(null),k=t.findIndex(le=>le.key===a),x=m.useRef([]),_=m.useRef([]),R=m.useCallback(le=>{var We;const De=(We=t[le])==null?void 0:We.key;De&&i(De)},[i,t]),{refs:z,floatingStyles:j,context:J}=qp({placement:"bottom-start",strategy:"absolute",open:E,onOpenChange:T,whileElementsMounted:th,middleware:[Wp({padding:S}),M5({boundary:C,apply({rects:le,elements:De,availableHeight:We}){Object.assign(De.floating.style,{maxHeight:`${We}px`,minWidth:`${le.reference.width}px`})},padding:S})]}),D=NT(J,{event:"mousedown",enabled:!p}),F=OT(J),ie=LT(J,{role:"listbox"}),U=jz(J,{listRef:x,activeIndex:A,selectedIndex:k,onNavigate:I,loop:!0,focusItemOnHover:!1,openOnArrowKeyDown:!p}),W=Uz(J,{enabled:y,listRef:_,activeIndex:A,onMatch:E?I:R}),{getReferenceProps:ue,getFloatingProps:te,getItemProps:Z}=DT([F,ie,U,D,W]),Q=m.useCallback(le=>{i(le),T(!1)},[i]),Ie=k>-1?r(t[k]):d.jsx("div",{className:"truncate text-foreground-550 dark:text-slate-400",children:c}),Ve=m.useCallback(le=>{p||i(le.currentTarget.value)},[i,p]),ce=m.useRef(null);return d.jsxs(d.Fragment,{children:[v&&d.jsx("select",{"aria-hidden":!0,className:"hidden",onChange:Ve,autoComplete:b,disabled:p,children:t.map(le=>d.jsx("option",{value:le.key,children:le.text},le.key))}),d.jsxs("button",{role:"combobox",type:"button",id:o,ref:z.setReference,"aria-labelledby":e,"aria-expanded":E,"aria-haspopup":"listbox","aria-autocomplete":"none","aria-invalid":!g,"aria-disabled":p,className:X("flex w-full cursor-pointer items-center justify-between gap-2 rounded-2xl bg-black/5 px-[1.125rem] py-4 dark:bg-midnight-550/25",u,p&&"pointer-events-none opacity-50"),...ue(),children:[d.jsx("div",{className:"min-w-0",children:Ie}),d.jsxs("div",{className:X("flex min-h-[26px] shrink-0 grow items-center justify-end gap-2",f),children:[s&&d.jsx("span",{children:s}),d.jsx(Xl,{className:"size-6 rotate-90"})]})]}),d.jsx("div",{ref:ce}),E&&d.jsx(cy,{root:ce.current,children:d.jsx(ly,{context:J,modal:!1,children:d.jsx("div",{ref:z.setFloating,style:j,className:X("flex overflow-hidden rounded-2xl shadow-md",h),...te(),children:d.jsx("div",{className:X("flex w-full flex-col p-2",wK),children:d.jsx("div",{className:X("vertical-scrollbar overflow-y-auto py-1 pe-1"),children:t.map((le,De)=>d.jsx("div",{ref:We=>{x.current[De]=We,_.current[De]=le.text},role:"option",tabIndex:De===A?0:-1,"aria-selected":De===k&&De===A,className:"relative cursor-default rounded-xl px-3 py-2 -outline-offset-2 hover:bg-black/5 dark:hover:bg-white/8",...Z({onClick(){Q(le.key)},onKeyDown(We){We.key==="Enter"&&(We.preventDefault(),Q(le.key))}}),children:r(le)},le.key))})})})})})]})}function MP(n){const{htmlFor:e,content:t,required:r,className:i,afterContent:a}=n;return d.jsxs("div",{className:"flex items-center",children:[d.jsxs("label",{htmlFor:e,className:X("flex items-center gap-0.5 text-foreground-900",i),children:[t,r&&d.jsx("span",{className:"text-system-red-550 dark:text-system-red-350",children:"*"})]}),a]})}function TC(){const n=Bt();return n==="/discover"||n==="/"}const zb={CLOSE_BUTTON:"closeButton",ONE_LINE_COMPOSER:"oneLineComposer",IMAGE_VIEWER:"imageViewer"},IC=O(),Ume=O(n=>{const e=n(IC);if(!(!e||!Array.isArray(e.media)||typeof e.currentMediaIndex!="number"))return e.media[e.currentMediaIndex]});function Fme(){return N(Ume)}function Bme(n){bn({source:n.source??"defaultMediaViewerSource",scenario:"mediaViewerOpen"})}function Hme(){Bk()&&bn({source:"mediaViewer",scenario:"mediaViewerNext"})}function $me(){Bk()&&bn({source:"mediaViewer",scenario:"mediaViewerPrevious"})}function RP(){Bk()&&bn({source:"mediaViewer",scenario:"mediaViewerClose"})}function Bk(){return dt().get(IC)}const Tm=O(!1),zme=O();function g9(){const[n,e]=Je(zme);return{isPictureInPictureOpen:n!==void 0,openPictureInPicture:i=>{e(i),nt({source:"mediaViewer",scenario:"PictureInPictureOpen"})},closePictureInPicture:()=>e(void 0)}}function ts(){var f;const[n,e]=Je(IC),t=pe(Tm),{openPictureInPicture:r}=g9(),i=m.useCallback(()=>{const{onClose:p}=n??{};RP(),t(!1),e(void 0),p==null||p()},[e,n,t]),a=m.useCallback(()=>{Hme(),e(p=>{if(!p)return p;if(p.currentMediaIndex<p.media.length-1){const g=p.currentMediaIndex+1;return{...p,currentMediaIndex:g,isCurrentMediaLoading:rw(p.media[g])}}return p})},[e]),o=m.useCallback(()=>{$me(),e(p=>{if(!p)return p;if(p.currentMediaIndex>0){const g=p.currentMediaIndex-1;return{...p,currentMediaIndex:g,isCurrentMediaLoading:rw(p.media[g])}}return p})},[e]),s=m.useCallback(p=>{Bme(p),t(!1),e({...p,isCurrentMediaLoading:rw(p.media[p.currentMediaIndex])})},[e,t]),c=((f=n==null?void 0:n.media[n.currentMediaIndex])==null?void 0:f.type)==="video",u=m.useCallback(()=>{var g;const p=n==null?void 0:n.media[n.currentMediaIndex];if(p&&p.type==="video"){const{player:v}=p;r({url:p.url,title:((g=p.source)==null?void 0:g.title)??"",startTime:(v==null?void 0:v.getCurrentTime())??0}),RP(),e(void 0)}},[n,r,e]),h=(n==null?void 0:n.contentComposerType)??zb.CLOSE_BUTTON;return m.useMemo(()=>({openMediaViewer:s,closeMediaViewer:i,isMediaViewerOpen:n!==void 0,next:a,previous:o,isPictureInPictureSupported:c,triggerPictureInPicture:u,contentComposerType:h,showOneLineComposerWhenMediaViewerOpen:h===zb.ONE_LINE_COMPOSER,contentPageType:n==null?void 0:n.contentPageType}),[s,i,n,a,o,c,u,h])}function rw(n){if(n&&"initLoading"in n)return n.initLoading}const PP="bg-gradient-discover-light dark:bg-gradient-discover-dark",Vme="bg-gradient-authentication-light dark:bg-gradient-authentication-dark";function Gme(n={}){const{forceGradient:e=!1,gradientType:t}=n,{isMediaViewerOpen:r,contentPageType:i}=ts(),a=TC(),o=Bt()==="/login",s=i==="newsArticle"||i==="newsVideo"||i==="newsGem",c=()=>e?!0:r&&s?!1:a||o,u=()=>t==="discover"?PP:t==="authentication"||o?Vme:PP;return{shouldShowGradient:c(),gradientClass:u()}}const NP="absolute size-full";function eu(n){const{isBottomFade:e,forceGradient:t,isFixed:r,overrideGradientType:i,customColor:a}=n,o=Bt(),{shouldShowGradient:s,gradientClass:c}=Gme({forceGradient:t,gradientType:i});return d.jsxs("div",{className:X(r?"fixed":"absolute",e?"-inset-x-4 bottom-0 h-dvh":"inset-0","overflow-hidden"),children:[d.jsx("div",{className:X(NP,"bg-none",a??"bg-background-150")}),d.jsx(Mn,{children:s&&d.jsx(_e.div,{className:X(NP,c),initial:"initial",animate:"animate",exit:"exit",variants:{initial:ct,animate:Rt,exit:ct},transition:Uk},o)})]})}const v9=O(void 0);function Kme(n){const{buttonClassName:e}=n,{t}=Ce(),{closeSettings:r}=Pk(),i=pe(v9),a=N(lt);function o(){bn({source:"complianceLinks",scenario:"cookies",conversationId:a,destination:"#"}),i("more-options"),r()}return d.jsx(Ee,{role:"menuitem",variant:"rect",size:"28-xxs",color:"subtle-dimmed-inverted",className:e,title:t("settings.cookies"),onClick:()=>o(),testId:"cookies-compliance-button",children:d.jsx("span",{children:t("settings.cookies")})})}function AC(n){const e=ee("force-cookie-banner-location");return(n&&hy.includes(n))===!0||e}function tu(n,e={}){const{preventReferrer:t=!1}=e,r=t?"noopener,noreferrer":"noopener";return window.open(n,"_blank",r)}const jp="https://www.bing.com/new/termsofuse",Xd="https://go.microsoft.com/fwlink/?LinkId=521839",Vb="https://www.microsoft.com/microsoft-copilot/learn/?form=MG0AUO&OCID=MG0AUO#faqs",cv="hover:underline focus:underline";function OP(n){var e,t;return((t=(e=me.instance().config()).textOverrides)==null?void 0:t.call(e,n))??n}function rje(n){const{component:e="link",buttonClassName:t}=n,r=N(lt),{pushPage:i}=Pk(),a=N(_r),o=AC(a),s=(u,h)=>{bn({source:"complianceLinks",scenario:u,conversationId:r,destination:h})},c=ee("manage-cookies");return d.jsxs("div",{className:X("flex w-full flex-wrap justify-center gap-x-3 gap-y-1 text-black/80 text-2xs dark:text-white/80",e==="button"?"flex-col p-0":"px-5 py-2"),children:[e==="link"?d.jsx(qme,{handleAnalytics:s}):d.jsx(Wme,{handleAnalytics:s,className:t??"",setPage:i}),c&&o&&d.jsx(Kme,{buttonClassName:ke(cv,{"text-2xs p-0 min-h-0 mx-0 min-w-0 gap-x-0 safe-hover:bg-transparent dark:safe-hover:bg-transparent dark:text-white/80":e==="link",[t??""]:e==="button"})})]})}function qme(n){const{handleAnalytics:e}=n;return d.jsxs(d.Fragment,{children:[d.jsx(to,{href:Xd,title:re(OP("settings.privacyLink")),className:cv,onClick:()=>e("privacy",Xd),children:re(OP("settings.privacyLink"))}),d.jsx(to,{href:jp,title:re("settings.termsOfServiceLink"),className:cv,onClick:()=>e("terms",jp),children:re("settings.termsOfServiceLink")}),d.jsx(to,{href:Vb,title:re("settings.faqLink"),className:cv,onClick:()=>e("faq",Vb),children:re("settings.faqLink")})]})}function Wme(n){const{handleAnalytics:e,className:t,setPage:r}=n,i=(a,o)=>{var h;e(a,o);const c=(h=me.instance().config().settingsOverrides)==null?void 0:h.shouldShowPolicyTermsQRCodes,u={privacy:"privacyStatement",terms:"terms",faq:"faq",cookies:void 0};c&&a in u?r==null||r(u[a]):tu(o)};return d.jsxs(d.Fragment,{children:[d.jsx(Ee,{role:"menuitem",variant:"rect",color:"subtle-dimmed-inverted",className:t,title:re("settings.privacyLink"),onClick:()=>i("privacy",Xd),children:d.jsx("span",{children:re("settings.privacyLink")})}),d.jsx(Ee,{role:"menuitem",variant:"rect",color:"subtle-dimmed-inverted",className:t,title:re("settings.termsOfServiceLink"),onClick:()=>i("terms",jp),children:d.jsx("span",{children:re("settings.termsOfServiceLink")})}),d.jsx(Ee,{role:"menuitem",variant:"rect",color:"subtle-dimmed-inverted",className:t,title:re("settings.faqLink"),onClick:()=>i("faq",Vb),children:d.jsx("span",{children:re("settings.faqLink")})})]})}const LP={...Yp,"United Kingdom":"UK"},DP={termsLink:d.jsx(jP,{link:jp}),privacyLink:d.jsx(jP,{link:Xd})};function jP(n){const{children:e,link:t}=n;return d.jsx(to,{className:"underline",href:t,title:"",children:e})}function Yme(n,e,t){const r=new Date(t,e-1,n);return Ome(r)&&r.getFullYear()===t&&r.getMonth()===e-1&&r.getDate()===n}function Qme(n,e,t){const r=new Date(t,e-1,n),i=Dme(new Date);return r<=i}const iw="border-2 border-system-red-550/50 bg-system-red-550/10 text-system-red-550 dark:text-system-red-350";function Jme(){const[n,e]=m.useState(!1),[t,r]=m.useState(void 0),[i,a]=m.useState(void 0);m.useEffect(()=>{async function x(){const _=await zre();a(_)}x()},[]),m.useEffect(()=>{const x=new URLSearchParams(window.location.search);x.delete("code"),x.delete("state"),x.delete("error"),window.history.replaceState({},document.title,`${window.location.pathname}?${x}`)},[]),m.useEffect(()=>{i&&nc({page:"auth0AccountVerificationPage",scenario:"auth0Verification",customData:JSON.stringify({accountType:i})})},[i]);const[o,s]=m.useState(""),[c,u]=m.useState(""),[h,f]=m.useState(""),[p,g]=m.useState(LP["United States"]),{i18n:v}=Ce(),y=Fk(v.resolvedLanguage),b=new Intl.NumberFormat(y,{minimumIntegerDigits:2,useGrouping:!1}),C=new Intl.NumberFormat(y,{minimumIntegerDigits:4,useGrouping:!1});m.useEffect(()=>{e(!!!(c&&h&&o&&p))},[c,h,o,p]);const S=[{key:"01",text:re("common.date.month.january")},{key:"02",text:re("common.date.month.february")},{key:"03",text:re("common.date.month.march")},{key:"04",text:re("common.date.month.april")},{key:"05",text:re("common.date.month.may")},{key:"06",text:re("common.date.month.june")},{key:"07",text:re("common.date.month.july")},{key:"08",text:re("common.date.month.august")},{key:"09",text:re("common.date.month.september")},{key:"10",text:re("common.date.month.october")},{key:"11",text:re("common.date.month.november")},{key:"12",text:re("common.date.month.december")}],E=Object.entries(LP).sort().map(([x,_])=>({key:_,text:x})),T=Array.from({length:31},(x,_)=>{const R=_+1,z=b.format(R);return{key:R.toString(),text:z}}),A=Array.from({length:125},(x,_)=>{const R=new Date().getFullYear()-_,z=C.format(R);return{key:`${new Date().getFullYear()-_}`,text:z}}),I=x=>d.jsx("p",{children:x.text}),k=async()=>{const x=parseInt(o,10),_=parseInt(c,10),R=parseInt(h,10);if(!Yme(R,_,x)){nt({source:"auth0AccountVerificationPage",scenario:"auth0VerificationInvalidDate",destination:"auth0AccountVerificationPage",customData:JSON.stringify({accountType:i})}),r(!1);return}if(!Qme(R,_,x)){nt({source:"auth0AccountVerificationPage",scenario:"auth0VerificationNotAdult",destination:"auth0AccountVerificationPage",customData:JSON.stringify({accountType:i})}),r(!1);return}const J=el(new Date(x,_-1,R),"yyyy-MM-dd");r(!0);const D=await $re(J,p);if(!D){nt({source:"auth0AccountVerificationPage",scenario:"auth0VerificationNotSuccessfulInvalidToken",destination:"auth0AccountVerificationPage",customData:JSON.stringify({accountType:i})}),r(!1);return}const{ageGroup:F}=D,ie=F===kc.NOT_ADULT,U=F===kc.ADULT;if(!(ie||U)){nt({source:"auth0AccountVerificationPage",scenario:"auth0VerificationNotSuccessfulNotTeenOrAdult",destination:"auth0AccountVerificationPage",customData:JSON.stringify({accountType:i})}),r(!1);return}nt({source:"auth0AccountVerificationPage",scenario:"auth0VerificationSuccessful",destination:"auth0AccountVerificationPage",customData:JSON.stringify({accountType:i})}),Sm()};return d.jsxs(d.Fragment,{children:[d.jsx(eu,{forceGradient:!0,overrideGradientType:"authentication"}),d.jsxs("section",{className:"relative m-auto flex min-h-dvh max-w-[500px] flex-col items-center justify-center gap-3 overflow-y-auto px-5 py-12 text-center",children:[d.jsx("h1",{className:"mb-4 text-center font-semibold text-xl sm:text-3xl",children:re("error.auth0VerificationTitle")}),d.jsx("p",{children:re("error.auth0VerificationDescription")}),d.jsxs("div",{className:"mt-12 w-full",children:[d.jsx(MP,{className:"mb-2 text-base",htmlFor:"birthdate-month",content:re("error.auth0VerificationBirthdate"),required:!0}),d.jsxs("div",{id:"birthdate-group",className:"flex gap-2",children:[d.jsx("span",{id:"month-label",className:"sr-only",children:c||re("dates.month")}),d.jsx("span",{id:"day-label",className:"sr-only",children:h||re("dates.day")}),d.jsx("span",{id:"year-label",className:"sr-only",children:o||re("dates.year")}),d.jsx(Ag,{renderOption:I,options:S,onSelect:x=>u(x),id:"birthdate-month",ariaLabelId:"month-label",placeholder:re("dates.month"),className:X("flex-1",Ms,t===!1&&iw),value:c,isValid:t,menuClassName:$t.dropdownMenuOverModal}),d.jsx(Ag,{renderOption:I,options:T,onSelect:x=>f(x),id:"birthdate-day",ariaLabelId:"day-label",placeholder:re("dates.day"),className:X("flex-1",Ms,t===!1&&iw),value:h,menuClassName:$t.dropdownMenuOverModal}),d.jsx(Ag,{renderOption:I,options:A,onSelect:x=>s(x),id:"birthdate-year",ariaLabelId:"year-label",placeholder:re("dates.year"),className:X("flex-1",Ms,t===!1&&iw),value:o,menuClassName:$t.dropdownMenuOverModal})]}),t===!1&&d.jsx("div",{className:X("mt-2 text-start text-system-red-550 text-sm dark:text-system-red-350"),children:re("error.authh0VerificationAgeError")})]}),d.jsxs("div",{className:"mt-12 w-full",children:[d.jsx(MP,{className:"mb-2 text-base",htmlFor:"country",content:re("error.auth0VerificationCountryRegion"),required:!0}),d.jsx(Ag,{renderOption:I,options:E,onSelect:x=>g(x),id:"country","aria-labelledby":"country-group",placeholder:re("error.auth0VerificationCountryRegion"),className:X("flex-1",Ms),value:p,menuClassName:$t.dropdownMenuOverModal})]}),d.jsxs("div",{className:"mt-12 w-full text-black text-2xs dark:text-white/90",children:[d.jsx(Fr,{i18nKey:re("error.auth0VerificationDisclaimer"),components:{termsLink:DP.termsLink,privacyLink:DP.privacyLink}}),d.jsx(Ee,{className:"mt-4 w-full",color:"strong",size:"56-xl",variant:"rect",onClick:k,title:re("common.continue"),disabled:n,children:re("common.continue")})]})]})]})}function UP(n){var e,t;return((t=(e=me.instance().config()).textOverrides)==null?void 0:t.call(e,n))??n}const aw="w-full";function Zme(){const{switchMicrosoftAccount:n,logout:e,login:t}=Sh(),{t:r}=Ce(),i=xl(),a=async()=>{await n()},o=async(u,h)=>{switch(await e(),u){case"microsoft":t({provider:u});break;case"auth0":t({provider:u,opts:h});break}},s=me.instance().config().hideAgeVerificationButton!==!0,c=me.instance().config().hideAgeVerificationSwitchAccountButton!==!0;return d.jsxs(d.Fragment,{children:[d.jsx(eu,{forceGradient:!0}),d.jsxs("section",{className:"relative z-10 m-auto flex h-dvh max-w-96 flex-col items-center justify-center gap-3 px-5 text-center",children:[d.jsx("h1",{className:"text-3xl",children:r(UP("error.ageVerificationTitle"))}),d.jsx("h2",{className:"text-foreground-600",children:r(UP("error.ageVerification"))}),s&&d.jsx(Ee,{className:"mt-6 w-full",color:"default",size:"56-xl",variant:"rect",title:r("error.ageVerificationVerifyAge"),onClick:()=>{Ch(JV)},children:r("error.ageVerificationVerifyAge")}),s&&d.jsx("div",{className:"text-balance text-foreground-600",children:r("error.ageVerificationOr")}),i?d.jsxs(d.Fragment,{children:[d.jsxs(Ee,{onClick:()=>o("microsoft"),color:"default",title:r("signInPrompt.continueWithMicrosoft"),variant:"pill",size:"56-xl",className:X(aw),children:[d.jsx(py,{className:"size-6"}),r("signInPrompt.continueWithMicrosoft")]}),d.jsxs(Ee,{onClick:()=>o("auth0",{connection:"apple"}),color:"default",variant:"pill",size:"56-xl",title:r("signInPrompt.continueWithApple"),className:X(aw),children:[d.jsx(WT,{className:"size-6 text-black dark:text-white"}),r("signInPrompt.continueWithApple")]}),d.jsxs(Ee,{onClick:()=>o("auth0",{connection:"google"}),color:"default",variant:"pill",size:"56-xl",title:r("signInPrompt.continueWithGoogle"),className:X(aw),children:[d.jsx(YT,{className:"size-6"}),r("signInPrompt.continueWithGoogle")]})]}):c&&d.jsx(Ee,{className:"w-full",color:"default",size:"56-xl",variant:"rect",title:r("error.ageVerificationSwitchAccount"),onClick:a,children:r("error.ageVerificationSwitchAccount")})]})]})}function Xme(){const n=N(En);return(n==null?void 0:n.provider)==="auth0"?d.jsx(Jme,{}):d.jsx(Zme,{})}const b9=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M12 4.5C7.85786 4.5 4.5 7.85786 4.5 12C4.5 16.1421 7.85786 19.5 12 19.5C16.1421 19.5 19.5 16.1421 19.5 12C19.5 11.6236 19.4723 11.2538 19.4188 10.8923C19.3515 10.4382 19.6839 10 20.1429 10C20.5138 10 20.839 10.2562 20.8953 10.6228C20.9642 11.0718 21 11.5317 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C14.3051 3 16.4077 3.86656 18 5.29168V4.25C18 3.83579 18.3358 3.5 18.75 3.5C19.1642 3.5 19.5 3.83579 19.5 4.25V7.25C19.5 7.66421 19.1642 8 18.75 8H15.75C15.3358 8 15 7.66421 15 7.25C15 6.83579 15.3358 6.5 15.75 6.5H17.0991C15.7609 5.25883 13.9691 4.5 12 4.5Z",fill:"currentColor"})),ije=Object.freeze(Object.defineProperty({__proto__:null,default:b9},Symbol.toStringTag,{value:"Module"}));function ege(n){const{t:e}=Ce(),{onBtnClick:t=()=>{}}=n;return d.jsxs("section",{className:"relative z-10 m-auto flex h-full max-w-96 flex-col items-center justify-center gap-3 px-5 text-center",children:[d.jsx("h1",{className:"text-3xl",children:e("error.unhandledErrorTitle")}),d.jsx("h2",{className:"text-foreground-600",children:e("error.unhandledError")}),d.jsxs(Ee,{className:"mt-6 w-full",color:"default",size:"56-xl",variant:"rect",title:e("error.unhandledErrorReload"),onClick:t,children:[d.jsx(b9,{className:"size-6"}),e("error.unhandledErrorReload")]})]})}function Hk(){return d.jsxs("main",{className:"relative size-full overflow-hidden",children:[d.jsx(eu,{forceGradient:!0}),d.jsx(ege,{onBtnClick:()=>{Sm()}})]})}function tge(n,e){return n.addEventListener("change",e),()=>n.removeEventListener("change",e)}function $k(n){const e=typeof window<"u"?window.matchMedia(n):null,[t,r]=m.useState(e==null?void 0:e.matches);return m.useEffect(()=>{e&&tge(e,i=>r(i.matches))},[n,e]),!!t}const y9={sm:"640",md:"768",lg:"1024",xl:"1280",xxl:"1920"};function Nn(n){const{breakpoint:e}=n,t=y9[e];return!$k(`(min-width: ${t}px)`)}function zk(n){const{breakpoint:e}=n,r=`(min-width: ${y9[e]}px)`,i=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia(r):null;return!(i!=null&&i.matches)}function kC(){const n=Nn({breakpoint:"sm"});return(me.instance().config().responsiveFullWidthSidebarEnabled??!1)&&n}function C9(){const[n,e]=m.useState(!1);return m.useEffect(()=>{async function t(){const i=await(me.instance().config().isConversationHistoryHidden??(()=>Promise.resolve(!1)))();e(i)}t().catch(()=>{})},[]),n}function Gb(n){const{className:e,text:t}=n;return d.jsx("p",{className:ke("inline h-min flex-none rounded border px-0.5 uppercase text-3xs",e),children:t})}const FP=kl.use||(n=>{if(n.status==="pending")throw n;if(n.status==="fulfilled")return n.value;throw n.status==="rejected"?n.reason:(n.status="pending",n.then(e=>{n.status="fulfilled",n.value=e},e=>{n.status="rejected",n.reason=e}),n)}),ow={dedupe:!0},nge=(n,e,t)=>{const{cache:r,compare:i,suspense:a,fallbackData:o,revalidateOnMount:s,revalidateIfStale:c,refreshInterval:u,refreshWhenHidden:h,refreshWhenOffline:f,keepPreviousData:p}=t,[g,v,y,b]=Di.get(r),[C,S]=Bo(n),E=m.useRef(!1),T=m.useRef(!1),A=m.useRef(C),I=m.useRef(e),k=m.useRef(t),x=()=>k.current,_=()=>x().isVisible()&&x().isOnline(),[R,z,j,J]=Ba(r,C),D=m.useRef({}).current,F=He(o)?t.fallback[C]:o,ie=(M,Y)=>{for(const Se in D){const P=Se;if(P==="data"){if(!i(M[P],Y[P])&&(!He(M[P])||!i(ce,Y[P])))return!1}else if(Y[P]!==M[P])return!1}return!0},U=m.useMemo(()=>{const M=!C||!e?!1:He(s)?x().isPaused()||a?!1:He(c)?!0:c:s,Y=q=>{const Te=wi(q);return delete Te._k,M?{isValidating:!0,isLoading:!0,...Te}:Te},Se=R(),P=J(),ne=Y(Se),ye=Se===P?ne:Y(P);let ae=ne;return[()=>{const q=Y(R());return ie(q,ae)?(ae.data=q.data,ae.isLoading=q.isLoading,ae.isValidating=q.isValidating,ae.error=q.error,ae):(ae=q,q)},()=>ye]},[r,C]),W=my.useSyncExternalStore(m.useCallback(M=>j(C,(Y,Se)=>{ie(Se,Y)||M()}),[r,C]),U[0],U[1]),ue=!E.current,te=g[C]&&g[C].length>0,Z=W.data,Q=He(Z)?F:Z,Ie=W.error,Ve=m.useRef(Q),ce=p?He(Z)?Ve.current:Z:Q,le=te&&!He(Ie)?!1:ue&&!He(s)?s:x().isPaused()?!1:a?He(Q)?!1:c:He(Q)||c,De=!!(C&&e&&ue&&le),We=He(W.isValidating)?De:W.isValidating,be=He(W.isLoading)?De:W.isLoading,Me=m.useCallback(async M=>{const Y=I.current;if(!C||!Y||T.current||x().isPaused())return!1;let Se,P,ne=!0;const ye=M||{},ae=!y[C]||!ye.dedupe,q=()=>rl?!T.current&&C===A.current&&E.current:C===A.current,Te={isValidating:!1,isLoading:!1},ze=()=>{z(Te)},ht=()=>{const Ye=y[C];Ye&&Ye[1]===P&&delete y[C]},vt={isValidating:!0};He(R().data)&&(vt.isLoading=!0);try{if(ae&&(z(vt),t.loadingTimeout&&He(R().data)&&setTimeout(()=>{ne&&q()&&x().onLoadingSlow(C,t)},t.loadingTimeout),y[C]=[Y(S),il()]),[Se,P]=y[C],Se=await Se,ae&&setTimeout(ht,t.dedupingInterval),!y[C]||y[C][1]!==P)return ae&&q()&&x().onDiscarded(C),!1;Te.error=pn;const Ye=v[C];if(!He(Ye)&&(P<=Ye[0]||P<=Ye[1]||Ye[1]===0))return ze(),ae&&q()&&x().onDiscarded(C),!1;const st=R().data;Te.data=i(st,Se)?st:Se,ae&&q()&&x().onSuccess(Se,C,t)}catch(Ye){ht();const st=x(),{shouldRetryOnError:Ot}=st;st.isPaused()||(Te.error=Ye,ae&&q()&&(st.onError(Ye,C,st),(Ot===!0||Br(Ot)&&Ot(Ye))&&(!x().revalidateOnFocus||!x().revalidateOnReconnect||_())&&st.onErrorRetry(Ye,C,st,Yt=>{const on=g[C];on&&on[0]&&on[0](Hr.ERROR_REVALIDATE_EVENT,Yt)},{retryCount:(ye.retryCount||0)+1,dedupe:!0})))}return ne=!1,ze(),!0},[C,r]),xe=m.useCallback((...M)=>vy(r,A.current,...M),[]);if(Hi(()=>{I.current=e,k.current=t,He(Z)||(Ve.current=Z)}),Hi(()=>{if(!C)return;const M=Me.bind(pn,ow);let Y=0;const P=rI(C,g,(ne,ye={})=>{if(ne==Hr.FOCUS_EVENT){const ae=Date.now();x().revalidateOnFocus&&ae>Y&&_()&&(Y=ae+x().focusThrottleInterval,M())}else if(ne==Hr.RECONNECT_EVENT)x().revalidateOnReconnect&&_()&&M();else{if(ne==Hr.MUTATE_EVENT)return Me();if(ne==Hr.ERROR_REVALIDATE_EVENT)return Me(ye)}});return T.current=!1,A.current=C,E.current=!0,z({_k:S}),le&&(He(Q)||Fo?M():XT(M)),()=>{T.current=!0,P()}},[C]),Hi(()=>{let M;function Y(){const P=Br(u)?u(R().data):u;P&&M!==-1&&(M=setTimeout(Se,P))}function Se(){!R().error&&(h||x().isVisible())&&(f||x().isOnline())?Me(ow).then(Y):Y()}return Y(),()=>{M&&(clearTimeout(M),M=-1)}},[u,h,f,C]),m.useDebugValue(ce),a&&He(Q)&&C){if(!rl&&Fo)throw new Error("Fallback data is required when using suspense in SSR.");I.current=e,k.current=t,T.current=!1;const M=b[C];if(!He(M)){const Y=xe(M);FP(Y)}if(He(Ie)){const Y=Me(ow);He(ce)||(Y.status="fulfilled",Y.value=!0),FP(Y)}else throw Ie}return{mutate:xe,get data(){return D.data=!0,ce},get error(){return D.error=!0,Ie},get isValidating(){return D.isValidating=!0,We},get isLoading(){return D.isLoading=!0,be}}},rge=nI(nge),ige=n=>Bo(n?n(0,null):null)[0],sw=Promise.resolve(),age=n=>(e,t,r)=>{const i=m.useRef(!1),{cache:a,initialSize:o=1,revalidateAll:s=!1,persistSize:c=!1,revalidateFirstPage:u=!0,revalidateOnMount:h=!1,parallel:f=!1}=r,[,,,p]=Di.get(eI);let g;try{g=ige(e),g&&(g=EL+g)}catch{}const[v,y,b]=Ba(a,g),C=m.useCallback(()=>He(v()._l)?o:v()._l,[a,g,o]);my.useSyncExternalStore(m.useCallback(x=>g?b(g,()=>{x()}):()=>{},[a,g]),C,C);const S=m.useCallback(()=>{const x=v()._l;return He(x)?o:x},[g,o]),E=m.useRef(S());Hi(()=>{if(!i.current){i.current=!0;return}g&&y({_l:c?E.current:S()})},[g,a]);const T=h&&!i.current,A=n(g,async x=>{const _=v()._i,R=v()._r;y({_r:pn});const z=[],j=S(),[J]=Ba(a,x),D=J().data,F=[];let ie=null;for(let U=0;U<j;++U){const[W,ue]=Bo(e(U,f?null:ie));if(!W)break;const[te,Z]=Ba(a,W);let Q=te().data;const Ie=s||_||He(Q)||u&&!U&&!He(D)||T||D&&!He(D[U])&&!r.compare(D[U],Q);if(t&&(typeof R=="function"?R(Q,ue):Ie)){const Ve=async()=>{if(!(W in p))Q=await t(ue);else{const le=p[W];delete p[W],Q=await le}Z({data:Q,_k:ue}),z[U]=Q};f?F.push(Ve):await Ve()}else z[U]=Q;f||(ie=Q)}return f&&await Promise.all(F.map(U=>U())),y({_i:pn}),z},r),I=m.useCallback(function(x,_){const R=typeof _=="boolean"?{revalidate:_}:_||{},z=R.revalidate!==!1;return g?(z&&(He(x)?y({_i:!0,_r:R.revalidate}):y({_i:!1,_r:R.revalidate})),arguments.length?A.mutate(x,{...R,revalidate:z}):A.mutate()):sw},[g,a]),k=m.useCallback(x=>{if(!g)return sw;const[,_]=Ba(a,g);let R;if(Br(x)?R=x(S()):typeof x=="number"&&(R=x),typeof R!="number")return sw;_({_l:R}),E.current=R;const z=[],[j]=Ba(a,g);let J=null;for(let D=0;D<R;++D){const[F]=Bo(e(D,J)),[ie]=Ba(a,F),U=F?ie().data:pn;if(He(U))return I(j().data);z.push(U),J=U}return I(z)},[g,a,I,S]);return{size:S(),setSize:k,mutate:I,get data(){return A.data},get error(){return A.error},get isValidating(){return A.isValidating},get isLoading(){return A.isLoading}}},oge=AL(rge,age);function Vk(n,e,t){const{data:r,error:i,isLoading:a,size:o,setSize:s,mutate:c}=oge(e,n,{revalidateFirstPage:!!(t!=null&&t.refreshInterval),...t}),u=m.useCallback(async()=>{await c()},[c]),h=m.useCallback(async()=>{await s(o+1)},[s,o]),f=r==null?void 0:r[o-1],p=o>0&&!!r&&typeof f>"u",g=a||p,v=f?!!e(o+1,f):!1;return{loader:{loading:g,hasNextPage:v,error:i,onLoadMore:h,data:r},refetch:u}}function sge(n,e){if(!(e!=null&&e.next)&&n>0)return null;const t={url:"/pages",isFirstPage:n===0};return e!=null&&e.next&&(t.args={cursor:e.next}),t}function cge(n={}){const{disabled:e=!1}=n,t=Ai("kill-shared-page"),r=m.useCallback(async({url:i,args:a})=>{const o={...a,...t?{}:{"api-version":"2"}};return await Tn(i,hX,{query:o,analytics:{anonymousPath:"/pages"}}).then(c=>c.data)},[t]);return Vk(r,e?()=>null:sge)}function lge(){const n=ee("pages"),e=ee("pages-anonymous"),t=fr();return{canCreatePageForSignedOut:e&&n,canCreatePage:(t||e)&&n}}function aje(){nt({pageName:"chatPage",sectionName:"chatResponse",source:"addToPage"})}function oje(n){nt({pageName:"addToPage",source:n})}function uge(){nt({sectionName:"actionMenu",source:"createNewPage"})}function dge(n){nt({pageName:n,source:"openPage"})}function sje(){nt({pageName:"pages",sectionName:"editBar",source:"askCopilot"})}function cje(n){const{action:e,pageId:t,conversationId:r,messageId:i,suggestionId:a}=n;nt({pageName:"pages",sectionName:"suggestions",source:e==="accept"?"applyRevision":"reject",conversationId:r,customData:JSON.stringify({eventInfo_pageId:t,eventInfo_messageId:i,eventInfo_suggestionId:a})})}function lje(n){const{reaction:e,pageId:t,suggestionId:r,messageId:i,startIndex:a,endIndex:o,oldText:s,replacement:c,conversationId:u}=n;nt({pageName:"pages",sectionName:"suggestions",source:"pagesFeedback",scenario:e,conversationId:u,customData:JSON.stringify({eventInfo_pageId:t,eventInfo_reaction:e,eventInfo_suggestionId:r,eventInfo_messageId:i,eventInfo_startIndex:a,eventInfo_endIndex:o,eventInfo_oldText:s,eventInfo_replacement:c})})}function uje(n){Zn({feature:"page",...n})}const dje=["createPage","addToExistingPage","openPageOnChat","openPageOnHistory","copyPage"];function hje(n,e,t){zo({feature:"page",scenario:n,duration:Math.round(e),customData:JSON.stringify({eventInfo_pageId:t})})}function fje(){nt({pageName:"pages",source:"hyperlinkInPages"})}function pje({sectionName:n,pageId:e}){nt({sectionName:n,source:"deletePage",customData:JSON.stringify({eventInfo_pageId:e})})}function mje({sectionName:n,pageId:e}){nt({sectionName:n,source:"renamePage",customData:JSON.stringify({eventInfo_pageId:e})})}function gje(n){H.trackEvent({name:"interaction",data:{eventName:"copilotPagesEdited",eventInfo_customData:JSON.stringify({eventInfo_pageId:n})}})}function vje(n){const{pageName:e,sectionName:t,pageId:r}=n;nt({pageName:e,sectionName:t,source:"pagesSharing",customData:JSON.stringify({eventInfo_pageId:r})})}function bje(n){const{pageName:e,sectionName:t,pageId:r,source:i}=n;nt({pageName:e,sectionName:t,source:i,customData:JSON.stringify({eventInfo_pageId:r})})}function yje(n){const{sectionName:e,pageId:t}=n;nt({sectionName:e,source:"removePagesSharing",customData:JSON.stringify({eventInfo_pageId:t})})}const Cje=["pagesHistory","direct"];function Sje(n){H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionPage:"pagesSharing",eventInfo_impressionScenario:n}})}const wje=["responsePreviewedPage","chatCreateNewPage","chatAddToExistingPage","chatDirectToNewPage","pagesHistory","actionMenuCreateNewPage","makeACopyViewerPage","makeACopyOwnerPage","makeACopyViewOnly","makeACopyPagesHistory"];function Eje(n){H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionPage:"pages",eventInfo_impressionScenario:n}})}function Tje(n){const{pageName:e,sectionName:t,pageId:r}=n;nt({pageName:e,sectionName:t,source:"makePagesCopy",customData:JSON.stringify({eventInfo_pageId:r})})}function Ije(){nt({pageName:"pages",source:"printPage"})}function hge(n){H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionPage:"threePages",eventInfo_impressionScenario:n}})}const fge=l.union([l.literal("open"),l.literal("close")]),S9=l.object({sidebarVisibility:fge.optional()});function pge(n){ca(PL,S9,{sidebarVisibility:n})}function w9(){var n;return((n=dr(PL,S9))==null?void 0:n.sidebarVisibility)??"close"}function mge(){return!me.instance().config().sidebarNavigation||zk({breakpoint:"md"})?!1:w9()!=="close"}const Yo=O(mge());function gge(){const n=Ta(),e=sy(),t=pe(Yo);return m.useCallback(async({pageId:r,closeSidebar:i,sourcePage:a,impressionScenario:o,featureLatencyInfo:s})=>{dge(a),i&&t(!1),await n({to:"/pages/$pageId",params:{pageId:r},from:e.state.location.pathname,state:{...s,impressionScenario:o}})},[n,e.state.location.pathname,t])}const vge=O(n=>n(nu).isOpen||n(E9)),nu=O({isOpen:!1,scenario:null}),E9=O(n=>{const e=n(ol);return e===null?!1:e===0||n(l3).includes(e)}),bge=O(n=>{const e=n(E9),t=n(ec("location-prompt")),r=n(po).filter(({author:a})=>a==="human").length,i=!!Pn(Oq);return e||!t||i?!1:r===UV}),yge=dt();function Is(n){n&&yge.set(Ia,{title:n.title,subtitle:n.message,dismissable:!0,dismissAfter:10*1e3})}const BP="/pages";async function Cge(n,e){const t=await xr({path:"/pages",args:{body:{title:n,content:e},analytics:{anonymousPath:BP}}}),r=await t.json(),i=pX.safeParse(r);if(!t.ok&&i.success)throw new Error(i.data.errorCode);try{return lX.parse(r)}catch(a){throw a instanceof wv&&vp(a,BP,!1),a}}function Sge(){const{canCreatePage:n,canCreatePageForSignedOut:e}=lge(),{t}=Ce(),[r,i]=m.useState(!1),a=xl(),o=pe(ri),s=pe(nu),c=gge();return{creatingPage:r,createPage:n?async({content:h,sourcePage:f,impressionScenario:p,featureLatencyInfo:g})=>{i(!0);try{const{id:v}=await Cge("",h);await c({pageId:v,closeSidebar:!0,sourcePage:f,impressionScenario:p,featureLatencyInfo:g})}catch(v){v instanceof Error&&v.message==="page-count-exceeded"&&e?(hge(f),o(a?"prompt-3p-sign-in":"prompt-sign-in"),s({isOpen:!0,scenario:"sidebarActionCreatePage",reason:"pageLimitReached"})):Is({title:t("common.somethingWrong"),message:t("pages.errorCreatingMessage")})}finally{i(!1)}}:null}}function T9(n){const{callback:e,signInScenario:t,onShowSignIn:r,signInReason:i}=n,a=fr(),o=pe(nu);return(...s)=>{if(!a){o({isOpen:!0,scenario:t,reason:i}),r&&typeof r=="function"&&r();return}e(...s)}}const wge=O(!1),I9=O(!1),Rf=O(null),Ege=O(!0),Tge=O(-1),Aje=O(!1);function Ige(){const n=Fe(_r);return Fk(Dt.resolvedLanguage,n)}function Age(){const{i18n:n}=Ce(),e=N(_r);return Fk(n.resolvedLanguage,e)}const kge=25,xge=70,_ge=4,El=dt(),GE=O(null),A9=O("");let cw=null;function Mge(n){El.set(A9,n)}function HP(){return El.get(A9)}function nd(n){El.set(Mk,n)}function k9(){const n=El.get(GE);n&&(n.abort(),El.set(GE,null))}function Rge(){k9();const n=new AbortController;return El.set(GE,n),n}function Pge(n,e,t){const r=new URL("https://www.bing.com/AS/Suggestions/V2?pt=page.chat"),[i,a]=t.split("-");return r.searchParams.set("setlang",(i==null?void 0:i.toLowerCase())??"en"),r.searchParams.set("cc",(a==null?void 0:a.toLowerCase())??"us"),r.searchParams.set("qry",n.toLowerCase()),r.searchParams.set("cvid",e),$e("encacsc")&&r.searchParams.set("ascopilot1","1"),$e("enblsuggrndmzn")&&r.searchParams.set("ascopilot2","1"),$e("encpsrchdata")&&r.searchParams.set("ascopilot3","1"),r.toString()}async function Nge(n){const{query:e,conversationId:t,market:r,abortController:i}=n,a=Pge(e,t,r);return fetch(a,{signal:i.signal}).then(o=>o.json())}function Oge(n,e){const t=n.toLowerCase().split(/\s+/),r=e.st.toLowerCase().split(/\s+/);let i=0;for(let c=0;c<Math.min(t.length,r.length)&&t[c]===r[c];c+=1)i+=1;const a=e.st.split(/\s+/),o=a.slice(0,i).join(" "),s=a.slice(i).join(" ");return{original:e.st,sliced:s,prefill:o+(o?" ":"")}}async function Lge(n){var t;const e=Fe(lt);if(e)try{const r=Rge(),i=Ige(),a=performance.now(),o=await Nge({query:n,conversationId:e,market:i,abortController:r});if(n===HP()){if(!o.s.length){nd(null),Zn({feature:"fetchChatAutoComplete",errorType:"NoSuggestions",customData:JSON.stringify({conversationId:e})});return}const s=o.s.map(c=>Oge(o.qc.q,c));if(!s.length){nd(null),Zn({feature:"fetchChatAutoComplete",errorType:"NoSuggestions",customData:JSON.stringify({conversationId:e})});return}nd({prefill:((t=s[0])==null?void 0:t.prefill)??n,conversationId:e,type:"BCT",suggestions:s.slice(0,_ge)}),zo({feature:"fetchChatAutoComplete",duration:performance.now()-a})}}catch(r){r instanceof DOMException&&r.name==="AbortError"||H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"autosuggest",eventInfo_errorMessage:`${r}`,eventInfo_details:"Autosuggest API error"}}),n===HP()&&nd(null)}}function Dge(n){cw&&clearTimeout(cw),cw=setTimeout(()=>{Lge(n)},kge)}function x9(n){var i;let e=(i=me.instance().config().landingPage)==null?void 0:i.regexForAutoSuggest;$e("one-char-autosuggest")&&(e=/\S+/);const t=$e("autosuggest")||$e("edge-autosuggest"),r=Fe(lt);if(!t||!e||!e.test(n)||n.length>=xge){nd(null);return}Mge(n),!n||!r?nd(null):Dge(n)}function Pf(){k9(),El.set(Mk,null)}const kje="https://aka.ms/copilot-ads/ads-settings",xje="https://aka.ms/copilot-ads/verification-program",_je=["website-visits","interests","similar-audience"],Mje="data-ad-part",Rje={text:"textAd",multimedia:"multimediaAd",product:"productAd",propertyPromotion:"propertyPromotionAd",tourActivity:"tourActivityAd",miniShowroom:"miniShowroomAd",mainShowroom:"mainShowroomAd",showroom:"showroomAd",organic:"organicAd"},jge=.05,Pje="focus:underline hover:underline group-focus/trackable-link:underline",Nje=128,Oje=188,Lje=147,Dje=95;function jje(n,e,t){if(n.length===0)return{width:void 0,height:void 0,isFallback:!1};const{maxDeviation:r,averageAspectRatio:i,count:a}=_9(n);return a===0||i===0?{width:void 0,height:void 0,isFallback:!1}:r>jge?{width:e,height:Uge(n,e,t),isFallback:!0}:{width:e,height:e/i,isFallback:!1}}function Uge(n,e,t){const r=Fge(n,e);return r===-1?t:Math.min(t,r)}function Fge(n,e){const t=n.map(r=>{const i=r.type==="product"?r.offer.item.image:r.image;if(i.width&&i.height)return i.height/i.width*e}).filter(r=>typeof r=="number");return t.length>0?Math.max(...t):-1}function _9(n){if(n.length===0)return{maxDeviation:0,averageAspectRatio:0,count:0};const e=[];for(const i of n){const a=i.type==="product"?i.offer.item.image:i.image;if(a.width&&a.height){const o=a.width/a.height;e.push(o)}}if(e.length===0)return{maxDeviation:0,averageAspectRatio:0,count:0};const t=e.reduce((i,a)=>i+a,0)/e.length;return{maxDeviation:e.reduce((i,a)=>{const o=Math.abs(a/t-1);return Math.max(i,o)},0),averageAspectRatio:t,count:e.length}}function Bge(n){if(n.length===0)return{};const e=n.map(r=>{const i=r.type==="product"?r.offer.item.image:r.image;return{originalWidth:i.width,originalHeight:i.height}}),t=_9(n);return{imageSizes:e.length>0?e:void 0,imageAspectRatioVariance:t}}function Hge(n){var t;const e=[];for(const r of n){if(r.type!=="product"&&r.type!=="propertyPromotion"&&r.type!=="tourActivity")return null;if(!r.tags)continue;if(r.tags.length>1)return null;const i=r.tags[0];if(!(!i||!i.value))if(e.length===0)e.push(i);else{if(((t=e[0])==null?void 0:t.category)!==i.category)return null;e.find(a=>a.value===i.value)||e.push(i)}}return e}function Uje(n,e){var t;return n!=null&&n.length?JSON.stringify({tagCategory:(t=n[0])==null?void 0:t.category,tagValue:(e==null?void 0:e.value)??"recommended",tagPosition:e?n.indexOf(e)+1:null,tagCount:n.length}):""}function $ge(n){return n.every(e=>e.type==="product"||e.type==="propertyPromotion"||e.type==="tourActivity")}function Fje(n,e,t){let r=n;return e!=null&&e.length&&t?r=n.filter(i=>{var a;return i.tags&&((a=i.tags[0])==null?void 0:a.value)===t.value}):e!=null&&e.length&&!t&&(r=n.filter(i=>!i.tags)),r}class zge{constructor(e){B(this,"startTime",0);B(this,"timeToFirstToken",0);B(this,"receivedFirstToken",!1);B(this,"receivedLastToken",!1);B(this,"currentAdditionalData");B(this,"currentMessageId","");B(this,"receivedMessageTime",0);B(this,"startMessageTime",0);B(this,"mostRecentTokenTime",0);this.startTime=e}resetStartTime(e){this.startTime=e,this.timeToFirstToken=0}onBeforeSend(){this.receivedFirstToken=!1,this.receivedLastToken=!1}onSent(e){this.currentAdditionalData=e}onReceived(e){this.receivedMessageTime=performance.now(),H.trackEvent({name:"system",data:{eventName:"copilotChatRequest",eventInfo_additionalData:this.currentAdditionalData,eventInfo_duration:this.receivedMessageTime-this.startTime,eventInfo_conversationId:e.conversationId,eventInfo_messageId:this.currentMessageId,eventInfo_mode:e.chatMode}})}onStartMessage(e){this.startMessageTime=performance.now(),this.currentMessageId=e.messageId,this.receivedMessageTime||(this.receivedMessageTime=this.startTime),H.trackEvent({name:"system",data:{eventName:"copilotChatReqToResp",eventInfo_duration:this.startMessageTime-this.receivedMessageTime,eventInfo_additionalData:this.currentAdditionalData,eventInfo_conversationId:e.conversationId,eventInfo_messageId:e.messageId,eventInfo_mode:e.chatMode}})}onFirstToken(e,t,r){if(!this.receivedFirstToken&&e===this.currentMessageId){const i=performance.now()-this.startTime;this.timeToFirstToken=i,this.receivedFirstToken=!0,H.trackEvent({name:"system",data:{eventName:"copilotChatRespToReceived",eventInfo_additionalData:this.currentAdditionalData,eventInfo_conversationId:r,eventInfo_duration:performance.now()-this.receivedMessageTime,eventInfo_messageId:e,eventInfo_mode:t}}),H.trackEvent({name:"system",data:{eventName:"copilotFirstTokenReceived",eventInfo_conversationId:r,eventInfo_messageId:e,eventInfo_duration:i,eventInfo_mode:t,eventInfo_additionalData:this.currentAdditionalData}})}this.mostRecentTokenTime=performance.now()}onLastToken(e){const{citationCount:t,imageCount:r,messageId:i,inputMethod:a,conversationId:o,chatMode:s,chainOfThoughtCount:c}=e;if(!this.receivedLastToken&&i===this.currentMessageId){const u=this.mostRecentTokenTime-this.startTime;this.receivedLastToken=!0,H.trackEvent({name:"system",data:{eventName:"copilotResponseRender",eventInfo_conversationId:o,eventInfo_messageId:i,eventInfo_numCitations:t,eventInfo_numImagesGenerated:r,eventInfo_numChainOfThoughts:c,eventInfo_inputMethod:a,eventInfo_responseMethod:"text",eventInfo_mode:s,eventInfo_additionalData:this.currentAdditionalData,eventInfo_landingPage:H.getLandingPage(),eventInfo_firstToLastTokenDuration:u-this.timeToFirstToken}}),H.trackEvent({name:"system",data:{eventName:"copilotLastTokenReceived",eventInfo_conversationId:o,eventInfo_messageId:i,eventInfo_duration:u,eventInfo_mode:s,eventInfo_additionalData:this.currentAdditionalData}}),H.trackEvent({name:"system",data:{eventName:"copilotChatE2E",eventInfo_conversationId:o,eventInfo_messageId:i,eventInfo_duration:performance.now()-this.startTime,eventInfo_mode:s,eventInfo_additionalData:this.currentAdditionalData}}),this.currentAdditionalData=void 0}}onAdsRender(e){const t=performance.now()-this.startTime,{ads:r}=e,a=(r==null?void 0:r.find(h=>h.type==="miniShowroom"))??(r&&r.length>0?r[0]:void 0),o=r&&$ge(r)?Hge(r):[],s=r==null?void 0:r.find(h=>h.type==="mainShowroom"),c=r&&r.length>0&&((a==null?void 0:a.type)==="product"||(a==null?void 0:a.type)==="tourActivity"||(a==null?void 0:a.type)==="propertyPromotion")?Bge(r):{},u={eventType:e.eventType,adTags:o!=null&&o.length?o:void 0,brandId:s==null?void 0:s.brandId,...c};H.trackEvent({name:"system",data:{eventName:"copilotAdsSignal",eventInfo_scenario:"render",eventInfo_adType:a==null?void 0:a.type,eventInfo_adCount:r==null?void 0:r.length,eventInfo_rguid:e.requestId,eventInfo_messageId:e.messageId,eventInfo_conversationId:e.conversationId,eventInfo_duration:t,eventInfo_additionalData:JSON.stringify(u)}})}onSubmitMessageBlocked(e,t,r){H.trackEvent({name:"interaction",data:{eventName:"copilotUserInputBlocked",eventInfo_inputMethod:t,eventInfo_mode:e,eventInfo_messageId:this.currentMessageId,eventInfo_conversationId:r,eventInfo_duration:performance.now()-this.startTime,eventInfo_additionalData:this.currentAdditionalData}})}onImageGenerationStart(e){const{messageId:t,conversationId:r,chatMode:i}=e,o=performance.now()-this.startTime;H.trackEvent({name:"system",data:{eventName:"copilotFeatureLatency",eventInfo_scenario:"ImageGenStarted",eventInfo_messageId:t,eventInfo_conversationId:r,eventInfo_mode:i,eventInfo_duration:o}})}onImageReceived(e){const{messageId:t,conversationId:r,chatMode:i}=e,a=performance.now()-this.startTime;H.trackEvent({name:"system",data:{eventName:"copilotFeatureLatency",eventInfo_scenario:"ImageGenReceived",eventInfo_messageId:t,eventInfo_conversationId:r,eventInfo_mode:i,eventInfo_duration:a}})}onPartialImageReceived(e){const{messageId:t,imageGenPhase:r,conversationId:i,chatMode:a}=e,o=performance.now()-this.startTime;H.trackEvent({name:"system",data:{eventName:"copilotFeatureLatency",eventInfo_scenario:"PartialImageGenReceived",eventInfo_messageId:t,eventInfo_conversationId:i,eventInfo_mode:a,eventInfo_duration:o,eventInfo_customData:`${r}`}})}onMemorySignalReceived(e){const{messageId:t,conversationId:r}=e,a=performance.now()-this.startTime;H.trackEvent({name:"system",data:{eventName:"copilotFeatureLatency",eventInfo_scenario:"MemorySignalReceived",eventInfo_messageId:t,eventInfo_conversationId:r,eventInfo_duration:a}})}onChainOfThoughtReceived(e){const{messageId:t,conversationId:r,chatMode:i}=e,a=performance.now()-this.startTime;H.trackEvent({name:"system",data:{eventName:"copilotCoTFirstTokenReceived",eventInfo_messageId:t,eventInfo_conversationId:r,eventInfo_mode:i,eventInfo_duration:a}})}}function Vge(n,e,t){switch(n.type){case"research":return{type:"task",task:{id:n.id,type:n.type,contents:[],partialOutput:[],inlineCitations:[],status:"pending",prompt:n.prompt},partId:e};case"computerUse":return{type:"task",task:{id:n.id,conversationId:n.conversationId,type:n.type,status:"running",updatedAt:t},partId:e};case"podcast":return{type:"task",task:{id:n.id,type:n.type,status:n.status,podcast:n.podcast,updatedAt:n.updatedAt??t},partId:e};default:return null}}const M9=n=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M3.28034 2.21968C2.98745 1.92678 2.51257 1.92677 2.21968 2.21966C1.92678 2.51255 1.92677 2.98743 2.21966 3.28032L3.48326 4.54395C3.17684 5.03983 3 5.62426 3 6.25V17.75C3 19.5449 4.45507 21 6.25 21H17.75C18.3757 21 18.96 20.8232 19.4559 20.5169L20.7194 21.7805C21.0123 22.0734 21.4872 22.0734 21.7801 21.7805C22.073 21.4876 22.073 21.0127 21.7801 20.7198L3.28034 2.21968ZM11.1189 12.1797C10.8678 12.2864 10.6322 12.4409 10.4258 12.643L4.60326 18.3437C4.53643 18.1583 4.5 17.9584 4.5 17.75V6.25C4.5 6.0437 4.5357 5.84574 4.60125 5.66196L11.1189 12.1797ZM19.5 6.25V16.3183L20.9993 17.8176C20.9998 17.7951 21 17.7726 21 17.75V6.25C21 4.45507 19.5449 3 17.75 3H6.25C6.2275 3 6.20505 3.00023 6.18265 3.00068L7.68194 4.5H17.75C18.7165 4.5 19.5 5.2835 19.5 6.25ZM18.3305 19.4014C18.1489 19.4653 17.9535 19.5 17.75 19.5H6.25C6.04613 19.5 5.8504 19.4651 5.66845 19.4011L11.4752 13.7148L11.5588 13.644C11.8501 13.4316 12.2596 13.4553 12.5247 13.7148L18.3305 19.4014ZM15.2521 6.5C16.4959 6.5 17.5042 7.50831 17.5042 8.75212C17.5042 9.99592 16.4959 11.0042 15.2521 11.0042C14.0083 11.0042 13 9.99592 13 8.75212C13 7.50831 14.0083 6.5 15.2521 6.5ZM15.2521 8C14.8367 8 14.5 8.33673 14.5 8.75212C14.5 9.1675 14.8367 9.50423 15.2521 9.50423C15.6675 9.50423 16.0042 9.1675 16.0042 8.75212C16.0042 8.33673 15.6675 8 15.2521 8Z",fill:"currentColor"})),Bje=Object.freeze(Object.defineProperty({__proto__:null,default:M9},Symbol.toStringTag,{value:"Module"}));function Gge(n,e=200,t=50){const[r,i]=m.useState(!1),[a,o]=m.useState(null);return m.useEffect(()=>{let s;if(!n)s=setTimeout(()=>{i(!0),o(Date.now())},e);else if(r){const c=a?Date.now()-a:1/0,u=t-c;u>0?s=setTimeout(()=>{i(!1),o(null)},u):(i(!1),o(null))}return()=>{clearTimeout(s)}},[n,e,t,r,a]),r}function Kge(n={},e=!1){const[t,r]=m.useState(!1),[i,a]=m.useState(!1),{onFocus:o,onBlur:s,onPointerDown:c}=n;return[t,{onFocus:h=>{(!i||e)&&r(!0),o==null||o(h)},onBlur:h=>{r(!1),a(!1),s==null||s(h)},onPointerDown:h=>{a(!0),c==null||c(h)}}]}const R9="bg-stone-300/20 dark:bg-midnight-350/5";function qge(n,e){return n?n===!0?{animate:{...e}}:{animate:n}:{style:e}}function Wge(n,e,t,r){const i=e?r:t;return n?{animate:i}:{style:i}}function Gk(n){const{children:e,size:t="md",position:r="default",nested:i=!1,background:a="default",stroke:o,className:s,containerRef:c,interactable:u=!1,label:h,animate:f,onFocus:p,onBlur:g,onPointerDown:v,onAnimationStart:y,onAnimationComplete:b,focusOnPointerDown:C,isSelected:S=!1,...E}=n,[T,A]=Kge({onFocus:p,onBlur:g,onPointerDown:v},C),I=S||T,x=i&&(a==="acrylic"||a==="acrylic-thin"),_=x?lw[`${t}-${r}`]:Yge[`${t}-${r}`],R=x?lw[`${t}-${r}`]:Qge[`${t}-${r}`],z=x?lw[`${t}-${r}`]:Jge[`${t}-${r}`],j={default:"bg-white/45 dark:bg-midnight-350/10",darker:R9,acrylic:Ea,"acrylic-fallback":EK,"acrylic-thin":Ms,"acrylic-thin-fallback":kK,transparent:"bg-transparent"},J=u?{"aria-label":h,role:"button",tabIndex:0,...A,onKeyDown:U=>{var W;(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),(W=E.onClick)==null||W.call(E,U))}}:{onFocus:p,onBlur:g,onPointerDown:v},D=qge(f,_),F=Wge(f,I,R,z),ie=s&&!s.includes("relative")&&!s.includes("absolute")&&!s.includes("fixed")&&"relative";return d.jsxs(_e.div,{className:X(j[a],s,ie,x&&"outline-1 outline-offset-2","isolate will-change-transform"),ref:c,onAnimationComplete:b,...D,...J,...E,children:[e,d.jsx(_e.div,{className:X(I&&"border-foreground-750 dark:border-white",o&&!I&&"border-black/8 dark:border-white/8",!o&&!I&&"border-transparent",!x&&"border-[20px]",x&&o&&!I&&"border",x&&o&&I&&"border-2","pointer-events-none absolute inset-0"),...F})]})}const Yge={"xs-default":{clipPath:"var(--clip-path-squircle-16)"},"sm-default":{clipPath:"var(--clip-path-squircle-24)"},"md-default":{clipPath:"var(--clip-path-squircle-36)"},"lg-default":{clipPath:"var(--clip-path-squircle-48)"},"xl-default":{clipPath:"var(--clip-path-squircle-60)"},"xs-top":{clipPath:"var(--clip-path-squircle-16-12)"},"sm-top":{clipPath:"var(--clip-path-squircle-24-16)"},"md-top":{clipPath:"var(--clip-path-squircle-36-24)"},"lg-top":{clipPath:"var(--clip-path-squircle-48-36)"},"xl-top":{clipPath:"var(--clip-path-squircle-60-48)"},"xs-bottom":{clipPath:"var(--clip-path-squircle-12-16)"},"sm-bottom":{clipPath:"var(--clip-path-squircle-16-24)"},"md-bottom":{clipPath:"var(--clip-path-squircle-24-36)"},"lg-bottom":{clipPath:"var(--clip-path-squircle-36-48)"},"xl-bottom":{clipPath:"var(--clip-path-squircle-48-60)"}},Qge={"xs-default":{clipPath:"var(--clip-path-squircle-stroke-16)"},"sm-default":{clipPath:"var(--clip-path-squircle-stroke-24)"},"md-default":{clipPath:"var(--clip-path-squircle-stroke-36)"},"lg-default":{clipPath:"var(--clip-path-squircle-stroke-48)"},"xl-default":{clipPath:"var(--clip-path-squircle-stroke-60)"},"xs-top":{clipPath:"var(--clip-path-squircle-stroke-16-12)"},"sm-top":{clipPath:"var(--clip-path-squircle-stroke-24-16)"},"md-top":{clipPath:"var(--clip-path-squircle-stroke-36-24)"},"lg-top":{clipPath:"var(--clip-path-squircle-stroke-48-36)"},"xl-top":{clipPath:"var(--clip-path-squircle-stroke-60-48)"},"xs-bottom":{clipPath:"var(--clip-path-squircle-stroke-12-16)"},"sm-bottom":{clipPath:"var(--clip-path-squircle-stroke-16-24)"},"md-bottom":{clipPath:"var(--clip-path-squircle-stroke-24-36)"},"lg-bottom":{clipPath:"var(--clip-path-squircle-stroke-36-48)"},"xl-bottom":{clipPath:"var(--clip-path-squircle-stroke-48-60)"}},Jge={"xs-default":{clipPath:"var(--clip-path-squircle-stroke-focused-16)"},"sm-default":{clipPath:"var(--clip-path-squircle-stroke-focused-24)"},"md-default":{clipPath:"var(--clip-path-squircle-stroke-focused-36)"},"lg-default":{clipPath:"var(--clip-path-squircle-stroke-focused-48)"},"xl-default":{clipPath:"var(--clip-path-squircle-stroke-focused-60)"},"xs-top":{clipPath:"var(--clip-path-squircle-stroke-focused-16-12)"},"sm-top":{clipPath:"var(--clip-path-squircle-stroke-focused-24-16)"},"md-top":{clipPath:"var(--clip-path-squircle-stroke-focused-36-24)"},"lg-top":{clipPath:"var(--clip-path-squircle-stroke-focused-48-36)"},"xl-top":{clipPath:"var(--clip-path-squircle-stroke-focused-60-48)"},"xs-bottom":{clipPath:"var(--clip-path-squircle-stroke-focused-12-16)"},"sm-bottom":{clipPath:"var(--clip-path-squircle-stroke-focused-16-24)"},"md-bottom":{clipPath:"var(--clip-path-squircle-stroke-focused-24-36)"},"lg-bottom":{clipPath:"var(--clip-path-squircle-stroke-focused-36-48)"},"xl-bottom":{clipPath:"var(--clip-path-squircle-stroke-focused-48-60)"}},lw={"xs-default":{borderTopLeftRadius:16,borderTopRightRadius:16,borderBottomLeftRadius:16,borderBottomRightRadius:16},"sm-default":{borderTopLeftRadius:24,borderTopRightRadius:24,borderBottomLeftRadius:24,borderBottomRightRadius:24},"md-default":{borderTopLeftRadius:36,borderTopRightRadius:36,borderBottomLeftRadius:36,borderBottomRightRadius:36},"lg-default":{borderTopLeftRadius:48,borderTopRightRadius:48,borderBottomLeftRadius:48,borderBottomRightRadius:48},"xl-default":{borderTopLeftRadius:60,borderTopRightRadius:60,borderBottomLeftRadius:60,borderBottomRightRadius:60},"xs-top":{borderTopLeftRadius:16,borderTopRightRadius:16,borderBottomLeftRadius:12,borderBottomRightRadius:12},"sm-top":{borderTopLeftRadius:24,borderTopRightRadius:24,borderBottomLeftRadius:16,borderBottomRightRadius:16},"md-top":{borderTopLeftRadius:36,borderTopRightRadius:36,borderBottomLeftRadius:24,borderBottomRightRadius:24},"lg-top":{borderTopLeftRadius:48,borderTopRightRadius:48,borderBottomLeftRadius:36,borderBottomRightRadius:36},"xl-top":{borderTopLeftRadius:60,borderTopRightRadius:60,borderBottomLeftRadius:48,borderBottomRightRadius:48},"xs-bottom":{borderTopLeftRadius:12,borderTopRightRadius:12,borderBottomLeftRadius:16,borderBottomRightRadius:16},"sm-bottom":{borderTopLeftRadius:16,borderTopRightRadius:16,borderBottomLeftRadius:24,borderBottomRightRadius:24},"md-bottom":{borderTopLeftRadius:24,borderTopRightRadius:24,borderBottomLeftRadius:36,borderBottomRightRadius:36},"lg-bottom":{borderTopLeftRadius:36,borderTopRightRadius:36,borderBottomLeftRadius:48,borderBottomRightRadius:48},"xl-bottom":{borderTopLeftRadius:48,borderTopRightRadius:48,borderBottomLeftRadius:60,borderBottomRightRadius:60}};function Zge(n){const{onError:e,onLoad:t,loadingPlaceholder:r,alt:i,errorClass:a,className:o,src:s,fallbackSrc:c,stableKey:u,...h}=n,[f,p]=m.useState(!1),[g,v]=m.useState(!1),[y,b]=m.useState(!1),C=Gge(g);if(m.useEffect(()=>{p(!1),v(!1),b(!1)},[s]),f)return d.jsx(Xge,{className:a});const S=y&&c?c:s;return d.jsxs(d.Fragment,{children:[C&&(r==null?void 0:r()),m.createElement("img",{...h,alt:i,key:u??S,src:S,className:X(o,!g&&r&&"absolute size-px opacity-0"),onLoad:E=>{v(!0),t==null||t(E)},onError:E=>{c&&!y?b(!0):p(!0),e==null||e(E)}})]})}function Xge(n){const{className:e}=n;return d.jsx("div",{className:X("flex size-full items-center justify-center",R9,e),children:d.jsx(M9,{})})}function P9({path:n,args:e,onLoad:t,alt:r,...i}){const{data:a,isLoading:o}=Zl(n,async c=>{const h=await(await wa(c,e)).blob();return URL.createObjectURL(h)});m.useEffect(()=>{!o&&t&&t()},[o,t]);const s=()=>d.jsx("div",{...i});return d.jsx(Zge,{...i,alt:r,className:i.className,errorClass:i.className,loadingPlaceholder:o?s:void 0,src:o?void 0:a})}const $P=dt();function eve(n){var t,r;if(n.status!=="completed")return;const e=$P.get(lt);uu.latestLocation.pathname.startsWith("/chats")&&e&&n.conversationId===e||$P.set(Ia,{iconProvider:()=>{var i,a,o;return d.jsx(P9,{path:`/podcasts/user/${(i=n.podcast)==null?void 0:i.id}/Files/${(o=(a=n.podcast)==null?void 0:a.thumbnail)==null?void 0:o.name}`,className:"rounded-xl object-cover"})},title:re("podcasts.generationNotification.title"),subtitle:((t=n.podcast)==null?void 0:t.title)??"",action:()=>{var i;cm({from:window.location.pathname,to:`/podcasts/user/${(i=n.podcast)==null?void 0:i.id}`})},trackingArgs:{scenario:"podcastGenerationNotification",customData:JSON.stringify({podcastId:(r=n.podcast)==null?void 0:r.id})},dismissAfter:3e4})}const tve=O(!1),N9=O(void 0),nve=O(!1),zP=O(new Set),rve=O(void 0),lf=dt();function ive(n,e){const t=lf.get(lt);if($e("ds-new-progress")){if(n.status!=="completed")return;if(lf.get(zP).has(n.id))lf.set(zP,s=>zr(s,c=>{c.delete(n.id)}));else return}else if(!jv.includes(n.status)||(i4(ni()),!t||t===e))return;const i=n.id,a={title:re("research.generationNotification.title"),subtitle:re("research.generationNotification.subTitle"),link:re("research.generationNotification.subTitleLink"),action:()=>{cm({from:window.location.pathname,to:`/chats/${e}`})},onClick:()=>{lf.set(rve,i)},dismissable:!0,trackingArgs:{scenario:"researchCompletionNotification",customData:JSON.stringify({researchId:n.id,sourceConversationId:e})}};lf.set(Ia,a)}function ave(){const n=N(ya),e=N(lt);return m.useMemo(()=>{if(e){for(const t of n.values())if(t.conversationId===e)return t}},[e,n])}function ove(){const n=dt(),e=n.get(ya),t=n.get(lt);if(t){for(const r of e.values())if(r.conversationId===t)return r}}const qa=dt(),sve="MissingUrlFromApi";function cve(n,e){const t=qa.get(ya).get(n);return(t==null?void 0:t.type)==="computerUse"&&!t.lastUserCommand&&lve(t)&&e.some(i=>i.op==="replace"&&i.path==="/status"&&i.value==="paused")?KE(e,["userTakeControl","pauseByClick"]):!1}function O9(n){return n==="paused"||n==="running"||n==="pending"}function lve(n){var e,t;return n.status==="paused"&&(((e=n.statusChange)==null?void 0:e.reason)==="safetyRiskDetected"||((t=n.statusChange)==null?void 0:t.reason)==="askUserInput")}function uve(n){var e;return n.status==="paused"&&((e=n.statusChange)==null?void 0:e.reason)==="safetyRiskDetected"}function dve(n){var e;return n.status==="paused"&&((e=n.statusChange)==null?void 0:e.reason)==="userTakeControl"&&n.lastUserCommand==="takeTaskControl"}function uw(n,e=!1){return n.map(t=>({type:"chainOfThought",text:t.text,screenshotUrl:e?sve:null,reaction:null,partId:Math.random().toString()}))}function KE(n,e){return n.some(t=>{if(t.op==="replace"&&t.path==="/statusChange"){const{value:r}=t;if(typeof r=="object"&&r!==null&&"reason"in r){const{reason:i}=r;if(typeof i=="string"){const a=eD.safeParse(i);return a.success&&e.includes(a.data)}}}return!1})}function hve(n,e){const t=qa.get(ya).get(n);if((t==null?void 0:t.type)==="computerUse"){const{conversationId:r,status:i,statusChange:a}=t;if(!r)return;if(i==="cancelled"&&Ht(r,h=>{const f=VP(n,"cancelTask");h.push(f)}),KE(e,["giveBackControl"])?Ht(r,h=>{const f=VP(n,"takeTaskControl");h.push(f)}):(a==null?void 0:a.reason)==="giveBackControl"&&GP(n),KE(e,["taskCompleted"])&&Ht(r,h=>{const f={id:Math.random().toString(),createdAt:new Date().toISOString(),author:"ai",content:[{type:"card",partId:Math.random().toString(),card:{type:"computerUseFeedback"}}]};h.push(f)}),a)switch(a.reason){case"askUserInput":case"safetyRiskDetected":{i==="paused"?(a.reason==="askUserInput"&&zo({feature:"computerUse",scenario:"askUserInput",customData:JSON.stringify({id:t.id,conversationId:t.conversationId})}),r===qa.get(lt)||qa.set(Ia,{title:t.title&&t.title!==""?re("actions.alertTitleTemplate",{conversationName:t.title}):re("actions.defaultAlertTitle"),subtitle:a.reason==="safetyRiskDetected"?re("actions.safetyRiskAlertSubTitle"):re("actions.askUserInputAlertSubTitle"),action:()=>s4({id:r}),dismissAfter:30*1e3,dismissable:!0}),tA(n,f=>{"lastUserCommand"in f&&(f.lastUserCommand=void 0)})):GP(n);break}}const c=e.filter(h=>h.op==="add"&&h.path==="/chainOfThought/-").map(h=>({text:"value"in h?h.value:""}));c.length>0&&Ht(r,h=>{if(h.length===0)return;const f=KP(h);if(f)f.push(...uw(c));else{const p={id:Math.random().toString(),createdAt:new Date().toISOString(),author:"ai",content:uw(c)};h.push(p)}}),e.filter(h=>h.op==="replace"&&h.path==="/computerAction").length>0&&Ht(r,h=>{const f=KP(h);f&&f.push(...uw([{text:t.computerAction??""}],!0))})}}function VP(n,e){return{id:Math.random().toString(),createdAt:new Date().toISOString(),author:"human",content:[{type:"command",command:{type:e,taskId:n}}]}}function GP(n){tA(n,e=>{"statusChange"in e&&(e.statusChange=void 0)})}function KP(n){const e=n.at(-1);if(e&&e.author==="ai"&&e.content.find(t=>t.type==="chainOfThought"))return e.content}function Hje(n){var t;const e=ove();return(e==null?void 0:e.type)==="computerUse"?e.status!=="running"&&!((t=e.replay)!=null&&t.isRunning)?!0:!n:!0}function $je(n){return!!($e("labs-actions-replay")&&n&&n.type==="computerUse"&&!O9(n.status))}function zje(n){return{cancelTask:"copilotActionsCancelTask",takeTaskControl:"copilotActionsTakeControl",startTask:void 0,pauseTask:void 0,resumeTask:void 0,releaseTaskControl:void 0}[n]}function L9(n){return X3({tasks:qa.get(ya),conversationId:n,taskType:"computerUse"})}function fve(n,e){if(n===e&&(qa.set(Vr,"side-by-side"),i4("chat")),!$e("actions-auto-open-L2")||!n)return;const r=qa.get(lt);r&&qa.set(Dv,r),qa.set(lt,n),qa.set(Vr,"side-by-side")}function pve(n){return n.filter(e=>e.type!=="miniShowroom").filter(e=>e.type!=="mainShowroom"||e.action).map(e=>{var r;let t="";return e.type==="mainShowroom"?t=((r=e.action)==null?void 0:r.url)??"":e.type==="product"?t=e.offer.link.url:t=e.link.url,{type:e.type,rLink:t}})}function mve(n){return pve(n).some(({rLink:e})=>e==="")}function gve({entryAd:n,mainAd:e,messageId:t,partId:r,conversationId:i}){var g;const a=$e("adsshowroombrandagent"),o=Fe(Hl);if(!(!!(!o&&n&&e)||!!(!o&&n&&(a||e))||(o==null?void 0:o.conversationId)===i&&!n&&e&&e.brandId.toLowerCase()===o.brandId.toLowerCase()))return H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"AdsError",eventInfo_details:JSON.stringify({messageId:t,partId:r,conversationId:i,hasEntryAd:!!n,hasMainAd:!!e,mainAdBrandId:e==null?void 0:e.brandId,isShowroomOpened:!!o,showroomBrandId:o==null?void 0:o.brandId}),eventInfo_errorMessage:`Unexpected showroom data received when showroom is ${o?"opened":"closed"}`}}),!1;if(mve(((g=e==null?void 0:e.slotAds)==null?void 0:g.map(v=>v.ad))??[]))return!1;const c=(e==null?void 0:e.logo)??(n==null?void 0:n.logo)??(o==null?void 0:o.brandLogo),u=typeof(e==null?void 0:e.backgroundColor)=="number",h=!c||!u,f=n&&!n.brandId;return(a?f:h)?(H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"AdsError",eventInfo_details:JSON.stringify({messageId:t,partId:r,conversationId:i,entryAdType:n==null?void 0:n.type,noBrandLogo:!c,noMainShowroomAd:!e,noBackgroundColor:!u}),eventInfo_errorMessage:"Unexpected data found in ads card"}}),!1):!0}function vve({card:n,messageId:e,partId:t,conversationState:r,conversationId:i}){const{ads:a}=n;if(r.timing.onAdsRender({requestId:n.requestId,messageId:e,conversationId:i,eventType:"card",ads:a}),a!=null&&a.some(o=>o.type==="mainShowroom"||o.type==="miniShowroom")){const o=a[0],s=(o==null?void 0:o.type)==="miniShowroom",c=s?o:void 0,u=s?a[1]:o;if(!gve({entryAd:c,partId:t,conversationId:i,messageId:e,mainAd:(u==null?void 0:u.type)==="mainShowroom"?u:void 0}))return}Ht(i,o=>{const s=Dn(o,e);s&&s.content.push({type:"card",partId:t,card:n})})}function D9(n,e){var r;const t=me.instance().config();return n&&!((r=t.settingsOverrides)!=null&&r.shouldHideMultipleCharacters)&&!e}function Im(){const n=ee("multiplecharacters"),e=Jl();return D9(n,e)}function qE(){const n=$e("multiplecharacters"),e=_k();return D9(n,e)}const bve=Xp.extend({actionName:l.literal("edge_get_page_content"),parameters:l.array(l.object({tabId:l.number(),windowId:l.number(),pageUrl:l.string().nullish(),pageTitle:l.string().nullish(),pageType:l.string().nullish(),lastAccessedTime:l.number().nullish()}))}),yve=Xp.extend({actionName:l.literal("browser_search"),parameters:l.object({queries:l.array(l.string()),startTime:l.string().nullish(),endTime:l.string().nullish(),maxResults:l.number().int().positive().default(10),states:l.array(l.string()).default(["history"])})}),Cve=l.object({state:l.string(),title:l.string(),url:l.string(),pageSummary:l.string().nullish(),lastAccessed:l.coerce.date().nullish()});l.object({results:l.array(Cve)});const ns=Xp.extend({actionType:l.string(),id:l.string()}),Sve=ns.extend({actionName:l.literal("edge_navigate_to"),parameters:l.object({tabId:l.number().optional(),url:l.string()})}),wve=ns.extend({actionName:l.literal("edge_switch_tab"),parameters:l.object({tabId:l.number()})}),Eve=ns.extend({actionName:l.literal("edge_close_tabs"),parameters:l.object({tabIds:l.array(l.number())})}),Tve=ns.extend({actionName:l.literal("edge_find_browser_tab_groups"),parameters:l.object({queries:l.string().array()})}),Ive=ns.extend({actionName:l.literal("edge_group_open_browser_tabs"),parameters:l.object({tabGroups:l.object({title:l.string(),tabIds:l.array(l.number()),color:l.union([l.literal("red"),l.literal("green"),l.literal("blue")]),collapsed:l.boolean()}).array()})}),Ave=ns.extend({actionName:l.literal("edge_ungroup_open_browser_tabs"),parameters:l.object({tabGroupIds:l.number().array()})}),kve=ns.extend({actionName:l.literal("edge_media_controls"),parameters:l.object({action:l.union([l.literal("play"),l.literal("pause")])})}),xve=ns.extend({actionName:l.literal("edge_go_back_forward"),parameters:l.object({direction:l.union([l.literal("back"),l.literal("forward")]),tabId:l.number().optional()})}),_ve=l.union([Sve,Eve,Tve,Ive,Ave,kve,wve,xve]),Mve=l.object({type:l.literal("screenshot")}),Rve=l.object({type:l.literal("click"),x:l.number(),y:l.number(),button:l.union([l.literal("back"),l.literal("forward"),l.literal("left"),l.literal("right"),l.literal("middle")])}),Pve=l.object({type:l.literal("scroll"),x:l.number(),y:l.number(),scrollX:l.number(),scrollY:l.number()}),Nve=l.object({type:l.literal("doubleClick"),x:l.number(),y:l.number()}),Ove=l.object({type:l.literal("moveMouse"),x:l.number(),y:l.number()}),Lve=l.object({type:l.literal("keyPress"),keys:l.string().array()}),Dve=l.object({type:l.literal("drag"),path:l.object({x:l.number(),y:l.number()}).array()}),jve=l.object({type:l.literal("type"),text:l.string()}),Uve=l.object({type:l.literal("wait"),seconds:l.number()}),Fve=l.discriminatedUnion("type",[Mve,Rve,Nve,Ove,Lve,Dve,Pve,jve,Uve]),Bve=ns.extend({actionName:l.literal("computer_use"),parameters:l.object({tabId:l.number(),callId:l.string(),action:Fve})}),Hve=l.union([..._ve.options,Bve]),$ve=l.discriminatedUnion("actionName",[bve,yve,SQ,...Hve.options]),zve="edge://discover-chat-v2",Vve="edge://discover-chat-v2.top-chrome",Vje="Edge.Context.Pref",Gje="Edge.Context.OnPref",Kje="browser.underside_chat_consent",qje="browser.underside_video_transcript_consent",Gve="Edge.IsFeatureEnabled",Kve="Edge.OnIsFeatureEnabled",Wje="isShowCopilotButtonSupported";class Kb{constructor(){B(this,"resolve",null);B(this,"isCancelled");B(this,"token");this.token=new Promise(e=>{this.resolve=e}),this.isCancelled=!1}static cancelled(){const e=new Kb;return e.cancel(),e}static create(e){const t=new Kb;return e&&e.then(()=>t.cancel()),t}static delay(e){return this.create(new Promise(t=>{setTimeout(()=>t(null),e)}))}cancelled(){return this.isCancelled}cancel(){return!this.isCancelled&&this.resolve&&this.resolve(this),this.isCancelled=!0,this.isCancelled}dispose(){this.cancel()}}function qve(n){window.parent.postMessage(n,zve),window.parent.postMessage(n,Vve)}class Kk{constructor(e,t="",r,i,a){B(this,"listenerKey",Kk.name);B(this,"result",null);B(this,"priority","Normal");B(this,"createdDate",new Date);B(this,"id");B(this,"resolveListener");B(this,"eventName");B(this,"canResolve");B(this,"options");this.eventName=e,this.id=t,r==null||r.then(()=>this.cancel()),this.canResolve=i,this.options=a}init(e){var r;!e||((r=this.options)==null?void 0:r.autoRemoveWhenResolveListenerReturnTrue)?this.result=new Promise((i,a)=>{e?this.resolveListener=o=>{if(o===null)return;const s=e(o);Promise.resolve(s).then(c=>{c&&i(o)}).catch(a)}:this.resolveListener=i}):this.resolveListener=e}maybeHandleEvent(e){if(!this.resolveListener)throw new Error("PostMessageListener is not initialized");const{eventName:t,requestId:r}=e;return r!==this.id?!1:t===this.eventName?this.canResolve&&!this.canResolve(e)?!1:(this.resolveListener(e),!0):!1}cancel(){if(!this.resolveListener)throw new Error("PostMessageListener is not initialized");return this.result&&this.resolveListener(null),!0}}const Oc=class Oc{constructor(){B(this,"activeListeners",[])}static instance(){return Oc.singleton||(Oc.singleton=new Oc),Oc.singleton}push(e,t,r){return e.init(r),this.activeListeners.push(e),t&&t(),e.result===null?Promise.resolve(null):e.result.then(i=>(this.pop(e),i)).catch(()=>(this.pop(e),null))}pop(e){const t=this.activeListeners.indexOf(e);t>-1&&this.activeListeners.splice(t,1)}findAndHandleListener(e){for(const t of[...this.activeListeners].sort((r,i)=>r.createdDate<i.createdDate?-1:1))if(t.maybeHandleEvent(e))break}};B(Oc,"singleton",null);let WE=Oc;class Wve{constructor(){B(this,"isFeatureAvailableApiSupported");B(this,"enabledFeatures",new Map);this.isFeatureAvailableApiSupported=this.getFeatureAvailableApiSupported()}async isFeatureEnabled(e){return this.enabledFeatures.has(e)||await this.retrieveEnabledFeatures([e]),this.enabledFeatures.get(e)??!1}updateFeatureEnabledForTest(e,t){this.enabledFeatures.set(e,t)}async retrieveEnabledFeatures(e){if(!this.isFeatureAvailableApiSupported)return;await this.waitForNativeBridgeConnected();const t=1e3,r={eventName:Gve,requestId:crypto.randomUUID(),isOutgoing:!0,args:{featureNames:e}},i=await WE.instance().push(new Kk(Kve,r.requestId,Kb.delay(t).token),()=>{qve(r)});if(i){const a=i.args;for(const o of e){const s=a.featureNames.includes(o);this.enabledFeatures.set(o,s)}}}getFeatureAvailableApiSupported(){for(const t of navigator.userAgent.split(" "))if(t.startsWith("Edg/")){const r=t.split("/")[1];if(r!==void 0){const i=r.split(".")[0];if(i!==void 0)return parseInt(i,10)>=132}}return!1}waitForNativeBridgeConnected(){const e=dt();return e.get(qg)?Promise.resolve():new Promise(t=>{const r=e.sub(qg,()=>{e.get(qg)&&(r(),t())})})}}const Yje=new Wve;function Yve(n){return n!=null&&typeof n=="object"&&"id"in n&&typeof n.id=="number"&&"windowId"in n&&typeof n.windowId=="number"&&"url"in n&&typeof n.url=="string"}function Qve(n){return Array.isArray(n)&&n.every(e=>Yve(e))}function qP(n){const e=new Date(n).getTime();if(!Number.isNaN(e))return e}const Jve={OPENED:wf.OPENED,RECENT:wf.RECENT,RECENTLY_CLOSED_TAB:wf.RECENT,HISTORY:wf.HISTORY};function Zve(n){return n.map(e=>{const t=e.toUpperCase();return Jve[t]??wf.HISTORY})}const Xve=dt();function ebe(n){Xve.set(Sn,e=>zr(e,t=>{for(const{title:r,id:i,updatedAt:a,continuedAt:o}of n){const s=t.get(i);s?(s.title=r,s.id=i,s.updatedAt=a,s.continuedAt=o):t.set(i,{id:i,title:r,updatedAt:a,history:[],streamingState:"idle",continuedAt:o})}}))}const tbe=dt();function nbe(n,e,t){ibe(n.map(r=>rbe(r,e,t)).filter(r=>r!==void 0))}function rbe(n,e,t){switch(n.type){case"research":return{id:n.id,conversationId:e,type:n.type,status:n.status,updatedAt:""};case"computerUse":return{id:n.id,conversationId:n.conversationId??"",type:n.type,status:n.status,updatedAt:n.updatedAt??"",title:n.title??"",lastScreenshot:n.lastScreenshot};case"podcast":return{id:n.id,conversationId:e,status:n.status==="completed"?"completed":"running",type:n.type,podcast:n.podcast,updatedAt:n.updatedAt??t};default:return}}function ibe(n){tbe.set(ya,t=>zr(t,r=>{for(const i of n){const a=r.get(i.id);if(a)a.title=i.title,a.conversationId=i.conversationId,a.updatedAt=i.updatedAt,a.status=i.status,a.type=i.type,a.type==="computerUse"&&i.type==="computerUse"&&(a.lastScreenshot=i.lastScreenshot);else{const o={id:i.id,title:i.title,conversationId:i.conversationId,updatedAt:i.updatedAt,status:i.status,type:i.type};o.type==="computerUse"&&i.type==="computerUse"&&(o.chainOfThought=[],o.lastScreenshot=i.lastScreenshot),i.type==="podcast"&&o.type==="podcast"&&(o.podcast=i.podcast),r.set(i.id,o)}}}));const e=n.filter(t=>t.type==="computerUse"&&t.conversationId).map(t=>{const{conversationId:r,title:i,updatedAt:a}=t;return{id:r??"",title:i,updatedAt:a,continuedAt:null,history:[],streamingState:"idle"}});ebe(e)}const j9="cf-turnstile",abe=`#${j9}`;function obe(){const n=N(jf),e=N(qi);return Ai("kill-cf-turnstile")?null:d.jsx(Gi,{isOpen:n,className:"w-3/4 sm:w-[350px]",children:d.jsx("div",{id:j9,className:"flex flex-1 items-center justify-center","data-theme":e})})}const sbe=new Kl(()=>new Promise((n,e)=>{const t=setTimeout(()=>{e(new Error("CF Turnstile script took too long to load"))},15e3),r=document.createElement("script");r.type="text/javascript",r.defer=!0,r.src="https://challenges.cloudflare.com/turnstile/v0/api.js",r.onload=()=>{clearTimeout(t),n()},r.onerror=()=>{clearTimeout(t),e(new Error("Failed to load turnstile script"))},document.body.appendChild(r)}));async function U9(n){if(Ir("kill-cf-turnstile")||Fe(jf))return;const t=dt();H.trackEvent({name:"system",data:{eventName:"copilotTurnstileEvent",eventInfo_stage:"attempt"}}),uy.flushSync(()=>{t.set(jf,!0)});try{await sbe.get()}catch{t.set(Cp,"cf-turnstile");return}try{window.turnstile.render(abe,{sitekey:"0x4AAAAAAAg146IpY3lPNWte",callback:async r=>{n(r),window.turnstile.remove(),t.set(jf,!1),H.trackEvent({name:"system",data:{eventName:"copilotTurnstileEvent",eventInfo_stage:"success"}})},"error-callback":r=>{H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"turnstileRenderErrorCallback",eventInfo_details:"Error rendering CF Turnstile.",eventInfo_errorMessage:r}})}})}catch(r){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"turnstileRender",eventInfo_details:"Error rendering CF Turnstile",eventInfo_errorMessage:r instanceof Error?r.message:""}}),t.set(Cp,"cf-turnstile")}}function cbe(n){const e=n.match(/^\*\*(.*?)\*\*\n\n$/);if(e){const[,t]=e;return{title:(t==null?void 0:t.trim())??"",text:""}}return{title:"",text:n}}function qb(n,e){return n?Date.now()-parseInt(n,10)<=e:!1}function qk(n,e){return!n||parseInt(n,10)<e}var S5;const Or=(S5=me.instance().config().crossPromotion)==null?void 0:S5.aggressive;var w5,E5,T5,I5,A5;const ru={"thumbs-up":{cardFeature:"cross-promo-card-thumbsup",popupFeature:"cross-promo-popup-thumbsup",cardConfig:(w5=Or==null?void 0:Or.card)==null?void 0:w5.thumbsUp,popupConfig:(E5=Or==null?void 0:Or.popup)==null?void 0:E5.thumbsUp},copied:{cardFeature:void 0,popupFeature:"cross-promo-popup-copied",cardConfig:void 0,popupConfig:(T5=Or==null?void 0:Or.popup)==null?void 0:T5.copied},engaging:{cardFeature:void 0,popupFeature:"cross-promo-popup-engaging",cardConfig:void 0,popupConfig:(I5=Or==null?void 0:Or.popup)==null?void 0:I5.engaging},"think-deeper":{cardFeature:void 0,popupFeature:"cross-promo-popup-think-deeper",cardConfig:void 0,popupConfig:(A5=Or==null?void 0:Or.popup)==null?void 0:A5.thinkDeeper}};function lbe(){return{type:"popup",title:re("crossSelling.aggressivePromotion.popup.thumbsUpTitle"),subTitle:re("crossSelling.aggressivePromotion.popup.thumbsUpSubTitle"),images:ru["thumbs-up"].popupConfig}}function ube(){return{type:"card",title:re("crossSelling.aggressivePromotion.card.thumbsUpTitle"),subTitle:re("crossSelling.aggressivePromotion.card.thumbsUpSubTitle"),images:ru["thumbs-up"].cardConfig}}function dbe(){return{type:"popup",title:re("crossSelling.aggressivePromotion.popup.copiedTitle"),subTitle:re("crossSelling.aggressivePromotion.popup.copiedSubTitle"),images:ru.copied.popupConfig}}function hbe(){return{type:"popup",title:re("crossSelling.aggressivePromotion.popup.engagingTitle"),subTitle:re("crossSelling.aggressivePromotion.popup.engagingSubTitle"),images:ru.engaging.popupConfig}}function fbe(){return{type:"popup",title:re("crossSelling.aggressivePromotion.popup.thinkDeeperTitle"),subTitle:re("crossSelling.aggressivePromotion.popup.thinkDeeperSubTitle"),images:ru["think-deeper"].popupConfig}}function F9(n){const t=dt().get(HI),r=t===!0?!1:t!==void 0,i=Pn(sI),a=!qb(i,2*Iv),o=Pn(Rv),s=qk(o,2);r&&mbe(n)&&a&&s&&gbe(n)}let WP=!1;function pbe(){const e=dt().get(Cn);!WP&&(e==="reasoning"||e==="research")&&(F9("think-deeper"),WP=!0)}function mbe(n){return Nf(n)||B9(n)}function Nf(n){const e=ru[n];return $e(e.popupFeature)&&e.popupConfig!==void 0}function B9(n){const e=ru[n];return e.cardFeature!==void 0&&$e(e.cardFeature)&&e.cardConfig!==void 0&&!FL()}function gbe(n){const e=dt();n==="thumbs-up"&&Nf(n)?e.set(Mo,lbe()):n==="thumbs-up"&&B9(n)?e.set(Mo,ube()):n==="copied"&&Nf(n)?e.set(Mo,dbe()):n==="engaging"&&Nf(n)?e.set(Mo,hbe()):n==="think-deeper"&&Nf(n)&&e.set(Mo,fbe())}const dw=O({counter:0,isActive:!0});function vbe(){const n=dt(),e=n.get(dw);if(!e.isActive)return;const t=e.counter+1;t===XV?(F9("engaging"),n.set(dw,{counter:t,isActive:!1})):n.set(dw,{counter:t,isActive:e.isActive})}function Qje(n){var e,t;return((t=(e=me.instance().config()).textOverrides)==null?void 0:t.call(e,n))??n}function bbe(){return $e("media-spotlight-card")||$e("media-spotlight-card-v2")}async function ybe(){const n=$e("weather-cards"),e=!Ir("kill-image-cards"),t=$e("local-cards"),r=!Ir("kill-sports-cards"),i=!Ir("kill-video-cards"),a=$e("searchhealthcareprovider"),o=$e("shopping-card"),s=$e("shopping-curated"),c=bbe(),u=$e("job-cards"),h=$e("safetycards"),f=$e("quiz-cards"),p=$e("generateads"),g=$e("generateadsint"),v=$e("adsparity"),y=!Ir("kill-finance-cards"),b=$e("adstags"),C=$e("product-ads-dynamic-filter"),S=$e("property-promotion-ads-dynamic-filter"),E=$e("tour-activity-ads-dynamic-filter"),T=$e("adsshowroom")||$e("adsshowroombrandagent"),A=$e("emoji-reactions"),I=$e("imagegenv3");$e("turn-telemetry");const k=$e("recipe-card"),x=$e("file-cards"),_=$e("side-by-side-comparison"),R=$e("inline-image"),z=$e("inline-video"),{adsEnabled:j,adsShowroomEnabled:J,disableAnswerCards:D,enforceAdsOptOutOfPersonalization:F,answerCardOverrides:ie}=me.instance().config(),U=!!dt().get(zl),W=(p||g||v)&&j&&!U,ue=c&&(ie==null?void 0:ie.shouldEnableMediaSpotlightCard),te=$e("news-card"),Z=[];D||(n&&Z.push("weather"),t&&Z.push("local"),e&&Z.push("image"),R&&Z.push("inlineImage"),r&&Z.push("sports"),i&&Z.push("video"),z&&Z.push("inlineVideo"),a&&Z.push("healthcareEntity"),o&&Z.push("shopping"),u&&Z.push("job"),W&&Z.push("ads"),h&&Z.push("safetyHelpline"),f&&Z.push("quiz"),y&&Z.push("finance"),s&&Z.push("shoppingCurated"),k&&Z.push("recipe"),x&&Z.push("file"),ue&&Z.push("mediaSpotlight"),te&&Z.push("newsCarousel"));const Q={supportedTypes:["text","product","multimedia","tourActivity","propertyPromotion"]};F&&(Q.optOutOfPersonalization=!0),T&&j&&J&&Q.supportedTypes.push("showroom"),(C||b)&&(Q.product={tagsSupported:!0}),S&&(Q.propertyPromotion={tagsSupported:!0}),E&&(Q.tourActivity={tagsSupported:!0});const Ie=[];A&&Ie.push("emoji-reactions"),I&&Ie.push("partial-generated-images");const Ve=!zk({breakpoint:"lg"});_&&Ve&&Ie.push("side-by-side-comparison");const ce={supportedFeatures:Ie,supportedCards:Z.length>0?Z:void 0,ads:W?Q:null};return await ipe.run(ce)}const Cbe="group/ai-message-item space-y-3 break-words",Sbe=new Map([["1c","1C:Enterprise"],["abnf","Augmented Backus-Naur Form"],["accesslog","Apache Access Log"],["actionscript","ActionScript"],["ada","Ada"],["ado","Stata"],["adoc","AsciiDoc"],["ahk","AutoHotkey"],["angelscript","AngelScript"],["apache","Apache config"],["apacheconf","Apache config"],["applescript","AppleScript"],["arcade","ArcGIS Arcade"],["arduino","Arduino"],["arm","ARM Assembly"],["armasm","ARM Assembly"],["as","ActionScript"],["asc","AngelScript"],["asciidoc","AsciiDoc"],["aspectj","AspectJ"],["atom","HTML, XML"],["autohotkey","AutoHotkey"],["autoit","AutoIt"],["avrasm","AVR Assembly"],["awk","Awk"],["axapta","X++"],["bash","Bash"],["basic","BASIC"],["bat","Batch file (DOS)"],["bf","Brainfuck"],["bind","DNS Zone"],["bnf","Backus–Naur Form"],["brainfuck","Brainfuck"],["c","C"],["c#","C#"],["c++","C++"],["cal","C/AL"],["capnp","Cap’n Proto"],["capnproto","Cap’n Proto"],["cc","C++"],["ceylon","Ceylon"],["cjs","JavaScript"],["clean","Clean"],["clj","Clojure"],["clojure","Clojure"],["clojure-repl","Clojure REPL"],["cls","Caché Object Script"],["cmake","CMake"],["cmake.in","CMake"],["cmd","Batch file (DOS)"],["coffee","CoffeeScript"],["coffeescript","CoffeeScript"],["console","Shell Session"],["coq","Coq"],["cos","Caché Object Script"],["cpp","C++"],["cr","Crystal"],["craftcms","Twig"],["crm","crmsh"],["crmsh","crmsh"],["crystal","Crystal"],["cs","C#"],["csharp","C#"],["cson","CoffeeScript"],["csp","CSP"],["css","CSS"],["cts","TypeScript"],["cxx","C++"],["d","D"],["dart","Dart"],["dcl","Clean"],["delphi","Delphi"],["dfm","Delphi"],["diff","Diff"],["django","Django"],["dns","DNS Zone"],["do","Stata"],["docker","Dockerfile"],["dockerfile","Dockerfile"],["dos","Batch file (DOS)"],["dpr","Delphi"],["dsconfig","dsconfig"],["dst","Dust"],["dts","Device Tree"],["dust","Dust"],["ebnf","Extended Backus-Naur Form"],["edn","Clojure"],["elixir","Elixir"],["elm","Elm"],["erb","ERB"],["erl","Erlang"],["erlang","Erlang"],["erlang-repl","Erlang REPL"],["ex","Elixir"],["excel","Excel formulae"],["exs","Elixir"],["f#","F#"],["f90","Fortran"],["f95","Fortran"],["feature","Gherkin"],["fix","FIX"],["flix","Flix"],["fortran","Fortran"],["fs","F#"],["fsharp","F#"],["gams","GAMS"],["gauss","GAUSS"],["gcode","G-code (ISO 6983)"],["gemspec","Ruby"],["gherkin","Gherkin"],["glsl","GLSL"],["gml","GML"],["gms","GAMS"],["go","Go"],["golang","Go"],["golo","Golo"],["gql","GraphQL"],["gradle","Gradle"],["graph","Roboconf"],["graphql","GraphQL"],["groovy","Groovy"],["gss","GAUSS"],["gyp","Python"],["h","C"],["h++","C++"],["haml","HAML"],["handlebars","Handlebars"],["haskell","Haskell"],["haxe","Haxe"],["hbs","Handlebars"],["hh","C++"],["hpp","C++"],["hs","Haskell"],["hsp","HSP"],["html","HTML, XML"],["html.handlebars","Handlebars"],["html.hbs","Handlebars"],["htmlbars","Handlebars"],["http","HTTP"],["https","HTTP"],["hx","Haxe"],["hxx","C++"],["hy","Hy"],["hylang","Hy"],["i7","Inform 7"],["iced","CoffeeScript"],["icl","Clean"],["inform7","Inform 7"],["ini","TOML, also INI"],["ino","Arduino"],["instances","Roboconf"],["ipython","Python"],["irb","Ruby"],["irpf90","IRPF90"],["isbl","ISBL"],["java","Java"],["javascript","JavaScript"],["jboss-cli","JBoss CLI"],["jinja","Django"],["jldoctest","Julia REPL"],["js","JavaScript"],["json","JSON"],["jsonc","JSON"],["jsp","Java"],["jsx","JavaScript"],["julia","Julia"],["julia-repl","Julia REPL"],["k","Q"],["kdb","Q"],["kotlin","Kotlin"],["kt","Kotlin"],["kts","Kotlin"],["lasso","Lasso"],["lassoscript","Lasso"],["latex","LaTeX"],["ldif","LDIF"],["leaf","Leaf"],["less","Less"],["lisp","Lisp"],["livecodeserver","LiveCode"],["livescript","LiveScript"],["llvm","LLVM IR"],["ls","Lasso"],["ls","LiveScript"],["lsl","LSL (Linden Scripting Language)"],["lua","Lua"],["m","Mercury"],["mak","Makefile"],["make","Makefile"],["makefile","Makefile"],["markdown","Markdown"],["mathematica","Mathematica"],["matlab","Matlab"],["maxima","Maxima"],["md","Markdown"],["mel","MEL"],["mercury","Mercury"],["mikrotik","MikroTik RouterOS script"],["mips","MIPS Assembly"],["mipsasm","MIPS Assembly"],["mizar","Mizar"],["mjs","JavaScript"],["mk","Makefile"],["mkd","Markdown"],["mkdown","Markdown"],["ml","OCaml"],["ml","SML (Standard ML)"],["mm","Objective-C"],["mma","Mathematica"],["mojolicious","Mojolicious"],["monkey","Monkey"],["moo","Mercury"],["moon","MoonScript"],["moonscript","MoonScript"],["mts","TypeScript"],["n1ql","N1QL"],["nc","G-code (ISO 6983)"],["nestedtext","Nested Text"],["nginx","Nginx config"],["nginxconf","Nginx config"],["nim","Nim"],["nix","Nix"],["nixos","Nix"],["node-repl","Node REPL"],["nsis","NSIS"],["nt","Nested Text"],["obj-c","Objective-C"],["obj-c++","Objective-C"],["objc","Objective-C"],["objective-c++","Objective-C"],["objectivec","Objective-C"],["ocaml","OCaml"],["openscad","OpenSCAD"],["osascript","AppleScript"],["oxygene","Oxygene"],["p21","STEP Part 21"],["parser3","Parser3"],["pas","Delphi"],["pascal","Delphi"],["patch","Diff"],["pb","PureBASIC"],["pbi","PureBASIC"],["pcmk","crmsh"],["pde","Processing"],["perl","Perl"],["pf","Packet Filter config"],["pf.conf","Packet Filter config"],["pgsql","PostgreSQL"],["php","php"],["php-template","PHP template"],["pl","Perl"],["plaintext","Plain text"],["plist","HTML, XML"],["pm","Perl"],["podspec","Ruby"],["pony","Pony"],["postgres","PostgreSQL"],["postgresql","PostgreSQL"],["powershell","PowerShell"],["pp","Puppet"],["processing","Processing"],["profile","Python profiler"],["prolog","Prolog"],["properties",".properties"],["proto","Protocol Buffers"],["protobuf","Protocol Buffers"],["ps","PowerShell"],["ps1","PowerShell"],["puppet","Puppet"],["purebasic","PureBASIC"],["pwsh","PowerShell"],["py","Python"],["pycon","python-repl"],["python","Python"],["python-repl","python-repl"],["q","Q"],["qml","QML"],["qt","QML"],["r","R"],["rb","Ruby"],["re","ReasonML"],["reasonml","ReasonML"],["rib","RenderMan RIB"],["roboconf","Roboconf"],["routeros","MikroTik RouterOS script"],["rs","Rust"],["rsl","RenderMan RSL"],["rss","HTML, XML"],["ruby","Ruby"],["ruleslanguage","Oracle Rules Language"],["rust","Rust"],["sas","SAS"],["scad","OpenSCAD"],["scala","Scala"],["scheme","Scheme"],["sci","Scilab"],["scilab","Scilab"],["scm","Scheme"],["scss","SCSS"],["sh","Bash"],["shell","Shell Session"],["shellsession","Shell Session"],["smali","Smali"],["smalltalk","Smalltalk"],["sml","SML (Standard ML)"],["sqf","SQF"],["sql","SQL"],["st","Smalltalk"],["stan","Stan"],["stanfuncs","Stan"],["stata","Stata"],["step","STEP Part 21"],["step21","STEP Part 21"],["stp","STEP Part 21"],["styl","Stylus"],["stylus","Stylus"],["subunit","SubUnit"],["sv","Verilog"],["svg","HTML, XML"],["svh","Verilog"],["swift","Swift"],["taggerscript","Tagger Script"],["tao","XL"],["tap","Test Anything Protocol"],["tcl","Tcl"],["tex","LaTeX"],["text","Plain text"],["thor","Ruby"],["thrift","Thrift"],["tk","Tcl"],["toml","TOML, also INI"],["tp","TP"],["ts","TypeScript"],["tsx","TypeScript"],["twig","Twig"],["txt","Plain text"],["typescript","TypeScript"],["v","Verilog"],["vala","Vala"],["vb","Visual Basic .NET"],["vbnet","Visual Basic .NET"],["vbs","VBScript"],["vbscript","VBScript"],["vbscript-html","VBScript in HTML"],["verilog","Verilog"],["vhdl","VHDL"],["vim","Vim Script"],["wasm","WebAssembly"],["wildfly-cli","JBoss CLI"],["wl","Mathematica"],["wren","Wren"],["wsf","HTML, XML"],["x++","X++"],["x86asm","Intel x86 Assembly"],["xhtml","HTML, XML"],["xjb","HTML, XML"],["xl","XL"],["xls","Excel formulae"],["xlsx","Excel formulae"],["xml","HTML, XML"],["xpath","XQuery"],["xq","XQuery"],["xqm","XQuery"],["xquery","XQuery"],["xsd","HTML, XML"],["xsl","HTML, XML"],["yaml","YAML"],["yml","YAML"],["zep","Zephir"],["zephir","Zephir"],["zone","DNS Zone"],["zsh","Bash"]]),Am="&#95;{{{CITATION{{{&#95;",Wb="{",wbe=Object.freeze(Object.defineProperty({__proto__:null,AI_MESSAGE_CONTAINER_CLASS:Cbe,ALIAS_TO_SUPPORTED_LANGUAGE:Sbe,CITATION_DIVIDER:Wb,CITATION_PREFIX:Am},Symbol.toStringTag,{value:"Module"}));function H9(n,e){return`[${Am}${n}${Wb}](${e})`}const Ebe=new RegExp(`\\[${Am}.*?\\)`,"g");function Tbe(n){return n.replace(Ebe,"")}const Ibe=2500,Abe=255,xC=wy(new Map),Jje=O(null),kbe=O(BV),xbe=O(Abe),_be=O(Ibe);function Mbe(n,e,t){return`${n}_${e}_${t}`}function Rbe(n,e){dt().set(xC,r=>{const i=r.get(n)??[],a=[];for(const o of e.editTargets){const s={id:Mbe(e.id,o.startIndex,o.endIndex),pageSuggestionId:e.id,startIndex:o.startIndex,endIndex:o.endIndex,text:e.text};a.push(s)}r.set(n,[...i,...a])})}function Zje(n,e){dt().set(xC,r=>{const i=r.get(n);i&&r.set(n,i.filter(a=>a.id!==e))})}function Xje(n){dt().set(xC,t=>{t.delete(n)})}function Pbe(n,e,t){dt().set(xC,i=>{const a=i.get(n);if(a){const o=a.filter(s=>s.pageSuggestionId===e);for(const s of o)s.text===void 0&&(s.text=""),s.text+=t}})}function Nbe(n){nc({scenario:"sideBySideMessages",page:"chat",customData:JSON.stringify({eventInfo_event:"receivedSxsEvent",eventInfo_sideBySideComparisonId:n})})}function Obe(n){const{sideBySideComparisonId:e,reason:t}=n;nc({scenario:"sideBySideMessages",page:"chat",customData:JSON.stringify({eventInfo_event:"skippedSxsMessages",eventInfo_sideBySideComparisonId:e,eventInfo_skippedReason:t})})}function Lbe(n){const{sideBySideComparisonId:e,sideBySideConfig:t}=n,{position:r,isDefault:i}=t;nt({pageName:"chat",sectionName:"sideBySideMessages",source:"selectedSxs",customData:JSON.stringify({eventInfo_sideBySideComparisonId:e,eventInfo_position:r,eventInfo_isControlMessage:i})})}function $9(n){const{sideBySideComparisonId:e,reason:t}=n;nt({pageName:"chat",sectionName:"sideBySideMessages",source:"defaultedSxs",customData:JSON.stringify({eventInfo_sideBySideComparisonId:e,eventInfo_defaultReason:t})})}function Dbe(n){const{card:e,messageId:t,conversationId:r}=n,i={eventName:"copilotImpression",eventInfo_impressionPage:"chat",eventInfo_impressionScenario:"answerCardReceived",eventInfo_answerCardType:e.type,eventInfo_messageId:t,eventInfo_conversationId:r};switch(e.type){case"image":i.eventInfo_answerCardContentLength=e.images.length;break;case"localEntity":i.eventInfo_answerCardContentLength=e.entities.length;break;case"financeChart":i.eventInfo_answerCardScenario=e.instrument.securityType;break}H.trackEvent({name:"system",data:i})}function jbe(n){const{card:e,messageId:t,conversationId:r}=n,i=performance.now(),a=Fe(o3);if(!a)return;const o={eventName:"copilotAnswerCardReceived",eventInfo_messageId:t,eventInfo_conversationId:r,eventInfo_cardType:e.type,eventInfo_duration:i-a};H.trackEvent({name:"system",data:o})}function Ube(n){const{message:e,conversationId:t}=n;for(const r of e.content)switch(r.type){case"card":Dbe({card:r.card,messageId:e.id,conversationId:t}),jbe({card:r.card,messageId:e.id,conversationId:t});break}}async function z9(n){H.setSettings({userConsentModelTraining:!n.optOutOfTraining,userConsentPersonalization:!n.optOutOfPersonalization,userSettingPhoneConnection:!n.optOutOfPhoneConnection,userSettingBrowserActions:n.allowBrowserActions,userSettingGenUI:!n.optInToGenerativeUI}),await xr({path:"/user/settings",args:{options:{method:"PATCH"},body:{optOutOfTraining:n.optOutOfTraining,optOutOfPersonalization:n.optOutOfPersonalization,optInToVoiceTraining:n.optInToVoiceTraining,optOutOfPhoneConnection:n.optOutOfPhoneConnection,optInToGenerativeUI:n.optInToGenerativeUI,allowBiometricDataUse:n.allowBiometricDataUse,allowOneDriveAccess:n.allowOneDriveAccess,allowBrowserActions:n.allowBrowserActions,features:n.features}}})}async function Fbe(){var e,t;const n=await Tn("/user",VD,{parseOptions:{safe:!0},query:{"api-version":"2"}}).then(r=>r.data);dt().set(KI,((e=n.remainingCalls)==null?void 0:e.podcastGeneration)??null),dt().set(Ly,((t=n.remainingCalls)==null?void 0:t.research)??null)}const Gt=dt();function YP(n){return{chatMode:ni(),timing:new zge(n),citationCount:0,imageCount:0,chainOfThoughtCount:0,inputMethod:"text"}}let hw=null;async function QP(){return hw||(hw=$(()=>import("./index-DS1hydBz.js"),[]).then(n=>n.applyPatch)),hw}class Bbe{constructor(e){B(this,"ws");B(this,"conversationMetadata",new Map);B(this,"conversationIdByMessageId",new Map);B(this,"messageIdByTaskId",new Map);B(this,"latestMessagePartIdentifier",null);B(this,"pendingSideBySideMessages",new Map);this.ws=e,this.send=this.send.bind(this),this.regenerate=this.regenerate.bind(this),this.sendChallengeResponse=this.sendChallengeResponse.bind(this),this.resetConversationState=this.resetConversationState.bind(this),this.resetConversationTiming=this.resetConversationTiming.bind(this),this.setConversationIdByMessageId=this.setConversationIdByMessageId.bind(this),this.setMessageIdByTaskId=this.setMessageIdByTaskId.bind(this),this.onSubmitMessageBlocked=this.onSubmitMessageBlocked.bind(this),this.callBeforeSendForConversation=this.callBeforeSendForConversation.bind(this),this.callOnSentForConversation=this.callOnSentForConversation.bind(this),this.setChatModeForConversation=this.setChatModeForConversation.bind(this),this.setInputMethodForConversation=this.setInputMethodForConversation.bind(this),this.setUserMessageForConversation=this.setUserMessageForConversation.bind(this),this.processEvent=this.processEvent.bind(this),this.sendMessagePreview=this.sendMessagePreview.bind(this),this.updateChatOptions=this.updateChatOptions.bind(this)}getConversationState(e){return this.conversationMetadata.has(e)||this.conversationMetadata.set(e,YP(performance.now())),this.conversationMetadata.get(e)}get latestMessagePartId(){return this.latestMessagePartIdentifier}resetConversationState(e,t){this.conversationMetadata.set(e,YP(t))}resetConversationTiming(e,t){this.getConversationState(e).timing.resetStartTime(t)}setConversationIdByMessageId(e){const{messageId:t,conversationId:r}=e;this.conversationIdByMessageId.set(t,r)}setMessageIdByTaskId(e){const{taskId:t,messageId:r}=e;this.messageIdByTaskId.set(t,r)}onSubmitMessageBlocked(e){const{timing:t,chatMode:r,inputMethod:i}=this.getConversationState(e);t.onSubmitMessageBlocked(r,i,e)}callBeforeSendForConversation(e){this.getConversationState(e).timing.onBeforeSend()}callOnSentForConversation(e,t){this.getConversationState(e).timing.onSent(t)}setChatModeForConversation(e,t){const r=this.getConversationState(e);r.chatMode=t}setInputMethodForConversation(e,t){const r=this.getConversationState(e);r.inputMethod=t}setUserMessageForConversation(e,t){const r=this.getConversationState(e);r.lastUserMessage=t}send(e){const{content:t,conversationId:r,data:i,mode:a,context:o}=e,s={event:"send",conversationId:r,content:Array.isArray(t)?t:[t],mode:a,context:o,...i};this.ws.send(JSON.stringify(s))}sendChallengeResponse(e){this.ws.send(JSON.stringify({event:"challengeResponse",token:e.token,method:e.method}))}regenerate(e){const{messageId:t,mode:r}=e,i={event:"regenerate",messageId:t,mode:r};this.ws.send(JSON.stringify(i))}sendMessagePreview(e){const{content:t,conversationId:r,data:i,mode:a,context:o}=e,s={event:"messagePreview",conversationId:r,content:Array.isArray(t)?t:[t],mode:a,context:o,...i};this.ws.send(JSON.stringify(s))}async updateChatOptions(){const t={event:"setOptions",...await ybe()};this.ws.send(JSON.stringify(t))}processEvent(e){switch("id"in e&&(this.latestMessagePartIdentifier=e.id??null),e.event){case"received":this.handleReceived(e);break;case"connected":this.handleConnected(e);break;case"emojiReaction":this.handleEmojiReaction(e);break;case"startMessage":this.handleStartMessage(e);break;case"appendText":this.handleAppendText(e);break;case"replaceText":this.handleReplaceText(e);break;case"invokeAction":this.handleInvokeAction(e);break;case"chainOfThought":this.handleChainOfThought(e);break;case"citation":this.handleCitation(e);break;case"generatingImage":this.handleGeneratingImage(e);break;case"imageGenerated":this.handleImageGenerated(e);break;case"partialImageGenerated":this.handlePartialImageGenerated(e);break;case"imageGenerationFailed":this.handleImageGenerationFailed(e);break;case"generatingCard":this.handleGeneratingCard(e);break;case"cardGenerationFailed":this.handleCardGenerationFailed(e);break;case"page":this.handlePage(e);break;case"titleUpdate":this.handleTitleUpdate(e);break;case"challenge":this.handleChallenge(e);break;case"card":this.handleCard(e);break;case"document":this.handleDocument(e);break;case"taskStart":this.handleTaskStart(e);break;case"taskUpdate":this.handleTaskUpdate(e);break;case"error":this.handleError(e);break;case"banned":this.handleBanned(e);break;case"suggestedFollowups":this.handleSuggestedFollowups(e);break;case"done":this.handleDone(e);break;case"startSuggestion":this.handleStartSuggestion(e);break;case"appendSuggestion":this.handleAppendSuggestion(e);break;case"activityStart":this.handleActivityStart(e);break;case"activityUpdate":this.handleActivityUpdate(e);break;case"memorySignal":this.handleMemorySignal(e);break;case"sideBySideComparison":this.handleSideBySideComparison(e);break;case"modeSelected":this.handleModeSelected(e);break}}handleMemorySignal(e){if(Ir("kill-memory-edf-basic"))return;const{messageId:t,partId:r,text:i,signalType:a}=e,o=this.conversationIdByMessageId.get(t);if(!o)return;this.getConversationState(o).timing.onMemorySignalReceived({messageId:t,conversationId:o}),Ht(o,c=>{const u=Dn(c,t);u&&u.content.push({type:"memorySignal",partId:r,text:i,signalType:a})})}handleSideBySideComparison(e){if(!$e("side-by-side-comparison"))return;const{sideBySideComparisonId:t,conversationId:r,options:i,defaultMessageId:a}=e;Nbe(t),ja(r,o=>{o.sideBySideComparisonId=t});for(const{messageId:o,position:s}of i)this.pendingSideBySideMessages.set(o,{position:s,isDefault:o===a})}handleModeSelected(e){const{messageId:t,mode:r}=e,i=this.conversationIdByMessageId.get(t),a=Fe(Cn);if(!i)return;$e("smart-mode-cot")&&a==="smart"&&r==="reasoning"&&Ht(i,s=>{const c=Dn(s,t);c&&c.content.push({type:"chainOfThought",text:re("chat.reasoningLoading.emptyCoTText"),partId:"-1"})})}clearAllStreamingStates(){const e=Gt.get(Sn);for(const t of e.values())ja(t.id,r=>{r.streamingState="idle"})}handleReceived(e){const{messageId:t,conversationId:r}=e;this.conversationIdByMessageId.set(t,r);const i=this.getConversationState(r);i.timing.onReceived({messageId:t,conversationId:r,chatMode:i.chatMode}),EP([`humanMessage_${t}`,`conversation_${r}`]),Gt.set(ol,a=>a&&!Ep()?a-1:a),Ht(r,a=>{const o=a.at(-1);(o==null?void 0:o.author)==="human"&&(o.id=t)}),vbe()}handleConnected(e){gp.trackLatestChatConnectedAssignment(e)}handleEmojiReaction(e){const{messageId:t,emoji:r}=e,i=this.conversationIdByMessageId.get(t);i&&Ht(i,a=>{const o=vne(a,t);o&&(o.emojiReaction=r)})}handleStartMessage(e){const{messageId:t,conversationId:r,createdAt:i}=e;this.conversationIdByMessageId.set(t,r);const a=this.getConversationState(r),{chatMode:o}=a;a.citationCount=0,a.timing.onStartMessage({messageId:t,conversationId:r,chatMode:o}),qE()&&Gt.set(Gc,"responding"),EP([`aiMesssage_${t}`,`conversation_${r}`]);const s=this.pendingSideBySideMessages.get(t),c={id:t,createdAt:i,author:"ai",content:[],mode:o,sideBySideConfig:s};ja(r,u=>{u.streamingState="streaming"}),Ht(r,u=>{u.length===0&&e4(Gt.get(ya),r)||u.push(c)})}handleAppendText(e){const{text:t,messageId:r,partId:i}=e,a=this.conversationIdByMessageId.get(r);if(!a)return;const o=this.getConversationState(a);o.timing.onFirstToken(r,o.chatMode,a),Ht(a,s=>{const c=Dn(s,r);if(c){Lu(a,c.id);let u=hc(c.content,i);if(!u)u={type:"text",text:"",partId:i},c.content.push(u);else if(u.type!=="text"){console.error(`appendText event with partId that is not a text item. Item is of type ${u.type}`,e);return}u.text=u.text.concat(t),yne(c)}})}handleReplaceText(e){const{text:t,messageId:r,partId:i}=e,a=this.conversationIdByMessageId.get(r);if(!a)return;const o=Gt.get(ai),s=o==null?void 0:o.sideBySideComparisonId;s&&(Obe({sideBySideComparisonId:s,reason:"replacedText"}),nA(a)),Ht(a,c=>{const u=Dn(c,r);if(u){Lu(a,u.id);let h=hc(u.content,i);if(!h)h={type:"text",text:"",partId:i},u.content.push(h);else if(h.type!=="text"){console.error("replaceText event with partId that is not a text item",e);return}h.text=t,h.citations=void 0}})}handleCitation(e){const{title:t,url:r,messageId:i,publisher:a,iconUrl:o,snippet:s}=e,c=this.conversationIdByMessageId.get(i);if(!c)return;const u=this.getConversationState(c);SW(r,c,i),Ht(c,h=>{const f=Dn(h,i);if(f){Lu(c,f.id);const p=bne(f.content);if(p){p.citations||(p.citations=[]);const g=p.citations.find(y=>y.url===r);let v;g?v=g.index:(u.citationCount+=1,v=`${u.citationCount}`,p.citations.push({index:v,url:r,iconUrl:o,title:t,publisher:a,snippet:s})),p.text=p.text.concat(H9(v,r))}}})}handleGeneratingImage(e){const{prompt:t,messageId:r,partId:i,progressionText:a}=e,o=this.conversationIdByMessageId.get(r);if(!o)return;const s=this.getConversationState(o);s.timing.onImageGenerationStart({messageId:r,conversationId:o,chatMode:s.chatMode}),Ht(o,c=>{const u=Dn(c,r);u&&u.content.push({type:"image",prompt:t,partId:i,partialGenerationStep:0,status:"generating",progressionText:a})})}handleImageGenerated(e){const{url:t,partId:r,messageId:i}=e,a=this.conversationIdByMessageId.get(i);if(!a)return;const o=this.getConversationState(a);o.imageCount+=1,o.timing.onImageReceived({messageId:i,conversationId:a,chatMode:o.chatMode}),Ht(a,s=>{const c=Dn(s,i);if(c){const u=hc(c.content,r);(u==null?void 0:u.type)==="image"&&(u.isPartiallyLoading=!1,u.url=t,u.partialGenerationStep=void 0,u.status="generated",u.progressionText=void 0)}})}handlePartialImageGenerated(e){const{content:t,messageId:r,partId:i}=e,a=this.conversationIdByMessageId.get(r);if(!a)return;const o=this.getConversationState(a);Ht(a,s=>{const c=Dn(s,r);if(c){const u=hc(c.content,i);if((u==null?void 0:u.type)==="image"){u.isPartiallyLoading=!0,u.url=`data:image/png;base64,${t}`;const h=(u.partialGenerationStep??0)+1;u.partialGenerationStep=h,u.status="generating",o.timing.onPartialImageReceived({messageId:r,conversationId:a,chatMode:o.chatMode,imageGenPhase:h})}}})}getImageGenerationErrorMessage(e){switch(e){case"not-signed-in":return;case"throttled":return;case"blocked":return;default:return re("error.imageGenerationFailed")}}handleImageGenerationFailed(e){const{messageId:t,partId:r,errorCode:i}=e,a=this.conversationIdByMessageId.get(t);if(!a)return;Ht(a,s=>{const c=Dn(s,t);c&&(c.content=c.content.filter(u=>u.type!=="image"||u.partId!==r))});const o=this.getImageGenerationErrorMessage(i);i==="not-signed-in"&&Gt.set(nu,{isOpen:!0,scenario:null,reason:"imageGeneration"}),o&&Tf(o,a)}handleCardGenerationFailed(e){const t=Gt.get(Ef);if(t&&this.isGeneratedCards(t)){Gt.set(Ef,void 0);const r=this.conversationIdByMessageId.get(e.messageId);if(!r)return;t==="quiz"&&Tf(re("quizCard.generatedQuizFailed"),r)}}handleGeneratingCard(e){const{type:t}=e;this.isGeneratedCards(t)&&Gt.set(Ef,t)}isGeneratedCards(e){return I3.safeParse(e).success}handleTitleUpdate(e){const{conversationId:t,title:r}=e;Gt.set(Sn,i=>zr(i,a=>{const o=a.get(t);o&&(o.title=r)}))}handleCard(e){const{messageId:t,partId:r,card:i}=e,a=this.conversationIdByMessageId.get(t);if(!a)return;const o=this.getConversationState(a);if(i.type==="ads"){vve({card:i,messageId:t,partId:r,conversationState:o,conversationId:a});return}Ht(a,s=>{const c=Dn(s,t);c&&c.content.push({type:"card",partId:r,card:i})})}handleDocument(e){const{messageId:t,partId:r,attachmentId:i,fileName:a,contentType:o}=e,s=this.conversationIdByMessageId.get(t);s&&Ht(s,c=>{const u=Dn(c,t);u&&u.content.push({type:"document",partId:r,attachmentId:i,fileName:a,contentType:o})})}handleBanned(e){const{expiresAt:t}=e,r=Dk(t);r&&jk(r,"chat",t)}handlePage(e){const{messageId:t,page:r,partId:i}=e,a=this.conversationIdByMessageId.get(t);a&&(Ht(a,o=>{const s=Dn(o,t);s&&s.content.push({type:"page",partId:i,page:r})}),_t.emit("pages:page-created",r))}handleStartSuggestion(e){const{pageId:t,suggestionId:r,editTargets:i}=e;Rbe(t,{id:r,text:void 0,editTargets:i})}handleAppendSuggestion(e){const{pageId:t,suggestionId:r,text:i}=e;Pbe(t,r,i)}handleActivityStart(e){if(!Uv())return;const{messageId:t,partId:r,activity:i}=e,a=this.conversationIdByMessageId.get(t);a&&Ht(a,o=>{const s=Dn(o,t);s?(Lu(a,s.id),s.content.push({activity:i,type:"activity",partId:r})):Zn({feature:"activity",errorType:"handleActivityStart",errorMessage:"Could not find message with messageId to start activity",customData:JSON.stringify({messageId:t})})})}async handleActivityUpdate(e){if(!Uv())return;const{messageId:t,partId:r,update:i}=e,a=this.conversationIdByMessageId.get(t);if(a)try{const o=await QP();Ht(a,s=>{const c=Dn(s,t);if(!c)return;const u=hc(c.content,r);if(!u||u.type!=="activity"){Zn({feature:"activity",errorType:"handleActivityUpdate",errorMessage:"Could not find activity message with partId in message with messageId",customData:JSON.stringify({messageId:t,partId:r})});return}o(u.activity,i)})}catch(o){Zn({feature:"activity",errorType:"handleActivityUpdate",errorMessage:"Error updating activity",exception:JSON.stringify({error:o})})}}processInvokeAction(e){const t=Gt.get(lt);if(t)switch(e.actionName){case"phone_send_message":{Ht(t,r=>{const i=n4(r);i&&i.content.push({type:"card",partId:Math.random().toString(),card:{type:"phoneSendMessage",actionId:e.actionId,contactName:e.parameters.contactName,text:e.parameters.text,phoneNumber:e.parameters.phoneNumber}})});break}case"edge_get_page_content":{const r=e.parameters.map(i=>({tabId:i.tabId,windowId:i.windowId,pageUrl:i.pageUrl??""}));tpe.run({actionId:e.actionId,tabs:r});break}case"edge_navigate_to":case"edge_switch_tab":case"edge_close_tabs":case"edge_group_open_browser_tabs":case"edge_ungroup_open_browser_tabs":case"edge_find_browser_tab_groups":case"edge_media_controls":case"edge_go_back_forward":case"computer_use":{npe.run(e);break}case"browser_search":{rpe.run({actionId:e.actionId,queries:e.parameters.queries,startTime:e.parameters.startTime?qP(e.parameters.startTime):void 0,endTime:e.parameters.endTime?qP(e.parameters.endTime):void 0,maxResults:e.parameters.maxResults,states:Zve(e.parameters.states)});break}}}handleInvokeAction(e){const{success:t,data:r}=$ve.safeParse(e);t?this.processInvokeAction(r):console.error("Invalid action data:",e)}handleTaskStart(e){const{messageId:t,task:r,partId:i}=e,a=this.conversationIdByMessageId.get(t);this.messageIdByTaskId.set(r.id,t);const o=new Date().toISOString();if(a){nbe([r],a,o),Gt.set(dd,!1),Ht(a,c=>{const u=Dn(c,t);if(u){const h=Vge(r,i,o);h&&u.content.push(h)}}),Xfe.run({task:r,action:"startTask"});const s=Gt.get(lt);r.type==="computerUse"&&a===s&&fve(r.conversationId,a),(r.type==="podcast"||r.type==="research")&&Fbe()}}async handleTaskUpdate(e){const{taskId:t,update:r}=e;if(cve(t,r))return;let i=!1;const a=this.messageIdByTaskId.get(t),o=a?this.conversationIdByMessageId.get(a):void 0;try{const s=await QP();a&&o&&Ht(o,c=>{const u=$e("ds-new-progress")||$e("multiple-research-tasks-in-conversation")&&rL,h=Dn(c,a,u);if(h){const f=pne(h.content),p=f==null?void 0:f.task;p&&p.type==="research"&&(s(p,r),ive(p,o))}}),tA(t,c=>{var u;if(c.type==="computerUse"&&s(c,r),c.type==="podcast"){const h=((u=c.podcast)==null?void 0:u.id)??"";s(c,r),c.podcast&&(c.podcast.id=h)}}),i=!0}catch(s){console.error("Error applying task update patch:",s)}if(i){const s=Gt.get(ya).get(t);switch(s==null?void 0:s.type){case"computerUse":hve(t,r);break;case"podcast":eve(s);break}}}handleSuggestedFollowups(e){const{disableMultiturn:t}=me.instance().config();if(!t){const{suggestions:r,messageId:i}=e,a=this.conversationIdByMessageId.get(i);a&&ja(a,o=>{o.suggestedFollowup={messageId:i,suggestions:r}})}}handleError(e){const{errorCode:t}=e;if(t==="over-turn-limit")Gt.set(ol,0);else if(t==="over-reasoning-quota"){!Gt.get(zl)&&Ep()&&me.instance().config().thinkDeeperFreemiumEnabled&&(Gt.set(cte,"chat-over-reasoning-quota"),Gt.set(ri,"reasoning-mode-pro-subscription")),Gt.set(Cn,ni());for(const[i]of this.conversationMetadata.entries())Tf(re("chat.overCapacity"),i)}else if(t==="over-task-quota"||t==="over-lifetime-task-quota")Gt.set(lte,t),Gt.set(ri,"over-task-quota");else if(t==="unknown-error")for(const[r]of this.conversationMetadata.entries())ja(r,i=>{i.streamingState="idle"});else if(t==="page-content-length-exceeded"||t==="page-count-exceeded"){_t.emit("page:message-error",t);for(const[r]of this.conversationMetadata.entries())ja(r,i=>{i.streamingState="idle"})}else for(const[r]of this.conversationMetadata.entries())Tf(re("error.eventNotRecognized"),r);Gt.set(dd,!1)}handleChainOfThought(e){const{messageId:t,partId:r,text:i}=e,a=this.conversationIdByMessageId.get(t);a&&Ht(a,o=>{const s=Dn(o,t);if(s){Lu(a,s.id);let c=hc(s.content,r);const u=this.getConversationState(a);if(c)c.type!=="chainOfThought"?console.error(`chainOfThought event with partId that is not a chainOfThought item. Item is of type ${c.type}`,e):c.text=c.text.concat(i);else{c={type:"chainOfThought",text:"",title:"",partId:r},s.content.push(c);const{title:h,text:f}=cbe(i);c.title=h,c.text=f,u.timing.onChainOfThoughtReceived({messageId:t,conversationId:a,chatMode:u.chatMode}),u.chainOfThoughtCount+=1}}})}handleChallenge(e){const t=()=>{const r=Gt.get(lt);if(!r)return;const{lastUserMessage:i}=this.getConversationState(r);i&&this.send(i)};if(e.method==="copilot"){const{parameter:r}=e,i=((7*Number(r)+21)%100).toString();this.sendChallengeResponse({method:"copilot",token:i}),t();return}Ir("kill-cf-turnstile")||U9(r=>{this.sendChallengeResponse({token:r,method:"cloudflare"}),t()})}handleDone(e){var u;qE()&&Gt.get(Gc)==="responding"&&Gt.set(Gc,"idle");const{messageId:t}=e,r=this.conversationIdByMessageId.get(t);if(!r)return;const i=this.getConversationState(r);i.timing.onLastToken({messageId:t,conversationId:r,citationCount:i.citationCount,imageCount:i.imageCount,chainOfThoughtCount:i.chainOfThoughtCount,chatMode:i.chatMode,inputMethod:i.inputMethod});const o=((u=Gt.get(Sn).get(r))==null?void 0:u.history)??[],s=Dn(o,t);Ht(r,h=>{if(!s)return;const f=Dn(h,s.id),p=s.content.find(g=>g.type==="image"&&g.partialGenerationStep!==void 0);if(f&&p){const g=hc(f.content,p.partId);g&&(g.partialGenerationStep===0?g.type="deleted":g.type==="image"&&(g.isPartiallyLoading=!1,g.partialGenerationStep=void 0,g.status="non-complete"))}});const c=this.pendingSideBySideMessages.get(t);c&&(this.pendingSideBySideMessages.delete(t),Ht(r,h=>{const f=Dn(h,t);f&&(f.sideBySideConfig={...c,isStreamingComplete:!0})})),this.pendingSideBySideMessages.size===0&&ja(r,h=>{h.streamingState="idle"}),Gt.set(Ef,void 0),Gt.set(dd,!1),window.setTimeout(()=>{Gt.set(DI,h=>zr(h,f=>{const p=f.get(r);p!=null&&p.has(t)&&(p.delete(t),p.size===0&&f.delete(r))}))},3e3),Gt.set(h3,!0),s&&Ube({message:s,conversationId:r}),ope.run({conversationMessages:o})}}async function Hbe(){try{const{load:n}=await $(async()=>{const{load:r}=await import("./botd.esm-f6NAJeRQ.js");return{load:r}},__vite__mapDeps([274,1,2])),e=await n({monitoring:!1}),{bot:t}=e.detect();return t}catch(n){return H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"BotDetectionError",eventInfo_details:"Failed on bot detection",eventInfo_errorMessage:n instanceof Error?n.message:"Unknown bot detection error"}}),!1}}async function $be(){return new Promise((n,e)=>{U9(async t=>{try{const r=await xr({path:"/challenges/verify",args:{body:{token:t,method:"cloudflare"}}}),{isValid:i}=await r.json();n(i)}catch(r){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"CloudflareChallengeVerificationError",eventInfo_details:"Error verifying Cloudflare challenge",eventInfo_errorMessage:r instanceof Error?r.message:""}})}e()})})}const zbe="eval/chat",fw=1e3,Vbe=3e4,Gbe=5e3,Kbe=1e4,qbe=3,JP=6e4;class Wbe{constructor({autoReconnect:e=!1}={}){B(this,"connection");B(this,"autoReconnect");B(this,"reconnectInterval");B(this,"maxReconnectInterval");B(this,"reconnectTimeout");B(this,"sendQueue",[]);B(this,"connecting",!1);B(this,"state",null);B(this,"cachedSendData",null);B(this,"pongTimeout",null);B(this,"windowStartTime",null);B(this,"connectionCount",0);B(this,"cooldownStart",null);B(this,"boundReconnectIfNeeded");B(this,"boundDisconnect");B(this,"boundVisibilityChange");B(this,"getUrl",null);B(this,"onopen");B(this,"onmessage");B(this,"onclose");B(this,"onerror");this.connection=null,this.autoReconnect=e,this.reconnectInterval=fw,this.maxReconnectInterval=e?Vbe:0,this.reconnectTimeout=null,this.onopen=null,this.onmessage=null,this.onclose=null,this.onerror=null,this.connect=this.connect.bind(this),this.reconnect=this.reconnect.bind(this),this.processSendQueue=this.processSendQueue.bind(this)}async initialize(){this.state=null,await this.connect(),this.autoReconnect&&(this.boundReconnectIfNeeded=this.reconnectIfNeeded.bind(this),this.boundDisconnect=this.disconnect.bind(this),this.boundVisibilityChange=()=>{document.visibilityState==="visible"&&this.reconnectIfNeeded()},window.addEventListener("online",this.boundReconnectIfNeeded),window.addEventListener("offline",this.boundDisconnect),document.addEventListener("visibilitychange",this.boundVisibilityChange))}async connect(){var t;if(((t=this.connection)==null?void 0:t.readyState)===WebSocket.CONNECTING||this.connecting||this.pongTimeout)return;if(!this.getUrl)throw new Error("getUrl function is not set");this.connecting=!0;const e=await this.getUrl();this.connection=new WebSocket(e),this.connecting=!1,this.connection.onopen=r=>{if(this.state=null,!Ir("kill-rapid-reconnect-detect")){const i=performance.now();!this.windowStartTime||i-this.windowStartTime>=Kbe?(this.windowStartTime=i,this.connectionCount=1):this.connectionCount+=1,this.connectionCount>=qbe&&(this.cooldownStart=i,this.windowStartTime=null,this.connectionCount=0,this.sendQueue=[])}this.onopen&&this.onopen(r),this.processSendQueue(),this.reconnectInterval=fw,this.reconnectTimeout&&(window.clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)},this.connection.onmessage=r=>{if(this.state!=="destroyed")try{const i=JSON.parse(r.data);this.onmessage&&this.onmessage(i),i.event==="pong"&&(this.removePongTimeout(),this.processSendQueue())}catch{}},this.connection.onclose=r=>{this.connection&&this.connection.bufferedAmount>0&&this.cachedSendData&&(this.sendQueue.push(this.cachedSendData),this.cachedSendData=null),this.onclose&&this.onclose(r),this.autoReconnect&&this.state===null&&this.reconnect(),this.removePongTimeout()},this.connection.onerror=r=>{this.onerror&&this.onerror(r),this.connection&&this.connection.close(),this.removePongTimeout()}}reconnect(){if(this.reconnectTimeout&&window.clearTimeout(this.reconnectTimeout),!Ir("kill-rapid-reconnect-detect")&&this.cooldownStart){const e=performance.now()-this.cooldownStart;if(e<JP){const t=JP-e;this.reconnectTimeout=window.setTimeout(this.connect,t);return}this.cooldownStart=null,this.reconnectInterval=fw}this.reconnectTimeout=window.setTimeout(this.connect,this.reconnectInterval),this.reconnectInterval=Math.min(this.reconnectInterval*2,this.maxReconnectInterval)}processSendQueue(){if(this.sendQueue.length>0){const e=this.sendQueue;this.sendQueue=[];for(const t of e)this.send(t)}}reconnectIfNeeded(){if(this.state!=="destroyed"){if(!this.connection||this.connection.readyState!==WebSocket.OPEN){this.reconnect();return}this.pongTimeout===null&&(this.connection.send(JSON.stringify({event:"ping"})),this.pongTimeout=window.setTimeout(()=>{var e;this.pongTimeout=null,(e=this.connection)==null||e.close(),this.reconnect()},Gbe))}}removePongTimeout(){this.pongTimeout!==null&&(window.clearTimeout(this.pongTimeout),this.pongTimeout=null)}send(e){if(this.state!=="destroyed")if(this.connection&&this.connection.readyState===WebSocket.OPEN&&this.pongTimeout===null)try{this.cachedSendData=e,this.connection.send(e)}catch{this.sendQueue.push(e),this.connect()}else this.sendQueue.push(e),this.connect()}cleanup(){this.boundReconnectIfNeeded&&window.removeEventListener("online",this.boundReconnectIfNeeded),this.boundDisconnect&&window.removeEventListener("offline",this.boundDisconnect),this.boundVisibilityChange&&document.removeEventListener("visibilitychange",this.boundVisibilityChange)}disconnect(){this.connection&&(this.state="disconnected",this.connection.close())}destroy(){this.connection&&(this.state="destroyed",this.cleanup(),this.connection.close(),this.connection=null,this.windowStartTime=null,this.connectionCount=0,this.cooldownStart=null)}}async function go({useMockConnection:n}={}){const e=async({cursor:t})=>{const r=$8()?zbe:"chat";return t?wP(r,{cursor:t}):wP(r)};return lv.get({getUrl:e})}async function Ybe({getUrl:n}){if(typeof WebSocket>"u")return{destroy:()=>{},send:()=>{},regenerate:()=>{},sendContext:()=>{},sendAudioStart:()=>{},sendAudio:()=>{},sendAudioEnd:()=>{},setCallType:()=>{},stop:()=>{},setOnEvent:()=>()=>{},sendChallengeResponse:()=>{},sendActionResult:()=>{},sendMessagePreview:()=>{},updateChatOptions:()=>Promise.resolve(),selectSxSMessage:()=>{},resetConversationState:()=>{},resetConversationTiming:()=>{},setConversationIdByMessageId:()=>{},setMessageIdByTaskId:()=>{},setChatModeForConversation:()=>{},setInputMethodForConversation:()=>{},callBeforeSendForConversation:()=>{},callOnSentForConversation:()=>{},setUserMessageForConversation:()=>{},onSubmitMessageBlocked:()=>{}};const e=Ep(),t=!!me.instance().config().isBotDetectionEnabled;if($e("client-side-request-challenge")&&!Ir("kill-client-side-request-challenge")&&t&&!e){const r=await Hbe(),i=!r||await $be();if(H.trackEvent({name:"system",data:{eventName:"botDetectionTriggered",eventInfo_result:i?"success":"failed",eventInfo_isBot:r}}),!i)return Promise.reject()}return new Promise((r,i)=>{const a=Ir("kill-chat-auto-reconnect"),o=new Wbe({autoReconnect:!a}),s=new Bbe(o);o.getUrl=()=>n({cursor:s.latestMessagePartId}),o.onopen=async()=>{o.onmessage=c=>{try{NM.parse(c)}catch(u){u instanceof wv&&vp(u,"/chat")}s.processEvent(c)},await s.updateChatOptions(),r({destroy:()=>{o.destroy(),s.clearAllStreamingStates()},stop:(c={})=>{const{conversationId:u,taskId:h}=c;o.send(JSON.stringify({event:"stop",conversationId:u})),h&&o.send(JSON.stringify({event:"send",conversationId:u,content:[{type:"command",command:{type:"cancelTask",taskId:h}}],mode:"research"})),u&&ja(u,f=>{f.streamingState="idle"})},send:s.send,regenerate:s.regenerate,sendContext:c=>{o.send(JSON.stringify({event:"sendContext",context:c}))},sendAudioStart:(c,u,h)=>{const f={event:"audioStart",conversationId:c,options:u,clientType:h};o.send(JSON.stringify(f))},sendAudio:c=>{const u={event:"audio",audio:c};o.send(JSON.stringify(u))},sendAudioEnd:()=>{const c={event:"audioEnd"};o.send(JSON.stringify(c))},setCallType:c=>{const u={event:"setCallType",callType:c};o.send(JSON.stringify(u))},sendChallengeResponse:s.sendChallengeResponse,setOnEvent:c=>{o.onmessage=u=>{try{NM.parse(u),s.processEvent(u)}catch(h){h instanceof wv&&vp(h,"/chat")}c(u)}},sendActionResult:c=>{o.send(JSON.stringify({event:"actionResult",actionId:c.actionId,result:c.result}))},selectSxSMessage:c=>{const{sideBySideComparisonId:u,selectedMessageId:h}=c,f={event:"selectMessage",sideBySideComparisonId:u,selectedMessageId:h};o.send(JSON.stringify(f))},resetConversationState:s.resetConversationState,resetConversationTiming:s.resetConversationTiming,setConversationIdByMessageId:s.setConversationIdByMessageId,setMessageIdByTaskId:s.setMessageIdByTaskId,setChatModeForConversation:s.setChatModeForConversation,setInputMethodForConversation:s.setInputMethodForConversation,callBeforeSendForConversation:s.callBeforeSendForConversation,callOnSentForConversation:s.callOnSentForConversation,setUserMessageForConversation:s.setUserMessageForConversation,onSubmitMessageBlocked:s.onSubmitMessageBlocked,sendMessagePreview:s.sendMessagePreview.bind(s),updateChatOptions:s.updateChatOptions.bind(s)})},o.onclose=()=>{},o.onerror=c=>{const u=c instanceof ErrorEvent?c.message:"Unknown WebSocket error";H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"ChatWebsocketError",eventInfo_errorMessage:u,eventInfo_details:JSON.stringify(c)}}),i(new Error(`WebSocket connection error: ${u}`))},o.initialize().catch(c=>{const u=c instanceof Error?c.message:"Unknown WebSocket error";H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"ChatWebsocketInitializationError",eventInfo_errorMessage:u,eventInfo_details:c instanceof Error?c.stack??"":""}}),i(new Error(`WebSocket initialization error: ${u}`))})})}async function Wk(){if(lv.isInstantiated){const n=Fe(ai),e=(n==null?void 0:n.streamingState)==="streaming",t=await lv.get();t.stop(),t.destroy(),t.stop({conversationId:n==null?void 0:n.id}),lv.reset();try{H.trackEvent({name:"system",data:{eventName:"chatClientReset",eventInfo_isMessageStreaming:e}})}catch{}}}const lv=new Kl(n=>Ybe(n));function Qbe(n,e,t,r={text:"",atTimestamp:0,files:[]}){return t?e.length!==r.files.length?!0:!!!(n&&n.length>=t.minTextLength)||r.atTimestamp&&r.atTimestamp+t.debounceInMilliseconds>=Date.now()?!1:n&&r.text&&(n.includes(r.text)||r.text.includes(n))?Math.abs((n.length-r.text.length)/r.text.length)>=t.textDeltaPercent/100:!0:!1}const Hs=O(null),V9=O(n=>{const e=n(Hs);return(e==null?void 0:e.type)==="attachments"?e.uploadAttachments:[]},(n,e,t,r)=>{const i=n(Hs),a=n(V9),o=typeof t=="function"?t(a):t;o.length===0&&(i==null?void 0:i.type)!=="attachments"||e(Hs,{type:"attachments",uploadAttachments:o,source:r})}),Js=O(n=>{const e=n(Hs);return(e==null?void 0:e.type)==="tabs"?e.userAddedTabs:new Map},(n,e,t)=>{const r=n(Hs),i=n(Js),a=typeof t=="function"?t(i):t;a.size===0&&(r==null?void 0:r.type)!=="tabs"||e(Hs,{type:"tabs",userAddedTabs:a})}),Jbe=O(n=>{const e=n(Hs);return(e==null?void 0:e.type)==="attachments"&&e.uploadAttachments.length>0}),Zbe=O(n=>{const e=n(Hs);return(e==null?void 0:e.type)==="tabs"&&e.userAddedTabs.size>0}),ZP=O(new Map);function Xbe(){var e;const n=Fe(P3);if(n)return{character:{id:n.id,locationId:(e=n.location)==null?void 0:e.id}}}function G9(){const n=Zp(Sn),e=pe(My);return m.useCallback((t,r)=>{n(i=>{const a=i.get(t);if(a){const{history:o}=a;r(o);const s=o.at(-1);if(s){const c=new Date(a.updatedAt),u=new Date(s.createdAt);c<u&&(a.updatedAt=s.createdAt)}o.length>2&&(a.isNew=!1,e(!0))}return i})},[n,e])}const eye=dt();function K9(n,e){dt().set(Sn,t=>zr(t,r=>{const i=r.get(n);if(i){const{history:a}=i;e(a);const o=a.at(-1);if(o){const s=new Date(i.updatedAt),c=new Date(o.createdAt);s<c&&(i.updatedAt=o.createdAt)}a.length>2&&(i.isNew=!1,eye.set(My,!0))}}))}const tye=5e3,nye="largest-contentful-paint";function rye(n,e=tye){if(!iye())return YE(n,e);try{return oye(n,e)}catch{return YE(n,e)}}function iye(){return"PerformanceObserver"in window}function YE(n,e){const t=setTimeout(n,e);return()=>clearTimeout(t)}function aye(n){typeof window.requestIdleCallback<"u"?window.requestIdleCallback(n):setTimeout(n,0)}function oye(n,e){let t=!1;const r=new PerformanceObserver(s=>{if(t)return;s.getEntries().length>0&&a()});try{r.observe({type:nye,buffered:!0})}catch{return YE(n,e)}const i=setTimeout(()=>{t||a()},e);function a(){t=!0,r.disconnect(),aye(n)}function o(){t||(t=!0,r.disconnect(),clearTimeout(i))}return o}function sye(){const n=Ai("kill-bing-uet"),e=N(_r),t=AC(e);m.useEffect(()=>{const r=_l(),i=!!uI(),a=t?i&&r.advertising:!0;if(n||!a||!e)return;const o=document.createElement("script");o.src="https://bat.bing.com/bat.js",o.defer=!0,o.onload=()=>{if(!window.UET)return;window.uetq=window.uetq??[];const u={ti:"355045625",enableAutoSpaTracking:!0};window.uetq=new window.UET(u),window.uetq.push("pageLoad")};const c=rye(()=>{document.querySelector('script[src="https://bat.bing.com/bat.js"]')||document.head.appendChild(o)});return()=>{c();try{const u=document.querySelector('script[src="https://bat.bing.com/bat.js"]');u&&document.head.removeChild(u)}catch{}}},[n,e,t])}let XP=!1;function cye(){XP||(XP=!0,window.uetq=window.uetq??[],window.uetq.push("event","outbound_click",{}))}function q9(n){var p;const{inEeaPlusRegion:e,labsFeatureEnabled:t,region:r,isUpsellFeatureEnabled:i,isAuthenticated:a,isTeenUser:o,isProUser:s,skipProUserCheck:c}=n;if(e&&r!=="CA"&&!t)return!1;const u=!r||QV.includes(r),h=((p=me.instance().config().actions)==null?void 0:p.overrideFreemiumActionsUpsellFeatureEnabled)??!1;return s||c||(i||h)&&a&&!o&&!u}function W9(){const n=Fe(zl),e=$e("labs-actions"),t=$e("labs-actions-skipprocheck"),r=me.instance().config().proSubscription.enabled,i=Ep(),a=Fe(jy),o=Fe(_r),s=!!Fe(D3);return q9({inEeaPlusRegion:s,labsFeatureEnabled:e,region:o,isUpsellFeatureEnabled:r,isAuthenticated:i,isTeenUser:a,isProUser:n,skipProUserCheck:t})}function Y9(n){const{actionsAvailableForAccount:e,actionsAvailableForSurface:t}=n;return e&&t}async function lye(){var r;const n=W9(),t=await(((r=me.instance().config().actions)==null?void 0:r.enableActions)??(()=>Promise.resolve(!1)))();return Y9({actionsAvailableForAccount:n,actionsAvailableForSurface:t})}function Q9(n,e,t){return n&&(t&&e)}async function e6e(){var i,a;const n=W9(),t=await(((i=me.instance().config().actions)==null?void 0:i.enableActions)??(()=>Promise.resolve(!1)))(),r=((a=me.instance().config().actions)==null?void 0:a.overrideLabsActionsFeatureEnabled)??!1;return Q9(n,t,r)}function J9(){const n=ee("smart-mode-6e0b4c6f"),e=ee("smart-mode-cd0c997b"),t=X9(e),r=re(n||e?"composer.chatModes.smart.coachmarkDescriptionGPT5Variant":"composer.chatModes.smart.description");return{title:n?tL:eL,description:re(t),coachmarkDescription:r}}function Z9(){const n=$e("smart-mode-6e0b4c6f"),e=$e("smart-mode-cd0c997b"),t=X9(e);return{title:n?tL:eL,description:re(t)}}function X9(n){return n?"composer.chatModes.smart.descriptionGPT5Variant":"composer.chatModes.smart.description"}function eU(n){return n?n.startsWith("!"):!1}function Up({chatMode:n,forceExcludeModelName:e=!1}){const r=$e("model-in-mode-name")&&!e;let i=re(`composer.chatModes.${n}.title`);return n==="chat"&&r?i=re("composer.chatModes.chat.titleWithModel"):n==="reasoning"?i=r?ZV:X5:n==="smart"&&(i=Z9().title),i}function uye(n){const e=Z9();return n==="smart"?e.description:re(`composer.chatModes.${n}.description`)}const eN={global:["https://ad.doubleclick.net/ddm/activity/src=8406097;type=ofco;cat=lrn_uni;u1={REGION};u2={LANG_LOCALE};u6=CMC;u50=submit_message;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;npa=;ord=1;num={CACHE_BUSTER}"],us:["https://px.ads.linkedin.com/collect/?fmt=gif&pid=7850&url=copilot.microsoft.com/ChatSend","https://secure.adnxs.com/px?id=1869141&t=2","https://servedby.flashtalking.com/spot/1/5155;147512;16638/?spotName=USA_FY25H2_Copilot_Consumer_Chat_Send_button_FT_2_7_25&cachebuster={CACHE_BUSTER}","https://alb.reddit.com/rp.gif?id=a2_gi5vc4m557wn&event=Custom&m.customEventName=COPChatSend&integration=noscript","https://analytics.tiktok.com/api/v2/pixel_event_track?pixel_code=CUUELO3C77U6K9SI3QSG&event=SendMessage&event_id={CACHE_BUSTER}","https://tr.snapchat.com/p?pid=68db1ef4-2290-4224-a91a-df01d273a994&ev=START_CHECKOUT&v=2.3&rand={CACHE_BUSTER}&pl=https://copilot.microsoft.com/","https://tr.snapchat.com/cm/s?pnid=140","https://www.facebook.com/tr?id=1770559986549030&ev=COPChatSend&noscript=1","https://insight.adsrvr.org/track/pxl/?adv=tq5ketp&ct=0:e8n8utj&fmt=3&td1={td1}&td2={td2}&td3={td3}&td4={td4}&td5={td5}&td6={td6}"],gb:["https://secure.adnxs.com/px?id=1869542&t=2&seg=39793132&consent={CONSENT}","https://px.ads.linkedin.com/collect/?fmt=gif&pid=7850&url=copilot.microsoft.com/ChatSend","https://servedby.flashtalking.com/spot/1/3360;147492;16970/?spotName=GBR_FY25H2_Copilot_Consumer_Chat_Send_FT_2_7_25&cachebuster={CACHE_BUSTER}","https://analytics.tiktok.com/api/v2/pixel_event_track?pixel_code=CUUELO3C77U6K9SI3QSG&event=SendMessage&event_id={CACHE_BUSTER}","https://www.facebook.com/tr?id=1770559986549030&ev=COPChatSend&noscript=1","https://tr.snapchat.com/p?pid=68db1ef4-2290-4224-a91a-df01d273a994&ev=START_CHECKOUT&v=2.3&rand={CACHE_BUSTER}&pl=https://copilot.microsoft.com/","https://tr.snapchat.com/cm/s?pnid=140","https://insight.adsrvr.org/track/pxl/?adv=csnj4o5&ct=0:7s8ltxf&fmt=3&td1={td1}&td2={td2}&td3={td3}&td4={td4}&td5={td5}&td6={td6}"],other:["https://www.facebook.com/tr?id=1770559986549030&ev=COPChatSend&noscript=1","https://analytics.tiktok.com/api/v2/pixel_event_track?pixel_code=CUUELO3C77U6K9SI3QSG&event=SendMessage&event_id={CACHE_BUSTER}"]},uv={onPageLoad:{global:["https://ad.doubleclick.net/ddm/activity/src=8406097;type=ofco;cat=lp_uniq;u1={REGION};u2={LANG_LOCALE};u6=CMC;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;npa=;ord=1;num={CACHE_BUSTER}"],us:["https://www.facebook.com/tr?id=1770559986549030&ev=PageView&noscript=1","https://px.ads.linkedin.com/collect/?fmt=gif&pid=7850&url=copilot.microsoft.com/custom-pageload","https://secure.adnxs.com/px?id=1869069&t=2","https://servedby.flashtalking.com/spot/1/5155;147507;16638/?spotName=USA_FY25H2_Copilot_Consumer_Page_Load_FT_2_7_25&cachebuster={CACHE_BUSTER}","https://alb.reddit.com/rp.gif?id=a2_gi5vc4m557wn&event=PageVisit&integration=noscript","https://analytics.tiktok.com/api/v2/pixel_event_track?pixel_code=CUUELO3C77U6K9SI3QSG&event=ViewContent&event_id={CACHE_BUSTER}","https://tr.snapchat.com/p?pid=68db1ef4-2290-4224-a91a-df01d273a994&ev=PAGE_VIEW&v=2.3&rand={CACHE_BUSTER}&pl=https://copilot.microsoft.com","https://tr.snapchat.com/cm/s?pnid=140","https://insight.adsrvr.org/track/pxl/?adv=tq5ketp&ct=0:tzodkxv&fmt=3&td1={td1}&td2={td2}&td3={td3}&td4={td4}&td5={td5}&td6={td6}"],gb:["https://www.facebook.com/tr?id=1770559986549030&ev=PageView&noscript=1","https://px.ads.linkedin.com/collect/?fmt=gif&pid=7850&url=copilot.microsoft.com/custom-pageload","https://secure.adnxs.com/px?id=1869539&seg=39793125&t=2&consent={CONSENT}","https://servedby.flashtalking.com/spot/1/3360;147490;16970/?spotName=GBR_FY25H2_Copilot_Consumer_Page_Load_FT_2_7_25&cachebuster={CACHE_BUSTER}","https://analytics.tiktok.com/api/v2/pixel_event_track?pixel_code=CUUELO3C77U6K9SI3QSG&event=ViewContent&event_id={CACHE_BUSTER}","https://tr.snapchat.com/p?pid=68db1ef4-2290-4224-a91a-df01d273a994&ev=PAGE_VIEW&v=2.3&rand={CACHE_BUSTER}&pl=https://copilot.microsoft.com","https://tr.snapchat.com/cm/s?pnid=140","https://insight.adsrvr.org/track/pxl/?adv=csnj4o5&ct=0:2slc99p&fmt=3&td1={td1}&td2={td2}&td3={td3}&td4={td4}&td5={td5}&td6={td6}"],other:["https://www.facebook.com/tr?id=1770559986549030&ev=PageView&noscript=1","https://analytics.tiktok.com/api/v2/pixel_event_track?pixel_code=CUUELO3C77U6K9SI3QSG&event=ViewContent&event_id={CACHE_BUSTER}"]},onMessageSend:eN,onStartVoiceChat:eN,onSuggestionChipClicked:{global:[],us:[],gb:[],other:[]},onDiscoverCardClicked:{global:[],us:[],gb:[],other:[]},onQueryParamSubmit:{global:[],us:[],gb:[],other:[]}},dye={onPageLoad:{behavior:20,Content:{Id:"CMCChatLoaded",cN:"CMC Chat Loaded"}},onMessageSend:{behavior:63,Content:{Id:"ChatManualMessage",cN:"Chat Manual Message"}},onStartVoiceChat:{behavior:300,Content:{Id:"VoiceMessageClick",cN:"Voice Message Click"}},onSuggestionChipClicked:{behavior:60,Content:{Id:"SuggestionChipClicked",cN:"Suggestion Chip Clicked"}},onDiscoverCardClicked:{behavior:144,Content:{Id:"DiscoverCardClicked",cN:"Discover Card Clicked"}},onQueryParamSubmit:{behavior:141,Content:{Id:"QueryParamMessageSubmit",cN:"Query Param Message Submit"}}};function hye(n,e){return e==="US"?uv[n].us:e==="GB"?uv[n].gb:e&&["AU","CA","DE","FR","JP"].includes(e)?uv[n].other:[]}function fye(n){if(!$e("ads-pixels"))return;const e=dt().get(_r),t=Dt.language,r=Date.now().toString(),i=uv[n].global,a=hye(n,e),{set:o}=dt();o(g3,s=>{for(const c of i.concat(a))s[c]||(s[c]={url:c.replace("{CACHE_BUSTER}",r).replace("{REGION}",e??"").replace("{LANG_LOCALE}",t).replace("{CONSENT}",gye(e)).replace("{td1}",e??"").replace("{td2}",t).replace("{td3}","CMC").replace("{td4}","").replace("{td5}","").replace("{td6}",vye(n)),isMounted:!0,timestamp:Date.now()});return{...s}})}function pye(n){$e("custom-1ds")&&(window.OneDsAzureAnalytics.capturePageAction(null,dye[n]),jL())}function rd(n){try{fye(n),pye(n)}catch{Zn({feature:"sendIdeasTelemetry",customData:JSON.stringify({eventName:n})})}}function mye(n){rd(n==="suggestion"?"onSuggestionChipClicked":n==="discover"?"onDiscoverCardClicked":n==="queryParam"?"onQueryParamSubmit":"onMessageSend")}function gye(n){return(n&&hy.includes(n))===!0?_l().advertising?"1":"0":""}function vye(n){switch(n){case"onPageLoad":return"page_load";case"onMessageSend":return"submit_message";case"onStartVoiceChat":return"voice_message";case"onSuggestionChipClicked":return"suggestion_chip";case"onDiscoverCardClicked":return"discover_card";case"onQueryParamSubmit":return"query_param_submit";default:return""}}const Na=dt(),tN={};async function tU(n){const{text:e,filesWithAttachment:t=[],command:r}=n,i=Fe(Cn),a=Fe(lt),{result:o}=await spe.run({chatMode:i,message:e??""}),s=t.length===0||t.every(({error:f,attachment:p})=>!!f||!p);return{isSubmittable:!!a&&!(!e&&s&&!r),shouldDropAccordingToMiddleware:!!o}}async function nU(n,e=!1){const{text:t,filesWithAttachment:r=[],inputMethod:i,command:a,context:o,reference:s,galleryImageUrl:c}=n,u=Xbe(),h=Fe(Cn),f=Fe(lt),p=Fe(Hl),g=Fe(Js);if(!f)throw new Error("No conversation ID found");let v=0,y=0;const b=[];for(const k of r)k.attachment&&(k.attachment.item.type==="image"?v+=1:k.attachment.item.type==="document"&&(k.attachment.item.partId=`${y}`,y+=1),b.push(k));if(c){const k=Tye(c);b.push(k)}const C=[],S={id:"",createdAt:new Date().toISOString(),author:"human",content:[],inputMethod:i};p&&p.conversationId===f&&(S.brand=p);for(const{attachment:k}of b)k&&(S.content.push(k.item),C.push(k.content));if(g.size>0&&(i!=="askCopilot"?S.content.push({type:"browserTabs",tabs:Array.from(g.values()).map(k=>({id:k.id,title:k.title,url:k.url,windowId:k.windowId,favIconUrl:k.favIconUrl}))}):Na.set(Js,new Map)),t){S.content.push({type:"text",text:t});let{textToSend:k}=await cpe.run({textToSend:t,chatMode:h});g.size>0&&!k.startsWith("/")&&(k=`${re("composer.multiTabs.multitabsprompt",{CountOfAddTabs:g.size})} ${k}`),C.push({type:"text",text:k})}a&&C.push({type:"command",command:a}),s&&C.push({type:"reference",reference:s}),!(a&&l.union([xy,Nl]).safeParse(a.type).success)&&!e&&K9(f,k=>{k.push(S)});const{sendData:T,additionalData:A}=await Yfe.run(S);return{sendMessageParams:{content:C,conversationId:f,data:T,mode:h,context:{...u,...o,ads:p?{showroom:{brandId:p.brandId,adId:p.adId??void 0,scenario:"chat"}}:void 0}},newMessage:S,filesToSubmit:b,additionalData:A,imagesUploaded:v,documentsUploaded:y}}async function bye(n){var S,E,T,A,I;const{text:e,inputMethod:t,scenario:r,customData:i,entryPoint:a}=n,o=Fe(Cn),s=Fe(lt),c=Fe(Hl),u=Fe(Js),h=Fe(ZP),f=$e("multi-file-upload"),{isSubmittable:p,shouldDropAccordingToMiddleware:g}=await tU(n);if(g){o==="computerUse"&&Na.set(Cn,ni());return}const v=performance.now();if(Na.set(o3,v),Na.set(CC,"bottom"),!p||!s)return;await lye()&&(o==="computerUse"?(nt({source:"copilotActionsStartTask",customData:JSON.stringify({conversationId:s})}),Na.set(dd,!0)):Na.set(dd,!1)),$9({sideBySideComparisonId:s,reason:"sentNewMessage"}),nA(s);const y=await nU(n);Na.set(Sn,k=>zr(k,x=>{const _=x.get(s);_&&(_.suggestedFollowup=void 0)}));const b=await go({useMockConnection:eU(e)});u.size>0&&Na.set(Js,new Map),h.size>0&&Na.set(ZP,new Map),b.send(y.sendMessageParams),b.resetConversationState(s,v),b.setChatModeForConversation(s,o),b.setInputMethodForConversation(s,t),b.callBeforeSendForConversation(s),b.callOnSentForConversation(s,y.additionalData),b.setUserMessageForConversation(s,y.sendMessageParams);const C={eventName:"copilotCompose",eventInfo_conversationId:s,eventInfo_inputMethod:t,eventInfo_numImagesUploaded:y.imagesUploaded,eventInfo_numDocumentsUploaded:y.documentsUploaded,eventInfo_mode:o,eventInfo_landingPage:H.getLandingPage(),...y.filesToSubmit.length>0?{eventInfo_uploadFileSize:((E=(S=y.filesToSubmit[0])==null?void 0:S.file)==null?void 0:E.size)??0,eventInfo_uploadFileType:(A=(T=y.filesToSubmit[0])==null?void 0:T.attachment)==null?void 0:A.type}:{}};f&&(C.eventInfo_uploadFilesInfo=JSON.stringify(y.filesToSubmit.map(({file:k,attachment:x,scenario:_})=>({scenario:_,type:(x==null?void 0:x.type)??"",size:(k==null?void 0:k.size)??""})))),y.additionalData&&(C.eventInfo_additionalData=y.additionalData),r&&(C.eventInfo_scenario=r),i&&(C.eventInfo_customData=i),c&&(C.eventInfo_adsContext=JSON.stringify({showroomBrandId:c.brandId,showroomBrandName:(I=c.brandLogo)==null?void 0:I.businessName})),a&&(C.eventInfo_entryPoint=a),H.trackEvent({name:"interaction",data:C}),cye(),mye(t),pbe(),o==="computerUse"&&Na.set(Cn,ni())}async function yye(){const n=Fe(lt);n&&(await go()).onSubmitMessageBlocked(n)}async function Cye(){var r,i;const n=await go(),e=Fe(lt),t=(i=(r=r4(e))==null?void 0:r.part.task)==null?void 0:i.id;e&&(nA(e),$9({sideBySideComparisonId:e,reason:"stoppedMessage"})),n.stop({conversationId:e,taskId:t})}async function Sye(n){const{messageId:e}=n,t=performance.now(),r=Fe(lt);if(!r)return;K9(r,a=>{const o=n4(a);o&&o.id===e&&a.pop()});const i=await go();i.regenerate(n),i.resetConversationTiming(r,t),i.setChatModeForConversation(r,Fe(Cn)),i.callBeforeSendForConversation(r)}async function wye(n){const{text:e,filesWithAttachment:t=[]}=n,r=Fe(lt),i=Fe(u3),{isSubmittable:a}=await tU(n);if(!a||!r)return;if(Qbe(e??"",t,i,tN[r])){const s=await go({useMockConnection:eU(e)}),c=await nU(n,!0);s.sendMessagePreview(c.sendMessageParams),tN[r]={text:e??"",atTimestamp:Date.now(),files:t}}}async function Eye(n){(await go()).selectSxSMessage(n)}const eo={submitMessage:bye,stopMessage:Cye,onSubmitMessageBlocked:yye,regenerateMessage:Sye,sendMessagePreview:wye,selectSideBySideMessage:Eye};function t6e(n,e){return n.find(t=>t.partId===e)}function Tye(n){return{attachment:{item:{type:"image",url:n},content:{type:"image",url:n},size:0,type:"image/png"}}}function QE(){return QE=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},QE.apply(null,arguments)}function Iye(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)!==-1)continue;t[r]=n[r]}return t}var Aye=m.useLayoutEffect,kye=function(e){var t=m.useRef(e);return Aye(function(){t.current=e}),t},nN=function(e,t){if(typeof e=="function"){e(t);return}e.current=t},xye=function(e,t){var r=m.useRef();return m.useCallback(function(i){e.current=i,r.current&&nN(r.current,null),r.current=t,t&&nN(t,i)},[t])},rN={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},_ye=function(e){Object.keys(rN).forEach(function(t){e.style.setProperty(t,rN[t],"important")})},iN=_ye,Lr=null,aN=function(e,t){var r=e.scrollHeight;return t.sizingStyle.boxSizing==="border-box"?r+t.borderSize:r-t.paddingSize};function Mye(n,e,t,r){t===void 0&&(t=1),r===void 0&&(r=1/0),Lr||(Lr=document.createElement("textarea"),Lr.setAttribute("tabindex","-1"),Lr.setAttribute("aria-hidden","true"),iN(Lr)),Lr.parentNode===null&&document.body.appendChild(Lr);var i=n.paddingSize,a=n.borderSize,o=n.sizingStyle,s=o.boxSizing;Object.keys(o).forEach(function(p){var g=p;Lr.style[g]=o[g]}),iN(Lr),Lr.value=e;var c=aN(Lr,n);Lr.value=e,c=aN(Lr,n),Lr.value="x";var u=Lr.scrollHeight-i,h=u*t;s==="border-box"&&(h=h+i+a),c=Math.max(h,c);var f=u*r;return s==="border-box"&&(f=f+i+a),c=Math.min(f,c),[c,u]}var oN=function(){},Rye=function(e,t){return e.reduce(function(r,i){return r[i]=t[i],r},{})},Pye=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak"],Nye=!!document.documentElement.currentStyle,Oye=function(e){var t=window.getComputedStyle(e);if(t===null)return null;var r=Rye(Pye,t),i=r.boxSizing;if(i==="")return null;Nye&&i==="border-box"&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px");var a=parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),o=parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth);return{sizingStyle:r,paddingSize:a,borderSize:o}},Lye=Oye;function rU(n,e,t){var r=kye(t);m.useLayoutEffect(function(){var i=function(o){return r.current(o)};if(n)return n.addEventListener(e,i),function(){return n.removeEventListener(e,i)}},[])}var Dye=function(e){rU(window,"resize",e)},jye=function(e){rU(document.fonts,"loadingdone",e)},Uye=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],Fye=function(e,t){var r=e.cacheMeasurements,i=e.maxRows,a=e.minRows,o=e.onChange,s=o===void 0?oN:o,c=e.onHeightChange,u=c===void 0?oN:c,h=Iye(e,Uye),f=h.value!==void 0,p=m.useRef(null),g=xye(p,t),v=m.useRef(0),y=m.useRef(),b=function(){var E=p.current,T=r&&y.current?y.current:Lye(E);if(T){y.current=T;var A=Mye(T,E.value||E.placeholder||"x",a,i),I=A[0],k=A[1];v.current!==I&&(v.current=I,E.style.setProperty("height",I+"px","important"),u(I,{rowHeight:k}))}},C=function(E){f||b(),s(E)};return m.useLayoutEffect(b),Dye(b),jye(b),m.createElement("textarea",QE({},h,{onChange:C,ref:g}))},Bye=m.forwardRef(Fye);function Hye(n,e){const t=m.useRef(null);m.useEffect(()=>{const r=n==null?void 0:n.current;if(!r)return;const i=o=>{const s=r.selectionStart,c=r.selectionEnd;if(s!==c&&o.key!=="Backspace"&&o.key!=="Delete")t.current={type:"replace",char:o.key,index:s};else if(o.key==="Backspace"&&s>0){const h=r.value[s-1];h!==void 0&&(t.current={char:h,index:s-1,type:"delete"})}else if(o.key==="Delete"&&s<r.value.length){const h=r.value[s];h!==void 0&&(t.current={char:h,index:s,type:"delete"})}else t.current=null},a=()=>{e&&e(t.current),t.current=null};return r.addEventListener("keydown",i),r.addEventListener("input",a),()=>{r.removeEventListener("keydown",i),r.removeEventListener("input",a)}},[n,e])}const JE="@",$ye=new RegExp(`${JE}([^${JE}]*)`,"g");function zye(n,e){return[...n.slice(0,e).matchAll($ye)].map(r=>({keyword:r[1],start:r.index,end:r.index+r[0].length}))}function Vye(n,e){const t=zye(n,e);if(t.length===0)return;const r=t[t.length-1];return(r==null?void 0:r.end)===e?r:void 0}function Gye(n){const{className:e,textAreaRef:t,onMentionChange:r,textAreaValue:i,onCancelMention:a}=n,[o,s]=m.useState(void 0),{t:c}=Ce(),u=m.useRef(!1),h=m.useRef(r),f=m.useRef(null),p=m.useRef(new Set),g=m.useCallback(S=>{S&&S.char===JE&&S.type!=="insert"&&p.current.delete(S.index)},[]),v=m.useCallback(()=>{s(void 0),f.current=null},[s]);Hye(t,g),m.useEffect(()=>{h.current=r},[r]);const y=m.useCallback(()=>{const S=t==null?void 0:t.current;if(!S)return;const E=S.selectionStart,T=S.selectionEnd;if(E===T){const A=Vye(i,E);A?p.current.has(A.start)?v():(f.current=A,s(I=>I!==A.keyword?A.keyword:I)):v()}},[v,t,i]),b=m.useCallback((S="remove")=>{var k,x;const E=f.current;if(!E)return;if(S==="ignore"){p.current.add(E.start),(k=h.current)==null||k.call(h,{isTrigger:!1}),s(void 0);return}const T=i.slice(0,E.start),A=i.slice(E.end),I=T+A;f.current=null,(x=h.current)==null||x.call(h,{isTrigger:!1}),a==null||a(I)},[a,i]);m.useEffect(()=>{i===""?(v(),p.current.clear()):y()},[y,i,s,v]),m.useEffect(()=>{var S,E;if(!u.current){u.current=!0;return}o!==void 0?(S=h.current)==null||S.call(h,{isTrigger:!0,keyword:o}):(E=h.current)==null||E.call(h,{isTrigger:!1})},[o,h]),m.useEffect(()=>(_t.on("mention:cancel",b),()=>{_t.off("mention:cancel",b)}),[b]);const C=o==="";return d.jsxs("div",{className:X("pointer-events-none absolute z-0 overflow-auto",e),"aria-hidden":"true",children:[d.jsx("span",{className:"invisible select-none whitespace-pre-wrap break-words",children:i}),C&&d.jsx("span",{className:"text-foreground-550 dark:text-foreground-600",children:c("userInput.mentionPlaceholderText")})]})}function rs(n){m.useEffect(()=>(window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}),[n])}function Kye(n,e){const t=m.useCallback(async r=>{r.key==="Enter"&&!r.shiftKey&&!e&&await n(r)},[n,e]);rs(t)}function qye(n,e,t){const r=m.useRef(!1),i=m.useCallback(()=>{r.current=!0},[]),a=m.useCallback(()=>{setTimeout(()=>{r.current=!1},100)},[]);return Kye(async o=>{var s;(s=n.current)!=null&&s.contains(document.activeElement)&&!r.current&&(o.preventDefault(),await e())},t),{handleCompositionStart:i,handleCompositionEnd:a}}function Yk(){return $k("(hover: hover) and (pointer: fine)")}function km(){const n=Fe(po),e=Fe(ai);return n.length===0&&!!(e!=null&&e.isNew)}function Wye(){try{return uu.latestLocation.pathname}catch{return typeof window<"u"&&window.location.pathname?window.location.pathname:"/"}}function Eh(){const n=Wye(),e=n.endsWith("/talk"),t=n.startsWith("/chats")&&!e,r=n.endsWith("/landing");return t||r}function _C(){return!Fe(jI)}function Yye(){var o;const n=_C(),e=Fe(YI),t=Fe(CC),r=km(),i=Eh(),a=!!((o=me.instance().config().landingPage)!=null&&o.enableCentralComposer);return n&&!e&&t==="center"&&i&&r&&a}function Qye(){var i;const n=_C(),e=km(),t=Eh(),r=!!((i=me.instance().config().landingPage)!=null&&i.enableStarterPrompts);return n&&t&&e&&r}function iU(){var a;const n=_C(),e=km(),t=Eh(),r=Fe(Xte),i=!!((a=me.instance().config().landingPage)!=null&&a.enableWidgets);return n&&r&&t&&e&&i}function Jye(){const n=_C(),e=km(),t=Eh(),r=iU(),i=$e("appr-home");return n&&t&&e&&i&&!r}function aU(){var o;const n=$e("autosuggest"),e=$e("edge-autosuggest"),t=km(),r=Eh(),i=n||e,a=!!((o=me.instance().config().landingPage)!=null&&o.enableAutoSuggest);return i&&a&&r&&t}function Zye(){if(q3()&&Fe(K3)==="studentoffer")return"Ask me to create quizzes, flashcards, or help you study."}function Th(){const n=Jye();return{isCompatibleLandingRoute:Eh(),isAutoSuggestEnabled:aU(),isCentralComposerEnabled:Yye(),isStarterPromptsEnabled:Qye(),isWidgetSectionEnabled:iU(),isAppearanceOnHomeEnabled:n,isGreetingCentered:n||$e("categorized-conversation-starter-widget"),overrideUserInputPlaceholderFromWidget:Zye()}}function ho(n){var e,t;return(t=(e=me.instance().config().styleOverrides)==null?void 0:e.typography)==null?void 0:t[n]}function Fp(n){var e,t;return(t=(e=me.instance().config().styleOverrides)==null?void 0:e.padding)==null?void 0:t[n]}const Xye="pointer-events-none cursor-not-allowed select-none shadow-none",eCe="opacity-40",tCe=.25,Qk="userInput",Jk=m.forwardRef((n,e)=>{var Ve;const{t}=Ce(),{inputValue:r,errorMessage:i,className:a,characterLimit:o,characterLimitErrorMessage:s,disabled:c,placeholder:u=t("userInput.placeholderText"),autoFocus:h=!0,testId:f,setInput:p,setError:g,onBlur:v,onChange:y,onFocus:b,onClick:C,onEnter:S,onKeyDown:E,onPaste:T,onMentionIfEnabled:A,rightButtons:I,isMultiLines:k,"aria-autocomplete":x,"aria-controls":_,disabledClassName:R,inputContainerClassName:z}=n,j=Bt(),{isCentralComposerEnabled:J}=Th(),D=m.useRef(null),F=m.useRef(null),ie=Yk()||me.instance().config().enterKeyButtonEnabled,U=t("userInput.characterLimitText",{maxCharacters:o.toString()});m.useEffect(()=>{var ce;ie&&((ce=F.current)==null||ce.focus())},[j,ie]);const W=m.useCallback(ce=>{const{value:le}=ce.target;p(le),y&&y(le),le.length>o?g(s??U):g(null)},[p,y,o,g,s,U]);m.useImperativeHandle(e,()=>({updateInputValue:ce=>{const le=ce(r);p(le)},focus:()=>{var ce;(ce=F.current)==null||ce.focus()},blur:()=>{var ce;(ce=F.current)==null||ce.blur()},contains:ce=>{var le;return((le=F.current)==null?void 0:le.contains(ce))??!1},updateSelectionRange:(ce,le)=>{var De;(De=F.current)==null||De.setSelectionRange(ce,le)},getTextAreaRef(){return F}}),[r,p]),rs(ce=>{var le,De;ce.key==="Escape"&&((le=D.current)!=null&&le.contains(document.activeElement))&&((De=F.current)==null||De.blur()),E==null||E(ce)});const ue=m.useCallback(ce=>{const le=ce.clipboardData.getData("text/plain")||"";le.length>0&&(ce.stopPropagation(),T==null||T(le))},[T]),{handleCompositionStart:te,handleCompositionEnd:Z}=qye(D,S,!ie),Q=(Ve=me.instance().config().composer)==null?void 0:Ve.reducedUserInputHeight,Ie=c?R??eCe:"";return d.jsxs(_e.div,{className:ke("flex grow items-end",c&&Xye,Ie,a),onClick:()=>{var ce;C==null||C(),(ce=F.current)==null||ce.focus()},ref:D,onBlur:ce=>v==null?void 0:v(ce),layout:"preserve-aspect",children:[d.jsx(_e.div,{className:"relative grow overflow-hidden",layout:!0,children:d.jsx(_e.div,{className:"relative flex size-full cursor-text overflow-hidden text-black dark:text-white",layout:!0,children:d.jsxs(_e.div,{className:"flex grow flex-col gap-4 py-user-input",layout:!0,transition:{duration:0},children:[d.jsx("div",{className:ke("overflow-y-auto px-4",{"max-h-[15dvh]":Q,"max-h-user-input-shallow":J&&!Q,"max-h-user-input":!J&&!Q},me.instance().config().showScrollbarOnHover?"scrollbar-container":"",z),children:d.jsxs("div",{className:"relative",children:[d.jsx("label",{className:ke(["invisible block h-0 w-0 overflow-hidden",{"whitespace-nowrap":!k}]),htmlFor:"userInput",children:u}),d.jsx(Bye,{className:ke("font-ligatures-none inline-block min-h-user-input w-full resize-none overflow-y-hidden whitespace-pre-wrap bg-transparent align-top text-black outline-none placeholder:text-foreground-450 dark:text-white dark:placeholder:text-foreground-600",ho("composer")??"text-base",Fp("composerVertical")),disabled:c,placeholder:u,ref:F,id:Qk,role:"textbox","aria-autocomplete":x,"aria-controls":_,spellCheck:!1,value:r,enterKeyHint:"enter",onChange:W,onFocus:()=>b==null?void 0:b(r),onCompositionStart:te,onCompositionEnd:Z,onPaste:ue,autoFocus:h,"data-testid":f}),A&&d.jsx(Gye,{className:ke("font-ligatures-none inline-block min-h-user-input w-full resize-none overflow-y-hidden whitespace-pre-wrap bg-transparent align-top text-black outline-none placeholder:text-foreground-450 dark:text-white dark:placeholder:text-foreground-600",ho("composer")??"text-base",Fp("composerVertical"),"inset-0"),textAreaRef:F,textAreaValue:r,onMentionChange:A,onCancelMention:ce=>{p(ce),g(null)}})]})}),i&&d.jsx("div",{className:"flex min-h-6 select-none items-center px-4 text-foreground-600 text-xs",children:i})]})})}),d.jsx(_e.div,{className:ke("relative bottom-0 my-1.5 flex h-9 items-center",I!=null&&I.length?"mx-1.5 w-auto gap-1":"w-0"),children:I==null?void 0:I.map((ce,le)=>d.jsx(Mn,{children:d.jsx(_e.div,{initial:ct,animate:{...Rt,transition:{delay:tCe}},transition:{duration:Ei.default},children:ce})},le))})]})});Jk.displayName="UserInput";const nCe=dt();function oU(n){nCe.set(Gc,n)}function rCe(){const n=Im(),e=N(R3),[t,r]=Je(om);m.useEffect(()=>{n&&!t&&r(e)},[n,e,t,r])}const sU=["smart-mode-6e0b4c6f","smart-mode-cd0c997b","smart-mode"];function Ih(){return I4(sU,"any")}function iCe(){return Bd(sU,"any")}function cU(n,e){let t=null;return(...r)=>{t!==null&&window.clearTimeout(t),t=window.setTimeout(()=>n(...r),e)}}const aCe=300,n6e=2e3,Ah=dt(),oCe=500,MC=O(""),lU=O("starter-prompts"),uU=O(!0);function ZE(n){Ah.set(MC,n)}function XE(){Ah.set(MC,"")}function dv(n){Ah.set(lU,n)}function Tc(n){Ah.set(uU,n)}function dU(n){Ah.set(ch,n)}function Zk(){return N(MC)}function sCe(){return N(lU)}function cCe(){return N(uU)}const lCe=cU((n,e)=>{Pre(Fe(lt),n,JSON.stringify(e))},oCe);function uCe(n,e){lCe(n,e)}function hU(n){const{text:e,attachments:t,inputMethod:r}=n,i=Fe(MC),a=qE(),o=zk({breakpoint:"sm"}),s=Fe(Cn),c=Fe(ri),u=!Ir("kill-chat-message-preview"),h=s==="computerUse",p=aU()&&!c&&!h;if(e||dv("starter-prompts"),Tc(i.length<=0||e.length===0),dU(!1),Ah.set(Ny,void 0),uCe(r??"user"),a&&oU("typing"),o&&Y3(),p&&x9(e),iCe()&&s==="smart"&&u)try{eo.sendMessagePreview({text:e,inputMethod:"text",filesWithAttachment:t??[]})}catch{}}function ep(n){const{prompt:e,prefillSource:t}=n,r=document.querySelector(`#${Qk}`);r&&(Pf(),ZE(e),hU({text:e,inputMethod:t}),setTimeout(()=>{r.focus(),r.setSelectionRange(e.length,e.length)},0))}function iu(n){const{createConversation:e}=xk(),t=pe(ri),r=pe(ym),i=pe(CC),a=pe(Rf);return m.useCallback(async s=>{const{createConversationParams:c,prefillComposerData:u,composerPosition:h="center",shouldHideLaunchGreeting:f=!1}=s??{};try{t(null),r(null),a(null),n==null||n(),await e(c)}finally{i(h),u&&ep(u),f&&Y3()}},[e,i,t,r,a,n])}function Xk({defaultValue:n,controlledValue:e,onChange:t}){const r=e!==void 0,[i,a]=m.useState(n);return m.useEffect(()=>{r&&a(e)},[e,r]),{state:r?e:i,setState:c=>{r||a(c),t==null||t(c)}}}function RC(n){const{renderTrigger:e,triggerClick:t,children:r,className:i,options:a,isOpen:o,trapFocus:s,onIsOpenChange:c}=n,{state:u,setState:h}=Xk({controlledValue:o,defaultValue:!1,onChange:c}),{disableFocusManager:f=!1}=a??{},p=wh(),{refs:g,x:v,y,strategy:b,context:C}=qp({open:u,placement:(a==null?void 0:a.placement)??"bottom-end",onOpenChange:h,middleware:[nh((a==null?void 0:a.offset)??1),Wp({fallbackAxisSideDirection:"end"}),rh()],whileElementsMounted:th}),S=NT(C),E=OT(C),T=LT(C,{role:(a==null?void 0:a.roleType)??"dialog"}),{getReferenceProps:A,getFloatingProps:I}=DT([S,E,T]),k=x=>{a!=null&&a.stopReferencePropagation&&x.stopPropagation(),t==null||t(x)};return d.jsxs(d.Fragment,{children:[e==null?void 0:e({ref:g.setReference,...A({onClick:k})},u),u&&d.jsx(cy,{children:d.jsx(ly,{context:C,modal:s,disabled:f,returnFocus:(a==null?void 0:a.returnFocus)??!0,children:d.jsx("div",{ref:g.setFloating,style:{position:b,top:`${y}px`,[p?"insetInlineEnd":"insetInlineStart"]:`${v}px`},...I({onClick:x=>{a!=null&&a.stopFloatingPropagation&&x.stopPropagation(),a!=null&&a.hideOnMenuClick&&h(!1)}}),className:X("flex rounded-2xl p-1.5 shadow-xl",(a==null?void 0:a.overrideZIndex)??$t.modal,i),children:r})})})]})}function fU(n){const{buttonSize:e}=n,{t}=Ce(),r=iu(),{createPage:i}=Sge(),a=fr(),o=ee("pages-anonymous"),{refetch:s}=cge({disabled:!a&&!o}),c=async()=>{uge(),await(i==null?void 0:i({content:"",sourcePage:"createNewPage",impressionScenario:"actionMenuCreateNewPage",featureLatencyInfo:{scenario:"createPage",startTimestamp:Date.now()}})),await s()},u=T9({callback:c,signInScenario:"sidebarActionCreatePage",signInReason:"createPage"}),h=async()=>{!a&&o?c():u()};return d.jsx(RC,{options:{placement:"bottom-end",hideOnMenuClick:!0,roleType:"menu"},className:Ea,renderTrigger:({onClick:f,...p})=>d.jsx(Ee,{...p,title:t("sidebar.actions.menuTitle"),color:"subtle-dimmed-inverted",variant:"rect",size:e,className:"min-w-6 rounded-sm px-0",onClick:g=>{nt({source:"sidebarActionsMenu",customData:JSON.stringify({buttonSize:e})}),f(g)},children:d.jsx(Xl,{className:"size-3.5 rotate-90"})}),children:d.jsxs("div",{className:"flex flex-col gap-2",children:[d.jsx(Ee,{color:"subtle-dimmed-inverted",size:"40-base",variant:"rect",alignment:"start",title:t("sidebar.actions.newChat"),onClick:async()=>{await r()},children:t("sidebar.actions.newChat")}),d.jsx(Ee,{color:"subtle-dimmed-inverted",size:"40-base",alignment:"start",variant:"rect",title:t("sidebar.actions.newPage"),onClick:()=>{setTimeout(()=>{h()},0)},children:t("sidebar.actions.newPage")})]})})}const pU=n=>m.createElement("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M9.15898 16.8666C9.36292 17.0528 9.67918 17.0384 9.86536 16.8345C10.0515 16.6305 10.0371 16.3143 9.8332 16.1281L3.66535 10.4974H17.4961C17.7722 10.4974 17.9961 10.2735 17.9961 9.99736C17.9961 9.72122 17.7722 9.49736 17.4961 9.49736H3.66824L9.8332 3.86927C10.0371 3.68309 10.0515 3.36684 9.86536 3.16289C9.67918 2.95895 9.36292 2.94456 9.15898 3.13074L2.24263 9.44478C2.10268 9.57254 2.02285 9.74008 2.00314 9.91323C1.99851 9.94058 1.99609 9.96869 1.99609 9.99736C1.99609 10.0242 1.99821 10.0506 2.00229 10.0763C2.02047 10.2522 2.10058 10.4229 2.24263 10.5526L9.15898 16.8666Z",fill:"currentColor"})),r6e=Object.freeze(Object.defineProperty({__proto__:null,default:pU},Symbol.toStringTag,{value:"Module"})),PC=n=>m.createElement("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("mask",{id:"mask0_21044_3802",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:0,y:0,width:20,height:20},m.createElement("path",{d:"M19.7803 1.28033C20.0732 0.987435 20.0732 0.512561 19.7803 0.219669C19.4874 -0.0732238 19.0125 -0.0732228 18.7196 0.219671L8.71967 10.2197L8.25 11.75L9.78033 11.2803L19.7803 1.28033ZM4.25 1C2.45507 1 1 2.45508 1 4.25V15.75C1 17.5449 2.45507 19 4.25 19H15.75C17.5449 19 19 17.5449 19 15.75V7.75C19 7.33579 18.6642 7 18.25 7C17.8358 7 17.5 7.33579 17.5 7.75V15.75C17.5 16.7165 16.7165 17.5 15.75 17.5H4.25C3.2835 17.5 2.5 16.7165 2.5 15.75V4.25C2.5 3.2835 3.2835 2.5 4.25 2.5H12.25C12.6642 2.5 13 2.16421 13 1.75C13 1.33579 12.6642 1 12.25 1H4.25Z",fill:"currentColor"})),m.createElement("g",{mask:"url(#mask0_21044_3802)"},m.createElement("rect",{width:24,height:24,transform:"translate(-2 -2)",fill:"currentColor"}))),i6e=Object.freeze(Object.defineProperty({__proto__:null,default:PC},Symbol.toStringTag,{value:"Module"})),ex=n=>m.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M3.75 8.5C3.75 8.08579 4.08579 7.75 4.5 7.75H5.75C6.16421 7.75 6.5 8.08579 6.5 8.5C6.5 8.91421 6.16421 9.25 5.75 9.25H4.5C4.08579 9.25 3.75 8.91421 3.75 8.5ZM3.75 12C3.75 11.5858 4.08579 11.25 4.5 11.25H5.75C6.16421 11.25 6.5 11.5858 6.5 12C6.5 12.4142 6.16421 12.75 5.75 12.75H4.5C4.08579 12.75 3.75 12.4142 3.75 12ZM3.75 15.5C3.75 15.0858 4.08579 14.75 4.5 14.75H5.75C6.16421 14.75 6.5 15.0858 6.5 15.5C6.5 15.9142 6.16421 16.25 5.75 16.25H4.5C4.08579 16.25 3.75 15.9142 3.75 15.5ZM4.25 3C2.45507 3 1 4.45507 1 6.25V17.75C1 19.5449 2.45508 21 4.25 21H19.75C21.5449 21 23 19.5449 23 17.75V6.25C23 4.45507 21.5449 3 19.75 3H4.25ZM19.75 19.5H9V4.5H19.75C20.7165 4.5 21.5 5.2835 21.5 6.25V17.75C21.5 18.7165 20.7165 19.5 19.75 19.5ZM4.25 4.5H7.5V19.5H4.25C3.2835 19.5 2.5 18.7165 2.5 17.75V6.25C2.5 5.2835 3.2835 4.5 4.25 4.5Z",fill:"currentColor"})),a6e=Object.freeze(Object.defineProperty({__proto__:null,default:ex},Symbol.toStringTag,{value:"Module"}));function mU(){const n=N(hI),e=N(jd);return n&&!!e}function NC(){const n=Bt();return n.startsWith("/podcasts")||n.startsWith("/shares/podcasts")}function dCe(n){const{open:e,toggle:t}=n,r=iu(),[i]=Je(Vr),a=N(Hl),{t:o}=Ce(),s=ee("pages"),c=Bt(),u=NC(),h=i==="chat-only"||e,f=mU(),p=!C9(),g=!e&&(c.startsWith("/daily")||c.endsWith("/talk")||u||c.startsWith("/labs/experiments/3d-generations")||c.startsWith("/shares/3d-generations"));return d.jsx("div",{className:X("pointer-events-none absolute start-0 top-0 w-full p-1 pe-3.5",$t.sidebar),children:d.jsx("div",{className:"relative",children:d.jsxs("div",{className:"absolute flex min-w-full items-center justify-between gap-1 p-1",children:[d.jsx(Mn,{children:g&&d.jsx(_e.div,{className:X("pointer-events-auto absolute inset-0 rounded-2xl border border-stroke-100 shadow-md dark:border-stroke-300",Ea),initial:"initial",animate:"animate",exit:"exit",variants:{initial:ct,animate:Rt,exit:ct},transition:Vi})}),d.jsxs("div",{className:"pointer-events-auto flex shrink-0 items-center gap-1","data-theme":a&&!e?a.theme:void 0,children:[(p||h&&e)&&d.jsxs(d.Fragment,{children:[d.jsx(Ee,{title:o(e?"sidebar.close":"sidebar.open"),className:"after:absolute after:inset-0 after:rounded-lg hover:after:bg-black/3 dark:hover:after:bg-white/5",color:"subtle-dimmed-inverted",variant:"square",size:"28-xxs",onClick:()=>{nt({source:"sidebarToggle",pageName:c,customData:JSON.stringify({isOpen:e})}),t()},testId:"sidebar-toggle-button",children:e?d.jsx(pU,{className:"size-4"}):d.jsx(ex,{className:"size-5"})}),f&&!p&&d.jsx(Gb,{text:o("settings.copilotBeta.beta"),className:"me-2 ms-1 uppercase"})]}),h&&(p||!e)&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex items-center rounded-lg hover:bg-black/3 dark:hover:bg-white/5",children:[d.jsx(Ee,{title:o("composer.startNewChat"),color:"subtle-dimmed-inverted",variant:"square",size:"28-xxs",onClick:async()=>{nt({source:"sidebarNewConversation",destination:"/chat",pageName:c,customData:JSON.stringify({isOpen:e})}),await r()},children:d.jsx(PC,{className:"size-4"})}),s&&d.jsx(fU,{buttonSize:"28-xxs"})]}),f&&d.jsx(Gb,{text:o("settings.copilotBeta.beta"),className:"me-2 ms-1 uppercase"})]})]})]})})})}const gU="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/lumi-square-dark-L6S3uU38.webm",vU="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/lumi-square-light-D-O5yNyk.webm",OC="clicked",tx="dismissed",sN=l.union([l.enum([OC,tx]),l.undefined()]),nx=O(!1),hCe=O(!1),LC=tc({key:uM,schema:sN,initialValue:dr(uM,sN)??void 0});function fCe(n){const{onDismiss:e}=n,{t}=Ce(),r=pe($l),i=N(qi),a=pe(LC),o=async()=>{a(OC),r(im),await XI({talk:!0}),e()},s=c=>{c.stopPropagation(),a(tx),e()};return d.jsxs("button",{title:t("settings.appearanceSidebarBannerAltText"),"aria-label":t("settings.appearanceSidebarBannerAltText"),className:"my-3 flex h-20 w-full cursor-pointer items-center rounded-[20px] bg-stone-300/40 p-3 dark:bg-midnight-350/5",onClick:o,type:"button",children:[d.jsx("video",{src:i==="dark"?gU:vU,title:t("settings.appearanceIconAlt"),className:"size-16 rounded-2xl",autoPlay:!0,loop:!0,muted:!0}),d.jsxs("div",{className:"mx-2 flex flex-1 flex-col gap-2",children:[d.jsx("div",{className:"text-start text-2xs",children:t("settings.appearanceSidebarBannerText")}),d.jsx("div",{className:"text-start text-accent-550 text-2xs",children:t("settings.appearanceSidebarBannerTryItText")})]}),d.jsx("div",{className:"flex h-full items-start",children:d.jsx(Ee,{title:t("product.dismiss"),"aria-label":t("product.dismiss"),variant:"rect",color:"subtle-dimmed-inverted",size:"28-xxs",onClick:s,children:d.jsx(vr,{className:"size-3"})})})]})}function tp(n){const{children:e,color:t="neutral",className:r}=n;return d.jsx("div",{className:ke("flex h-4 shrink-0 items-center rounded px-1.5 text-3xs",t==="neutral"?"bg-black/8 text-foreground-550 dark:bg-white/8 dark:text-foreground-650":"bg-accent-350/30 text-accent-650 dark:bg-accent-450/30",r),children:e})}const pCe="relative flex shrink-0 items-center justify-center";function pw(n){const{titleString:e,descriptionString:t,badgeString:r,iconBgColor:i,iconFgColor:a,isSelected:o,children:s,testId:c,onClick:u}=n,h=kC(),f=$e("sidebar-compact-nav-items")&&!Ir("kill-sidebar-compact-nav-items")&&!h;return d.jsx(Ee,{className:ke("flex-col px-2",f?"py-1.5":"py-2",o&&"!bg-black/5 dark:!bg-white/8"),title:e,size:f?"36-sm":"40-base",color:"subtle-dimmed-inverted",onClick:u,testId:c,children:d.jsx("span",{className:"flex w-full items-center justify-between",children:d.jsxs("span",{className:ke("flex min-w-0",f?"gap-2.5":"gap-3"),children:[d.jsx("span",{className:ke(pCe,f?"size-6":"size-10 squircle-16",!f&&i,!f&&a),children:s}),d.jsxs("span",{className:"flex min-w-0 flex-1 flex-col",children:[d.jsxs("span",{className:"flex min-h-6 w-full items-center gap-1.5 text-start text-sm-medium",children:[e,r!==void 0&&r!==""&&d.jsx(tp,{color:"accent",children:r})]}),!f&&d.jsx("span",{className:"w-full text-start text-foreground-550 text-2xs",children:t})]})]})})})}const cN=65,mCe=100;function lN({count:n=1}){const e=m.useMemo(()=>Array.from({length:n},()=>`${Math.floor(Math.random()*(mCe-cN+1))+cN}%`),[n]);return d.jsx("div",{className:"flex flex-col gap-5 px-3 py-1",children:e.map((t,r)=>d.jsx("div",{style:{width:t},className:X("relative h-5 overflow-hidden rounded-lg bg-background-300 opacity-30 dark:bg-background-250 dark:opacity-40","border border-background-300 dark:border-background-250","after:absolute after:-start-[300%] after:end-0 after:start-0 after:h-full","after:opacity-50 dark:after:opacity-5","after:bg-gradient-to-r after:from-transparent after:via-white after:to-transparent","after:bg-[length:80%_100%] after:bg-no-repeat","after:animate-[shimmer-translate_2s_infinite]")},r))})}const bU=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M8 4.5H8.99998V10.7382C8.99998 11.1132 8.90628 11.4822 8.72739 11.8117L5.14269 18.415C4.50968 19.5811 5.35388 20.9999 6.68068 20.9999H17.3193C18.6461 20.9999 19.4903 19.5811 18.8573 18.415L15.2726 11.8117C15.0937 11.4822 15 11.1132 15 10.7382V4.5H16C16.4142 4.5 16.75 4.16421 16.75 3.75C16.75 3.33579 16.4142 3 16 3H8C7.58579 3 7.25 3.33579 7.25 3.75C7.25 4.16421 7.58579 4.5 8 4.5ZM10.5 10.7382V4.5H13.5V10.7382C13.5 11.3631 13.6561 11.9781 13.9543 12.5273L14.7537 14H9.24621L10.0457 12.5273C10.3438 11.9781 10.5 11.3631 10.5 10.7382ZM8.43192 15.5H15.568L17.539 19.1307C17.6294 19.2973 17.5088 19.4999 17.3193 19.4999H6.68068C6.49114 19.4999 6.37054 19.2973 6.46097 19.1307L8.43192 15.5Z"})),o6e=Object.freeze(Object.defineProperty({__proto__:null,default:bU},Symbol.toStringTag,{value:"Module"})),yU=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M11.0656 8.00389L11.25 7.99875H18.75C20.483 7.99875 21.8992 9.3552 21.9949 11.0643L22 11.2487V18.7487C22 20.4818 20.6435 21.898 18.9344 21.9936L18.75 21.9987H11.25C9.51697 21.9987 8.10075 20.6423 8.00515 18.9332L8 18.7487V11.2487C8 9.51571 9.35646 8.0995 11.0656 8.00389ZM18.75 9.49875H11.25C10.3318 9.49875 9.57881 10.2059 9.5058 11.1052L9.5 11.2487V18.7487C9.5 19.6669 10.2071 20.4199 11.1065 20.4929L11.25 20.4987H18.75C19.6682 20.4987 20.4212 19.7916 20.4942 18.8923L20.5 18.7487V11.2487C20.5 10.2822 19.7165 9.49875 18.75 9.49875ZM15.5818 4.23284L15.6345 4.40964L16.327 6.998H14.774L14.1856 4.79787C13.9355 3.86431 12.9759 3.31029 12.0423 3.56044L4.79787 5.50158C3.91344 5.73856 3.36966 6.61227 3.52756 7.49737L3.56044 7.64488L5.50158 14.8893C5.69372 15.6064 6.30445 16.0996 7.00045 16.1764L7.00056 17.6816C5.69932 17.6051 4.52962 16.7445 4.10539 15.4544L4.05269 15.2776L2.11155 8.03311C1.66301 6.35913 2.6067 4.6401 4.23284 4.10539L4.40964 4.05269L11.6541 2.11155C13.3281 1.66301 15.0471 2.6067 15.5818 4.23284Z"})),s6e=Object.freeze(Object.defineProperty({__proto__:null,default:yU},Symbol.toStringTag,{value:"Module"})),CU=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M3.5 12C3.5 7.30558 7.30558 3.5 12 3.5C16.6944 3.5 20.5 7.30558 20.5 12C20.5 16.6944 16.6944 20.5 12 20.5C7.30558 20.5 3.5 16.6944 3.5 12ZM12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM7.08349 8.70767C6.67722 7.6882 7.68791 6.67747 8.7074 7.08372L12.7356 8.68888C13.9078 9.15602 14.8461 10.0704 15.3431 11.2303L17.1969 15.5557C17.6414 16.5929 16.5927 17.6415 15.5555 17.197L11.2301 15.3433C10.0703 14.8462 9.15587 13.908 8.68872 12.7358L7.08349 8.70767ZM8.69209 8.69233L10.0822 12.1805C10.4018 12.9825 11.0274 13.6245 11.821 13.9646L15.572 15.5721L13.9644 11.8212C13.6243 11.0276 12.9824 10.4019 12.1803 10.0823L8.69209 8.69233Z"})),c6e=Object.freeze(Object.defineProperty({__proto__:null,default:CU},Symbol.toStringTag,{value:"Module"}));function uN(n){return n?{x:n.scrollLeft,y:n.scrollTop}:{x:0,y:0}}function gCe(n,e={}){const{checkIsScrolling:t=!0,scrollEndDelay:r=150}=e,[i,a]=m.useState(uN(n.current)),[o,s]=m.useState(!1),c=m.useRef(void 0);return m.useEffect(()=>{const u=n.current;let h=null;if(u===null)return()=>{};function f(){h===null&&(h=window.requestAnimationFrame(()=>{a(uN(u)),t&&(s(!0),c.current&&window.clearTimeout(c.current),c.current=window.setTimeout(()=>{s(!1)},r)),h=null}))}return u.addEventListener("scroll",f),()=>{u.removeEventListener("scroll",f),c.current&&clearTimeout(c.current)}},[t,n,r]),e.checkIsScrolling?{...i,isScrolling:o}:i}function vCe(n,e){let t=!1;return(...r)=>{t||(n(...r),t=!0,setTimeout(()=>{t=!1},e))}}function eT(n,e=1e3){const t=m.useRef();return m.useEffect(()=>{t.current=n},[n]),m.useMemo(()=>vCe((...a)=>{var o;(o=t.current)==null||o.call(t,...a)},e),[e])}function SU({onScrollStart:n,onScrollEnd:e,scrollRefs:t}){const r=m.useRef({}),i=eT(o=>{const{target:s}=o;s instanceof Window?r.current={scrollSource:"window",scrollStartTime:Date.now(),scrollStartX:s.scrollX,scrollStartY:s.scrollY}:s instanceof HTMLElement&&(r.current={scrollSource:s.id,scrollStartTime:Date.now(),scrollStartX:s.scrollLeft,scrollStartY:s.scrollTop}),n==null||n(r.current)}),a=eT(o=>{const{target:s}=o;s instanceof Window?(r.current={...r.current,scrollEndX:s.scrollX,scrollEndY:s.scrollY,scrollDuration:Date.now()-(r.current.scrollStartTime??0)},e==null||e(r.current)):s instanceof HTMLElement?(r.current={...r.current,scrollEndX:s.scrollLeft,scrollEndY:s.scrollTop,scrollDuration:Date.now()-(r.current.scrollStartTime??0)},e==null||e(r.current)):r.current={}});m.useEffect(()=>{var s,c;const o={passive:!0};for(const u of t)(s=u.current)==null||s.addEventListener("scroll",i,o),(c=u.current)==null||c.addEventListener("scrollend",a,o);return()=>{var u,h;for(const f of t)(u=f.current)==null||u.removeEventListener("scroll",i),(h=f.current)==null||h.removeEventListener("scrollend",a)}},[t,i,a])}function wU(n){const{scrollableRef:e,customData:t,customTrackCallback:r}=n,i=m.useCallback(a=>{window.requestAnimationFrame(()=>{r?r(a):Nre({...a,scrollSource:n.source??a.scrollSource,customData:JSON.stringify(t)})})},[t,r,n.source]);SU({onScrollEnd:i,scrollRefs:[e]})}function tT(n){var e;return((e=me.instance().config().settingsOverrides)==null?void 0:e[n.key])??n.default}const bCe=m.lazy(()=>$(()=>import("./sidebar-settings-CwQQy9Ss.js"),__vite__mapDeps([275,1,2,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325])).then(n=>({default:n.SidebarSettings}))),dN="sticky bg-sidebar-light dark:bg-sidebar-dark",hN="before:pointer-events-none before:absolute before:h-10 before:w-full before:from-sidebar-light before:to-transparent dark:before:from-sidebar-dark",yCe=m.lazy(()=>$(()=>import("./sidebar-pages-HPD3_Y6S.js"),__vite__mapDeps([326,1,2,327])).then(n=>({default:n.SidebarPages}))),CCe=m.lazy(()=>$(()=>import("./conversations-BAe59OaB.js"),__vite__mapDeps([328,1,2,327])));function SCe(){const{t:n}=Ce(),e=Bt(),t=Ta(),r=N(Yo),i=fr(),a=ee("pages"),o=ee("pages-sidebar-empty-cta"),s=ee("pages-anonymous"),c=(i||o||s)&&a,u=ee("appearance-discoverability"),h=N(LC),f=me.instance().config().enableLabs;ee("creator-gallery");const p=TC(),g=p||e==="/daily",{modalUrl:v,modalType:y}=R5({strict:!1}),b=e.startsWith("/library"),C=ee("library"),S=e.startsWith("/labs");e.startsWith("/gallery");const[E,T]=m.useState(u&&!h);m.useEffect(()=>{h&&T(!1)},[h]);const A=N(Oy),I=m.useRef(null),{y:k}=gCe(I),x=k>0,_=kC(),R=pe(Yo);wU({scrollableRef:I,source:"sidebar"});const z=tT({key:"shouldUseFlyoutSettings",default:!1}),j=ee("sidebar-settings");let J="w-sidebar";_?J="w-full":!r&&j&&(J="w-sidebar-collapsed");const D=j&&!z;return d.jsx("div",{className:ke("h-screen px-1 py-2",J),children:d.jsx("div",{className:ke("t-custom-scrollbar h-full overflow-x-hidden",r?"overflow-y-auto":"overflow-y-hidden"),ref:I,children:d.jsxs("div",{className:ke("flex min-h-full w-full flex-col px-0.5",{"justify-end":D,"w-10 px-0":D&&!r}),children:[d.jsxs("div",{className:ke(dN,hN,"top-0 z-10 flex flex-col gap-0.5 pb-3 pt-[60px]",x&&"before:bottom-0 before:top-full before:bg-gradient-to-b before:opacity-90",x&&"after:absolute after:bottom-0 after:mx-1 after:w-[calc(100%-8px)] after:border-b after:border-black/8 dark:after:border-white/10",_&&"whitespace-nowrap",!r&&D&&"hidden"),children:[d.jsx(pw,{titleString:n("sidebar.discover"),descriptionString:n("sidebar.discoverDescription"),isSelected:g,iconBgColor:"bg-caramel-350/40 dark:bg-slate-650/60",iconFgColor:"text-caramel-600 dark:text-slate-250",testId:"sidebar-discover-button",onClick:async()=>{!p||p&&(v||y)?(nt({source:"sidebarDiscoverButton",destination:"/",pageName:e}),await t({to:"/",from:e,search:{modalUrl:void 0}})):_&&R(!1)},children:d.jsx(CU,{className:"size-6"})}),iL,C&&d.jsx(pw,{titleString:n("sidebar.library"),descriptionString:n("sidebar.libraryDescription"),iconBgColor:"bg-spot-green-300/40 dark:bg-spot-green-600/60",iconFgColor:"text-spot-green-600 dark:text-slate-250",isSelected:b,onClick:()=>{t({to:"/library",from:e})},children:d.jsx(yU,{className:"size-6"})}),f&&d.jsx(pw,{titleString:n("sidebar.labs"),descriptionString:n("sidebar.labsDescription"),iconBgColor:"bg-labs-light dark:bg-labs-dark",iconFgColor:"text-labs-dark dark:text-labs-light",isSelected:S,onClick:async()=>{nt({source:"sidebarLabsButton",destination:"/labs",pageName:e}),await t({to:"/labs",from:e}),_&&S&&R(!1)},children:d.jsx(bU,{className:"size-6"})})]}),E&&r&&d.jsx(fCe,{onDismiss:()=>T(!1)}),d.jsxs("div",{className:ke("relative flex grow flex-col py-5",!r&&D&&"hidden"),children:[c&&d.jsx(m.Suspense,{fallback:null,children:d.jsx(yCe,{isCompact:!_})}),d.jsx("h2",{className:"mb-6 flex gap-2 px-2.5 align-middle text-sm-medium",children:n("sidebar.conversations")}),A?d.jsx(m.Suspense,{fallback:d.jsx(lN,{count:16}),children:d.jsx(CCe,{isCompact:!_})}):d.jsx(lN,{count:16})]}),!j&&d.jsx("div",{className:ke(dN,hN,"bottom-0 before:bottom-full before:bg-gradient-to-t")}),d.jsx(m.Suspense,{fallback:null,children:D&&d.jsx(bCe,{})})]})})})}const wCe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/copilot-wordmark-DvWA6bVb.svg",kh=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 120 120",fill:"none",...n},m.createElement("defs",null,m.createElement("radialGradient",{id:"a",cx:0,cy:0,r:1,gradientTransform:"matrix(-27.40125 -33.47302 31.47539 -25.76598 95.512 51.286)",gradientUnits:"userSpaceOnUse"},m.createElement("stop",{offset:.096,stopColor:"#00AEFF"}),m.createElement("stop",{offset:.773,stopColor:"#2253CE"}),m.createElement("stop",{offset:1,stopColor:"#0736C4"})),m.createElement("radialGradient",{id:"b",cx:0,cy:0,r:1,gradientTransform:"rotate(51.84 -70.254 70.14)scale(39.9779 38.7796)",gradientUnits:"userSpaceOnUse"},m.createElement("stop",{stopColor:"#FFB657"}),m.createElement("stop",{offset:.634,stopColor:"#FF5F3D"}),m.createElement("stop",{offset:.923,stopColor:"#C02B3C"})),m.createElement("radialGradient",{id:"e",cx:0,cy:0,r:1,gradientTransform:"matrix(-31.67773 90.58917 -108.5232 -37.949 103.796 30.703)",gradientUnits:"userSpaceOnUse"},m.createElement("stop",{offset:.066,stopColor:"#8C48FF"}),m.createElement("stop",{offset:.5,stopColor:"#F2598A"}),m.createElement("stop",{offset:.896,stopColor:"#FFB152"})),m.createElement("linearGradient",{id:"c",x1:31.75,x2:37.471,y1:18.75,y2:84.938,gradientUnits:"userSpaceOnUse"},m.createElement("stop",{offset:.156,stopColor:"#0D91E1"}),m.createElement("stop",{offset:.487,stopColor:"#52B471"}),m.createElement("stop",{offset:.652,stopColor:"#98BD42"}),m.createElement("stop",{offset:.937,stopColor:"#FFC800"})),m.createElement("linearGradient",{id:"d",x1:36.75,x2:39.874,y1:10,y2:82.213,gradientUnits:"userSpaceOnUse"},m.createElement("stop",{stopColor:"#3DCBFF"}),m.createElement("stop",{offset:.247,stopColor:"#0588F7",stopOpacity:0})),m.createElement("linearGradient",{id:"f",x1:106.964,x2:106.923,y1:33.365,y2:53.037,gradientUnits:"userSpaceOnUse"},m.createElement("stop",{offset:.058,stopColor:"#F8ADFA"}),m.createElement("stop",{offset:.708,stopColor:"#A86EDD",stopOpacity:0}))),m.createElement("path",{fill:"url(#a)",d:"M85.855 18.313A11.574 11.574 0 0 0 74.75 10h-3.379a11.574 11.574 0 0 0-11.384 9.485L54.2 51.018l1.436-4.913a11.574 11.574 0 0 1 11.11-8.327H86.38l8.235 3.207 7.937-3.207h-2.316a11.574 11.574 0 0 1-11.105-8.313z"}),m.createElement("path",{fill:"url(#b)",d:"M36.326 101.64A11.574 11.574 0 0 0 47.445 110h7.176c6.276 0 11.409-5.002 11.57-11.277l.781-30.405-1.634 5.583a11.574 11.574 0 0 1-11.108 8.321H34.432l-7.058-3.829-7.641 3.83h2.278c5.154 0 9.687 3.408 11.119 8.36z"}),m.createElement("path",{fill:"url(#c)",d:"M74.248 10H34.15c-11.457 0-18.33 15.142-22.913 30.283-5.43 17.939-12.534 41.93 8.02 41.93H36.57c5.174 0 9.716-3.421 11.138-8.396 3.01-10.531 8.286-28.903 12.43-42.889 2.105-7.107 3.86-13.211 6.551-17.012C68.2 11.785 70.715 10 74.248 10"}),m.createElement("path",{fill:"url(#d)",d:"M74.248 10H34.15c-11.457 0-18.33 15.142-22.913 30.283-5.43 17.939-12.534 41.93 8.02 41.93H36.57c5.174 0 9.716-3.421 11.138-8.396 3.01-10.531 8.286-28.903 12.43-42.889 2.105-7.107 3.86-13.211 6.551-17.012C68.2 11.785 70.715 10 74.248 10"}),m.createElement("path",{fill:"url(#e)",d:"M46.744 110h40.099c11.456 0 18.33-15.144 22.913-30.288 5.429-17.942 12.533-41.937-8.02-41.937H84.422a11.576 11.576 0 0 0-11.138 8.396c-3.01 10.533-8.286 28.909-12.43 42.897-2.106 7.109-3.86 13.214-6.552 17.016-1.51 2.131-4.025 3.916-7.558 3.916"}),m.createElement("path",{fill:"url(#f)",d:"M46.744 110h40.099c11.456 0 18.33-15.144 22.913-30.288 5.429-17.942 12.533-41.937-8.02-41.937H84.422a11.576 11.576 0 0 0-11.138 8.396c-3.01 10.533-8.286 28.909-12.43 42.897-2.106 7.109-3.86 13.214-6.552 17.016-1.51 2.131-4.025 3.916-7.558 3.916"})),l6e=Object.freeze(Object.defineProperty({__proto__:null,default:kh},Symbol.toStringTag,{value:"Module"}));function Qn(n){const{url:e,className:t}=n;return d.jsx("div",{className:ke("bg-current forced-color-adjust-none",t),style:{WebkitMaskImage:`url(${e})`,maskImage:`url(${e})`,WebkitMaskRepeat:"no-repeat",maskRepeat:"no-repeat",WebkitMaskPosition:"center",maskPosition:"center",WebkitMaskSize:"contain",maskSize:"contain"}})}function ECe(n){const{open:e,toggle:t}=n,r=iu(),[i]=Je(Vr),a=N(Hl),{t:o}=Ce(),s=ee("pages"),c=Bt(),u=NC(),h=i==="chat-only"||e,f=mU(),p=ee("sidebar-settings"),g=!e&&(c.startsWith("/daily")||c.endsWith("/talk")||c.startsWith("/gallery")||c.startsWith("/library")||u||c.startsWith("/labs/experiments/3d-generations")||c.startsWith("/shares/3d-generations"))&&!p,v=Nn({breakpoint:"md"});return d.jsx("div",{className:ke("pointer-events-none absolute start-0 top-0 w-full ps-1.5",$t.sidebar,p&&!e?"p-0 py-4 pe-0":"py-2.5 pe-3"),children:d.jsx("div",{className:"relative",children:d.jsxs("div",{className:ke("absolute flex min-w-full items-center justify-between py-1",p&&!e?"flex-col p-0":"p-1"),children:[d.jsx(Mn,{children:g&&d.jsx(_e.div,{className:ke("pointer-events-auto absolute inset-0 rounded-2xl border border-stroke-100 shadow-md dark:border-stroke-300",Ea),initial:"initial",animate:"animate",exit:"exit",variants:{initial:ct,animate:Rt,exit:ct},transition:Vi})}),d.jsx(On,{className:"flex items-center",delay:Ei.default,duration:Ei.slow,children:(e||p&&!v)&&d.jsxs(Ee,{role:"link",title:o("sidebar.homepageLink"),className:ke("pointer-events-auto absolute start-0 flex items-center gap-2.5 pe-2.5 ps-2",p&&!e?"relative gap-0 px-0":"absolute start-0"),color:"subtle-dimmed-inverted",testId:"sidebar-copilot-brand-button",onClick:async()=>{nt({source:"sidebarBrandButton",destination:"/chat",pageName:c}),await r()},children:[d.jsx(kh,{className:"size-6"}),(p&&e||!p)&&d.jsxs("span",{className:"flex items-center text-md-strong",children:[d.jsx(Qn,{url:wCe,className:"h-[18px] w-[58px]"}),f&&d.jsx(Gb,{text:o("settings.copilotBeta.beta"),className:"ms-2 uppercase"})]})]})}),d.jsxs("div",{className:ke("pointer-events-auto relative flex shrink-0 items-center gap-0.5 px-1",p&&!e&&!v?"flex-col":""),"data-theme":a&&!e?a.theme:void 0,children:[d.jsx(Ee,{title:o(e?"sidebar.close":"sidebar.open"),className:"after:absolute after:inset-0 after:rounded-xl hover:after:bg-black/3 dark:hover:after:bg-white/5",color:"subtle-dimmed-inverted",variant:"square",size:"36-sm",onClick:()=>{nt({source:"sidebarToggle",pageName:c,customData:JSON.stringify({isOpen:e})}),t()},testId:"sidebar-toggle-button",children:d.jsx(ex,{className:"size-6"})}),h&&d.jsxs("div",{className:ke("flex overflow-hidden rounded-xl hover:bg-black/3 dark:hover:bg-white/5",p&&!e&&!v?"flex-col gap-1":""),children:[d.jsx(Ee,{title:o("composer.startNewChat"),color:"subtle-dimmed-inverted",variant:"square",size:"36-sm",className:"w-[34px] rounded-sm",onClick:async()=>{nt({source:"sidebarNewConversation",destination:"/chat",pageName:c,customData:JSON.stringify({isOpen:e})}),await r()},children:d.jsx(PC,{className:"size-5"})}),s&&!(p&&!e&&!v)&&d.jsx(fU,{buttonSize:"36-sm"})]}),!e&&f&&(p&&v||!p)&&d.jsx(Gb,{text:o("settings.copilotBeta.beta"),className:"relative m-2 uppercase"})]})]})})})}function TCe(){const[n,e]=Je(Yo),t=Nn({breakpoint:"md"}),r=m.useRef(t),i=me.instance().config().useCompactSidebarHeader??!1;Nk(()=>{t&&e(!1)});const a=ee("sidebar-settings");m.useEffect(()=>{r.current===!1&&t&&e(!1),r.current===!0&&!t&&e(w9()==="open"),r.current=t},[t,e]);const o=()=>{e(s=>!s),t||pge(n?"close":"open")};return d.jsxs(d.Fragment,{children:[d.jsx(Mn,{children:t&&n&&d.jsx(_e.div,{className:"fixed inset-0 bg-black/30",onClick:()=>e(!1),initial:"initial",animate:"animate",exit:"exit",variants:{initial:ct,animate:Rt,exit:ct},transition:Vi})}),d.jsxs(_e.div,{className:X("relative w-full bg-sidebar-light dark:bg-sidebar-dark",n&&"h-full"),layout:"position",children:[i?d.jsx(dCe,{open:n,toggle:o}):d.jsx(ECe,{open:n,toggle:o}),d.jsx(Mn,{children:(n||a)&&d.jsx(_e.div,{className:"overflow-hidden",initial:"initial",animate:"animate",exit:"exit",variants:{initial:ct,animate:Rt,exit:ct},transition:Vi,children:d.jsx(SCe,{})})})]})]})}function ICe(n){return["/login","/fang","/referrals","/referrals/rules","/memory/narrative"].includes(n)}function Aa(){const n=Bt();return(me.instance().config().sidebarNavigation??!1)&&!ICe(n)}const ACe=290,kCe=52,xCe=()=>{const n=ee("sidebar-settings"),e=Nn({breakpoint:"md"});return n&&!e?kCe:0},fN="bg-sidebar-light dark:bg-sidebar-dark";function _Ce(n){const{children:e,sidebar:t}=n,r=document.getElementById("app"),i=wh(),a=Nn({breakpoint:"md"}),o=Aa(),c=N(Yo)&&o,[u,h]=m.useState(!1),f=N(Vr),p=N(jf),g=N(Py),v=kC(),y=ee("sidebar-settings");m.useEffect(()=>{r&&r.style.setProperty("--layout-offset-y",o&&c&&!a?`${Pa}px`:"0px")},[r,o,c,a]);const b=c&&!a,C=f==="side-by-side",S=v?"100%":ACe,E=xCe(),T=p||!!g;return d.jsxs("div",{className:X("flex h-full overflow-hidden",fN),inert:T?"":void 0,children:[t??(o&&d.jsx(_e.div,{className:X("h-full will-change-auto",a?"absolute":"relative",a&&fN,a&&$t.sidebar),initial:{width:c?S:E},animate:{width:c?S:E},transition:Vi,onAnimationStart:()=>h(!0),onAnimationComplete:()=>h(!1),children:d.jsx(TCe,{})})),d.jsx(_e.main,{className:X("relative flex w-full min-w-0 will-change-auto","after:pointer-events-none after:fixed after:inset-2 after:rounded-container after:border after:border-transparent after:transition-opacity dark:after:border-white/12 dark:after:border-s-white/8",b&&!u?"after:opacity-100 after:duration-1000":"after:opacity-0 after:duration-0",y?"after:start-[52px]":"after:start-[290px]"),initial:{paddingTop:b||C?Pa:0,paddingBottom:!C&&b?Pa:0,paddingLeft:b&&i?Pa:0,paddingRight:b&&!i?Pa:0},animate:{paddingTop:b||C?Pa:0,paddingBottom:!C&&b?Pa:0,paddingLeft:b&&i||!b&&C?Pa:0,paddingRight:b&&!i||!b&&C?Pa:0},transition:a?{duration:0}:Vi,children:e})]})}function rx(n){const{children:e,className:t,clipPathBreakpoint:r="md",backgroundColor:i}=n,a=Nn({breakpoint:r}),o=Aa(),c=Bt().endsWith("/talk");return d.jsxs("div",{className:ke("relative h-full overflow-hidden",t),children:[d.jsx("div",{className:X("absolute size-full",o&&!a&&"t-main-clip-path"),children:d.jsx(eu,{customColor:i,isFixed:!0})}),d.jsx("div",{className:X("relative size-full",!c&&"overflow-hidden",o&&!a&&"rounded-container"),children:e})]})}const EU=O(!0),MCe=O(!0),RCe=O(!1),PCe=O(!1);function TU(n){const{deferred:e=!1}=n??{},t=_5(),[r,i]=Je(d3),a=pe(ym);m.useEffect(()=>{const c=iW();c&&i(c)},[t.search,i]);const o=m.useCallback(()=>{i(null)},[i]),s=m.useCallback(c=>{c&&a({source:"promptInUrl",prompt:c})},[a]);return m.useEffect(()=>{r&&!e&&s(r)},[e,s,r]),{prompt:r,handler:e?s:void 0,clear:o}}function NCe(){const n=ee("prompt-pt-learn-partial"),e=ee("prompt-pt-learn-full"),t=ee("prompt-pt-learn-fill"),r=ee("prompt-pt-advice-partial"),i=ee("prompt-pt-advice-full"),a=ee("prompt-pt-advice-fill"),o=ee("prompt-pt-ideas-partial"),s=ee("prompt-pt-ideas-full"),c=ee("prompt-pt-ideas-fill"),u=ee("prompt-pt-msn-answers"),h=ee("prompt-pt-msn-headlines"),f=ee("prompt-pt-msn-events"),p=ee("prompt-pt-msn-answers-full"),g=ee("prompt-pt-msn-headlines-full"),v=ee("prompt-pt-msn-events-full"),y=H.getFormCode();let b=null,C=!1,S=!1,E=!1;switch(y){case"NTPCHB":{n||e||t?b="teach":r||i||a?b="advice":(o||s||c)&&(b="ideas"),C=n||r||o,S=e||i||s,E=t||a||c;break}case"MSNCHB":{u||p?b="answers":h||g?b="headlines":(f||v)&&(b="events"),S=p||g||v,E=u||h||f;break}default:b=null}let T=null;C?T="prefix":(S||E)&&(T="complete");let A=null;return C||E?A="partial":S&&(A="full"),{formCode:y,treatment:b,lengthVariant:T,passthroughType:A}}function IU(){const n=N(zl),e=ee("labs-actions"),t=ee("labs-actions-skipprocheck"),r=me.instance().config().proSubscription.enabled,i=fr(),a=!!N(jy),o=N(_r),s=!!N(D3);return q9({inEeaPlusRegion:s,labsFeatureEnabled:e,region:o,isUpsellFeatureEnabled:r,isAuthenticated:i,isTeenUser:a,isProUser:n,skipProUserCheck:t})}function AU(){const[n,e]=m.useState(!1),t=N(qg);return m.useEffect(()=>{async function r(){var a;await(((a=me.instance().config().actions)==null?void 0:a.enableActions)??(()=>Promise.resolve(!1)))()&&e(!0)}r().catch(()=>{})},[e,t]),n}function ix(){const n=IU(),e=AU();return Y9({actionsAvailableForAccount:n,actionsAvailableForSurface:e})}function u6e(){var r;const n=IU(),e=AU(),t=((r=me.instance().config().actions)==null?void 0:r.overrideLabsActionsFeatureEnabled)??!1;return Q9(n,e,t)}let hv=null;function OCe(){const n=pe(Cn),e=ix(),t=Ih();m.useEffect(()=>{const r=nW();hv===null&&(hv=r);const i=o=>o==="td"?"reasoning":e&&o==="ac"?"computerUse":t&&o==="sm"?"smart":null,a=i(r||hv);a&&n(a)},[n,e,t])}function LCe(){return hv}function kU(n){const{deferred:e=!1}=n??{},t=!!N(lt),r=N(Oy),[i,a]=Je(BI),o=pe(ym),s=pe(Cn);m.useEffect(()=>{const h=LCe()==="ac"?null:rW();if(h){const f=hW();a({prompt:h,inputMethod:f}),o({source:"queryInUrl",prompt:h})}},[s,o,a]);const c=m.useCallback(()=>{a(null)},[a]),u=m.useCallback(h=>{h&&(o({source:"queryInUrl",prompt:h}),(async()=>{if(t&&r&&h){const p=(i==null?void 0:i.inputMethod)??"queryParam",g=eo.submitMessage({text:h,inputMethod:p});c(),await g}})().catch(console.error))},[o,t,r,c,i]);return m.useEffect(()=>{!e&&i&&u(i.prompt)},[e,u,i]),{prompt:(i==null?void 0:i.prompt)??null,handler:e?u:void 0,clear:c}}function xU(){const n=DCe(),e=jCe();return n.prompt?n:e}function DCe(){const{t:n}=Ce(),{formCode:e,lengthVariant:t,treatment:r,passthroughType:i}=NCe();if(e&&t&&r){const a=n(`promptsByFormCode.${e}.${r}.${t}`,"");return{passthroughType:i,prompt:a,source:a?{type:"formCode",formCode:e}:void 0}}return{passthroughType:null}}function jCe(){const{prompt:n}=TU({deferred:!0}),{prompt:e}=kU({deferred:!0});let t=null,r;return n?(t="partial",r=n):e&&(t="full",r=e),{passthroughType:t,prompt:r,source:r?{type:"query"}:void 0}}function _U(){const n=N(BI),{passthroughType:e}=xU();return!!(n!=null&&n.prompt)&&e==="full"}function UCe(){var h,f;const n=Bt(),e=N(Vr),t=N($I),r=N(nx),{isMediaViewerOpen:i}=ts(),{disableMultiturn:a}=me.instance().config(),o=((h=me.instance().config().composer)==null?void 0:h.largeScreen)===!0&&((f=me.instance().config().composer)==null?void 0:f.voiceOnly)===!0,s=["/pro/subscribe","/pro/ewallet/return","/referrals","/referrals/rules","/subscription/manage","/subscription/start","/connector/callback"],c=_U(),u=!n.startsWith("/labs")||n==="/labs/portrait/talk";return!s.includes(n)&&!n.startsWith("/topic-selection")&&(!n.startsWith("/fang")||i)&&!n.startsWith("/login")&&!n.startsWith("/pro/redeem")&&!n.startsWith("/gaming")&&(!n.startsWith("/library")||i)&&!n.startsWith("/memory/narrative")&&!n.startsWith("/conversations")&&!n.startsWith("/campaigns")&&!n.startsWith("/pages")&&!n.startsWith("/shares/pages")&&!n.startsWith("/shares/3d-generations")&&!n.startsWith("/gallery")&&u&&e!=="detail-only"&&!t&&!r&&!o&&!a&&!c}function FCe(){var r,i;const n=Bt(),e=TC();return((r=me.instance().config().composer)==null?void 0:r.largeScreen)===!0&&((i=me.instance().config().composer)==null?void 0:i.voiceOnly)===!0&&!n.startsWith("/login-dcf")&&!e}function BCe(n){const{showSettings:e,showSettingsRelyOnChatDetailLayout:t}=n,r=N(Vr);return m.useMemo(()=>t?e&&r!=="side-by-side"&&r!=="detail-only":e,[t,e,r])}function HCe(){const[n,e]=Je(PCe);return m.useEffect(()=>{async function t(){const i=await(me.instance().config().isCommandHeaderSupported??(()=>Promise.resolve(!1)))();e(i)}t().catch(()=>{})},[e]),n}function $Ce(){const[n,e]=Je(MCe),t=N(EU);return m.useEffect(()=>{async function r(){const a=await(me.instance().config().isPinToggleHeaderCommandSupported??(()=>Promise.resolve(!1)))();e(a&&t)}r().catch(()=>{})},[e,t]),n}function MU(){const n=Object.assign({"../../assets/lottie/chain-of-thought-dark.json":()=>$(()=>import("./chain-of-thought-dark-DAdrbVMG.js"),[]).then(e=>e.default),"../../assets/lottie/chain-of-thought-light.json":()=>$(()=>import("./chain-of-thought-light-Cr0oOWNN.js"),[]).then(e=>e.default),"../../assets/lottie/character-thinking-cloud-animation.json":()=>$(()=>import("./character-thinking-cloud-animation-BPHslFRh.js"),[]).then(e=>e.default),"../../assets/lottie/image-gen-dark.json":()=>$(()=>import("./image-gen-dark-Xe9QwJfO.js"),[]).then(e=>e.default),"../../assets/lottie/image-gen-light.json":()=>$(()=>import("./image-gen-light-CvTKvF-o.js"),[]).then(e=>e.default),"../../assets/lottie/loader-gradient.json":()=>$(()=>import("./loader-gradient-nOUtNO79.js"),[]).then(e=>e.default),"../../assets/lottie/loader-image-generating.json":()=>$(()=>import("./loader-image-generating-CXsAaCuT.js"),[]).then(e=>e.default),"../../assets/lottie/loader-reasoning-dark.json":()=>$(()=>import("./loader-reasoning-dark-BWb0u6bB.js"),[]).then(e=>e.default),"../../assets/lottie/loader-reasoning-light.json":()=>$(()=>import("./loader-reasoning-light-DeS5Bpum.js"),[]).then(e=>e.default),"../../assets/lottie/loader-spinner-dark.json":()=>$(()=>import("./loader-spinner-dark-OIzWyRIV.js"),[]).then(e=>e.default),"../../assets/lottie/loader-spinner-light.json":()=>$(()=>import("./loader-spinner-light-DwSZ3tXn.js"),[]).then(e=>e.default),"../../assets/lottie/loader-spinner-white.json":()=>$(()=>import("./loader-spinner-white-B1ATuHTQ.js"),[]).then(e=>e.default),"../../assets/lottie/pages-welcome-dark.json":()=>$(()=>import("./pages-welcome-dark-r64A2mUI.js"),[]).then(e=>e.default),"../../assets/lottie/pages-welcome-light.json":()=>$(()=>import("./pages-welcome-light-DDUDcHxX.js"),[]).then(e=>e.default),"../../assets/lottie/voicemail-dark.json":()=>$(()=>import("./voicemail-dark-BtARQIb1.js"),[]).then(e=>e.default),"../../assets/lottie/voicemail-light.json":()=>$(()=>import("./voicemail-light-DeMSWjpH.js"),[]).then(e=>e.default)});return{load:e=>{const t=n[e];return t?t():Promise.reject(new Error(`Lottie animation not found: ${e}`))},exists:e=>e in n,getPaths:()=>Object.keys(n)}}const zCe=m.lazy(()=>$(()=>import("./index.es-DAxxNzWm.js"),__vite__mapDeps([329,2,1]))),VCe=MU();function Et(n){const{type:e,className:t,rendererSettings:r,colorTheme:i}=n,a=N(qi),o=i??a,[s,c]=m.useState(null),h=`../../assets/lottie/${m.useMemo(()=>{switch(e){case"gradient":return"loader-gradient.json";case"reasoning":return o==="dark"?"loader-reasoning-dark.json":"loader-reasoning-light.json";case"chainOfThought":return o==="dark"?"chain-of-thought-dark.json":"chain-of-thought-light.json";case"spinnerWhite":return"loader-spinner-white.json";case"imageGen":return o==="dark"?"image-gen-dark.json":"image-gen-light.json";case"spinnerThemed":default:return o==="dark"?"loader-spinner-dark.json":"loader-spinner-light.json"}},[e,o])}`;return m.useEffect(()=>{VCe.load(h).then(c).catch(()=>c(null))},[h]),s?d.jsx(m.Suspense,{fallback:d.jsx("div",{}),children:d.jsx(zCe,{animationData:s,loop:!0,className:t,rendererSettings:r})}):d.jsx("div",{})}const ax=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"})),GCe=16/9,KCe=48,RU=296,qCe=RU/GCe,WCe=qCe+KCe;function YCe(){return d.jsx("div",{className:"pointer-events-none absolute inset-0 mb-[calc(var(--composer-container-height)+20px)] me-4 ms-2 mt-[72px]",children:d.jsx("div",{className:"absolute bottom-0 end-4",style:{width:`${RU}px`,height:`${WCe}px`},children:d.jsx("div",{className:X("relative flex h-full flex-col overflow-hidden rounded-4xl","bg-acrylic-default-fallback-light/[98] dark:bg-acrylic-default-fallback-dark/[98]"),style:{boxShadow:"0px 16px 24px -2px rgba(0, 0, 0, 0.12)"},children:d.jsx("div",{className:"flex h-full items-center justify-center",children:d.jsx(Et,{className:"size-12"})})})})})}function nT(n){Zn({feature:"fileDownload",errorType:"DownloadFileError",errorMessage:n})}const ox=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M18.2498 20.5009C18.664 20.5008 19 20.8365 19 21.2507C19 21.6649 18.6644 22.0008 18.2502 22.0009L5.25022 22.0047C4.836 22.0048 4.5 21.6691 4.5 21.2549C4.5 20.8407 4.83557 20.5048 5.24978 20.5047L18.2498 20.5009ZM11.6482 2.01271L11.75 2.00586C12.1297 2.00586 12.4435 2.28801 12.4932 2.65409L12.5 2.75586L12.499 16.4409L16.2208 12.7205C16.4871 12.4543 16.9038 12.4301 17.1974 12.648L17.2815 12.7206C17.5477 12.9869 17.5719 13.4036 17.354 13.6972L17.2814 13.7813L12.2837 18.7779C12.0176 19.044 11.6012 19.0683 11.3076 18.8507L11.2235 18.7782L6.22003 13.7816C5.92694 13.4889 5.92661 13.014 6.21931 12.7209C6.48539 12.4545 6.90204 12.43 7.1958 12.6477L7.27997 12.7202L10.999 16.4339L11 2.75586C11 2.37616 11.2822 2.06237 11.6482 2.01271L11.75 2.00586L11.6482 2.01271Z",fill:"currentColor"})),d6e=Object.freeze(Object.defineProperty({__proto__:null,default:ox},Symbol.toStringTag,{value:"Module"})),QCe=10*1024*1024,JCe=5*1024*1024,ZCe=50*1024*1024,XCe=3,Uo={"image/png":["png"],"image/jpeg":["jpg","jpeg"],"image/webp":["webp"],"image/svg+xml":["svg"],"application/pdf":["pdf"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/json":["json"],"text/csv":["csv"],"text/markdown":["md"],"text/plain":["txt"]},eSe={"image/png":["png"],"image/jpeg":["jpg","jpeg"]},tSe={"application/pdf":["pdf"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/json":["json"],"text/csv":["csv"],"text/markdown":["md"],"text/plain":["txt"]},pN=O(null),PU=O(n=>{const e=n(ec("fileasyncprocessing"));return{maxFilesPerMessage:XCe,image:{maxBytes:QCe,mimeTypes:eSe},document:{maxBytes:e?ZCe:JCe,mimeTypes:tSe}}}),ac=O(n=>n(pN)??n(PU),(n,e,t)=>{e(pN,t)}),xh=O(n=>{const e=n(ac);return{...e.image.mimeTypes,...e.document.mimeTypes}});function xm(n){const e=Fe(ac).document.mimeTypes;return n in e}function sx(n,e){const t=Fe(xh),{supportedMimeTypes:r=t}=e??{};if(!n)return!1;const i=Qo(n);return i===""?!1:i in r}function h6e(){const n=Fe(xh);return Object.keys(n).map(e=>e in Uo&&Uo[e]?[e,...Uo[e].map(t=>`.${t}`)]:[]).flat()}function f6e(){const n=Fe(ac).image.mimeTypes;return Object.keys(n).map(e=>e in Uo&&Uo[e]?[e,...Uo[e].map(t=>`.${t}`)]:[]).flat()}function NU(n){return Object.values(n).flat().map(e=>`.${e}`)}function nSe(){const n=Fe(ac).document.mimeTypes;return NU(n)}function OU(){const n=Fe(ac);return{documentMaxSize:n.document.maxBytes,imageMaxSize:n.image.maxBytes}}function cx(n){var i;const e=(i=n.split(".").pop())==null?void 0:i.toLowerCase(),t=Fe(xh),r=Object.entries(t).find(([,a])=>a.includes(e??""));return r?r[0]:""}function Qo(n){return n?n.type!==""?n.type:cx(n.name):""}function rSe(n,e){const t=Fe(xh),{supportedMimeTypes:r=t}=e??{};let i,a=null;const o=$e("multi-file-upload"),s=OU();if(!sx(n,{supportedMimeTypes:r}))i={title:re("composer.errors.unsupportedAttachmentTypeV2.title"),message:re("composer.errors.unsupportedAttachmentTypeV2.message")},a="fileType";else if(!LU(n)){const c=Qo(n);i=o?{title:re("composer.errors.multi.attachmentTooLarge.title"),message:re("composer.errors.multi.attachmentTooLarge.message",{limit:xm(c)?s.documentMaxSize/1024/1024:s.imageMaxSize/1024/1024})}:{title:re("composer.errors.attachmentTooLargeV2.title"),message:re("composer.errors.attachmentTooLargeV2.message")},a="fileSize"}return H.trackEvent({name:"system",data:{eventName:"clientFileValidation",eventInfo_errorType:a,eventInfo_fileType:Qo(n),eventInfo_fileSize:n.size}}),i}function iSe(n){return n.type==="text/x-markdown"?new File([n],n.name,{type:"text/markdown"}):n}function LU(n){const e=OU(),t=Qo(n),r=xm(t)?e.documentMaxSize:e.imageMaxSize;return n.size<=r}function aSe(n){var t;const e=(t=n.clipboardData)==null?void 0:t.items;if(e)for(let r=0;r<e.length;r+=1){const i=e[r];if((i==null?void 0:i.kind)==="file"){const a=i.getAsFile();if(!sx(a))continue;const o=Qo(a);if(a!==null)return LU(a)?{file:a,error:void 0}:(H.trackEvent({name:"system",data:{eventName:"clientFileValidation",eventInfo_errorType:"fileType",eventInfo_fileSize:a.size,eventInfo_fileType:o,eventInfo_errorMessage:"File size too large in paste"}}),{file:void 0,error:{title:re("composer.errors.attachmentTooLargeV2.title"),message:re("composer.errors.attachmentTooLargeV2.message")}})}}return{file:void 0,error:void 0}}function DU(n){switch(n){case"unsupported-content-type":return{title:re("composer.errors.unsupportedAttachmentTypeV2.title"),message:re("composer.errors.unsupportedAttachmentTypeV2.message")};case"attachment-too-large":return{title:re("composer.errors.attachmentTooLargeV2.title"),message:re("composer.errors.attachmentTooLargeV2.message")};case"empty-attachment":return{title:re("composer.errors.emptyAttachmentV2.title"),message:re("composer.errors.emptyAttachmentV2.message")};case"content-blocked":return{title:re("composer.errors.attachmentContentBlockedV2.title"),message:re("composer.errors.attachmentContentBlockedV2.message")};case"rate-limit-exceeded":return{title:re("composer.errors.attachmentRateLimitExceededV2.title"),message:re("composer.errors.attachmentRateLimitExceededV2.message")};default:return{title:re("composer.errors.attachmentDefault.title"),message:re("composer.errors.attachmentDefault.message")}}}function jU(n,e){const t=window.URL.createObjectURL(n),r=document.createElement("a");r.style.display="none",r.href=t,r.download=e,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(t),r.remove()}function p6e(n,e,t){const r=new Blob([t],{type:e});jU(r,n)}function oSe(n){const e=n.headers.get("Content-Disposition");if(!e)return;const t=e.match(/filename\*=UTF-8''([^;]+)/);if(t&&t[1])return decodeURIComponent(t[1]);const r=e.match(/filename=([^;]+)/);if(r&&r[1])return r[1].replace(/^"(.*)"$/,"$1")}async function UU(n){const{url:e,fileName:t,preferResponseFileName:r,args:i}=n,a=$T(e)?await fetch(e,i==null?void 0:i.options):await wa(e,i);if(!a.ok)throw new Error(`Failed to fetch file: ${t} from ${e} (status: ${a.status})`);const o=await a.blob();let s=t;if(r){const c=oSe(a);c&&(s=c)}jU(o,s)}function sSe({name:n,size:e,message:t,kind:r}){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"submitMessage",eventInfo_errorMessage:t,eventInfo_details:`Error uploading ${r} attachment`,eventInfo_uploadFileSize:e,eventInfo_uploadFileType:n,eventInfo_numDocumentsUploaded:1}})}function cSe(){return`file-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}const lSe=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",...n},m.createElement("path",{d:"M10 6.5V2H5.5C4.67157 2 4 2.67157 4 3.5V16.5C4 17.3284 4.67157 18 5.5 18H14.5C15.3284 18 16 17.3284 16 16.5V8H11.5C10.6716 8 10 7.32843 10 6.5ZM6.5 10H13.5C13.7761 10 14 10.2239 14 10.5C14 10.7761 13.7761 11 13.5 11H6.5C6.22386 11 6 10.7761 6 10.5C6 10.2239 6.22386 10 6.5 10ZM6.5 12H13.5C13.7761 12 14 12.2239 14 12.5C14 12.7761 13.7761 13 13.5 13H6.5C6.22386 13 6 12.7761 6 12.5C6 12.2239 6.22386 12 6.5 12ZM6.5 14H13.5C13.7761 14 14 14.2239 14 14.5C14 14.7761 13.7761 15 13.5 15H6.5C6.22386 15 6 14.7761 6 14.5C6 14.2239 6.22386 14 6.5 14ZM11 6.5V2.25L15.75 7H11.5C11.2239 7 11 6.77614 11 6.5Z",fill:"currentColor"})),uSe=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",...n},m.createElement("path",{d:"M12 2V8C12 9.10457 12.8954 10 14 10H20V20C20 21.1046 19.1046 22 18 22H6C4.89543 22 4 21.1046 4 20V4C4 2.89543 4.89543 2 6 2H12ZM13.5 2.5V8C13.5 8.27614 13.7239 8.5 14 8.5H19.5L13.5 2.5Z",fill:"currentColor"})),dSe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/pdf-DuUY2RJ0.svg",hSe=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"none",...n},m.createElement("path",{d:"M3 2.5C3 2.22386 3.22386 2 3.5 2H11.5C11.7761 2 12 2.22386 12 2.5V4.5C12 4.77614 11.7761 5 11.5 5C11.2238 5 11 4.77614 11 4.5V3H7.99997L7.99998 13H9C9.27614 13 9.5 13.2239 9.5 13.5C9.5 13.7761 9.27614 14 9 14H6C5.72386 14 5.5 13.7761 5.5 13.5C5.5 13.2239 5.72386 13 6 13H6.99998L6.99997 3H4V4.5C4 4.77614 3.77614 5 3.5 5C3.22386 5 3 4.77614 3 4.5V2.5Z",fill:"currentColor"}));function fSe(n){const{fileType:e,className:t}=n;switch(e){case"application/pdf":return d.jsx(Qn,{url:dSe,className:t});case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":return d.jsx(lSe,{className:t});case"text/plain":return d.jsx(hSe,{className:t});case"application/json":case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.ms-powerpoint":case"text/csv":case"text/markdown":default:return d.jsx(uSe,{className:t})}}function pSe(n){switch(n){case"application/pdf":return"bg-system-red-350";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":return"bg-midnight-300";case"text/plain":return"bg-spot-blue-300";case"application/json":case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.ms-powerpoint":case"text/csv":case"text/markdown":default:return"bg-neutral-300"}}function mSe(n){const{t:e}=Ce();switch(n){case"application/pdf":return e("fileUpload.fileTypeDisplayPdf");case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":return e("fileUpload.fileTypeDisplayDoc");case"text/plain":return e("fileUpload.fileTypeDisplayTxt");case"application/json":return e("fileUpload.fileTypeDisplayJson");case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"application/vnd.ms-excel":return e("fileUpload.fileTypeDisplayXlsx");case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.ms-powerpoint":return e("fileUpload.fileTypeDisplayPptx");case"text/csv":return e("fileUpload.fileTypeDisplayCsv");case"text/markdown":return e("fileUpload.fileTypeDisplayMarkdown");default:return e("fileUpload.fileTypeDisplayDefault")}}const gSe=100,Yb=O([]);function vSe(){const n=N(Yb),[e,t]=m.useState(!1),r=e?n:[];return d.jsxs("div",{className:"sr-only",ref:()=>setTimeout(()=>t(!0),gSe),children:[d.jsx(mN,{messages:r.filter(i=>i.type==="polite"),type:"polite"}),d.jsx(mN,{messages:r.filter(i=>i.type==="assertive"),type:"assertive"})]})}function mN({messages:n,type:e}){return d.jsx("div",{"aria-live":e,"aria-atomic":"true",children:n.map(t=>d.jsx("div",{"aria-label":t.msg,children:t.msg},t.id))})}function rT(){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.floor(Math.random()*16);return(n==="x"?e:Math.floor(Math.random()*4+8)).toString(16)})}const FU=7e3;function Tl(n={}){return bSe(n),null}function bSe(n={}){const{msg:e,id:t,type:r="polite",timeout:i=FU}=n,a=pe(Yb),o=m.useRef(t??rT());m.useEffect(()=>{e&&a(s=>{if(s.some(u=>u.id===o.current&&u.msg===e&&u.type===r))return s;o.current=t??rT();const c={msg:e,id:o.current,type:r};return window.setTimeout(()=>{a(u=>u.filter(h=>h.id!==c.id))},i),[...s,c]})},[t,e,r,a,i])}function au(n){const{msg:e,id:t,type:r="polite",timeout:i=FU}=n;if(!e)return;const a=dt();a.set(Yb,o=>{const s={msg:e,id:t??rT(),type:r};return window.setTimeout(()=>{a.set(Yb,c=>c.filter(u=>u.id!==s.id))},i),[...o,s]})}const ySe=m.lazy(()=>$(()=>Promise.resolve().then(()=>ax),void 0));function lx(n){var f;const{onRemove:e,filename:t,fileType:r,isUploading:i,role:a}=n,{t:o}=Ce(),s=pSe(r),c=mSe(r),u=m.useCallback(()=>{e==null||e(),au({msg:o("fileUpload.fileRemoved")})},[e,o]),h=(f=me.instance().config().composer)==null?void 0:f.smallAttachmentCard;return d.jsxs(_e.div,{className:X("relative flex justify-center gap-2 overflow-hidden rounded-xl border border-black/8 bg-acrylic-thin-fallback-light/60 p-3 dark:border-white/8 dark:bg-midnight-800/80 sm:w-56",{"mx-1 mt-2 h-[58px] w-auto flex-row":h,"h-32 w-44 flex-col":!h}),layout:"position",initial:ct,animate:Rt,exit:ct,role:a,children:[d.jsx("div",{className:X("grid aspect-square size-8 place-items-center self-start rounded-full text-black",s),children:d.jsx(fSe,{fileType:r,className:"size-5"})}),d.jsxs("div",{className:X({"min-w-0 flex-1":h}),children:[d.jsx("p",{className:X("font-ligatures-none truncate text-xs",{"overflow-hidden whitespace-nowrap":h}),children:t}),d.jsx("p",{className:"text-foreground-600 text-2xs",children:c})]}),e&&!i&&d.jsx("button",{type:"button",title:o("fileUpload.removeFileWithName",{name:t}),"aria-label":o("fileUpload.removeFileWithName",{name:t}),onClick:u,className:"absolute end-0.5 top-0.5 m-1 rounded-full border border-black/20 p-1 text-foreground-850 dark:border-white/20",children:d.jsx(vr,{className:"size-3"})}),d.jsx(On,{className:"absolute inset-0 grid place-items-center bg-white/80 dark:bg-white/45",children:i?d.jsxs(d.Fragment,{children:[d.jsx(m.Suspense,{fallback:d.jsx("div",{"aria-hidden":!0}),children:d.jsx(ySe,{type:"spinnerThemed",className:"size-11"})}),d.jsx(Tl,{msg:o("fileUpload.uploadingFile"),type:"polite"})]}):null})]})}function CSe(n){const{contentType:e,name:t,url:r}=n,{t:i}=Ce(),a=pe(Ia),o=N(lt),s=Bt(),c=m.useRef(!1);m.useEffect(()=>{c.current||(c.current=!0,nc({element:"file",scenario:"renderArtifact",page:s,customData:JSON.stringify({url:r,fileName:t})}))},[r,t,s]);const u=m.useCallback(()=>{const h={url:r,fileName:t};nt({source:"fileDownloadButton",scenario:"downloadArtifact",conversationId:o,customData:JSON.stringify(h)}),UU(h).catch(f=>{const p=f instanceof Error?f.message:"unknown file card error";nT(p),p.includes("status: 404")?a({title:i("common.fileUnavailable"),subtitle:i("common.fileUnavailableDetails"),dismissAfter:3e3}):a({title:i("common.downloadFailed"),subtitle:i("common.downloadFailedDetails",{fileName:t}),dismissAfter:3e3})})},[r,t,i,a,o]);return r?d.jsxs("div",{className:"flex w-fit max-w-full items-center gap-4 md:max-w-96",children:[d.jsx(lx,{filename:t,fileType:e}),d.jsx(Ee,{title:i("common.download"),size:"36-sm",variant:"circle",color:"subtle-dimmed-inverted",onClick:u,"aria-label":i("common.download"),className:"shrink-0 border border-stroke-350",children:d.jsx(ox,{className:"size-5"})})]}):(nT("No URL provided"),null)}const BU=.6;function oc(n={},e={}){return{start:{...n,opacity:0},end:t=>({...e,opacity:1,transition:{delay:t,ease:"easeInOut",duration:BU}})}}const SSe=oc();function wSe(n){const{items:e,shouldAnimate:t,BlockRenderer:r,delay:i}=n;return d.jsx(_e.blockquote,{className:"flex flex-col gap-3 border-s-2 border-foreground-300 ps-3",variants:SSe,initial:t?"start":"end",animate:"end",custom:i,children:d.jsx(r,{blocks:e,shouldAnimate:t})})}function HU(n){const e=N(po),{openMediaViewer:t}=ts(),r=m.useCallback(()=>{if(!n)return[];const o=e.find(c=>c.id===n);if(!o||o.author!=="ai")return[];const s=[];for(const c of o.content)if(c.type==="card"){if(c.card.type==="image"){const u=c.card;s.push(...u.images)}else if(c.card.type==="video"){const u=c.card;s.push(...u.videos)}}return s},[e,n]),i=m.useCallback(o=>r().some(c=>c.source.url===o),[r]),a=m.useCallback(o=>{var h;const s=r(),c=s.findIndex(f=>f.source.url===o);if(c===-1)return;const u=s.map(f=>"image"in f?{type:"image",url:f.image.url,thumbnailUrl:f.image.thumbnailUrl,altText:f.image.altText,initLoading:!0,source:{title:f.source.title,url:f.source.url,iconUrl:f.source.iconUrl??void 0}}:{type:"video",url:f.video.url,isShort:f.video.isShort,bestMomentIndex:f.bestMomentIndex,moments:f.moments,source:{title:f.video.title,url:f.source.url,iconUrl:f.source.iconUrl??void 0}});t({currentMediaIndex:c,media:u,source:((h=u[0])==null?void 0:h.type)==="image"?"imageCard":"videoCard"})},[r,t]);return{checkMediaLink:i,openMediaLink:a}}function fo({onOutsideEvent:n,elements:e,shouldAttachListeners:t=!0,includeScroll:r=!0,invokeOnce:i=!0,includeFocus:a=!0}){m.useEffect(()=>{const o=s=>{const c=s.target,u=e.some(f=>{var p;return(p=f.current)==null?void 0:p.contains(c)}),h=c instanceof Element&&c.closest("[data-outside-events-ignore]")!==null;!u&&!h&&n()};return t&&(document.addEventListener("mousedown",o,{once:i}),r&&document.addEventListener("scroll",o,!0),a&&document.addEventListener("focusin",o,!0)),()=>{document.removeEventListener("mousedown",o),r&&document.removeEventListener("scroll",o,!0),a&&document.removeEventListener("focusin",o,!0)}},[t,r,e,i,a,n])}const _m=m.createContext(void 0),ESe=oc();function TSe(n){const{url:e,title:t,index:r,shouldAnimate:i,delay:a,onCitationClick:o}=n,s=m.useContext(_m),c=ee("citation-media-open"),u=m.useId(),h=m.useId(),{checkMediaLink:f,openMediaLink:p}=HU(s??null),g=UT(),v=N(lt),[y,b]=m.useState(!1),[C,S]=m.useState(null),{refs:E,floatingStyles:T}=P5({placement:"top",elements:{reference:C},middleware:[nh(8),Wp(),rh()]});fo({onOutsideEvent:()=>b(!1),elements:[E.floating],includeScroll:!0,invokeOnce:!0}),rs(x=>{(x.key==="Escape"||x.key==="Control")&&b(_=>(_&&C instanceof HTMLElement&&C.focus(),!1))});const A=()=>{if(c&&f(e)){p(e);return}b(!0)},I=()=>{bn({source:"citationLink",conversationId:v,messageId:s,destination:tl(e)}),b(!1),o&&o()},k=Pd(e);return d.jsxs(_e.span,{initial:i?"start":"end",animate:"end",variants:ESe,custom:a,className:"mx-0.5 inline-block h-5 w-4 pb-1 align-middle","data-copy":"false",children:[d.jsx("button",{id:h,"aria-expanded":y,"aria-controls":u,"aria-label":re("chat.citationPopoverButtonLabel",{citationNumber:r}),ref:S,type:"button",className:X("mx-px flex size-full items-center justify-center rounded-md bg-accent-200 pt-px text-foreground-800 text-3xs hover:bg-accent-250 focus:bg-accent-250 dark:bg-slate-700 hover:dark:bg-background-400 focus:dark:bg-background-400",y&&"pointer-events-none"),onClick:A,children:r}),y&&d.jsx("span",{id:u,role:"dialog","aria-labelledby":h,className:X("absolute w-screen px-4 max-sm:mb-2 sm:w-[350px] sm:px-0",$t.citations),style:T,ref:E.setFloating,children:d.jsx(_e.span,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{scale:{duration:.2},opacity:{duration:.15}},className:"origin-top-left",style:FT,children:d.jsx("a",{onClick:I,className:"flex w-full rounded-2xl border border-stroke-100 bg-background-100 p-3 shadow-lg dark:bg-background-250",href:tl(e),target:"_blank",rel:g,children:d.jsxs("span",{className:"w-full flex-1 space-y-0.5",children:[d.jsx("span",{className:"line-clamp-1 text-xs-strong",children:t}),d.jsx("span",{className:"line-clamp-1 flex items-center gap-1.5 text-foreground-600 text-2xs",children:k})]})})})})]},"citation")}const ISe="https://#timestamp-",ASe="https://#settings:privacy";function $U(n){return n?n.startsWith(ISe)?"VideoCitation":n.startsWith(ASe)?"PrivacySettings":"Unknown":"Unknown"}function kSe(n){return $U(n)!=="Unknown"}function xSe(n){if(!/^\d{2}:\d{2}:\d{2}$/.test(n))return n;const[t,r,i]=n.split(":");return t==="00"?(r==null?void 0:r.charAt(0))==="0"?`${r.substring(1)}:${i}`:`${r}:${i}`:(t==null?void 0:t.charAt(0))==="0"?`${t.substring(1)}:${r}:${i}`:n}const _Se=oc(),gN="font-bold text-accent-550 dark:text-accent-600 hover:underline text-start align-top";function MSe(n){const{url:e,text:t,shouldAnimate:r,delay:i}=n,a=m.useContext(_m),o=N(lt),s=$U(e),c=async()=>{switch(s){case"VideoCitation":await epe.run({url:e});break;case"PrivacySettings":await ape.run({url:e});break}H.trackEvent({name:"interaction",data:{eventName:"localCitationClick",eventInfo_messageId:a??"",eventInfo_conversationId:o??"",eventInfo_citationType:s}})};m.useEffect(()=>{H.trackEvent({name:"interaction",data:{eventName:"localCitationImpression",eventInfo_messageId:a??"",eventInfo_conversationId:o??"",eventInfo_citationType:s}})},[a,o,s]);const u=xSe(t);return r?d.jsx(_e.button,{className:gN,onClick:c,"data-url":e,initial:"start",animate:"end",variants:_Se,custom:i,children:u}):d.jsx("button",{type:"button",className:gN,onClick:c,"data-url":e,children:u})}const vN=oc(),bN="font-bold text-accent-550 dark:text-accent-600 hover:underline text-start align-top";function vo(n){const{items:e,shouldAnimate:t,dangerouslyUseHtml:r,shouldTestForUrl:i=!0}=n,a=m.useContext(_m),o=Fe(lt),s=ee("text-link-media-open"),{checkMediaLink:c,openMediaLink:u}=HU(a??null),h=pe(Q8),f=pe(ri);return d.jsx(d.Fragment,{children:e.map((p,g)=>{var A;if(p.type==="citation"){const{title:I,url:k,index:x,delay:_}=p;return d.jsx(TSe,{title:I,url:k,index:x,shouldAnimate:t,delay:_},g)}if(p.type==="italic"||p.type==="bold"||p.type==="strikethrough"||p.type==="sup"||p.type==="sub"||p.type==="code"){const I=d.jsx(vo,{items:p.items,shouldAnimate:t,dangerouslyUseHtml:r});return p.type==="italic"?d.jsx("em",{children:I},g):p.type==="bold"?d.jsx("strong",{children:I},g):p.type==="strikethrough"?d.jsx("del",{children:I},g):p.type==="sup"?d.jsx("sup",{children:I},g):p.type==="sub"?d.jsx("sub",{children:I},g):d.jsx(_e.code,{className:"font-ligatures-none mx-0.5 rounded-[4px] border border-stroke-300 bg-accent-200/60 px-1 py-px font-mono text-foreground-800 text-sm dark:bg-accent-200",initial:t?"start":"end",animate:"end",variants:vN,custom:p.delay,children:I},g)}if(p.type!=="word")return null;const{word:v,url:y,delay:b,format:C}=p,E=RSe({word:v,url:y,testForUrl:!C&&i}),T={initial:"start",animate:"end",variants:vN,custom:b,...r===!0||C==="latexAsHtml"?{dangerouslySetInnerHTML:{__html:((A=window.copilotTrustedTypesPolicy)==null?void 0:A.createHTML(v))??""}}:{children:v}};if(E.url){if(kSe(E.url))return d.jsx(MSe,{url:E.url,text:E.word,shouldAnimate:t,delay:b},g);const I=()=>{if(s&&E.url&&c(E.url)){u(E.url);return}h({url:E.url,messageId:a,conversationId:o}),f("confirm-link-navigation")};return d.jsxs(m.Fragment,{children:[t?d.jsx(_e.button,{className:bN,onClick:I,"data-url":E.url,...T}):d.jsx("button",{type:"button",className:bN,onClick:I,"data-url":E.url,...T}),E.suffix&&E.suffix]},g)}return t?d.jsx(_e.span,{...T},g):r===!0||C==="latexAsHtml"?d.jsx("span",{...T},g):d.jsx(m.Fragment,{children:v},g)})})}function RSe({word:n,url:e,testForUrl:t}){return e?{url:e,word:n}:t?NG(n):{word:n}}function PSe(n){const{shouldAnimate:e,items:t}=n;return d.jsx("h1",{className:X(ho("h1")??"text-2xl-medium","[&:not(:first-child)]:pt-6"),children:d.jsx(vo,{shouldAnimate:e,items:t})})}function NSe(n){const{shouldAnimate:e,items:t}=n;return d.jsx("h2",{className:X(ho("h2")??"text-xl-medium","[&:not(:first-child)]:pt-3.5","pb-1"),children:d.jsx(vo,{shouldAnimate:e,items:t})})}function OSe(n){const{shouldAnimate:e,items:t}=n;return d.jsx("h3",{className:X(ho("h3")??"text-lg-medium","pb-1","[&:not(:first-child)]:pt-3.5"),children:d.jsx(vo,{shouldAnimate:e,items:t})})}function LSe(n){const{shouldAnimate:e,items:t}=n;return d.jsx("h4",{className:X(ho("h4")??"text-md-medium"),children:d.jsx(vo,{shouldAnimate:e,items:t})})}function DSe(n){const{shouldAnimate:e,items:t}=n;return d.jsx("h5",{className:X(ho("h5")??"text-base-medium"),children:d.jsx(vo,{shouldAnimate:e,items:t})})}function jSe(n){const{shouldAnimate:e,items:t}=n;return d.jsx("h6",{className:X(ho("h6")??"text-base"),children:d.jsx(vo,{shouldAnimate:e,items:t})})}const USe=[PSe,NSe,OSe,LSe,DSe,jSe];function FSe(n){const{shouldAnimate:e,items:t,level:r}=n,i=USe[r-1];return i?d.jsx(i,{shouldAnimate:e,items:t}):null}const BSe=oc(),yN="relative pb-6 w-full after:border-b after:border-stroke-300 after:w-full after:absolute after:mt-3";function HSe(n){const{delay:e,shouldAnimate:t}=n;return t?d.jsx(_e.div,{className:yN,initial:"start",animate:"end",variants:BSe,custom:e}):d.jsx("div",{className:yN})}const $Se=oc();function zSe(n){const{content:e,shouldAnimate:t,delay:r,dangerouslyUseHtml:i}=n;return d.jsx(_e.div,{initial:t?"start":"end",animate:"end",custom:r,variants:$Se,children:d.jsx("div",{className:"horizontal-scrollbar overflow-x-auto whitespace-pre pb-3 pt-4 text-center",children:d.jsx(vo,{items:e,shouldAnimate:t,dangerouslyUseHtml:i})})})}const CN="relative list-outside marker:text-foreground-750 dark:marker:text-foreground-600 flex flex-col",VSe=oc();function GSe(n){const{items:e,ordered:t,start:r,shouldAnimate:i,BlockRenderer:a}=n,o=e.map(({items:s,delay:c},u)=>d.jsx(_e.li,{initial:i?"start":"end",animate:"end",variants:VSe,custom:c,className:"ps-2",children:d.jsx(a,{blocks:s,shouldAnimate:i})},u));return t?d.jsx("ol",{start:r,className:X(CN,"ms-5 marker:normal-nums marker:text-sm-strong"),children:o}):d.jsx("ul",{className:X(CN,"ms-4 px-1"),children:o})}const zU={shouldCollapseCode:!1},VU=m.createContext(zU);function KSe(n){const{children:e,config:t={}}=n,r=m.useMemo(()=>({...zU,...t}),[t]);return d.jsx(VU.Provider,{value:r,children:e})}function qSe(){return m.useContext(VU)}function WSe(n){const{items:e,shouldAnimate:t}=n;return d.jsx("p",{children:d.jsx("span",{className:X("font-ligatures-none","whitespace-pre-wrap",ho("aiMessageDefault")),children:d.jsx(vo,{items:e,shouldAnimate:t})})})}const YSe=oc();function QSe(n){const{columns:e,data:t,shouldAnimate:r}=n;return d.jsxs("div",{className:"relative max-w-full",children:[d.jsx("div",{className:"my-6 max-w-full overflow-x-auto rounded-lg bg-white/25 dark:bg-black/25",children:d.jsxs("table",{className:"t-table",style:{borderSpacing:0},children:[d.jsx("thead",{children:d.jsx("tr",{children:e.map((i,a)=>d.jsx(SN,{type:"head",items:i,shouldAnimate:r},a))})}),d.jsx("tbody",{children:t.map((i,a)=>d.jsx("tr",{children:i.map((o,s)=>d.jsx(SN,{type:"data",items:o,shouldAnimate:r},s))},a))})]})}),d.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-lg border border-stroke-300 dark:border-stroke-450"})]})}function SN(n){var a;const{type:e,items:t,shouldAnimate:r}=n,i=e==="head"?_e.th:_e.td;return d.jsx(i,{variants:YSe,initial:r?"start":"end",animate:"end",custom:((a=t[0])==null?void 0:a.delay)??0,children:d.jsx(vo,{shouldAnimate:r,items:t})})}const JSe=m.lazy(()=>$(()=>import("./code-Brj9DbY8.js"),__vite__mapDeps([330,1,2])));function Bp(n){const{blocks:e,shouldAnimate:t}=n,{shouldCollapseCode:r}=qSe();return d.jsx(d.Fragment,{children:e.map((i,a)=>{const o=`${i.type}-${a}`;switch(i.type){case"paragraph":return d.jsx(WSe,{items:i.items,shouldAnimate:t},o);case"list":return d.jsx(GSe,{ordered:i.ordered,start:i.start,items:i.items,BlockRenderer:Bp,shouldAnimate:t},o);case"heading":return d.jsx(FSe,{items:i.items,level:i.level,shouldAnimate:t},o);case"code":return d.jsx(JSe,{content:i.content,original:i.original,delay:i.delay,shouldAnimate:t,language:i.language,dangerouslyUseHtml:i.dangerouslyUseHtml,shouldCollapse:r},o);case"latex":return d.jsx(zSe,{content:i.content,delay:i.delay,shouldAnimate:t,dangerouslyUseHtml:i.dangerouslyUseHtml},o);case"table":return d.jsx(QSe,{columns:i.columns,data:i.data,shouldAnimate:t},o);case"blockquote":return d.jsx(wSe,{items:i.items,delay:i.delay,shouldAnimate:t,BlockRenderer:Bp},o);case"hr":return d.jsx(HSe,{delay:i.delay,shouldAnimate:t},o);default:return null}})})}let id=null;async function ZSe(n){return id||(id=(await $(async()=>{const{default:e}=await import("./katex-CfZphoad.js");return{default:e}},[])).default,n==null||n(),id)}function GU(n,e,t){return id?id.renderToString(n,{output:"mathml",displayMode:e,throwOnError:!1}):(ZSe(t),n)}var yc={},uf={},Cc={},wN;function KU(){if(wN)return Cc;wN=1,Object.defineProperty(Cc,"__esModule",{value:!0}),Cc.Node=Cc.NodeType=void 0;var n;(function(a){a[a.element=1]="element",a[a.text=3]="text"})(n||(Cc.NodeType=n={}));let e=class{constructor({nodeType:o,namespace:s,selfCloseTag:c,text:u,nodeName:h,childNodes:f,parentNode:p,attributes:g}){this.namespace=s||null,this.nodeType=o,this.isSelfCloseTag=!!c,this.text=u||null,this.nodeName=o===n.element?h:"#text",this.childNodes=f||[],this.parentNode=p,this.attributes=g||[]}get firstChild(){return this.childNodes[0]||null}get lastChild(){return this.childNodes[this.childNodes.length-1]||null}get innerHTML(){return this.childNodes.reduce((o,s)=>o+(s.nodeType===n.text?s.text:s.outerHTML),"")}get outerHTML(){if(this.nodeType===n.text)return this.textContent;const o=i(this.attributes),s=`<${this.nodeName}${o.length?" ":""}${o}${this.isSelfCloseTag?"/":""}>`;if(this.isSelfCloseTag)return s;const c=this.childNodes.map(h=>h.outerHTML).join(""),u=`</${this.nodeName}>`;return[s,c,u].join("")}get textContent(){return this.nodeType===n.text?this.text:this.childNodes.map(o=>o.textContent).join("").replace(/\x20+/g," ")}getAttribute(o){const s=this.attributes.find(c=>c.name===o);return s?s.value:null}getElementsByTagName(o){return t(this,s=>s.nodeName.toUpperCase()===o.toUpperCase())}getElementsByClassName(o){const s=new RegExp(`^(.*?\\s)?${o}(\\s.*?)?$`);return t(this,c=>!!(c.attributes.length&&s.test(c.getAttribute("class")||"")))}getElementsByName(o){return t(this,s=>!!(s.attributes.length&&s.getAttribute("name")===o))}getElementById(o){return r(this,s=>!!(s.attributes.length&&s.getAttribute("id")===o))}};Cc.Node=e,e.ELEMENT_NODE=n.element,e.TEXT_NODE=n.text;function t(a,o){return a.nodeType===n.text?[]:a.childNodes.reduce((s,c)=>c.nodeType!==n.text&&o(c)?[...s,c,...t(c,o)]:[...s,...t(c,o)],[])}function r(a,o){for(let s=0,c=a.childNodes.length;s<c;s++){const u=a.childNodes[s];if(o(u))return u;const h=r(u,o);if(h)return h}return null}function i(a){return a.map(o=>o.name+(o.value?`="${o.value}"`:"")).join(" ")}return Cc}var df={},EN;function XSe(){if(EN)return df;EN=1,Object.defineProperty(df,"__esModule",{value:!0}),df.NodeAttribute=void 0;let n=class{constructor({name:t,value:r}){this.name=t,this.value=r}};return df.NodeAttribute=n,df}var TN;function IN(){if(TN)return uf;TN=1,Object.defineProperty(uf,"__esModule",{value:!0}),uf.Dom=void 0;const n=KU(),e=XSe(),t=/(<\/?(?:[a-z][a-z0-9]*:)?[a-z][a-z0-9-_.]*?[a-z0-9]*\s*(?:\s+[a-z0-9-_:]+(?:=(?:(?:'[\s\S]*?')|(?:"[\s\S]*?")))?)*\s*\/?>)|([^<]|<(?![a-z/]))*/gi,r=/\s[a-z0-9-_:]+\b(\s*=\s*('|")[\s\S]*?\2)?/gi,i=/(\s[a-z0-9-_:]+\b\s*)(?:=(\s*('|")[\s\S]*?\3))?/gi,a=/^<[a-z]/,o=/\/>$/,s=/^<\//,c=/^[^<]/,u=/<\/?((?:([a-z][a-z0-9]*):)?(?:[a-z](?:[a-z0-9-_.]*[a-z0-9])?))/i,h=/^('|")|('|")$/g,f=/^(?:area|base|br|col|command|embed|hr|img|input|link|meta|param|source)/i;let p=class{constructor(I){this.rawHTML=I}find(I,k){const x=g(this.rawHTML,I,k);return k?x[0]||null:x}getElementsByClassName(I){const k=new RegExp(`^(.*?\\s)?${I}(\\s.*?)?$`);return this.find(x=>!!(x.attributes.length&&k.test(x.getAttribute("class")||"")))}getElementsByTagName(I){return this.find(k=>k.nodeName.toUpperCase()===I.toUpperCase())}getElementById(I){return this.find(k=>k.getAttribute("id")===I,!0)}getElementsByName(I){return this.find(k=>k.getAttribute("name")===I)}getElementsByAttribute(I,k){return this.find(x=>x.getAttribute(I)===k)}};uf.Dom=p;function g(A,I,k=!1){const x=v(A),_=[];for(const R of x)if(R&&I(R)&&(_.push(R),k))return _;return _}function*v(A){const I=b(A);let k=null;for(let x=0,_=I.length;x<_;x++){const R=I[x];k=C(R,k)||k,y(k,R)&&(yield k,k=k.parentNode)}for(;k;)yield k,k=k.parentNode}function y(A,I){if(!I)return!1;const k=s.test(I),[,x]=I.match(u)||[];return k&&A.nodeName===x||A.isSelfCloseTag||A.nodeType===n.NodeType.text}function b(A){return A.match(t)||[]}function C(A,I){const k=c.test(A),x=a.test(A);return k?T(A,I):x?S(A,I):null}function S(A,I){var k;const[,x,_]=A.match(u)||[],R=o.test(A)||f.test(x),z=E(A),j=new n.Node({nodeType:n.NodeType.element,nodeName:x,namespace:_,attributes:z,childNodes:[],parentNode:I,selfCloseTag:R});return(k=I==null?void 0:I.childNodes)===null||k===void 0||k.push(j),j}function E(A){return(A.match(r)||[]).map(I=>{i.lastIndex=0;const k=i.exec(I)||[],[,x="",_=""]=k;return new e.NodeAttribute({name:x.trim(),value:_.trim().replace(h,"")})})}function T(A,I){var k;const x=new n.Node({nodeType:n.NodeType.text,nodeName:"#text",text:A,parentNode:I});return(k=I==null?void 0:I.childNodes)===null||k===void 0||k.push(x),x}return uf}var AN;function e0e(){return AN||(AN=1,function(n){var e=yc&&yc.__createBinding||(Object.create?function(a,o,s,c){c===void 0&&(c=s);var u=Object.getOwnPropertyDescriptor(o,s);(!u||("get"in u?!o.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return o[s]}}),Object.defineProperty(a,c,u)}:function(a,o,s,c){c===void 0&&(c=s),a[c]=o[s]}),t=yc&&yc.__exportStar||function(a,o){for(var s in a)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&e(o,a,s)};Object.defineProperty(n,"__esModule",{value:!0}),n.parseFromString=void 0;const r=IN();function i(a){return new r.Dom(a)}n.parseFromString=i,t(IN(),n),t(KU(),n)}(yc)),yc}var kN=e0e();function ux(n){const e=[];let t="",r=!1;for(const i of n)i===" "||i===`
`?r=!0:r&&(e.push(t),t="",r=!1),t+=i;return t.length>0&&e.push(t),e}function t0e(n){const t=kN.parseFromString(`<html>${n}</html>`).getElementsByTagName("html")[0];let r=[];for(const i of t.childNodes)i.nodeType===kN.NodeType.text?i.textContent&&(r=r.concat(ux(i.textContent))):r.push(i.outerHTML);return r}function n0e(n){return n===" "||n===`
`||n==="	"}function qU(n,e,t={}){if(n.length<=e)return n;function r(s){const c=s.trim();return t.ellipsis?`${c}...`:c}const i=n.indexOf(`
`,0);if(i>=0&&i<e){const s=n.slice(0,i);return r(s)}let a=e;for(;a>0;){const s=n[a];if(s&&!n0e(s))a-=1;else break}let o=n.slice(0,e);return a>0&&(o=n.slice(0,a)),r(o)}let Wa=null;function WU(n){return Wa||($(()=>import("./core-DtWfXB6c.js"),__vite__mapDeps([331,2])).then(e=>e.default).then(e=>{Wa=e,n==null||n()}),null)}async function r0e(n){const[{ALIAS_TO_SUPPORTED_LANGUAGE:e},{loadLanguageModule:t}]=await Promise.all([$(()=>Promise.resolve().then(()=>wbe),void 0),$(()=>import("./language-loader-C2m3MlwV.js"),__vite__mapDeps([332,1,2]))]),r=e.get(n);if(!r)return!1;const i=await t(r);return i?Wa?(Wa.registerLanguage(n,i),!0):(WU(()=>{Wa==null||Wa.registerLanguage(n,i)}),!1):!1}const i0e={jsx:["xml"],tsx:["xml"]};async function a0e(n){const e=n.map(async r=>Wa?Wa.getLanguage(r)?!1:r0e(r):!1);return(await Promise.allSettled(e)).some(r=>r.status==="fulfilled"&&r.value)}async function o0e(n){const e=i0e[n]??[];return a0e([...e,n])}const Gu=.006;function xu({items:n,delay:e,isHtml:t,forceRender:r}){var a;const i=[];for(const o of n){if(o.type==="citation"){const p=e.getValue();e.queueUpdate(Gu),i.push({type:"citation",delay:p,...o.props});continue}if(o.type==="latex"){const p=GU(o.props.content,!1,r),g=e.getValue();e.queueUpdate(Gu),i.push({type:"word",word:p,delay:g,format:"latexAsHtml"});continue}if(o.props.link){const p=o.props.text,{url:g}=o.props.link,v=e.getValue();e.queueUpdate(Gu),i.push({type:"word",word:p,delay:v,url:g});continue}let s=null,c=null;if(o.props.annotations){for(const p of["italic","bold","strikethrough","code","sub","sup"])if(o.props.annotations[p]){const v={type:p,items:[]};(p==="code"||p==="sup"||p==="sub")&&(v.delay=e.getValue(),e.queueUpdate(Gu)),c?(c.items.push(v),c=v):(s=v,c=v)}}const u=[],h=(a=o.props.annotations)==null?void 0:a.code;let f;t?f=t0e(o.props.text):f=ux(o.props.text);for(let p=0;p<f.length;p+=1)u.push({type:"word",word:f[p],delay:e.getValue(),format:h?"code":void 0}),e.queueUpdate(Gu);c&&s?(c.items.push(...u),i.push(s)):i.push(...u)}return i}function Hp(n,e,t){const r=[];for(const i of n)switch(i.type){case"paragraph":{r.push({type:"paragraph",items:xu({items:i.props.items,delay:e,forceRender:t})});continue}case"list":{r.push({type:"list",ordered:i.props.ordered,start:i.props.start,items:i.props.items.map(a=>({delay:e.getValue(),items:Hp(a,e,t)}))});continue}case"heading":{r.push({type:"heading",level:i.props.level,items:xu({items:i.props.items,delay:e})});continue}case"hr":{r.push({type:"hr",delay:e.getValue()}),e.queueUpdate(Gu);continue}case"code":{const{language:a,content:o}=i.props;if(o.type!=="text")continue;let s=o.props.text,c=!1;if(a){const h=WU(t);if(o0e(a).then(f=>{f&&t()}),h!=null&&h.getLanguage(a)){const{value:f}=h.highlight(o.props.text,{language:a});f&&(s=f,c=!0)}}const u={...o,props:{...o.props,text:s}};r.push({type:"code",content:xu({items:[u],delay:e,isHtml:c}),original:o.props.text,language:a,delay:e.getValue(),dangerouslyUseHtml:c});continue}case"latex":{const{content:a}=i.props;if(a.type!=="text")continue;a.props.text=GU(a.props.text,!0,t),r.push({type:"latex",content:xu({items:[a],isHtml:!0,delay:e}),delay:e.getValue(),dangerouslyUseHtml:!0});continue}case"table":{r.push({type:"table",columns:i.props.columns.map(a=>xu({items:a,delay:e})),data:i.props.data.map(a=>a.map(o=>xu({items:o,delay:e})))});continue}case"blockquote":{r.push({type:"blockquote",delay:e.getValue(),items:Hp(i.props.items,e,t)});continue}default:{console.log(`Unhandled block type: ${i.type}`);continue}}return r}var kg;function YU(n){return kg=kg||document.createElement("textarea"),kg.innerHTML="&"+n+";",kg.value}var s0e=Object.prototype.hasOwnProperty;function c0e(n,e){return n?s0e.call(n,e):!1}function QU(n){var e=[].slice.call(arguments,1);return e.forEach(function(t){if(t){if(typeof t!="object")throw new TypeError(t+"must be object");Object.keys(t).forEach(function(r){n[r]=t[r]})}}),n}var l0e=/\\([\\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function $p(n){return n.indexOf("\\")<0?n:n.replace(l0e,"$1")}function JU(n){return!(n>=55296&&n<=57343||n>=64976&&n<=65007||(n&65535)===65535||(n&65535)===65534||n>=0&&n<=8||n===11||n>=14&&n<=31||n>=127&&n<=159||n>1114111)}function iT(n){if(n>65535){n-=65536;var e=55296+(n>>10),t=56320+(n&1023);return String.fromCharCode(e,t)}return String.fromCharCode(n)}var u0e=/&([a-z#][a-z0-9]{1,31});/gi,d0e=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;function h0e(n,e){var t=0,r=YU(e);return e!==r?r:e.charCodeAt(0)===35&&d0e.test(e)&&(t=e[1].toLowerCase()==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10),JU(t))?iT(t):n}function Il(n){return n.indexOf("&")<0?n:n.replace(u0e,h0e)}var f0e=/[&<>"]/,p0e=/[&<>"]/g,m0e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function g0e(n){return m0e[n]}function ti(n){return f0e.test(n)?n.replace(p0e,g0e):n}var Ze={};Ze.blockquote_open=function(){return`<blockquote>
`};Ze.blockquote_close=function(n,e){return"</blockquote>"+ou(n,e)};Ze.code=function(n,e){return n[e].block?"<pre><code>"+ti(n[e].content)+"</code></pre>"+ou(n,e):"<code>"+ti(n[e].content)+"</code>"};Ze.fence=function(n,e,t,r,i){var a=n[e],o="",s=t.langPrefix,c="",u,h,f;if(a.params){if(u=a.params.split(/\s+/g),h=u.join(" "),c0e(i.rules.fence_custom,u[0]))return i.rules.fence_custom[u[0]](n,e,t,r,i);c=ti(Il($p(h))),o=' class="'+s+c+'"'}return t.highlight?f=t.highlight.apply(t.highlight,[a.content].concat(u))||ti(a.content):f=ti(a.content),"<pre><code"+o+">"+f+"</code></pre>"+ou(n,e)};Ze.fence_custom={};Ze.heading_open=function(n,e){return"<h"+n[e].hLevel+">"};Ze.heading_close=function(n,e){return"</h"+n[e].hLevel+`>
`};Ze.hr=function(n,e,t){return(t.xhtmlOut?"<hr />":"<hr>")+ou(n,e)};Ze.bullet_list_open=function(){return`<ul>
`};Ze.bullet_list_close=function(n,e){return"</ul>"+ou(n,e)};Ze.list_item_open=function(){return"<li>"};Ze.list_item_close=function(){return`</li>
`};Ze.ordered_list_open=function(n,e){var t=n[e],r=t.order>1?' start="'+t.order+'"':"";return"<ol"+r+`>
`};Ze.ordered_list_close=function(n,e){return"</ol>"+ou(n,e)};Ze.paragraph_open=function(n,e){return n[e].tight?"":"<p>"};Ze.paragraph_close=function(n,e){var t=!(n[e].tight&&e&&n[e-1].type==="inline"&&!n[e-1].content);return(n[e].tight?"":"</p>")+(t?ou(n,e):"")};Ze.link_open=function(n,e,t){var r=n[e].title?' title="'+ti(Il(n[e].title))+'"':"",i=t.linkTarget?' target="'+t.linkTarget+'"':"";return'<a href="'+ti(n[e].href)+'"'+r+i+">"};Ze.link_close=function(){return"</a>"};Ze.image=function(n,e,t){var r=' src="'+ti(n[e].src)+'"',i=n[e].title?' title="'+ti(Il(n[e].title))+'"':"",a=' alt="'+(n[e].alt?ti(Il($p(n[e].alt))):"")+'"',o=t.xhtmlOut?" /":"";return"<img"+r+a+i+o+">"};Ze.table_open=function(){return`<table>
`};Ze.table_close=function(){return`</table>
`};Ze.thead_open=function(){return`<thead>
`};Ze.thead_close=function(){return`</thead>
`};Ze.tbody_open=function(){return`<tbody>
`};Ze.tbody_close=function(){return`</tbody>
`};Ze.tr_open=function(){return"<tr>"};Ze.tr_close=function(){return`</tr>
`};Ze.th_open=function(n,e){var t=n[e];return"<th"+(t.align?' style="text-align:'+t.align+'"':"")+">"};Ze.th_close=function(){return"</th>"};Ze.td_open=function(n,e){var t=n[e];return"<td"+(t.align?' style="text-align:'+t.align+'"':"")+">"};Ze.td_close=function(){return"</td>"};Ze.strong_open=function(){return"<strong>"};Ze.strong_close=function(){return"</strong>"};Ze.em_open=function(){return"<em>"};Ze.em_close=function(){return"</em>"};Ze.del_open=function(){return"<del>"};Ze.del_close=function(){return"</del>"};Ze.ins_open=function(){return"<ins>"};Ze.ins_close=function(){return"</ins>"};Ze.mark_open=function(){return"<mark>"};Ze.mark_close=function(){return"</mark>"};Ze.sub=function(n,e){return"<sub>"+ti(n[e].content)+"</sub>"};Ze.sup=function(n,e){return"<sup>"+ti(n[e].content)+"</sup>"};Ze.hardbreak=function(n,e,t){return t.xhtmlOut?`<br />
`:`<br>
`};Ze.softbreak=function(n,e,t){return t.breaks?t.xhtmlOut?`<br />
`:`<br>
`:`
`};Ze.text=function(n,e){return ti(n[e].content)};Ze.htmlblock=function(n,e){return n[e].content};Ze.htmltag=function(n,e){return n[e].content};Ze.abbr_open=function(n,e){return'<abbr title="'+ti(Il(n[e].title))+'">'};Ze.abbr_close=function(){return"</abbr>"};Ze.footnote_ref=function(n,e){var t=Number(n[e].id+1).toString(),r="fnref"+t;return n[e].subId>0&&(r+=":"+n[e].subId),'<sup class="footnote-ref"><a href="#fn'+t+'" id="'+r+'">['+t+"]</a></sup>"};Ze.footnote_block_open=function(n,e,t){var r=t.xhtmlOut?`<hr class="footnotes-sep" />
`:`<hr class="footnotes-sep">
`;return r+`<section class="footnotes">
<ol class="footnotes-list">
`};Ze.footnote_block_close=function(){return`</ol>
</section>
`};Ze.footnote_open=function(n,e){var t=Number(n[e].id+1).toString();return'<li id="fn'+t+'"  class="footnote-item">'};Ze.footnote_close=function(){return`</li>
`};Ze.footnote_anchor=function(n,e){var t=Number(n[e].id+1).toString(),r="fnref"+t;return n[e].subId>0&&(r+=":"+n[e].subId),' <a href="#'+r+'" class="footnote-backref">↩</a>'};Ze.dl_open=function(){return`<dl>
`};Ze.dt_open=function(){return"<dt>"};Ze.dd_open=function(){return"<dd>"};Ze.dl_close=function(){return`</dl>
`};Ze.dt_close=function(){return`</dt>
`};Ze.dd_close=function(){return`</dd>
`};function ZU(n,e){return++e>=n.length-2?e:n[e].type==="paragraph_open"&&n[e].tight&&n[e+1].type==="inline"&&n[e+1].content.length===0&&n[e+2].type==="paragraph_close"&&n[e+2].tight?ZU(n,e+2):e}var ou=Ze.getBreak=function(e,t){return t=ZU(e,t),t<e.length&&e[t].type==="list_item_close"?"":`
`};function dx(){this.rules=QU({},Ze),this.getBreak=Ze.getBreak}dx.prototype.renderInline=function(n,e,t){for(var r=this.rules,i=n.length,a=0,o="";i--;)o+=r[n[a].type](n,a++,e,t,this);return o};dx.prototype.render=function(n,e,t){for(var r=this.rules,i=n.length,a=-1,o="";++a<i;)n[a].type==="inline"?o+=this.renderInline(n[a].children,e,t):o+=r[n[a].type](n,a,e,t,this);return o};function ki(){this.__rules__=[],this.__cache__=null}ki.prototype.__find__=function(n){for(var e=this.__rules__.length,t=-1;e--;)if(this.__rules__[++t].name===n)return t;return-1};ki.prototype.__compile__=function(){var n=this,e=[""];n.__rules__.forEach(function(t){t.enabled&&t.alt.forEach(function(r){e.indexOf(r)<0&&e.push(r)})}),n.__cache__={},e.forEach(function(t){n.__cache__[t]=[],n.__rules__.forEach(function(r){r.enabled&&(t&&r.alt.indexOf(t)<0||n.__cache__[t].push(r.fn))})})};ki.prototype.at=function(n,e,t){var r=this.__find__(n),i=t||{};if(r===-1)throw new Error("Parser rule not found: "+n);this.__rules__[r].fn=e,this.__rules__[r].alt=i.alt||[],this.__cache__=null};ki.prototype.before=function(n,e,t,r){var i=this.__find__(n),a=r||{};if(i===-1)throw new Error("Parser rule not found: "+n);this.__rules__.splice(i,0,{name:e,enabled:!0,fn:t,alt:a.alt||[]}),this.__cache__=null};ki.prototype.after=function(n,e,t,r){var i=this.__find__(n),a=r||{};if(i===-1)throw new Error("Parser rule not found: "+n);this.__rules__.splice(i+1,0,{name:e,enabled:!0,fn:t,alt:a.alt||[]}),this.__cache__=null};ki.prototype.push=function(n,e,t){var r=t||{};this.__rules__.push({name:n,enabled:!0,fn:e,alt:r.alt||[]}),this.__cache__=null};ki.prototype.enable=function(n,e){n=Array.isArray(n)?n:[n],e&&this.__rules__.forEach(function(t){t.enabled=!1}),n.forEach(function(t){var r=this.__find__(t);if(r<0)throw new Error("Rules manager: invalid rule name "+t);this.__rules__[r].enabled=!0},this),this.__cache__=null};ki.prototype.disable=function(n){n=Array.isArray(n)?n:[n],n.forEach(function(e){var t=this.__find__(e);if(t<0)throw new Error("Rules manager: invalid rule name "+e);this.__rules__[t].enabled=!1},this),this.__cache__=null};ki.prototype.getRules=function(n){return this.__cache__===null&&this.__compile__(),this.__cache__[n]||[]};function v0e(n){n.inlineMode?n.tokens.push({type:"inline",content:n.src.replace(/\n/g," ").trim(),level:0,lines:[0,1],children:[]}):n.block.parse(n.src,n.options,n.env,n.tokens)}function su(n,e,t,r,i){this.src=n,this.env=r,this.options=t,this.parser=e,this.tokens=i,this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache=[],this.isInLabel=!1,this.linkLevel=0,this.linkContent="",this.labelUnmatchedScopes=0}su.prototype.pushPending=function(){this.tokens.push({type:"text",content:this.pending,level:this.pendingLevel}),this.pending=""};su.prototype.push=function(n){this.pending&&this.pushPending(),this.tokens.push(n),this.pendingLevel=this.level};su.prototype.cacheSet=function(n,e){for(var t=this.cache.length;t<=n;t++)this.cache.push(0);this.cache[n]=e};su.prototype.cacheGet=function(n){return n<this.cache.length?this.cache[n]:0};function zp(n,e){var t,r,i,a=-1,o=n.posMax,s=n.pos,c=n.isInLabel;if(n.isInLabel)return-1;if(n.labelUnmatchedScopes)return n.labelUnmatchedScopes--,-1;for(n.pos=e+1,n.isInLabel=!0,t=1;n.pos<o;){if(i=n.src.charCodeAt(n.pos),i===91)t++;else if(i===93&&(t--,t===0)){r=!0;break}n.parser.skipToken(n)}return r?(a=n.pos,n.labelUnmatchedScopes=0):n.labelUnmatchedScopes=t-1,n.pos=s,n.isInLabel=c,a}function b0e(n,e,t,r){var i,a,o,s,c,u;if(n.charCodeAt(0)!==42||n.charCodeAt(1)!==91||n.indexOf("]:")===-1||(i=new su(n,e,t,r,[]),a=zp(i,1),a<0||n.charCodeAt(a+1)!==58))return-1;for(s=i.posMax,o=a+2;o<s&&i.src.charCodeAt(o)!==10;o++);return c=n.slice(2,a),u=n.slice(a+2,o).trim(),u.length===0?-1:(r.abbreviations||(r.abbreviations={}),typeof r.abbreviations[":"+c]>"u"&&(r.abbreviations[":"+c]=u),o)}function y0e(n){var e=n.tokens,t,r,i,a;if(!n.inlineMode){for(t=1,r=e.length-1;t<r;t++)if(e[t-1].type==="paragraph_open"&&e[t].type==="inline"&&e[t+1].type==="paragraph_close"){for(i=e[t].content;i.length&&(a=b0e(i,n.inline,n.options,n.env),!(a<0));)i=i.slice(a).trim();e[t].content=i,i.length||(e[t-1].tight=!0,e[t+1].tight=!0)}}}function aT(n){var e=Il(n);try{e=decodeURI(e)}catch{}return encodeURI(e)}function XU(n,e){var t,r,i,a=e,o=n.posMax;if(n.src.charCodeAt(e)===60){for(e++;e<o;){if(t=n.src.charCodeAt(e),t===10)return!1;if(t===62)return i=aT($p(n.src.slice(a+1,e))),n.parser.validateLink(i)?(n.pos=e+1,n.linkContent=i,!0):!1;if(t===92&&e+1<o){e+=2;continue}e++}return!1}for(r=0;e<o&&(t=n.src.charCodeAt(e),!(t===32||t<32||t===127));){if(t===92&&e+1<o){e+=2;continue}if(t===40&&(r++,r>1)||t===41&&(r--,r<0))break;e++}return a===e||(i=$p(n.src.slice(a,e)),!n.parser.validateLink(i))?!1:(n.linkContent=i,n.pos=e,!0)}function eF(n,e){var t,r=e,i=n.posMax,a=n.src.charCodeAt(e);if(a!==34&&a!==39&&a!==40)return!1;for(e++,a===40&&(a=41);e<i;){if(t=n.src.charCodeAt(e),t===a)return n.pos=e+1,n.linkContent=$p(n.src.slice(r+1,e)),!0;if(t===92&&e+1<i){e+=2;continue}e++}return!1}function tF(n){return n.trim().replace(/\s+/g," ").toUpperCase()}function C0e(n,e,t,r){var i,a,o,s,c,u,h,f,p;if(n.charCodeAt(0)!==91||n.indexOf("]:")===-1||(i=new su(n,e,t,r,[]),a=zp(i,0),a<0||n.charCodeAt(a+1)!==58))return-1;for(s=i.posMax,o=a+2;o<s&&(c=i.src.charCodeAt(o),!(c!==32&&c!==10));o++);if(!XU(i,o))return-1;for(h=i.linkContent,o=i.pos,u=o,o=o+1;o<s&&(c=i.src.charCodeAt(o),!(c!==32&&c!==10));o++);for(o<s&&u!==o&&eF(i,o)?(f=i.linkContent,o=i.pos):(f="",o=u);o<s&&i.src.charCodeAt(o)===32;)o++;return o<s&&i.src.charCodeAt(o)!==10?-1:(p=tF(n.slice(1,a)),typeof r.references[p]>"u"&&(r.references[p]={title:f,href:h}),o)}function S0e(n){var e=n.tokens,t,r,i,a;if(n.env.references=n.env.references||{},!n.inlineMode){for(t=1,r=e.length-1;t<r;t++)if(e[t].type==="inline"&&e[t-1].type==="paragraph_open"&&e[t+1].type==="paragraph_close"){for(i=e[t].content;i.length&&(a=C0e(i,n.inline,n.options,n.env),!(a<0));)i=i.slice(a).trim();e[t].content=i,i.length||(e[t-1].tight=!0,e[t+1].tight=!0)}}}function w0e(n){var e=n.tokens,t,r,i;for(r=0,i=e.length;r<i;r++)t=e[r],t.type==="inline"&&n.inline.parse(t.content,n.options,n.env,t.children)}function E0e(n){var e,t,r,i,a,o,s,c,u,h=0,f=!1,p={};if(n.env.footnotes&&(n.tokens=n.tokens.filter(function(g){return g.type==="footnote_reference_open"?(f=!0,c=[],u=g.label,!1):g.type==="footnote_reference_close"?(f=!1,p[":"+u]=c,!1):(f&&c.push(g),!f)}),!!n.env.footnotes.list)){for(o=n.env.footnotes.list,n.tokens.push({type:"footnote_block_open",level:h++}),e=0,t=o.length;e<t;e++){for(n.tokens.push({type:"footnote_open",id:e,level:h++}),o[e].tokens?(s=[],s.push({type:"paragraph_open",tight:!1,level:h++}),s.push({type:"inline",content:"",level:h,children:o[e].tokens}),s.push({type:"paragraph_close",tight:!1,level:--h})):o[e].label&&(s=p[":"+o[e].label]),n.tokens=n.tokens.concat(s),n.tokens[n.tokens.length-1].type==="paragraph_close"?a=n.tokens.pop():a=null,i=o[e].count>0?o[e].count:1,r=0;r<i;r++)n.tokens.push({type:"footnote_anchor",id:e,subId:r,level:h});a&&n.tokens.push(a),n.tokens.push({type:"footnote_close",level:--h})}n.tokens.push({type:"footnote_block_close",level:--h})}}var xN=` 
()[]'".,!?-`;function mw(n){return n.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1")}function T0e(n){var e,t,r,i,a,o,s,c,u,h,f,p,g=n.tokens;if(n.env.abbreviations){for(n.env.abbrRegExp||(p="(^|["+xN.split("").map(mw).join("")+"])("+Object.keys(n.env.abbreviations).map(function(v){return v.substr(1)}).sort(function(v,y){return y.length-v.length}).map(mw).join("|")+")($|["+xN.split("").map(mw).join("")+"])",n.env.abbrRegExp=new RegExp(p,"g")),h=n.env.abbrRegExp,t=0,r=g.length;t<r;t++)if(g[t].type==="inline"){for(i=g[t].children,e=i.length-1;e>=0;e--)if(a=i[e],a.type==="text"){for(c=0,o=a.content,h.lastIndex=0,u=a.level,s=[];f=h.exec(o);)h.lastIndex>c&&s.push({type:"text",content:o.slice(c,f.index+f[1].length),level:u}),s.push({type:"abbr_open",title:n.env.abbreviations[":"+f[2]],level:u++}),s.push({type:"text",content:f[2],level:u}),s.push({type:"abbr_close",level:--u}),c=h.lastIndex-f[3].length;s.length&&(c<o.length&&s.push({type:"text",content:o.slice(c),level:u}),g[t].children=i=[].concat(i.slice(0,e),s,i.slice(e+1)))}}}}var I0e=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,A0e=/\((c|tm|r|p)\)/ig,k0e={c:"©",r:"®",p:"§",tm:"™"};function x0e(n){return n.indexOf("(")<0?n:n.replace(A0e,function(e,t){return k0e[t.toLowerCase()]})}function _0e(n){var e,t,r,i,a;if(n.options.typographer){for(a=n.tokens.length-1;a>=0;a--)if(n.tokens[a].type==="inline")for(i=n.tokens[a].children,e=i.length-1;e>=0;e--)t=i[e],t.type==="text"&&(r=t.content,r=x0e(r),I0e.test(r)&&(r=r.replace(/\+-/g,"±").replace(/\.{2,}/g,"…").replace(/([?!])…/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---([^-]|$)/mg,"$1—$2").replace(/(^|\s)--(\s|$)/mg,"$1–$2").replace(/(^|[^-\s])--([^-\s]|$)/mg,"$1–$2")),t.content=r)}}var M0e=/['"]/,_N=/['"]/g,R0e=/[-\s()\[\]]/,MN="’";function RN(n,e){return e<0||e>=n.length?!1:!R0e.test(n[e])}function _u(n,e,t){return n.substr(0,e)+t+n.substr(e+1)}function P0e(n){var e,t,r,i,a,o,s,c,u,h,f,p,g,v,y,b,C;if(n.options.typographer){for(C=[],y=n.tokens.length-1;y>=0;y--)if(n.tokens[y].type==="inline"){for(b=n.tokens[y].children,C.length=0,e=0;e<b.length;e++)if(t=b[e],!(t.type!=="text"||M0e.test(t.text))){for(s=b[e].level,g=C.length-1;g>=0&&!(C[g].level<=s);g--);C.length=g+1,r=t.content,a=0,o=r.length;e:for(;a<o&&(_N.lastIndex=a,i=_N.exec(r),!!i);){if(c=!RN(r,i.index-1),a=i.index+1,v=i[0]==="'",u=!RN(r,a),!u&&!c){v&&(t.content=_u(t.content,i.index,MN));continue}if(f=!u,p=!c,p){for(g=C.length-1;g>=0&&(h=C[g],!(C[g].level<s));g--)if(h.single===v&&C[g].level===s){h=C[g],v?(b[h.token].content=_u(b[h.token].content,h.pos,n.options.quotes[2]),t.content=_u(t.content,i.index,n.options.quotes[3])):(b[h.token].content=_u(b[h.token].content,h.pos,n.options.quotes[0]),t.content=_u(t.content,i.index,n.options.quotes[1])),C.length=g;continue e}}f?C.push({token:e,pos:i.index,single:v,level:s}):p&&v&&(t.content=_u(t.content,i.index,MN))}}}}}var gw=[["block",v0e],["abbr",y0e],["references",S0e],["inline",w0e],["footnote_tail",E0e],["abbr2",T0e],["replacements",_0e],["smartquotes",P0e]];function nF(){this.options={},this.ruler=new ki;for(var n=0;n<gw.length;n++)this.ruler.push(gw[n][0],gw[n][1])}nF.prototype.process=function(n){var e,t,r;for(r=this.ruler.getRules(""),e=0,t=r.length;e<t;e++)r[e](n)};function cu(n,e,t,r,i){var a,o,s,c,u,h,f;for(this.src=n,this.parser=e,this.options=t,this.env=r,this.tokens=i,this.bMarks=[],this.eMarks=[],this.tShift=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.parentType="root",this.ddIndent=-1,this.level=0,this.result="",o=this.src,h=0,f=!1,s=c=h=0,u=o.length;c<u;c++){if(a=o.charCodeAt(c),!f)if(a===32){h++;continue}else f=!0;(a===10||c===u-1)&&(a!==10&&c++,this.bMarks.push(s),this.eMarks.push(c),this.tShift.push(h),f=!1,h=0,s=c+1)}this.bMarks.push(o.length),this.eMarks.push(o.length),this.tShift.push(0),this.lineMax=this.bMarks.length-1}cu.prototype.isEmpty=function(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]};cu.prototype.skipEmptyLines=function(e){for(var t=this.lineMax;e<t&&!(this.bMarks[e]+this.tShift[e]<this.eMarks[e]);e++);return e};cu.prototype.skipSpaces=function(e){for(var t=this.src.length;e<t&&this.src.charCodeAt(e)===32;e++);return e};cu.prototype.skipChars=function(e,t){for(var r=this.src.length;e<r&&this.src.charCodeAt(e)===t;e++);return e};cu.prototype.skipCharsBack=function(e,t,r){if(e<=r)return e;for(;e>r;)if(t!==this.src.charCodeAt(--e))return e+1;return e};cu.prototype.getLines=function(e,t,r,i){var a,o,s,c,u,h=e;if(e>=t)return"";if(h+1===t)return o=this.bMarks[h]+Math.min(this.tShift[h],r),s=i?this.eMarks[h]+1:this.eMarks[h],this.src.slice(o,s);for(c=new Array(t-e),a=0;h<t;h++,a++)u=this.tShift[h],u>r&&(u=r),u<0&&(u=0),o=this.bMarks[h]+u,h+1<t||i?s=this.eMarks[h]+1:s=this.eMarks[h],c[a]=this.src.slice(o,s);return c.join("")};function N0e(n,e,t){var r,i;if(n.tShift[e]-n.blkIndent<4)return!1;for(i=r=e+1;r<t;){if(n.isEmpty(r)){r++;continue}if(n.tShift[r]-n.blkIndent>=4){r++,i=r;continue}break}return n.line=r,n.tokens.push({type:"code",content:n.getLines(e,i,4+n.blkIndent,!0),block:!0,lines:[e,n.line],level:n.level}),!0}function O0e(n,e,t,r){var i,a,o,s,c,u=!1,h=n.bMarks[e]+n.tShift[e],f=n.eMarks[e];if(h+3>f||(i=n.src.charCodeAt(h),i!==126&&i!==96)||(c=h,h=n.skipChars(h,i),a=h-c,a<3)||(o=n.src.slice(h,f).trim(),o.indexOf("`")>=0))return!1;if(r)return!0;for(s=e;s++,!(s>=t||(h=c=n.bMarks[s]+n.tShift[s],f=n.eMarks[s],h<f&&n.tShift[s]<n.blkIndent));)if(n.src.charCodeAt(h)===i&&!(n.tShift[s]-n.blkIndent>=4)&&(h=n.skipChars(h,i),!(h-c<a)&&(h=n.skipSpaces(h),!(h<f)))){u=!0;break}return a=n.tShift[e],n.line=s+(u?1:0),n.tokens.push({type:"fence",params:o,content:n.getLines(e+1,s,a,!0),lines:[e,n.line],level:n.level}),!0}function L0e(n,e,t,r){var i,a,o,s,c,u,h,f,p,g,v,y=n.bMarks[e]+n.tShift[e],b=n.eMarks[e];if(y>b||n.src.charCodeAt(y++)!==62||n.level>=n.options.maxNesting)return!1;if(r)return!0;for(n.src.charCodeAt(y)===32&&y++,c=n.blkIndent,n.blkIndent=0,s=[n.bMarks[e]],n.bMarks[e]=y,y=y<b?n.skipSpaces(y):y,a=y>=b,o=[n.tShift[e]],n.tShift[e]=y-n.bMarks[e],f=n.parser.ruler.getRules("blockquote"),i=e+1;i<t&&(y=n.bMarks[i]+n.tShift[i],b=n.eMarks[i],!(y>=b));i++){if(n.src.charCodeAt(y++)===62){n.src.charCodeAt(y)===32&&y++,s.push(n.bMarks[i]),n.bMarks[i]=y,y=y<b?n.skipSpaces(y):y,a=y>=b,o.push(n.tShift[i]),n.tShift[i]=y-n.bMarks[i];continue}if(a)break;for(v=!1,p=0,g=f.length;p<g;p++)if(f[p](n,i,t,!0)){v=!0;break}if(v)break;s.push(n.bMarks[i]),o.push(n.tShift[i]),n.tShift[i]=-1337}for(u=n.parentType,n.parentType="blockquote",n.tokens.push({type:"blockquote_open",lines:h=[e,0],level:n.level++}),n.parser.tokenize(n,e,i),n.tokens.push({type:"blockquote_close",level:--n.level}),n.parentType=u,h[1]=n.line,p=0;p<o.length;p++)n.bMarks[p+e]=s[p],n.tShift[p+e]=o[p];return n.blkIndent=c,!0}function D0e(n,e,t,r){var i,a,o,s=n.bMarks[e],c=n.eMarks[e];if(s+=n.tShift[e],s>c||(i=n.src.charCodeAt(s++),i!==42&&i!==45&&i!==95))return!1;for(a=1;s<c;){if(o=n.src.charCodeAt(s++),o!==i&&o!==32)return!1;o===i&&a++}return a<3?!1:(r||(n.line=e+1,n.tokens.push({type:"hr",lines:[e,n.line],level:n.level})),!0)}function PN(n,e){var t,r,i;return r=n.bMarks[e]+n.tShift[e],i=n.eMarks[e],r>=i||(t=n.src.charCodeAt(r++),t!==42&&t!==45&&t!==43)||r<i&&n.src.charCodeAt(r)!==32?-1:r}function NN(n,e){var t,r=n.bMarks[e]+n.tShift[e],i=n.eMarks[e];if(r+1>=i||(t=n.src.charCodeAt(r++),t<48||t>57))return-1;for(;;){if(r>=i)return-1;if(t=n.src.charCodeAt(r++),!(t>=48&&t<=57)){if(t===41||t===46)break;return-1}}return r<i&&n.src.charCodeAt(r)!==32?-1:r}function j0e(n,e){var t,r,i=n.level+2;for(t=e+2,r=n.tokens.length-2;t<r;t++)n.tokens[t].level===i&&n.tokens[t].type==="paragraph_open"&&(n.tokens[t+2].tight=!0,n.tokens[t].tight=!0,t+=2)}function U0e(n,e,t,r){var i,a,o,s,c,u,h,f,p,g,v,y,b,C,S,E,T,A,I=!0,k,x,_,R;if((f=NN(n,e))>=0)b=!0;else if((f=PN(n,e))>=0)b=!1;else return!1;if(n.level>=n.options.maxNesting)return!1;if(y=n.src.charCodeAt(f-1),r)return!0;for(S=n.tokens.length,b?(h=n.bMarks[e]+n.tShift[e],v=Number(n.src.substr(h,f-h-1)),n.tokens.push({type:"ordered_list_open",order:v,lines:T=[e,0],level:n.level++})):n.tokens.push({type:"bullet_list_open",lines:T=[e,0],level:n.level++}),i=e,E=!1,k=n.parser.ruler.getRules("list");i<t&&(C=n.skipSpaces(f),p=n.eMarks[i],C>=p?g=1:g=C-f,g>4&&(g=1),g<1&&(g=1),a=f-n.bMarks[i]+g,n.tokens.push({type:"list_item_open",lines:A=[e,0],level:n.level++}),s=n.blkIndent,c=n.tight,o=n.tShift[e],u=n.parentType,n.tShift[e]=C-n.bMarks[e],n.blkIndent=a,n.tight=!0,n.parentType="list",n.parser.tokenize(n,e,t,!0),(!n.tight||E)&&(I=!1),E=n.line-e>1&&n.isEmpty(n.line-1),n.blkIndent=s,n.tShift[e]=o,n.tight=c,n.parentType=u,n.tokens.push({type:"list_item_close",level:--n.level}),i=e=n.line,A[1]=i,C=n.bMarks[e],!(i>=t||n.isEmpty(i)||n.tShift[i]<n.blkIndent));){for(R=!1,x=0,_=k.length;x<_;x++)if(k[x](n,i,t,!0)){R=!0;break}if(R)break;if(b){if(f=NN(n,i),f<0)break}else if(f=PN(n,i),f<0)break;if(y!==n.src.charCodeAt(f-1))break}return n.tokens.push({type:b?"ordered_list_close":"bullet_list_close",level:--n.level}),T[1]=i,n.line=i,I&&j0e(n,S),!0}function F0e(n,e,t,r){var i,a,o,s,c,u=n.bMarks[e]+n.tShift[e],h=n.eMarks[e];if(u+4>h||n.src.charCodeAt(u)!==91||n.src.charCodeAt(u+1)!==94||n.level>=n.options.maxNesting)return!1;for(s=u+2;s<h;s++){if(n.src.charCodeAt(s)===32)return!1;if(n.src.charCodeAt(s)===93)break}return s===u+2||s+1>=h||n.src.charCodeAt(++s)!==58?!1:(r||(s++,n.env.footnotes||(n.env.footnotes={}),n.env.footnotes.refs||(n.env.footnotes.refs={}),c=n.src.slice(u+2,s-2),n.env.footnotes.refs[":"+c]=-1,n.tokens.push({type:"footnote_reference_open",label:c,level:n.level++}),i=n.bMarks[e],a=n.tShift[e],o=n.parentType,n.tShift[e]=n.skipSpaces(s)-s,n.bMarks[e]=s,n.blkIndent+=4,n.parentType="footnote",n.tShift[e]<n.blkIndent&&(n.tShift[e]+=n.blkIndent,n.bMarks[e]-=n.blkIndent),n.parser.tokenize(n,e,t,!0),n.parentType=o,n.blkIndent-=4,n.tShift[e]=a,n.bMarks[e]=i,n.tokens.push({type:"footnote_reference_close",level:--n.level})),!0)}function B0e(n,e,t,r){var i,a,o,s=n.bMarks[e]+n.tShift[e],c=n.eMarks[e];if(s>=c||(i=n.src.charCodeAt(s),i!==35||s>=c))return!1;for(a=1,i=n.src.charCodeAt(++s);i===35&&s<c&&a<=6;)a++,i=n.src.charCodeAt(++s);return a>6||s<c&&i!==32?!1:(r||(c=n.skipCharsBack(c,32,s),o=n.skipCharsBack(c,35,s),o>s&&n.src.charCodeAt(o-1)===32&&(c=o),n.line=e+1,n.tokens.push({type:"heading_open",hLevel:a,lines:[e,n.line],level:n.level}),s<c&&n.tokens.push({type:"inline",content:n.src.slice(s,c).trim(),level:n.level+1,lines:[e,n.line],children:[]}),n.tokens.push({type:"heading_close",hLevel:a,level:n.level})),!0)}function H0e(n,e,t){var r,i,a,o=e+1;return o>=t||n.tShift[o]<n.blkIndent||n.tShift[o]-n.blkIndent>3||(i=n.bMarks[o]+n.tShift[o],a=n.eMarks[o],i>=a)||(r=n.src.charCodeAt(i),r!==45&&r!==61)||(i=n.skipChars(i,r),i=n.skipSpaces(i),i<a)?!1:(i=n.bMarks[e]+n.tShift[e],n.line=o+1,n.tokens.push({type:"heading_open",hLevel:r===61?1:2,lines:[e,n.line],level:n.level}),n.tokens.push({type:"inline",content:n.src.slice(i,n.eMarks[e]).trim(),level:n.level+1,lines:[e,n.line-1],children:[]}),n.tokens.push({type:"heading_close",hLevel:r===61?1:2,level:n.level}),!0)}var rF={};["article","aside","button","blockquote","body","canvas","caption","col","colgroup","dd","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","li","map","object","ol","output","p","pre","progress","script","section","style","table","tbody","td","textarea","tfoot","th","tr","thead","ul","video"].forEach(function(n){rF[n]=!0});var $0e=/^<([a-zA-Z]{1,15})[\s\/>]/,z0e=/^<\/([a-zA-Z]{1,15})[\s>]/;function V0e(n){var e=n|32;return e>=97&&e<=122}function G0e(n,e,t,r){var i,a,o,s=n.bMarks[e],c=n.eMarks[e],u=n.tShift[e];if(s+=u,!n.options.html||u>3||s+2>=c||n.src.charCodeAt(s)!==60)return!1;if(i=n.src.charCodeAt(s+1),i===33||i===63){if(r)return!0}else if(i===47||V0e(i)){if(i===47){if(a=n.src.slice(s,c).match(z0e),!a)return!1}else if(a=n.src.slice(s,c).match($0e),!a)return!1;if(rF[a[1].toLowerCase()]!==!0)return!1;if(r)return!0}else return!1;for(o=e+1;o<n.lineMax&&!n.isEmpty(o);)o++;return n.line=o,n.tokens.push({type:"htmlblock",level:n.level,lines:[e,n.line],content:n.getLines(e,o,0,!0)}),!0}function vw(n,e){var t=n.bMarks[e]+n.blkIndent,r=n.eMarks[e];return n.src.substr(t,r-t)}function K0e(n,e,t,r){var i,a,o,s,c,u,h,f,p,g,v;if(e+2>t||(c=e+1,n.tShift[c]<n.blkIndent)||(o=n.bMarks[c]+n.tShift[c],o>=n.eMarks[c])||(i=n.src.charCodeAt(o),i!==124&&i!==45&&i!==58)||(a=vw(n,e+1),!/^[-:| ]+$/.test(a))||(u=a.split("|"),u<=2))return!1;for(f=[],s=0;s<u.length;s++){if(p=u[s].trim(),!p){if(s===0||s===u.length-1)continue;return!1}if(!/^:?-+:?$/.test(p))return!1;p.charCodeAt(p.length-1)===58?f.push(p.charCodeAt(0)===58?"center":"right"):p.charCodeAt(0)===58?f.push("left"):f.push("")}if(a=vw(n,e).trim(),a.indexOf("|")===-1||(u=a.replace(/^\||\|$/g,"").split("|"),f.length!==u.length))return!1;if(r)return!0;for(n.tokens.push({type:"table_open",lines:g=[e,0],level:n.level++}),n.tokens.push({type:"thead_open",lines:[e,e+1],level:n.level++}),n.tokens.push({type:"tr_open",lines:[e,e+1],level:n.level++}),s=0;s<u.length;s++)n.tokens.push({type:"th_open",align:f[s],lines:[e,e+1],level:n.level++}),n.tokens.push({type:"inline",content:u[s].trim(),lines:[e,e+1],level:n.level,children:[]}),n.tokens.push({type:"th_close",level:--n.level});for(n.tokens.push({type:"tr_close",level:--n.level}),n.tokens.push({type:"thead_close",level:--n.level}),n.tokens.push({type:"tbody_open",lines:v=[e+2,0],level:n.level++}),c=e+2;c<t&&!(n.tShift[c]<n.blkIndent||(a=vw(n,c).trim(),a.indexOf("|")===-1));c++){for(u=a.replace(/^\||\|$/g,"").split("|"),n.tokens.push({type:"tr_open",level:n.level++}),s=0;s<u.length;s++)n.tokens.push({type:"td_open",align:f[s],level:n.level++}),h=u[s].substring(u[s].charCodeAt(0)===124?1:0,u[s].charCodeAt(u[s].length-1)===124?u[s].length-1:u[s].length).trim(),n.tokens.push({type:"inline",content:h,level:n.level,children:[]}),n.tokens.push({type:"td_close",level:--n.level});n.tokens.push({type:"tr_close",level:--n.level})}return n.tokens.push({type:"tbody_close",level:--n.level}),n.tokens.push({type:"table_close",level:--n.level}),g[1]=v[1]=c,n.line=c,!0}function xg(n,e){var t,r,i=n.bMarks[e]+n.tShift[e],a=n.eMarks[e];return i>=a||(r=n.src.charCodeAt(i++),r!==126&&r!==58)||(t=n.skipSpaces(i),i===t)||t>=a?-1:t}function q0e(n,e){var t,r,i=n.level+2;for(t=e+2,r=n.tokens.length-2;t<r;t++)n.tokens[t].level===i&&n.tokens[t].type==="paragraph_open"&&(n.tokens[t+2].tight=!0,n.tokens[t].tight=!0,t+=2)}function W0e(n,e,t,r){var i,a,o,s,c,u,h,f,p,g,v,y,b,C;if(r)return n.ddIndent<0?!1:xg(n,e)>=0;if(h=e+1,n.isEmpty(h)&&++h>t||n.tShift[h]<n.blkIndent||(i=xg(n,h),i<0)||n.level>=n.options.maxNesting)return!1;u=n.tokens.length,n.tokens.push({type:"dl_open",lines:c=[e,0],level:n.level++}),o=e,a=h;e:for(;;){for(C=!0,b=!1,n.tokens.push({type:"dt_open",lines:[o,o],level:n.level++}),n.tokens.push({type:"inline",content:n.getLines(o,o+1,n.blkIndent,!1).trim(),level:n.level+1,lines:[o,o],children:[]}),n.tokens.push({type:"dt_close",level:--n.level});;){if(n.tokens.push({type:"dd_open",lines:s=[h,0],level:n.level++}),y=n.tight,p=n.ddIndent,f=n.blkIndent,v=n.tShift[a],g=n.parentType,n.blkIndent=n.ddIndent=n.tShift[a]+2,n.tShift[a]=i-n.bMarks[a],n.tight=!0,n.parentType="deflist",n.parser.tokenize(n,a,t,!0),(!n.tight||b)&&(C=!1),b=n.line-a>1&&n.isEmpty(n.line-1),n.tShift[a]=v,n.tight=y,n.parentType=g,n.blkIndent=f,n.ddIndent=p,n.tokens.push({type:"dd_close",level:--n.level}),s[1]=h=n.line,h>=t||n.tShift[h]<n.blkIndent)break e;if(i=xg(n,h),i<0)break;a=h}if(h>=t||(o=h,n.isEmpty(o))||n.tShift[o]<n.blkIndent||(a=o+1,a>=t)||(n.isEmpty(a)&&a++,a>=t)||n.tShift[a]<n.blkIndent||(i=xg(n,a),i<0))break}return n.tokens.push({type:"dl_close",level:--n.level}),c[1]=h,n.line=h,C&&q0e(n,u),!0}function Y0e(n,e){var t,r,i,a,o,s=e+1,c;if(t=n.lineMax,s<t&&!n.isEmpty(s)){for(c=n.parser.ruler.getRules("paragraph");s<t&&!n.isEmpty(s);s++)if(!(n.tShift[s]-n.blkIndent>3)){for(i=!1,a=0,o=c.length;a<o;a++)if(c[a](n,s,t,!0)){i=!0;break}if(i)break}}return r=n.getLines(e,s,n.blkIndent,!1).trim(),n.line=s,r.length&&(n.tokens.push({type:"paragraph_open",tight:!1,lines:[e,n.line],level:n.level}),n.tokens.push({type:"inline",content:r,level:n.level+1,lines:[e,n.line],children:[]}),n.tokens.push({type:"paragraph_close",tight:!1,level:n.level})),!0}var _g=[["code",N0e],["fences",O0e,["paragraph","blockquote","list"]],["blockquote",L0e,["paragraph","blockquote","list"]],["hr",D0e,["paragraph","blockquote","list"]],["list",U0e,["paragraph","blockquote"]],["footnote",F0e,["paragraph"]],["heading",B0e,["paragraph","blockquote"]],["lheading",H0e],["htmlblock",G0e,["paragraph","blockquote"]],["table",K0e,["paragraph"]],["deflist",W0e,["paragraph"]],["paragraph",Y0e]];function hx(){this.ruler=new ki;for(var n=0;n<_g.length;n++)this.ruler.push(_g[n][0],_g[n][1],{alt:(_g[n][2]||[]).slice()})}hx.prototype.tokenize=function(n,e,t){for(var r=this.ruler.getRules(""),i=r.length,a=e,o=!1,s,c;a<t&&(n.line=a=n.skipEmptyLines(a),!(a>=t||n.tShift[a]<n.blkIndent));){for(c=0;c<i&&(s=r[c](n,a,t,!1),!s);c++);if(n.tight=!o,n.isEmpty(n.line-1)&&(o=!0),a=n.line,a<t&&n.isEmpty(a)){if(o=!0,a++,a<t&&n.parentType==="list"&&n.isEmpty(a))break;n.line=a}}};var Q0e=/[\n\t]/g,J0e=/\r[\n\u0085]|[\u2424\u2028\u0085]/g,Z0e=/\u00a0/g;hx.prototype.parse=function(n,e,t,r){var i,a=0,o=0;if(!n)return[];n=n.replace(Z0e," "),n=n.replace(J0e,`
`),n.indexOf("	")>=0&&(n=n.replace(Q0e,function(s,c){var u;return n.charCodeAt(c)===10?(a=c+1,o=0,s):(u="    ".slice((c-a-o)%4),o=c-a+1,u)})),i=new cu(n,this,e,t,r),this.tokenize(i,i.line,i.lineMax)};function X0e(n){switch(n){case 10:case 92:case 96:case 42:case 95:case 94:case 91:case 93:case 33:case 38:case 60:case 62:case 123:case 125:case 36:case 37:case 64:case 126:case 43:case 61:case 58:return!0;default:return!1}}function ewe(n,e){for(var t=n.pos;t<n.posMax&&!X0e(n.src.charCodeAt(t));)t++;return t===n.pos?!1:(e||(n.pending+=n.src.slice(n.pos,t)),n.pos=t,!0)}function twe(n,e){var t,r,i=n.pos;if(n.src.charCodeAt(i)!==10)return!1;if(t=n.pending.length-1,r=n.posMax,!e)if(t>=0&&n.pending.charCodeAt(t)===32)if(t>=1&&n.pending.charCodeAt(t-1)===32){for(var a=t-2;a>=0;a--)if(n.pending.charCodeAt(a)!==32){n.pending=n.pending.substring(0,a+1);break}n.push({type:"hardbreak",level:n.level})}else n.pending=n.pending.slice(0,-1),n.push({type:"softbreak",level:n.level});else n.push({type:"softbreak",level:n.level});for(i++;i<r&&n.src.charCodeAt(i)===32;)i++;return n.pos=i,!0}var fx=[];for(var ON=0;ON<256;ON++)fx.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(n){fx[n.charCodeAt(0)]=1});function nwe(n,e){var t,r=n.pos,i=n.posMax;if(n.src.charCodeAt(r)!==92)return!1;if(r++,r<i){if(t=n.src.charCodeAt(r),t<256&&fx[t]!==0)return e||(n.pending+=n.src[r]),n.pos+=2,!0;if(t===10){for(e||n.push({type:"hardbreak",level:n.level}),r++;r<i&&n.src.charCodeAt(r)===32;)r++;return n.pos=r,!0}}return e||(n.pending+="\\"),n.pos++,!0}function rwe(n,e){var t,r,i,a,o,s=n.pos,c=n.src.charCodeAt(s);if(c!==96)return!1;for(t=s,s++,r=n.posMax;s<r&&n.src.charCodeAt(s)===96;)s++;for(i=n.src.slice(t,s),a=o=s;(a=n.src.indexOf("`",o))!==-1;){for(o=a+1;o<r&&n.src.charCodeAt(o)===96;)o++;if(o-a===i.length)return e||n.push({type:"code",content:n.src.slice(s,a).replace(/[ \n]+/g," ").trim(),block:!1,level:n.level}),n.pos=o,!0}return e||(n.pending+=i),n.pos+=i.length,!0}function iwe(n,e){var t,r,i,a=n.posMax,o=n.pos,s,c;if(n.src.charCodeAt(o)!==126||e||o+4>=a||n.src.charCodeAt(o+1)!==126||n.level>=n.options.maxNesting||(s=o>0?n.src.charCodeAt(o-1):-1,c=n.src.charCodeAt(o+2),s===126)||c===126||c===32||c===10)return!1;for(r=o+2;r<a&&n.src.charCodeAt(r)===126;)r++;if(r>o+3)return n.pos+=r-o,e||(n.pending+=n.src.slice(o,r)),!0;for(n.pos=o+2,i=1;n.pos+1<a;){if(n.src.charCodeAt(n.pos)===126&&n.src.charCodeAt(n.pos+1)===126&&(s=n.src.charCodeAt(n.pos-1),c=n.pos+2<a?n.src.charCodeAt(n.pos+2):-1,c!==126&&s!==126&&(s!==32&&s!==10?i--:c!==32&&c!==10&&i++,i<=0))){t=!0;break}n.parser.skipToken(n)}return t?(n.posMax=n.pos,n.pos=o+2,e||(n.push({type:"del_open",level:n.level++}),n.parser.tokenize(n),n.push({type:"del_close",level:--n.level})),n.pos=n.posMax+2,n.posMax=a,!0):(n.pos=o,!1)}function awe(n,e){var t,r,i,a=n.posMax,o=n.pos,s,c;if(n.src.charCodeAt(o)!==43||e||o+4>=a||n.src.charCodeAt(o+1)!==43||n.level>=n.options.maxNesting||(s=o>0?n.src.charCodeAt(o-1):-1,c=n.src.charCodeAt(o+2),s===43)||c===43||c===32||c===10)return!1;for(r=o+2;r<a&&n.src.charCodeAt(r)===43;)r++;if(r!==o+2)return n.pos+=r-o,e||(n.pending+=n.src.slice(o,r)),!0;for(n.pos=o+2,i=1;n.pos+1<a;){if(n.src.charCodeAt(n.pos)===43&&n.src.charCodeAt(n.pos+1)===43&&(s=n.src.charCodeAt(n.pos-1),c=n.pos+2<a?n.src.charCodeAt(n.pos+2):-1,c!==43&&s!==43&&(s!==32&&s!==10?i--:c!==32&&c!==10&&i++,i<=0))){t=!0;break}n.parser.skipToken(n)}return t?(n.posMax=n.pos,n.pos=o+2,e||(n.push({type:"ins_open",level:n.level++}),n.parser.tokenize(n),n.push({type:"ins_close",level:--n.level})),n.pos=n.posMax+2,n.posMax=a,!0):(n.pos=o,!1)}function owe(n,e){var t,r,i,a=n.posMax,o=n.pos,s,c;if(n.src.charCodeAt(o)!==61||e||o+4>=a||n.src.charCodeAt(o+1)!==61||n.level>=n.options.maxNesting||(s=o>0?n.src.charCodeAt(o-1):-1,c=n.src.charCodeAt(o+2),s===61)||c===61||c===32||c===10)return!1;for(r=o+2;r<a&&n.src.charCodeAt(r)===61;)r++;if(r!==o+2)return n.pos+=r-o,e||(n.pending+=n.src.slice(o,r)),!0;for(n.pos=o+2,i=1;n.pos+1<a;){if(n.src.charCodeAt(n.pos)===61&&n.src.charCodeAt(n.pos+1)===61&&(s=n.src.charCodeAt(n.pos-1),c=n.pos+2<a?n.src.charCodeAt(n.pos+2):-1,c!==61&&s!==61&&(s!==32&&s!==10?i--:c!==32&&c!==10&&i++,i<=0))){t=!0;break}n.parser.skipToken(n)}return t?(n.posMax=n.pos,n.pos=o+2,e||(n.push({type:"mark_open",level:n.level++}),n.parser.tokenize(n),n.push({type:"mark_close",level:--n.level})),n.pos=n.posMax+2,n.posMax=a,!0):(n.pos=o,!1)}function LN(n){return n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122}function DN(n,e){var t=e,r,i,a,o=!0,s=!0,c=n.posMax,u=n.src.charCodeAt(e);for(r=e>0?n.src.charCodeAt(e-1):-1;t<c&&n.src.charCodeAt(t)===u;)t++;return t>=c&&(o=!1),a=t-e,a>=4?o=s=!1:(i=t<c?n.src.charCodeAt(t):-1,(i===32||i===10)&&(o=!1),(r===32||r===10)&&(s=!1),u===95&&(LN(r)&&(o=!1),LN(i)&&(s=!1))),{can_open:o,can_close:s,delims:a}}function swe(n,e){var t,r,i,a,o,s,c,u=n.posMax,h=n.pos,f=n.src.charCodeAt(h);if(f!==95&&f!==42||e)return!1;if(c=DN(n,h),t=c.delims,!c.can_open)return n.pos+=t,e||(n.pending+=n.src.slice(h,n.pos)),!0;if(n.level>=n.options.maxNesting)return!1;for(n.pos=h+t,s=[t];n.pos<u;){if(n.src.charCodeAt(n.pos)===f){if(c=DN(n,n.pos),r=c.delims,c.can_close){for(a=s.pop(),o=r;a!==o;){if(o<a){s.push(a-o);break}if(o-=a,s.length===0)break;n.pos+=a,a=s.pop()}if(s.length===0){t=a,i=!0;break}n.pos+=r;continue}c.can_open&&s.push(r),n.pos+=r;continue}n.parser.skipToken(n)}return i?(n.posMax=n.pos,n.pos=h+t,e||((t===2||t===3)&&n.push({type:"strong_open",level:n.level++}),(t===1||t===3)&&n.push({type:"em_open",level:n.level++}),n.parser.tokenize(n),(t===1||t===3)&&n.push({type:"em_close",level:--n.level}),(t===2||t===3)&&n.push({type:"strong_close",level:--n.level})),n.pos=n.posMax+t,n.posMax=u,!0):(n.pos=h,!1)}var cwe=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function lwe(n,e){var t,r,i=n.posMax,a=n.pos;if(n.src.charCodeAt(a)!==126||e||a+2>=i||n.level>=n.options.maxNesting)return!1;for(n.pos=a+1;n.pos<i;){if(n.src.charCodeAt(n.pos)===126){t=!0;break}n.parser.skipToken(n)}return!t||a+1===n.pos||(r=n.src.slice(a+1,n.pos),r.match(/(^|[^\\])(\\\\)*\s/))?(n.pos=a,!1):(n.posMax=n.pos,n.pos=a+1,e||n.push({type:"sub",level:n.level,content:r.replace(cwe,"$1")}),n.pos=n.posMax+1,n.posMax=i,!0)}var uwe=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function dwe(n,e){var t,r,i=n.posMax,a=n.pos;if(n.src.charCodeAt(a)!==94||e||a+2>=i||n.level>=n.options.maxNesting)return!1;for(n.pos=a+1;n.pos<i;){if(n.src.charCodeAt(n.pos)===94){t=!0;break}n.parser.skipToken(n)}return!t||a+1===n.pos||(r=n.src.slice(a+1,n.pos),r.match(/(^|[^\\])(\\\\)*\s/))?(n.pos=a,!1):(n.posMax=n.pos,n.pos=a+1,e||n.push({type:"sup",level:n.level,content:r.replace(uwe,"$1")}),n.pos=n.posMax+1,n.posMax=i,!0)}function hwe(n,e){var t,r,i,a,o,s,c,u,h=!1,f=n.pos,p=n.posMax,g=n.pos,v=n.src.charCodeAt(g);if(v===33&&(h=!0,v=n.src.charCodeAt(++g)),v!==91||n.level>=n.options.maxNesting||(t=g+1,r=zp(n,g),r<0))return!1;if(s=r+1,s<p&&n.src.charCodeAt(s)===40){for(s++;s<p&&(u=n.src.charCodeAt(s),!(u!==32&&u!==10));s++);if(s>=p)return!1;for(g=s,XU(n,s)?(a=n.linkContent,s=n.pos):a="",g=s;s<p&&(u=n.src.charCodeAt(s),!(u!==32&&u!==10));s++);if(s<p&&g!==s&&eF(n,s))for(o=n.linkContent,s=n.pos;s<p&&(u=n.src.charCodeAt(s),!(u!==32&&u!==10));s++);else o="";if(s>=p||n.src.charCodeAt(s)!==41)return n.pos=f,!1;s++}else{if(n.linkLevel>0)return!1;for(;s<p&&(u=n.src.charCodeAt(s),!(u!==32&&u!==10));s++);if(s<p&&n.src.charCodeAt(s)===91&&(g=s+1,s=zp(n,s),s>=0?i=n.src.slice(g,s++):s=g-1),i||(typeof i>"u"&&(s=r+1),i=n.src.slice(t,r)),c=n.env.references[tF(i)],!c)return n.pos=f,!1;a=c.href,o=c.title}return e||(n.pos=t,n.posMax=r,h?n.push({type:"image",src:a,title:o,alt:n.src.substr(t,r-t),level:n.level}):(n.push({type:"link_open",href:a,title:o,level:n.level++}),n.linkLevel++,n.parser.tokenize(n),n.linkLevel--,n.push({type:"link_close",level:--n.level}))),n.pos=s,n.posMax=p,!0}function fwe(n,e){var t,r,i,a,o=n.posMax,s=n.pos;return s+2>=o||n.src.charCodeAt(s)!==94||n.src.charCodeAt(s+1)!==91||n.level>=n.options.maxNesting||(t=s+2,r=zp(n,s+1),r<0)?!1:(e||(n.env.footnotes||(n.env.footnotes={}),n.env.footnotes.list||(n.env.footnotes.list=[]),i=n.env.footnotes.list.length,n.pos=t,n.posMax=r,n.push({type:"footnote_ref",id:i,level:n.level}),n.linkLevel++,a=n.tokens.length,n.parser.tokenize(n),n.env.footnotes.list[i]={tokens:n.tokens.splice(a)},n.linkLevel--),n.pos=r+1,n.posMax=o,!0)}function pwe(n,e){var t,r,i,a,o=n.posMax,s=n.pos;if(s+3>o||!n.env.footnotes||!n.env.footnotes.refs||n.src.charCodeAt(s)!==91||n.src.charCodeAt(s+1)!==94||n.level>=n.options.maxNesting)return!1;for(r=s+2;r<o;r++){if(n.src.charCodeAt(r)===32||n.src.charCodeAt(r)===10)return!1;if(n.src.charCodeAt(r)===93)break}return r===s+2||r>=o||(r++,t=n.src.slice(s+2,r-1),typeof n.env.footnotes.refs[":"+t]>"u")?!1:(e||(n.env.footnotes.list||(n.env.footnotes.list=[]),n.env.footnotes.refs[":"+t]<0?(i=n.env.footnotes.list.length,n.env.footnotes.list[i]={label:t,count:0},n.env.footnotes.refs[":"+t]=i):i=n.env.footnotes.refs[":"+t],a=n.env.footnotes.list[i].count,n.env.footnotes.list[i].count++,n.push({type:"footnote_ref",id:i,subId:a,level:n.level})),n.pos=r,n.posMax=o,!0)}var mwe=["coap","doi","javascript","aaa","aaas","about","acap","cap","cid","crid","data","dav","dict","dns","file","ftp","geo","go","gopher","h323","http","https","iax","icap","im","imap","info","ipp","iris","iris.beep","iris.xpc","iris.xpcs","iris.lwz","ldap","mailto","mid","msrp","msrps","mtqp","mupdate","news","nfs","ni","nih","nntp","opaquelocktoken","pop","pres","rtsp","service","session","shttp","sieve","sip","sips","sms","snmp","soap.beep","soap.beeps","tag","tel","telnet","tftp","thismessage","tn3270","tip","tv","urn","vemmi","ws","wss","xcon","xcon-userid","xmlrpc.beep","xmlrpc.beeps","xmpp","z39.50r","z39.50s","adiumxtra","afp","afs","aim","apt","attachment","aw","beshare","bitcoin","bolo","callto","chrome","chrome-extension","com-eventbrite-attendee","content","cvs","dlna-playsingle","dlna-playcontainer","dtn","dvb","ed2k","facetime","feed","finger","fish","gg","git","gizmoproject","gtalk","hcp","icon","ipn","irc","irc6","ircs","itms","jar","jms","keyparc","lastfm","ldaps","magnet","maps","market","message","mms","ms-help","msnim","mumble","mvn","notes","oid","palm","paparazzi","platform","proxy","psyc","query","res","resource","rmi","rsync","rtmp","secondlife","sftp","sgn","skype","smb","soldat","spotify","ssh","steam","svn","teamspeak","things","udp","unreal","ut2004","ventrilo","view-source","webcal","wtai","wyciwyg","xfire","xri","ymsgr"],gwe=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,vwe=/^<([a-zA-Z.\-]{1,25}):([^<>\x00-\x20]*)>/;function bwe(n,e){var t,r,i,a,o,s=n.pos;return n.src.charCodeAt(s)!==60||(t=n.src.slice(s),t.indexOf(">")<0)?!1:(r=t.match(vwe),r?mwe.indexOf(r[1].toLowerCase())<0||(a=r[0].slice(1,-1),o=aT(a),!n.parser.validateLink(a))?!1:(e||(n.push({type:"link_open",href:o,level:n.level}),n.push({type:"text",content:a,level:n.level+1}),n.push({type:"link_close",level:n.level})),n.pos+=r[0].length,!0):(i=t.match(gwe),i?(a=i[0].slice(1,-1),o=aT("mailto:"+a),n.parser.validateLink(o)?(e||(n.push({type:"link_open",href:o,level:n.level}),n.push({type:"text",content:a,level:n.level+1}),n.push({type:"link_close",level:n.level})),n.pos+=i[0].length,!0):!1):!1))}function DC(n,e){return n=n.source,e=e||"",function t(r,i){return r?(i=i.source||i,n=n.replace(r,i),t):new RegExp(n,e)}}var ywe=/[a-zA-Z_:][a-zA-Z0-9:._-]*/,Cwe=/[^"'=<>`\x00-\x20]+/,Swe=/'[^']*'/,wwe=/"[^"]*"/,Ewe=DC(/(?:unquoted|single_quoted|double_quoted)/)("unquoted",Cwe)("single_quoted",Swe)("double_quoted",wwe)(),Twe=DC(/(?:\s+attr_name(?:\s*=\s*attr_value)?)/)("attr_name",ywe)("attr_value",Ewe)(),Iwe=DC(/<[A-Za-z][A-Za-z0-9]*attribute*\s*\/?>/)("attribute",Twe)(),Awe=/<\/[A-Za-z][A-Za-z0-9]*\s*>/,kwe=/<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->/,xwe=/<[?].*?[?]>/,_we=/<![A-Z]+\s+[^>]*>/,Mwe=/<!\[CDATA\[[\s\S]*?\]\]>/,Rwe=DC(/^(?:open_tag|close_tag|comment|processing|declaration|cdata)/)("open_tag",Iwe)("close_tag",Awe)("comment",kwe)("processing",xwe)("declaration",_we)("cdata",Mwe)();function Pwe(n){var e=n|32;return e>=97&&e<=122}function Nwe(n,e){var t,r,i,a=n.pos;return!n.options.html||(i=n.posMax,n.src.charCodeAt(a)!==60||a+2>=i)||(t=n.src.charCodeAt(a+1),t!==33&&t!==63&&t!==47&&!Pwe(t))||(r=n.src.slice(a).match(Rwe),!r)?!1:(e||n.push({type:"htmltag",content:n.src.slice(a,a+r[0].length),level:n.level}),n.pos+=r[0].length,!0)}var Owe=/^&#((?:x[a-f0-9]{1,8}|[0-9]{1,8}));/i,Lwe=/^&([a-z][a-z0-9]{1,31});/i;function Dwe(n,e){var t,r,i,a=n.pos,o=n.posMax;if(n.src.charCodeAt(a)!==38)return!1;if(a+1<o){if(t=n.src.charCodeAt(a+1),t===35){if(i=n.src.slice(a).match(Owe),i)return e||(r=i[1][0].toLowerCase()==="x"?parseInt(i[1].slice(1),16):parseInt(i[1],10),n.pending+=JU(r)?iT(r):iT(65533)),n.pos+=i[0].length,!0}else if(i=n.src.slice(a).match(Lwe),i){var s=YU(i[1]);if(i[1]!==s)return e||(n.pending+=s),n.pos+=i[0].length,!0}}return e||(n.pending+="&"),n.pos++,!0}var bw=[["text",ewe],["newline",twe],["escape",nwe],["backticks",rwe],["del",iwe],["ins",awe],["mark",owe],["emphasis",swe],["sub",lwe],["sup",dwe],["links",hwe],["footnote_inline",fwe],["footnote_ref",pwe],["autolink",bwe],["htmltag",Nwe],["entity",Dwe]];function jC(){this.ruler=new ki;for(var n=0;n<bw.length;n++)this.ruler.push(bw[n][0],bw[n][1]);this.validateLink=jwe}jC.prototype.skipToken=function(n){var e=this.ruler.getRules(""),t=e.length,r=n.pos,i,a;if((a=n.cacheGet(r))>0){n.pos=a;return}for(i=0;i<t;i++)if(e[i](n,!0)){n.cacheSet(r,n.pos);return}n.pos++,n.cacheSet(r,n.pos)};jC.prototype.tokenize=function(n){for(var e=this.ruler.getRules(""),t=e.length,r=n.posMax,i,a;n.pos<r;){for(a=0;a<t&&(i=e[a](n,!1),!i);a++);if(i){if(n.pos>=r)break;continue}n.pending+=n.src[n.pos++]}n.pending&&n.pushPending()};jC.prototype.parse=function(n,e,t,r){var i=new su(n,this,e,t,r);this.tokenize(i)};function jwe(n){var e=["vbscript","javascript","file","data"],t=n.trim().toLowerCase();return t=Il(t),!(t.indexOf(":")!==-1&&e.indexOf(t.split(":")[0])!==-1)}var Uwe={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","replacements","smartquotes","references","abbr2","footnote_tail"]},block:{rules:["blockquote","code","fences","footnote","heading","hr","htmlblock","lheading","list","paragraph","table"]},inline:{rules:["autolink","backticks","del","emphasis","entity","escape","footnote_ref","htmltag","links","newline","text"]}}},Fwe={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{},block:{},inline:{}}},Bwe={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","abbr2"]},block:{rules:["blockquote","code","fences","heading","hr","htmlblock","lheading","list","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","htmltag","links","newline","text"]}}},Hwe={default:Uwe,full:Fwe,commonmark:Bwe};function iF(n,e,t){this.src=e,this.env=t,this.options=n.options,this.tokens=[],this.inlineMode=!1,this.inline=n.inline,this.block=n.block,this.renderer=n.renderer,this.typographer=n.typographer}function sc(n,e){typeof n!="string"&&(e=n,n="default"),e&&e.linkify!=null&&console.warn(`linkify option is removed. Use linkify plugin instead:

import Remarkable from 'remarkable';
import linkify from 'remarkable/linkify';
new Remarkable().use(linkify)
`),this.inline=new jC,this.block=new hx,this.core=new nF,this.renderer=new dx,this.ruler=new ki,this.options={},this.configure(Hwe[n]),this.set(e||{})}sc.prototype.set=function(n){QU(this.options,n)};sc.prototype.configure=function(n){var e=this;if(!n)throw new Error("Wrong `remarkable` preset, check name/content");n.options&&e.set(n.options),n.components&&Object.keys(n.components).forEach(function(t){n.components[t].rules&&e[t].ruler.enable(n.components[t].rules,!0)})};sc.prototype.use=function(n,e){return n(this,e),this};sc.prototype.parse=function(n,e){var t=new iF(this,n,e);return this.core.process(t),t.tokens};sc.prototype.render=function(n,e){return e=e||{},this.renderer.render(this.parse(n,e),this.options,e)};sc.prototype.parseInline=function(n,e){var t=new iF(this,n,e);return t.inlineMode=!0,this.core.process(t),t.tokens};sc.prototype.renderInline=function(n,e){return e=e||{},this.renderer.render(this.parseInline(n,e),this.options,e)};function $we(n){const e="\\(",t="\\)";function r(s,c){const u=s.pos,h=s.posMax;let f=u;if(s.src.charAt(f)!==e[0]||s.src.charAt(f+1)!==e[1])return!1;f+=e.length;const p=s.src.slice(u,f);if(p.length>2)return!1;const g=f;let v=0;for(;f<h;){const y=s.src.charAt(f),b=y===t[0]&&s.src.charAt(f+1)===t[1];if(y==="{"&&(f===0||s.src.charAt(f-1)!=="\\"))v+=1;else if(y==="}"&&(f===0||s.src.charAt(f-1)!=="\\")){if(v-=1,v<0)return!1}else if(b&&v===0){const C=f,S=f+t.length;if(S-C===p.length){if(!c){const E=s.src.slice(g,C).replace(/[ \n]+/g," ").trim();s.push({type:"latex",content:E,block:!1,level:s.level})}return s.pos=S,!0}}f+=1}return c||(s.pending+=p),s.pos+=p.length,!0}const i={start:"$$",end:"$$"},a={start:"\\[",end:"\\]"};function o(s,c,u,h){const f=s.tShift[c],p=s.bMarks[c]+f;let g=s.src.slice(p,s.eMarks[c]),v=null;if(g.startsWith(i.start)?v=i:g.startsWith(a.start)&&(v=a),!v)return!1;let y=c,b=!1;for(;y<=u;){const S=s.tShift[y],E=s.bMarks[y]+S;if(g=s.src.slice(E,s.eMarks[y]),g.endsWith(v.end)&&(y>c||g!==v.end)){b=!0;break}y+=1}if(!b)return!1;if(h)return!0;const C=s.src.slice(p+v.start.length,s.eMarks[y]-v.end.length);return s.tokens.push({type:"latex_block",content:C.trim(),lines:[c,y],level:s.level}),s.line=y+1,!0}n.inline.ruler.push("latex",r,{}),n.block.ruler.after("fences","latex_block",o,{})}function zwe(n){return n.replaceAll(/(\n\n\$\$.*?\$\$) *(\n\n)/g,"$1$2")}function Vwe(n){return[Gwe,Ir("kill-post-process-latex-double-dollar")?null:zwe].filter(t=>t!==null).reduce((t,r)=>r(t),n)}const yw="\\[",jN="\\]";function Gwe(n){return n.includes(yw)?n.replaceAll(yw,`

${yw}`).replaceAll(jN,`${jN}

`):n}const Mm=new sc({breaks:!0});Mm.use($we);Mm.inline.ruler.enable(["text","newline","emphasis","links","backticks","sup","sub","latex","del"],!0);Mm.block.ruler.enable(["list","paragraph","heading","hr","fences","table","blockquote","latex_block"],!0);Mm.core.ruler.enable(["block","inline","references"],!0);function Kwe(n){const[e="",...t]=n.replace(Am,"").split(Wb);return{index:e,title:t.join(Wb)}}function aF(n,e={}){const t=[];let r=null,i=!1,a=!1,o=!1;for(const s of n)switch(s.type){case"text":case"sup":case"sub":if("content"in s&&s.content){const c={},u=s.content.startsWith(Am)?{type:"citation",props:{index:"",title:"",url:"",iconUrl:null,publisher:null,snippet:null}}:{type:"text",props:{text:s.content}};if(u.type==="text"&&(r&&(u.props.link=r),i&&(c.bold=!0),a&&(c.italic=!0),o&&(c.strikethrough=!0),s.type==="text"&&(u.props.text=u.props.text.replaceAll("\\$","$")),s.type==="sup"&&(c.sup=!0),s.type==="sub"&&(c.sub=!0),Object.keys(c).length>0&&(u.props.annotations=c)),u.type==="citation"&&r){const{citations:h}=e,{index:f,title:p}=Kwe(s.content),g=h==null?void 0:h.find(v=>v.index===f);u.props={index:f,title:(g==null?void 0:g.title)??p,url:r.url,iconUrl:(g==null?void 0:g.iconUrl)??null,publisher:(g==null?void 0:g.publisher)??null,snippet:(g==null?void 0:g.snippet)??null}}t.push(u)}break;case"softbreak":case"hardbreak":t.push({type:"text",props:{text:`
`}});break;case"code":"content"in s&&t.push({type:"text",props:{text:s.content,annotations:{code:!0}}});break;case"latex":"content"in s&&t.push({type:"latex",props:{content:s.content}});break;case"strong_open":i=!0;break;case"strong_close":i=!1;break;case"em_open":a=!0;break;case"em_close":a=!1;break;case"del_open":o=!0;break;case"del_close":o=!1;break;case"link_open":r="href"in s?{url:Ls(s.href)}:null;break;case"link_close":r=null;break}return t}function Mg(n,e){return n!==void 0&&n.type==="inline"&&"children"in n?aF(Array.isArray(n.children)?n.children:[],e):null}function qwe(n,e){let t=0;function r(){var o;let a=n[t];if(!a)return null;if(a.type==="hr")return t+=1,a=n[t],{type:"hr"};if(a.type==="latex_block")return t+=1,"content"in a?{type:"latex",props:{content:{type:"text",props:{text:a.content}}}}:null;if(a.type==="paragraph_open"){t+=1,a=n[t],t+=1;const s=Mg(a,e);return s?{type:"paragraph",props:{items:s}}:null}if(a.type==="blockquote_open"){const s={type:"blockquote",props:{items:[]}};for(t+=1,a=n[t];(a==null?void 0:a.type)!=="blockquote_close";){const c=r();c&&"type"in c&&s.props.items.push(c),a=n[t]}return t+=1,s}if(a.type==="ordered_list_open"||a.type==="bullet_list_open"){const s={type:"list",props:{items:[],ordered:a.type==="ordered_list_open"}};"order"in a&&(s.props.start=a.order);const c=a.type==="ordered_list_open"?"ordered_list_close":"bullet_list_close";for(t+=1,a=n[t];(a==null?void 0:a.type)!==c;){const u=r(),h=[];if(u&&Array.isArray(u)){for(const f of u)(f.type==="paragraph"||f.type==="list"||f.type==="code"||f.type==="heading")&&h.push(f);s.props.items.push(h)}a=n[t]}return t+=1,s}if(a.type==="list_item_open"){const s=[];for(t+=1,a=n[t];(a==null?void 0:a.type)!=="list_item_close";){const c=r();if(c)for(const u of[c].flat())(u.type==="paragraph"||u.type==="list"||u.type==="code"||u.type==="heading")&&s.push(u);a=n[t]}return t+=1,s}if(a.type==="heading_open"){const s="hLevel"in a?a.hLevel:1;t+=1,a=n[t],t+=1;const c=Mg(a,e);return c?{type:"heading",props:{level:s,items:c}}:null}if(a.type==="fence"&&"content"in a){const s={type:"code",props:{content:{type:"text",props:{text:Tbe(a.content)}},language:"params"in a?a.params:void 0}};return t+=1,s}if(a.type==="table_open"){const s=[],c=[];for(;(a==null?void 0:a.type)!=="table_close";){if((a==null?void 0:a.type)==="th_open"){t+=1,a=n[t];const u=Mg(a,e);u&&s.push(u)}if((a==null?void 0:a.type)==="tr_open"&&!a.lines&&c.push([]),(a==null?void 0:a.type)==="td_open"){t+=1,a=n[t];const u=Mg(a,e);u&&((o=c[c.length-1])==null||o.push(u))}t+=1,a=n[t]}return{type:"table",props:{columns:s,data:c}}}return a.type==="inline"&&"children"in a?(t+=1,aF(a.children??[])):(t+=1,null)}const i=[];for(;t<n.length;){const a=r();a&&!Array.isArray(a)&&i.push(a)}return i}function px(n,e={}){const t=Mm.parse(Vwe(n),{});return qwe(t,e)}const Wwe={getValue:()=>0,queueUpdate:()=>{}};function Ywe(){}function Qwe(n){const{text:e}=n,t=px(e),r=Hp(t,Wwe,Ywe);return d.jsx(Bp,{blocks:r,shouldAnimate:!1})}function oF(n){const{artifact:e}=n;switch(e.type){case"code":{const{language:t,content:r}=e,i=`\`\`\`${t}
${r}
\`\`\``;return d.jsx(Qwe,{text:i})}case"file":{const{contentType:t,name:r,url:i}=e;return d.jsx(CSe,{name:r,contentType:t,url:i})}default:return null}}function Jwe(n){const{activities:e}=n;return d.jsx("div",{className:"flex flex-col gap-4 overflow-y-auto",children:e.map((t,r)=>d.jsxs("div",{className:"flex flex-col gap-4 pt-3",children:[d.jsx("h3",{children:t.title}),t.artifacts.map((i,a)=>d.jsx(oF,{artifact:i},a))]},r))})}const Zwe=O(void 0);function Xwe(){const[n,e]=Je(Zwe),t=!!n,r=()=>{e(void 0)};return!n||n.length===0?null:d.jsx(Gi,{className:"w-full max-w-[606px] p-4 pb-6",headerText:re("research.stepsDrawer.title"),isOpen:t,variant:"drawer",onClose:r,children:d.jsx(Jwe,{activities:n})})}function sF(n){const{onClose:e,children:t,className:r}=n,i=m.useRef(null);return fo({onOutsideEvent:()=>{e(i)},elements:[i],invokeOnce:!1,includeScroll:!1,includeFocus:!1}),uy.createPortal(d.jsx(On,{mode:"sync",className:ke("relative",$t.modal),children:d.jsx("div",{className:"fixed inset-0 flex items-end justify-center bg-black/20",children:d.jsxs("div",{className:"flex max-h-[90%] w-full shrink-0 flex-col rounded-t-4xl border border-white/100 bg-stone-150 backdrop-blur-xl dark:border-white/5 dark:bg-midnight-800",children:[d.jsx("div",{className:"relative flex w-full items-center justify-center py-3",children:d.jsx("div",{className:"h-[6px] w-12 rounded-full bg-black/25 dark:bg-white/25"})}),d.jsx("div",{className:ke("no-scrollbar w-full overflow-y-auto px-4 pb-4",r),ref:i,children:t})]})})}),document.body)}function bo(n){const e=m.useRef(null),{isOpen:t,dialogName:r,headerText:i,headerIcon:a,headerTextClassName:o,fullBleed:s,children:c,onClose:u,className:h,bottomSheetClassName:f,closeButtonTestId:p,backdropOpacity:g="default",bottomSheetOnSmall:v}=n,y=m.useRef(null),{t:b}=Ce(),C=Nn({breakpoint:"sm"}),S=m.useId(),E=v&&C,T=g==="none"?"backdrop:bg-transparent":"backdrop:bg-stone-850/30 dark:backdrop:bg-midnight-850/70",A=t&&!E&&u!==void 0;fo({onOutsideEvent:A?u:()=>{},elements:A?[y]:[],includeScroll:!1,includeFocus:!1});const{modalAttributes:I}=EC({trapFocus:!0,legacyTrapFocus:!0,alwaysFocusable:!0});if(m.useEffect(()=>{var k,x;t?(k=e.current)==null||k.showModal():(x=e.current)==null||x.close()},[t]),m.useEffect(()=>{const k=e.current;if(!k)return()=>{};const x=()=>{u==null||u()};return k.addEventListener("cancel",x),()=>{k.removeEventListener("cancel",x)}},[u]),E&&t){const k=!s&&i;return d.jsxs(sF,{onClose:u,className:f,children:[k&&d.jsx("h2",{id:S,className:"py-6 text-center text-foreground-850 text-xl",children:i}),c]})}return d.jsx(_e.dialog,{className:ke("fixed inset-0 m-auto rounded-4xl border border-white/10 bg-background-150 text-foreground-800 shadow-xl dark:bg-background-250",T),animate:t?"animate":"initial",initial:"initial",exit:"exit",variants:{initial:ct,animate:Rt},transition:{duration:Ei.default,ease:"easeInOut"},ref:e,role:"dialog","aria-modal":"true","aria-labelledby":i?S:void 0,"aria-label":i?void 0:r,...t?I:{},children:t&&d.jsxs("div",{"data-modal-overlay":"true",className:ke("flex min-h-[150px] flex-col gap-3",!s&&"p-6",h),ref:y,children:[!s&&d.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i&&d.jsxs("div",{children:[a,d.jsx("h2",{id:S,className:ke("text-foreground-800 text-md-strong",o),children:i})]}),u&&d.jsx(Ee,{variant:"square",color:"subtle-dimmed-inverted",size:"32-xs",title:b("common.closeText"),"aria-label":b("common.closeText"),onClick:u,testId:p,children:d.jsx(vr,{className:"size-5"})})]}),c]})})}const e1e="XF86Back",b6e="XF86BTVoice",t1e=461;function n1e(n){return n.key===e1e||n.keyCode===t1e}function r1e(n){const{className:e,children:t}=n;return d.jsx("span",{className:X("inline-block h-4 min-w-4 rounded-md bg-accent-200 px-1 pt-px text-center leading-4 text-foreground-800 text-3xs dark:bg-accent-200",e),children:t})}const i1e={default:"border-black/10 dark:border-white/10",accent:"border-stroke-300"};function eh(n){const{horizontalMargin:e=!0,verticalMargin:t=!0,color:r="default",className:i}=n;return d.jsx("div",{className:X("border-t-[1px]",e&&"mx-2",t&&"my-2",i1e[r],i)})}const a1e=m.lazy(()=>$(()=>import("./index-uHmhofaq.js").then(n=>n.i),__vite__mapDeps([333,2,323,1]))),o1e="focus-within:bg-neutral-50/5 before:pointer-events-none before:absolute before:inset-0 before:rounded-3xl before:border before:border-transparent focus-within:before:border-[1px] focus-within:before:border-[rgba(255,255,255,0.1)]";function s1e(){var h,f;const n=N(ote),[e,t]=Je(p3),r=m.useContext(_m),i=N(lt),a=UT(),o=((h=me.instance().config().composer)==null?void 0:h.largeScreen)===!0&&((f=me.instance().config().composer)==null?void 0:f.voiceOnly)===!0,s=()=>{t(null),nt({source:"citationOverflowModal",scenario:"close"})},{focusable:c}=ih({isFocusBoundary:!0});rs(p=>{n1e(p)&&(p.stopPropagation(),s())});const u=m.useMemo(()=>new Map((e??[]).map((p,g)=>[g,m.createRef()])),[e]);return d.jsx(bo,{isOpen:n,onClose:o?void 0:s,headerText:`${e==null?void 0:e.length} ${re("chat.references")}`,className:X(o?"max-h-[40vh]":"max-h-[80vh]",o?"w-[480px]":"w-[440px]","mx-4 px-2"),children:d.jsx(zT.Provider,{value:c.focusKey??"",children:d.jsx("div",{className:X("flex flex-col gap-2 overflow-y-auto",o?"no-scrollbar":"t-custom-scrollbar"),children:e==null?void 0:e.map((p,g)=>d.jsx(cF,{ref:u.get(g),index:g,citation:p,currentConversationId:i,messageId:r,isLargeScreenVoiceComposer:o,citationsModalData:e,rel:a},g))})})})}const cF=m.forwardRef(({index:n,citation:e,currentConversationId:t,messageId:r,citationsModalData:i,isLargeScreenVoiceComposer:a=!1,rel:o},s)=>{const{title:c,url:u,publisher:h}=e,{refCallback:f,focusable:p}=ih({autoRestoreFocus:!0,forceFocus:!0,scrollIntoViewOnFocus:!0},s);return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:X(a&&o1e,"group relative flex flex-row items-center gap-2 rounded-3xl p-2"),children:[d.jsxs("a",{rel:o,ref:f,className:"flex flex-1 flex-col items-start gap-2 py-1","data-spatial-navigation-autofocus":!0,href:u,"data-spatial-focus-key":p.focusKey,target:"_blank",onClick:g=>{if(a){g.preventDefault();return}nt({source:"citationModalLink",customData:JSON.stringify({destination:tl(u),conversationId:t,messageId:r})})},children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(r1e,{children:e.index}),d.jsx("div",{className:"text-foreground-550 text-xs",children:h??Pd(u)})]}),d.jsx("div",{children:c}),d.jsx("div",{className:"text-foreground-550 text-xs",children:Pd(u)})]}),a&&d.jsx(m.Suspense,{fallback:d.jsx("span",{}),children:d.jsx("div",{className:"flex size-28 items-center justify-center rounded-2xl bg-white opacity-0 group-focus-within:opacity-100",children:d.jsx(a1e,{value:u,size:86})})})]}),n<i.length-1&&d.jsx(eh,{horizontalMargin:!1,verticalMargin:!1,className:"my-4"})]})});cF.displayName="CitationItem";const c1e=m.lazy(()=>$(()=>Promise.resolve().then(()=>ax),void 0));async function l1e(n){await xr({path:n,args:{options:{method:"DELETE"}}})}function u1e(){const{t:n}=Ce(),e=pe(m3),{trigger:t,isMutating:r}=iI("/conversations/history",l1e),i=async()=>{await t(),e(null)},a=()=>{e(null)};return d.jsxs(bo,{isOpen:!0,onClose:a,headerText:n("settings.clearHistory.header"),className:"min-h-[328px] w-full max-w-[400px]",children:[d.jsx("p",{className:"text-start",children:n("settings.clearHistory.description")}),d.jsx(Ee,{title:n("settings.clearHistory.confirm"),color:"default",size:"56-xl",variant:"rect",className:"mt-3 w-full text-system-red-550 dark:text-system-red-350",onClick:i,disabled:r,children:r?d.jsx(c1e,{type:"spinnerThemed",className:"size-6"}):n("settings.clearHistory.confirm")}),d.jsx(Ee,{title:n("common.cancel"),color:"strong",size:"56-xl",variant:"rect",className:"mt-3 w-full",onClick:a,children:n("common.cancel")})]})}function Cw({Icon:n,title:e,description:t}){return d.jsxs("div",{className:"flex items-start gap-3 rounded-lg px-4 py-2",children:[d.jsx("div",{className:"shrink-0",children:d.jsx(n,{className:"size-5 text-accent-800"})}),d.jsxs("div",{className:"flex flex-col ps-1",children:[d.jsx("h3",{className:"text-foreground-800 text-sm-strong",children:e}),d.jsx("p",{className:"pt-1 text-foreground-600 text-sm",children:t})]})]})}const lF=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",...n},m.createElement("path",{d:"M15 6C15 6.55228 14.5523 7 14 7C13.4477 7 13 6.55228 13 6C13 5.44772 13.4477 5 14 5C14.5523 5 15 5.44772 15 6ZM12.5 2C9.42386 2 7 4.42386 7 7.5C7 7.89668 7.04001 8.29598 7.12154 8.67456C7.17968 8.94454 7.11378 9.17912 6.98018 9.31271L2.43934 13.8536C2.15804 14.1349 2 14.5164 2 14.9142V16.5C2 17.3284 2.67157 18 3.5 18H5.5C6.32843 18 7 17.3284 7 16.5V16H8C8.55228 16 9 15.5523 9 15V14H10C10.5523 14 11 13.5523 11 13V12.8199C11.4935 12.9536 12.0069 13 12.5 13C15.5761 13 18 10.5761 18 7.5C18 4.42386 15.5761 2 12.5 2ZM8 7.5C8 4.97614 9.97614 3 12.5 3C15.0239 3 17 4.97614 17 7.5C17 10.0239 15.0239 12 12.5 12C11.8408 12 11.2274 11.9047 10.7236 11.6528C10.5686 11.5753 10.3845 11.5836 10.2371 11.6747C10.0897 11.7658 10 11.9267 10 12.1V13H9C8.44772 13 8 13.4477 8 14V15H7C6.44772 15 6 15.4477 6 16V16.5C6 16.7761 5.77614 17 5.5 17H3.5C3.22386 17 3 16.7761 3 16.5V14.9142C3 14.7816 3.05268 14.6544 3.14645 14.5607L7.68729 10.0198C8.11942 9.58768 8.20942 8.97619 8.09913 8.46404C8.03354 8.15949 8 7.83105 8 7.5Z",fill:"currentColor"})),y6e=Object.freeze(Object.defineProperty({__proto__:null,default:lF},Symbol.toStringTag,{value:"Module"})),uF=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",...n},m.createElement("path",{d:"M7.25 5a.75.75 0 0 1 .11 1.492l-.11.008H5a3.5 3.5 0 0 0-.206 6.994L5 13.5h2.25a.75.75 0 0 1 .11 1.492L7.25 15H5a5 5 0 0 1-.25-9.994L5 5h2.25ZM15 5a5 5 0 0 1 .25 9.994L15 15h-2.25a.75.75 0 0 1-.11-1.492l.11-.008H15a3.5 3.5 0 0 0 .206-6.994L15 6.5h-2.25a.75.75 0 0 1-.11-1.492L12.75 5H15ZM5 9.25h10a.75.75 0 0 1 .102 1.493L15 10.75H5a.75.75 0 0 1-.102-1.493L5 9.25h10H5Z"})),C6e=Object.freeze(Object.defineProperty({__proto__:null,default:uF},Symbol.toStringTag,{value:"Module"})),dF=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",...n},m.createElement("path",{d:"M10 13C10.5523 13 11 12.5523 11 12C11 11.4477 10.5523 11 10 11C9.44771 11 9 11.4477 9 12C9 12.5523 9.44771 13 10 13ZM6 6H7V5C7 3.34315 8.34315 2 10 2C11.6569 2 13 3.34315 13 5V6H14C15.6569 6 17 7.34315 17 9V15C17 16.6569 15.6569 18 14 18H6C4.34315 18 3 16.6569 3 15V9C3 7.34315 4.34315 6 6 6ZM10 3C8.89543 3 8 3.89543 8 5V6H12V5C12 3.89543 11.1046 3 10 3ZM16 9C16 7.89543 15.1046 7 14 7H6C4.89543 7 4 7.89543 4 9V15C4 16.1046 4.89543 17 6 17H14C15.1046 17 16 16.1046 16 15V9Z",fill:"currentColor"})),S6e=Object.freeze(Object.defineProperty({__proto__:null,default:dF},Symbol.toStringTag,{value:"Module"})),hF=n=>m.createElement("svg",{viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("g",{id:"Shield Task"},m.createElement("path",{id:"Shape",d:"M10.8536 6.85355C11.0488 6.65829 11.0488 6.34171 10.8536 6.14645C10.6583 5.95118 10.3417 5.95118 10.1464 6.14645L7.5 8.79289L6.35355 7.64645C6.15829 7.45118 5.84171 7.45118 5.64645 7.64645C5.45118 7.84171 5.45118 8.15829 5.64645 8.35355L7.14645 9.85355C7.34171 10.0488 7.65829 10.0488 7.85355 9.85355L10.8536 6.85355ZM8.35464 2.14678C8.15946 1.95123 7.84268 1.95105 7.64728 2.14638C6.40416 3.38902 5.02923 4 3.5 4C3.22386 4 3 4.22386 3 4.5V7.50126C3 10.7196 4.64126 12.9075 7.84189 13.9743C7.94452 14.0086 8.05548 14.0086 8.15811 13.9743C11.3587 12.9075 13 10.7196 13 7.50126V4.5C13 4.22386 12.7761 4 12.5 4C10.9689 4 9.5947 3.38913 8.35464 2.14678ZM4 4.98118C5.47941 4.86879 6.81393 4.25491 8.00042 3.18917C9.18521 4.25528 10.5195 4.86895 12 4.98121V7.50126C12 8.9349 11.6373 10.0655 10.9787 10.9453C10.3414 11.7967 9.37047 12.4885 8 12.9715C6.62953 12.4885 5.65858 11.7967 5.02127 10.9453C4.36269 10.0655 4 8.9349 4 7.50126V4.98118Z"}))),w6e=Object.freeze(Object.defineProperty({__proto__:null,default:hF},Symbol.toStringTag,{value:"Module"}));function d1e(){const{t:n}=Ce(),[e,t]=Je(S3),[r,i]=m.useState(null),a=Bt(),{type:o,title:s,IconComponent:c,visible:u,termsLink:h}=e??{},f=()=>{t({visible:!1})};return m.useEffect(()=>{e!=null&&e.visible&&Tn(`/connections/${o}/create-connection`,Jee,{options:{method:"POST"},query:{redirectUrl:`${window.location.origin}/connector/callback?connectorType=${o}`}}).then(p=>i(p.data.loginUrl))},[e==null?void 0:e.visible,o]),!o||!s||!c||!h||!u?null:d.jsx(bo,{isOpen:u,className:"sm:w-[496px]",children:d.jsxs("div",{className:"flex flex-col items-center gap-2",children:[d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"flex flex-col items-center justify-center gap-2.5 rounded-2xl border border-black/12 p-1",children:d.jsx(c,{className:"size-12 p-1"})}),d.jsx("div",{className:"absolute -right-1 -top-1 flex size-5 items-center justify-center rounded-full bg-neutral-900",children:d.jsx(uF,{className:"size-3 text-white"})})]}),d.jsx("div",{className:"pt-4 text-center text-foreground-800 text-md sm:text-xl",children:n("connector.confirmModal.title",{title:s})}),d.jsxs("div",{className:"mt-6 flex flex-col rounded-3xl bg-black/5 py-3 sm:w-96",children:[d.jsx(Cw,{Icon:lF,title:n("connector.confirmModal.respectiveTitle"),description:n("connector.confirmModal.respectiveDescription",{title:s})}),d.jsx(eh,{color:"accent",horizontalMargin:!1}),d.jsx(Cw,{Icon:dF,title:n("connector.confirmModal.securityTitle"),description:n("connector.confirmModal.securityDescription",{title:s})}),d.jsx(eh,{color:"accent",horizontalMargin:!1}),d.jsx(Cw,{Icon:hF,title:n("connector.confirmModal.control"),description:n("connector.confirmModal.controlDescription",{title:s})})]}),d.jsxs("div",{className:"mt-6 flex flex-col gap-2",children:[d.jsx(Ee,{className:"h-14 w-full sm:w-96",color:"strong",size:"56-xl",title:n("connector.confirmModal.continue",{title:s}),onClick:()=>{r&&(NI("connectorConsentFlowStartUrl",a),Ch(r))},children:n("connector.confirmModal.continue",{title:s})}),d.jsx(Ee,{className:"w-full sm:w-96",color:"subtle-bright",size:"56-xl",title:n("common.cancel"),onClick:f,children:n("common.cancel")}),d.jsx("div",{className:"my-3 flex flex-col items-center gap-2 text-center sm:w-96",children:d.jsx("p",{className:"text-foreground-600 text-2xs",children:d.jsx(Fr,{i18nKey:"connector.confirmModal.disclaimer",components:{Terms:d.jsx(to,{href:h,title:n("connector.confirmModal.terms"),className:"underline text-2xs",children:n("connector.confirmModal.terms")})},values:{title:s}})})})]})]})})}const mx=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M17.7545 14.0002C18.9966 14.0002 20.0034 15.007 20.0034 16.2491V16.8245C20.0034 17.7188 19.6838 18.5836 19.1023 19.263C17.5329 21.0965 15.1457 22.0013 12.0004 22.0013C8.8545 22.0013 6.46849 21.0962 4.90219 19.2619C4.32242 18.583 4.00391 17.7195 4.00391 16.8267V16.2491C4.00391 15.007 5.01076 14.0002 6.25278 14.0002H17.7545ZM17.7545 15.5002H6.25278C5.83919 15.5002 5.50391 15.8355 5.50391 16.2491V16.8267C5.50391 17.3624 5.69502 17.8805 6.04287 18.2878C7.29618 19.7555 9.26206 20.5013 12.0004 20.5013C14.7387 20.5013 16.7063 19.7555 17.9627 18.2876C18.3117 17.8799 18.5034 17.361 18.5034 16.8245V16.2491C18.5034 15.8355 18.1681 15.5002 17.7545 15.5002ZM12.0004 2.00488C14.7618 2.00488 17.0004 4.24346 17.0004 7.00488C17.0004 9.76631 14.7618 12.0049 12.0004 12.0049C9.23894 12.0049 7.00036 9.76631 7.00036 7.00488C7.00036 4.24346 9.23894 2.00488 12.0004 2.00488ZM12.0004 3.50488C10.0674 3.50488 8.50036 5.07189 8.50036 7.00488C8.50036 8.93788 10.0674 10.5049 12.0004 10.5049C13.9334 10.5049 15.5004 8.93788 15.5004 7.00488C15.5004 5.07189 13.9334 3.50488 12.0004 3.50488Z"})),E6e=Object.freeze(Object.defineProperty({__proto__:null,default:mx},Symbol.toStringTag,{value:"Module"})),Sw="relative size-full rounded-full aspect-square",UN="flex items-center justify-center uppercase",ww="after:absolute after:-inset-px after:rounded-full after:border-[0.5px] after:border-black/10 dark:after:border-white/20";function fF(n){const{firstName:e,imgSrc:t,nameSizeClass:r,altText:i}=n;return t?d.jsx("img",{className:X("overflow-hidden object-cover",Sw,ww),src:t,alt:i??re("common.profileImage")}):e?d.jsx("div",{className:X(Sw,UN,ww,r??"text-md"),children:d.jsx("div",{children:e[0]})}):d.jsx("div",{className:X(Sw,UN,ww),children:d.jsx(mx,{className:"size-6 fill-foreground-800","alt-text":i??re("common.profileImage")})})}const FN=5e3;function h1e(){const n=ee("aad-student"),e=N(Kte),{t}=Ce(),[r,i]=m.useState(!1),a=n&&e&&!r,o=N(T4),s=N(Gl),c=n&&e===void 0&&o&&s,u=c&&!r;m.useEffect(()=>{if(c&&!r){const C=setTimeout(()=>{i(!0),Ore(new Error(`Student status check timed out after ${FN}ms`))},FN);return()=>clearTimeout(C)}},[c,r]);const h=t(a?"entraRedirect.guestTitle":"entraRedirect.workTitle"),f=t(a?"entraRedirect.guestDescription":"entraRedirect.workDescription");return{isStudentEnabled:a,isLoadingEnabled:u,workTitle:h,workDescription:f,titleGapClass:a?"mb-6 sm:mb-10":"mb-8 sm:mb-14",eventInfoScenario:a?"Student":"Enterprise",getPageTitle:()=>t(a?"aadStudent.title":"entraRedirect.pageTitle"),getPageSubTitle:C=>a?t("aadStudent.subtitle",{email:C}):void 0,getWorkButtonText:C=>a?t("aadStudent.continueAsGuestButtonText"):t("entraRedirect.goToWorkButton",{redirectUrl:C})}}function f1e(){var ue;const n=N(T4),e=N(Gl),t=N(hr),[r,i]=m.useState(void 0),a=ee("aad-login-removal"),o=xl(),s=Ta(),{isStudentEnabled:c,isLoadingEnabled:u,workTitle:h,workDescription:f,titleGapClass:p,eventInfoScenario:g,getPageTitle:v,getPageSubTitle:y,getWorkButtonText:b}=h1e(),C=!c&&(t==null?void 0:t.email);m.useEffect(()=>{n&&br(Mv,JSON.stringify(n))},[n]);let S=!1;try{S=JSON.parse(Pn(Mv)??"false")}catch(te){console.error("Failed to parse authentication status:",te),S=!1}const E=n?e:!S&&!!((ue=window.cwcRedirect)!=null&&ue.cwcRedirectUrl),[T,A]=m.useState(E),[I,k]=m.useState(),{t:x}=Ce(),{login:_,logout:R}=Sh();m.useEffect(()=>{async function te(){const Z=await SP();i(Z),a&&(t!=null&&t.email)&&fpe()}te()},[t,a]);const z=(te,Z,Q)=>Ls(`${te}?fromCode=cmcv2&redirectId=${Z}${Q?`&login_hint=${Q}`:""}`),j=async()=>{let te=crypto.randomUUID().replace(/-/g,"").toUpperCase(),Z=gS,Q="AadUnknown";e&&r?Z=z(gS,te,r.username):window.cwcRedirect&&(Z=window.cwcRedirect.cwcRedirectUrl,te=window.cwcRedirect.redirectId,Q=window.cwcRedirect.chatEligibility),me.instance().config().entraRedirectModalBehaviour==="new-tab"?tu(Ls(Z)):Ch(Ls(Z)),H.trackEvent({name:"interaction",data:{eventName:"copilotEnterpriseRedirect",...I,eventInfo_traceId:te,eventInfo_redirectUrl:Z,eventInfo_chatEligibility:Q}})},J=async()=>{H.trackEvent({name:"interaction",data:{eventName:"copilotStudentRedirectSignOut",...I}}),await R()},D=async()=>{H.trackEvent({name:"interaction",data:{eventName:"copilotEnterpriseRedirectSwitchAccount",eventInfo_scenario:g,...I}}),A(!1),o?(await R(!1),await s({from:"/",to:"/login"})):await _({provider:"microsoft"})},F=async()=>{H.trackEvent({name:"interaction",data:{eventName:n?"copilotEnterpriseRedirectSignOut":"copilotEnterpriseRedirectContinueSignedOut",...I}}),n?await R():A(!1)};if(m.useEffect(()=>{A(E),E&&(async()=>{var Q;let Z={};if(e){const Ie=await SP();Z={userAadId:(Q=Ie==null?void 0:Ie.idTokenClaims)==null?void 0:Q.oid,userAadTenantId:Ie==null?void 0:Ie.tenantId}}else window.cwcRedirect&&(Z={userAadId:window.cwcRedirect.userId,userAadTenantId:window.cwcRedirect.tenantId});H.trackEvent({name:"system",data:{eventName:"copilotEnterpriseRedirectImpression",eventInfo_redirectReason:e?"AAD":"CWC",eventInfo_scenario:g,...Z}}),k(Z)})().catch(console.error)},[e,E,g]),!T)return null;const ie=!S&&window.cwcRedirect?new URL(window.cwcRedirect.cwcRedirectUrl).hostname:gS,U=y(t==null?void 0:t.email),W=()=>c?null:a?d.jsx("div",{className:"mt-8 sm:mt-12",children:d.jsx(Fr,{i18nKey:"entraRedirect.playAroundFirst",components:{entraContinue:d.jsx("button",{role:"link",type:"button",className:"underline",onClick:F,children:x("entraRedirect.playAroundFirst")})}})}):d.jsx("div",{className:"mt-8 sm:mt-12",children:d.jsx(Fr,{i18nKey:n?"entraRedirect.signOut":"entraRedirect.continueSignedOut",components:{[n?"entraSignOut":"entraContinue"]:d.jsx("button",{type:"button",className:"underline",onClick:F,children:x(n?"entraRedirect.signOut":"entraRedirect.continueSignedOut")})}})});return d.jsxs(On,{id:String(T),duration:0,mode:"sync",className:X("fixed inset-0",$t.modal),children:[d.jsx(eu,{forceGradient:!0}),d.jsx("main",{className:"relative m-auto flex size-full max-w-chat flex-col items-center justify-center overflow-y-auto p-4 pb-8 pt-20 sm:py-4",children:u?d.jsx(Et,{className:"size-8"}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"mb-9",children:d.jsx(kh,{className:"size-12"})}),d.jsx("h1",{className:X("mb-8 w-full whitespace-pre-wrap break-words px-4 text-center text-3xl sm:mb-14",p),children:v()}),c&&U&&d.jsx("p",{className:"mb-10 w-full whitespace-pre-wrap break-words px-4 text-center text-base sm:mb-16",children:U}),d.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 md:gap-16",children:[d.jsx(BN,{title:h,description:f,onClick:c?J:j,children:d.jsxs("div",{className:"space-y-1",children:[d.jsx("p",{children:b(ie)}),C&&d.jsxs("div",{className:"flex items-center gap-1.5",children:[d.jsx("div",{className:"relative size-5",children:d.jsx(fF,{firstName:t.firstName??t.givenName??void 0,imgSrc:t.imgSrc,nameSizeClass:"text-xs"})}),d.jsx("p",{className:"text-xs",children:t.email})]})]})}),d.jsx(BN,{title:x("entraRedirect.personalTitle"),description:x("entraRedirect.personalDescription"),onClick:D,children:d.jsx("p",{className:"text-xs",children:x("entraRedirect.switchToPersonalButton")})})]}),W()]})})]})}function BN({title:n,onClick:e,description:t,children:r}){return d.jsxs("div",{className:"flex flex-col justify-between rounded-4xl bg-white/70 p-4 dark:bg-midnight-700/70 md:p-6 md:pb-8",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"mb-2.5 text-lg",children:n}),d.jsx("p",{className:"mb-6 text-sm",children:t})]}),d.jsx(Ee,{color:"default",variant:"rect",title:n,onClick:e,children:r})]})}function gx(n,e=!0,t=!1){m.useEffect(()=>{var r;e&&((r=n.current)==null||r.focus({preventScroll:t}))},[n,e,t])}const p1e=m.lazy(()=>$(()=>import("./index-uHmhofaq.js").then(n=>n.i),__vite__mapDeps([333,2,323,1])));function m1e(n){const{onClose:e,interceptedLink:t}=n,{t:r}=Ce(),i=m.useRef(null);return gx(i),rs(a=>{(a.key==="Escape"||a.key==="Control")&&e()}),d.jsxs("div",{className:"flex w-[400px] max-w-[80vw] flex-col items-center p-4 text-center",children:[d.jsx("div",{className:"bg-white p-2",children:d.jsx(m.Suspense,{fallback:d.jsx("span",{}),children:d.jsx(p1e,{value:t,size:96,"aria-label":r("composer.interceptedLink.qrcode_alt_text")})})}),d.jsx("h1",{className:"py-3 text-lg",children:r("composer.interceptedLink.title")}),d.jsx("p",{className:"w-full pb-7",children:d.jsx(Fr,{i18nKey:"composer.interceptedLink.description",components:{span:d.jsx("span",{className:"break-words underline"})},values:{link:t}})}),d.jsx(Ee,{ref:i,onClick:e,title:"close",variant:"pill",size:"48-lg",className:"w-full",children:r("common.closeText")})]})}function UC(){return N(_r)==="US"&&me.instance().config().proSubscription.enabled}function g1e(n){const{t:e}=Ce(),{config:t,onClose:r}=n,i=N($3),a=N(En),o=UC(),s=t.source==="apple"?bte:yte,c=e("subscriptionManage.redirectMobileStoreTitle",{store:s}),u=e("subscriptionManage.redirectMobileStoreContent",{store:s});return m.useEffect(()=>{H.trackEvent({name:"interaction",data:{eventName:"payflowBlockDialogShown",eventInfo_upsellEntryStyle:t.entryStyle,eventInfo_payflowEntryPoint:t.payflowEntryPoint,eventInfo_upsellReason:t.upsellReason,eventInfo_loginProvider:(a==null?void 0:a.accountType)??"None",eventInfo_payflowType:"DIME",eventInfo_curatedSubscription:(i==null?void 0:i.tier)??"None",eventInfo_disabledReason:"3pPurchase"}})},[t,i==null?void 0:i.tier,o,a==null?void 0:a.accountType]),d.jsx("div",{className:ke("fixed inset-0 h-screen w-screen",$t.modal),"data-outside-events-ignore":!0,onClick:r,children:d.jsx(Gi,{isOpen:!0,className:"h-auto max-w-md !gap-0 rounded-[60px] !p-0",disableCloseOutside:!0,children:d.jsxs("div",{className:"flex w-full flex-col p-8",children:[d.jsx("h1",{className:"mt-4 w-full items-center text-center text-xl",children:c}),d.jsx("p",{className:"mt-6 w-full",children:u}),d.jsx(Ee,{className:"mt-6 w-full rounded-4xl",color:"strong",title:e("subscriptionManage.upgradeButton"),onClick:r,children:e("subscriptionManage.redirectMobileStoreDismiss")})]})})})}function v1e(){const{t:n}=Ce(),e=N(ai),t=N(N9),r=N(Ly),[i,a]=Je(nve),[o,s]=m.useState(!1),c=m.useCallback(()=>{a(!1)},[a]),u=m.useCallback(async()=>{!t||!e||(s(!0),jv.includes(t.status)||(await go()).stop({conversationId:e.id,taskId:t.id}))},[e,t]);m.useEffect(()=>{t!=null&&t.status&&jv.includes(t.status)&&(a(!1),s(!1))},[t==null?void 0:t.status,a]);const h=r!==null?n("research.cancel.limitAnnouncement",{limit:r+1}):"";return d.jsxs(Gi,{isOpen:i,headerText:n("research.cancel.title"),className:"max-w-96 gap-4",children:[`${n("research.cancel.description")}${` ${h}`}`,d.jsx(Ee,{title:n("research.cancel.cancelButton"),onClick:u,className:"mt-auto text-system-red-550 dark:text-system-red-350",color:"default",size:"56-xl",disabled:o,children:o?d.jsx(Et,{className:"size-8"}):n("research.cancel.cancelButton")}),d.jsx(Ee,{title:n("common.keep"),color:"strong",size:"56-xl",onClick:c,children:n("common.keep")})]})}const pF=70;function b1e(n){var e;return(e=n.contents)!=null&&e.length?n.finalResponse?"done":n.partialOutput&&n.partialOutput.length>0?"writing":"browsing":"planning"}const vx=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",...n},m.createElement("path",{d:"M4.5 10a5.5 5.5 0 1 1 11 0 5.5 5.5 0 0 1-11 0ZM10 3a7 7 0 1 0 4.391 12.452l5.329 5.328a.75.75 0 1 0 1.06-1.06l-5.328-5.329A7 7 0 0 0 10 3Z"})),T6e=Object.freeze(Object.defineProperty({__proto__:null,default:vx},Symbol.toStringTag,{value:"Module"}));function y1e(n){const{text:e,isInDrawer:t=!1,isPreview:r}=n,{t:i}=Ce(),a=r?qU(e,pF,{ellipsis:!0}):e;return t?d.jsxs("div",{children:[d.jsx("strong",{className:"me-2",children:i("research.searched")}),d.jsx("span",{className:"text-foreground-800",children:a})]}):d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-foreground-700",children:i("research.searched")}),d.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-black/[0.06] px-2 py-1 text-foreground-450",children:[d.jsx(vx,{className:"size-4"}),d.jsx("span",{className:"text-foreground-800 text-xs",children:e})]})]})}function C1e(n){let{url:e}=n;e=tl(e);const{title:t,decoration:r,source:i,iconUrl:a,mode:o,onClick:s}=n,c=m.useContext(_m),u=N(lt),h=()=>{s&&s(n),bn({source:i,conversationId:u,messageId:c,destination:e})};return d.jsxs(Ee,{onClick:h,color:"default",variant:"pill",size:"28-xxs",title:t,href:e,children:[r,a&&d.jsx("img",{src:a,alt:t,className:"size-4 rounded-md border-[0.5px] border-neutral-300 bg-white/90 dark:border-neutral-600"}),d.jsx("span",{className:"me-0.5",children:o==="research"?Pd(e):t})]})}function S1e(n){const{url:e,isInDrawer:t=!1,isPreview:r=!1}=n,{t:i}=Ce();return d.jsxs("div",{className:"flex items-center gap-2",children:[t?d.jsx("strong",{children:i("research.read")}):d.jsx("span",{className:"text-foreground-700",children:i("research.read")}),r?d.jsx("span",{className:"text-foreground-800",children:Pd(e)}):d.jsx(C1e,{title:Pd(e),url:e,source:"researchCitationLink"})]})}function HN(n){let e=0;for(const t of n)e+=t;return e}function w1e(n,e,t){let r=0,i=null,a=[],o=0;return{getValue:()=>{if(!t)return 0;if(!i){i=Math.floor(performance.now());const c=n[n.length-1];if(!c)o=0;else{const u=c+HN(a)*1e3;u>i?(o=(u-i)/1e3,a=[]):(o=0,a=[])}}const s=n[r];return s?(r+=1,a=[],Math.max((s-i)/1e3,0)):(o=Number((o+HN(a)).toFixed(3)),a=[],e(r,i,o),r+=1,o)},queueUpdate:s=>{a.push(s)}}}function mF(n){const e=m.useRef([]);return m.useCallback(()=>w1e(e.current,(t,r,i)=>{e.current[t]=r+i*1e3},n),[n])}function E1e(n){const{text:e,shouldAnimate:t,isPreview:r}=n,i=mF(!1),[a,o]=m.useState(0),s=m.useMemo(()=>{const c=i(),u=r?qU(e,pF,{ellipsis:!0}):e,h=px(u);return Hp(h,c,()=>{o(a+1)})},[i,a,r,e]);return d.jsx("div",{className:ke("flex gap-2 text-foreground-700",r?"items-center":"flex-col items-start"),children:d.jsx(Bp,{blocks:s,shouldAnimate:t})})}function T1e(n){const{item:e,shouldAnimate:t=!1,isPreview:r=!1,isInDrawer:i=!1}=n;switch(e.type){case"citation":return d.jsx(S1e,{url:e.url,isInDrawer:i,isPreview:r});case"chainOfThought":return d.jsx(E1e,{text:e.text,shouldAnimate:t,isPreview:r});case"query":return d.jsx(y1e,{text:e.text,isInDrawer:i,isPreview:r});default:return null}}function I1e(n){const{progress:e}=n,{t}=Ce(),r=(()=>{switch(e){case"planning":return t("research.steps.browse.future");case"writing":return t("research.steps.write.present");case"done":return t("research.stepsDrawer.reportReady");default:return""}})();return d.jsx("div",{children:d.jsx("strong",{children:r})})}function Rg(n){const{progress:e,contentItem:t,shouldAnimate:r,isPreview:i=!1}=n;return e!=="browsing"?d.jsx(I1e,{progress:e}):t?d.jsx(T1e,{item:t,shouldAnimate:r,isPreview:i,isInDrawer:!0}):null}const bx=n=>m.createElement("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M12.0001 1.07191C13.2068 1.7686 14.2105 2.76833 14.912 3.97215C15.6135 5.17597 15.9885 6.54213 15.9997 7.93538C16.011 9.32864 15.6582 10.7007 14.9762 11.9157C14.2942 13.1307 13.3068 14.1465 12.1115 14.8626C10.9163 15.5787 9.55481 15.9702 8.16178 15.9984C6.76875 16.0266 5.39251 15.6904 4.16929 15.0233C2.94608 14.3562 1.91832 13.3811 1.18775 12.1947C0.457175 11.0083 0.049128 9.65168 0.00400014 8.25911L0 7.99991L0.00400014 7.74071C0.0488032 6.35911 0.450844 5.01268 1.17093 3.83271C1.89101 2.65273 2.90456 1.67948 4.11276 1.00782C5.32097 0.336164 6.6826 -0.0109686 8.0649 0.000264197C9.44721 0.011497 10.803 0.380712 12.0001 1.07191ZM10.9657 5.83431C10.828 5.69657 10.6447 5.61383 10.4503 5.6016C10.2559 5.58938 10.0636 5.64851 9.90972 5.76791L9.83452 5.83431L7.20009 8.46791L6.16568 7.43431L6.09048 7.36791C5.93654 7.2486 5.74437 7.18953 5.54999 7.2018C5.35562 7.21406 5.17239 7.29681 5.03467 7.43452C4.89695 7.57224 4.81421 7.75546 4.80194 7.94984C4.78968 8.14421 4.84874 8.33638 4.96806 8.49031L5.03446 8.56551L6.63448 10.1655L6.70968 10.2319C6.84998 10.3408 7.02251 10.3998 7.20009 10.3998C7.37767 10.3998 7.55019 10.3408 7.69049 10.2319L7.7657 10.1655L10.9657 6.96551L11.0321 6.89031C11.1515 6.73639 11.2107 6.54419 11.1984 6.34977C11.1862 6.15535 11.1035 5.97207 10.9657 5.83431Z",fill:"currentColor"})),I6e=Object.freeze(Object.defineProperty({__proto__:null,default:bx},Symbol.toStringTag,{value:"Module"}));function Pg(n){const{isFinal:e=!1,isLast:t=!1,shouldAnimate:r=!1,children:i}=n;let a=null;return e?a=d.jsx(bx,{className:"relative bottom-1 size-4 text-background-900"}):t?a=d.jsx(Et,{className:"relative bottom-1 size-4"}):a=d.jsx("div",{className:"size-2 rounded-full bg-foreground-800"}),d.jsxs(_e.div,{className:"relative grid grid-cols-[auto,1fr] items-start gap-4",initial:r?"start":"end",animate:"end",variants:{start:ct,end:o=>({...Rt,transition:{delay:o,ease:"easeInOut",duration:1.2}})},children:[d.jsxs("div",{className:"relative mt-2 flex h-full w-2 flex-col items-center",children:[a,!e&&!t&&d.jsx("div",{className:"absolute bottom-0 top-4 w-0.5 bg-neutral-300"})]}),i]})}function A1e(n){var h,f;const{task:e,onGoToReport:t}=n,{t:r}=Ce(),i=m.useRef(null),[a,o]=m.useState(!1);SU({onScrollEnd:()=>{if(!i.current)return;const{scrollTop:p,scrollHeight:g,clientHeight:v}=i.current,y=p+v>=g-50;o(!y)},scrollRefs:[i]}),m.useEffect(()=>{i.current&&!a&&i.current.scrollTo({top:i.current.scrollHeight,behavior:"smooth"})},[e,a]);const c=b1e(e),u=((h=e.contents)==null?void 0:h.length)??0;return d.jsxs("div",{className:"flex h-full flex-col overflow-y-auto",children:[d.jsxs("div",{ref:i,className:"vertical-scrollbar scroll-fade relative space-y-4 overflow-y-auto scroll-smooth px-2 pb-2 [scrollbar-gutter:stable_both-edges;]",children:[d.jsx(Pg,{isLast:c==="planning",shouldAnimate:c==="planning",children:d.jsx(Rg,{progress:"planning"})}),(f=e.contents)==null?void 0:f.map((p,g)=>{const v=c==="browsing"&&g===u-1;return d.jsx(Pg,{isLast:v,shouldAnimate:c!=="done"&&v,children:d.jsx(Rg,{progress:"browsing",contentItem:p})},g)}),(c==="writing"||c==="done")&&d.jsx(Pg,{isLast:c==="writing",shouldAnimate:c==="writing",children:d.jsx(Rg,{progress:"writing"})}),c==="done"&&d.jsx(Pg,{isFinal:!0,shouldAnimate:!0,children:d.jsx(Rg,{progress:"done"})})]}),c==="done"&&d.jsx(Ee,{title:r("research.stepsDrawer.goToReport"),onClick:t,color:"strong",variant:"pill",size:"40-base",className:"mx-4 mt-8",children:r("research.stepsDrawer.goToReport")})]})}function k1e(){const{t:n}=Ce(),e=N(N9),[t,r]=Je(tve),i=()=>{r(!1)},a=()=>{i()};return rs(o=>{o.key==="Escape"&&i()}),d.jsx(Gi,{isOpen:t,onClose:i,headerText:n("research.stepsDrawer.title"),className:"max-w-full p-4 sm:w-2/3 sm:min-w-96 sm:max-w-[600px]",headerClassName:"pb-12",headerTextClassName:"relative top-12 start-4",variant:"drawer",children:e&&d.jsx(A1e,{task:e,onGoToReport:a})})}function x1e(){var n=new Map;function e(t){var r=t.root,i=t.rootMargin,a=t.threshold,o=n.get(r);o||(o=new Map,n.set(r,o));var s=JSON.stringify({rootMargin:i,threshold:a}),c=o.get(s);if(!c){var u=new Map,h=new IntersectionObserver(function(f){f.forEach(function(p){var g=u.get(p.target);g==null||g(p)})},{root:r,rootMargin:i,threshold:a});c={observer:h,entryCallbacks:u},o.set(s,c)}return{observe:function(p,g){var v,y;(v=c)==null||v.entryCallbacks.set(p,g),(y=c)==null||y.observer.observe(p)},unobserve:function(p){var g,v;(g=c)==null||g.entryCallbacks.delete(p),(v=c)==null||v.observer.unobserve(p)}}}return{getObserver:e}}var _1e="0px",M1e=[0],R1e=x1e();function P1e(n){var e,t,r=(e=n==null?void 0:n.rootMargin)!=null?e:_1e,i=(t=n==null?void 0:n.threshold)!=null?t:M1e,a=m.useRef(null),o=m.useRef(null),s=m.useRef(null),c=m.useState(),u=c[0],h=c[1],f=m.useCallback(function(){var y=a.current;if(!y){h(void 0);return}var b=R1e.getObserver({root:o.current,rootMargin:r,threshold:i});b.observe(y,function(C){h(C)}),s.current=b},[r,i]),p=m.useCallback(function(){var y=s.current,b=a.current;b&&(y==null||y.unobserve(b)),s.current=null},[]),g=m.useCallback(function(y){p(),a.current=y,f()},[f,p]),v=m.useCallback(function(y){p(),o.current=y,f()},[f,p]);return[g,{entry:u,rootRef:v}]}function oT(){return oT=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},oT.apply(this,arguments)}function N1e(n){var e,t=P1e(n),r=t[0],i=t[1],a=!!((e=i.entry)!=null&&e.isIntersecting),o=m.useState(a),s=o[0],c=o[1];return a&&!s&&c(!0),[r,oT({},i,{isVisible:a,wasEverVisible:s})]}var O1e=100;function yx(n){var e=n.loading,t=n.hasNextPage,r=n.onLoadMore,i=n.rootMargin,a=n.disabled,o=n.delayInMs,s=o===void 0?O1e:o,c=N1e({rootMargin:i}),u=c[0],h=c[1],f=h.rootRef,p=h.isVisible,g=!a&&!e&&p&&t;return m.useEffect(function(){if(g){var v=setTimeout(function(){r()},s);return function(){clearTimeout(v)}}},[r,g,s]),[u,{rootRef:f}]}const Cx="mt-1 rounded-2xl border border-black/5 bg-white/25 p-4 dark:border-white/5 dark:bg-black/25",Sx=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M10 5H14C14 3.89543 13.1046 3 12 3C10.8954 3 10 3.89543 10 5ZM8.5 5C8.5 3.067 10.067 1.5 12 1.5C13.933 1.5 15.5 3.067 15.5 5H21.25C21.6642 5 22 5.33579 22 5.75C22 6.16421 21.6642 6.5 21.25 6.5H19.9309L18.7589 18.6112C18.5729 20.5334 16.9575 22 15.0263 22H8.97369C7.04254 22 5.42715 20.5334 5.24113 18.6112L4.06908 6.5H2.75C2.33579 6.5 2 6.16421 2 5.75C2 5.33579 2.33579 5 2.75 5H8.5ZM10.5 9.75C10.5 9.33579 10.1642 9 9.75 9C9.33579 9 9 9.33579 9 9.75V17.25C9 17.6642 9.33579 18 9.75 18C10.1642 18 10.5 17.6642 10.5 17.25V9.75ZM14.25 9C14.6642 9 15 9.33579 15 9.75V17.25C15 17.6642 14.6642 18 14.25 18C13.8358 18 13.5 17.6642 13.5 17.25V9.75C13.5 9.33579 13.8358 9 14.25 9ZM6.73416 18.4667C6.84577 19.62 7.815 20.5 8.97369 20.5H15.0263C16.185 20.5 17.1542 19.62 17.2658 18.4667L18.4239 6.5H5.57608L6.73416 18.4667Z"})),A6e=Object.freeze(Object.defineProperty({__proto__:null,default:Sx},Symbol.toStringTag,{value:"Module"}));function FC(n){const{source:e,pageName:t,customData:r}=n;H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:e,eventInfo_pageName:t,eventInfo_customData:r?JSON.stringify(r):void 0}})}function L1e(n){const{impressionElement:e,entryPoint:t,customData:r}=n;H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionElement:e,eventInfo_entryPoint:t,eventInfo_customData:r?JSON.stringify(r):void 0}})}function $N(n){const{scenario:e,source:t,pageName:r,customData:i}=n;H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickScenario:e,eventInfo_clickSource:t,eventInfo_pageName:r,eventInfo_customData:i?JSON.stringify(i):void 0}})}function zN(n){const{scenario:e,errorType:t,errorMessage:r,customData:i}=n;Zn({feature:"memory-management",errorType:t,scenario:e,errorMessage:r,customData:i?JSON.stringify(i):void 0})}function D1e(n){const{onDelete:e,isDeleting:t}=n,{t:r}=Ce(),[i,a]=m.useState(!1),o=m.useRef(null);fo({onOutsideEvent:()=>{a(!1),$N({scenario:"deleteSingleMemory",source:"cancel",pageName:"singleDurableFact"})},elements:[o],shouldAttachListeners:i});const s=()=>{i?(e(),a(!1),$N({scenario:"deleteSingleMemory",source:"deleteSingleDurableFact",pageName:"singleDurableFact"})):(a(!0),FC({source:"durableFactDeleteButton",pageName:"memoryManagementPage"}))};return t?d.jsx("div",{className:"flex size-9 items-center justify-center",children:d.jsx(Et,{className:"size-5"})}):d.jsx(_e.div,{layout:!0,children:d.jsxs(Ee,{ref:o,variant:i?"rect":"square",size:"36-sm",color:i?"default":"subtle-dimmed-inverted",title:r("settings.memory.delete"),"aria-label":r("settings.memory.delete"),onClick:s,children:[d.jsx(_e.div,{layout:"preserve-aspect",children:d.jsx(Sx,{className:ke("size-4 fill-foreground-800",i&&"fill-system-red-550 dark:fill-system-red-350"),"aria-hidden":!0})}),i&&d.jsx(_e.span,{className:"text-system-red-550 dark:text-system-red-350","aria-hidden":!0,initial:ct,animate:Rt,children:r("common.delete")})]})})}function j1e(n){const{fact:e,isLast:t,onDelete:r,isDeleting:i}=n;return d.jsxs(_e.li,{className:"list-none",layout:!0,initial:Rt,animate:Rt,exit:ct,transition:{duration:Ei.default},children:[d.jsxs("div",{className:ke("flex items-center gap-1.5 p-2 sm:gap-6",t&&"mb-2"),children:[d.jsx("p",{className:"flex-1 text-foreground-800 text-sm",children:e.text}),d.jsx(D1e,{onDelete:r,isDeleting:i})]}),!t&&d.jsx(eh,{})]})}function U1e(n){const{durableFacts:e,hasNextPage:t,showInitialLoadingState:r,infiniteRef:i,onDeleteFact:a,isDeletingFact:o,hasError:s}=n;return d.jsxs("div",{className:ke(Cx,"t-custom-scrollbar flex size-full min-h-0 flex-col gap-0 overflow-y-auto",r&&"justify-center"),children:[r&&d.jsx("div",{className:"flex justify-center py-8",children:d.jsx(Et,{className:"size-12"})}),d.jsx("ul",{className:"m-0 flex w-full flex-col gap-0",role:"list",children:d.jsx(Mn,{children:e.map((c,u)=>d.jsx(j1e,{fact:c,isLast:u===e.length-1,onDelete:()=>{a(c.id)},isDeleting:o(c.id)},c.id))})}),t&&!r&&!s&&d.jsx("div",{className:"flex justify-center py-8",ref:i,children:d.jsx(Et,{className:"size-12"})})]})}const F1e="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/durable-facts-empty-dark-DDJyBbNr.png",B1e="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/durable-facts-empty-light-XQy6HH2o.png";function gF(n){const{closeModal:e=!0}={},{t}=Ce(),r=pe(w3),i=iu();return async()=>{e&&r(!1),await i({prefillComposerData:{prompt:t("settings.memory.management.rememberPrompt")},composerPosition:"bottom",shouldHideLaunchGreeting:!0})}}function H1e(){const{t:n}=Ce(),e=N(qi)==="dark",t=gF(),r=()=>{t(),FC({source:"memoryManagementZeroStateButton",pageName:"memoryManagementPage"})};return d.jsx("div",{className:ke(Cx,"t-custom-scrollbar flex size-full flex-col items-center justify-around overflow-y-auto"),children:d.jsxs("div",{className:"flex max-w-96 flex-col items-center gap-8",children:[d.jsx("img",{src:e?F1e:B1e,alt:"","aria-hidden":"true",loading:"lazy",className:"w-full select-none"}),d.jsxs("div",{className:"flex w-full flex-col items-center gap-3",children:[d.jsx("h3",{className:"text-center text-foreground-800 text-md",children:n("settings.memory.management.emptyMemoryStateTitle")}),d.jsx("p",{className:"text-center text-foreground-550 text-sm",children:n("settings.memory.management.emptyMemoryStateSubtitle")})]}),d.jsx(Ee,{color:"strong",variant:"rect",size:"36-sm",title:n("settings.memory.createAction"),className:"w-fit",onClick:r,children:n("settings.memory.createAction")})]})})}function $1e(){const{t:n}=Ce();return d.jsxs("div",{className:ke(Cx,"flex size-full min-h-fit flex-col items-center justify-center gap-8 text-center text-foreground-800"),children:[d.jsx("h3",{className:"max-w-96 text-md",children:n("common.somethingWrong")}),d.jsx("p",{className:"max-w-96 text-sm",children:n("common.somethingWrongDescription")})]})}function vF(n){const{data:e,error:t,isPending:r,isFetchingNextPage:i,hasNextPage:a,fetchNextPage:o}=Fz(n),s=m.useCallback(async()=>{a&&await o()},[o,a]),c=e==null?void 0:e.pages;return{loader:{loading:r||i,hasNextPage:a,error:t??void 0,onLoadMore:s,data:c}}}const Ew="/memory/durable-facts",VN=["memory","durable-facts"];function z1e(n){const{onDeleteSuccess:e,onDeleteError:t}=n??{},r=N5(),[i,a]=m.useState(new Set),o=m.useCallback(async f=>{const{pageParam:p}=f,{url:g,args:v}=p;return await Tn(g,aX,{query:v}).then(b=>b.data)},[]),s=m.useCallback(f=>f.next?{url:Ew,args:{cursor:f.next}}:null,[]),{mutate:c}=O5({mutationFn:async f=>{if(!(await wa(`${Ew}/${f}`,{options:{method:"DELETE"}})).ok)throw new Error(`Failed to delete durable fact: ${f}`)},onMutate:f=>{a(p=>new Set([...p,f]))},onSuccess:(f,p)=>{r.setQueryData(VN,g=>g&&{...g,pages:g.pages.map(v=>({...v,results:v.results.filter(y=>y.id!==p)}))}),e==null||e()},onError:(f,p)=>{t==null||t(f,p)},onSettled:(f,p,g)=>{a(v=>{const y=new Set(v);return y.delete(g),y})}}),u=m.useCallback(f=>i.has(f),[i]),{loader:h}=vF({queryKey:VN,queryFn:o,initialPageParam:{url:Ew},getNextPageParam:s});return{loader:h,deletion:{deleteDurableFact:c,isDeletingFact:u}}}function V1e(){var v;const{t:n}=Ce(),e=pe(Ia),t=m.useRef(!1),{loader:r,deletion:i}=z1e({onDeleteSuccess:()=>{e({title:n("settings.memory.management.deleted"),dismissable:!1,dismissAfter:3e3})},onDeleteError:y=>{e({title:n("common.somethingWrong"),subtitle:n("common.somethingWrongDescription"),dismissable:!1,dismissAfter:3e3}),zN({scenario:"deleteDurableFact",errorType:"requestFailure",errorMessage:y.message})}}),{deleteDurableFact:a,isDeletingFact:o}=i,[s]=yx({...r,disabled:!!r.error}),c=gF(),u=m.useRef(!1),h=()=>{c(),FC({source:"memoryManagementAddButton",pageName:"memoryManagementPage"})},f=((v=r.data)==null?void 0:v.flatMap(y=>y.results))??[],p=f.length===0&&!r.loading&&!r.error,g=r.loading&&f.length===0;return m.useEffect(()=>{!g&&!u.current&&(L1e({impressionElement:"memoryManagementPage",customData:{state:p?"zeroState":"available"}}),u.current=!0)},[g,p]),m.useEffect(()=>{r.error&&!t.current&&(t.current=!0,e({title:n("common.somethingWrong"),subtitle:n("common.somethingWrongDescription"),dismissable:!1,dismissAfter:3e3}),zN({scenario:`loadDurableFacts${r.hasNextPage?"NextPage":""}`,errorType:"requestFailure",errorMessage:r.error.message}))},[r.hasNextPage,r.error,e,n]),r.error&&!r.loading&&f.length===0?d.jsx($1e,{}):p?d.jsx(H1e,{}):d.jsxs(d.Fragment,{children:[d.jsx(U1e,{durableFacts:f,showInitialLoadingState:g,hasNextPage:r.hasNextPage,infiniteRef:s,onDeleteFact:a,isDeletingFact:o,hasError:!!r.error}),d.jsx(Ee,{variant:"rect",size:"36-sm",title:n("settings.memory.management.add"),className:"mt-3 w-fit shrink-0",onClick:h,children:n("settings.memory.management.add")})]})}function G1e(){const[n,e]=Je(w3),{t}=Ce(),r=()=>{e(!1),FC({source:"memoryManagementDismissButton",pageName:"memoryManagementPage"})};return d.jsx(bo,{isOpen:n,onClose:r,headerText:t("settings.memory.management.title"),className:"h-[70vh] max-h-[780px] w-[88vw] max-w-[760px] bg-background-200",children:d.jsx(V1e,{})})}const bF=n=>m.createElement("svg",{viewBox:"0 0 21 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("g",{id:"Copy"},m.createElement("path",{id:"Shape",d:"M6.5 4C6.5 2.89543 7.39543 2 8.5 2H14.5C15.6046 2 16.5 2.89543 16.5 4V14C16.5 15.1046 15.6046 16 14.5 16H8.5C7.39543 16 6.5 15.1046 6.5 14V4ZM4.5 6.00001C4.5 5.25973 4.9022 4.61339 5.5 4.26758V14.5C5.5 15.8807 6.61929 17 8 17H14.2324C13.8866 17.5978 13.2403 18 12.5 18H8C6.067 18 4.5 16.433 4.5 14.5V6.00001Z",fill:"currentColor"}))),k6e=Object.freeze(Object.defineProperty({__proto__:null,default:bF},Symbol.toStringTag,{value:"Module"})),yF=n=>m.createElement("svg",{viewBox:"0 0 21 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("mask",{id:"mask0_25413_62234",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:0,y:0,width:21,height:20},m.createElement("path",{d:"M8.5 2C7.39543 2 6.5 2.89543 6.5 4V14C6.5 15.1046 7.39543 16 8.5 16H14.5C15.6046 16 16.5 15.1046 16.5 14V4C16.5 2.89543 15.6046 2 14.5 2H8.5ZM7.5 4C7.5 3.44772 7.94772 3 8.5 3H14.5C15.0523 3 15.5 3.44772 15.5 4V14C15.5 14.5523 15.0523 15 14.5 15H8.5C7.94772 15 7.5 14.5523 7.5 14V4ZM4.5 6.00001C4.5 5.25973 4.9022 4.61339 5.5 4.26758V14.5C5.5 15.8807 6.61929 17 8 17H14.2324C13.8866 17.5978 13.2403 18 12.5 18H8C6.067 18 4.5 16.433 4.5 14.5V6.00001Z",fill:"currentColor"})),m.createElement("g",{mask:"url(#mask0_25413_62234)"},m.createElement("rect",{width:24,height:24,transform:"translate(-1.5 -2)",fill:"currentColor"}))),x6e=Object.freeze(Object.defineProperty({__proto__:null,default:yF},Symbol.toStringTag,{value:"Module"})),CF=n=>m.createElement("svg",{viewBox:"0 0 28 28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M27.9994 14.0514C27.9994 6.29111 21.7315 0 13.9997 0C6.26795 0 0 6.29111 0 14.0514C0 20.641 4.52023 26.1705 10.6179 27.6892V18.3455H7.73121V14.0514H10.6179V12.2011C10.6179 7.41859 12.7745 5.20184 17.4526 5.20184C18.3396 5.20184 19.8701 5.37664 20.4962 5.55088V9.44312C20.1658 9.40828 19.5918 9.39085 18.8789 9.39085C16.5835 9.39085 15.6965 10.2637 15.6965 12.5328V14.0514H20.2694L19.4837 18.3455H15.6965V28C22.6286 27.1597 28 21.2356 28 14.0514H27.9994Z"})),_6e=Object.freeze(Object.defineProperty({__proto__:null,default:CF},Symbol.toStringTag,{value:"Module"})),SF=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("g",{id:"Linkedin"},m.createElement("path",{id:"Shape",d:"M23.6999 2.75909C23.6999 1.39872 22.5971 0.295929 21.2368 0.295929H2.76308C1.40272 0.295929 0.299927 1.39872 0.299927 2.75909V21.2328C0.299927 22.5931 1.40272 23.6959 2.76308 23.6959H21.2368C22.5971 23.6959 23.6999 22.5931 23.6999 21.2328V2.75909ZM3.63848 9.12156H7.24935V20.6943H3.63848V9.12156ZM16.4313 8.83425C19.8921 8.83425 20.6797 10.9844 20.753 13.861L20.7589 14.3469V20.6942H17.1519L17.1517 14.9161C17.1477 13.5985 17.0603 11.9984 15.278 11.9984C13.4002 11.9984 13.1135 13.4611 13.1135 14.971V20.6942H9.51161V9.12143H12.9689V10.7028H13.0188L13.1052 10.5509C13.6314 9.68925 14.7739 8.83425 16.4313 8.83425ZM3.35125 5.45367C3.35125 4.30239 4.28565 3.36809 5.44404 3.36809C6.59732 3.36809 7.53556 4.30239 7.53556 5.45367C7.53556 6.60623 6.59732 7.54053 5.44404 7.54053C4.28565 7.54053 3.35125 6.60623 3.35125 5.45367Z",fill:"currentColor"}))),M6e=Object.freeze(Object.defineProperty({__proto__:null,default:SF},Symbol.toStringTag,{value:"Module"})),wF=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28",...n},m.createElement("g",{clipPath:"url(#clip0_9013_4638)"},m.createElement("path",{d:"M14 0C6.26828 0 0 6.26828 0 14C0 17.8664 1.56734 21.3664 4.10047 23.8995L1.43391 26.5661C0.904531 27.0955 1.27969 28 2.02781 28H14C21.7317 28 28 21.7317 28 14C28 6.26828 21.7317 0 14 0Z",className:"fill-foreground-650"}),m.createElement("path",{d:"M16.8481 6.60187C17.091 7.63109 18.0152 8.39781 19.1188 8.39781C20.4072 8.39781 21.4517 7.35328 21.4517 6.06484C21.4517 4.7764 20.4072 3.73187 19.1188 3.73187C17.9922 3.73187 17.0527 4.53031 16.8339 5.59234C14.9472 5.79469 13.4739 7.39484 13.4739 9.33406C13.4739 9.33843 13.4739 9.34172 13.4739 9.34609C11.4221 9.4325 9.54846 10.0166 8.06096 10.9386C7.50861 10.5109 6.81518 10.2561 6.06268 10.2561C4.25689 10.2561 2.79346 11.7195 2.79346 13.5253C2.79346 14.8356 3.56346 15.9644 4.6758 16.4861C4.78408 20.2814 8.91955 23.3341 14.0066 23.3341C19.0936 23.3341 23.2346 20.2781 23.3374 16.4795C24.441 15.9545 25.2044 14.8291 25.2044 13.5264C25.2044 11.7206 23.741 10.2572 21.9352 10.2572C21.186 10.2572 20.4958 10.5098 19.9446 10.9342C18.4439 10.0056 16.5496 9.42156 14.4769 9.3439C14.4769 9.34062 14.4769 9.33844 14.4769 9.33515C14.4769 7.94609 15.5094 6.79328 16.8481 6.60406V6.60187ZM7.92971 15.6002C7.98439 14.4145 8.77189 13.5045 9.68736 13.5045C10.6028 13.5045 11.3028 14.4659 11.2481 15.6516C11.1935 16.8372 10.5099 17.2681 9.5933 17.2681C8.67674 17.2681 7.87502 16.7858 7.92971 15.6002ZM18.3269 13.5045C19.2435 13.5045 20.031 14.4145 20.0846 15.6002C20.1392 16.7858 19.3364 17.2681 18.421 17.2681C17.5055 17.2681 16.8208 16.8383 16.7661 15.6516C16.7114 14.4659 17.4103 13.5045 18.3269 13.5045ZM17.2375 18.3433C17.4092 18.3608 17.5186 18.5391 17.4519 18.6987C16.8886 20.0452 15.5586 20.9912 14.0066 20.9912C12.4546 20.9912 11.1256 20.0452 10.5613 18.6987C10.4946 18.5391 10.6039 18.3608 10.7756 18.3433C11.7819 18.2416 12.8702 18.1858 14.0066 18.1858C15.143 18.1858 16.2302 18.2416 17.2375 18.3433Z",style:{fill:"rgb(var(--color-foreground-100))"}})),m.createElement("defs",null,m.createElement("clipPath",{id:"clip0_9013_4638"},m.createElement("rect",{width:28,height:28,fill:"white"})))),R6e=Object.freeze(Object.defineProperty({__proto__:null,default:wF},Symbol.toStringTag,{value:"Module"})),EF=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28",fill:"currentColor",...n},m.createElement("g",null,m.createElement("path",{d:"M16.6638 11.85L27.0874 0H24.6174L15.5665 10.2892L8.33765 0H0L10.9315 15.5591L0 27.9856H2.47021L12.0281 17.1199L19.6623 27.9856H28L16.6632 11.85H16.6638ZM13.2805 15.6962L12.1729 14.1468L3.36026 1.81862H7.15435L14.2663 11.7679L15.3739 13.3172L24.6185 26.2497H20.8244L13.2805 15.6967V15.6962Z",fill:"currentColor"}))),P6e=Object.freeze(Object.defineProperty({__proto__:null,default:EF},Symbol.toStringTag,{value:"Module"})),TF=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28",fill:"currentColor",...n},m.createElement("path",{d:"M23.9202 4.06584C21.2885 1.44525 17.7882 0.00132957 14.0588 0C6.37397 0 0.119658 6.21909 0.116984 13.8635C0.115647 16.3072 0.758058 18.6925 1.97804 20.7946L0 27.9796L7.39072 26.0517C9.4269 27.1566 11.7198 27.7383 14.0528 27.739H14.0588C21.7423 27.739 27.9974 21.5192 28 13.8748C28.0013 10.17 26.5527 6.6871 23.9202 4.0665V4.06584ZM14.0588 25.3975H14.0541C11.9751 25.3969 9.93564 24.8411 8.15617 23.7914L7.73299 23.5415L3.34709 24.6856L4.5176 20.4329L4.24218 19.9968C3.08236 18.162 2.46937 16.0413 2.4707 13.8642C2.47338 7.51078 7.67149 2.34138 14.0635 2.34138C17.1586 2.34271 20.0678 3.54266 22.2557 5.72117C24.4437 7.89902 25.6476 10.7949 25.6463 13.8735C25.6436 20.2275 20.4455 25.3969 14.0588 25.3969V25.3975ZM20.4147 16.7673C20.0664 16.5938 18.3538 15.7561 18.0343 15.6405C17.7147 15.5248 17.4828 15.467 17.2508 15.814C17.0189 16.161 16.3511 16.9415 16.1478 17.1721C15.9446 17.4035 15.7414 17.4321 15.3931 17.2585C15.0449 17.085 13.9225 16.7194 12.5915 15.5394C11.5561 14.6206 10.8568 13.4866 10.6536 13.1395C10.4504 12.7925 10.6322 12.605 10.806 12.4329C10.9624 12.2773 11.1543 12.028 11.3287 11.8259C11.5033 11.6238 11.5607 11.4789 11.677 11.2482C11.7934 11.0168 11.7352 10.8148 11.6483 10.6412C11.5614 10.4677 10.8649 8.76253 10.574 8.06918C10.2912 7.39377 10.0039 7.48551 9.79059 7.47421C9.58736 7.46424 9.35542 7.46225 9.12279 7.46225C8.89016 7.46225 8.51309 7.54867 8.19358 7.89569C7.87407 8.24267 6.97426 9.08097 6.97426 10.7855C6.97426 12.49 8.22236 14.1381 8.39681 14.3694C8.57127 14.6008 10.8534 18.0995 14.3476 19.6006C15.1786 19.9576 15.8276 20.171 16.3336 20.3306C17.168 20.5945 17.9273 20.5573 18.5276 20.4682C19.1968 20.3685 20.5886 19.6299 20.8787 18.8208C21.1688 18.0117 21.1688 17.3177 21.0819 17.1734C20.995 17.0292 20.7624 16.9421 20.4141 16.7686L20.4147 16.7673Z"})),N6e=Object.freeze(Object.defineProperty({__proto__:null,default:TF},Symbol.toStringTag,{value:"Module"})),O6e=["facebook","twitter","whatsapp","linkedin","reddit"],K1e={facebook:"senderToFacebook",twitter:"senderToX",linkedin:"senderToLinkedIn",whatsapp:"senderToWhatsApp",reddit:"senderToReddit"},fv={facebook:{displayName:"Facebook",linkGenerator:n=>`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(n)}`,icon:d.jsx(CF,{})},twitter:{displayName:"X",linkGenerator:(n,e)=>`https://twitter.com/intent/tweet?url=${encodeURIComponent(n)}&text=${encodeURIComponent(e)}`,icon:d.jsx(EF,{})},whatsapp:{displayName:"WhatsApp",linkGenerator:(n,e)=>`https://api.whatsapp.com/send?text=${encodeURIComponent(`${e} ${n}`)}`,icon:d.jsx(TF,{})},linkedin:{displayName:"LinkedIn",linkGenerator:(n,e)=>`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(n)}&text=${encodeURIComponent(e)}`,icon:d.jsx(SF,{})},reddit:{displayName:"Reddit",linkGenerator:(n,e)=>`https://www.reddit.com/submit?url=${encodeURIComponent(n)}&title=${encodeURIComponent(e)}`,icon:d.jsx(wF,{})}};function L6e(n){const{socialMedia:e,className:t,loading:r,disabled:i,onClickSocialMedia:a,includeTitle:o,iconClassName:s="size-6"}=n,c=d.jsx("div",{className:s,children:fv[e].icon}),u="56-xl",h="subtle-dimmed-inverted",f=fv[e].displayName,p=ke("flex-1 py-2",t);return d.jsxs(Ee,{size:u,color:h,title:f,className:p,onClick:g=>a(e,g),disabled:i,children:[r?d.jsx(Et,{className:"size-8"}):c,o&&d.jsx("span",{className:"font-medium text-foreground-550 text-3xs",children:fv[e].displayName})]})}function D6e(n,e,t){if(!e)return;const r=fv[n].linkGenerator(e,t??"");tu(r)}function q1e(n={}){const{scenario:e,pageName:t,sectionName:r}=n;nt({source:"shareMenu",scenario:e,pageName:t,sectionName:r})}function j6e(n){const{conversationId:e,messageId:t}=n;H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionPage:"sharePreview",eventInfo_impressionElement:"shareBlockedBanner",eventInfo_conversationId:e,eventInfo_messageId:t}})}function U6e(n){const{conversationId:e,messageId:t,uploadedFileType:r}=n;H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionPage:"sharePreview",eventInfo_conversationId:e,eventInfo_messageId:t,eventInfo_uploadFileType:r}})}function F6e(n){const{scenario:e,uploadedFileType:t,shareId:r,conversationId:i,messageIds:a}=n;H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:"shareButton",eventInfo_clickScenario:e,eventInfo_uploadFileType:t,eventInfo_customData:JSON.stringify({eventInfo_shareId:r,eventInfo_oneTurn_messageId:a?a.join(","):""}),eventInfo_conversationId:i}})}function B6e(n){const{conversationId:e,shareId:t,socialMedia:r,scenario:i,sharedLevel:a}=n;H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:K1e[r],eventInfo_clickScenario:i,eventInfo_customData:JSON.stringify({eventInfo_shareId:t,SharedLevel:a}),eventInfo_conversationId:e}})}function H6e(n){H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionPage:"receivePreview",eventInfo_impressionScenario:"shareAsLink",eventInfo_customData:JSON.stringify({eventInfo_shareId:n})}})}function $6e(){H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:"talkToCopilot"}})}function z6e(n){const{cardType:e,messageId:t,conversationId:r,scenario:i}=n;bn({source:"shareMenu",scenario:i,messageId:t,conversationId:r,cardType:e})}function W1e(n){const{conversationId:e,messageId:t,errorName:r,errorMessage:i,errorStack:a}=n;H.trackEvent({name:"system",data:{eventName:"shareMessagesFailed",eventInfo_conversationId:e,eventInfo_messageId:t??"",eventInfo_error:r,eventInfo_errorMessage:i,eventInfo_errorStack:a}})}function Y1e(){nt({source:"continueClicked"})}function Q1e(n){const{shareId:e,error:t,conversationId:r}=n;Zn({feature:"share",scenario:"continueClickFailed",errorType:t==null?void 0:t.name,errorMessage:t==null?void 0:t.message,customData:JSON.stringify({eventInfo_shareId:e,eventInfo_conversationId:r})})}function V6e(){nt({source:"sharedLinkManagement"})}function J1e(n){nt({source:"delete",scenario:"deleteSingleSharedLink",customData:JSON.stringify({eventInfo_shareId:n})})}function Z1e(n){const{details:e,errorMessage:t}=n;H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"CopyError",eventInfo_details:e,eventInfo_errorMessage:t}})}const X1e={year:"numeric",month:"long",day:"numeric"};function eEe(n){const{item:e,isSmallScreen:t,onDeleteItem:r}=n,{url:i,title:a,sharedAt:o}=e,{t:s}=Ce(),[c,u]=m.useState(!1),h=m.useRef(null),[f,p]=m.useState(!1),g=Age(),v=a===""?i:a,y=async()=>{try{await navigator.clipboard.writeText(i),p(!0),setTimeout(()=>p(!1),Z5)}catch(C){Z1e({details:"Error copying shared conversation url.",errorMessage:C instanceof Error?C.message:""})}};fo({onOutsideEvent:()=>u(!1),elements:[h],includeScroll:!0,invokeOnce:!0});const b=async()=>{c?(J1e(e.shareId),await r(e),u(!1)):u(!0)};return d.jsxs("div",{className:"flex h-10 w-full flex-row items-center gap-6",children:[d.jsx("div",{className:"w-full truncate",children:d.jsx(to,{href:i,title:v,className:"text-foreground-800 underline sm:text-foreground-900 sm:text-sm",children:v})}),!t&&d.jsx("div",{className:"shrink-0 whitespace-nowrap text-foreground-550 text-2xs",children:new Date(o).toLocaleDateString(g,X1e)}),d.jsxs("div",{className:"flex flex-row",children:[!c&&d.jsx(Ee,{size:"32-xs",color:"subtle-dimmed-inverted",onClick:y,title:s("share.copy"),children:f?d.jsx(bF,{className:"size-6 sm:size-5"}):d.jsx(yF,{className:"size-6 sm:size-5"})}),d.jsxs(Ee,{size:"32-xs",color:c?"default":"subtle-dimmed-inverted",onClick:b,className:ke(c&&"flex-row pe-1.5 ps-1.5"),title:s(c?"share.shareManagement.confirmDelete":"share.shareManagement.delete"),ref:h,children:[d.jsx(Sx,{className:ke("size-6 sm:size-5",c&&"text-system-red-450")}),c&&d.jsx("div",{className:"text-system-red-450 sm:text-xs",children:s("common.delete")})]})]})]})}function tEe(n){const{items:e,onDeleteItem:t,loading:r}=n,{t:i}=Ce(),a=Nn({breakpoint:"sm"}),o=e.length>0;return r?d.jsx("div",{className:"flex size-full items-center justify-center",children:d.jsx(Et,{className:"size-10"})}):o?d.jsx(Mn,{initial:!1,children:e.map(s=>d.jsx(_e.div,{animate:Rt,exit:ct,children:d.jsx(eEe,{item:s,isSmallScreen:a,onDeleteItem:t},s.shareId)},s.shareId))}):d.jsx("p",{className:"flex size-full items-center justify-center px-2 pb-6 pt-0.5 text-center text-foreground-700 text-sm sm:p-0",children:i("share.shareManagement.emptySharedConversations")})}const wx=l.enum(["3dGeneration","podcast","pages"]),G6e=l.object({id:l.string(),url:l.string()});l.object({type:wx,id:l.string().min(1)});const IF=l.object({shareId:l.string(),url:l.string().url(),title:l.string(),sharedAt:l.string()}),nEe=l.object({cursor:l.string().optional()}),rEe=l.object({results:l.array(IF),next:l.string().nullable()}),iEe=IF.extend({type:wx});nEe.extend({types:l.array(wx)});l.object({results:l.array(iEe),next:l.string().nullable()});const np="/conversations/shares",sT=["sharedConversations"];function aEe(){const n=m.useCallback(async i=>{const{pageParam:a}=i,{url:o,args:s}=a;return await Tn(o,rEe,{query:s,analytics:{anonymousPath:np},parseOptions:{safe:!0}}).then(u=>u.data)},[]),e=m.useCallback(i=>i.next?{url:np,args:{cursor:i.next}}:null,[]),{loader:t}=vF({queryKey:sT,queryFn:n,initialPageParam:{url:np},getNextPageParam:e}),r=oEe();return{loader:t,deleteSharedConversation:r}}function oEe(){const n=N5();return O5({mutationFn:async t=>{await wa(`${np}/${t}`,{options:{method:"DELETE"},analytics:{anonymousPath:`${np}/*`}})},onMutate:async t=>{await n.cancelQueries({queryKey:sT}),n.setQueryData(sT,r=>r&&{...r,pages:r.pages.map(i=>({...i,results:i.results.filter(a=>a.shareId!==t)}))})}}).mutateAsync}function sEe(){var a;const{loader:n,deleteSharedConversation:e}=aEe(),[t]=yx({...n,disabled:!!n.error}),r=((a=n.data)==null?void 0:a.flatMap(o=>o.results))??[],i=async o=>{await e(o.shareId)};return d.jsxs("div",{className:"t-custom-scrollbar flex size-full flex-col overflow-y-auto sm:px-3",children:[d.jsx(tEe,{items:r,onDeleteItem:i,loading:n.loading&&r.length===0}),n.hasNextPage&&d.jsx("div",{ref:t})]})}const cEe=O(!1);function lEe(){const{t:n}=Ce(),[e,t]=Je(cEe),r=Nn({breakpoint:"sm"}),i=()=>{t(!1)};return d.jsxs(bo,{isOpen:e,headerText:n("share.shareManagement.title"),className:"h-[512px] w-[640px]",bottomSheetOnSmall:!0,bottomSheetClassName:"w-full rounded-t-4xl rounded-b-6xl",onClose:i,children:[d.jsx(sEe,{}),!r&&d.jsx("div",{className:"mt-2 flex h-14 flex-col items-center pe-3.5 ps-3.5",children:d.jsx(Ee,{color:"subtle-dimmed-inverted",title:n("common.cancel"),onClick:i,className:"size-full text-base",children:n("common.cancel")})})]})}function uEe(){return ee("share-to-social-media")}const GN={translateY:"100%"},dEe={translateY:0};function hEe(n){const{children:e,id:t,onClose:r,className:i}=n,a=m.useRef(null);rs(s=>{const{current:c}=a;!c||!c.contains(document.activeElement)||s.key==="Escape"&&r()});const{modalAttributes:o}=EC({trapFocus:!0,legacyTrapFocus:!0,alwaysFocusable:!0});return d.jsxs(d.Fragment,{children:[d.jsx(_e.div,{initial:ct,animate:Rt,exit:ct,transition:VE,className:"fixed inset-0 bg-black/50",...o}),d.jsx(_e.div,{id:t,initial:GN,animate:dEe,exit:GN,transition:VE,className:X("absolute bottom-0 max-h-expanded-section w-full overflow-y-hidden rounded-4xl",$t.modal,i),ref:a,children:d.jsx("div",{className:"flex h-full flex-col items-start gap-4 overflow-y-auto bg-background-100 p-6",children:e})})]})}function fEe(n){var c;const{children:e,id:t,onClose:r,className:i}=n,a=Aa(),o=(c=me.instance().config().uiOverrides)==null?void 0:c.disableConversationsModalWrapper,{modalAttributes:s}=EC({trapFocus:!0,legacyTrapFocus:!0,alwaysFocusable:!0});return a||o?d.jsx("div",{className:"flex max-w-96 flex-col items-start gap-4 p-2",...s,children:e}):d.jsx(hEe,{id:t,onClose:r,className:i,children:e})}function pEe(){const[n,e]=m.useState(!1),t=Zp(Sn),r=iu(),i=m.useCallback(async a=>{if(!a)return;const o=L9(a);bn({source:"deleteConversation",conversationId:a,scenario:o?"actions":void 0}),e(!0),o?await wa(`/tasks/${o}`,{options:{method:"DELETE"},analytics:{anonymousPath:"/tasks/*"}}):await wa(`/conversations/${a}`,{options:{method:"DELETE"},analytics:{anonymousPath:"/conversations/*"}}),Fe(lt)===a&&await r({createConversationParams:{shouldNavigateToChat:!1}}),e(!1),t(s=>{s.delete(a)})},[t,r]);return{loading:n,deleteConversation:i}}const Ex=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...n},m.createElement("path",{fill:"currentColor",d:"M 20.292969 5.2929688 L 9 16.585938 L 4.7070312 12.292969 L 3.2929688 13.707031 L 9 19.414062 L 21.707031 6.7070312 L 20.292969 5.2929688 z"})),K6e=Object.freeze(Object.defineProperty({__proto__:null,default:Ex},Symbol.toStringTag,{value:"Module"}));function AF(n){const{disabled:e,checked:t,label:r,className:i,labelClassName:a,setChecked:o,"aria-label":s}=n,c=m.useId();return d.jsxs("label",{"aria-label":s,className:X("relative flex cursor-pointer items-center",i),htmlFor:c,children:[d.jsx("input",{checked:t,type:"checkbox",id:c,className:"peer sr-only",onChange:u=>o(u.target.checked),disabled:e}),d.jsx("span",{className:X("flex aspect-square size-5 items-center justify-center rounded-full border transition-colors duration-200 peer-focus:ring-1 peer-focus:ring-black peer-focus:ring-offset-2 peer-disabled:pointer-events-none peer-disabled:opacity-40 dark:peer-focus:ring-white","contrast-more:peer-focus:outline contrast-more:peer-focus:outline-2 contrast-more:peer-focus:outline-offset-2",t&&"bg-black contrast-more:bg-white dark:bg-white"),children:d.jsx(Ex,{className:X("size-3 text-white transition-opacity duration-200 contrast-more:text-current dark:text-black contrast-more:dark:text-current",t?"opacity-100":"opacity-0")})}),d.jsx("span",{className:X("mt-px ps-4 peer-disabled:pointer-events-none peer-disabled:opacity-40",a),children:r})]})}function mEe(n){var y;const{conversationId:e,onClose:t}=n,r=m.useId(),{t:i}=Ce(),[a,o]=m.useState(!1),s=m.useRef(null),{loading:c,deleteConversation:u}=pEe();m.useEffect(()=>{requestAnimationFrame(()=>{var b;(b=s.current)==null||b.focus()})},[]);const h=()=>{a&&br(Nq,"true"),t()},f=async()=>{await u(e),h(),_t.emit("composer:focus-input")},p=Aa(),v=!((y=me.instance().config().uiOverrides)==null?void 0:y.disableDeleteConfirmationCheckbox)&&!p;return d.jsxs(fEe,{id:r,onClose:t,className:"h-96",children:[d.jsx("h2",{className:"text-lg",children:i("composer.deleteConversation.header")}),d.jsx("p",{children:i("composer.deleteConversation.description")}),v&&d.jsx(AF,{disabled:c,checked:a,label:i("composer.deleteConversation.dontRemindMeCheck"),setChecked:o,className:"flex-1"}),d.jsx(Ee,{ref:s,title:i("common.delete"),color:"default",size:"56-xl",variant:"rect",className:"mt-auto w-full text-system-red-550 dark:text-system-red-350",disabled:c,onClick:f,children:c?d.jsx(Et,{className:"size-8"}):i("common.delete")}),d.jsx(Ee,{title:i("common.keep"),color:"strong",size:"56-xl",variant:"rect",className:"w-full",disabled:c,onClick:h,children:i("common.keep")})]})}const kF=O(void 0);async function KN(n){const{url:e,scenario:t="conversation"}=n;try{return await navigator.clipboard.writeText(e),!0}catch(r){return H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"CopyError",eventInfo_details:`Error copying shared ${t} url.`,eventInfo_errorMessage:r instanceof Error?r.message:""}}),!1}}function gEe({url:n,disableAutoCopy:e=!1,buttonColor:t="strong",onCopyClick:r}){const{t:i}=Ce(),a=i("share.copied"),o=i("share.copy"),s=i("share.copying"),[c,u]=m.useState(""),[h,f]=m.useState(!1),p=m.useRef(null),g=m.useRef(null),v=m.useCallback(()=>{p.current=window.setTimeout(()=>{u(o)},Z5)},[o]),y=m.useCallback(()=>{p.current&&clearTimeout(p.current)},[]);m.useEffect(()=>e?(u(o),y):(f(!0),u(s),p.current=window.setTimeout(()=>{KN({url:n}).then(C=>{var S;f(!1),u(C?a:o),(S=g.current)==null||S.focus(),r==null||r(),C&&v()})},$V),y),[v,y,n,a,o,s,e,r]);const b=async()=>{await KN({url:n}),u(a),y(),v(),r==null||r()};return d.jsx(Ee,{ref:g,title:c,color:t,size:"56-xl",className:"w-full",onClick:b,disabled:h,"aria-live":"polite","aria-label":c,children:h?d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx(Et,{type:"spinnerThemed",className:"size-6"}),c]}):c})}function vEe(n){const{onClose:e,shareUrl:t,imagePath:r,title:i}=n,[a,o]=m.useState(!0),{t:s}=Ce(),c=()=>{e(!1)};return d.jsxs(bo,{isOpen:!0,onClose:c,headerText:s("podcasts.share"),className:"w-full max-w-[640px]",children:[d.jsxs("div",{className:"mt-3 flex flex-col gap-6",children:[d.jsxs("div",{className:"mx-2 flex flex-col items-center gap-4",children:[d.jsxs("div",{className:"relative",children:[d.jsx(P9,{alt:"",path:r,onLoad:()=>o(!1),className:"rounded-2xl"}),d.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-podcast-share-modal-light dark:bg-gradient-podcast-share-modal-dark"}),!a&&d.jsx("h1",{className:"absolute bottom-8 mx-8 inline text-foreground-800 text-xl",role:"presentation",children:i})]}),a&&d.jsx("div",{className:"flex h-[328px] items-center justify-center",children:d.jsx(Et,{type:"spinnerThemed",className:"size-6"})})]}),d.jsx("div",{className:"py-4",children:d.jsx(gEe,{url:t,disableAutoCopy:!0})})]}),d.jsx("div",{className:"m-auto mb-3 max-w-[484px] text-center text-foreground-600 text-2xs",children:s("podcasts.sharePodcastsDisclaimer")})]})}const bEe=m.lazy(()=>$(()=>import("./sender-share-conversation-modal-Cg_0r11Q.js"),__vite__mapDeps([334,1,2,313,314,335])).then(n=>({default:n.ShareConversationModal})));function yEe(){const[n,e]=Je(kF),{t}=Ce(),r=uEe(),i=ee("share-image-continue"),a=m.useMemo(()=>n?document.activeElement:null,[n]),o=()=>{var s;a instanceof HTMLElement&&setTimeout(()=>{a.focus()},0),e(void 0),(n==null?void 0:n.action)==="share"&&((s=n.onClose)==null||s.call(n))};switch(n==null?void 0:n.action){case"delete":return d.jsx(Gi,{isOpen:!0,className:"w-3/4 max-w-fit",trapFocus:!0,disableCloseOutside:!0,children:d.jsx(mEe,{onClose:o,conversationId:n.conversationId})});case"share":{let s;return r||i?s=t("common.share"):n.messageId?s=t("share.shareModalHeaderOneTurn"):s=t("share.shareModalHeader"),d.jsx(Gi,{trapFocus:!0,isOpen:!!n.conversationId,disableCloseOutside:!0,onClose:o,headerText:s,headerTextClassName:ke("text-lg",r&&"text-xl"),className:ke("relative max-h-full w-3/4 max-w-[640px] gap-3 overflow-y-auto",r&&"gap-4 p-8"),children:d.jsx(m.Suspense,{fallback:d.jsx(Ee,{color:"strong",size:"56-xl",className:"w-full",title:t("common.loading"),disabled:!0,children:d.jsx(Et,{className:"size-8"})}),children:d.jsx(bEe,{conversationId:n.conversationId,scenario:n.scenario,messageId:n.messageId})})})}case"share-podcast":return d.jsx(vEe,{onClose:o,shareUrl:n.shareUrl,imagePath:n.imagePath,title:n.title});default:return null}}const CEe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/turn-limit-dark-CEuF11Ih.jpg",SEe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/turn-limit-light-BSlP2HSn.jpg";function xF(n){const{dismiss:e,source:t,beforeContinue:r}=n,{t:i}=Ce(),{login:a}=Sh(),o=ee("cmc-m365-sku"),s=i(o?"logIn.m365UpsellHeader":"logIn.proUpsellHeader"),c=i(o?"logIn.m365UpsellDescription":"logIn.proUpsellDescription"),u=i("common.notNow"),h=i("signInPrompt.continueWithMicrosoft"),f=N(qi),p=Bt();m.useEffect(()=>{nc({page:p,scenario:`UpsellProForAuth0AccountFrom${t}`})},[p,t]);const g=()=>{nt({source:`UpsellProForAuth0AccountFrom${t}`,scenario:"ProUpsellForAuth0AccountLinkWithMSA",destination:"MicrosoftLoginPage"}),r==null||r(),sessionStorage.setItem(Ww,`${new Date().getTime().toString()}-link`),a({provider:"microsoft"})},v=()=>{nt({source:`UpsellProForAuth0AccountFrom${t}`,scenario:"dismissProUpsellForAuth0Account",destination:p}),e()};return d.jsxs("div",{className:"flex flex-col items-center p-4 text-center",children:[d.jsx("img",{src:f==="dark"?CEe:SEe,alt:i("images.birds"),className:"h-44 w-full rounded-xl object-cover"}),d.jsx("h1",{className:"pb-3 pt-6 text-lg",children:s}),d.jsx("p",{className:"max-w-[95%] break-words pb-7",children:c}),d.jsxs(Ee,{onClick:g,title:h,variant:"pill",size:"48-lg",className:"w-full",color:"strong",testId:"prompt-sign-in-msft-composer-action",children:[d.jsx(py,{className:"size-6"}),h]}),d.jsx(Ee,{onClick:v,title:u,variant:"pill",size:"48-lg",color:"overlay-bright",className:"mt-3 w-full",testId:"not-now-button-composer-action",children:u})]})}const wEe=Object.freeze(Object.defineProperty({__proto__:null,default:xF},Symbol.toStringTag,{value:"Module"}));function EEe(){const n=ee("ceo-thinkdeeper"),e=ee("ceo-smart-mode"),t=ee("ceo"),r=ee("webretrieval"),i=ee("webcontent"),a=ee("browser-actions");return n||e||t||r||i||a}function TEe(){const n=ee("memory-management-v2"),e=fr(),t=N(GI),r=N(z3);return n&&e&&!t&&!r}function IEe(){const n=ee("sharemanagement"),e=fr();return n&&e}function _F(){const[n,e]=Je(Bl);return m.useEffect(()=>{e(t=>t||aW())},[e]),n}const MF=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...n},m.createElement("path",{fill:"currentColor",d:"M3 6.25A2.75 2.75 0 0 1 5.75 3.5h9.964a3.25 3.25 0 0 1 2.299.952l2.035 2.035c.61.61.952 1.437.952 2.299v9.964a2.75 2.75 0 0 1-2.75 2.75H5.75A2.75 2.75 0 0 1 3 18.75V6.25ZM5.75 5c-.69 0-1.25.56-1.25 1.25v12.5c0 .69.56 1.25 1.25 1.25H6v-5.25a2.25 2.25 0 0 1 2.25-2.25h7.5A2.25 2.25 0 0 1 18 14.75V20h.25c.69 0 1.25-.56 1.25-1.25V8.786c0-.465-.184-.91-.513-1.238l-2.035-2.035a1.75 1.75 0 0 0-.952-.49V7.75A2.25 2.25 0 0 1 13.75 10h-4.5A2.25 2.25 0 0 1 7 7.75V5H5.75ZM16.5 20v-5.25a.75.75 0 0 0-.75-.75h-7.5a.75.75 0 0 0-.75.75V20h9Zm-8-15v2.75c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75V5h-6Z"})),q6e=Object.freeze(Object.defineProperty({__proto__:null,default:MF},Symbol.toStringTag,{value:"Module"})),RF=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...n},m.createElement("path",{fill:"currentColor",d:"M12 4a8.5 8.5 0 1 0 0 17 8.5 8.5 0 0 0 0-17ZM2 12.5c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10-10-4.477-10-10ZM8 10a1.5 1.5 0 0 1 1.5-1.5h5A1.5 1.5 0 0 1 16 10v5a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 8 15v-5Z"})),W6e=Object.freeze(Object.defineProperty({__proto__:null,default:RF},Symbol.toStringTag,{value:"Module"}));function AEe(){const{t:n}=Ce(),[e,t]=Je(ste),r=N(hr),i=pe(L3),a=()=>{i(!1),t(void 0)},o=async s=>{await z9({allowBrowserActions:s}),eo.regenerateMessage({messageId:e??"",mode:"retry"}),i(s),t(void 0)};return d.jsx(bo,{isOpen:e!==void 0,headerIcon:d.jsxs("div",{className:"flex justify-center pb-7",children:[d.jsx("div",{className:"size-11 shrink-0 translate-x-1.5 rounded-full border-2 border-black/12 dark:border-white/15",children:d.jsx(fF,{imgSrc:r==null?void 0:r.imgSrc})}),d.jsx("div",{className:"flex size-11 -translate-x-1.5 items-center justify-center rounded-full border-2 border-black/12 bg-white dark:border-white/15",children:d.jsx(kh,{className:"size-7"})})]}),headerText:n("browserActions.consent.title"),className:"w-[360px] max-w-[95vw] gap-4 p-8",headerTextClassName:"text-lg text-center",children:d.jsxs("div",{className:"flex flex-col gap-4 text-sm",children:[d.jsx("p",{className:"mt-1 text-base",children:n("browserActions.consent.description")}),d.jsx(Tw,{icon:d.jsx(RF,{className:"size-6"}),title:n("browserActions.consent.inControlSectionTitle"),description:d.jsx("span",{children:d.jsx(Fr,{i18nKey:"browserActions.consent.inControlSectionDescription",components:{settingsLink:d.jsx(wm,{pages:["menu","account","privacy"],className:"text-caramel-450 dark:text-midnight-550",clickSource:"browserActionsConsentSettingsLink",onClick:a,pushPagesDelay:100})}})})}),d.jsx(Tw,{icon:d.jsx(MF,{className:"size-6"}),title:n("browserActions.consent.yourPrivacySectionTitle"),description:d.jsx("span",{children:n("browserActions.consent.yourPrivacySectionDescription")})}),d.jsx(Tw,{icon:d.jsx(mx,{className:"size-6"}),title:n("browserActions.consent.yourEdgeProfileSectionTitle"),description:d.jsx("span",{children:n("browserActions.consent.yourEdgeProfileSectionDescription")})}),d.jsxs("div",{className:"mt-4 flex flex-col gap-3",children:[d.jsx(Ee,{title:n("browserActions.consent.confirmButton"),color:"default",size:"56-xl",variant:"rect",className:"w-full",onClick:()=>o(!0),children:n("browserActions.consent.confirmButton")}),d.jsx(Ee,{title:n("browserActions.consent.cancelButton"),color:"default",size:"56-xl",variant:"rect",className:"mt-auto w-full text-system-red-550 dark:text-system-red-350",onClick:()=>o(!1),children:n("browserActions.consent.cancelButton")})]})]})})}function Tw(n){const{icon:e,title:t,description:r}=n;return d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{children:e}),d.jsxs("div",{className:"flex flex-col text-sm",children:[d.jsx("span",{className:"text-sm-strong",children:t}),r]})]})}function kEe(){const n=_F(),e=EEe(),t=N(la),r=N(m3),[i,a]=Je(Py),[o,s]=Je(fte),c=me.instance().config().entraRedirectModalBehaviour!=="skip",u=ee("ds-new-progress"),[h,f]=Je(C3),p=TEe(),g=IEe(),v=N(S3);return d.jsxs(d.Fragment,{children:[t&&d.jsx(p9,{accountActionRequired:t}),n&&i&&d.jsx(Gi,{isOpen:!0,trapFocus:!0,children:d.jsx(m1e,{interceptedLink:i,onClose:()=>{a(void 0)}})}),d.jsx(yEe,{}),r&&d.jsx(u1e,{}),o&&d.jsx(Gi,{isOpen:!0,className:"min-h-[328px] max-w-[528px]",children:d.jsx(xF,{dismiss:()=>s(null),source:"ProSubPage"})}),c&&d.jsx(f1e,{}),d.jsx(obe,{}),d.jsx(s1e,{}),d.jsx(AEe,{}),e&&d.jsx(Xwe,{}),u&&d.jsxs(d.Fragment,{children:[d.jsx(k1e,{}),d.jsx(v1e,{})]}),h!==null&&d.jsx(g1e,{config:h,onClose:()=>f(null)}),p&&d.jsx(G1e,{}),g&&d.jsx(lEe,{}),v&&v.visible&&d.jsx(d1e,{})]})}const PF=n=>m.createElement("svg",{width:96,height:93,viewBox:"0 0 96 93",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("mask",{id:"mask0_140_39981",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:0,y:0,width:96,height:93},m.createElement("mask",{id:"path-1-outside-1_140_39981",maskUnits:"userSpaceOnUse",x:0,y:0,width:96,height:93,fill:"black"},m.createElement("rect",{fill:"white",width:96,height:93}),m.createElement("path",{d:"M4 46.5C4 23.0279 23.0279 4 46.5 4H49.5C72.9721 4 92 23.0279 92 46.5V46.5C92 69.9721 72.9721 89 49.5 89H46.5C23.0279 89 4 69.9721 4 46.5V46.5Z"})),m.createElement("path",{d:"M46.5 4V8H49.5V4V0H46.5V4ZM49.5 89V85H46.5V89V93H49.5V89ZM46.5 89V85C25.237 85 8 67.763 8 46.5H4H0C0 72.1812 20.8188 93 46.5 93V89ZM92 46.5H88C88 67.763 70.763 85 49.5 85V89V93C75.1812 93 96 72.1812 96 46.5H92ZM49.5 4V8C70.763 8 88 25.237 88 46.5H92H96C96 20.8188 75.1812 0 49.5 0V4ZM46.5 4V0C20.8188 0 0 20.8188 0 46.5H4H8C8 25.237 25.237 8 46.5 8V4Z",fill:"url(#paint0_linear_140_39981)",fillOpacity:.8,mask:"url(#path-1-outside-1_140_39981)"}),m.createElement("g",{clipPath:"url(#paint1_angular_140_39981_clip_path)","data-figma-skip-parse":"true",mask:"url(#path-1-outside-1_140_39981)"},m.createElement("g",{transform:"matrix(0 -0.0425 0.0556447 0 48 46.5)"},m.createElement("foreignObject",{x:-1094.12,y:-1094.12,width:2188.24,height:2188.24},m.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",style:{background:"conic-gradient(from 90deg,rgba(214, 147, 237, 1) 0deg,rgba(250, 176, 198, 1) 60.2401deg,rgba(244, 185, 234, 1) 85.1532deg,rgba(141, 152, 255, 1) 126.663deg,rgba(170, 110, 238, 1) 209.329deg,rgba(255, 103, 119, 1) 250.911deg,rgba(255, 186, 113, 1) 291.415deg,rgba(198, 134, 255, 1) 332.659deg,rgba(214, 147, 237, 1) 360deg)",height:"100%",width:"100%",opacity:1}})))),m.createElement("path",{d:"M46.5 4V8H49.5V4V0H46.5V4ZM49.5 89V85H46.5V89V93H49.5V89ZM46.5 89V85C25.237 85 8 67.763 8 46.5H4H0C0 72.1812 20.8188 93 46.5 93V89ZM92 46.5H88C88 67.763 70.763 85 49.5 85V89V93C75.1812 93 96 72.1812 96 46.5H92ZM49.5 4V8C70.763 8 88 25.237 88 46.5H92H96C96 20.8188 75.1812 0 49.5 0V4ZM46.5 4V0C20.8188 0 0 20.8188 0 46.5H4H8C8 25.237 25.237 8 46.5 8V4Z",mask:"url(#path-1-outside-1_140_39981)"})),m.createElement("g",{mask:"url(#mask0_140_39981)"},m.createElement("g",{clipPath:"url(#paint2_angular_140_39981_clip_path)","data-figma-skip-parse":"true"},m.createElement("g",{transform:"matrix(0 -0.071 0.0897903 0 48 47.0001)"},m.createElement("foreignObject",{x:-1014.09,y:-1014.09,width:2028.17,height:2028.17},m.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",style:{background:"conic-gradient(from 90deg,rgba(0, 0, 0, 1) 0deg,rgba(255, 255, 255, 1) 52.2deg,rgba(197, 197, 197, 1) 122.4deg,rgba(0, 0, 0, 1) 147.6deg,rgba(255, 255, 255, 1) 171deg,rgba(174, 174, 174, 1) 235.8deg,rgba(0, 0, 0, 1) 250.911deg,rgba(217, 238, 247, 1) 266.4deg,rgba(255, 255, 255, 1) 332.659deg,rgba(0, 0, 0, 1) 360deg)",height:"100%",width:"100%",opacity:1}})))),m.createElement("rect",{x:-23,y:-24,width:142,height:142})),m.createElement("defs",null,m.createElement("clipPath",{id:"paint1_angular_140_39981_clip_path"},m.createElement("path",{d:"M46.5 4V8H49.5V4V0H46.5V4ZM49.5 89V85H46.5V89V93H49.5V89ZM46.5 89V85C25.237 85 8 67.763 8 46.5H4H0C0 72.1812 20.8188 93 46.5 93V89ZM92 46.5H88C88 67.763 70.763 85 49.5 85V89V93C75.1812 93 96 72.1812 96 46.5H92ZM49.5 4V8C70.763 8 88 25.237 88 46.5H92H96C96 20.8188 75.1812 0 49.5 0V4ZM46.5 4V0C20.8188 0 0 20.8188 0 46.5H4H8C8 25.237 25.237 8 46.5 8V4Z",mask:"url(#path-1-outside-1_140_39981)"})),m.createElement("clipPath",{id:"paint2_angular_140_39981_clip_path"},m.createElement("rect",{x:-23,y:-24,width:142,height:142})),m.createElement("linearGradient",{id:"paint0_linear_140_39981",x1:4,y1:89,x2:101.93,y2:75.3765,gradientUnits:"userSpaceOnUse"},m.createElement("stop",{stopColor:"#FFAB4E"}),m.createElement("stop",{offset:1,stopColor:"#FF7791"})))),Y6e=Object.freeze(Object.defineProperty({__proto__:null,default:PF},Symbol.toStringTag,{value:"Module"})),NF=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M20.2899 16.4358C20.6074 15.5282 20.78 14.5526 20.78 13.5366V9.5241C20.78 9.10859 20.4432 8.77175 20.0277 8.77175C19.6122 8.77175 19.2753 9.10859 19.2753 9.5241V13.5366C19.2753 14.1176 19.2072 14.6827 19.0785 15.2244L20.2899 16.4358Z",fill:"currentColor"}),m.createElement("path",{d:"M15.263 11.1575V6.51431C15.263 4.71377 13.8034 3.25414 12.0028 3.25414C10.7464 3.25414 9.65599 3.96485 9.11167 5.00618L8.01336 3.90787C8.86428 2.60809 10.3333 1.74944 12.0028 1.74944C14.6344 1.74944 16.7677 3.88274 16.7677 6.51431V12.6622L15.263 11.1575Z",fill:"currentColor"}),m.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.0026 20.8093C7.986 20.8093 4.7299 17.5532 4.7299 13.5366L4.7299 9.5241C4.7299 9.10859 4.39306 8.77175 3.97755 8.77175C3.56204 8.77175 3.2252 9.10859 3.2252 9.5241L3.2252 13.5366C3.2252 18.3843 7.15498 22.314 12.0026 22.314C14.6664 22.314 17.053 21.1274 18.6628 19.2539L21.0006 21.5917C21.2944 21.8855 21.7707 21.8855 22.0645 21.5917C22.3584 21.2979 22.3584 20.8215 22.0645 20.5277L3.00504 1.46823C2.71123 1.17442 2.23487 1.17442 1.94106 1.46823C1.64725 1.76204 1.64725 2.2384 1.94106 2.53221L7.23793 7.82908V13.5362C7.23793 16.1678 9.37124 18.3011 12.0028 18.3011C13.5589 18.3011 14.9407 17.5552 15.8103 16.4015L17.5951 18.1862C16.261 19.7891 14.251 20.8093 12.0026 20.8093ZM8.74263 13.5362C8.74263 15.3368 10.2023 16.7964 12.0028 16.7964C13.1441 16.7964 14.1484 16.21 14.7308 15.322L8.74263 9.33378L8.74263 13.5362Z",fill:"currentColor"})),Q6e=Object.freeze(Object.defineProperty({__proto__:null,default:NF},Symbol.toStringTag,{value:"Module"})),Tx=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.7673 6.54284C16.7673 3.91128 14.634 1.77799 12.0024 1.77799C9.37089 1.77799 7.2376 3.91129 7.2376 6.54284L7.2376 13.5647C7.2376 16.1963 9.37089 18.3296 12.0024 18.3296C14.634 18.3296 16.7673 16.1963 16.7673 13.5647L16.7673 6.54284ZM12.0024 3.28268C13.803 3.28268 15.2626 4.7423 15.2626 6.54284L15.2626 13.5647C15.2626 15.3652 13.803 16.8249 12.0024 16.8249C10.2019 16.8249 8.74229 15.3652 8.74229 13.5647L8.74229 6.54284C8.74229 4.7423 10.2019 3.28268 12.0024 3.28268Z",fill:"currentColor"}),m.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.0274 8.79987C19.6119 8.79987 19.2751 9.1367 19.2751 9.55221V13.5647C19.2751 17.5813 16.019 20.8374 12.0024 20.8374C7.98587 20.8374 4.72979 17.5813 4.72979 13.5647L4.72979 9.55221C4.72979 9.1367 4.39295 8.79987 3.97744 8.79987C3.56193 8.79987 3.2251 9.1367 3.2251 9.55221L3.2251 13.5647C3.2251 18.4123 7.15485 22.3421 12.0024 22.3421C16.85 22.3421 20.7798 18.4123 20.7798 13.5647V9.55221C20.7798 9.1367 20.443 8.79987 20.0274 8.79987Z",fill:"currentColor"})),J6e=Object.freeze(Object.defineProperty({__proto__:null,default:Tx},Symbol.toStringTag,{value:"Module"})),OF=n=>m.createElement("svg",{width:63,height:73,viewBox:"0 0 63 73",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("g",{filter:"url(#filter0_d_3118_29179)"},m.createElement("path",{d:"M39.7952 28.3892L42.2422 41.8194C43.061 46.313 43.4704 48.5598 42.1865 49.4826C40.9025 50.4053 38.9035 49.3009 34.9054 47.0922L22.9563 40.491C16.2962 36.8117 12.9661 34.972 13.4372 33.1039C13.9083 31.2359 17.7474 31.1951 25.4255 31.1136C27.1365 31.0955 27.992 31.0864 28.6339 30.625C29.2759 30.1637 29.5572 29.3557 30.12 27.7398C32.6452 20.4884 33.9078 16.8627 35.8285 17.0117C37.7493 17.1608 38.4313 20.9036 39.7952 28.3892Z",fill:"white",fillOpacity:.8,shapeRendering:"crispEdges"}),m.createElement("path",{d:"M39.7952 28.3892L42.2422 41.8194C43.061 46.313 43.4704 48.5598 42.1865 49.4826C40.9025 50.4053 38.9035 49.3009 34.9054 47.0922L22.9563 40.491C16.2962 36.8117 12.9661 34.972 13.4372 33.1039C13.9083 31.2359 17.7474 31.1951 25.4255 31.1136C27.1365 31.0955 27.992 31.0864 28.6339 30.625C29.2759 30.1637 29.5572 29.3557 30.12 27.7398C32.6452 20.4884 33.9078 16.8627 35.8285 17.0117C37.7493 17.1608 38.4313 20.9036 39.7952 28.3892Z",stroke:"white",strokeWidth:1.5,shapeRendering:"crispEdges"})),m.createElement("path",{d:"M43.06 50.7014C44.3479 49.7757 44.5485 48.2871 44.5004 46.9375L44.469 46.4069C44.397 45.4896 44.2259 44.4068 44.0083 43.1722L43.7279 41.6191L43.7271 41.6113L43.7263 41.6119L41.2578 28.06L40.7794 25.455C40.3207 22.9993 39.9105 20.9984 39.4527 19.5092L39.3346 19.1407C39.0928 18.4125 38.8119 17.7441 38.4599 17.1874L38.2786 16.9184C37.7807 16.2335 37.0781 15.6722 36.1346 15.5382L35.9428 15.5173C35.0273 15.4462 34.264 15.7987 33.6613 16.3187L33.4134 16.551C32.8862 17.0835 32.4355 17.7951 32.024 18.597L31.8493 18.9462C31.1633 20.3587 30.4435 22.2885 29.6039 24.6656L28.7214 27.1892L28.7014 27.2468C28.4821 27.8767 28.3253 28.323 28.1864 28.662L28.0522 28.9689C27.8919 29.3038 27.7981 29.3776 27.7565 29.4075C27.7254 29.4298 27.6614 29.4719 27.4758 29.5106L27.2465 29.5479C27.0436 29.5728 26.806 29.587 26.5081 29.5964L25.4073 29.6142L25.3455 29.6153C22.0505 29.6503 19.3668 29.6775 17.3562 29.8624L16.5355 29.9519C15.6246 30.0688 14.7765 30.2424 14.0635 30.5367L13.7674 30.6702C13.0061 31.0434 12.328 31.6403 12.0348 32.5515L11.9812 32.738C11.7577 33.624 11.971 34.4332 12.3786 35.1149L12.5645 35.3986C13.059 36.0947 13.7998 36.7301 14.6458 37.3375L15.3198 37.8019C16.9879 38.9103 19.3175 40.1961 22.1748 41.7746L34.238 48.4394L35.6206 49.2003C36.9417 49.9202 38.0776 50.5066 39.0333 50.8666L39.516 51.0344C40.6626 51.3952 41.933 51.5114 43.06 50.7014Z",stroke:"black",strokeWidth:1.5}),m.createElement("defs",null,m.createElement("filter",{id:"filter0_d_3118_29179",x:2.64307,y:6.25732,width:51.1152,height:66.3022,filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},m.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),m.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),m.createElement("feMorphology",{radius:2,operator:"erode",in:"SourceAlpha",result:"effect1_dropShadow_3118_29179"}),m.createElement("feOffset",{dy:16}),m.createElement("feGaussianBlur",{stdDeviation:4}),m.createElement("feComposite",{in2:"hardAlpha",operator:"out"}),m.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.12 0"}),m.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_3118_29179"}),m.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_3118_29179",result:"shape"})))),Z6e=Object.freeze(Object.defineProperty({__proto__:null,default:OF},Symbol.toStringTag,{value:"Module"}));function xEe(n){const{renderFocusedElement:e,children:t,className:r,options:i={},isOpen:a}=n,{offset:o=1,placement:s="bottom-end",adjustArrowPosition:c=S=>S}=i,u=m.useRef(null),{state:h,setState:f}=Xk({controlledValue:a,defaultValue:!1}),{y:p=0}=c({x:0,y:0})??{},{refs:g,context:v,floatingStyles:y,middlewareData:b}=qp({open:h,placement:s,onOpenChange:f,middleware:[nh(o),rh(),L5({element:u,padding:{right:-38,bottom:p}})],whileElementsMounted:th}),C=c(b.arrow);return d.jsxs(d.Fragment,{children:[e==null?void 0:e({ref:g.setReference},h),h&&d.jsx(cy,{children:d.jsx(ly,{context:v,modal:!1,children:d.jsxs("div",{ref:g.setFloating,style:y,className:ke("flex outline-none",$t.coachmark),children:[d.jsx("div",{className:ke("start-0 flex rounded-ee-md rounded-es-3xl rounded-se-3xl rounded-ss-3xl border border-background-200 border-white shadow-sm",r),children:t}),d.jsx("div",{ref:u,style:{position:"absolute",left:C==null?void 0:C.x,top:(C==null?void 0:C.y)??p},className:"pointer-events-none",children:d.jsx(OF,{className:"my-5 size-14"})})]})})})]})}const Ng="absolute inset-0 rounded-full",qN="relative size-6 transition-colors",WN=2,_Ee=50,MEe=20,LF=.6,REe=3,PEe=.55,NEe=1,OEe={opacity:0,scale:LF},LEe={opacity:1,scale:1,transition:{...d9,delay:f9}};function DEe(n){const{t:e}=Ce(),{isMuted:t,inputVolume:r,isOutputPlaying:i,enableSpinAnimation:a=!0,className:o,coachUserUnmute:s=!1,onClick:c}=n,u=!i&&!t,[h,f]=m.useState(!1),p=Nn({breakpoint:"sm"});m.useEffect(()=>{let S;return s&&(S=setTimeout(()=>f(!0),600)),()=>clearTimeout(S)},[s]);const g=D5(r,u9),v=Rd(g,[WN,_Ee],[LF,REe]),y=Rd(g,[WN,MEe],[PEe,NEe]),{focusable:b,refCallback:C}=ih({autoRestoreFocus:!0,forceFocus:!0});return d.jsx(xEe,{className:"max-w-72 border-white bg-black/90 p-2 dark:bg-white",isOpen:h,options:{placement:"top-end",offset:p?{mainAxis:27,crossAxis:10}:{mainAxis:15,crossAxis:-55},adjustArrowPosition:S=>p?{x:S!=null&&S.x?S.x-20:void 0,y:12}:S},renderFocusedElement:S=>d.jsxs(d.Fragment,{children:[h?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"absolute start-1/2 -my-4 size-fit -translate-x-1/2",children:d.jsx(On,{duration:.6,exitDelay:4.5,exitDuration:.5,children:d.jsx(_e.div,{animate:{rotate:360},transition:{duration:2.5,repeat:1,ease:"linear"},children:d.jsx(PF,{className:"size-20"})})})}),d.jsx("div",{className:"absolute start-1/2 -my-4 size-fit -translate-x-1/2",children:d.jsx(_e.div,{className:"size-[80px] rounded-full border-4 border-solid border-black/80 shadow-sm dark:border-white",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:4.5,ease:"linear"}})})]}):null,d.jsx(_e.button,{...S,title:e(t?"composer.unmuteMicrophone":"composer.muteMicrophone"),className:X("size-12 rounded-full",lp,fy,o),layout:!s,initial:"initial",animate:"enter",variants:{initial:OEe,enter:LEe},onClick:c,ref:E=>{S.ref(E),C(E)},"data-spatial-focus-key":b.focusKey,children:d.jsxs(_e.span,{className:X("flex items-center justify-center overflow-hidden border",t?"border-transparent bg-black/8 dark:bg-white/5":"border-white bg-white/50 hover:bg-white/80 dark:border-white/12 dark:bg-black/40",u&&"text-spot-blue-450 dark:text-midnight-300",Ng),layout:!s,children:[d.jsx(Mn,{children:u&&d.jsx(_e.div,{className:X("flex items-center justify-center overflow-hidden rounded-full blur-[6px]",Ng),layout:!0,initial:ct,animate:Rt,exit:ct,style:{scale:v},children:d.jsx(_e.div,{className:X(Ng),layout:!0,style:{opacity:y},children:d.jsx(_e.div,{className:X(a&&"animate-spin-slow","bg-gradient-audio-input-light dark:bg-gradient-audio-input-dark",Ng)})})})}),t?d.jsx(NF,{className:qN,"aria-hidden":!0}):d.jsx(Tx,{className:qN,"aria-hidden":!0})]})})]}),children:d.jsx("div",{className:"flex p-0 px-3 text-white text-sm dark:text-foreground-300",children:e("voice.v2.waitingInteractionUnmuteSubheader")})})}function Vp(n,e={},t){const{initialize:r=!1}=e,i=m.useRef(null);return m.useEffect(()=>{const a=t??i.current,o=new ResizeObserver(([s])=>{s&&n(s.contentRect)});return a&&(o.observe(a),r&&n(a.getBoundingClientRect())),()=>o.disconnect()},[n,r,t]),i}const Og={start:()=>{},end:()=>{},sessionStart:()=>{},sessionEnd:()=>{}},jEe={sessionStart:()=>{},sessionEnd:()=>{},log:()=>{},warn:()=>{},error:()=>{},incrementTick:()=>{}},w=jEe,cT="ellie",UEe=["aqua","aqua-head","erin","erin-head","mica","mica-head",cT],FEe={displayName:"",id:"",characterId:"",meshPaths:[],finiteStateMachine:"",animationStates:"",animationSettings:{idleLoopCount:0},transformNodes:{},characterNodeName:""};function YN(n){return typeof n=="object"&&n!==null&&"name"in n&&typeof n.name=="string"}class Pe{constructor(e,t,r){Object.defineProperty(this,"system",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"payload",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.system=e,this.name=t,this.payload=r}}class BEe{constructor(){Object.defineProperty(this,"listeners",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"nextFrameQueue",{enumerable:!0,configurable:!0,writable:!0,value:[]})}subscribe(e,t){this.listeners.has(e)||(this.listeners.set(e,new Set),w.log("event-manager","dev",`Created new listener set for system: ${e}`)),this.listeners.get(e).add(t),w.log("event-manager","dev",`Subscribed to system: ${e}`)}unsubscribe(e,t){const r=this.listeners.get(e);r&&(r.delete(t),w.log("event-manager","dev",`Unsubscribed from system: ${e}`),r.size===0&&(this.listeners.delete(e),w.log("event-manager","dev",`Removed empty listener set for system: ${e}`)))}subscribeOnce(e,t){const r=(i,a)=>{try{t(i,a)}finally{this.unsubscribe(e,r)}};this.subscribe(e,r),w.log("event-manager","dev",`Subscribed once to system: ${e}`)}waitForEvent(e,t){return new Promise(r=>{const i=a=>{(!t||a.name===t)&&(this.unsubscribe(e,i),r(a))};this.subscribe(e,i)})}emit(e,t="next-frame"){const r=this.listeners.get(e.system);if(t==="immediate"){if(w.log("event-manager","dev","Emitting event (immediate):",e),r)for(const i of r)try{i(e,0)}catch(a){w.error("event-manager","dev","Error in immediate callback",a)}}else this.nextFrameQueue.push(e),w.log("event-manager","dev","Queued event for next frame:",e)}onFrame(e){const t=this.nextFrameQueue;this.nextFrameQueue=[],t.length!==0&&w.log("event-manager","dev",`Delivering ${t.length} queued events (deltaTime: ${e})`);for(const r of t){const i=this.listeners.get(r.system);if(i)for(const a of i)try{a(r,e)}catch(o){w.error("event-manager","dev","Error in onFrame callback",o)}}}clearQueuedEvents(e){this.nextFrameQueue=this.nextFrameQueue.filter(t=>t.system!==e)}}class Qb{constructor(e,t,r,i="start",a){var o;Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"definitions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentFsmKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"actionHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventQueue",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"behaviorActionQueue",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"activeInteractionListeners",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.definitions=e,this.actionHandlers=t,this.eventManager=r,this.currentFsmKey=i,this.currentState=((o=this.definitions[this.currentFsmKey])==null?void 0:o.initial)??"",this.enterState(this.currentState,a)}onEventManagerEvent(e){w.log("shader-manager","dev",`[FSM-QUEUE] Event queued: ${e.system}:${e.name}`),this.eventQueue.push(e)}onActionEventManagerEvent(e){this.behaviorActionQueue.push(e)}processNextEvent(e,t){if(this.eventQueue.length===0)return!1;const r=this.eventQueue.shift();if(!r)return!1;const i=this.definitions[this.currentFsmKey];if(!i)return w.warn("behaviors","dev",` No definitions found for FSM "${this.currentFsmKey}".`),!1;const a=i.transitions.find(o=>o.from!==this.currentState?!1:typeof o.on=="object"&&o.on.system===r.system&&o.on.name===r.name);if(!a)return!1;if("to"in a){if(w.log("behaviors","dev",` Transition: "${this.currentState}" --(${r.system}:${r.name})--> "${a.to}"`),this.exitState(this.currentState,e,t),this.runActions(a.actions,e,t,this.currentState),this.currentState=a.to,this.enterState(this.currentState,e,t),this.eventManager){const o=new Pe(Lg,Iw,{state:this.currentState,fsm:this.currentFsmKey});this.eventManager.emit(o)}return!0}if("toExternal"in a){const o=a.toExternal;if(!(o in this.definitions))return w.warn("behaviors","dev",` Cannot switch to unknown FSM "${o}".`),!1;if(w.log("FSMBehavior","dev",` Switching FSM: "${this.currentFsmKey}" [${this.currentState}] --(${r.system} ${r.name})--> "${o}"`),this.exitState(this.currentState,e,t),this.runActions(a.actions,e,t,this.currentState),this.currentFsmKey=o,this.currentState=this.definitions[this.currentFsmKey].initial,this.enterState(this.currentState,e,t),this.eventManager){const s=new Pe(Lg,Iw,{state:this.currentState,fsm:this.currentFsmKey});this.eventManager.emit(s)}return!0}return!1}runActions(e,t,r,i){if(!e)return;const a=this.definitions[this.currentFsmKey];if(!(a!=null&&a.states[i])){w.warn("behaviors","dev",` No FSM definition found for "${this.currentFsmKey}" or state "${i}".`);return}const o=a.states[i];for(const s of e){const c=this.actionHandlers[s.name];if(!c){w.warn("behaviors","dev",` No action handler registered for "${s.name}".`);continue}w.log("behaviors","dev",` Calling action "${s.name}" in state "${i}" with params:`,s.params),c({params:s.params,frameContext:t,deltaTime:r,behavior:this,state:o})}}getState(){return this.currentState}getCurrentFsmKey(){return this.currentFsmKey}getDefinition(){return this.definitions[this.currentFsmKey]}step(e,t){if(this.ProcessOutstandingBehaviorActions(e,t),!this.processNextEvent(e,t)){const i=this.definitions[this.currentFsmKey];if(!i){w.warn("behaviors","dev",` No FSM definition found for "${this.currentFsmKey}".`);return}const a=i.states[this.currentState];if(a!=null&&a.onTick)for(const o of a.onTick){const s=this.actionHandlers[o.name];if(!s){w.warn("behaviors","dev",` No action handler registered for "${o.name}".`);continue}const c=s({params:o.params,frameContext:e,deltaTime:t,behavior:this,state:a});if(typeof c=="string"){this.onEventManagerEvent({system:Lg,name:c});break}}}}ProcessOutstandingBehaviorActions(e,t){const r=this.behaviorActionQueue.slice();this.behaviorActionQueue.length=0;for(const i of r){const{payload:a}=i;if(Array.isArray(a)){const o=a.filter(YN);o.length>0&&this.runActions(o,e,t,this.currentState)}else YN(a)&&this.runActions([a],e,t,this.currentState)}}enterState(e,t,r){var o;w.log("behaviors","dev",` Entering state: ${this.currentFsmKey} - "${e}"`);const i=this.definitions[this.currentFsmKey];if(!i){w.warn("behaviors","dev",` No FSM definition found for "${this.currentFsmKey}".`);return}const a=i.states[e];if(((a==null?void 0:a.clearAnimations)===void 0||a.clearAnimations===!0)&&((o=this.eventManager)==null||o.clearQueuedEvents("animationState")),a!=null&&a.onEnter)for(const s of a.onEnter){const c=this.actionHandlers[s.name];if(!c){w.warn("behaviors","dev",` No action handler registered for "${s.name}".`);continue}c({params:s.params,frameContext:t,deltaTime:r,behavior:this,state:a})}a!=null&&a.interactions&&(t!=null&&t.interactionManager)&&(this.activeInteractionListeners=t.interactionManager.addListeners(a.interactions),w.log("behaviors","dev",` Added ${this.activeInteractionListeners.length} interaction listeners for state "${e}"`))}exitState(e,t,r){w.log("behaviors","dev",` Exiting state: "${e}"`);const i=this.definitions[this.currentFsmKey];if(!i){w.warn("behaviors","dev",` No FSM definition found for "${this.currentFsmKey}".`);return}const a=i.states[e];if(this.activeInteractionListeners.length>0&&(t!=null&&t.interactionManager)&&(t.interactionManager.removeListeners(this.activeInteractionListeners),w.log("behaviors","dev",` Removed ${this.activeInteractionListeners.length} interaction listeners for state "${e}"`),this.activeInteractionListeners=[]),a!=null&&a.onExit)for(const o of a.onExit){const s=this.actionHandlers[o.name];if(!s){w.warn("behaviors","dev",` No action handler registered for "${o.name}".`);continue}s({params:o.params,frameContext:t,deltaTime:r,behavior:this,state:a})}}testState(e,t,r){if(e.includes("/")){const[i,a]=e.split("/",2);if(!i||!(i in this.definitions)){w.warn("behaviors","dev",` Cannot test FSM "${i}" - FSM does not exist.`);return}const o=this.definitions[i];if(!a||!o||!(a in o.states)){w.warn("FSMBehavior","dev",` Cannot test state "${a}" - state does not exist in FSM "${i}".`);return}w.log("FSMBehavior","dev",` Test FSM switch: "${this.currentFsmKey}" [${this.currentState}] --> "${i}" [${a}] (forced)`),this.exitState(this.currentState,t,r),this.currentFsmKey=i,this.currentState=a,this.enterState(this.currentState,t,r)}else{const i=this.definitions[this.currentFsmKey];if(!i||!(e in i.states)){w.warn("FSMBehavior","dev",` Cannot test state "${e}" - state does not exist in FSM "${this.currentFsmKey}".`);return}w.log("behaviors","dev",` Test transition: "${this.currentState}" --> "${e}" (forced)`),this.exitState(this.currentState,t,r),this.currentState=e,this.enterState(this.currentState,t,r)}if(this.eventManager){const i=new Pe(Lg,Iw,{state:this.currentState,fsm:this.currentFsmKey,isTestTransition:!0});this.eventManager.emit(i)}}getNextPossibleStatesDetailed(){const e=this.definitions[this.currentFsmKey];if(!e)return w.warn("behaviors","dev",` No FSM definition found for "${this.currentFsmKey}".`),{internalTransitions:[],externalTransitions:[]};const t=[],r=[];for(const i of e.transitions)i.from===this.currentState&&("to"in i?t.push({targetState:i.to,triggerEvent:i.on,actions:i.actions}):"toExternal"in i&&r.push({targetFsm:i.toExternal,triggerEvent:i.on,actions:i.actions}));return{internalTransitions:t,externalTransitions:r}}getNextPossibleStates(){const e=this.getNextPossibleStatesDetailed(),t=[];for(const r of e.internalTransitions)t.push(r.targetState);for(const r of e.externalTransitions){const i=this.definitions[r.targetFsm];i&&t.push(`${r.targetFsm}/${i.initial}`)}return t}static mergeActionHandlers(e,t){return{...e,...t}}}const Lg="fsm",Iw="fsmTransition";async function HEe(){const n=await $(()=>import("./babylon-modules-BTj6HoTY-DXNuzIIR.js"),__vite__mapDeps([336,4,5,39,40,41,42,1,2,43,44,45,46,47,48,49,50,51,52,53,24,9,37,28,56,26,27,29,30,31,32,25,6,7,8,33,34,35,36,13,38,12,54,55,170,190,64,61,65,63,143,149,161,169,68,144,147,150,229,223,224,225,250]));return{AbstractEngine:n.AbstractEngine,Engine:n.Engine,Vector3:n.Vector3,Vector2:n.Vector2,Matrix:n.Matrix,Quaternion:n.Quaternion,TmpVectors:n.TmpVectors,Camera:n.Camera,ArcRotateCamera:n.ArcRotateCamera,Scene:n.Scene,Material:n.Material,BackgroundMaterial:n.BackgroundMaterial,PBRMaterial:n.PBRMaterial,StandardMaterial:n.StandardMaterial,ShaderMaterial:n.ShaderMaterial,Texture:n.Texture,ProceduralTexture:n.ProceduralTexture,RenderTargetTexture:n.RenderTargetTexture,AbstractMesh:n.AbstractMesh,Mesh:n.Mesh,MeshBuilder:n.MeshBuilder,AnimationGroup:n.AnimationGroup,MaterialPluginBase:n.MaterialPluginBase,PrecisionDate:n.PrecisionDate,ShaderLanguage:n.ShaderLanguage,MorphTargetManager:n.MorphTargetManager,MorphTarget:n.MorphTarget,Color3:n.Color3,Color4:n.Color4,TransformNode:n.TransformNode,Observable:n.Observable,MeshoptCompression:n.MeshoptCompression,ImportMeshAsync:n.ImportMeshAsync,DirectionalLight:n.DirectionalLight,RegisterMaterialPlugin:n.RegisterMaterialPlugin,Math:n.Math,Scalar:n.Scalar,KeyboardEventTypes:n.KeyboardEventTypes,PointerInfo:n.PointerInfo,PointerEventTypes:n.PointerEventTypes,NodeMaterial:n.NodeMaterial,ImageSourceBlock:n.ImageSourceBlock,InputBlock:n.InputBlock,TextureBlock:n.TextureBlock,GradientBlock:n.GradientBlock,GradientBlockColorStep:n.GradientBlockColorStep,GlowLayer:n.GlowLayer,MeshParticleEmitter:n.MeshParticleEmitter,ParticleSystem:n.ParticleSystem}}class he{static async loadLibraries(){if(he.isInitialized)return;const e=await HEe();try{e.MeshoptCompression}catch{}try{const t=e;t.Tools&&t.Tools.LoadBabylonScriptAsync&&(t.Tools.LoadBabylonScriptAsync=async(r,i,a)=>{})}catch{}he.Core=e,he.Math=e.Math,he.isInitialized=!0}static async loadViewerLibraries(){try{const t=await import("@babylonjs/viewer");he.Viewer=t}catch{he.Viewer=null}}static async loadDebugLibraries(){await he.loadLibraries(),await Promise.all([$(()=>import("./babylon.inspector.bundle-rqCPPOED.js").then(e=>e.b),__vite__mapDeps([267,2,268,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,1,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,269,266,223,224,225,222,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,270,271,272])),$(()=>import("./babylon.nodeEditor-BlI-PA7w.js").then(e=>e.b),__vite__mapDeps([337,2,268,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,1,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221]))])}static isLoaded(){return he.isInitialized}static getCore(){return he.throwIfNotInitialized("Core"),he.Core}static getMath(){return he.throwIfNotInitialized("Core"),he.Math}static getViewer(){if(he.throwIfNotInitialized("Core"),!he.Viewer)throw new Error("Babylon.js Viewer not loaded. Ensure '@babylonjs/viewer' is installed and 'loadViewerLibraries()' has been called.");return he.Viewer}static throwIfNotInitialized(e){if(!he.isInitialized)throw new Error(`Libraries ${e} are not loaded yet. Call loadLibraries first.`)}}Object.defineProperty(he,"isInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1});function $Ee(){var t;if(typeof window>"u"||!window.BABYLON)return;const n=window.BABYLON;if(!((t=n.RGBDTextureTools)!=null&&t.ExpandRGBDTexture)){w.log("babylon","dev","RGBDTextureTools not found, skipping patch");return}const e=n.RGBDTextureTools.ExpandRGBDTexture;n.RGBDTextureTools.ExpandRGBDTexture=function(r){try{if(!(r!=null&&r._texture)||!r.isRGBD)return;const i=r.getScene();if(!i){w.warn("babylon","dev","Scene not available for RGBD texture expansion");return}if(!i.postProcessManager){w.warn("babylon","dev","PostProcessManager not available, deferring RGBD texture expansion"),i.onReadyObservable&&i.onReadyObservable.addOnce(()=>{i.postProcessManager?(w.log("babylon","dev","Retrying RGBD texture expansion after scene ready"),e.call(this,r)):w.error("babylon","dev","PostProcessManager still not available after scene ready")});return}return e.call(this,r)}catch(i){w.error("babylon","dev","Error in RGBD texture expansion:",i),r!=null&&r._texture&&(r._texture._isRGBD=!1,r._texture.invertY=!1)}},w.log("babylon","dev","RGBDTextureTools.ExpandRGBDTexture has been patched")}class zEe{constructor(e,t){if(Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!he.isLoaded())throw new Error("Package is not loaded");this.engine=e,this.scene=null,this.camera=null,this.canvas=null,this.debug=t}async initScene(e,t){if(!this.engine)throw new Error("Engine is not defined");t||w.warn("babylon","dev","No ACTMI path provided, using default");const{Scene:r}=he.getCore();return this.scene=new r(this.engine),this.canvas=e,$Ee(),this.debug&&this.setupDebugLayer(),this.scene}setupDebugLayer(){if(!this.scene)return;const{KeyboardEventTypes:e}=he.getCore();this.scene.onKeyboardObservable.add(i=>{var a;if(i.event.key==="`"&&i.type===e.KEYDOWN&&r(this.scene),i.event.key==="Insert"){if(!this.canvas)return;(a=this.camera)==null||a.attachControl(this.canvas,!0);const o=this.camera;o.wheelDeltaPercentage=.01,o.panningSensibility=1e4}});let t=!1;async function r(i){var s,c;if(!i)return;try{w.log("babylon","dev","loading inspector..."),await $(()=>import("./babylon.inspector.bundle-rqCPPOED.js").then(u=>u.b),__vite__mapDeps([267,2,268,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,1,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,269,266,223,224,225,222,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,270,271,272]))}catch{w.warn("babylon","dev","@babylonjs/inspector not available - debug layer disabled");return}const a=i;if(!a.debugLayer){w.warn("babylon","dev","Debug layer not available on scene after import");return}let o=document.getElementById("babylonjs-debug-root");if(!o){const u=document.createElement("div");u.id="babylonjs-debug-root",u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.width="100%",u.style.height="100%",u.onkeydown=h=>{var f;h.key==="`"&&(t=!1,(f=a.debugLayer)==null||f.hide(),u.onkeydown=null,document.body.removeChild(u))},document.body.appendChild(u),o=u}t=!t,t?(s=a.debugLayer)==null||s.show({showInspector:!0,overlay:!1,embedMode:!0,enableClose:!0,globalRoot:o}):(c=a.debugLayer)==null||c.hide()}}}class VEe extends zEe{}class bt{static initialize(e){if(bt.isInitialized){w.warn("EmbeddableAppearanceAnalytics","dev","Analytics system already initialized. Ignoring subsequent initialization.",bt.config);return}bt.config=e,bt.isInitialized=!0,w.log("EmbeddableAppearanceAnalytics","dev","Analytics system initialized successfully.",bt.config)}static reset(){bt.config=null,bt.isInitialized=!1}static getConfig(){return bt.config}static getIsInitialized(){return bt.isInitialized}static ensureInitialized(){return!bt.isInitialized||!bt.config?(w.log("EmbeddableAppearanceAnalytics","dev","Analytics system not initialized. Call initialize() first.",bt.config),!1):!0}}Object.defineProperty(bt,"config",{enumerable:!0,configurable:!0,writable:!0,value:null});Object.defineProperty(bt,"isInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1});class Ro{static log(e,t,r,...i){r!=null&&r.loggerCallback&&r.loggerCallback("EmbeddableAppearanceAnalytics",e,t,...i)}}class hf{static isTrackingAvailable(e,t,r){return e.isAppearanceEnabled()&&(t||r)}static shouldTrackCharacter(e,t){return e.isAppearanceId?e.isAppearanceId(t):!1}static roundDuration(e){return Math.round(e)}}class GEe{constructor(e){Object.defineProperty(this,"stateManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.stateManager=e}trackLoadingEvent(e){const t=bt.getConfig();if(!t||!this.isTrackingAvailable()||this.stateManager.getInteractTime()===0)return;const{eventName:r,duration:i,characterId:a}=e;if(a&&!hf.shouldTrackCharacter(t,a))return;const s=["voiceChatToggled","appearanceVisible","appearanceLoadingComplete"].includes(r),c=this.stateManager.getVoiceChatToggledOn()?"voiceChat":"homeScreen",u=this.stateManager.getIsFirstTime(),h={eventName:r,eventInfo_duration:hf.roundDuration(i),eventInfo_conversationId:this.stateManager.getCurrentConversationId(),eventInfo_characterId:a,eventInfo_scenario:c,eventInfo_trigger:s?this.stateManager.getInteractSource():void 0};u!==void 0&&(h.eventInfo_firstTime=u),t.trackEventCallback({name:"system",data:h}),Ro.log("dev",`[] -> ${r} : `,t,"color: #691dc6;",hf.roundDuration(i),a?`characterId: ${a}`:"")}trackCharacterAnimation(e,t){const r=bt.getConfig();r&&r.trackEventCallback({name:"interaction",data:{eventName:"characterAnimation",eventInfo_characterAnimationState:e,eventInfo_characterId:t}})}trackAnimationStart(){const e=bt.getConfig();if(!e||!this.isTrackingAvailable())return;this.stateManager.getSpeechEndDetectedTime()===0&&this.stateManager.getStartMessageTime()===0&&w.log("EmbeddableAppearanceAnalytics","dev","Neither speechEndDetectedTime nor startMessageTime is set. Duration might be inaccurate.");const t=hf.roundDuration(performance.now()-(this.stateManager.getSpeechEndDetectedTime()||this.stateManager.getStartMessageTime()));e.trackEventCallback({name:"system",data:{eventName:"copilotAnimationStart",eventInfo_conversationId:this.stateManager.getCurrentConversationId(),eventInfo_messageId:this.stateManager.getCurrentMessageId(),eventInfo_duration:t}}),Ro.log("dev","[] -> onAnimationStart : ",e,"color: #691dc6;",t)}trackTimingEvent(e){const t=bt.getConfig();if(!t||!this.isTrackingAvailable())return;const r={eventName:"timingCompleted",timingSession:e};try{t.trackEventCallback({name:"timingCompleted",data:r}),Ro.log("debug",`TimingEvent tracked: ${e.sessionId}, Duration: ${e.endTime?e.endTime-e.startTime:0}ms`,t)}catch(i){Ro.log("error",`Failed to track timing event: ${String(i)}`,t)}}isTrackingAvailable(){const e=bt.getConfig();return e?hf.isTrackingAvailable(e,this.stateManager.getTriggeringUserInteractionLogged(),this.stateManager.getVoiceChatToggledOn()):!1}}class KEe{constructor(){Object.defineProperty(this,"activeSessions",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}startTiming(e,t){if(this.activeSessions.has(e))throw new Error(`Timing session '${e}' is already active`);const r=performance.now(),i={id:"start",timestamp:r,metadata:{type:"session_start",...t}},a={sessionId:e,startTime:r,marks:[i],segments:[],metadata:t};return this.activeSessions.set(e,a),a}endTiming(e,t){const r=this.activeSessions.get(e);if(!r)throw new Error(`No active timing session found for '${e}'`);const i=performance.now(),a={id:"end",timestamp:i,metadata:{type:"session_end",...t}};r.marks.push(a),r.endTime=i;const o=r.marks[0];if(!o)throw new Error(`No start mark found for session '${e}'`);const s={id:`${e}_total`,startMarkId:o.id,endMarkId:a.id,duration:i-r.startTime,startTime:r.startTime,endTime:i,metadata:{type:"total_duration"}};return r.segments.push(s),this.activeSessions.delete(e),r}addTimingMark(e,t,r=!0,i,a){const o=this.activeSessions.get(e);if(!o)throw new Error(`No active timing session found for '${e}'`);const s=performance.now(),c={id:t,timestamp:s,metadata:a};return o.marks.push(c),r&&this.createSegmentForMark(o,c,i),c}isSessionActive(e){return this.activeSessions.has(e)}reset(){this.activeSessions.clear()}createSegmentForMark(e,t,r){var a,o;let i;if(r){if(i=e.marks.find(s=>s.id===r),!i)throw new Error(`Start mark '${r}' not found in session '${e.sessionId}'`)}else e.marks.length>=2&&(i=e.marks[e.marks.length-2]);if(i){const c={id:`${i.id}:${t.id}`,startMarkId:i.id,endMarkId:t.id,duration:t.timestamp-i.timestamp,startTime:i.timestamp,endTime:t.timestamp,metadata:{startMarkType:(a=i.metadata)==null?void 0:a.type,endMarkType:(o=t.metadata)==null?void 0:o.type}};e.segments.push(c)}}}class qEe{constructor(){Object.defineProperty(this,"interactTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"voiceChatToggledTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"speechEndDetectedTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"startMessageTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"mountedTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"libsLoadedTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sceneInitializedTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"appearanceRenderedTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"triggeringUserInteractionLogged",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"interactSource",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"currentConversationId",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"currentMessageId",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"visualizerEnabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"loadedEnd",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"voiceChatToggledOn",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isFirstTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}resetLoading(){this.interactTime=0,this.visualizerEnabled=!1,this.loadedEnd=!1}checkEnd(){this.visualizerEnabled&&this.loadedEnd&&this.resetLoading()}getInteractTime(){return this.interactTime}getVoiceChatToggledTime(){return this.voiceChatToggledTime}getSpeechEndDetectedTime(){return this.speechEndDetectedTime}getStartMessageTime(){return this.startMessageTime}getMountedTime(){return this.mountedTime}getLibsLoadedTime(){return this.libsLoadedTime}getSceneInitializedTime(){return this.sceneInitializedTime}getAppearanceRenderedTime(){return this.appearanceRenderedTime}getInteractSource(){return this.interactSource}getCurrentConversationId(){return this.currentConversationId}getCurrentMessageId(){return this.currentMessageId}getVisualizerEnabled(){return this.visualizerEnabled}getLoadedEnd(){return this.loadedEnd}getTriggeringUserInteractionLogged(){return this.triggeringUserInteractionLogged}getVoiceChatToggledOn(){return this.voiceChatToggledOn}getIsFirstTime(){return this.isFirstTime}setInteractTime(e){this.interactTime=e}setVoiceChatToggledTime(e){this.voiceChatToggledTime=e}setSpeechEndDetectedTime(e){this.speechEndDetectedTime=e}setStartMessageTime(e){this.startMessageTime=e}setMountedTime(e){this.mountedTime=e}setLibsLoadedTime(e){this.libsLoadedTime=e}setSceneInitializedTime(e){this.sceneInitializedTime=e}setAppearanceRenderedTime(e){this.appearanceRenderedTime=e}setInteractSource(e){this.interactSource=e}setCurrentConversationId(e){this.currentConversationId=e}setCurrentMessageId(e){this.currentMessageId=e}setVisualizerEnabled(e){this.visualizerEnabled=e}setLoadedEnd(e){this.loadedEnd=e}setTriggeringUserInteractionLogged(e){this.triggeringUserInteractionLogged=e}setVoiceChatToggledOn(e){this.voiceChatToggledOn=e}setIsFirstTime(e){this.isFirstTime=e}}function WEe(n){return UEe.includes(n)}class tt{constructor(){Object.defineProperty(this,"stateManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventTracker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timingTracker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.stateManager=new qEe,this.eventTracker=new GEe(this.stateManager),this.timingTracker=new KEe}static initialize(e){if(bt.getIsInitialized()){Ro.log("warn","EmbeddableAppearanceAnalytics already initialized. Ignoring subsequent initialization.",bt.getConfig());return}const t=e;t.isAppearanceId??(t.isAppearanceId=r=>WEe(r)),bt.initialize(t),tt.instance=new tt,Ro.log("dev","EmbeddableAppearanceAnalytics initialized successfully.",bt.getConfig())}static reset(){tt.instance=null,bt.reset()}static isAvailable(){if(!bt.ensureInitialized()||!tt.instance)return!1;const e=bt.getConfig(),{stateManager:t}=tt.instance;return e.isAppearanceEnabled()&&t.getVoiceChatToggledOn()}static trackCharacterAnimationState(e,t){!bt.ensureInitialized()||!tt.instance||tt.instance.eventTracker.trackCharacterAnimation(e,t)}static onTriggeringUserInteraction(e,t){if(!bt.ensureInitialized()||!tt.instance)return;const{stateManager:r}=tt.instance;r.resetLoading(),r.setInteractTime(performance.now()),r.setTriggeringUserInteractionLogged(!0),r.setInteractSource(e),r.setIsFirstTime(t),Ro.log("dev","[] -> onTriggeringUserInteraction",bt.getConfig(),"color: #222222;")}static onVoiceChatToggled(e,t,r){if(!bt.ensureInitialized()||!tt.instance)return;const{stateManager:i,eventTracker:a}=tt.instance;if(i.setIsFirstTime(r),e==="end")i.setVoiceChatToggledOn(!1),i.setSpeechEndDetectedTime(0);else{i.setVoiceChatToggledOn(!0);const o=performance.now();i.setVoiceChatToggledTime(o),i.setCurrentConversationId(t??"");const s=o-i.getInteractTime();a.trackLoadingEvent({eventName:"voiceChatToggled",duration:s})}}static onMounted(e){if(!bt.ensureInitialized()||!tt.instance)return;const{stateManager:t,eventTracker:r}=tt.instance,i=performance.now();t.setMountedTime(i),t.setIsFirstTime(e);let a=Math.min(t.getInteractTime(),t.getVoiceChatToggledTime());if(a===0)if(t.getInteractTime()>0)a=t.getInteractTime();else if(t.getVoiceChatToggledTime()>0)a=t.getVoiceChatToggledTime();else{w.warn("EmbeddableAppearanceAnalytics","dev","No valid start time was found. Not tracking appearanceMounted event.");return}const o=i-a;r.trackLoadingEvent({eventName:"appearanceMounted",duration:o})}static onBabylonLibrariesLoaded(){if(!bt.ensureInitialized()||!tt.instance)return;const{stateManager:e,eventTracker:t}=tt.instance,r=performance.now();e.setLibsLoadedTime(r);const i=r-e.getMountedTime();t.trackLoadingEvent({eventName:"appearanceBabylonLoaded",duration:i})}static onSceneInitialized(e){if(!bt.ensureInitialized()||!tt.instance)return;const{stateManager:t,eventTracker:r}=tt.instance,i=performance.now();t.setSceneInitializedTime(i);const a=i-t.getLibsLoadedTime();r.trackLoadingEvent({eventName:"appearanceSceneInitialized",duration:a,characterId:e}),r.trackLoadingEvent({eventName:"appearanceLoadingComplete",duration:i-t.getInteractTime(),characterId:e}),t.setLoadedEnd(!0),t.checkEnd()}static onAppearanceRendered(e){if(!bt.ensureInitialized()||!tt.instance)return;const{stateManager:t,eventTracker:r}=tt.instance,i=performance.now();t.setAppearanceRenderedTime(i);const a=i-t.getInteractTime();r.trackLoadingEvent({eventName:"appearanceRendered",duration:a,characterId:e})}static onVisualizerEnabled(){if(!bt.ensureInitialized()||!tt.instance)return;const{stateManager:e,eventTracker:t}=tt.instance;if(e.getVisualizerEnabled())return;e.setVisualizerEnabled(!0);const r=Math.round(performance.now()-e.getInteractTime());t.trackLoadingEvent({eventName:"appearanceVisible",duration:r}),e.checkEnd()}static onStartMessage(e,t){if(!bt.ensureInitialized()||!tt.instance)return;const{stateManager:r}=tt.instance;r.setCurrentMessageId(e),r.setStartMessageTime(t)}static onSpeechEndDetected(e){if(!bt.ensureInitialized()||!tt.instance)return;const{stateManager:t}=tt.instance;t.setSpeechEndDetectedTime(e)}static onAnimationStart(){if(!bt.ensureInitialized()||!tt.instance)return;const{eventTracker:e}=tt.instance;e.trackAnimationStart()}static startTiming(e,t){if(!bt.ensureInitialized()||!tt.instance)return;const{timingTracker:r}=tt.instance;r.startTiming(e,t)}static endTiming(e,t){if(!bt.ensureInitialized()||!tt.instance)return;const{timingTracker:r,eventTracker:i}=tt.instance;try{const a=r.endTiming(e,t);return i.trackTimingEvent(a),a}catch(a){const o=a instanceof Error?a.message:String(a);Ro.log("warn",`Failed to end timing session '${e}': ${o}`,bt.getConfig());return}}static addTimingMark(e,t,r=!0,i,a){if(!bt.ensureInitialized()||!tt.instance)return;const{timingTracker:o}=tt.instance;try{o.addTimingMark(e,t,r,i,a)}catch(s){const c=s instanceof Error?s.message:String(s);Ro.log("warn",`Failed to add timing mark '${t}' to session '${e}': ${c}`,bt.getConfig())}}}Object.defineProperty(tt,"instance",{enumerable:!0,configurable:!0,writable:!0,value:null});function YEe(n,e,t){return Math.abs(n-e)>t?e:n}function lT(n,e,t=.01,r=.2){const{Scalar:i}=he.getCore();return i.MoveTowards(n,YEe(n,e,t),r)}function Ix(n,e){const t=n.getNodeByName(e);if(t)return t;const r=n.getTransformNodeByName(e);return r||null}function ad(n,e){const t=n.getMeshByName(e);if(t)return t;const r=n.getTransformNodeByName(e);if(r){const i=r.getChildMeshes(!0)[0];if(i)return i}return t}function QEe(n){if(!n)return 0;const e=JEe(n);return(n.to-e)/60}function JEe(n){var e;return n!=null&&n.animatables&&n.animatables.length>0?((e=n.animatables[0])==null?void 0:e.masterFrame)??0:0}function DF(n){switch(n){case"linear":return JN;case"easeInSine":return ZEe;case"easeOutSine":return XEe;case"easeInOutSine":return eTe;case"easeInQuad":return tTe;case"easeOutQuad":return nTe;case"easeInOutQuad":return rTe;case"easeInCubic":return iTe;case"easeOutCubic":return aTe;case"easeInOutCubic":return oTe;case"easeInQuart":return sTe;case"easeOutQuart":return cTe;case"easeInOutQuart":return lTe;case"easeInQuint":return uTe;case"easeOutQuint":return dTe;case"easeInOutQuint":return hTe;case"easeInExpo":return fTe;case"easeOutExpo":return pTe;case"easeInOutExpo":return mTe;case"easeInCirc":return gTe;case"easeOutCirc":return vTe;case"easeInOutCirc":return bTe;case"easeInBack":return yTe;case"easeOutBack":return CTe;case"easeInOutBack":return STe;case"easeInElastic":return wTe;case"easeOutElastic":return ETe;case"easeInOutElastic":return TTe;case"easeInBounce":return ITe;case"easeOutBounce":return Jb;case"easeInOutBounce":return ATe;default:return JN}}const BC=1.70158,Dg=BC*1.525,jF=BC+1,UF=2*Math.PI/3,QN=2*Math.PI/4.5;function JN(n){return he.getMath().Clamp(n)}function ZEe(n){return he.getMath().Clamp(1-Math.cos(n*Math.PI/2))}function XEe(n){return he.getMath().Clamp(Math.sin(n*Math.PI/2))}function eTe(n){return he.getMath().Clamp(-(Math.cos(Math.PI*n)-1)/2)}function tTe(n){return he.getMath().Clamp(n**2)}function nTe(n){return he.getMath().Clamp(n*(2-n))}function rTe(n){return he.getMath().Clamp(n<.5?2*n**2:-1+(4-2*n)*n)}function iTe(n){return he.getMath().Clamp(n**3)}function aTe(n){const e=n-1;return he.getMath().Clamp(e*e*e+1)}function oTe(n){return he.getMath().Clamp(n<.5?4*n*n*n:1+4*(n-1)*(n-1)*(n-1))}function sTe(n){return he.getMath().Clamp(n**4)}function cTe(n){const e=n-1;return he.getMath().Clamp(1-e**4)}function lTe(n){return he.getMath().Clamp(n<.5?8*n**4:1-8*(n-1)**4)}function uTe(n){return he.getMath().Clamp(n**5)}function dTe(n){const e=n-1;return he.getMath().Clamp(1+e**5)}function hTe(n){return he.getMath().Clamp(n<.5?16*n**5:1+16*(n-1)**5)}function fTe(n){return he.getMath().Clamp(n===0?0:2**(10*n-10))}function pTe(n){return he.getMath().Clamp(n===1?1:1-2**(-10*n))}function mTe(n){return n===0?0:n===1?1:n<.5?he.getMath().Clamp(2**(20*n-10)/2):he.getMath().Clamp((2-2**(-20*n+10))/2)}function gTe(n){return he.getMath().Clamp(1-Math.sqrt(1-n*n))}function vTe(n){const e=n-1;return he.getMath().Clamp(Math.sqrt(1-e*e))}function bTe(n){return he.getMath().Clamp(n<.5?(1-Math.sqrt(1-4*n*n))/2:(Math.sqrt(1-(-2*n+2)**2)+1)/2)}function yTe(n){return he.getMath().Clamp(jF*n*n*n-BC*n*n)}function CTe(n){const e=n-1;return he.getMath().Clamp(1+jF*e*e*e+BC*e*e)}function STe(n){if(n<.5)return he.getMath().Clamp((2*n)**2*((Dg+1)*2*n-Dg)/2);const e=2*n-2;return he.getMath().Clamp((e**2*((Dg+1)*e+Dg)+2)/2)}function wTe(n){return n===0?0:n===1?1:he.getMath().Clamp(-(2**(10*n-10))*Math.sin((n*10-10.75)*UF))}function ETe(n){return n===0?0:n===1?1:he.getMath().Clamp(2**(-10*n)*Math.sin((n*10-.75)*UF)+1)}function TTe(n){return n===0?0:n===1?1:n<.5?he.getMath().Clamp(-.5*2**(20*n-10)*Math.sin((20*n-11.125)*QN)):he.getMath().Clamp(.5*2**(-20*n+10)*Math.sin((20*n-11.125)*QN)+1)}function ITe(n){return he.getMath().Clamp(1-Jb(1-n))}function Jb(n){if(n<1/2.75)return he.getMath().Clamp(7.5625*n*n);if(n<2/2.75){const i=n-.5454545454545454;return he.getMath().Clamp(7.5625*i*i+.75)}if(n<2.5/2.75){const i=n-.8181818181818182;return he.getMath().Clamp(7.5625*i*i+.9375)}const r=n-2.625/2.75;return he.getMath().Clamp(7.5625*r*r+.984375)}function ATe(n){return n<.5?he.getMath().Clamp((1-Jb(1-2*n))/2):he.getMath().Clamp((1+Jb(2*n-1))/2)}class kTe{constructor(e,t){Object.defineProperty(this,"animations",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.animations=new Array,this.currentList=[];for(const r of e)if(r){const i=t.getAnimationGroupByName(r);i&&this.animations.push(i)}this.refreshCurrentList()}refreshCurrentList(){this.currentList=Array.from(this.animations),this.currentList=this.currentList.sort(()=>.5-Math.random())}random(){if(this.animations.length===0){w.warn("character-system","dev","No valid animations in list.");return}if(this.animations.length===1)return this.animations[0];this.currentList.length<=0&&this.refreshCurrentList();const e=this.currentList.pop();return e||w.warn("character-system","dev","No animation available to return."),e}}class xTe{constructor(e,t,r,i,a,o){Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"animationGroup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fadeTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loopCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentLoopCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"onAnimLoopObs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAnimTickObs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAnimEndObs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"disposed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.scene=e,this.animationGroup=t,this.loopCount=0,this.fadeTime=r,typeof i=="number"?this.loopCount=i:i==="forever"&&(this.loopCount=Number.MAX_SAFE_INTEGER),this.onAnimLoopObs=this.animationGroup.onAnimationGroupLoopObservable.add(s=>{this.currentLoopCount+=1,this.currentLoopCount>this.loopCount&&o(s)}),this.onAnimTickObs=this.scene.onBeforeAnimationsObservable.add(()=>{a(this.animationGroup),this.animationGroup.isPlaying&&this.currentLoopCount===this.loopCount&&this.animationGroup.weight>0&&QEe(this.animationGroup)<=this.fadeTime&&o(this.animationGroup)}),this.onAnimEndObs=this.animationGroup.onAnimationGroupEndObservable.add(s=>{this.fadeTime>0&&this.loopCount>0||o(s)})}dispose(){this.disposed||(this.disposed=!0,this.animationGroup.onAnimationGroupLoopObservable.remove(this.onAnimLoopObs),this.animationGroup.onAnimationGroupEndObservable.remove(this.onAnimEndObs),this.scene.onBeforeAnimationsObservable.remove(this.onAnimTickObs))}}class _Te{constructor(e,t,r,i){Object.defineProperty(this,"curScene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"curAnimation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"curAnimListName",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"inTransition",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"animLists",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loopType",{enumerable:!0,configurable:!0,writable:!0,value:"list"}),Object.defineProperty(this,"fadeTime",{enumerable:!0,configurable:!0,writable:!0,value:.25}),Object.defineProperty(this,"defaultEase",{enumerable:!0,configurable:!0,writable:!0,value:"linear"}),this.curScene=t,this.animLists=e,this.curAnimation=r??null,this.defaultEase=i??"linear"}getCurrentAnimation(){return this.curAnimation}updateAnimationLists(e){this.animLists=e}playRandom(e,t=0,r="list",i=this.defaultEase){const a=this.getRandomAnim(e);a&&(this.curAnimListName=e,this.fadeTime=t,this.loopType=r,this.curAnimation&&t>0?this.crossfadeAnim(a,t,r,i):this.playAnim(a,r))}playRandomPromise(e,t=0,r=0,i=this.defaultEase){return new Promise((a,o)=>{const s=this.getRandomAnim(e);s&&(this.curAnimListName=e);const c=s??this.curScene.getAnimationGroupByName(e);if(c&&c!==this.curAnimation?this.curAnimation&&t>0?this.crossfadeAnim(c,t,r,i):this.playAnim(c,r):a(null),!this.curAnimation){a(null);return}const u=p=>{var g;this.curAnimation!==p&&(w.log("animation-system","dev",`Animation interrupted: ${p.name} was replaced by ${((g=this.curAnimation)==null?void 0:g.name)??"unknown"}`),a(p),f.dispose())},h=p=>{this.curAnimation===p&&(f.dispose(),r==="list"?setTimeout(()=>{this.playRandomPromise(e,t,r,i).then(a,o)},0):a(p))},f=new xTe(this.curScene,this.curAnimation,t,r,u,h)})}onBeforeSceneAnim(){}playAnim(e,t="list"){this.loopType=t;const r=this.curAnimation;this.stopAnim(r);const i=e;i.reset(),i.weight=1;const a=t!=="none"&&t!==0;this.curAnimation=this.startAnim(i,a),w.log("animation-system","dev",this.curAnimation)}crossfadeAnim(e,t=0,r="list",i=this.defaultEase){this.fadeTime=t,this.inTransition=!0;const a=e,o=this.curAnimation;if(!o){this.playAnim(e,r);return}const s=o.weight;o.speedRatio=0,o.goToFrame(o.to);let c=0;if(a===o){this.inTransition=!1;return}const u=this.curScene;a.weight=0;const h=this.startAnim(a,!0,void 0,a.from,a.to);this.curAnimation=h,this.loopType=r;const f=this.curScene.onBeforeAnimationsObservable.add(()=>{if(this.curAnimation!==h){this.fadeOut(h),this.curAnimation!==o&&this.fadeOut(o),u.onBeforeAnimationsObservable.remove(f);return}this.inTransition=!0;const p=t>0?c/t:1,g=DF(i)(p),v=s*(1-g);if(g===1&&v===0||p>=1){u.onBeforeAnimationsObservable.remove(f),a.weight=1,o.weight=0,o!==this.curAnimation&&this.stopAnim(o),this.inTransition=!1;return}a.weight=g,o.weight=v,c+=u.deltaTime*.001})}fadeOut(e,t){return new Promise(r=>{if(!this.curAnimation){r();return}const i=e,a=t??.25,o=this.curScene.onBeforeAnimationsObservable.add(()=>{const s=i.weight;if(s<=0){w.warn("animation-system","dev","fadeOut called on animation with non-positive weight."),this.stopAnim(e),this.curScene.onBeforeAnimationsObservable.remove(o),r();return}const c=Math.max(0,s-this.curScene.deltaTime*.001*(1/a));i.weight=c,c<=0&&(this.stopAnim(e),this.curScene.onBeforeAnimationsObservable.remove(o),r())})})}getRandomAnim(e){const t=this.animLists.get(e);return(t==null?void 0:t.random())??null}startAnim(e,t,r,i,a,o){return w.log("animation-system","dev","ANIM: ",e.name),e.start(t??!0,r??1,i??e.from,a??e.to,o??!1)}stopAnim(e){const t=e;t&&(t.weight=0,t.stop())}}function MTe(n,e,t,r){if(!n)return;const{Vector3:i}=he.getCore(),a=n;if(e.position&&a.position){const o=i.FromArray(e.position);t==="additive"?a.position.addInPlace(o):a.position.copyFrom(o),w.log("behaviors","dev",`Applied position ${JSON.stringify(e.position)} to node "${a.name??"unknown"}" (${t})`)}if(e.rotation&&a.rotation){const o=i.FromArray(e.rotation);t==="additive"?a.rotation.addInPlace(o):a.rotation.copyFrom(o),w.log("behaviors","dev",`Applied rotation ${JSON.stringify(e.rotation)} to node "${a.name??"unknown"}" (${t})`)}if(e.scale&&a.scaling){const o=i.FromArray(e.scale);t==="additive"?a.scaling.multiplyInPlace(o):a.scaling.copyFrom(o),w.log("behaviors","dev",`Applied scale ${JSON.stringify(e.scale)} to node "${a.name??"unknown"}" (${t})`)}if(e.parent!==void 0)if(e.parent==="")a.parent=null,w.log("behaviors","dev",`Removed parent from node "${a.name??"unknown"}"`);else{const o=Ix(r,e.parent);o?(a.parent=o,w.log("behaviors","dev",`Set parent of node "${a.name??"unknown"}" to "${e.parent}"`)):w.warn("behaviors","dev",`Parent node "${e.parent}" not found for node "${a.name??"unknown"}"`)}}function RTe(n,e,t){for(const[r,i]of Object.entries(n)){const a=Ix(e,r);a?MTe(a,i,t,e):w.warn("behaviors","dev",`Node "${r}" not found in scene for transform set`)}}function PTe(n,e){var t;try{const i=(t=(e==null?void 0:e.app).characterManager)==null?void 0:t.currentCharacter;if(!(i!=null&&i.transformSets))return w.warn("behaviors","dev","No transform sets available - ensure they were loaded by ContentManager during character initialization"),null;const a=i.transformSets.find(o=>o.name===n);return a?[a.nodes]:(w.warn("behaviors","dev",`Transform set "${n}" not found. Available sets: ${i.transformSets.map(o=>o.name).join(", ")}`),null)}catch(r){return w.error("behaviors","dev",`Error resolving named transform set "${n}": ${r instanceof Error?r.message:String(r)}`),null}}function NTe(n){var i;const e=n.params,t=(i=n.frameContext)==null?void 0:i.scene;if(!t){w.warn("behaviors","dev","Apply transform set action requires a valid scene.");return}if(!e.transformSet){w.warn("behaviors","dev","Apply transform set action requires a transformSet parameter.");return}const r=e.blendMode??"replace";try{let a;if(typeof e.transformSet=="string"){const o=PTe(e.transformSet,n.frameContext);if(!o)return;a=o}else a=e.transformSet;for(const o of a)RTe(o,t,r);w.log("behaviors","dev",`Successfully applied ${a.length} transform set(s) with blend mode: ${r}`)}catch(a){w.error("behaviors","dev",`Failed to apply transform sets: ${a instanceof Error?a.message:String(a)}`)}}function OTe(n){var E;const e=n.params??{},t=(E=n.frameContext)==null?void 0:E.scene;if(!t){w.warn("behaviors","dev","attach-to-bone: missing scene.");return}const r=e.child,i=e.parent;if(!r||!i){w.warn("behaviors","dev","attach-to-bone: 'child' and 'parent' parameters are required.");return}const a=e.bone,o=e.holderName,s=e.renderingGroupId,c=e.overwrite===!0,u=e.hide===!0,h=t.getNodeByName(r);if(!h){w.warn("behaviors","dev",`attach-to-bone: child node '${r}' not found.`);return}const f=t.getNodeByName(i);if(!f){w.warn("behaviors","dev",`attach-to-bone: parent node '${i}' not found.`);return}const p=n.behavior,g=p.state??(p.state={}),v=g.__attachedNodes??(g.__attachedNodes={}),y=e.registryKey??r;if(!c&&v[y]){w.log("behaviors","dev",`attach-to-bone: '${y}' already attached (skipping).`);return}const b=he.getCore();let C;if(a){const T=f,A=T.skeleton;if(!A){w.warn("behaviors","dev",`attach-to-bone: parent '${i}' has no skeleton (bone='${a}').`);return}const I=A.bones.find(k=>k.name===a);if(!I){w.warn("behaviors","dev",`attach-to-bone: bone '${a}' not found on '${i}'.`);return}if(o){C=t.getTransformNodeByName(o),C??(C=new b.TransformNode(o,t));try{const k=C;if(typeof k.attachToBone=="function")k.attachToBone(I,T);else{w.warn("behaviors","dev",`attach-to-bone: holder '${o}' cannot attach to bone '${a}'.`);return}}catch(k){w.warn("behaviors","dev",`attach-to-bone: error attaching holder '${o}' to bone '${a}'.`,k);return}h.parent=C}else{const k=h;if(typeof k.attachToBone=="function")try{k.attachToBone(I,T)}catch(x){w.warn("behaviors","dev",`attach-to-bone: failed attaching child='${r}' to bone='${a}'.`,x);return}else{w.warn("behaviors","dev",`attach-to-bone: child '${r}' lacks attachToBone; provide holderName.`);return}C=h}}else o?(C=t.getTransformNodeByName(o),C??(C=new b.TransformNode(o,t)),C.parent=f,h.parent=C):(h.parent=f,C=h);if(typeof s=="number"){const T=h;"renderingGroupId"in T&&(T.renderingGroupId=s)}if(u===!0){const T=h;"isVisible"in T&&(T.isVisible=!1)}v[y]=C;const S=p.eventManager;S&&S.emit({system:"app",name:"attach-node-complete",payload:{registryKey:y,child:r,parent:i,bone:a??null,holderName:o??null}}),w.log("behaviors","dev",`attach-to-bone: attached '${r}' under '${i}'${a?` bone='${a}'`:""}${o?` via holder='${o}'`:""} (registry='${y}').`)}function LTe(n){const{path:e,configIndex:t,animLibraryFile:r}=n.params,{frameContext:i}=n,{scene:a,app:o}=i??{};if(!i||!o||!a||!e||e===""){w.warn("behaviors","dev","LoadAnimations action requires a valid scene, app, and path.");return}o.importAnimations(e,t??0,r).then(()=>{const s=n.behavior,c=s==null?void 0:s.eventManager;c&&typeof c.emit=="function"&&c.emit({system:"app",name:"load-animations-complete",payload:{path:e,configIndex:t??0}})}).catch(s=>{w.error("behaviors","dev",`Failed to load animations from path "${e}": ${s instanceof Error?s.message:String(s)}`)})}const jg="__root__",ZN=new Set;function DTe(n){var f,p,g,v;const e=he.getCore(),t=n.params,r=(f=n.frameContext)==null?void 0:f.scene;if(!r||!t.path||t.path===""){w.warn("behaviors","dev","LoadMeshes action requires a valid scene and path.");return}const i=[],a=r.getMeshByName(jg),o=t.parentNode?Ix(r,t.parentNode):a,s=t.parentBone;let c;if(s&&o instanceof e.AbstractMesh){const y=o.skeleton,b=y==null?void 0:y.bones;b?(c=b.find(C=>C.name===s),c||w.warn("behaviors","dev",`loadMeshes: parentBone "${s}" not found on skeleton of parentNode "${t.parentNode}".`)):w.warn("behaviors","dev",`loadMeshes: parentBone "${s}" requested but parentNode has no skeleton.`)}const u=(g=(p=n.frameContext)==null?void 0:p.app)==null?void 0:g.contentManager,h=u?u.importMeshWithDependencies(r,t.path,((v=n.frameContext)==null?void 0:v.shaderManager)??void 0).then(({meshData:y,wasAlreadyLoaded:b})=>({meshData:b?void 0:y,wasAlreadyLoaded:b})):e.ImportMeshAsync(t.path,r,{meshNames:t.meshNames??""}).then(y=>({meshData:y,wasAlreadyLoaded:!1}));u&&t.meshNames&&!ZN.has(t.path)&&(ZN.add(t.path),w.warn("behaviors","dev",`loadMeshes: meshNames filtering requested for "${t.path}" but cached ContentManager path always loads full asset. Filtering will be emulated post-load only.`)),h.then(({meshData:y,wasAlreadyLoaded:b})=>{if(b){const A=n.behavior,I=A==null?void 0:A.eventManager;I&&typeof I.emit=="function"&&I.emit({system:"app",name:"load-meshes-complete",payload:{path:t.path,result:{},wasAlreadyLoaded:!0}});return}if(!y){w.warn("behaviors","dev",`loadMeshes: No meshData returned for path "${t.path}".`);return}const C=y.meshes.find(A=>A.name===jg);if(!C){w.warn("behaviors","dev",`No root mesh named "${jg}" found in loaded meshes for "${t.path}".`);return}i.push(C);const S=C.getChildren();if(!t.meshNames)for(const A of S){const I=A;c&&I instanceof e.AbstractMesh&&o instanceof e.TransformNode?I.attachToBone(c,o):A.parent=o,(A instanceof e.TransformNode||A instanceof e.AbstractMesh)&&"position"in A&&A.position.addInPlace(e.Vector3.FromArray(t.positionOffset??[0,0,0]))}for(const A of y.meshes)if(A.name!==jg){if(t.meshNames){const I=A;c&&o instanceof e.TransformNode?I.attachToBone(c,o):A.parent=o,A.position.addInPlace(e.Vector3.FromArray(t.positionOffset??[0,0,0]))}A.isVisible=t.visibility??!0,A.renderingGroupId=t.renderingGroup??2}for(const A of i)A.dispose();const E=n.behavior,T=E==null?void 0:E.eventManager;T&&typeof T.emit=="function"&&T.emit({system:"app",name:"load-meshes-complete",payload:{path:t.path,result:y,wasAlreadyLoaded:!1}})}).catch(y=>{w.error("behaviors","dev",`Failed to load meshes from path "${t.path}": ${y instanceof Error?y.message:String(y)}`)})}function FF(n){const{eventManager:e}=n.behavior,t=n.params;e&&typeof e.emit=="function"&&e.emit({system:t.system??"app",name:t.name,payload:t.data??{}})}function jTe(n){return typeof n=="object"&&n!==null&&"message"in n&&typeof n.message=="string"?n.message:String(n)}function UTe(n){var i,a;const e=n.params,{easing:t}=e,r=(a=(i=n.frameContext)==null?void 0:i.animator)==null?void 0:a.playRandomPromise(e.name??"",e.transition??.5,e.loopCount??0,t);r==null||r.then(()=>{const o=n.behavior,s=o==null?void 0:o.eventManager;s&&typeof s.emit=="function"&&s.emit({system:"animation",name:`animation-complete-event-${e.name}`,payload:{name:e.name}})}).catch(o=>{const s=jTe(o);w.error("behaviors","dev",`Failed to play animation "${e.name}": setAnimationHandler failed: ${s}`)})}function FTe(n){const{state:e,random:t,immediately:r=!1}=n.params;if(typeof e=="string"){const i=n.behavior,a=i==null?void 0:i.eventManager;a&&typeof a.emit=="function"&&a.emit({system:"animationState",name:"transitionTo",payload:{stateName:e,random:t}},r?"immediate":"next-frame")}}function BTe(n){const e=n.params,t=n.behavior,r=t==null?void 0:t.eventManager;r&&typeof r.emit=="function"&&r.emit({system:"billboard",name:"update",payload:{name:e.name??"defaultBillboard",x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation,alpha:e.alpha,textureRef:e.texture,visibility:e.visibility}})}function BF(n){const e=n.params;e.text&&w.log("behaviors","dev",`Debug: ${e.text}`)}function HF(n){var i,a,o;const e=n.params,{visible:t}=e,r=(i=n.frameContext)==null?void 0:i.scene;typeof t=="boolean"&&r&&((o=(a=n.frameContext)==null?void 0:a.app)==null||o.setMeshVisibility(t,e.meshes))}function HTe(n){const e=n.params,t=n.behavior,r=t==null?void 0:t.eventManager;if(!r){w.warn("stopBillboardHandler: EventManager not available","editor");return}if(e.stopAll===!0){r.emit({system:"billboard",name:"stop",payload:{name:"",stop:"all"}});return}if(e.billboards&&e.billboards.length>0)for(const i of e.billboards)r.emit({system:"billboard",name:"stop",payload:{name:i.name,stop:!0}})}function $Te(n){const e=n.params,t=n.behavior,r=t==null?void 0:t.eventManager;if(r)for(const i of e.billboards){const a={name:i.name};i.tweens&&i.tweens.length>0&&(a.tweens=i.tweens.map(o=>({billboardName:i.name,property:o.property,from:o.from,to:o.to,duration:o.duration,easing:o.easing??"linear",delay:o.delay??0,onComplete:o.onComplete}))),i.wiggle&&(a.wiggle={billboardName:i.name,property:i.wiggle.property,amount:i.wiggle.amount??.005,speed:i.wiggle.speed??1,pattern:i.wiggle.pattern??"random",easing:i.wiggle.easing??"easeInOutSine",phaseOffset:i.wiggle.phaseOffset??0,center:i.wiggle.center,decay:i.wiggle.decay,intensity:i.wiggle.intensity,variation:i.wiggle.variation}),i.wiggles&&i.wiggles.length>0&&(a.wiggles=i.wiggles.map(o=>({billboardName:i.name,property:o.property,amount:o.amount??.005,speed:o.speed??1,pattern:o.pattern??"random",easing:o.easing??"easeInOutSine",phaseOffset:o.phaseOffset??0,center:o.center,decay:o.decay,intensity:o.intensity,variation:o.variation}))),(a.tweens??a.wiggle??a.wiggles)&&r.emit({system:"billboard",name:"tween",payload:a})}}function zTe(n){return typeof n=="object"&&n!==null&&"$schema"in n&&"$schemaVersion"in n&&"fsms"in n&&typeof n.fsms=="object"}function VTe(n){return typeof n=="object"&&n!==null&&"$schema"in n&&"$schemaVersion"in n&&"metadata"in n&&"subgraph"in n&&typeof n.subgraph=="object"}function Aw(n){return"source"in n}function GTe(n){return"subgraph"in n}const Ug="1.0.0",XN="https://schemas.copilot.com/subgraph/v1.0.0";class KTe{constructor(e="./subgraphs"){Object.defineProperty(this,"subgraphCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"templateCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"hotSwapListeners",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"loadingPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"marketplaceCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"basePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.basePath=e}async loadSubgraph(e){const t=this.subgraphCache.get(e);if(t)return w.log("subgraph","dev",`Using cached subgraph: ${e}`),t;const r=this.loadingPromises.get(e);if(r)return w.log("subgraph","dev",`Waiting for in-progress load: ${e}`),r;const i=this.doLoadSubgraph(e);this.loadingPromises.set(e,i);try{const a=await i;return this.subgraphCache.set(e,a),w.log("subgraph","dev",`Loaded and cached subgraph: ${e}`),a}catch(a){throw w.error("subgraph","dev",`Failed to load subgraph ${e}:`,a),a}finally{this.loadingPromises.delete(e)}}async doLoadSubgraph(e){try{const t=this.resolvePath(e),r=await fetch(t);if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const i=await r.json();if(!VTe(i))throw new Error(`Invalid subgraph definition format in ${e}`);this.validateSchemaVersion(i,e);const a=this.validateSubgraphDefinition(i);if(!a.valid){const o=a.errors.map(s=>s.message).join(", ");throw new Error(`Subgraph validation failed: ${o}`)}return w.log("subgraph","dev",`Successfully loaded subgraph "${i.metadata.name}" v${i.metadata.version}`),i}catch(t){throw w.error("subgraph","dev",`Error loading subgraph from ${e}:`,t),t}}getSubgraph(e){return this.subgraphCache.get(e)}resolvePath(e){return e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("./")||!e.includes("/")?`${this.basePath}/${e}`:e}instantiateSubgraph(e,t){if(e.parameters&&!this.validateParameters(t,e.parameters))throw new Error(`Parameter validation failed for subgraph "${e.metadata.name}"`);const r={parameters:t,context:{},returns:{}},i={definition:e,parameters:t,currentState:e.subgraph.initial,stack:[],returnValues:{},templateContext:r};return w.log("subgraph","dev",`Instantiated subgraph "${e.metadata.name}" with initial state "${i.currentState}"`),i}executeSubgraphStep(e,t){try{const{definition:r,currentState:i}=e,a=r.subgraph.states[i];if(!a)return{completed:!1,error:{code:"INVALID_STATE",message:`State "${i}" not found in subgraph "${r.metadata.name}"`,details:{currentState:i,availableStates:Object.keys(r.subgraph.states)}}};if(t&&r.subgraph.transitions){const o=this.findMatchingTransition(r.subgraph.transitions,i,t);if(o)return this.executeTransition(e,o)}if(a.onTick){const o=this.executeStateActions(e,a.onTick);if(o)return o}return this.isTerminalState(r,i)?{completed:!0,returnValues:e.returnValues}:{completed:!1}}catch(r){return w.error("subgraph","dev","Error executing subgraph step:",r),{completed:!1,error:{code:"EXECUTION_ERROR",message:r instanceof Error?r.message:"Unknown execution error",details:{context:e.currentState}}}}}findMatchingTransition(e,t,r){return e.find(i=>i.from===t&&i.on.system===r.system&&i.on.name===r.name)}executeTransition(e,t){const{definition:r}=e,i=e.currentState;if(t.actions){const a=this.executeStateActions(e,t.actions);if(a!=null&&a.error)return a}if(t.to){if(!r.subgraph.states[t.to])return{completed:!1,error:{code:"INVALID_TRANSITION_TARGET",message:`Target state "${t.to}" not found`,details:{from:i,to:t.to}}};e.currentState=t.to,w.log("subgraph","dev",`Subgraph transition: "${i}" -> "${t.to}" on ${t.on.system}:${t.on.name}`);const a=r.subgraph.states[t.to];if(a!=null&&a.onEnter){const o=this.executeStateActions(e,a.onEnter);if(o!=null&&o.error)return o}return{completed:!1,nextState:t.to}}return t.toExternal?{completed:!0,returnValues:e.returnValues,nextState:t.toExternal}:{completed:!1}}executeStateActions(e,t){for(const r of t)try{const i=this.processActionParameters(r.params??{},e.templateContext);r.name==="return-value"?this.handleReturnValueAction(e,i):r.name==="set-parameter"?this.handleSetParameterAction(e,i):w.log("subgraph","dev",`Subgraph action: ${r.name} with params:`,i)}catch(i){return w.error("subgraph","dev",`Error executing action ${r.name}:`,i),{completed:!1,error:{code:"ACTION_EXECUTION_ERROR",message:`Failed to execute action "${r.name}": ${i instanceof Error?i.message:"Unknown error"}`,details:{action:r.name,params:r.params}}}}}handleReturnValueAction(e,t){for(const[r,i]of Object.entries(t))e.returnValues[r]=i,e.templateContext.returns[r]=i;w.log("subgraph","dev","Set return values:",t)}handleSetParameterAction(e,t){for(const[r,i]of Object.entries(t))e.parameters[r]=i,e.templateContext.parameters[r]=i;w.log("subgraph","dev","Updated parameters:",t)}isTerminalState(e,t){return e.subgraph.transitions?!e.subgraph.transitions.some(r=>r.from===t):!0}validateParameters(e,t){try{return this.doValidateParameters(e,t,"")}catch(r){return w.error("subgraph","dev","Parameter validation error:",r),!1}}doValidateParameters(e,t,r){if(t.type==="object"&&typeof e!="object")return w.warn("subgraph","dev",`Type mismatch at ${r}: expected object, got ${typeof e}`),!1;if(t.type==="array"&&!Array.isArray(e))return w.warn("subgraph","dev",`Type mismatch at ${r}: expected array, got ${typeof e}`),!1;if(t.type==="string"&&typeof e!="string")return w.warn("subgraph","dev",`Type mismatch at ${r}: expected string, got ${typeof e}`),!1;if(t.type==="number"&&typeof e!="number")return w.warn("subgraph","dev",`Type mismatch at ${r}: expected number, got ${typeof e}`),!1;if(t.type==="boolean"&&typeof e!="boolean")return w.warn("subgraph","dev",`Type mismatch at ${r}: expected boolean, got ${typeof e}`),!1;if(t.enum&&!t.enum.includes(e))return w.warn("subgraph","dev",`Value at ${r} not in allowed enum values: ${String(t.enum)}`),!1;if(t.type==="string"&&t.pattern&&typeof e=="string"&&!new RegExp(t.pattern).test(e))return w.warn("subgraph","dev",`String at ${r} does not match pattern: ${t.pattern}`),!1;if(t.type==="object"&&t.properties&&typeof e=="object"&&e!==null){const i=e;if(t.required){for(const a of t.required)if(!(a in i))return w.warn("subgraph","dev",`Missing required property: ${r}.${a}`),!1}for(const[a,o]of Object.entries(t.properties))if(a in i&&!this.doValidateParameters(i[a],o,`${r}.${a}`))return!1}if(t.type==="array"&&t.items&&Array.isArray(e)){for(let i=0;i<e.length;i++)if(!this.doValidateParameters(e[i],t.items,`${r}[${i}]`))return!1}return!0}processTemplate(e,t){const r=`${e}:${JSON.stringify(t)}`,i=this.templateCache.get(r);if(i)return i;try{let a=e;return a=a.replace(/\{\{parameters\.([^}]+)\}\}/g,(o,s)=>{const c=this.getNestedValue(t.parameters,s);return c!==void 0?typeof c=="object"&&c!==null&&typeof c!="function"?JSON.stringify(c):String(c):o}),a=a.replace(/\{\{context\.([^}]+)\}\}/g,(o,s)=>{const c=this.getNestedValue(t.context,s);return c!==void 0?typeof c=="object"&&c!==null&&typeof c!="function"?JSON.stringify(c):String(c):o}),a=a.replace(/\{\{returns\.([^}]+)\}\}/g,(o,s)=>{const c=this.getNestedValue(t.returns??{},s);return c!==void 0?typeof c=="object"&&c!==null&&typeof c!="function"?JSON.stringify(c):String(c):o}),this.templateCache.set(r,a),a}catch(a){return w.error("subgraph","dev",`Template processing error for "${e}":`,a),e}}processActionParameters(e,t){const r={};for(const[i,a]of Object.entries(e))typeof a=="string"?r[i]=this.processTemplate(a,t):typeof a=="object"&&a!==null?r[i]=this.processObjectParameters(a,t):r[i]=a;return r}processObjectParameters(e,t){if(Array.isArray(e))return e.map(r=>this.processObjectParameters(r,t));if(typeof e=="object"&&e!==null){const r={};for(const[i,a]of Object.entries(e))r[i]=this.processObjectParameters(a,t);return r}else return typeof e=="string"?this.processTemplate(e,t):e}getNestedValue(e,t){return t.split(".").reduce((r,i)=>r&&typeof r=="object"?r[i]:void 0,e)}hotSwapSubgraph(e,t){return new Promise((r,i)=>{try{const a=this.validateSubgraphDefinition(t);if(!a.valid)throw new Error(`Invalid subgraph definition: ${a.errors.map(s=>s.message).join(", ")}`);this.subgraphCache.set(e,t);const o=this.hotSwapListeners.get(e)??[];for(const s of o)try{s(t)}catch(c){w.error("subgraph","dev","Hot-swap listener error:",c)}w.log("subgraph","dev",`Hot-swapped subgraph "${t.metadata.name}" v${t.metadata.version}`),r()}catch(a){w.error("subgraph","dev",`Hot-swap failed for ${e}:`,a),i(a instanceof Error?a:new Error(String(a)))}})}onHotSwap(e,t){const r=this.hotSwapListeners.get(e)??[];r.push(t),this.hotSwapListeners.set(e,r)}getMarketplaceInfo(e){return this.marketplaceCache.get(e)}updateMarketplaceInfo(e,t){this.marketplaceCache.set(e,t)}validateSchemaVersion(e,t){e.$schema!==XN&&w.warn("subgraph","dev",`Schema URL mismatch in ${t}: expected ${XN}, got ${e.$schema}`),e.$schemaVersion!==Ug&&w.warn("subgraph","dev",`Schema version mismatch in ${t}: expected ${Ug}, got ${e.$schemaVersion}`)}validateSubgraphDefinition(e){const t=[],r=[];return e.metadata?(e.metadata.name||t.push({code:"MISSING_NAME",message:"Subgraph metadata missing name",path:"metadata.name"}),e.metadata.version||t.push({code:"MISSING_VERSION",message:"Subgraph metadata missing version",path:"metadata.version"})):t.push({code:"MISSING_METADATA",message:"Subgraph definition missing metadata",path:"metadata"}),e.subgraph?(e.subgraph.initial||t.push({code:"MISSING_INITIAL_STATE",message:"Subgraph missing initial state",path:"subgraph.initial"}),!e.subgraph.states||Object.keys(e.subgraph.states).length===0?t.push({code:"MISSING_STATES",message:"Subgraph missing states",path:"subgraph.states"}):e.subgraph.initial&&!e.subgraph.states[e.subgraph.initial]&&t.push({code:"INVALID_INITIAL_STATE",message:`Initial state "${e.subgraph.initial}" not found in states`,path:"subgraph.initial"})):t.push({code:"MISSING_SUBGRAPH",message:"Subgraph definition missing subgraph property",path:"subgraph"}),{valid:t.length===0,errors:t,warnings:r,compatibility:{supported:!0,requiredVersion:Ug,recommendedVersion:Ug}}}clearCaches(){this.subgraphCache.clear(),this.templateCache.clear(),this.marketplaceCache.clear(),w.log("subgraph","dev","Cleared all subgraph caches")}getCacheStats(){return{subgraphs:this.subgraphCache.size,templates:this.templateCache.size,marketplace:this.marketplaceCache.size,loadingPromises:this.loadingPromises.size}}}class Gp extends Qb{constructor(e,t,r,i="start",a,o="./subgraphs"){let s,c;zTe(e)?(c=e,s=Gp.convertEnhancedToLegacyStatic(e),w.log("fsm","dev","Using enhanced FSM definition with subgraph support")):(s=e,w.log("fsm","dev","Using legacy FSM definition format")),super(s,t,r,i,a),Object.defineProperty(this,"subgraphManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"activeSubgraphs",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"enhancedDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enhancedActionHandlers",{enumerable:!0,configurable:!0,writable:!0,value:{}}),this.enhancedDefinition=c,this.subgraphManager=new KTe(o),this.wrapActionHandlers(t),this.enhancedDefinition&&this.preloadSubgraphs()}static convertEnhancedToLegacyStatic(e){const t={};for(const[r,i]of Object.entries(e.fsms))t[r]={fsmId:i.fsmId,initial:i.initial,states:Gp.convertEnhancedStatesStatic(i.states),transitions:i.transitions.filter(a=>a.to??a.toExternal).map(a=>a.to?{from:a.from,to:a.to,on:a.on,actions:a.actions}:{from:a.from,toExternal:a.toExternal,on:a.on,actions:a.actions})};return t}static convertEnhancedStatesStatic(e){const t={};for(const[r,i]of Object.entries(e))t[r]={onEnter:i.onEnter,onExit:i.onExit,onTick:i.onTick,state:i.state,clearAnimations:i.clearAnimations,interactions:i.interactions};return t}wrapActionHandlers(e){for(const[t,r]of Object.entries(e)){const i=a=>r({params:a.params,frameContext:a.frameContext,deltaTime:a.deltaTime,behavior:a.behavior,state:a.state});this.enhancedActionHandlers[t]=i,this.actionHandlers[t]=a=>{const o={params:a.params,frameContext:a.frameContext,deltaTime:a.deltaTime,behavior:a.behavior,state:a.state,subgraphManager:this.subgraphManager};return i(o)}}}async preloadSubgraphs(){var t;if(!((t=this.enhancedDefinition)!=null&&t.subgraphs))return;const e=[];for(const[r,i]of Object.entries(this.enhancedDefinition.subgraphs))if(Aw(i)){const a=this.subgraphManager.loadSubgraph(i.source).then(()=>{w.log("fsm","dev",`Pre-loaded subgraph: ${r} from ${i.source}`)}).catch(o=>{w.error("fsm","dev",`Failed to pre-load subgraph ${r}:`,o)});e.push(a)}try{await Promise.all(e),w.log("fsm","dev","All subgraphs pre-loaded successfully")}catch(r){w.warn("fsm","dev","Some subgraphs failed to pre-load:",r)}}step(e,t){this.stepActiveSubgraphs(),this.handleStateSubgraphs(),super.step(e,t)}stepActiveSubgraphs(){for(const[e,t]of this.activeSubgraphs.entries())try{const r=this.subgraphManager.executeSubgraphStep(t,void 0);this.handleSubgraphResult(e,r)}catch(r){w.error("fsm","dev",`Error stepping subgraph ${e}:`,r),this.activeSubgraphs.delete(e)}}handleStateSubgraphs(){if(!this.enhancedDefinition)return;const e=this.getCurrentFsmKey(),t=this.getState(),r=this.enhancedDefinition.fsms[e];if(!r)return;const i=r.states[t];if(!(i!=null&&i.subgraph))return;const a=`${e}.${t}.${i.subgraph}`;this.activeSubgraphs.has(a)||this.startSubgraph(a,i.subgraph,i.parameters??{})}async startSubgraph(e,t,r){var i;try{if(!((i=this.enhancedDefinition)!=null&&i.subgraphs))throw new Error("No subgraphs defined in FSM");const a=this.enhancedDefinition.subgraphs[t];if(!a)throw new Error(`Subgraph "${t}" not found`);let o,s;if(Aw(a))o=await this.subgraphManager.loadSubgraph(a.source),s={...a.parameters,...r};else if(GTe(a))o=a.subgraph,s={...a.parameters,...r};else throw new Error(`Invalid subgraph instance type for "${t}"`);const c=this.subgraphManager.instantiateSubgraph(o,s);this.activeSubgraphs.set(e,c),w.log("fsm","dev",`Started subgraph: ${e}`);const u=this.subgraphManager.executeSubgraphStep(c,void 0);this.handleSubgraphResult(e,u)}catch(a){w.error("fsm","dev",`Failed to start subgraph ${e}:`,a)}}handleSubgraphResult(e,t){if(t.error){w.error("fsm","dev",`Subgraph ${e} error:`,t.error),this.activeSubgraphs.delete(e);return}if(t.completed&&(w.log("fsm","dev",`Subgraph ${e} completed with return values:`,t.returnValues),t.returnValues&&(this.state[`${e}_returns`]=t.returnValues),this.activeSubgraphs.delete(e),t.nextState&&w.log("fsm","dev",`Subgraph ${e} requests transition to: ${t.nextState}`)),t.events)for(const r of t.events)this.onEventManagerEvent(r)}registerEnhancedActionHandler(e,t){this.enhancedActionHandlers[e]=t,w.log("fsm","dev",`Registered enhanced action handler: ${e}`)}getSubgraphManager(){return this.subgraphManager}getActiveSubgraphs(){return new Map(this.activeSubgraphs)}async hotSwapSubgraph(e,t){var i;await this.subgraphManager.hotSwapSubgraph(e,t);const r=[];for(const[a,o]of this.activeSubgraphs.entries())if((i=this.enhancedDefinition)!=null&&i.subgraphs)for(const[s,c]of Object.entries(this.enhancedDefinition.subgraphs))Aw(c)&&c.source===e&&a.includes(s)&&r.push({id:a,context:o});for(const{id:a}of r)this.activeSubgraphs.delete(a),w.log("fsm","dev",`Restarting subgraph ${a} after hot-swap`)}getEnhancedDefinition(){return this.enhancedDefinition}isEnhanced(){return this.enhancedDefinition!==void 0}}function qTe(n,e,t,r,i){if(e&&typeof e=="object"&&"subscribe"in e){const a=n,o=e,s=t,c=new Gp(a,{"apply-transform-set":NTe,"set-animation":UTe,"set-animation-state":FTe,"set-visibility":HF,"set-billboard":BTe,"debug-text":BF,"tween-billboard":$Te,"stop-billboard":HTe,"load-animations":LTe,"load-meshes":DTe,"attach-to-bone":OTe,"send-event":FF},o,"start",s);return o.subscribe("app",c.onEventManagerEvent.bind(c)),o.subscribe("animation",c.onEventManagerEvent.bind(c)),o.subscribe("behavior-action",c.onActionEventManagerEvent.bind(c)),c}else{const a=n,o=e,s=t,c="start",u=i;return new Gp(a,o,s,c,u)}}class WTe{constructor(){Object.defineProperty(this,"faceMesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mouthMesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bodyControl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"faceControl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mouthControl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"jawControl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eyesControl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"browControl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eyeMeshes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"browMeshes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mouthMorphTargets",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.faceMesh=null,this.mouthMesh=null,this.bodyControl=null,this.faceControl=null,this.eyesControl=null,this.browControl=null,this.mouthControl=null,this.jawControl=null,this.mouthMorphTargets=[],this.eyeMeshes=[],this.browMeshes=[]}}function YTe(n,e,t,r=1){var o;if(!n)return;const{Lerp:i}=he.getMath(),a=(o=n.morphTargetManager)==null?void 0:o.getTargetByName(e);a&&(a.influence=i(a.influence,t,r))}const QTe={left:[{targetName:"BS_Eyebrow_L.Eyebrow_L_Down",expressionKey:"eyebrow_bend"}],right:[{targetName:"BS_Eyebrow_R.Eyebrow_R_Down",expressionKey:"eyebrow_bend"}]},JTe={left:[{targetName:"BS_Eye_L.Geo_Eye_BlinkUp",expressionKey:"eye_BlinkUp"},{targetName:"BS_Eye_L.Geo_Eye_Squint",expressionKey:"eye_Squint"},{targetName:"BS_Eye_L.Geo_Eye_RSquare",expressionKey:"eye_RSquare"}],right:[{targetName:"BS_Eye_R.Geo_Eye_BlinkUp",expressionKey:"eye_BlinkUp"},{targetName:"BS_Eye_R.Geo_Eye_Squint",expressionKey:"eye_Squint"},{targetName:"BS_Eye_R.Geo_Eye_RSquare",expressionKey:"eye_RSquare"}]};function eO(n,e,t,r=1){for(let i=0;i<e.length;i+=1){const a=e[i];if(!a)continue;const s=(n==="eyebrow"?QTe:JTe)[i===0?"left":"right"];for(const c of s){const{targetName:u,expressionKey:h}=c,f=t.expression[h];typeof f=="number"&&YTe(a,u,f,r)}}}function tO(n){const e=new Map;for(let t=0;t<n.length;t++){const r=n[t];r!==void 0&&e.set(r,t)}return e}class ZTe{constructor(e,t=!1){Object.defineProperty(this,"fullFacialEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"faceSettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"visemeData",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"vasaVisemeMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"a2eVisemeMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.faceSettings=e,this.fullFacialEnabled=t,this.vasaVisemeMapping=tO(e.modelShapeCollection.vasaexpression??[]),this.a2eVisemeMapping=tO(e.modelShapeCollection.a2e??[])}init(e){const t=new WTe;t.faceMesh=e.getMeshByName(this.faceSettings.faceMorph),t.mouthMesh=e.getMeshByName(this.faceSettings.mouthMorph??""),t.jawControl=e.getTransformNodeByName(this.faceSettings.jaw??""),t.bodyControl=e.getTransformNodeByName(this.faceSettings.bodyControl??""),t.faceControl=e.getTransformNodeByName(this.faceSettings.faceControl??""),t.mouthControl=e.getTransformNodeByName(this.faceSettings.mouthControl??""),t.eyesControl=e.getTransformNodeByName(this.faceSettings.eyesControl??""),t.browControl=e.getTransformNodeByName(this.faceSettings.browsControl??""),this.faceSettings.eyes&&this.faceSettings.eyes.length>0&&(t.eyeMeshes=this.faceSettings.eyes.map(r=>e.getMeshByName(r))),this.faceSettings.brows&&this.faceSettings.brows.length>0&&(t.browMeshes=this.faceSettings.brows.map(r=>e.getMeshByName(r))),this.visemeData=t}updateFace(e){var c;if(!this.visemeData)return;tt.onAnimationStart();const{Vector3:t,Quaternion:r}=he.getCore(),{Lerp:i}=he.getMath(),{blendWeight:a,data:o}=e,s=(c=this.visemeData.mouthMesh)==null?void 0:c.morphTargetManager;if(s){const u=o.type==="spda2e"?this.a2eVisemeMapping:this.vasaVisemeMapping;for(let h=0;h<s.numTargets;h+=1){const f=s.getTarget(h),p=u.get(f.name);if(p!==void 0){const g=o.expression.viseme[p]??0;f.influence=i(f.influence,g,a)}else f.influence=i(f.influence,0,a)}}if(this.fullFacialEnabled&&o.type==="vasa"){const{bodyControl:u,browControl:h,browMeshes:f,eyeMeshes:p}=this.visemeData;u&&(u.rotationQuaternion=r.Slerp(u.rotationQuaternion??r.Identity(),o.pose.rotation,a),u.position=t.Lerp(u.position,o.pose.translation,a)),h&&(h.position.y=i(h.position.y,o.expression.eyebrow_height,a)),eO("eyebrow",f,o,a),eO("eye",p,o,a)}}}class XTe{constructor(e,t,r){Object.defineProperty(this,"face",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateObs",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"ready",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"syncHandler",{enumerable:!0,configurable:!0,writable:!0,value:null}),e&&t&&(this.face=new ZTe(e,r["full-facial"])),this.scene=t}initFace(){this.face&&this.scene&&(this.face.init(this.scene),this.ready=!0,this.syncHandler&&this.runUpdateLoop())}setSyncHandler(e){this.syncHandler=e,this.ready&&this.runUpdateLoop()}runUpdateLoop(){var e,t;this.ready&&this.syncHandler&&(this.syncHandler.setReady(),this.updateObs&&((e=this.scene)==null||e.onAfterAnimationsObservable.remove(this.updateObs)),this.updateObs=((t=this.scene)==null?void 0:t.onAfterAnimationsObservable.add(()=>{var i,a;const r=(i=this.syncHandler)==null?void 0:i.getCurrentFrame();r&&((a=this.face)==null||a.updateFace(r))}))??null)}destroy(){var e;this.updateObs&&((e=this.scene)==null||e.onAfterAnimationsObservable.remove(this.updateObs),this.updateObs=null),this.syncHandler=null}}function Ax(n,e,t=[]){if(typeof n!="object"||n===null)return;const r=n;for(const i of Object.keys(r)){const a=r[i];typeof a=="object"&&a!==null&&"animationSequence"in a?e(a,[...t,i]):typeof a=="object"&&a!==null&&Ax(a,e,[...t,i])}}function eIe(n,e){let t=!0;const{animationSequence:r}=n;if(Array.isArray(r)){for(const[i,a]of r.entries())if(!(typeof a!="object"||a===null)){if("onSequenceEndEvent"in a){const o=a.onSequenceEndEvent;(typeof o!="object"||o===null||typeof o.name!="string")&&(w.error("character-system","dev",`State "${e.join("/")}" animationSequence[${i}].onSequenceEndEvent is ill-formatted: expected { name: string, value?: unknown }, got:`,o),t=!1)}if("onStartEvent"in a){const o=a.onStartEvent;(typeof o!="object"||o===null||typeof o.name!="string")&&(w.error("character-system","dev",`State "${e.join("/")}" animationSequence[${i}].onStartEvent is ill-formatted: expected { name: string, data?: unknown }, got:`,o),t=!1)}}}return t}const nO=["none","short","medium","long","extraLong"],rO=["linear","easeInOutCubic"];function tIe(n,e){let t=!0;const{animationSequence:r}=n;if(Array.isArray(r)){for(const[i,a]of r.entries())if(!(typeof a!="object"||a===null)){if("transition"in a){const{transition:o}=a;typeof o=="string"&&!nO.includes(o)&&(w.error("character-system","dev",`State "${e.join("/")}" animationSequence[${i}].transition has unknown value: "${o}". Allowed: ${nO.join(", ")}`),t=!1)}if("easing"in a){const{easing:o}=a;typeof o=="string"&&!rO.includes(o)&&(w.error("character-system","dev",`State "${e.join("/")}" animationSequence[${i}].easing has unknown value: "${o}". Allowed: ${rO.join(", ")}`),t=!1)}}}return t}function nIe(n){const e=new Set;return Ax(n,(t,r)=>{e.add(r.join("/"))}),e}function rIe(n){return typeof n=="object"&&n!==null&&Array.isArray(n.transitions)}function iIe(n){return(e,t)=>{let r=!0;if(rIe(e))for(const[i,a]of e.transitions.entries())typeof a.target=="string"&&!n.has(a.target)&&(w.error("character-system","dev",`State "${t.join("/")}" transitions[${i}].target "${a.target}" is not a valid state path.`),r=!1);return r}}function aIe(n){let e=!0;const t=nIe(n),r=[eIe,tIe,iIe(t)];return Ax(n,(i,a)=>{for(const o of r)o(i,a)||(e=!1)}),e}class oIe{constructor(e,t,r,i=!1){Object.defineProperty(this,"currentState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"animationStates",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"animator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nextState",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timingElapsed",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"currentTick",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"timingActive",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"activityCancelToken",{enumerable:!0,configurable:!0,writable:!0,value:0}),i&&aIe(e),this.animationStates=e,this.currentState=this.findInitialState(e)??{},this.animator=t,this.eventManager=r,this.eventManager&&(this.eventManager.subscribe("animationState",this.onEventManagerEvent.bind(this)),this.eventManager.subscribe("animationTransition",this.onAnimationTransitionEvent.bind(this)))}getAnimationStates(){return this.animationStates}transitionTo(e,t){w.log("animation-state","dev",`Transitioning to state: ${e}`);const{stateDef:r}=this.lookupState(e,t);return r&&(this.currentState=r),this.nextState=e,this.activateState()}activateState(){var e;return w.log("animation-state","dev",`Activating state: ${this.nextState??"(unknown)"}`),(e=this.currentState.timingSequence)!=null&&e.length?(this.timingElapsed=0,this.currentTick=0,this.timingActive=!0):this.timingActive=!1,this.activityCancelToken+=1,this.executeStateActivities(this.activityCancelToken)}onFrame(e){var t;if(this.timingActive&&((t=this.currentState.timingSequence)!=null&&t.length)){const r=this.timingElapsed;this.timingElapsed+=e,this.currentTick+=1;for(const i of this.currentState.timingSequence){let a=!1;if(typeof i.time=="number"?i.time>r&&i.time<=this.timingElapsed&&(a=!0):typeof i.tick=="number"&&i.tick===this.currentTick&&(a=!0),a){const o=typeof i.event=="string"?i.event:i.event.name,s=i.event.system??"animation";typeof i.time=="number"?w.log("animation-state","dev",`Triggered event '${o}' at time=${i.time}ms (elapsed=${this.timingElapsed.toFixed(1)}ms)`):typeof i.tick=="number"&&w.log("animation-state","dev",`Triggered event '${o}' at tick=${i.tick} (currentTick=${this.currentTick})`);const c=i.event.data;this.queueEvent(s,o,c)}}}}queueEvent(e,t,r){if(w.log("animation-state","dev",`Queuing event: ${e}: ${t}`,r),this.eventManager){const i={system:e,name:t,payload:r};this.eventManager.emit(i)}}nextStateName(e){if(!this.nextState||!e)return this.nextState;if(this.nextState.includes("/"))return this.nextState;const t=e[this.nextState];if(t&&typeof t=="object"){const r=Object.keys(t)[0];if(r)return`${this.nextState}/${r}`}return this.nextState}executeStateActivities(e){const t=this.currentState.animationSequence;return t!=null&&t.length?t.reduce((r,i)=>r.then(()=>e!==this.activityCancelToken?(w.log("animation-state","dev","Animation chain cancelled."),Promise.resolve()):(this.handleOnStartEvent(i),w.log("animation-state","dev",`Request Anim '${i.animationList}'`),this.animator.playRandomPromise(i.animationList,this.transitionDuration(i.transition??"medium"),typeof i.loopCount=="number"||i.loopCount==="forever"||i.loopCount==="list"||i.loopCount==="none"?i.loopCount:0,i.easing).then(()=>{i.onSequenceEndEvent&&(w.log("animation-state","dev",`Queuing onSequenceEndEvent: ${i.onSequenceEndEvent.name}`),this.handleOnSequenceEndEvent(i.onSequenceEndEvent.name))}).catch(o=>{typeof o=="object"&&o!==null&&"message"in o&&o.message==="Animation interrupted"||w.error("animation-state","dev","Animation step failed",o)}))),Promise.resolve()):Promise.resolve()}handleTransitionEvent(e){const{transitions:t}=this.currentState;if(t){const r=t.find(i=>i.event===e);if(r!=null&&r.target){if(this.nextState=r.target,this.eventManager){const i={system:"animationState",name:"transitionTo",payload:{stateName:this.nextState}};this.eventManager.emit(i)}w.log("animation-state","dev",`Transitioning to next state: ${this.nextState}`)}else w.log("animation-state","dev",`No transition found for event: ${e}`)}}handleOnSequenceEndEvent(e){this.queueEvent("animation",e),this.handleTransitionEvent(e)}onAnimationTransitionEvent(e){const t=e.name;this.handleTransitionEvent(t)}handleOnStartEvent(e){e.onStartEvent&&this.queueEvent("animation",e.onStartEvent.name)}findInitialState(e){let t=e;for(;t&&typeof t=="object"&&!("animationSequence"in t);){const r=Object.keys(t);if(!r.length)break;const i=r[0];if(i===void 0)break;t=t[i]}return t&&typeof t=="object"&&"animationSequence"in t?t:null}lookupState(e,t=!1){let r=this.animationStates,i;if(e.includes("/")){const a=e.split("/");if(a.length===2){const[o]=a,s=this.animationStates[o];s&&typeof s=="object"&&!("animationSequence"in s)&&(i=s)}for(const o of a)r&&typeof r=="object"&&(r=r[o])}else if(e in this.animationStates&&(r=this.animationStates[e],t&&r&&typeof r=="object"&&!("animationSequence"in r))){w.log("character-system","dev",`Randomly selecting state from group '${e}'`);const a=r,o=Object.keys(a).filter(s=>{const c=a[s];return c&&typeof c=="object"&&"animationSequence"in c});if(o.length>0){const s=Math.floor(Math.random()*o.length),c=o[s];c!==void 0&&(w.log("character-system","dev",`Randomly selected state '${c}' from group '${e}'`),r=a[c],i=this.animationStates[e])}}return r&&typeof r=="object"&&"animationSequence"in r?{stateDef:r,groupObj:i}:{stateDef:null,groupObj:i}}transitionDuration(e){switch(e){case"none":return 0;case"short":return .1;case"medium":return .25;case"long":return .5;case"extraLong":return 1;default:return .25}}onEventManagerEvent(e){if(e.name==="transitionTo"&&e.payload&&typeof e.payload=="object"&&"stateName"in e.payload){const t=e.payload;this.transitionTo(t.stateName,t.random)}}}function sIe(n,e,t,r=!1){return new oIe(n,e,t,r)}class cIe{static processAnimationGroups(e,t){const r=[];for(const i of e)t.includes(i.name)?(i.stop(),r.push(i)):i.weight=0;return r}}class lIe{static disposeResources(e){for(const t of e)t.dispose()}}class uIe{static importAnimations(e,t,r,i,a,o){if(!e)return;if(a){w.log("character","dev","[CharacterAnimationImporter] Mesh already loaded, skipping animation processing and updating character directly"),o(i);return}const s=r.animationGroups;if(!e.getSkeletonByName("skeleton0"))return;const u=cIe.processAnimationGroups(s,t);lIe.disposeResources(u),o(i)}}class dIe{constructor(e,t,r,i,a,o=!1){Object.defineProperty(this,"babylonCore",{enumerable:!0,configurable:!0,writable:!0,value:he.getCore()}),Object.defineProperty(this,"actAnimator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentCharacter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"characterSetup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"animationStateMachine",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"fsmBehavior",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"facialManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDebug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.scene=e,this.facialManager=new XTe(i.faceSettings,e,a),this.eventManager=t,this.characterSetup=r,this.currentCharacter=i,this.isDebug=o}updateCharacter(e=0){if(this.scene){const{scene:t}=this,r=new Map;if(typeof e=="string"?this.currentCharacter=this.characterSetup.getCharacterSettings(0):typeof e=="number"?this.currentCharacter=this.characterSetup.getCharacterSettings(e):this.currentCharacter=e,this.currentCharacter.animations)for(const a of this.currentCharacter.animations){const o=a.name;r.set(o,new kTe(a.animList,t))}const i=this.currentCharacter.animationSettings.defaultEase??"linear";this.actAnimator||(this.actAnimator=new _Te(r,t,void 0,i),t.onBeforeAnimationsObservable.add(()=>{var a;(a=this.actAnimator)==null||a.onBeforeSceneAnim()})),this.actAnimator.updateAnimationLists(r)}}importAnimations(e,t,r,i=!1){uIe.importAnimations(this.scene,e,t,r,i,a=>this.updateCharacter(a))}setState(e){this.eventManager.emit({system:"app",name:e,payload:void 0})}testState(e,t,r,i,a,o,s){if(!this.fsmBehavior)return;const c=(t==null?void 0:t.getDeltaTime())??0,u={app:null,engine:t,scene:r,camera:i,animator:this.actAnimator??null,environmentManager:a,interactionManager:o,shaderManager:s,effectsManager:null,poiManager:null};this.fsmBehavior.testState(e,u,c)}moveToPosition(e,t){typeof this.characterSetup.moveToPosition=="function"&&this.characterSetup.moveToPosition(e,t)}initializeAnimationAndBehavior(e,t,r){this.actAnimator&&(this.animationStateMachine=sIe(e,this.actAnimator,this.eventManager,this.isDebug)),this.fsmBehavior=qTe(t,this.eventManager,r)}initializeFace(){this.facialManager.initFace()}onFrame(e,t,r=!1){var i,a;r||((i=this.fsmBehavior)==null||i.step(e,t),(a=this.animationStateMachine)==null||a.onFrame(t))}}const pv={cameraRadius:.3,cameraAlpha:1.57,cameraBeta:1.57,cameraFov:.8,cameraTarget:[0,.08,0],groundSize:.18,groundOpacity:.5,lights:[{direction:[0,-.882,.471],intensity:4}]},hIe=new class{getCharacterSettings(){return FEe}getStage(){return Promise.resolve(pv)}load(){return Promise.resolve([])}setup(){}};async function Fg(n){const e=await fetch(n);if(!e.ok)throw new Error(`Failed to fetch JSON from ${n}: ${e.statusText}`);return e.json()}class fIe{constructor(){Object.defineProperty(this,"loadedMeshUrls",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"textureCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}async loadActmi(e){const t=typeof e=="string"?await Fg(e):e;return t||Promise.reject(new Error("Setting is not defined"))}async loadJson(e){try{const t=typeof e=="string"?await Fg(e):e;if(!t)throw Og.end("loadJson"),new Error("JSON data is not defined");return Og.end("loadJson"),t}catch(t){throw t}}async loadCharacterDependencies(e,t,r){tt.addTimingMark("loading","load-dependencies-start",!1);const i=typeof e.finiteStateMachine=="string"?Fg(e.finiteStateMachine).then(p=>(tt.addTimingMark("loading","fsm-loaded",!0,"load-dependencies-start"),p)):Promise.resolve(e.finiteStateMachine),a=typeof e.animationStates=="string"?Fg(e.animationStates).then(p=>(tt.addTimingMark("loading","animation-states-loaded",!0,"load-dependencies-start"),p)):Promise.resolve(e.animationStates),o=typeof e.transformSets=="string"?this.loadJson(e.transformSets).then(p=>(tt.addTimingMark("loading","transform-sets-loaded",!0,"load-dependencies-start"),p)):Promise.resolve(e.transformSets);if(!r)throw new Error("Scene is not defined");const s=t.load(r,e).then(p=>(tt.addTimingMark("loading","character-loaded",!0,"load-dependencies-start"),p)),c=await Promise.all([i,a,o,s]).catch(p=>{if(p instanceof Error)throw p});if(!c)throw new Error("Failed to load scene dependencies.");const[u,h,f]=c;return e.transformSets=f,{behaviors:u,animationStates:h}}async importMeshWithDependencies(e,t,r){const i=this.loadedMeshUrls.has(t),a=e.animationGroups.map(s=>s.name);if(i)return w.log("content","dev",`[ContentManager] Mesh already loaded, returning cached data for: ${t}`),{existingAnims:a,meshData:{},wasAlreadyLoaded:!0};w.log("content","dev",`[ContentManager] Loading new mesh: ${t}`);const o=await he.getCore().ImportMeshAsync(t,e);if(r)try{const s=new Set;for(const h of o.meshes){const f=h.material;if(f){const p=f;if(Array.isArray(p.subMaterials))for(const g of p.subMaterials)g&&s.add(g);else s.add(f)}}const c=[],u=[];for(const h of s)try{const f=r.registerExternalMaterial(h);c.push(f);for(const p of h.getActiveTextures())try{const g=r.registerExternalTexture(p);u.push(g)}catch(g){w.warn("content","dev",`[ContentManager] Failed to register external texture (material ${f}):`,g)}}catch(f){w.warn("content","dev","[ContentManager] Failed to register external material:",f)}w.log("content","dev",`[ContentManager] External asset registration for ${t}: materials=${c.length}, textures=${u.length}`,{materialIds:c,textureIds:u})}catch(s){w.warn("content","dev",`[ContentManager] External material/texture registration failed for ${t}`,s)}return this.loadedMeshUrls.add(t),w.log("content","dev",`[ContentManager] Mesh loaded and cached: ${t} (cache size: ${this.loadedMeshUrls.size})`),{existingAnims:a,meshData:o,wasAlreadyLoaded:!1}}isMeshLoaded(e){return this.loadedMeshUrls.has(e)}forceReloadMesh(e){this.loadedMeshUrls.delete(e)}clearMeshCache(){this.loadedMeshUrls.clear()}getCacheSize(){return this.loadedMeshUrls.size}async loadTexture(e,t,r=!0){if(this.textureCache.has(e))return w.log("content","dev",`[ContentManager] Texture already cached, returning for: ${e}`),this.textureCache.get(e);let i;if(r)try{const a=t.getTextureByName(e);if(a&&(i=a),i)return this.textureCache.set(e,i),w.log("content","dev",`[ContentManager] Reused existing scene texture for: ${e} (cache size: ${this.textureCache.size})`),Og.end(`loadTexture:${e}`),i}catch(a){w.warn("content","dev",`[ContentManager] Scene texture lookup failed for: ${e}`,a)}try{w.log("content","dev",`[ContentManager] Loading new texture: ${e}`);const{Texture:a}=he.getCore(),o=new a(e,t);return await new Promise((s,c)=>{if(o.isReady())s();else{o.onLoadObservable.addOnce(()=>s());const u=setTimeout(()=>{c(new Error(`Texture loading timeout: ${e}`))},1e4);o.onLoadObservable.addOnce(()=>{clearTimeout(u)})}}),this.textureCache.set(e,o),w.log("content","dev",`[ContentManager] Texture loaded and cached: ${e} (cache size: ${this.textureCache.size})`),Og.end(`loadTexture:${e}`),o}catch(a){throw w.error("content","dev",`[ContentManager] Failed to load texture: ${e}`,a),a}}isTextureCached(e){return this.textureCache.has(e)}forceReloadTexture(e){const t=this.textureCache.get(e);t&&(t.dispose(),this.textureCache.delete(e),w.log("content","dev",`[ContentManager] Removed texture from cache and disposed: ${e}`))}clearTextureCache(){for(const[e,t]of this.textureCache)t.dispose(),w.log("content","dev",`[ContentManager] Disposed cached texture: ${e}`);this.textureCache.clear(),w.log("content","dev","[ContentManager] Cleared entire texture cache")}getTextureCacheSize(){return this.textureCache.size}getCachedTexturePaths(){return Array.from(this.textureCache.keys())}getCacheInfo(){return{meshes:this.loadedMeshUrls.size,textures:this.textureCache.size,total:this.loadedMeshUrls.size+this.textureCache.size}}}function is(n){var r;const e=n.behavior;return e!=null&&e.state?(r=e.state).__effectBehaviorState??(r.__effectBehaviorState={}):void 0}function ao(n){var r;if(!(n!=null&&n.effect))return;const{effect:e}=n,t=((r=e.fsm.state)==null?void 0:r.scene)??e.scene;if(t)return{runtime:e,pool:e.pool,config:e.config,scene:t}}function pIe(n,e,t){if(t){if(t.emitterPosition&&"emitter"in e&&e.emitter){const r=e.emitter;typeof r=="object"&&(r.x=t.emitterPosition.x,r.y=t.emitterPosition.y,r.z=t.emitterPosition.z)}t.durationMs&&n.startTime&&(n.scheduledEndTime=n.startTime+t.durationMs)}}function Si(n,e){var r;const t=n.behavior;(r=t==null?void 0:t.onEventManagerEvent)==null||r.call(t,{system:"effects",name:e})}const mIe=n=>{is(n)&&(w.log("effects","dev","[complete-effect] Effect completed."),Si(n,"completed"))},gIe=n=>{var t;const e=is(n);if(e){if((t=e.activeInstances)!=null&&t.length){const r=performance.now(),i=ao(e);for(const a of e.activeInstances){try{"stop"in a.particleSystem&&a.particleSystem.stop()}catch{}try{a.particleSystem.dispose()}catch{}i==null||i.pool.releaseInstance(a,r)}e.activeInstances.length=0}e.effect&&(e.effect.disposed=!0),w.log("effects","dev","[dispose-effect] Disposed effect resources.")}},vIe=n=>{var t;const e=((t=n.params)==null?void 0:t.name)||"unknown";w.log("effects","dev",`[emit-effect-event] Emitting '${e}'.`),Si(n,e)};class iO{constructor(e){if(Object.defineProperty(this,"slots",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"createFn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onActivate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onRelease",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.createFn=e.create,this.onActivate=e.onActivate,this.onRelease=e.onRelease,e.prewarm&&e.prewarm>0)for(let t=0;t<e.prewarm;t++)this.slots.push({item:this.createFn(),state:"idle",lastUse:performance.now()})}acquire(){var r,i;const e=performance.now();for(const a of this.slots)if(a.state==="idle")return a.state="active",a.lastUse=e,(r=this.onActivate)==null||r.call(this,a.item),a.item;const t=this.createFn();return this.slots.push({item:t,state:"active",lastUse:e}),(i=this.onActivate)==null||i.call(this,t),t}release(e){var i;const t=performance.now(),r=this.slots.find(a=>a.item===e);r&&(r.state==="active"&&((i=this.onRelease)==null||i.call(this,r.item)),r.state="idle",r.lastUse=t)}size(){return this.slots.length}activeCount(){let e=0;for(const t of this.slots)t.state==="active"&&e++;return e}idleCount(){return this.size()-this.activeCount()}trim(e,t){let r=0;const i=[];for(const a of this.slots){if(a.state==="idle"&&t(a,e)){r++;continue}i.push(a)}return this.slots=i,r}forEachIdle(e){for(const t of this.slots)t.state==="idle"&&e(t.item)}forEachActive(e){for(const t of this.slots)t.state==="active"&&e(t.item)}getSlots(){return this.slots}}let bIe=0;class yIe{constructor(e){Object.defineProperty(this,"pool",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metrics",{enumerable:!0,configurable:!0,writable:!0,value:{hits:0,misses:0,created:0,recycled:0,activeCount:0,peakActive:0}}),this.config=e.config,this.pool=new iO({create:()=>{throw new Error("EffectPool: create invoked before prewarm()")}})}buildCreateFn(e,t,r){return()=>{const i=r(),a={instanceId:`${t.id}_${bIe++}`,particleSystem:i,inUse:!1,lastUse:performance.now()};return this.metrics.created++,a}}prewarm(e,t,r){var a,o,s;const i=((a=t.pool)==null?void 0:a.prewarmCount)??((o=t.prewarm)==null?void 0:o.count)??((s=t.pool)==null?void 0:s.min)??0;this.pool=new iO({create:this.buildCreateFn(e,t,r),prewarm:i,onActivate:c=>{c.inUse=!0,c.startTime=performance.now(),this.metrics.activeCount++,this.metrics.activeCount>this.metrics.peakActive&&(this.metrics.peakActive=this.metrics.activeCount)},onRelease:c=>{c.inUse=!1,c.startTime=void 0,c.scheduledEndTime=void 0,this.metrics.activeCount=Math.max(0,this.metrics.activeCount-1),this.metrics.recycled++}}),w.log("effects","dev",`[EffectPool] Prewarmed ${i} instances for effect '${t.id}'`)}acquireInstance(e){var r,i;if(((r=this.config.pool)==null?void 0:r.maxConcurrentPlay)!==void 0&&this.metrics.activeCount>=this.config.pool.maxConcurrentPlay){w.log("effects","dev",`[EffectPool] Concurrency limit reached for '${this.config.id}' (${this.metrics.activeCount}/${this.config.pool.maxConcurrentPlay})`);return}if(((i=this.config.pool)==null?void 0:i.max)!==void 0&&this.pool.idleCount()===0&&this.pool.size()>=this.config.pool.max){w.log("effects","dev",`[EffectPool] Capacity max reached for '${this.config.id}' (size=${this.pool.size()}/max=${this.config.pool.max})`),this.metrics.misses++;return}const t=this.pool.acquire();if(t)return this.metrics.hits++,t.lastUse=e,t;this.metrics.misses++}releaseInstance(e,t){e.lastUse=t,this.pool.release(e)}acquire(){return this.acquireInstance(performance.now())}release(e){this.releaseInstance(e,performance.now())}size(){return this.pool.size()}idleCount(){return this.pool.idleCount()}activeCount(){return this.pool.activeCount()}trim(e){const t=this.config.pool;if(!t)return;const{maxIdleAgeMs:r,min:i}=t;if(this.pool.idleCount()<=i)return;const a=this.pool.trim(e,o=>this.pool.idleCount()-1<i?!1:e-o.lastUse>r);a>0&&w.log("effects","dev",`[EffectPool] Trimmed ${a} idle instance(s) for effect '${this.config.id}'`)}getAllInstances(){return this.pool.getSlots().map(e=>e.item)}getMetrics(){return{...this.metrics}}}function mv(n,e){const t=he.getCore(),r=t.GPUParticleSystem&&t.GPUParticleSystem.IsSupported===!0;return e.systemType==="gpu"&&r?new t.GPUParticleSystem(`${e.id}_gpuTemplate`,{capacity:e.capacity},n):new t.ParticleSystem(`${e.id}_cpuTemplate`,e.capacity,n)}const CIe=n=>{var o,s;const e=is(n);if(!e){w.warn("effects","dev","[load-effect] Missing behavior effect state.");return}if(e.loaded){w.log("effects","dev","[load-effect] Already loaded (noop).");return}const t=ao(e);if(!t){w.warn("effects","dev","[load-effect] Missing runtime bundle (config/pool/scene).");return}const{pool:r,config:i,scene:a}=t;if(i.legacySource){const c=i.legacySource,u=t.runtime.contentManager??((s=(o=n.behavior)==null?void 0:o.state)==null?void 0:s.contentManager);if(!u||typeof u.loadJson!="function")w.warn("effects","dev",`[load-effect] legacySource '${c}' specified but contentManager unavailable.`);else{w.log("effects","dev",`[load-effect] Loading legacy particle JSON '${c}' for effect '${i.id}'.`),e.loaded=!1,(async()=>{try{const h=await u.loadJson(c);e.legacyDefinition=h;const f=he.getCore(),p=()=>{try{const g=f.ParticleSystem.Parse(h,a,"assets/particles"),v=a.meshes.find(y=>y.name==="meshEmitterBands");if(v)try{const y=new f.MeshParticleEmitter(v);if(y.useMeshNormalsForDirection=!0,g.particleEmitterType=y,!g.emitter){const b=new f.Mesh("emissionParticlesMesh",a);g.emitter=b}}catch(y){w.warn("effects","dev","[load-effect] Failed configuring MeshParticleEmitter:",y)}try{let y;if(typeof i.texture=="string"?y=i.texture:typeof i.texture.path=="string"&&(y=i.texture.path),y&&u&&typeof u.loadTexture=="function"){const b=g.particleTexture,C=(b==null?void 0:b.name)??(b==null?void 0:b.url);(!b||C&&C!==y)&&u.loadTexture(y,a).then(S=>{g.particleTexture=S}).catch(S=>{w.warn("effects","dev",`[load-effect] Managed texture override failed for '${i.id}' (${y})`,S)})}}catch(y){w.warn("effects","dev","[load-effect] Texture override logic error:",y)}return g}catch(g){return w.error("effects","dev",`[load-effect] Parse failed for legacySource '${c}'`,g),mv(a,i)}};r.prewarm(a,i,p),e.loaded=!0,w.log("effects","dev",`[load-effect] Loaded legacy particle system for '${i.id}'.`),Si(n,"loaded")}catch(h){w.error("effects","dev",`[load-effect] Failed to load legacy particle JSON '${c}' for '${i.id}':`,h);try{r.prewarm(a,i,()=>mv(a,i)),e.loaded=!0,Si(n,"loaded")}catch{Si(n,"error")}}})();return}}r.prewarm(a,i,()=>mv(a,i)),e.loaded=!0,w.log("effects","dev",`[load-effect] Loaded & prewarmed effect '${i.id}'.`),Si(n,"loaded")},SIe=n=>{var i,a,o,s,c;const e=is(n);if(!e)return;const t=performance.now();if((i=e.activeInstances)!=null&&i.length){const u=[];for(const h of e.activeInstances)if(h.scheduledEndTime&&t>=h.scheduledEndTime){try{"stop"in h.particleSystem&&h.particleSystem.stop()}catch{}u.push(h)}if(u.length){const h=ao(e);if(h)for(const f of u)h.pool.releaseInstance(f,t);e.activeInstances=e.activeInstances.filter(f=>!u.includes(f)),w.log("effects","dev",`[monitor-effect] Recycled ${u.length} completed instance(s). Active=${e.activeInstances.length}`),e.activeInstances.length===0&&Si(n,"completed")}}if(e.cooldownUntil&&t>=e.cooldownUntil&&(e.cooldownUntil=void 0,Si(n,"cooldown-finished")),(o=(a=e.effect)==null?void 0:a.config.pool)!=null&&o.trimIntervalMs){const u=e.effect.config.pool.trimIntervalMs;(!e.lastTrimCheck||t-e.lastTrimCheck>=u)&&((s=ao(e))==null||s.pool.trim(t),e.lastTrimCheck=t)}const r=ao(e);if(r){const u=r.runtime.fsm.getState(),h=r.config.inactiveTimeoutMs;u!=="inactive"||(c=e.activeInstances)!=null&&c.length?e.inactiveSince&&(e.inactiveSince=void 0):(e.inactiveSince??(e.inactiveSince=t),h&&e.inactiveSince&&t-e.inactiveSince>=h&&(w.log("effects","dev",`[monitor-effect] Inactivity timeout (${h}ms) reached; emitting dispose.`),Si(n,"dispose")))}},wIe=n=>{var a;const e=is(n);if(!((a=e==null?void 0:e.activeInstances)!=null&&a.length))return;const t=ao(e);if(!t)return;const r=performance.now();for(const o of e.activeInstances)t.pool.releaseInstance(o,r);const i=e.activeInstances.length;e.activeInstances.length=0,w.log("effects","dev",`[recycle-all] Recycled ${i} instance(s).`)},EIe=n=>{var o,s;const e=is(n);if(!((o=e==null?void 0:e.activeInstances)!=null&&o.length))return;const t=(s=n.params)==null?void 0:s.instanceId;if(!t)return;const r=e.activeInstances.findIndex(c=>c.instanceId===t);if(r===-1)return;const i=e.activeInstances[r],a=ao(e);a==null||a.pool.releaseInstance(i,performance.now()),e.activeInstances.splice(r,1),w.log("effects","dev",`[recycle-instance] Recycled '${t}'. Active=${e.activeInstances.length}`)},TIe=n=>{const e=is(n),t=ao(e);if(!e||!t)return;const{config:r}=t,i=performance.now(),a=r.cooldownMs;if(!a||a<=0){Si(n,"cooldown-finished");return}if((r.cooldownMode??"reset")==="reset"){e.cooldownUntil=i+a,e.cooldownAnchor=i,w.log("effects","dev",`[schedule-cooldown] (reset) cooldown=${a}ms (ends in ${a}ms).`);return}const s=e.cooldownUntil,c=e.cooldownAnchor&&s&&i<=s?e.cooldownAnchor:i,u=r.cooldownMaxMs;let h;if(s&&i<=s?h=s+a:h=i+a,u&&u>0){const f=c+u;h>f&&(h=f)}e.cooldownAnchor=c,e.cooldownUntil=h,w.log("effects","dev",`[schedule-cooldown] (extend) base=${a}ms anchorWindow=${u??"∞"}ms remaining=${(e.cooldownUntil??i)-i}ms`)},IIe=n=>{var c;const e=is(n);if(!e){w.warn("effects","dev","[start-effect] Missing behavior effect state.");return}const t=ao(e);if(!t){w.warn("effects","dev","[start-effect] Missing runtime bundle (config/pool/scene).");return}const{pool:r,config:i}=t,a=n.params;e.activeOverrides=(a==null?void 0:a.overrides)??(a==null?void 0:a.runtimeOverrides),e.activeInstances??(e.activeInstances=[]);const o=performance.now(),s=r.acquireInstance(o);if(!s){w.warn("effects","dev",`[start-effect] Pool acquire failed (limit reached or none available) for '${i.id}'.`);return}try{"start"in s.particleSystem&&s.particleSystem.start()}catch(u){w.error("effects","dev",`[start-effect] Failed to start particle system for '${i.id}': ${u instanceof Error?u.message:String(u)}`),Si(n,"error"),r.releaseInstance(s,o);return}s.startTime=o,pIe(s,s.particleSystem,e.activeOverrides),e.activeInstances.push(s),w.log("effects","dev",`[start-effect] Started instance '${s.instanceId}' (active=${e.activeInstances.length})`),!s.scheduledEndTime&&((c=i.emission)!=null&&c.durationMs)&&s.startTime&&(s.scheduledEndTime=s.startTime+i.emission.durationMs),Si(n,"started")},AIe=n=>{var o,s,c;const e=is(n),t=((o=n.params)==null?void 0:o.all)??!0,r=e==null?void 0:e.activeInstances;if(!(r!=null&&r.length))return;const i=(t?[...r]:[r[0]]).filter(u=>!!u),a=performance.now();for(const u of i){try{"stop"in u.particleSystem&&u.particleSystem.stop()}catch{}const h=ao(e);h==null||h.pool.releaseInstance(u,a),e&&(e.activeInstances=(s=e.activeInstances)==null?void 0:s.filter(f=>f!==u))}w.log("effects","dev",`[stop-effect] Stopped ${i.length} instance(s). Remaining active = ${((c=e==null?void 0:e.activeInstances)==null?void 0:c.length)??0}`),Si(n,"stopped")};function kIe(){return{"load-effect":CIe,"start-effect":IIe,"stop-effect":AIe,"recycle-instance":EIe,"recycle-all":wIe,"complete-effect":mIe,"schedule-cooldown":TIe,"monitor-effect":SIe,"dispose-effect":gIe,"emit-effect-event":vIe}}async function xIe(n,e,t){const r=e;try{const i=r.fsm;if(!i)return;if(typeof i=="string"){const a=await t.loadJson(i).catch(o=>{w.warn("effects","dev",`[ParticleEffectsManager] Failed to load external FSM '${i}' for effect '${n}' (skipping).`,o)});if(a!=null&&a.states&&Array.isArray(a.transitions))return{...a,fsmId:a.fsmId||`particle-effect-${n}`};w.warn("effects","dev",`[ParticleEffectsManager] External FSM '${i}' invalid for effect '${n}' (skipping).`);return}if(i.states&&Array.isArray(i.transitions))return{...i,fsmId:i.fsmId||`particle-effect-${n}`};w.warn("effects","dev",`[ParticleEffectsManager] Inline FSM invalid for effect '${n}' (skipping).`);return}catch(i){w.warn("effects","dev",`[ParticleEffectsManager] Exception resolving FSM for '${n}' (skipping).`,i);return}}class _Ie{constructor(e){Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"contentManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"effects",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"actionHandlers",{enumerable:!0,configurable:!0,writable:!0,value:kIe()}),Object.defineProperty(this,"managerFsm",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"managerFsmInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"hasEmittedManagerInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.scene=e.scene,this.contentManager=e.contentManager,this.eventManager=e.eventManager,this.initializeManagerFSM(e.managerStateMachine),this.eventManager.subscribe("effects",t=>{const{name:r,payload:i}=t;if(!i||typeof i!="object")return;const a=i,o=a.id;if(o)try{switch(r){case"start":this.startEffect(o,a.overrides);break;case"stop":this.stopEffect(o,a.all!==!1);break;case"dispose":this.disposeEffect(o);break;case"load":{a.config?this.loadEffect(o,a.config).catch(s=>{w.error("effects","dev",`[ParticleEffectsManager] load command failed for '${o}':`,s)}):a.path&&this.loadEffect(o,a.path).catch(s=>{w.error("effects","dev",`[ParticleEffectsManager] load command failed for '${o}':`,s)});break}default:break}}catch(s){w.error("effects","dev",`[ParticleEffectsManager] Command '${r}' failed for '${o}':`,s)}}),this.eventManager.subscribe("effectsManager",t=>{this.managerFsm&&this.managerFsm.onEventManagerEvent(t)})}async initializeManagerFSM(e){if(e)try{w.log("effects","dev",`[EffectsManager][FSM-INIT] Loading manager state machine: ${typeof e=="string"?e:"inline-definition"}`);const t=typeof e=="string"?await this.contentManager.loadJson(e):e,r=t;if(!r||typeof r!="object"||Array.isArray(r))throw new Error("Invalid manager FSM definitions shape.");const i=t,a={...this.actionHandlers};this.managerFsm=new Qb(i,a,this.eventManager),this.managerFsmInitialized=!0,w.log("effects","dev","[EffectsManager][FSM-INIT] Manager FSM initialized."),this.hasEmittedManagerInitialized||(this.hasEmittedManagerInitialized=!0,this.eventManager.emit(new Pe("effectsManager","manager-initialized",{timestamp:performance.now(),fsmInitialized:!0})))}catch(t){w.error("effects","dev","[EffectsManager][FSM-INIT] Failed to initialize manager-level FSM:",t)}}async loadEffect(e,t){var u;if(this.effects.has(e)){w.log("effects","dev",`[ParticleEffectsManager] Effect '${e}' already registered (load skipped).`);return}let r;typeof t=="string"?r=await this.contentManager.loadJson(t):r=t,r.id!==e&&(w.warn("effects","dev",`[ParticleEffectsManager] Config id '${r.id}' mismatches requested id '${e}'. Using requested id.`),r.id=e);const i=await xIe(e,r,this.contentManager);if(!i){w.log("effects","dev",`[ParticleEffectsManager] No FSM for '${e}' (effect not registered).`);return}const a=new yIe({config:r,onCreateParticleSystem:(h,f)=>mv(h,f)}),o=new Qb({effect:i},this.actionHandlers,this.eventManager,"effect",void 0),s={config:r,fsm:o,pool:a,status:"idle",metrics:{hits:0,misses:0,created:0,recycled:0,activeCount:0,peakActive:0}};s.scene=this.scene,o.state.scene=this.scene,s.contentManager=this.contentManager,o.state.contentManager=this.contentManager;const c=(u=o.state).__effectBehaviorState??(u.__effectBehaviorState={});c.effect=s,typeof c.loaded>"u"&&(c.loaded=!1),this.effects.set(e,{config:r,runtime:s}),w.log("effects","dev",`[ParticleEffectsManager] Registered effect '${e}'.`),o.onEventManagerEvent({system:"effects",name:"load"})}startEffect(e,t){const r=this.effects.get(e);if(!r){w.warn("effects","dev",`[ParticleEffectsManager] Cannot start unknown effect '${e}'.`);return}r.runtime.fsm.state.startOverrides=t,r.runtime.fsm.onEventManagerEvent({system:"effects",name:"start"})}stopEffect(e,t=!0){const r=this.effects.get(e);r&&(r.runtime.fsm.state.stopParams={all:t},r.runtime.fsm.onEventManagerEvent({system:"effects",name:"stopped"}))}disposeEffect(e){const t=this.effects.get(e);t&&(t.runtime.fsm.onEventManagerEvent({system:"effects",name:"dispose"}),this.effects.delete(e),w.log("effects","dev",`[ParticleEffectsManager] Disposed effect '${e}'.`))}getEffectState(e){const t=this.effects.get(e);if(!t)return;const r=t.runtime.fsm.getState();return["idle","loading","active","cooldown","inactive","error"].includes(r)?r:"error"}getPoolStats(e){const t=this.effects.get(e);if(t)return t.runtime.pool.getMetrics()}getEffectCooldownInfo(e){const t=this.effects.get(e);if(!t)return;const r=t.runtime,{config:i}=r;if(!i.cooldownMs||i.cooldownMs<=0)return;const a=r.fsm.state.__effectBehaviorState,o=performance.now(),s=a==null?void 0:a.cooldownAnchor,c=(a==null?void 0:a.cooldownUntil)??r.cooldownUntil,u=typeof c=="number"&&o<c,h=u?Math.max(0,c-o):0;return{mode:i.cooldownMode??"reset",cooldownMs:i.cooldownMs,maxWindowMs:i.cooldownMaxMs,anchor:s,until:c,remainingMs:h,active:u}}update(e,t){this.managerFsm&&this.managerFsmInitialized&&this.managerFsm.step({scene:this.scene},t);const r=[];for(const[i,a]of this.effects){const{runtime:o}=a;o.fsm.step({scene:this.scene},t);const s=o.fsm.getState();o.status=s;const c=o.pool.getMetrics();o.metrics.activeCount=c.activeCount,o.metrics.peakActive=c.peakActive,o.disposed&&o.status==="inactive"&&r.push(i)}if(r.length){for(const i of r)this.effects.delete(i);w.log("effects","dev",`[ParticleEffectsManager] Pruned ${r.length} disposed effect(s): ${r.join(", ")}`)}}onFrame(e,t){this.update(e,t)}summarize(){const e=[];for(const[t,r]of this.effects)e.push({id:t,state:this.getEffectState(t)??"error",metrics:r.runtime.pool.getMetrics()});return{count:e.length,effects:e}}getCurrentFSMState(){var e;return(e=this.managerFsm)==null?void 0:e.getState()}isFSMInitialized(){return this.managerFsmInitialized}triggerFSMEvent(e,t){this.managerFsm&&this.eventManager.emit(new Pe("effectsManager",e,t))}getFSMDebugInfo(){var e;return{initialized:this.managerFsmInitialized,currentState:(e=this.managerFsm)==null?void 0:e.getState(),hasDefinitions:this.managerFsm!==null}}}class MIe{constructor(e,t,r,i,a){Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meshManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tweenManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"propertyManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.eventManager=e,this.meshManager=r,this.tweenManager=i,this.propertyManager=a,this.subscribeToEvents()}subscribeToEvents(){this.eventManager.subscribe("billboard",e=>{const t=e.payload;switch(e.name){case"tween":this.handleTweenEvent(t);break;case"stop":this.handleStopEvent(t);break;default:this.handleEvent(t);break}})}handleTweenEvent(e){const{name:t,visibility:r,x:i,y:a,width:o,height:s,rotation:c,alpha:u,textureRef:h,tween:f,tweens:p,wiggle:g,wiggles:v}=e;if(typeof t!="string"||!t)return;const y={x:i,y:a,width:o,height:s,rotation:c,alpha:u,textureRef:h};if(Object.values(y).some(b=>b!==void 0)&&this.propertyManager.updateProperties(t,y),f&&this.tweenManager.startTween({...f,billboardName:t}),p)for(const b of p)this.tweenManager.startTween({...b,billboardName:t});if(g&&this.tweenManager.startWiggle({...g,billboardName:t}),v)for(const b of v)this.tweenManager.startWiggle({...b,billboardName:t});typeof r=="boolean"&&this.meshManager.setVisibility(t,r)}handleStopEvent(e){const{name:t,stop:r}=e;r==="all"?this.tweenManager.stopAll():typeof t=="string"&&t&&r===!0&&this.tweenManager.stopAll(t)}handleEvent(e){const{name:t,visibility:r,x:i,y:a,width:o,height:s,rotation:c,alpha:u,textureRef:h,tween:f,tweens:p,stop:g}=e;if(typeof t!="string"||!t)return;g!==void 0&&(g==="all"?this.tweenManager.stopAll():g===!0&&this.tweenManager.stopAll(t));const v={x:i,y:a,width:o,height:s,rotation:c,alpha:u,textureRef:h};if(Object.values(v).some(y=>y!==void 0)&&this.propertyManager.updateProperties(t,v),f&&this.tweenManager.startTween({...f,billboardName:t}),p)for(const y of p)this.tweenManager.startTween({...y,billboardName:t});typeof r=="boolean"&&this.meshManager.setVisibility(t,r)}dispose(){}}class RIe{constructor(e){Object.defineProperty(this,"babylonCore",{enumerable:!0,configurable:!0,writable:!0,value:he.getCore()}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meshes",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.scene=e}getMeshes(){return this.meshes}getMesh(e){return this.meshes.get(e)}createOrUpdateMesh(e){let t=this.meshes.get(e.name);t||(t=this.babylonCore.MeshBuilder.CreatePlane(e.name,{size:1},this.scene),t.rotate(this.babylonCore.Vector3.UpReadOnly,Math.PI),this.meshes.set(e.name,t)),this.updateMeshProperties(t,e)}updateMeshProperties(e,t){const r=e;r.scaling.x=t.width,r.scaling.y=t.height,r.position=t.position.clone(),r.rotation.z=t.rotation,this.updateMeshMaterial(r,t),r.isVisible=!1}updateMeshMaterial(e,t){const r=e,i=new this.babylonCore.StandardMaterial(`${t.name}-mat`,this.scene);r.material=i,t.textureRef&&t.textureRef!==""?(i.diffuseTexture=new this.babylonCore.Texture(t.textureRef,this.scene,{noMipmap:!0}),i.diffuseTexture.hasAlpha=!0,i.useAlphaFromDiffuseTexture=!0,i.emissiveColor=new this.babylonCore.Color3(1,1,1)):i.emissiveColor=new this.babylonCore.Color3(.2,.6,1),i.alpha=t.alpha??1,i.backFaceCulling=!1}setVisibility(e,t){const r=this.meshes.get(e);r&&(r.isVisible=t)}updateMeshProperty(e,t,r){const i=this.meshes.get(e);if(i)switch(t){case"x":i.position.x=r;break;case"y":i.position.y=r;break;case"width":i.scaling.x=r;break;case"height":i.scaling.y=r;break;case"rotation":i.rotation.z=r;break;case"alpha":i.material&&"alpha"in i.material&&(i.material.alpha=r);break;case"visibility":i.isVisible=r;break;default:w.warn(`Unknown property "${t}" for billboard mesh "${e}"`,"editor");break}}onFrame(e){for(const t of this.meshes.values())t.isVisible}disposeMesh(e){const t=this.meshes.get(e);t&&(t.dispose(),this.meshes.delete(e))}dispose(){for(const e of this.meshes.values())e.dispose();this.meshes.clear()}}class PIe{constructor(e,t){Object.defineProperty(this,"babylonCore",{enumerable:!0,configurable:!0,writable:!0,value:he.getCore()}),Object.defineProperty(this,"registry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meshManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.registry=e,this.meshManager=t}ensureBillboard(e,t){const r=this.registry.get(e);if(r)return r;const{x:i,y:a,width:o,height:s,rotation:c,alpha:u,textureRef:h}=t,{Vector3:f}=this.babylonCore,p={name:e,textureRef:h??"",position:new f(i??0,a??0,0),width:o??1,height:s??1,rotation:c??0,alpha:u??1};return this.registry.register(p),this.meshManager.createOrUpdateMesh(p),p}updateProperties(e,t){const r=this.ensureBillboard(e,t);if(!r){w.warn(`Billboard '${e}' not found in registry and insufficient properties to create`,"editor");return}const i=this.meshManager.getMesh(e);if(!i){w.warn(`Mesh for billboard '${e}' not found`,"dev");return}let a=!1;t.x!==void 0&&(r.position.x=t.x,a=!0),t.y!==void 0&&(r.position.y=t.y,a=!0),t.width!==void 0&&(r.width=t.width,a=!0),t.height!==void 0&&(r.height=t.height,a=!0),t.rotation!==void 0&&(r.rotation=t.rotation,a=!0),t.alpha!==void 0&&(r.alpha=t.alpha,a=!0),t.textureRef!==void 0&&(r.textureRef=t.textureRef,a=!0),a&&this.applyPropertiesToMesh(i,r,t)}applyPropertiesToMesh(e,t,r){const i=e;(r.x!==void 0||r.y!==void 0)&&(i.position=t.position.clone()),r.width!==void 0&&(i.scaling.x=t.width),r.height!==void 0&&(i.scaling.y=t.height),r.rotation!==void 0&&(i.rotation.z=t.rotation),(r.alpha!==void 0||r.textureRef!==void 0)&&this.updateMeshMaterial(i,t)}updateMeshMaterial(e,t){const r=e,{StandardMaterial:i,Texture:a,Color3:o}=this.babylonCore;if(!r.material){const c=new i(`${t.name}-mat`,r.getScene());r.material=c}const s=r.material;t.textureRef&&t.textureRef!==""?(s.diffuseTexture=new a(t.textureRef,r.getScene(),{noMipmap:!0}),s.diffuseTexture.hasAlpha=!0,s.useAlphaFromDiffuseTexture=!0,s.emissiveColor=new o(1,1,1)):s.emissiveColor=new o(.2,.6,1),s.alpha=t.alpha??1,s.backFaceCulling=!1}}class NIe{constructor(e,t){Object.defineProperty(this,"registry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meshManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"activeTweens",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"activeWiggles",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"currentTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.registry=e,this.meshManager=t}getCurrentTime(){return this.currentTime}getActiveTweens(){return this.activeTweens}getActiveWiggles(){return this.activeWiggles}startTween(e){const t=this.registry.get(e.billboardName);if(!t)return;const r=this.getInitialValue(e,t),i={...e,startTime:this.currentTime,initialValue:r};this.activeTweens.has(e.billboardName)||this.activeTweens.set(e.billboardName,[]),this.activeTweens.get(e.billboardName).push(i)}startWiggle(e){const t=this.registry.get(e.billboardName);if(!t)return;const r=e.center??this.getCurrentPropertyValue(e,t),i={...e,startTime:this.currentTime,currentPhase:e.phaseOffset,randomTarget:0,randomChangeTime:this.currentTime+.1+Math.random()*.2,currentOffset:0,centerValue:r};this.activeWiggles.has(e.billboardName)||this.activeWiggles.set(e.billboardName,[]),this.activeWiggles.get(e.billboardName).push(i)}stopTweens(e){e?this.activeTweens.has(e)&&this.activeTweens.delete(e):this.activeTweens.clear()}stopWiggles(e){e?this.activeWiggles.has(e)&&this.activeWiggles.delete(e):this.activeWiggles.clear()}stopAll(e){this.stopTweens(e),this.stopWiggles(e)}onFrame(e){this.currentTime+=e,this.updateActiveTweens(),this.updateActiveWiggles(e)}getInitialValue(e,t){return e.from!==void 0?e.from:this.getCurrentPropertyValue(e,t)}getCurrentPropertyValue(e,t){var r;switch(e.property){case"x":return t.position.x;case"y":return t.position.y;case"width":return t.width;case"height":return t.height;case"rotation":return t.rotation;case"alpha":return t.alpha??1;case"visibility":return((r=this.meshManager.getMesh(e.billboardName))==null?void 0:r.isVisible)??!1?1:0;default:return 0}}updateActiveTweens(){var e;for(const[t,r]of this.activeTweens){const i=[];for(const[a,o]of r.entries()){const s=this.currentTime-o.startTime,c=Math.max(0,s-(o.delay??0));if(c>=o.duration)this.applyTweenValue(t,o,o.to),i.push(a),(e=o.onComplete)==null||e.call(o);else if(c>0){const u=c/o.duration,h=DF(o.easing??"linear")(u);let f;typeof o.initialValue=="number"?f=o.initialValue:f=o.initialValue?1:0;let p;typeof o.to=="number"?p=o.to:p=o.to?1:0;const g=f+(p-f)*h;this.applyTweenValue(t,o,g)}}if(i.length>0){for(let a=i.length-1;a>=0;a-=1)r.splice(i[a],1);r.length===0&&this.activeTweens.delete(t)}}}applyTweenValue(e,t,r){const i=this.registry.get(e);if(i){switch(t.property){case"x":i.position.x=r;break;case"y":i.position.y=r;break;case"width":i.width=r;break;case"height":i.height=r;break;case"rotation":i.rotation=r;break;case"alpha":i.alpha=r;break}this.meshManager.updateMeshProperty(e,t.property,r),this.registry.register(i)}}updateActiveWiggles(e){for(const[t,r]of this.activeWiggles){const i=this.registry.get(t);if(!i)continue;const a=[];for(const o of r){o.centerValue=this.getCurrentPropertyValue(o,i);const s=this.calculateWiggleOffset(o,this.currentTime,e);o.currentOffset=s;const c=o.centerValue+s;this.applyWiggleValue(t,o,c)}if(a.length>0){for(let o=a.length-1;o>=0;o-=1)r.splice(a[o],1);r.length===0&&this.activeWiggles.delete(t)}}}calculateWiggleOffset(e,t,r){const i=e.intensity??1;e.currentPhase+=e.speed*(r/1e3)*Math.PI*2;let a=0;switch(e.pattern){case"sine":{a=Math.sin(e.currentPhase)*e.amount;break}case"circular":{const o=e.property==="y"?Math.PI/2:0;a=Math.sin(e.currentPhase+o)*e.amount;break}case"pulse":{a=this.pulsePattern(e,r);break}case"square":{a=this.squarePattern(e);break}case"triangle":{a=this.trianglePattern(e);break}case"elastic":{a=this.elasticPattern(e,r);break}case"sawtooth":{a=this.sawtoothPattern(e);break}case"noise":{a=this.noisePattern(e,t);break}case"damped":{a=this.dampedPattern(e,t);break}case"random":default:{a=this.randomPattern(e,t,r);break}}return a*i}randomPattern(e,t,r){const i=e.variation??0,o=e.amount*(1+i);if(t>=e.randomChangeTime){e.randomTarget=(Math.random()-.5)*2*o;const u=.2*(1-i*.5);e.randomChangeTime=t+.1+Math.random()*u}const s=Math.min(e.speed*r/10,.1);return e.currentOffset+(e.randomTarget-e.currentOffset)*s}pulsePattern(e,t){const r=e.speed,i=e.variation??0;e.pulsePhase??(e.pulsePhase=0),e.pulsePhase+=r*t;const a=e.pulsePhase%1;let o=0;const s=.1+i*.05,c=.2+i*.1;if(a<s)o=Math.sin(a/s*Math.PI);else if(a<c){const u=.3*(1+i);o=Math.sin((a-s)/(c-s)*Math.PI)*u}return o*e.amount}squarePattern(e){const t=e.variation??0,r=e.currentPhase%(Math.PI*2)/(Math.PI*2),i=.5+(Math.random()-.5)*t*.1;return r<i?e.amount:-e.amount}trianglePattern(e){const t=e.variation??0,r=e.currentPhase%(Math.PI*2)/(Math.PI*2);let i;return r<.5?i=(r*4-1)*e.amount:i=(3-r*4)*e.amount,t>0&&(i+=(Math.random()-.5)*t*e.amount*.2),i}elasticPattern(e,t){const r=e.decay??.8,i=e.variation??0,a=.1*(1+i*.5);e.elasticVelocity??(e.elasticVelocity=0);const o=-e.currentOffset*a,s=-e.elasticVelocity*r,c=o+s;e.elasticVelocity+=c*t;const u=e.currentOffset+e.elasticVelocity*t,h=.01*e.speed*(1+i);return Math.random()<h&&(e.elasticVelocity+=(Math.random()-.5)*e.amount*.5*(1+i)),Math.max(-e.amount,Math.min(e.amount,u))}sawtoothPattern(e){const t=e.variation??0;let i=(e.currentPhase%(Math.PI*2)/(Math.PI*2)*2-1)*e.amount;return t>0&&(i+=(Math.random()-.5)*t*e.amount*.3),i}noisePattern(e,t){const r=e.variation??0,i=1+r;e.noiseOffset??(e.noiseOffset=Math.random()*1e3);const a=t*e.speed*i,o=Math.sin(a+e.noiseOffset)*.5,s=Math.sin(a*2.1+e.noiseOffset*1.3)*.3,c=Math.sin(a*4.7+e.noiseOffset*.7)*.2;let u=o+s+c;if(r>.5){const h=Math.sin(a*8.3+e.noiseOffset*.9)*.1*r;u+=h}return u*e.amount}dampedPattern(e,t){const r=e.decay??.8,i=t-e.startTime;e.dampingDecay??(e.dampingDecay=1),e.dampingDecay=Math.exp(-r*i);const o=1+(e.variation??0)*.5;return Math.sin(e.currentPhase*o)*e.amount*e.dampingDecay}applyWiggleValue(e,t,r){const i=this.registry.get(e);if(i){switch(t.property){case"x":i.position.x=r;break;case"y":i.position.y=r;break;case"width":i.width=r;break;case"height":i.height=r;break;case"rotation":i.rotation=r;break;case"alpha":i.alpha=r;break}this.meshManager.updateMeshProperty(e,t.property,r),this.registry.register(i)}}dispose(){this.activeTweens.clear(),this.activeWiggles.clear()}}class OIe{constructor(e,t,r){Object.defineProperty(this,"registry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meshManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tweenManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"propertyManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventHandler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.registry=t,this.meshManager=new RIe(e),this.tweenManager=new NIe(t,this.meshManager),this.propertyManager=new PIe(t,this.meshManager),this.eventHandler=new MIe(r,t,this.meshManager,this.tweenManager,this.propertyManager)}getRegistry(){return this.registry}get meshes(){return this.meshManager.getMeshes()}onFrame(e){this.tweenManager.onFrame(e)}setVisibility(e,t){this.meshManager.setVisibility(e,t)}removeBillboard(e){this.tweenManager.stopTweens(e),this.meshManager.disposeMesh(e),this.registry.remove(e)}stopTweens(e){this.tweenManager.stopTweens(e)}dispose(){this.tweenManager.dispose(),this.meshManager.dispose(),this.eventHandler.dispose()}}class LIe{constructor(){Object.defineProperty(this,"billboards",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}register(e){this.billboards.set(e.name,e)}get(e){return this.billboards.get(e)}remove(e){this.billboards.delete(e)}getAll(){return Array.from(this.billboards.values())}}function DIe(n,e){const t=new LIe;return new OIe(n,t,e)}const jIe="contain",UIe=1,FIe=!0,BIe=10,HIe=5,aO=0,oO=7;class $Ie{constructor(e,t){Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mesh",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"material",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"texture",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"fit",{enumerable:!0,configurable:!0,writable:!0,value:jIe}),Object.defineProperty(this,"opacity",{enumerable:!0,configurable:!0,writable:!0,value:UIe}),Object.defineProperty(this,"billboard",{enumerable:!0,configurable:!0,writable:!0,value:FIe}),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:BIe}),Object.defineProperty(this,"offsetZ",{enumerable:!0,configurable:!0,writable:!0,value:HIe}),Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:he.getCore()}),this.scene=e,this.ensureMesh(),t&&this.setImage(t.url,{fit:t.fit,opacity:t.opacity,billboard:t.billboard,maxSize:t.maxSize,offsetZ:t.offsetZ})}setImage(e,t){const r=e.trim();if(!r){w.warn("babylon","dev","[BackgroundBillboard] empty url");return}if(t&&(t.fit&&(this.fit=t.fit),typeof t.opacity=="number"&&(this.opacity=t.opacity),typeof t.billboard=="boolean"&&(this.billboard=t.billboard),typeof t.maxSize=="number"&&(this.maxSize=t.maxSize),typeof t.offsetZ=="number"&&(this.offsetZ=t.offsetZ)),this.ensureMesh(),this.url===r&&this.texture){w.log("babylon","dev","[BackgroundBillboard] setImage dedupe, applying options only"),this.applyCommonSettings(),this.recomputeScaleFromTexture();return}this.disposeTexture(),w.log("babylon","dev","[BackgroundBillboard] loading texture...",r);try{const{Texture:i}=this.core,a=new i(r,this.scene,{noMipmap:!0});a.hasAlpha=!0,this.texture=a,this.url=r,this.applyCommonSettings(),a.onLoadObservable.add(()=>{w.log("babylon","dev","[BackgroundBillboard] texture loaded",r),this.recomputeScaleFromTexture()}),this.recomputeScaleFromTexture()}catch(i){w.error("babylon","dev","[BackgroundBillboard] texture load failed",i),this.clear()}}setOpacity(e){this.opacity=Math.max(0,Math.min(1,e)),this.material&&(this.material.alpha=this.opacity)}setFit(e,t){this.fit=e,typeof t=="number"&&(this.maxSize=t),this.recomputeScaleFromTexture()}clear(){this.disposeTexture(),this.disposeMaterial(),this.disposeMesh(),this.url=null}dispose(){this.clear()}ensureMesh(){if(this.mesh){this.applyMeshFlagsAndPosition(),this.ensureMaterial();return}const{MeshBuilder:e,Vector3:t}=this.core,r=e.CreatePlane("BackgroundBillboard",{size:1},this.scene);r.isPickable=!1,r.renderingGroupId=aO,r.alwaysSelectAsActiveMesh=!1,r.position=new t(0,0,-this.offsetZ),r.billboardMode=this.billboard?oO:0,this.mesh=r,this.ensureMaterial()}ensureMaterial(){if(!this.mesh||this.material)return;const{StandardMaterial:e,Color3:t}=this.core,r=new e("BackgroundBillboardMat",this.scene);r.alpha=this.opacity,r.emissiveColor=new t(1,1,1),r.backFaceCulling=!1,r.useAlphaFromDiffuseTexture=!0,this.mesh.material=r,this.material=r,this.texture&&(r.diffuseTexture=this.texture)}disposeTexture(){var e;if((e=this.material)!=null&&e.diffuseTexture&&(this.material.diffuseTexture=null),this.texture){try{this.texture.dispose()}catch{}this.texture=null}}disposeMaterial(){if(this.material){try{this.material.dispose()}catch{}this.material=null}}disposeMesh(){if(this.mesh){try{this.mesh.dispose(!1,!0)}catch{}this.mesh=null}}applyCommonSettings(){this.mesh&&(this.applyMeshFlagsAndPosition(),this.material&&(this.material.alpha=this.opacity,this.texture&&(this.material.diffuseTexture=this.texture)))}applyMeshFlagsAndPosition(){if(!this.mesh)return;const{Vector3:e}=this.core;this.mesh.billboardMode=this.billboard?oO:0,this.mesh.renderingGroupId=aO,this.mesh.isPickable=!1,this.mesh.alwaysSelectAsActiveMesh=!1,this.mesh.position=new e(0,0,-this.offsetZ)}recomputeScaleFromTexture(){if(!this.mesh)return;let e=0,t=0;if(this.texture)try{const c=this.texture.getSize();e=c.width,t=c.height}catch{}if(e<=0||t<=0){this.mesh.scaling.x=this.maxSize,this.mesh.scaling.y=this.maxSize;return}const r=e/t,i=this.maxSize,a=this.maxSize;let o=i,s=a;switch(this.fit){case"contain":o=Math.min(i,a*r),s=Math.min(a,i/r);break;case"cover":o=Math.max(i,i/r),s=Math.max(a,a*r);break;case"stretch":default:o=i,s=a;break}this.mesh.scaling.x=o,this.mesh.scaling.y=s}}class zIe{constructor(e,t,r,i){var s;Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"babylonCore",{enumerable:!0,configurable:!0,writable:!0,value:he.getCore()}),Object.defineProperty(this,"stage",{enumerable:!0,configurable:!0,writable:!0,value:pv}),Object.defineProperty(this,"billboardManager",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"backgroundBillboard",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.scene=e,this.eventManager=t,this.settings=r,this.setupBillboard(this.eventManager);const a=r.environmentSettings;if(a!=null&&a.stages){const c=a.startStage??0;this.stage=a.stages[c]??pv}else this.stage=pv;this.createLights(this.stage);const o=i??null;if(o!=null&&o.url)this.setBackgroundImage(o.url,{fit:o.fit,opacity:o.opacity,billboard:o.billboard,maxSize:o.maxSize,offsetZ:o.offsetZ});else if((s=this.stage.backdrop)!=null&&s.url){const c=this.stage.backdrop.fit??"contain",u=Math.max(this.stage.backdrop.width,this.stage.backdrop.height),h=this.stage.backdrop.position,f=h?Math.max(0,-h[2]):void 0;this.setBackgroundImage(this.stage.backdrop.url,{fit:c,maxSize:u,offsetZ:f})}}createLights(e){for(const t of e.lights)if(t.direction.length===3){const r=this.babylonCore.Vector3.FromArray(t.direction),i=new this.babylonCore.DirectionalLight("RimLight",r,this.scene);i.intensity=t.intensity}}createEnvironment(e){this.scene.createDefaultEnvironment({createGround:!0,createSkybox:!1,setupImageProcessing:!1,groundColor:this.babylonCore.Color3.Black(),groundTexture:e.groundTexture,groundSize:e.groundSize,groundOpacity:e.groundOpacity,environmentTexture:e.environmentMap})}setupBillboard(e){this.billboardManager=DIe(this.scene,e)}onFrame(e){var t;(t=this.billboardManager)==null||t.onFrame(e)}setBackgroundImage(e,t){this.backgroundBillboard??(this.backgroundBillboard=new $Ie(this.scene)),this.backgroundBillboard.setImage(e,t)}clearBackgroundImage(){this.backgroundBillboard&&(this.backgroundBillboard.dispose(),this.backgroundBillboard=null)}dispose(){this.billboardManager&&(this.billboardManager.dispose(),this.billboardManager=null),this.backgroundBillboard&&(this.backgroundBillboard.dispose(),this.backgroundBillboard=null)}}class VIe{constructor(e,t){Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"activeListeners",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"nextListenerId",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.scene=e,this.eventManager=t}setScene(e){this.scene!==e&&(this.removeAllListeners(),this.scene=e)}addListeners(e){if(!this.scene)return w.warn("interaction-manager","dev","Cannot add listeners: no scene set"),[];const t=[];for(const r of e){const i=this.generateListenerId();t.push(i);try{const a=this.createObserver(r);if(a){const o={id:i,config:r,observer:a};this.activeListeners.set(i,o),w.log("interaction-manager","dev",`Added ${r.type} listener with ID: ${i}`,r)}}catch(a){w.error("interaction-manager","dev",`Failed to create listener for ${r.type}:`,a)}}return t}removeListeners(e){for(const t of e){const r=this.activeListeners.get(t);r!=null&&r.observer&&(this.scene&&(r.config.type==="keypress"?this.scene.onKeyboardObservable.remove(r.observer):this.scene.onPointerObservable.remove(r.observer)),this.activeListeners.delete(t),w.log("interaction-manager","dev",`Removed ${r.config.type} listener with ID: ${t}`))}}removeAllListeners(){const e=Array.from(this.activeListeners.keys());this.removeListeners(e)}createObserver(e){if(!this.scene)return null;const{KeyboardEventTypes:t}=he.getCore();return e.type==="keypress"?this.scene.onKeyboardObservable.add(r=>{r.type===t.KEYDOWN&&(!e.key||r.event.key===e.key)&&this.emitEvent(e,{keyInfo:r})}):this.scene.onPointerObservable.add(r=>{if(this.shouldHandlePointerEvent(e,r)){const i=e.event.includePickInfo?{pointerInfo:r,pickInfo:r.pickInfo}:{pointerInfo:r};this.emitEvent(e,i)}})}shouldHandlePointerEvent(e,t){var a;const{PointerEventTypes:r}=he.getCore();let i=!1;switch(e.type){case"click":i=t.type===r.POINTERDOWN;break;case"hover":i=t.type===r.POINTERMOVE;break;case"drag":i=t.type===r.POINTERMOVE&&t.event.buttons>0;break;case"wheel":i=t.type===r.POINTERWHEEL;break;default:return!1}if(!i)return!1;if(e.type==="click"&&e.pointerButton){const s={left:0,right:2,middle:1}[e.pointerButton];if(t.event.button!==s)return!1}if(e.meshNames??e.meshTags){const o=(a=t.pickInfo)==null?void 0:a.pickedMesh;if(!o||e.meshNames&&!e.meshNames.includes(o.name)||e.meshTags&&!e.meshTags.some(c=>this.meshHasTag(o,c)))return!1}return!0}meshHasTag(e,t){const r=e.metadata,i=r==null?void 0:r.tags;return(i==null?void 0:i.includes(t))??!1}emitEvent(e,t){const r=new Pe(e.event.system,e.event.name,t);this.eventManager.emit(r,"next-frame"),w.log("interaction-manager","dev",`Emitted interaction event: ${e.event.system}:${e.event.name}`,t)}generateListenerId(){const e=`listener_${this.nextListenerId}`;return this.nextListenerId+=1,e}getActiveListenerCount(){return this.activeListeners.size}}const ra={distance3D(n,e){const t=e.x-n.x,r=e.y-n.y,i=e.z-n.z;return Math.sqrt(t*t+r*r+i*i)},getBoxCenter(n){return{x:n.x+n.width/2,y:n.y+n.height/2,z:n.z+n.depth/2}},lerp(n,e,t){return n+(e-n)*t}};class GIe{constructor(e,t,r,i={}){Object.defineProperty(this,"character",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"poiRegistry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"discoveryManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"behaviors",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"currentMovement",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"animationFrameId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventListeners",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"isActive",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.character={position:{...e},rotation:{x:0,y:0,z:0},velocity:{x:0,y:0,z:0},behavior:"idle",isMoving:!1,lastUpdate:Date.now()},this.config={initialPosition:e,movementSpeed:100,detectionRadius:150,updateInterval:16,debug:!1,...i},this.poiRegistry=t,this.discoveryManager=r,this.registerDefaultBehaviors()}getCharacterState(){return{...this.character}}setPosition(e){this.character.position={...e},this.character.lastUpdate=Date.now(),this.stopMovement()}moveTowardsPOI(e){const t=ra.getBoxCenter(e.bounds3D);this.startMovement(t,e),this.emitEvent({type:"character-moved",poi:e,character:this.getCharacterState(),timestamp:Date.now()})}startNavigation(){this.isActive||(this.isActive=!0,this.navigationLoop())}stopNavigation(){this.isActive=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=void 0)}registerBehavior(e){this.behaviors.set(e.name,e)}unregisterBehavior(e){this.behaviors.delete(e)}addEventListener(e){this.eventListeners.push(e)}removeEventListener(e){const t=this.eventListeners.indexOf(e);t>-1&&this.eventListeners.splice(t,1)}update(){this.isActive&&(this.currentMovement&&this.updateMovement(),this.character.isMoving||this.makeNavigationDecision(),this.character.lastUpdate=Date.now())}navigationLoop(){this.isActive&&(this.currentMovement&&this.updateMovement(),this.character.isMoving||this.makeNavigationDecision(),this.animationFrameId=requestAnimationFrame(()=>this.navigationLoop()))}makeNavigationDecision(){try{const e=this.poiRegistry.findNearbyPOIs(this.character.position,this.config.detectionRadius??150);if(e.length===0)return;const t=[],r=Array.from(this.behaviors.values()).sort((i,a)=>a.priority-i.priority);for(const i of r)try{i.execute(this.character,e[0]).position&&e[0]&&t.push({shouldMove:!0,targetPOI:e[0],reason:`Behavior: ${i.name}`,priority:i.priority})}catch{}if(t.length>0){const i=t.reduce((a,o)=>o.priority>a.priority?o:a);i.targetPOI&&this.moveTowardsPOI(i.targetPOI)}}catch{}}startMovement(e,t){const i=ra.distance3D(this.character.position,e)/(this.config.movementSpeed??100)*1e3;this.currentMovement={startPosition:{...this.character.position},targetPosition:e,startTime:Date.now(),duration:i,easingFunction:this.config.easingFunction??this.getDefaultEasing()},this.character.isMoving=!0,this.character.targetPOI=t==null?void 0:t.id,this.character.behavior="moving"}updateMovement(){if(!this.currentMovement)return;const t=Date.now()-this.currentMovement.startTime,r=Math.min(t/this.currentMovement.duration,1),i=this.currentMovement.easingFunction(r);if(this.character.position={x:ra.lerp(this.currentMovement.startPosition.x,this.currentMovement.targetPosition.x,i),y:ra.lerp(this.currentMovement.startPosition.y,this.currentMovement.targetPosition.y,i),z:ra.lerp(this.currentMovement.startPosition.z,this.currentMovement.targetPosition.z,i)},t>0){const a=this.character.position.x-this.currentMovement.startPosition.x,o=this.character.position.y-this.currentMovement.startPosition.y,s=this.character.position.z-this.currentMovement.startPosition.z;this.character.velocity={x:a/(t/1e3),y:o/(t/1e3),z:s/(t/1e3)}}r>=1&&this.completeMovement()}completeMovement(){if(!this.currentMovement)return;this.character.position={...this.currentMovement.targetPosition},this.character.isMoving=!1,this.character.behavior="idle",this.character.velocity={x:0,y:0,z:0};const e=this.character.targetPOI;this.character.targetPOI=void 0,this.currentMovement=void 0,this.emitEvent({type:"character-reached-poi",character:this.getCharacterState(),timestamp:Date.now(),metadata:{targetPOIId:e}})}stopMovement(){this.currentMovement=void 0,this.character.isMoving=!1,this.character.behavior="idle",this.character.velocity={x:0,y:0,z:0},this.character.targetPOI=void 0}getDefaultEasing(){return e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}registerDefaultBehaviors(){this.registerBehavior({name:"curiosity",priority:3,shouldActivate:(e,t)=>t.some(r=>r.tags.includes("interactive")||r.tags.includes("important")||r.category==="ui-element"),execute:(e,t)=>t?{position:ra.getBoxCenter(t.bounds3D),behavior:"investigating",targetPOI:t.id}:{}}),this.registerBehavior({name:"helper",priority:5,shouldActivate:(e,t)=>t.some(r=>r.tags.includes("help")||r.tags.includes("assistance")||r.category==="help-needed"),execute:(e,t)=>t?{position:ra.getBoxCenter(t.bounds3D),behavior:"helping",targetPOI:t.id}:{}})}findClosestPOI(e,t){return t.reduce((r,i)=>{const a=ra.getBoxCenter(i.bounds3D),o=ra.getBoxCenter(r.bounds3D),s=ra.distance3D(e,a),c=ra.distance3D(e,o);return s<c?i:r})}emitEvent(e){for(const t of this.eventListeners)try{t(e)}catch{}}}class KIe{constructor(e){Object.defineProperty(this,"providers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"intervals",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"registry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isRunning",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.registry=e}registerProvider(e){const t={...e,refreshInterval:e.refreshInterval??5e3,priority:e.priority??1,enabled:e.enabled??!0,defaultTags:e.defaultTags??[],defaultCategory:e.defaultCategory??"discovered"};this.providers.set(e.id,t),this.isRunning&&t.enabled&&this.startProviderInterval(t)}unregisterProvider(e){return this.providers.get(e)?(this.stopProviderInterval(e),this.providers.delete(e),!0):!1}start(){if(!this.isRunning){this.isRunning=!0;for(const e of this.providers.values())e.enabled&&this.startProviderInterval(e);this.discover().catch(()=>{})}}stop(){if(this.isRunning){this.isRunning=!1;for(const e of this.providers.keys())this.stopProviderInterval(e)}}async discover(){const e=[];for(const t of this.providers.values())t.enabled&&e.push(this.discoverFromProvider(t));await Promise.allSettled(e)}getProviders(){return Array.from(this.providers.values())}setProviderEnabled(e,t){const r=this.providers.get(e);return r?(r.enabled=t,this.isRunning&&(t?this.startProviderInterval(r):this.stopProviderInterval(e)),!0):!1}startProviderInterval(e){if(this.stopProviderInterval(e.id),e.refreshInterval&&e.refreshInterval>0){const t=setInterval(()=>{this.discoverFromProvider(e).catch(()=>{})},e.refreshInterval);this.intervals.set(e.id,t)}}stopProviderInterval(e){const t=this.intervals.get(e);t&&(clearInterval(t),this.intervals.delete(e))}async discoverFromProvider(e){try{const t=await e.provider();for(const r of t){const i=this.processPOI(r,e);this.registry.addPOI(i)}}catch{}}processPOI(e,t){return{...e,category:e.category||"discovered",tags:[...e.tags],priority:e.priority??t.priority??1,metadata:{...e.metadata,providerId:t.id,providerName:t.name}}}}class qIe{constructor(){Object.defineProperty(this,"pois",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"eventCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set})}addPOI(e){const t=this.pois.get(e.id),r={...e,priority:e.priority??1,active:e.active??!0,timestamp:e.timestamp??Date.now()};this.pois.set(e.id,r),this.emitEvent({type:t?"poi-updated":"poi-added",poi:r,timestamp:Date.now()})}removePOI(e){const t=this.pois.get(e);return t?(this.pois.delete(e),this.emitEvent({type:"poi-removed",poi:t,timestamp:Date.now()}),!0):!1}updatePOI(e){if(!this.pois.has(e.id))return!1;const t={...e,timestamp:Date.now()};return this.pois.set(e.id,t),this.emitEvent({type:"poi-updated",poi:t,timestamp:Date.now()}),!0}getPOI(e){return this.pois.get(e)}getAllPOIs(){return Array.from(this.pois.values())}findNearbyPOIs(e,t){const r=[];for(const i of this.pois.values()){if(!i.active)continue;this.getDistanceToBox(e,i.bounds3D)<=t&&r.push(i)}return r.sort((i,a)=>{const o=this.getDistanceToBox(e,i.bounds3D),s=this.getDistanceToBox(e,a.bounds3D);return o-s}),r}queryPOIs(e){let t=Array.from(this.pois.values());return t=t.filter(r=>r.active),e.category&&(t=t.filter(r=>r.category===e.category)),e.tags&&e.tags.length>0&&(t=t.filter(r=>e.tags.some(i=>r.tags.includes(i)))),e.radius!==void 0&&(t=t.filter(r=>this.getDistanceToBox(e.center,r.bounds3D)<=e.radius)),e.bounds&&(t=t.filter(r=>this.boxIntersects(r.bounds3D,e.bounds))),e.sortByDistance===!0&&t.sort((r,i)=>{const a=this.getDistanceToBox(e.center,r.bounds3D),o=this.getDistanceToBox(e.center,i.bounds3D);return a-o}),e.limit&&e.limit>0&&(t=t.slice(0,e.limit)),t}subscribe(e){return this.eventCallbacks.add(e),()=>{this.eventCallbacks.delete(e)}}clear(){const e=Array.from(this.pois.keys());for(const t of e)this.removePOI(t)}emitEvent(e){for(const t of this.eventCallbacks)try{t(e)}catch{}}getDistanceToBox(e,t){const r=Math.max(t.x,Math.min(e.x,t.x+t.width)),i=Math.max(t.y,Math.min(e.y,t.y+t.height)),a=Math.max(t.z,Math.min(e.z,t.z+t.depth)),o=e.x-r,s=e.y-i,c=e.z-a;return Math.sqrt(o*o+s*s+c*c)}boxIntersects(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y&&e.z<t.z+t.depth&&e.z+e.depth>t.z}getPOIsByCategory(e){return this.queryPOIs({center:{x:0,y:0,z:0},category:e})}getPOIsByTag(e){return this.queryPOIs({center:{x:0,y:0,z:0},tags:[e]})}getCount(){return this.pois.size}hasPOI(e){return this.pois.has(e)}getPOIsInBounds(e){return this.queryPOIs({center:{x:0,y:0,z:0},bounds:e})}}class WIe{constructor(e){Object.defineProperty(this,"registry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"discoveryManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"navigationSystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"eventListeners",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.config={movementSpeed:100,detectionRadius:150,updateInterval:16,debug:!1,autoStartNavigation:!0,autoStartDiscovery:!0,speedCategories:this.getDefaultSpeedCategories(),...e},this.config.initialPosition={...this.config.initialPosition,x:0,y:0,z:0},this.registry=e.customRegistry??new qIe,this.discoveryManager=e.customDiscoveryManager??new KIe(this.registry),this.navigationSystem=new GIe(this.config.initialPosition,this.registry,this.discoveryManager,this.config),this.setupEventForwarding()}async initialize(){if(!this.isInitialized)try{this.config.autoStartDiscovery&&await this.discoveryManager.discover(),this.config.autoStartNavigation&&this.navigationSystem.startNavigation(),this.isInitialized=!0,this.emitEvent({type:"poi-added",timestamp:Date.now(),metadata:{action:"system-initialized"}})}catch(e){throw new Error(`Failed to initialize POI Assistant Manager: ${String(e)}`)}}shutdown(){if(this.isInitialized)try{this.navigationSystem.stopNavigation(),this.discoveryManager.stop(),this.registry.clear(),this.isInitialized=!1,this.emitEvent({type:"poi-removed",timestamp:Date.now(),metadata:{action:"system-shutdown"}})}catch(e){throw new Error(`Failed to shutdown POI Assistant Manager: ${String(e)}`)}}update(){this.isInitialized&&this.navigationSystem.update()}getRegistry(){return this.registry}getDiscoveryManager(){return this.discoveryManager}getNavigationSystem(){return this.navigationSystem}getCharacterState(){return this.navigationSystem.getCharacterState()}setCharacterPosition(e){this.navigationSystem.setPosition(e)}addPOI(e){this.registry.addPOI(e)}addPOIs(e){for(const t of e)this.registry.addPOI(t)}removePOI(e){return this.registry.removePOI(e)}removePOIs(e){const t=[],r=[];for(const i of e)this.registry.removePOI(i)?t.push(i):r.push(i);return{removed:t,notFound:r}}removePOIsByCategory(e){const t=this.registry.getPOIsByCategory(e),r=[];for(const i of t)this.registry.removePOI(i.id)&&r.push(i.id);return r}removePOIsByTag(e){const t=this.registry.getPOIsByTag(e),r=[];for(const i of t)this.registry.removePOI(i.id)&&r.push(i.id);return r}clearPOIs(){const e=this.registry.getAllPOIs().length;return this.registry.clear(),e}getAllPOIs(){return this.registry.getAllPOIs()}findNearbyPOIs(e,t){return this.registry.findNearbyPOIs(e,t)}subscribe(e){this.eventListeners.push(e);const t=this.registry.subscribe(e);return this.navigationSystem.addEventListener(e),()=>{const r=this.eventListeners.indexOf(e);r>-1&&this.eventListeners.splice(r,1),t(),this.navigationSystem.removeEventListener(e)}}getStatus(){const e=this.navigationSystem.getCharacterState();return{initialized:this.isInitialized,characterPosition:e.position,poiCount:this.registry.getAllPOIs().length,isNavigating:e.isMoving}}getSpeedCategories(){return this.config.speedCategories??{}}setSpeedCategories(e){this.config.speedCategories=e}addSpeedCategory(e,t){var r;(r=this.config).speedCategories??(r.speedCategories={}),this.config.speedCategories[e]=t}getSpeedFromCategory(e){var r;const t=(r=this.config.speedCategories)==null?void 0:r[e];return t?t.speed:this.config.movementSpeed??2}setMovementSpeedByCategory(e){const t=this.getSpeedFromCategory(e);return t!==this.config.movementSpeed?(this.config.movementSpeed=t,!0):!1}getDefaultSpeedCategories(){return{crawl:{name:"Crawl",speed:.3,description:"Extremely slow, careful movement"},slow:{name:"Slow",speed:.8,description:"Deliberate, thoughtful movement"},relaxed:{name:"Relaxed",speed:1.5,description:"Casual, comfortable movement"},normal:{name:"Normal",speed:2.5,description:"Standard movement speed"},quick:{name:"Quick",speed:4,description:"Energetic, purposeful movement"},fast:{name:"Fast",speed:6.5,description:"Rapid, urgent movement"},rush:{name:"Rush",speed:10,description:"Very fast, excited movement"},dash:{name:"Dash",speed:15,description:"Nearly instant movement"},teleport:{name:"Teleport",speed:50,description:"Instant movement for demos"}}}updateSpeedCategoriesFromActmi(e){var t;if((t=e.poiSettings)!=null&&t.speedCategories){const r={};for(const i of e.poiSettings.speedCategories){const a=i.name.toLowerCase().replace(/\s+/g,"_");r[a]=i}this.config.speedCategories=r}}updatePOIConfigurationFromActmi(e){var t;this.updateSpeedCategoriesFromActmi(e),(t=e.poiSettings)!=null&&t.initialPOIs&&(this.clearPOIs(),this.addPOIs(e.poiSettings.initialPOIs))}setupEventForwarding(){this.registry.subscribe(e=>{this.emitEvent(e)}),this.navigationSystem.addEventListener(e=>{this.emitEvent(e)})}emitEvent(e){for(const t of this.eventListeners)try{t(e)}catch{}}}const YIe={movementSpeed:100,detectionRadius:150,updateInterval:16,debug:!1,initialPosition:{x:0,y:0,z:0}};function QIe(n={}){return new WIe({...YIe,...n})}function JIe(n){var i,a;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t||!r.materialId||!r.blockName){w.warn("behaviors","dev","animateInputBlock requires materialId and blockName");return}try{const o={target:r.materialId,property:`inputBlocks.${r.blockName}`,keyframes:r.keyframes,duration:r.duration,easing:r.easing,loop:r.loop},s=t.animateProperty(o);if(r.animationId&&n.behavior){const c=n.behavior;(a=c.state).activeAnimations??(a.activeAnimations=[]),c.state.activeAnimations.push(s)}e==null||e.emit(new Pe("shader","input-block-animation-started",{animationId:s,materialId:r.materialId,blockName:r.blockName}))}catch(o){w.error("behaviors","dev","Failed to animate input block",o)}}function ZIe(n){var i;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t){w.error("behaviors","dev","ShaderManager not available in frame context");return}if(!r.materialId||!r.blockName){w.error("behaviors","dev","Missing required parameters: materialId, blockName");return}try{const a={target:r.materialId,property:`inputBlocks.${r.blockName}`,duration:r.duration/1e3,keyframes:[{time:0,value:r.from},{time:1,value:r.to}],loop:r.loop,autoReverse:r.pingPong,easing:r.animationType??"linear"},o=t.animateProperty(a);return e==null||e.emit(new Pe("shader","property-animation-started",{target:r.materialId,property:r.blockName,animationId:o})),o}catch(a){w.error("behaviors","dev","Failed to animate material property:",a);return}}let kw=null;function XIe(n){var o,s,c;const{eventManager:e}=n.behavior,t=n.params;if(!e){w.warn("behaviors","dev","EventManager not found in context for appearance configuration");return}const r=(c=(s=(o=n.frameContext)==null?void 0:o.app)==null?void 0:s.characterManager)==null?void 0:c.currentCharacter,i=t.configPath??(r==null?void 0:r.shaderConstantMapping)??"assets/settings/appearance-mapping.json",a=t.forceReload??!1;try{if(kw&&!a){w.log("behaviors","dev","Using cached appearance mapping config"),e.emit(new Pe("appearance","appearance-configuration-loaded",{config:kw,source:"cache",timestamp:performance.now()}));return}w.log("behaviors","dev","Loading appearance mapping configuration",{configPath:i,forceReload:a}),eAe(i).then(u=>{kw=u,w.log("behaviors","dev","Appearance mapping configuration loaded successfully"),e.emit(new Pe("appearance","appearance-configuration-loaded",{config:u,source:"file",configPath:i,timestamp:performance.now()}))}).catch(u=>{w.error("behaviors","dev","Failed to load appearance mapping config:",u),e.emit(new Pe("appearance","appearance-configuration-error",{error:u instanceof Error?u.message:String(u),configPath:i,timestamp:performance.now()}))});return}catch(u){w.error("behaviors","dev","Failed to process appearance configuration request",u),e.emit(new Pe("appearance","appearance-configuration-error",{error:u instanceof Error?u.message:String(u),configPath:i,timestamp:performance.now()}));return}}async function eAe(n){try{const e=await fetch(n);if(!e.ok)throw new Error(`Failed to load appearance mapping config: ${e.statusText}`);const t=await e.json();return tAe(t),t}catch(e){throw w.error("behaviors","dev","Error loading appearance mapping config:",e),e}}function tAe(n){if(!n||typeof n!="object")throw new Error("Appearance mapping config must be an object");const e=n;if(!Array.isArray(e.colorMappings))throw new Error("Appearance mapping config must have colorMappings array");if(!Array.isArray(e.propMappings))throw new Error("Appearance mapping config must have propMappings array");for(const[t,r]of e.colorMappings.entries()){if(!r||typeof r!="object")throw new Error(`Color mapping at index ${t} must be an object`);const i=r;if(!sO(i.target))throw new Error(`Color mapping at index ${t} must have a valid target object with materialKey and propertyName`);if(!["mainColor","secondaryColor"].includes(i.source))throw new Error(`Color mapping at index ${t} must have valid source (mainColor or secondaryColor)`)}for(const[t,r]of e.propMappings.entries()){if(!r||typeof r!="object")throw new Error(`Prop mapping at index ${t} must be an object`);const i=r;if(!sO(i.target))throw new Error(`Prop mapping at index ${t} must have a valid target object with materialKey and propertyName`);if(!["hat","glasses","accessory"].includes(i.source))throw new Error(`Prop mapping at index ${t} must have valid source (hat, glasses, or accessory)`)}w.log("behaviors","dev","Appearance mapping configuration validation passed")}function sO(n){if(!n||typeof n!="object")return!1;const e=n;return!(typeof e.materialKey!="string"||!e.materialKey||typeof e.propertyName!="string"||!e.propertyName||e.arrayIndex!==void 0&&typeof e.arrayIndex!="number"||e.finalProperty!==void 0&&typeof e.finalProperty!="string")}function nAe(n){var i;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t||!e){w.warn("behaviors","dev","ShaderManager or EventManager not found in context for appearance update");return}if(!r.appearanceData){w.warn("behaviors","dev","AppearanceUpdateEventHandler requires appearanceData parameter");return}try{w.log("shader-manager","dev","[APPEARANCE] Starting appearance update workflow in FSM action handler",r.appearanceData),e.emit(new Pe("appearance","appearance-update-requested",{appearanceData:r.appearanceData,timestamp:performance.now()})),e.emit(new Pe("appearance","appearance-configuration-load",{timestamp:performance.now()})),e.emit(new Pe("appearance","appearance-color-mapping",{colors:r.appearanceData.body,timestamp:performance.now()})),e.emit(new Pe("appearance","appearance-prop-mapping",{props:r.appearanceData.props,timestamp:performance.now()})),w.log("behaviors","dev","Appearance update events emitted successfully");return}catch(a){w.error("behaviors","dev","Failed to process appearance update",a),e.emit(new Pe("appearance","appearance-update-error",{error:a instanceof Error?a.message:String(a),appearanceData:r.appearanceData,timestamp:performance.now()}));return}}function rAe(n){var i;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t){w.warn("behaviors","dev","ShaderManager not found in FrameContext for applyColorPalette action");return}try{t.applyColorPaletteToGradientBlocks(r.materialId,r.paletteData);const a=Object.keys(r.paletteData).length;e==null||e.emit(new Pe("shader","color-palette-applied",{materialId:r.materialId,blockCount:a,action:"applyColorPalette"}));const o=r.materialId?`material: ${r.materialId}`:"all materials (catch-all mode)";w.log("behaviors","dev",`Applied color palette to ${a} blocks in ${o}`)}catch(a){const o=a instanceof Error?a.message:"Unknown error";o.includes("NodeMaterial not found")?(w.warn("behaviors","dev",`Material ${r.materialId??"ALL_MATERIALS"} not found for color palette application. This may occur if the material is still loading asynchronously.`),e==null||e.emit(new Pe("shader","action-warning",{action:"applyColorPalette",materialId:r.materialId??"ALL_MATERIALS",warning:"Material not found - may still be loading"}))):(w.error("behaviors","dev","Failed to execute applyColorPalette action",a),e==null||e.emit(new Pe("shader","action-error",{action:"applyColorPalette",materialId:r.materialId??"ALL_MATERIALS",error:o})))}}function iAe(n){var a,o,s,c;const{eventManager:e}=n.behavior,t=(a=n.frameContext)==null?void 0:a.shaderManager,r=(o=n.frameContext)==null?void 0:o.scene,i=n.params;if(!t){w.warn("behaviors","dev","assignMaterialToMesh requires shaderManager to be available");return}if(!r){w.warn("behaviors","dev","assignMaterialToMesh requires scene to be available");return}if(!i.materialId){w.warn("behaviors","dev","assignMaterialToMesh requires materialId parameter");return}if(!i.meshes){w.warn("behaviors","dev","assignMaterialToMesh requires meshes parameter");return}try{const u=t.activeMaterials.get(i.materialId);if(!u){w.warn("behaviors","dev",`Material with ID '${i.materialId}' not found in shader manager`);return}const h=(c=(s=n.frameContext)==null?void 0:s.app)==null?void 0:c.getMeshesByNameOrGroup(i.meshes);if(!h||h.length===0){w.warn("behaviors","dev",`No meshes found for '${Array.isArray(i.meshes)?i.meshes.join(", "):i.meshes}' in scene`);return}const f=[];for(const p of h)p.material=u,f.push(p.name),w.log("behaviors","dev",`Assigned material '${i.materialId}' to mesh '${p.name}'`);e==null||e.emit(new Pe("shader","material-assigned-to-mesh",{materialId:i.materialId,meshes:i.meshes,assignedMeshNames:f})),w.log("behaviors","dev",`Successfully assigned material '${i.materialId}' to ${f.length} mesh(es)`)}catch(u){w.error("behaviors","dev","Failed to assign material to mesh:",u);let h;typeof u=="object"&&u!==null&&"message"in u&&typeof u.message=="string"?h=u.message:h=String(u),e==null||e.emit(new Pe("shader","material-assign-error",{materialId:i.materialId,meshes:i.meshes,error:h}))}}function aAe(n){var i;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t){w.warn("behaviors","dev","ShaderManager not found in FrameContext for assignTexturesBatch action");return}if(!r.materialId){w.warn("behaviors","dev","Missing required parameters for assignTexturesBatch action");return}try{t.assignTexturesToNodeMaterial(r.materialId,r.textureAssignments),e==null||e.emit(new Pe("shader","textures-batch-assigned",{materialId:r.materialId,assignmentCount:r.textureAssignments.length,action:"assignTexturesBatch"})),w.log("behaviors","dev",`Assigned ${r.textureAssignments.length} textures to material: ${r.materialId}`)}catch(a){w.error("behaviors","dev","Failed to execute assignTexturesBatch action",a),e==null||e.emit(new Pe("shader","action-error",{action:"assignTexturesBatch",materialId:r.materialId,error:a instanceof Error?a.message:"Unknown error"}))}}function oAe(n){var i;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t){w.warn("behaviors","dev","ShaderManager not found in FrameContext for batchSetInputBlocks action");return}try{t.batchSetInputBlockValues(r.materialId,r.blockValues),e==null||e.emit(new Pe("shaderManager","input-blocks-batch-updated",{materialId:r.materialId,updateCount:r.blockValues.length,action:"batchSetInputBlocks"}));const a=r.materialId?`material: ${r.materialId}`:"all materials (catch-all mode)";w.log("behaviors","dev",`Updated ${r.blockValues.length} input blocks for ${a}`)}catch(a){w.error("behaviors","dev","Failed to execute batchSetInputBlocks action",a),e==null||e.emit(new Pe("shader","action-error",{action:"batchSetInputBlocks",materialId:r.materialId??"ALL_MATERIALS",error:a instanceof Error?a.message:"Unknown error"}))}}function sAe(n){var i,a;const e=(i=n.frameContext)==null?void 0:i.shaderManager,{eventManager:t}=n.behavior,r=n.params;if(!e){w.warn("behaviors","dev","shader-cleanup-unused-assets requires shaderManager in FrameContext");return}try{const o=e,s=o.textureAssets,c=o.activeMaterials;if(!(s instanceof Map)||!(c instanceof Map)){w.warn("behaviors","dev","shader-cleanup-unused-assets could not access internal maps (textureAssets / activeMaterials)");return}const u=(r==null?void 0:r.logOnly)===!0,h=new Set((r==null?void 0:r.exclude)??[]),f=(r==null?void 0:r.cleanTextures)!==!1,p=(r==null?void 0:r.cleanMaterials)!==!1,g=new Set((r==null?void 0:r.materialExclude)??[]),v=[],y=[],b=[],C=[],S=[],E=[],T=[],A=[],I=[],k=[];let x;if(w.log("behaviors","dev",`[shader-cleanup-unused-assets] Starting cleanup (logOnly=${u}) cleanTextures=${f} cleanMaterials=${p} - Registered textures: ${s.size}`),p)try{const _=(a=n.frameContext)==null?void 0:a.scene,R=new Set;if(_!=null&&_.meshes)for(const j of _.meshes){const J=j,D=J==null?void 0:J.material;if(D){R.add(D);const F=D;if(Array.isArray(F==null?void 0:F.subMaterials))for(const ie of F.subMaterials)ie&&R.add(ie)}if(Array.isArray(J==null?void 0:J.subMeshes)&&J.subMeshes.length>0)for(const F of J.subMeshes)try{if(typeof F.getMaterial=="function"){const ie=F.getMaterial();if(ie){R.add(ie);const U=ie;if(Array.isArray(U==null?void 0:U.subMaterials))for(const W of U.subMaterials)W&&R.add(W)}}}catch{}}w.log("behaviors","dev",`[shader-cleanup-unused-assets] Material cleanup starting (logOnly=${u}) - Active materials: ${c.size}`);const z=[];for(const[j,J]of c){if(E.push(j),g.has(j)){k.push(j),I.push(j);continue}R.has(J)?I.push(j):(T.push(j),u?w.log("behaviors","dev",`[shader-cleanup-unused-assets] (logOnly) Unused material detected '${j}'`):z.push(j))}if(!u&&z.length>0)for(const j of z)try{e.disposeMaterial(j),A.push(j),w.log("behaviors","dev",`[shader-cleanup-unused-assets] Disposed unused material '${j}'`)}catch(J){w.warn("behaviors","dev",`[shader-cleanup-unused-assets] Error disposing material '${j}'`,J)}w.log("behaviors","dev",`[shader-cleanup-unused-assets] Material cleanup complete: examined=${E.length} cleaned=${A.length} kept=${I.length} unused=${T.length} excluded=${k.length}`)}catch(_){w.warn("behaviors","dev","[shader-cleanup-unused-assets] Material cleanup phase failed",_)}if(f){x=new Set;for(const[,_]of c){const R=_.getTextureBlocks;if(typeof R=="function")try{const z=R();for(const j of z)j.texture&&x.add(j.texture)}catch{}try{const z=_;if(typeof z.getActiveTextures=="function"){const j=z.getActiveTextures();if(Array.isArray(j))for(const J of j)J&&x.add(J)}}catch{}}for(const[_,R]of s.entries()){if(v.push(_),h.has(_)){S.push(_),C.push(_);continue}const z=R.texture;if(!z){y.push(_),u?w.log("behaviors","dev",`[shader-cleanup-unused-assets] (logOnly) Would remove placeholder/unloaded texture asset '${_}'`):(s.delete(_),b.push(_),w.log("behaviors","dev",`[shader-cleanup-unused-assets] Removed placeholder/unloaded texture asset '${_}'`));continue}if(x.has(z))C.push(_);else if(y.push(_),u)w.log("behaviors","dev",`[shader-cleanup-unused-assets] (logOnly) Unused texture detected '${_}'`);else{try{typeof z.dispose=="function"&&z.dispose()}catch(J){w.warn("behaviors","dev",`[shader-cleanup-unused-assets] Error disposing texture '${_}'`,J)}s.delete(_),b.push(_),w.log("behaviors","dev",`[shader-cleanup-unused-assets] Disposed unused texture '${_}'`)}}}t==null||t.emit(new Pe("shader","shader-unused-assets-cleanup-complete",{texturesExamined:v.length,texturesCleaned:b.length,texturesKept:C.length,texturesUnused:y,texturesExcluded:S,logOnly:u,cleanTextures:f,materialsExamined:E.length,materialsCleaned:A.length,materialsKept:I.length,materialsUnused:T,materialsExcluded:k,cleanMaterials:p})),w.log("behaviors","dev",`[shader-cleanup-unused-assets] Complete: texturesExamined=${v.length} texturesCleaned=${b.length} texturesKept=${C.length} texturesUnused=${y.length} texturesExcluded=${S.length} logOnly=${u} cleanTextures=${f} materialsExamined=${E.length} materialsCleaned=${A.length} materialsKept=${I.length} materialsUnused=${T.length} materialsExcluded=${k.length} cleanMaterials=${p}`)}catch(o){w.error("behaviors","dev","[shader-cleanup-unused-assets] Unexpected failure",o)}}function cAe(n){var u;const{eventManager:e}=n.behavior,t=(u=n.frameContext)==null?void 0:u.scene,r=n.params;if(!t){w.warn("behaviors","dev","shader-create-glow-layer requires a scene in FrameContext");return}const i=(r==null?void 0:r.name)??"glow",a=(r==null?void 0:r.intensity)??.1,o=(r==null?void 0:r.meshNames)??[],s=(r==null?void 0:r.useOwnMaterials)!==!1,c=(r==null?void 0:r.replaceExisting)!==!1;try{const{GlowLayer:h}=he.getCore();if(c){const v=t.effectLayers.find(y=>y.name===i);if(v)try{v.dispose(),w.log("behaviors","dev",`[shader-create-glow-layer] Disposed existing GlowLayer with name '${i}'`)}catch(y){w.warn("behaviors","dev",`[shader-create-glow-layer] Failed disposing existing GlowLayer '${i}'`,y)}}const f=new h(i,t,{mainTextureFixedSize:void 0,blurKernelSize:32});f.intensity=a;const p=[],g=[];if(o.length>0)for(const v of o){const y=t.getMeshByName(v);if(y)if(s)try{f.referenceMeshToUseItsOwnMaterial(y),p.push(v)}catch(b){w.warn("behaviors","dev",`[shader-create-glow-layer] Failed referencing mesh '${v}'`,b)}else p.push(v);else g.push(v)}g.length>0&&w.warn("behaviors","dev",`[shader-create-glow-layer] Missing meshes: ${g.join(", ")}`),w.log("behaviors","dev",`[shader-create-glow-layer] Created GlowLayer '${i}' intensity=${a} referenced=${p.length}`),e==null||e.emit(new Pe("shader","shader-glow-layer-created",{layerName:i,intensity:a,referencedMeshes:p,missingMeshes:g,action:"createGlowLayer"}))}catch(h){w.error("behaviors","dev","[shader-create-glow-layer] Failed to create GlowLayer",h),e==null||e.emit(new Pe("shader","action-error",{action:"createGlowLayer",layerName:i,error:h instanceof Error?h.message:"Unknown error"}))}}function lAe(n){var i,a;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t||!r.templateId||!r.materialId){w.warn("behaviors","dev","createMaterial action requires templateId and materialId");return}try{const o=t.createMaterialFromTemplate(r.templateId,r.materialId,r.properties);if(r.applyToMeshes&&r.meshNames&&((a=n.frameContext)!=null&&a.scene))for(const s of r.meshNames){const c=n.frameContext.scene.getMeshByName(s);c&&(c.material=o)}e==null||e.emit(new Pe("shaderManager","material-created",{materialId:r.materialId,templateId:r.templateId}))}catch(o){w.error("behaviors","dev","Failed to create material",o)}}function uAe(n,e){var r;if(!e||!((r=n.frameContext)!=null&&r.scene))return;const t=n.frameContext.scene;return t.getTransformNodeByName(e)??t.getMeshByName(e)}function dAe(n){var o,s;const{eventManager:e}=n.behavior,t=(o=n.frameContext)==null?void 0:o.scene,r=(s=n.frameContext)==null?void 0:s.shaderManager,i=n.params,{MeshBuilder:a}=he.getCore();if(!t){w.warn("behaviors","dev","createMesh requires scene to be available");return}if(!i.name){w.warn("behaviors","dev","createMesh requires name parameter");return}try{if(t.getMeshByName(i.name)){w.warn("behaviors","dev",`Mesh '${i.name}' already exists; createMesh will skip creation`),e==null||e.emit(new Pe("shader","mesh-created",{name:i.name,type:i.type,skipped:!0,reason:"already-exists"}));return}let u;switch(i.type){case"plane":{const f=i.size,p=typeof i.width=="number"||typeof i.height=="number"?{width:i.width??f??1,height:i.height??f??1}:{size:f??1};u=a.CreatePlane(i.name,p,t);break}case"box":{const f=i.size,p={};typeof f=="number"&&(p.size=f),typeof i.width=="number"&&(p.width=i.width),typeof i.height=="number"&&(p.height=i.height),typeof i.depth=="number"&&(p.depth=i.depth),u=a.CreateBox(i.name,p,t);break}case"sphere":{const f=typeof i.diameter=="number"?i.diameter:typeof i.size=="number"?i.size:1;u=a.CreateSphere(i.name,{diameter:f,segments:i.segments??16},t);break}default:{w.warn("behaviors","dev",`Unsupported mesh type '${String(i.type)}' in createMesh`);return}}const h=uAe(n,i.parent);if(h&&(u.parent=h),i.position&&u.position.set(i.position.x,i.position.y,i.position.z),i.rotation&&u.rotation.set(i.rotation.x,i.rotation.y,i.rotation.z),typeof i.renderingGroupId=="number"&&(u.renderingGroupId=i.renderingGroupId),typeof i.visible=="boolean"&&(u.isVisible=i.visible),i.materialId&&r){const f=r.activeMaterials.get(i.materialId);f?u.material=f:w.warn("behaviors","dev",`createMesh could not find material '${i.materialId}' to assign`)}w.log("behaviors","dev",`Created mesh '${i.name}' (type: ${String(i.type)})`),e==null||e.emit(new Pe("shader","mesh-created",{name:i.name,type:i.type,renderingGroupId:u.renderingGroupId,visible:u.isVisible,parent:i.parent??null,materialAssigned:!!u.material}))}catch(c){w.error("behaviors","dev","Failed to create mesh",c),e==null||e.emit(new Pe("shader","mesh-create-error",{name:i.name,type:i.type,error:c instanceof Error?c.message:typeof c=="string"?c:"Unknown error"}))}}function hAe(n){var i,a;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t||!r.assetName||!r.materialId){w.warn("behaviors","dev","createNodeMaterialInstance requires assetName and materialId");return}try{const o=t.createNodeMaterialInstance(r.assetName,r.materialId);if(r.state&&t.setMaterialState(r.materialId,r.state),r.inputBlockValues)for(const s of r.inputBlockValues)t.setInputBlockValue(r.materialId,s.blockName,s.value);if(r.textureLinks)for(const s of r.textureLinks)t.linkTextureToNodeMaterial(r.materialId,s.blockName,s.textureName);if(r.meshNames&&((a=n.frameContext)!=null&&a.scene))for(const s of r.meshNames){const c=n.frameContext.scene.getMeshByName(s);c&&(c.material=o)}e==null||e.emit(new Pe("shaderManager","node-material-instance-created",{materialId:r.materialId,assetName:r.assetName}))}catch(o){w.error("behaviors","dev","Failed to create NodeMaterial instance",o)}}function fAe(n){var i;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t){w.warn("behaviors","dev","ShaderManager not found in FrameContext for createProceduralTexture action");return}if(!r.name||!r.nodeMatJson){w.warn("behaviors","dev","Missing required parameters for createProceduralTexture action");return}try{t.createProceduralTexture(r).then(a=>{e==null||e.emit(new Pe("shaderManager","procedural-texture-created",{textureName:a.name,width:a.proceduralWidth,height:a.proceduralHeight,materialAssignment:r.assignToMaterial,action:"createProceduralTexture"})),w.log("behaviors","dev",`Created procedural texture: ${a.name} (${a.proceduralWidth}x${a.proceduralHeight})`)}).catch(a=>{w.error("behaviors","dev","Failed to create procedural texture",a),e==null||e.emit(new Pe("shaderManager","action-error",{action:"createProceduralTexture",textureName:r.name,error:a instanceof Error?a.message:"Unknown error"}))}),w.log("behaviors","dev",`Started creating procedural texture: ${r.name}`)}catch(a){w.error("behaviors","dev","Failed to execute createProceduralTexture action",a),e==null||e.emit(new Pe("shaderManager","action-error",{action:"createProceduralTexture",textureName:r.name,error:a instanceof Error?a.message:"Unknown error"}))}}function pAe(n){var a,o,s,c,u;const{eventManager:e}=n.behavior,t=(a=n.frameContext)==null?void 0:a.shaderManager,r=(o=n.frameContext)==null?void 0:o.scene,i=n.params;if(!t||!r){w.warn("behaviors","dev","shader-create-render-target-texture requires shaderManager and scene in FrameContext");return}if(!(i!=null&&i.name)){w.warn("behaviors","dev","shader-create-render-target-texture missing required 'name' parameter");return}try{const{RenderTargetTexture:h,Color4:f}=he.getCore(),p=i.width??2048,g=i.height??i.width??2048,v=i.generateMipMaps??!0,y=i.clearColor??[1,1,1,0],b=new h(i.name,{width:p,height:g},r,v,void 0,void 0,void 0,void 0,void 0,!0);if(b.name=i.name,b.clearColor=new f(y[0],y[1],y[2],y[3]),i.samples&&i.samples>0)try{b.samples=i.samples}catch(S){w.warn("behaviors","dev",`Failed to set samples=${i.samples} on RTT ${i.name}`,S)}if(r.customRenderTargets.push(b),(s=i.meshes)!=null&&s.length){const S=[],E=[];for(const T of i.meshes){const A=r.getMeshByName(T);A?((c=b.renderList)==null||c.push(A),S.push(T)):E.push(T)}E.length>0&&w.warn("behaviors","dev",`[shader-create-render-target-texture] Some meshes not found for RTT ${i.name}: ${E.join(", ")}`),w.log("behaviors","dev",`[shader-create-render-target-texture] Added ${S.length} meshes to RTT renderList (${i.name})`)}t.registerTextureAsset({name:i.name,texture:b,loadedTexture:!0,samplingMode:void 0});let C=!1;if(i.assignTo)try{t.assignTexturesToNodeMaterial(i.assignTo.materialId,[{blockName:i.assignTo.blockName,textureName:i.name}]),C=!0}catch(S){w.warn("behaviors","dev",`[shader-create-render-target-texture] Failed to assign RTT ${i.name} to ${i.assignTo.materialId}.${i.assignTo.blockName}`,S)}e==null||e.emit(new Pe("shader","shader-rtt-created",{textureName:i.name,width:p,height:g,mipMaps:v,clearColor:y,meshCount:((u=b.renderList)==null?void 0:u.length)??0,assigned:C,assignment:i.assignTo,action:"createRenderTargetTexture"})),w.log("behaviors","dev",`[shader-create-render-target-texture] Created RTT: ${i.name} (${p}x${g})${C?" and assigned":""}`)}catch(h){w.error("behaviors","dev","Failed to execute createRenderTargetTexture action",h),e==null||e.emit(new Pe("shader","action-error",{action:"createRenderTargetTexture",textureName:i.name,error:h instanceof Error?h.message:"Unknown error"}))}}function mAe(n){const e=n.params,t=n.frameContext;if(!(t!=null&&t.shaderManager)){w.error("shader-manager","dev","ShaderManager not available in frame context for disableAutoRebuild action");return}const r=t.shaderManager;try{const i=(e==null?void 0:e.preserveDirtyFlags)??!0,a=r.getDirtyMaterials();w.log("shader-manager","dev",`Disabling auto-rebuild (preserve dirty flags: ${i}). Currently ${a.length} dirty materials.`),r.setAutoRebuildEnabled(!1),i||(r.clearDirtyMaterials(),w.log("shader-manager","dev",`Cleared ${a.length} dirty material flags`));const{eventManager:o}=n.behavior;o==null||o.emit(new Pe("shaderManager","auto-rebuild-disabled",{enabled:!1,preservedDirtyFlags:i,dirtyMaterialsCount:r.getDirtyMaterials().length,clearedFlags:i?0:a.length})),w.log("shader-manager","dev",`Auto-rebuild disabled successfully. Current status: ${JSON.stringify(r.getAutoRebuildStatus())}`);return}catch(i){w.error("shader-manager","dev","Failed to disable auto-rebuild:",i);return}}function gAe(n){const e=n.params,t=n.frameContext;if(!(t!=null&&t.shaderManager)){w.error("shader-manager","dev","ShaderManager not available in frame context for enableAutoRebuild action");return}const r=t.shaderManager;try{const i=e==null?void 0:e.throttleMs;w.log("shader-manager","dev",`Enabling auto-rebuild${i!==void 0?` with ${i}ms throttle`:""}`),r.setAutoRebuildEnabled(!0,i);const{eventManager:a}=n.behavior;a==null||a.emit(new Pe("shaderManager","auto-rebuild-enabled",{enabled:!0,throttleMs:r.getAutoRebuildThrottleMs(),dirtyMaterialsCount:r.getDirtyMaterials().length})),w.log("shader-manager","dev",`Auto-rebuild enabled successfully. Current status: ${JSON.stringify(r.getAutoRebuildStatus())}`);return}catch(i){w.error("shader-manager","dev","Failed to enable auto-rebuild:",i);return}}function vAe(n){var s,c;const{eventManager:e}=n.behavior,t=(s=n.frameContext)==null?void 0:s.shaderManager,r=(c=n.frameContext)==null?void 0:c.scene,i=n.params;if(!t){w.warn("behaviors","dev","loadNodeMaterial requires shaderManager to be available");return}if(!i.assetName){w.warn("behaviors","dev","loadNodeMaterial requires assetName parameter");return}if(!i.nodeMatJson){w.warn("behaviors","dev","loadNodeMaterial requires nodeMatJson parameter");return}if(!i.nodeMatJson.json){w.warn("behaviors","dev","loadNodeMaterial requires nodeMatJson.json (object or file path string)");return}if(i.textureAssets)for(const u of i.textureAssets)t.registerTextureAsset(u);const{nodeMatJson:a,assetName:o}=i;t.loadNodeMaterialFromJson(a,o).then(u=>{var h,f;if(r&&i.meshes){const p=(f=(h=n.frameContext)==null?void 0:h.app)==null?void 0:f.getMeshesByNameOrGroup(i.meshes);if(!p){w.warn("behaviors","dev",`No meshes found for '${i.meshes}' in scene`);return}for(const g of p)g.material=u.material,w.log("behaviors","dev",`Assigned NodeMaterial '${o}' to mesh '${g.name}'`)}e==null||e.emit(new Pe("shader","node-material-loaded",{assetName:o,materialName:a.name}))}).catch(u=>{w.error("behaviors","dev","Failed to load NodeMaterial:",u);let h;typeof u=="object"&&u!==null&&"message"in u&&typeof u.message=="string"?h=u.message:h=String(u),e==null||e.emit(new Pe("shader","node-material-load-error",{assetName:o,error:h}))})}function bAe(n){var u,h;const{eventManager:e}=n.behavior,t=(u=n.frameContext)==null?void 0:u.shaderManager,r=(h=n.frameContext)==null?void 0:h.scene,i=n.params;if(!t||!r){w.warn("behaviors","dev","shader-load-textures requires shaderManager and scene in FrameContext");return}if(!(i!=null&&i.textures)||i.textures.length===0){w.warn("behaviors","dev","shader-load-textures missing 'textures' array parameter");return}const a=i.timeoutMs??1e4,{Texture:o}=he.getCore();w.log("behaviors","dev",`[shader-load-textures] Starting to load ${i.textures.length} textures`);const s=i.textures.map(f=>new Promise(p=>{const g={name:f.name,path:f.path,success:!1};try{f.forceReload&&t.isTextureCached(f.path)&&(t.forceReloadTexture(f.path),w.log("behaviors","dev",`[shader-load-textures] Forced cache reload for ${f.path}`));const v=new o(f.path,r),y=()=>{try{if(f.samplingMode!==void 0&&(v.updateSamplingMode(f.samplingMode),g.samplingMode=f.samplingMode),t.registerTextureAsset({name:f.name,texture:v,loadedTexture:!0,samplingMode:f.samplingMode}),f.assignToMaterial)try{t.linkTextureToNodeMaterial(f.assignToMaterial.materialId,f.assignToMaterial.blockName,f.name),g.assigned=!0}catch(S){w.warn("behaviors","dev",`[shader-load-textures] Failed assignment of ${f.name} to ${f.assignToMaterial.materialId}.${f.assignToMaterial.blockName}`,S)}g.success=!0,e==null||e.emit(new Pe("shader","shader-texture-loaded",{textureName:f.name,path:f.path,samplingMode:f.samplingMode,assigned:g.assigned??!1,action:"loadTextures"})),w.log("behaviors","dev",`[shader-load-textures] Loaded texture '${f.name}' from ${f.path}`)}catch(S){g.error=S instanceof Error?S.message:String(S)}finally{p(g)}},b=()=>{g.error=`Timeout after ${a}ms`,e==null||e.emit(new Pe("shader","shader-texture-load-error",{textureName:f.name,path:f.path,error:g.error,action:"loadTextures"})),w.error("behaviors","dev",`[shader-load-textures] Texture load timeout: ${f.path}`),p(g)};if(v.isReady()){y();return}const C=setTimeout(b,a);v.onLoadObservable.addOnce(()=>{clearTimeout(C),y()})}catch(v){g.error=v instanceof Error?v.message:String(v),e==null||e.emit(new Pe("shader","shader-texture-load-error",{textureName:f.name,path:f.path,error:g.error,action:"loadTextures"})),w.error("behaviors","dev",`[shader-load-textures] Failed to initiate texture load ${f.path}`,v),p(g)}})),c=f=>{const p=f.filter(v=>v.success).map(v=>v.name),g=f.filter(v=>!v.success);e==null||e.emit(new Pe("shader","shader-texture-batch-loaded",{requested:i.textures.length,loaded:p.length,failed:g.length,successNames:p,failedDetails:g.map(v=>({name:v.name,path:v.path,error:v.error})),action:"loadTextures"})),w.log("behaviors","dev",`[shader-load-textures] Batch complete: ${p.length}/${i.textures.length} loaded (${g.length} failed)`)};i.waitForAll?Promise.all(s).then(c).catch(f=>{w.error("behaviors","dev","[shader-load-textures] Unexpected batch error",f)}):Promise.all(s).then(c).catch(f=>{w.error("behaviors","dev","[shader-load-textures] Unexpected batch error (async)",f)})}function yAe(n){const e=n.params,t=n.frameContext;if(!(t!=null&&t.shaderManager)){w.error("shader-manager","dev","ShaderManager not available in frame context for rebuildMaterials action");return}const r=t.shaderManager;try{let i=0;const a=[];if(e!=null&&e.materialIds){w.log("shader-manager","dev",`Rebuilding ${e.materialIds.length} specific materials: ${e.materialIds.join(", ")}`);for(const s of e.materialIds)e.force?r.forceRebuildMaterial(s)&&(i++,a.push(s)):r.rebuildMaterial(s)&&(i++,a.push(s))}else{const s=r.getDirtyMaterials();w.log("shader-manager","dev",`Rebuilding all ${s.length} dirty materials`),i=r.rebuildDirtyMaterials(),a.push(...s.slice(0,i))}w.log("shader-manager","dev",`Material rebuild completed: ${i} materials rebuilt (${a.join(", ")})`);const{eventManager:o}=n.behavior;o==null||o.emit(new Pe("shaderManager","compile-complete",{rebuiltCount:i,rebuiltMaterials:a}));return}catch(i){w.error("shader-manager","dev","Failed to rebuild materials:",i);return}}function CAe(n){var a;const{eventManager:e}=n.behavior,t=(a=n.frameContext)==null?void 0:a.shaderManager,r=n.params;if(!t||!r.shaderId){w.warn("behaviors","dev","registerShader action requires valid ShaderManager and shaderId");return}const i={id:r.shaderId,name:r.shaderName,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms,attributes:r.attributes,defines:r.defines};t.registerShader(i),e==null||e.emit(new Pe("shader","shader-registered",{shaderId:r.shaderId}))}function SAe(n){var c,u,h;const e=(c=n.frameContext)==null?void 0:c.shaderManager,t=(u=n.frameContext)==null?void 0:u.scene,{eventManager:r}=n.behavior,i=n.params;if(!e||!t){w.warn("behaviors","dev","shader-register-untracked-assets requires shaderManager and scene in FrameContext");return}const a=(i==null?void 0:i.includeMaterials)!==!1,o=(i==null?void 0:i.includeTextures)!==!1,s=(i==null?void 0:i.verbose)===!0;try{const f=e,p=f.activeMaterials,g=f.textureAssets;if(!(p instanceof Map)||!(g instanceof Map)){w.warn("behaviors","dev","shader-register-untracked-assets could not access internal maps (activeMaterials / textureAssets)");return}let v=0,y=0,b=0,C=0,S=0,E=0;const T=new Set,A=new Set;if(a){for(const I of t.meshes){const k=I,x=k==null?void 0:k.material;if(x){T.add(x);const _=x;if(Array.isArray(_==null?void 0:_.subMaterials))for(const R of _.subMaterials)R&&T.add(R)}if(Array.isArray(k==null?void 0:k.subMeshes))for(const _ of k.subMeshes)try{if(typeof _.getMaterial=="function"){const R=_.getMaterial();if(R){T.add(R);const z=R;if(Array.isArray(z==null?void 0:z.subMaterials))for(const j of z.subMaterials)j&&T.add(j)}}}catch{}}v=T.size;for(const I of T){let k=!1;for(const[,x]of p)if(x===I){k=!0;break}if(k)y++,s&&w.log("behaviors","dev","[shader-register-untracked-assets] Material already tracked",{className:(h=I.getClassName)==null?void 0:h.call(I)});else try{const x=e.registerExternalMaterial(I);b++,s&&w.log("behaviors","dev",`[shader-register-untracked-assets] Registered material '${x}'`)}catch(x){w.warn("behaviors","dev","[shader-register-untracked-assets] Failed to register material",x)}}}if(o){const I=[];for(const[,k]of p)I.push(k);for(const k of I)try{if(k&&typeof k.getActiveTextures=="function"){const x=k.getActiveTextures();if(Array.isArray(x))for(const _ of x)_&&A.add(_)}}catch{}C=A.size;for(const k of A){let x=!1;for(const[,_]of g)if(_.texture===k){x=!0;break}if(x)S++,s&&w.log("behaviors","dev","[shader-register-untracked-assets] Texture already tracked",{name:k==null?void 0:k.name});else try{const _=e.registerExternalTexture(k);E++,s&&w.log("behaviors","dev",`[shader-register-untracked-assets] Registered texture '${_}'`)}catch(_){w.warn("behaviors","dev","[shader-register-untracked-assets] Failed to register texture",_)}}}w.log("behaviors","dev","[shader-register-untracked-assets] Summary",{includeMaterials:a,includeTextures:o,totalMaterialsDiscovered:v,materialsAlreadyTracked:y,materialsRegistered:b,totalTexturesDiscovered:C,texturesAlreadyTracked:S,texturesRegistered:E,verbose:s}),r==null||r.emit(new Pe("shader","shader-untracked-assets-registered",{includeMaterials:a,includeTextures:o,totalMaterialsDiscovered:v,materialsAlreadyTracked:y,materialsRegistered:b,totalTexturesDiscovered:C,texturesAlreadyTracked:S,texturesRegistered:E,verbose:s}))}catch(f){w.error("behaviors","dev","[shader-register-untracked-assets] Unexpected failure",f)}}function wAe(n){var i;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t||!r.materialId||!r.blockName){w.warn("behaviors","dev","setInputBlockValue requires materialId and blockName");return}try{t.setInputBlockValue(r.materialId,r.blockName,r.value),e==null||e.emit(new Pe("shader","input-block-updated",{materialId:r.materialId,blockName:r.blockName,value:r.value}))}catch(a){w.error("behaviors","dev","Failed to set input block value",a)}}function EAe(n,e){return e.split(".").reduce((t,r)=>t&&typeof t=="object"&&r in t?t[r]:void 0,n)}function TAe(n,e){const t=[],r={};if(!n||typeof n!="object")return{blockValues:t,gradientData:r};let i;for(const[a,o]of Object.entries(n)){if(typeof o=="number"){t.push({blockName:a,value:o});continue}if(typeof o=="string"&&o!=="#"){if(!i)try{i=he.getCore().Color3}catch{continue}const s=o.startsWith("#")?o:`#${o}`,c=i.FromHexString(s);t.push({blockName:a,value:c})}e&&Array.isArray(o)&&o.every(c=>{if(typeof c!="object"||c===null)return!1;const u=c;return typeof u.step=="number"&&typeof u.color=="string"})&&(r[a]=o)}return{blockValues:t,gradientData:r}}function IAe(n){var i;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t){w.warn("behaviors","dev","ShaderManager not found in FrameContext for setInputBlocksFromJson action");return}if(!r.jsonFilePath||!r.propertyPath){w.warn("behaviors","dev","Missing jsonFilePath or propertyPath parameter for setInputBlocksFromJson action");return}(async()=>{try{let a;try{a=await t.loadJson(r.jsonFilePath)}catch(h){w.error("behaviors","dev",`Failed to load or parse JSON file: ${r.jsonFilePath}`,h),e==null||e.emit(new Pe("shader","action-error",{action:"setInputBlocksFromJson",materialId:r.materialId??"ALL_MATERIALS",error:`File error: ${h instanceof Error?h.message:"Unknown file error"}`}));return}const o=EAe(a,r.propertyPath);if(!o){w.warn("behaviors","dev",`Property path '${r.propertyPath}' not found in JSON file: ${r.jsonFilePath}`);return}const{blockValues:s,gradientData:c}=TAe(o,r.processGradients??!1);if(s.length===0&&Object.keys(c).length===0){w.warn("behaviors","dev",`No processable properties found at path '${r.propertyPath}' in JSON file: ${r.jsonFilePath}`);return}s.length>0&&t.batchSetInputBlockValues(r.materialId,s),Object.keys(c).length>0&&r.processGradients&&t.applyColorPaletteToGradientBlocks(r.materialId,c),e==null||e.emit(new Pe("shader","input-blocks-json-updated",{materialId:r.materialId,jsonFilePath:r.jsonFilePath,propertyPath:r.propertyPath,updateCount:s.length,gradientCount:Object.keys(c).length,action:"setInputBlocksFromJson"})),e==null||e.emit(new Pe("shaderManager","process-complete",{materialId:r.materialId,processedBlocks:s.length,processedGradients:Object.keys(c).length}));const u=r.materialId?`material: ${r.materialId}`:"all materials (catch-all mode)";w.log("behaviors","dev",`Applied ${s.length} input blocks and ${Object.keys(c).length} gradients from JSON (${r.propertyPath}) to ${u}`)}catch(a){w.error("behaviors","dev","Failed to execute setInputBlocksFromJson action",a),e==null||e.emit(new Pe("shader","action-error",{action:"setInputBlocksFromJson",materialId:r.materialId??"ALL_MATERIALS",jsonFilePath:r.jsonFilePath,propertyPath:r.propertyPath,error:a instanceof Error?a.message:"Unknown error"}))}})()}function AAe(n){var i;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t||!r.materialId||!r.property){w.warn("behaviors","dev","setMaterialProperty requires materialId and property");return}try{t.setMaterialProperty(r.materialId,r.property,r.value),e==null||e.emit(new Pe("shader","property-updated",{materialId:r.materialId,property:r.property,value:r.value}))}catch(a){w.error("behaviors","dev","Failed to set material property",a)}}function kAe(n){var i;const{eventManager:e}=n.behavior,t=(i=n.frameContext)==null?void 0:i.shaderManager,r=n.params;if(!t||!r.materialId||!r.state){w.warn("behaviors","dev","setMaterialState requires materialId and state");return}try{t.setMaterialState(r.materialId,r.state),e==null||e.emit(new Pe("shader","material-state-changed",{materialId:r.materialId,state:r.state}))}catch(a){w.error("behaviors","dev","Failed to set material state",a)}}const xAe={"shader-animate-input-block":JIe,"shader-animate-material-property":ZIe,"shader-apply-color-palette":rAe,"shader-assign-material-to-mesh":iAe,"shader-assign-textures-batch":aAe,"shader-batch-set-input-blocks":oAe,"shader-cleanup-unused-assets":sAe,"shader-create-material":lAe,"shader-create-node-material-instance":hAe,"shader-create-procedural-texture":fAe,"shader-create-render-target-texture":pAe,"shader-create-glow-layer":cAe,"shader-create-mesh":dAe,"shader-disable-auto-rebuild":mAe,"shader-enable-auto-rebuild":gAe,"shader-load-node-material":vAe,"shader-load-textures":bAe,"shader-rebuild-materials":yAe,"shader-register-shader":CAe,"shader-register-untracked-assets":SAe,"shader-set-input-block-value":wAe,"shader-set-input-blocks-from-json":IAe,"shader-set-material-property":AAe,"shader-set-material-state":kAe,"appearance-update":nAe,"appearance-configuration-load":XIe};function _Ae(){return xAe}function gs(n){if(typeof n=="number")return n.toString();if(typeof n=="object"){if("x"in n&&"y"in n&&"z"in n&&"w"in n)return`(${n.x}, ${n.y}, ${n.z}, ${n.w})`;if("x"in n&&"y"in n&&"z"in n)return`(${n.x}, ${n.y}, ${n.z})`;if("x"in n&&"y"in n)return`(${n.x}, ${n.y})`}return String(n)}class $F{constructor(e){Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.eventManager=e}emitAppearanceEvent(e){const t=new Pe("appearance",e.type,e);this.eventManager.emit(t)}createAppearanceEvent(e,t){return{type:e,data:t,timestamp:Date.now()}}}class MAe extends $F{constructor(){super(...arguments),Object.defineProperty(this,"paletteData",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"mappingConfig",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"shaderManager",{enumerable:!0,configurable:!0,writable:!0,value:null})}async handleAppearanceUpdate(e){try{const t=await this.processAppearanceData(e);if(this.shaderManager&&Object.keys(t.shaderConstants).length>0){const r=new Map;for(const[i,a]of Object.entries(t.shaderConstants)){if(this.isGradientTargetString(i))continue;const o=this.extractMaterialFromTarget(i),s=this.extractBlockNameFromTarget(i),c=this.resolveMaterialId(o);this.isValidInputBlockValue(a)&&(r.has(c)||r.set(c,[]),r.get(c).push({blockName:s,value:a}))}for(const[i,a]of r)this.shaderManager.batchSetInputBlockValues(i,a)}return this.emitAppearanceEvent(this.createAppearanceEvent("appearanceUpdated",e)),{success:!0,updatedShaderConstants:t.shaderConstants,warnings:[]}}catch(t){return w.error("shader-manager","dev","[COLOR-MAPPING] ERROR: Failed to process appearance colors",{error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0,mainColor:e.body.mainColor,secondaryColor:e.body.secondaryColor,hasShaderManager:!!this.shaderManager,hasPaletteData:!!this.paletteData,hasMappingConfig:!!this.mappingConfig}),this.emitAppearanceEvent(this.createAppearanceEvent("appearanceError",e)),{success:!1,errors:[t instanceof Error?t.message:String(t)]}}}async processAppearanceData(e){const t={shaderConstants:{},meshVisibility:{},textureSwaps:{}};if(await this.loadConfigurations(),!this.mappingConfig)throw new Error("Failed to load mapping configuration");const r=[];for(const i of this.mappingConfig.colorMappings){const a=this.convertTargetToString(i.target);if(this.isTargetingGradientStep(i.target))this.processGradientStepMapping(i,e);else{const o=this.resolveSourceValue(e,i.source);if(o!==null)if(this.isGradientTarget(i.target)&&Array.isArray(o)&&this.isGradientArray(o))r.push({mapping:i,sourceValue:o});else{const s=this.processParameterValue(o,i);s!==null&&(t.shaderConstants[a]=s)}}}r.length>0&&this.processGradientMappings(r);for(const i of this.mappingConfig.propMappings){const a=this.convertTargetToString(i.target),o=this.getSourceProp(e,i.source);o?(t.meshVisibility[a]=!0,o!=="default"&&(t.textureSwaps[a]=o)):i.fallback&&(t.meshVisibility[i.fallback]=!0)}return Promise.resolve(t)}resolveSourceValue(e,t){return t==="mainColor"||t==="secondaryColor"?e.body[t]??null:t.startsWith("palette_00.")?this.resolvePalettePathWithArrays(t):null}resolvePalettePathWithArrays(e){if(!this.paletteData)return null;const r=e.replace(/\[(\d+)\]/g,".$1").split(".");let i=this.paletteData;for(const a of r)if(a)if(i&&typeof i=="object")if(Array.isArray(i)){const o=parseInt(a,10);if(!isNaN(o)&&o>=0&&o<i.length)i=i[o];else return null}else if(a in i)i=i[a];else return null;else return null;return i}isHexColor(e){return/^#[0-9A-Fa-f]{6}$/.test(e)}getSourceProp(e,t){return e.props[t]??null}applyColorModulation(e,t){const r=this.hexToColor3(e);if(!t.modulation)return r;const{function:i,intensity:a=1}=t.modulation;switch(i){case"lighten":return this.lightenColor(r,a);case"darken":return this.darkenColor(r,a);case"saturate":return this.saturateColor(r,a);case"desaturate":return this.desaturateColor(r,a);case"tint":return t.modulation.color?this.tintColor(r,t.modulation.color,a):r;case"multiply":return t.modulation.color?this.multiplyColor(r,t.modulation.color):r;default:return r}}hexToColor3(e){const t=e.replace("#",""),r=parseInt(t.substr(0,2),16)/255,i=parseInt(t.substr(2,2),16)/255,a=parseInt(t.substr(4,2),16)/255,{Color3:o}=he.getCore();return new o(r,i,a)}lightenColor(e,t){const{Color3:r}=he.getCore(),i=e;return new r(Math.min(1,i.r+t),Math.min(1,i.g+t),Math.min(1,i.b+t))}darkenColor(e,t){const{Color3:r}=he.getCore(),i=e;return new r(Math.max(0,i.r-t),Math.max(0,i.g-t),Math.max(0,i.b-t))}saturateColor(e,t){const{Color3:r}=he.getCore(),i=e,a=(i.r+i.g+i.b)/3;return new r(a+(i.r-a)*(1+t),a+(i.g-a)*(1+t),a+(i.b-a)*(1+t))}desaturateColor(e,t){const{Color3:r}=he.getCore(),i=e,a=(i.r+i.g+i.b)/3;return new r(i.r+(a-i.r)*t,i.g+(a-i.g)*t,i.b+(a-i.b)*t)}tintColor(e,t,r){const{Color3:i}=he.getCore(),a=e,o=t;return new i(a.r+(o.r-a.r)*r,a.g+(o.g-a.g)*r,a.b+(o.b-a.b)*r)}multiplyColor(e,t){const{Color3:r}=he.getCore(),i=e,a=t;return new r(i.r*a.r,i.g*a.g,i.b*a.b)}async loadConfigurations(){try{this.mappingConfig=await this.loadMappingConfiguration(),this.paletteData=await this.loadPaletteData()}catch(e){throw w.error("shader-manager","dev","[COLOR-MAPPING] ERROR: Failed to load configurations",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),e}}async loadMappingConfiguration(){try{const e=await fetch("/assets/settings/appearance-mapping.json");if(!e.ok)throw new Error(`Failed to load appearance-mapping.json: ${e.status} ${e.statusText}`);return await e.json()}catch(e){throw w.error("shader-manager","dev","[COLOR-MAPPING] ERROR: Failed to load appearance-mapping.json",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),e}}async loadPaletteData(){try{const e=await fetch("/assets/settings/colorVariation.json");if(!e.ok)throw new Error(`Failed to load colorVariation.json: ${e.status} ${e.statusText}`);return await e.json()}catch(e){throw w.error("shader-manager","dev","[COLOR-MAPPING] ERROR: Failed to load colorVariation.json",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),e}}processParameterValue(e,t){return typeof e=="string"&&this.isHexColor(e)?this.applyColorModulation(e,t):Array.isArray(e)&&this.isGradientArray(e)?this.processGradientData(e):(typeof e=="number"||typeof e=="boolean"||Array.isArray(e)||typeof e=="object"&&e!==null,e)}isGradientArray(e){return e.length>0&&typeof e[0]=="object"&&e[0]!==null&&"step"in e[0]&&"color"in e[0]}processGradientData(e){if(!Array.isArray(e))return e;const t=[],r=[];for(const i of e)i.color&&typeof i.step=="number"&&(t.push(this.hexToColor3(i.color)),r.push(i.step));return{colors:t,steps:r,length:e.length}}setShaderManager(e){this.shaderManager=e}isGradientTarget(e){return["gradient","Gradient","baseColorGradient","rimLight_gradient_left","rimLight_gradient_right","center_gradient","ring_gradient","bg_gradient"].some(r=>e.propertyName.includes(r))}isGradientTargetString(e){return["gradient","Gradient","baseColorGradient","rimLight_gradient_left","rimLight_gradient_right","center_gradient","ring_gradient","bg_gradient"].some(r=>e.includes(r))}convertTargetToString(e){let t=`${e.materialKey}.${e.propertyName}`;return e.arrayIndex!==void 0&&(t+=`[${e.arrayIndex}]`),e.finalProperty&&(t+=`.${e.finalProperty}`),t}isTargetingGradientStep(e){return e.arrayIndex!==void 0}processGradientStepMapping(e,t){try{const r=this.resolveSourceValue(t,e.source);if(typeof r!="string"||!this.isHexColor(r))return;const i=this.applyColorModulation(r,e),a=e.target.materialKey,o=e.target.propertyName,s=e.target.arrayIndex,c=e.target.finalProperty;if(s===void 0||c===void 0)return;const u=this.resolvePalettePathWithArrays(`palette_00.${a}.${o}`);if(!Array.isArray(u)||!this.isGradientArray(u))return;const h=[...u];if(s<h.length&&h[s]&&c==="color"&&typeof i=="object"&&i!==null){const f=i,p=this.color3ToHex(f);h[s]={...h[s],color:p}}if(this.shaderManager&&h.length>0){const f={[o]:h},p=this.resolveMaterialId(a);this.shaderManager.applyColorPaletteToGradientBlocks(p,f)}}catch(r){w.error("shader-manager","dev","[COLOR-MAPPING] Error processing gradient step mapping",r)}}color3ToHex(e){const t=r=>Math.round(Math.max(0,Math.min(255,r*255))).toString(16).padStart(2,"0");return`#${t(e.r)}${t(e.g)}${t(e.b)}`}processGradientMappings(e){if(!this.shaderManager)return;const t=new Map;for(const{mapping:r,sourceValue:i}of e){const a=i,o=r.target.materialKey,s=r.target.propertyName;t.has(o)||t.set(o,{});const c=t.get(o);c[s]=a,w.log("shader-manager","dev",`[COLOR-MAPPING] Prepared gradient mapping: ${o}.${s} -> ${a.length} steps`,{material:o,block:s,steps:a.length})}for(const[r,i]of t)try{const a=this.resolveMaterialId(r);this.shaderManager.applyColorPaletteToGradientBlocks(a,i)}catch(a){w.error("shader-manager","dev",`[COLOR-MAPPING] Failed to apply gradients to material: ${r}`,a)}}extractMaterialFromTarget(e){return typeof e=="string"?e.split(".")[0]??e:e.materialKey}extractBlockNameFromTarget(e){if(typeof e=="string"){let r=e.split(".")[1]??e;return r=r.replace(/\[\d+\].*$/,""),r}return e.propertyName}resolveMaterialId(e){var r;return(r=this.mappingConfig)!=null&&r.materialMappings?this.mappingConfig.materialMappings[e]??e:e}isValidInputBlockValue(e){if(typeof e=="number"||typeof e=="boolean")return!0;if(e&&typeof e=="object"){const{Color3:t,Color4:r,Vector2:i,Vector3:a}=he.getCore();return e instanceof t||e instanceof r||e instanceof i||e instanceof a}return!1}}let ff=null;class rp{async handleConfigurationLoad(e){const t=e.configPath??"assets/settings/appearance-mapping.json",r=e.forceReload??!1;try{if(ff&&!r)return{success:!0,config:ff,source:"cache",timestamp:performance.now()};const i=await this.loadAppearanceMappingConfig(t);return ff=i,{success:!0,config:i,source:"file",configPath:t,timestamp:performance.now()}}catch(i){return w.error("behaviors","dev","Failed to load appearance mapping config:",i),{success:!1,error:i instanceof Error?i.message:String(i),configPath:t,timestamp:performance.now()}}}static getCachedConfig(){return ff}static clearCache(){ff=null}async loadAppearanceMappingConfig(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`Failed to load appearance mapping config: ${t.statusText}`);const r=await t.json();return this.validateAppearanceMappingConfig(r),r}catch(t){throw w.error("behaviors","dev","Error loading appearance mapping config:",t),t}}validateAppearanceMappingConfig(e){if(!e||typeof e!="object")throw new Error("Appearance mapping config must be an object");const t=e;if(!Array.isArray(t.colorMappings))throw new Error("Appearance mapping config must have colorMappings array");if(!Array.isArray(t.propMappings))throw new Error("Appearance mapping config must have propMappings array");for(const[r,i]of t.colorMappings.entries()){if(!i||typeof i!="object")throw new Error(`Color mapping at index ${r} must be an object`);const a=i;if(!this.isValidAppearanceTarget(a.target))throw new Error(`Color mapping at index ${r} must have a valid target object with materialKey and propertyName`);if(typeof a.source!="string")throw new Error(`Color mapping at index ${r} must have a string source`)}for(const[r,i]of t.propMappings.entries()){if(!i||typeof i!="object")throw new Error(`Prop mapping at index ${r} must be an object`);const a=i;if(!this.isValidAppearanceTarget(a.target))throw new Error(`Prop mapping at index ${r} must have a valid target object with materialKey and propertyName`);if(!["hat","glasses","accessory"].includes(a.source))throw new Error(`Prop mapping at index ${r} must have valid source (hat, glasses, or accessory)`)}}isValidAppearanceTarget(e){if(!e||typeof e!="object")return!1;const t=e;return!(typeof t.materialKey!="string"||!t.materialKey||typeof t.propertyName!="string"||!t.propertyName||t.arrayIndex!==void 0&&typeof t.arrayIndex!="number"||t.finalProperty!==void 0&&typeof t.finalProperty!="string")}}class RAe extends $F{constructor(){super(...arguments),Object.defineProperty(this,"shaderManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mappingConfig",{enumerable:!0,configurable:!0,writable:!0,value:null})}setShaderManager(e){this.shaderManager=e}async handleAppearanceUpdate(e){try{const t=await this.processAppearanceData(e),r=Object.entries(t.textureSwaps);if(r.length>0&&this.shaderManager){const i=new Map;for(const[a,o]of r){if(!o)continue;const s=this.extractMaterialFromTarget(a),c=this.extractBlockNameFromTarget(a),u=this.resolveMaterialId(s);i.has(u)||i.set(u,[]),i.get(u).push({blockName:c,textureName:o})}for(const[a,o]of i)this.shaderManager.assignTexturesToNodeMaterial(a,o)}return{success:!0,updatedShaderConstants:t.shaderConstants,warnings:[]}}catch(t){return{success:!1,errors:[t instanceof Error?t.message:String(t)]}}}async processAppearanceData(e){const t={shaderConstants:{},meshVisibility:{},textureSwaps:{}};await this.ensureMappingConfig();const r=this.mappingConfig;for(const i of r.propMappings){const a=this.convertTargetToString(i.target),s=this.getSourceProp(e,i.source)??i.fallback??null;s?(t.meshVisibility[a]=!0,s!=="default"&&(t.textureSwaps[a]=s)):t.meshVisibility[a]=!1,t.shaderConstants[a]=s}return Promise.resolve(t)}getSourceProp(e,t){return e.props[t]??null}async ensureMappingConfig(){if(this.mappingConfig)return;const e=rp.getCachedConfig();if(e){this.mappingConfig=e;return}const r=await new rp().handleConfigurationLoad({});if(r.success&&r.config){this.mappingConfig=r.config;return}throw new Error(`Failed to load appearance mapping config: ${r.error??"unknown error"}`)}convertTargetToString(e){let t=`${e.materialKey}.${e.propertyName}`;return e.arrayIndex!==void 0&&(t+=`[${e.arrayIndex}]`),e.finalProperty&&(t+=`.${e.finalProperty}`),t}extractMaterialFromTarget(e){return typeof e=="string"?e.split(".")[0]??e:e.materialKey}extractBlockNameFromTarget(e){if(typeof e=="string"){let r=e.split(".")[1]??e;return r=r.replace(/\[\d+\].*$/,""),r}return e.propertyName}resolveMaterialId(e){var r,i;return((i=(r=this.mappingConfig)==null?void 0:r.materialMappings)==null?void 0:i[e])??e}}class PAe{constructor(e){Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"colorMappingHandler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"propMappingHandler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configurationHandler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shaderManager",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.eventManager=e,this.colorMappingHandler=new MAe(e),this.propMappingHandler=new RAe(e),this.configurationHandler=new rp}setShaderManager(e){this.shaderManager=e,this.colorMappingHandler.setShaderManager(e),this.propMappingHandler.setShaderManager(e)}getShaderManager(){return this.shaderManager}async handleAppearanceUpdate(e){try{const t=await this.configurationHandler.handleConfigurationLoad({});if(!t.success)return{success:!1,errors:[`Configuration load failed: ${t.error}`]};const r=await this.colorMappingHandler.handleAppearanceUpdate(e);if(!r.success)return r;const i=await this.propMappingHandler.handleAppearanceUpdate(e);return i.success?{success:!0,updatedShaderConstants:{...r.updatedShaderConstants,...i.updatedShaderConstants},warnings:[...r.warnings??[],...i.warnings??[]]}:i}catch(t){return w.error("shader-manager","dev","[APPEARANCE-ORCHESTRATOR] ERROR: Unexpected error in appearance update",{error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0,mainColor:e.body.mainColor,secondaryColor:e.body.secondaryColor}),{success:!1,errors:[t instanceof Error?t.message:String(t)]}}}async loadConfiguration(e,t){const r=await this.configurationHandler.handleConfigurationLoad({configPath:e,forceReload:t});if(!r.success)throw new Error(`Failed to load configuration: ${r.error}`)}static getCachedConfiguration(){return rp.getCachedConfig()}static clearConfigurationCache(){rp.clearCache()}dispose(){this.eventManager.clearQueuedEvents("appearance")}}class NAe{constructor(e,t,r,i){Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"contentManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"registeredShaders",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"materialTemplates",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"activeMaterials",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"nodeMatAssets",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"textureAssets",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"activeAnimations",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"materialStates",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"materialToTemplate",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"dirtyMaterials",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"lastRebuildAttempt",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"autoRebuildEnabled",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoRebuildThrottleMs",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"fsm",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"fsmInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"hasTriggeredStartLoading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"appearanceOrchestrator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.scene=e,this.eventManager=t,this.contentManager=r,this.appearanceOrchestrator=new PAe(t),this.appearanceOrchestrator.setShaderManager(this),this.initializeFSM(i)}async initializeFSM(e){if(!e){w.warn("shader-manager","dev","No shader state machine provided for FSM initialization");return}try{w.log("shader-manager","dev",`[FSM-INIT] Loading shader state machine: ${typeof e=="string"?e:"inline-definition"}`);const t=await this.loadJson(e);w.log("shader-manager","dev",`[FSM-INIT] Loaded FSM definitions with states: ${Object.keys(t).join(", ")}`);const i={..._Ae(),"debug-text":BF,"set-visibility":HF,"send-event":FF};this.fsm=new Qb(t,i,this.eventManager),this.eventManager.subscribe("shaderManager",this.onShaderManagerEvent.bind(this)),this.eventManager.subscribe("appearance",this.onAppearanceEvent.bind(this)),this.fsmInitialized=!0,w.log("shader-manager","dev","ShaderManager FSM initialized successfully"),this.eventManager.emit(new Pe("shaderManager","manager-initialized",{timestamp:performance.now(),fsmInitialized:!0}))}catch(t){w.error("shader-manager","dev","Failed to initialize ShaderManager FSM:",t)}}onShaderManagerEvent(e){if(w.log("shader-manager","dev",`[FSM-EVENT] ShaderManager received event: ${e.name}`,e.payload??{}),!this.fsm){w.warn("shader-manager","dev","[FSM-EVENT] No FSM available to handle event");return}this.fsm.onEventManagerEvent(e)}onAppearanceEvent(e){try{if(w.log("shader-manager","dev",`[Appearance->ShaderManager] event received: ${e.name}`,e.payload??{}),e.name==="updateAppearance"&&e.payload){const t=e.payload;this.handleAppearanceUpdate(t)}}catch(t){w.warn("shader-manager","dev","Failed handling appearance event in ShaderManager",t)}}async handleAppearanceUpdate(e){var t,r;try{w.log("shader-manager","dev","[SHADER-MANAGER] ENTRY POINT: Processing appearance update",{mainColor:e.body.mainColor,secondaryColor:e.body.secondaryColor,props:e.props,hasAppearanceOrchestrator:!!this.appearanceOrchestrator,activeMaterialsCount:this.activeMaterials.size,activeMaterialIds:Array.from(this.activeMaterials.keys())});const i=await this.appearanceOrchestrator.handleAppearanceUpdate(e);w.log("shader-manager","dev","[SHADER-MANAGER] ORCHESTRATOR RESULT: Appearance orchestrator completed",{success:i.success,errors:i.errors,warnings:i.warnings,shaderConstantsCount:Object.keys(i.updatedShaderConstants??{}).length,shaderConstants:i.updatedShaderConstants}),i.success?(w.log("shader-manager","dev","[SHADER-MANAGER] SUCCESS: Appearance update successful",{shaderConstantsApplied:Object.keys(i.updatedShaderConstants??{}),warningsCount:((t=i.warnings)==null?void 0:t.length)??0}),w.log("shader-manager","dev","[SHADER-MANAGER] EMITTING: shader-update-completed event"),this.eventManager.emit(new Pe("appearance","shader-update-completed",{success:!0,updatedConstants:Object.keys(i.updatedShaderConstants??{}),warnings:i.warnings}))):(w.error("shader-manager","dev","[SHADER-MANAGER] FAILED: Appearance update failed",{errors:i.errors,errorsCount:((r=i.errors)==null?void 0:r.length)??0}),w.log("shader-manager","dev","[SHADER-MANAGER] EMITTING: shader-update-failed event"),this.eventManager.emit(new Pe("appearance","shader-update-failed",{success:!1,errors:i.errors})))}catch(i){w.error("shader-manager","dev","[SHADER-MANAGER] ERROR: Unexpected error handling appearance update",{error:i instanceof Error?i.message:String(i),stack:i instanceof Error?i.stack:void 0,mainColor:e.body.mainColor,secondaryColor:e.body.secondaryColor}),w.log("shader-manager","dev","[SHADER-MANAGER] EMITTING: shader-update-failed event (error case)"),this.eventManager.emit(new Pe("appearance","shader-update-failed",{success:!1,errors:[i instanceof Error?i.message:String(i)]}))}}registerShader(e){try{this.registeredShaders.set(e.id,e),w.log("shader-manager","dev",`Registered shader: ${e.id}`),this.eventManager.emit(new Pe("shader","shader-registered",{shaderId:e.id,shaderName:e.name}))}catch(t){this.handleError({type:"runtime",message:`Failed to register shader: ${e.id}`,originalError:t})}}unregisterShader(e){this.registeredShaders.delete(e)&&(w.log("shader-manager","dev",`Unregistered shader: ${e}`),this.eventManager.emit(new Pe("shader","shader-unregistered",{shaderId:e})))}getShader(e){return this.registeredShaders.get(e)}registerMaterialTemplate(e){try{this.materialTemplates.set(e.id,e),w.log("shader-manager","dev",`Registered material template: ${e.id}`),this.eventManager.emit(new Pe("shader","shader-template-registered",{templateId:e.id,baseType:e.baseType}))}catch(t){this.handleError({type:"runtime",message:`Failed to register material template: ${e.id}`,originalError:t})}}createMaterialFromTemplate(e,t,r){const i=this.materialTemplates.get(e);if(!i||!this.scene)throw new Error(`Material template not found: ${e}`);try{const{PBRMaterial:a,StandardMaterial:o,ShaderMaterial:s}=he.getCore();let c;switch(i.baseType){case"PBR":c=new a(t,this.scene);break;case"Standard":c=new o(t,this.scene);break;case"Custom":if(i.shaderId){const u=this.registeredShaders.get(i.shaderId);if(!u)throw new Error(`Shader not found: ${i.shaderId}`);c=new s(t,this.scene,{vertex:u.vertexShader,fragment:u.fragmentShader},{attributes:u.attributes??["position","normal","uv"],uniforms:Object.keys(u.uniforms??{})})}else throw new Error(`Custom material template requires shaderId: ${e}`);break;default:throw new Error(`Unsupported material type: ${i.baseType}`)}return i.properties&&this.applyMaterialProperties(c,i.properties),r&&this.applyMaterialProperties(c,r),this.activeMaterials.set(t,c),this.materialToTemplate.set(t,e),w.log("shader-manager","dev",`Created material: ${t} from template: ${e}`),this.eventManager.emit(new Pe("shader","shader-material-created",{materialId:t,templateId:e,materialType:i.baseType})),c}catch(a){throw this.handleError({type:"runtime",message:`Failed to create material: ${t} from template: ${e}`,originalError:a}),a}}cloneMaterial(e,t){const r=this.activeMaterials.get(e);if(!r)throw new Error(`Source material not found: ${e}`);try{const i=r.clone(t);if(!i)throw new Error(`Failed to clone material: ${e}`);this.activeMaterials.set(t,i);const a=this.materialToTemplate.get(e);return a&&this.materialToTemplate.set(t,a),w.log("shader-manager","dev",`Cloned material: ${t} from: ${e}`),this.eventManager.emit(new Pe("shader","shader-material-cloned",{sourceMaterialId:e,targetMaterialId:t})),i}catch(i){throw this.handleError({type:"runtime",message:`Failed to clone material: ${e} to: ${t}`,originalError:i}),i}}async loadNodeMaterialFromJson(e,t){if(!this.scene)throw new Error("Scene is not defined for NodeMaterial loading");try{const{ImageSourceBlock:r,NodeMaterial:i,TextureBlock:a}=he.getCore();w.log("shader-manager","dev",`Loading NodeMaterial: ${e.name} - ${typeof e.json=="string"?`from file: ${e.json}`:"from inline JSON"}`);const o=await this.contentManager.loadJson(e.json),s=new i(e.name,this.scene);s.parseSerializedObject(o),e.backfaceCulling!==void 0&&(s.backFaceCulling=e.backfaceCulling),e.disableDepthWrite&&(s.disableDepthWrite=e.disableDepthWrite),e.blendMode!==void 0&&(s.alphaMode=e.blendMode);const c=[];if(e.inputBlocks)for(const f of e.inputBlocks){const p=s.getInputBlockByPredicate(g=>g.name===f.blockName);p&&(c.push({materialName:e.name,blockName:f.blockName,block:p}),p.value=f.value)}const u=[];for(const f of e.linkedTextures??[])try{const p=s.getBlockByName(f.blockName);if(p&&(p instanceof a||p instanceof r)){const{Texture:g}=he.getCore();if(f.texture instanceof g)p.texture=f.texture,w.log("shader-manager","dev",`Assigned texture instance to block ${f.blockName} in material ${e.name}`);else if(typeof f.texture=="string"){const v=this.textureAssets.get(f.texture);if(v!=null&&v.texture)p.texture=v.texture,w.log("shader-manager","dev",`Assigned registered texture ${f.texture} to block ${f.blockName} in material ${e.name}`);else{const y=(async()=>{try{if(!this.scene)throw new Error("Scene is not available for texture loading");const b=await this.contentManager.loadTexture(f.texture,this.scene);p.texture=b,w.log("shader-manager","dev",`Loaded/assigned (cached or reused) texture ${f.texture} to block ${f.blockName} in material ${e.name} via ContentManager`)}catch(b){w.error("shader-manager","dev",`Failed to load/reuse texture ${f.texture} for block ${f.blockName}:`,b)}})();u.push(y)}}}else w.warn("shader-manager","dev",`Block ${f.blockName} not found or not a TextureBlock in material ${e.name}`)}catch(p){w.error("shader-manager","dev",`Error processing texture block ${f.blockName} for material ${e.name}:`,p)}u.length>0&&(w.log("shader-manager","dev",`Waiting for ${u.length} textures to load for material ${e.name}`),await Promise.allSettled(u)),s.build(!1);const h={name:e.name,material:s,trackedBlocks:c};return t&&this.registerNodeMaterialAsset(h,t),w.log("shader-manager","dev",`Successfully loaded NodeMaterial: ${e.name}${t?` with ID: ${t}`:""}`),this.eventManager.emit(new Pe("shaderManager","shader-node-material-loaded",{materialName:e.name,materialId:t??e.name,trackedBlocksCount:c.length})),h}catch(r){throw this.handleError({type:"load",message:`Failed to load NodeMaterial: ${e.name}`,originalError:r}),r}}registerNodeMaterialAsset(e,t){this.nodeMatAssets.set(e.name,e);const r=t??e.name;this.activeMaterials.set(r,e.material),w.log("shader-manager","dev",`Registered NodeMaterial asset: ${e.name} with material ID: ${r}`),this.eventManager.emit(new Pe("shader","shader-node-material-asset-registered",{assetName:e.name,materialId:r}))}createNodeMaterialInstance(e,t){const r=this.nodeMatAssets.get(e);if(!r)throw new Error(`NodeMaterial asset not found: ${e}`);try{const i=r.material.clone(t);return this.activeMaterials.set(t,i),w.log("shader-manager","dev",`Created NodeMaterial instance: ${t} from asset: ${e}`),this.eventManager.emit(new Pe("shader","shader-node-material-instance-created",{materialId:t,assetName:e})),i}catch(i){throw this.handleError({type:"runtime",message:`Failed to create NodeMaterial instance: ${t} from asset: ${e}`,originalError:i}),i}}registerTextureAsset(e){this.textureAssets.set(e.name,e),w.log("shader-manager","dev",`Registered texture asset: ${e.name}`),this.eventManager.emit(new Pe("shader","shader-texture-asset-registered",{textureName:e.name}))}getTextureAsset(e){return this.textureAssets.get(e)}assignTexturesToNodeMaterial(e,t){const{NodeMaterial:r}=he.getCore(),i=this.activeMaterials.get(e);if(!i||!(i instanceof r))throw new Error(`NodeMaterial not found: ${e}`);const a=[],o=[];try{for(const s of t)try{const c=this.textureAssets.get(s.textureName);if(!(c!=null&&c.texture)){o.push({blockName:s.blockName,reason:`Texture asset not found: ${s.textureName}`});continue}const u=i.getTextureBlocks().find(h=>h.name===s.blockName);u?(u.texture=c.texture,a.push(s.blockName),w.log("shader-manager","dev",`Assigned texture ${s.textureName} to block ${s.blockName} in material ${e}`)):o.push({blockName:s.blockName,reason:`Texture block not found: ${s.blockName}`})}catch(c){o.push({blockName:s.blockName,reason:`Assignment error: ${c instanceof Error?c.message:"Unknown error"}`})}a.length>0&&this.eventManager.emit(new Pe("shaderManager","shader-textures-assigned",{materialId:e,successfulAssignments:a,assignmentCount:a.length})),o.length>0&&(w.warn("shader-manager","dev",`Failed texture assignments for material ${e}:`,o),this.eventManager.emit(new Pe("shader","shader-texture-assignment-errors",{materialId:e,failedAssignments:o})))}catch(s){throw this.handleError({type:"runtime",message:`Failed to assign textures to material: ${e}`,originalError:s}),s}}batchSetInputBlockValues(e,t){const{NodeMaterial:r}=he.getCore();if(w.log("shader-manager","dev",`[BATCH-INPUT-BLOCKS] Setting ${t.length} input blocks on material: ${e??"ALL"}`,t.map(s=>`${s.blockName}=${gs(s.value)}`).join(", ")),!e){w.log("shader-manager","dev",`Applying input block values to all ${this.activeMaterials.size} materials (catch-all mode)`);let s=0,c=0;for(const[u,h]of this.activeMaterials)if(h instanceof r)try{this.batchSetInputBlockValues(u,t),s++}catch(f){c++,w.warn("shader-manager","dev",`Failed to apply input blocks to material ${u}:`,f)}w.log("shader-manager","dev",`Catch-all input block update completed: ${s} successful, ${c} failed`),this.eventManager.emit(new Pe("shader","shader-input-blocks-batch-updated",{materialId:"ALL_MATERIALS",successfulMaterials:s,failedMaterials:c}));return}const i=this.activeMaterials.get(e);if(!i||!(i instanceof r))throw new Error(`NodeMaterial not found: ${e}`);const a=[],o=[];try{for(const s of t)try{const c=i.getInputBlockByPredicate(u=>u.name===s.blockName);c?(c.value=s.value,a.push(s.blockName),w.log("shader-manager","dev",`Set input block value: ${s.blockName} = ${gs(s.value)} for material: ${e}`)):o.push({blockName:s.blockName,reason:`Input block not found: ${s.blockName}`})}catch(c){o.push({blockName:s.blockName,reason:`Value assignment error: ${c instanceof Error?c.message:"Unknown error"}`})}a.length>0&&this.eventManager.emit(new Pe("shader","shader-input-blocks-updated",{materialId:e,successfulUpdates:a,updateCount:a.length})),o.length>0&&(w.warn("shader-manager","dev",`Failed input block updates for material ${e}:`,o),this.eventManager.emit(new Pe("shader","shader-input-block-update-errors",{materialId:e,failedUpdates:o})))}catch(s){throw this.handleError({type:"runtime",message:`Failed to batch update input blocks for material: ${e}`,originalError:s}),s}}async createProceduralTexture(e){if(!this.scene)throw new Error("Scene is not defined for procedural texture creation");try{const{NodeMaterial:t}=he.getCore();w.log("shader-manager","dev",`Loading procedural NodeMaterial: ${e.name} - ${typeof e.nodeMatJson=="string"?`from file: ${e.nodeMatJson}`:"from inline JSON"}`);const r=await this.contentManager.loadJson(e.nodeMatJson),i=t.Parse(r,this.scene);i.name=`${e.name}`,i.build(!1);const a=e.width??128,o=e.height??128,s=i.createProceduralTexture({width:a,height:o},this.scene);e.samplingMode!==void 0&&s.updateSamplingMode(e.samplingMode),s.name=e.name;const c={name:e.name,texture:s,json:e.nodeMatJson,proceduralNodeMaterial:i,loadedTexture:!0,proceduralWidth:a,proceduralHeight:o,samplingMode:e.samplingMode};return this.registerTextureAsset(c),i&&(this.activeMaterials.set(`${e.name}_proceduralMaterial`,i),w.log("shader-manager","dev",`Registered procedural NodeMaterial: ${e.name}_proceduralMaterial for texture: ${e.name}`)),e.assignToMaterial&&s.onGeneratedObservable.addOnce(()=>{try{this.assignTexturesToNodeMaterial(e.assignToMaterial.materialId,[{blockName:e.assignToMaterial.blockName,textureName:e.name}])}catch(u){w.error("shader-manager","dev",`Failed to auto-assign procedural texture ${e.name}`,u)}}),w.log("shader-manager","dev",`Created procedural texture: ${e.name} (${a}x${o})`),this.eventManager.emit(new Pe("shader","shader-procedural-texture-created",{textureName:e.name,width:a,height:o,materialAssignment:e.assignToMaterial})),c}catch(t){throw this.handleError({type:"runtime",message:`Failed to create procedural texture: ${e.name}`,originalError:t}),t}}async createProceduralTextureBatch(e){const t=[],r=new Set,i=new Set,a=async o=>{if(r.has(o.name))return this.textureAssets.get(o.name);if(i.has(o.name))throw new Error(`Circular dependency detected for texture: ${o.name}`);if(i.add(o.name),o.dependencies)for(const c of o.dependencies){const u=e.find(h=>h.name===c);u&&!r.has(c)&&await a(u)}const s=await this.createProceduralTexture(o);return r.add(o.name),i.delete(o.name),t.push(s),s};for(const o of e)r.has(o.name)||await a(o);return w.log("shader-manager","dev",`Created ${t.length} procedural textures in batch`),this.eventManager.emit(new Pe("shader","shader-procedural-texture-batch-created",{textureCount:t.length,textureNames:t.map(o=>o.name)})),t}applyColorPaletteToGradientBlocks(e,t){const{NodeMaterial:r,Color3:i,GradientBlock:a,GradientBlockColorStep:o,InputBlock:s}=he.getCore();if(w.log("shader-manager","dev","[SHADER-MANAGER] GRADIENT BLOCKS: Starting color palette application",{targetMaterialId:e??"ALL_MATERIALS",paletteBlockNames:Object.keys(t),paletteBlockCount:Object.keys(t).length,totalActiveMaterials:this.activeMaterials.size}),!e){w.log("shader-manager","dev","[SHADER-MANAGER] GRADIENT BLOCKS: Applying to ALL materials (catch-all mode)",{totalMaterials:this.activeMaterials.size});let p=0,g=0;for(const[v,y]of this.activeMaterials)if(y instanceof r)try{w.log("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Processing material ${v}`),this.applyColorPaletteToGradientBlocks(v,t),p++}catch(b){g++,w.warn("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Failed to apply color palette to material ${v}`,b)}else w.log("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Skipping non-NodeMaterial ${v} (${y.getClassName()})`);w.log("shader-manager","dev","[SHADER-MANAGER] GRADIENT BLOCKS: Catch-all application completed",{totalSuccessful:p,totalFailed:g,totalProcessed:p+g}),this.eventManager.emit(new Pe("shader","shader-color-palette-batch-applied",{materialId:"ALL_MATERIALS",successfulMaterials:p,failedMaterials:g,paletteBlocks:Object.keys(t)}));return}const c=this.activeMaterials.get(e),u=Array.from(this.activeMaterials.entries()).map(([p,g])=>({id:p,className:g.getClassName(),isNodeMaterial:g instanceof r,name:g.name||"unnamed"}));if(w.log("shader-manager","dev","[SHADER-MANAGER] GRADIENT BLOCKS: Material lookup details",{targetMaterialId:e,materialFound:!!c,materialType:c==null?void 0:c.getClassName(),materialName:c==null?void 0:c.name,isNodeMaterial:c instanceof r,totalActiveMaterials:this.activeMaterials.size,availableMaterialDetails:u,searchingFor:`"${e}"`,exactMatches:u.filter(p=>p.id===e),nodeMatches:u.filter(p=>p.isNodeMaterial),nameMatches:u.filter(p=>p.name.includes(e)||p.id.includes(e))}),!c||!(c instanceof r)){const p=`NodeMaterial not found: ${e}`,g=Array.from(this.activeMaterials.keys()),v=u.filter(b=>b.isNodeMaterial),y=u.filter(b=>b.name.toLowerCase().includes("character")||b.name.toLowerCase().includes("base")||b.id.toLowerCase().includes("character")||b.id.toLowerCase().includes("base"));throw w.error("shader-manager","dev",`[SHADER-MANAGER] MATERIAL ID MISMATCH: Looking for "${e}" but not found`),w.error("shader-manager","dev",`[SHADER-MANAGER] AVAILABLE MATERIAL IDS: ${g.join(", ")}`),w.error("shader-manager","dev",`[SHADER-MANAGER] NODE MATERIALS: ${v.map(b=>`${b.id} (${b.name})`).join(", ")}`),w.error("shader-manager","dev",`[SHADER-MANAGER] POSSIBLE MATCHES: ${y.map(b=>`${b.id} (${b.name})`).join(", ")}`),w.error("shader-manager","dev","[SHADER-MANAGER] GRADIENT BLOCKS: Material validation failed - FULL DIAGNOSIS",{targetMaterialId:e,availableMaterialIds:g,availableMaterialDetails:u,nodeMateriasAvailable:v,possibleMatches:y,error:p,diagnosis:"The material ID from appearance-mapping.json doesn't match any loaded NodeMaterial IDs",suggestion:"Check if material IDs in appearance-mapping.json match the actual loaded material names above"}),new Error(p)}const h=[],f=[];try{const p=c.getInputBlocks(),g=c.attachedBlocks;w.log("shader-manager","dev","[SHADER-MANAGER] GRADIENT BLOCKS: Material structure analysis",{materialId:e,targetBlocks:Object.keys(t),inputBlocksCount:p.length,inputBlockNames:p.map(v=>v.name),allBlocksCount:g.length,allBlockNames:g.map(v=>`${v.name} (${v.getClassName()})`)});for(const[v,y]of Object.entries(t))try{w.log("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Processing block "${v}"`,{blockName:v,colorStepsCount:y.length,colorSteps:y});const b=c.getBlockByName(v);if(w.log("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Block search result for "${v}"`,{blockFound:!!b,blockType:b==null?void 0:b.getClassName(),isGradientBlock:b instanceof a,isInputBlock:b instanceof s}),b&&b instanceof a)try{w.log("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Updating gradient block "${v}"`,{blockName:v,newColorStepsCount:y.length,existingColorStepsCount:b.colorSteps.length,existingColorSteps:b.colorSteps.map(C=>({step:C.step,color:gs(C.color)}))}),b.colorSteps.length=0;for(let C=0;C<y.length;C++){const S=y[C]??{step:0,color:"#FF00FF"};try{const E=i.FromHexString(S.color),T=new o(S.step,E);b.colorSteps.push(T),w.log("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Added color step ${C}`,{stepIndex:C,stepValue:S.step,stepColor:S.color,convertedColor:gs(E)})}catch(E){throw w.error("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Failed to create color step ${C}`,{stepIndex:C,stepData:S,error:E instanceof Error?E.message:String(E)}),E}}w.log("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Successfully updated gradient block "${v}"`,{blockName:v,finalColorStepsCount:b.colorSteps.length,finalColorSteps:b.colorSteps.map(C=>({step:C.step,color:gs(C.color)}))}),this.markMaterialDirty(e),h.push(v)}catch(C){w.error("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Failed to update gradient block "${v}"`,{blockName:v,error:C instanceof Error?C.message:String(C),stack:C instanceof Error?C.stack:void 0}),f.push({blockName:v,reason:`Gradient block update error: ${C instanceof Error?C.message:"Unknown error"}`})}else if(b&&b instanceof s){if(y.length>0&&y[0])try{const C=y[0];w.log("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Applying color to input block "${v}"`,{blockName:v,colorValue:C.color,stepValue:C.step});const S=i.FromHexString(C.color);b.value=S,h.push(v),w.log("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Successfully applied color to input block "${v}"`,{blockName:v,appliedColor:gs(S)})}catch(C){w.error("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Failed to apply color to input block "${v}"`,{blockName:v,error:C instanceof Error?C.message:String(C)}),f.push({blockName:v,reason:`Input block color error: ${C instanceof Error?C.message:"Unknown error"}`})}}else w.warn("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Block not found or unsupported type "${v}"`,{blockName:v,blockFound:!!b,blockType:b==null?void 0:b.getClassName(),availableBlockNames:g.map(C=>C.name)}),f.push({blockName:v,reason:`Block not found or not a gradient/input block: ${v}`})}catch(b){w.error("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: Unexpected error processing block "${v}"`,{blockName:v,error:b instanceof Error?b.message:String(b),stack:b instanceof Error?b.stack:void 0}),f.push({blockName:v,reason:`Color palette application error: ${b instanceof Error?b.message:"Unknown error"}`})}w.log("shader-manager","dev","[SHADER-MANAGER] GRADIENT BLOCKS: Processing completed",{materialId:e,successfulUpdatesCount:h.length,failedUpdatesCount:f.length,successfulUpdates:h,failedUpdates:f}),h.length>0&&this.eventManager.emit(new Pe("shader","shader-color-palette-applied",{materialId:e,successfulUpdates:h,updateCount:h.length})),f.length>0&&(w.log("shader-manager","dev",`[SHADER-MANAGER] GRADIENT BLOCKS: ${f.length} blocks not found/updated in material ${e}`,{failedUpdates:f}),this.eventManager.emit(new Pe("shader","shader-color-palette-errors",{materialId:e,failedUpdates:f})))}catch(p){throw w.error("shader-manager","dev","[SHADER-MANAGER] GRADIENT BLOCKS: Critical error in gradient block application",{materialId:e,error:p instanceof Error?p.message:String(p),stack:p instanceof Error?p.stack:void 0}),this.handleError({type:"runtime",message:`Failed to apply color palette to material: ${e}`,originalError:p}),p}}createNodeMaterialWithAssets(e){var t;if(!this.scene)throw new Error("Scene is not defined for NodeMaterial creation");try{const{NodeMaterial:r}=he.getCore(),i=r.Parse(e.nodeMatJson,this.scene);i.name=e.name,i.backFaceCulling=e.backfaceCulling??!0,i.disableDepthWrite=e.disableDepthWrite??!1,e.blendMode!==void 0&&(i.alphaMode=e.blendMode);const a=[];if(e.inputBlocks)for(const s of e.inputBlocks)try{const c=i.getInputBlockByPredicate(u=>u.name===s.blockName);c&&(a.push({materialName:e.name,blockName:s.blockName,block:c}),c.value=s.value)}catch(c){w.warn("shader-manager","dev",`Error tracking input block ${s.blockName}:`,c)}i.build(!1);const o={name:e.name,material:i,trackedBlocks:a};return this.registerNodeMaterialAsset(o,e.name),e.linkedTextures&&this.assignTexturesToNodeMaterial(e.name,e.linkedTextures),e.colorPalette&&this.applyColorPaletteToGradientBlocks(e.name,e.colorPalette),w.log("shader-manager","dev",`Created NodeMaterial with assets: ${e.name} (${a.length} tracked blocks)`),this.eventManager.emit(new Pe("shader","shader-node-material-with-assets-created",{materialName:e.name,trackedBlocksCount:a.length,linkedTexturesCount:((t=e.linkedTextures)==null?void 0:t.length)??0,colorPaletteApplied:!!e.colorPalette})),o}catch(r){throw this.handleError({type:"runtime",message:`Failed to create NodeMaterial with assets: ${e.name}`,originalError:r}),r}}linkTextureToNodeMaterial(e,t,r){const{NodeMaterial:i}=he.getCore(),a=this.activeMaterials.get(e),o=this.textureAssets.get(r);if(!(a instanceof i))throw new Error(`NodeMaterial not found: ${e}`);if(!(o!=null&&o.texture))throw new Error(`Texture asset not found: ${r}`);try{const s=a.getTextureBlocks().find(c=>c.name===t);if(s)s.texture=o.texture,w.log("shader-manager","dev",`Linked texture ${r} to block ${t} in material ${e}`),this.eventManager.emit(new Pe("shader","shader-texture-linked",{materialId:e,blockName:t,textureName:r}));else throw new Error(`Texture block not found: ${t} in material: ${e}`)}catch(s){throw this.handleError({type:"runtime",message:`Failed to link texture ${r} to material ${e}`,originalError:s}),s}}setMaterialProperty(e,t,r){const{NodeMaterial:i}=he.getCore(),a=this.activeMaterials.get(e);if(!a)throw new Error(`Material not found: ${e}`);try{if(t.startsWith("inputBlocks.")&&a instanceof i){const u=t.substring(12);this.setInputBlockValue(e,u,r);return}const o=t.split(".");let s=a;for(let u=0;u<o.length-1;u++){const h=o[u];if(!h||typeof s!="object"||s===null||!(h in s))throw new Error(`Property path not found: ${t} in material: ${e}`);s=s[h]}const c=o[o.length-1];if(c&&s)s[c]=r,w.log("shader-manager","dev",`Set material property: ${t} = ${r} for material: ${e}`),this.eventManager.emit(new Pe("shader","shader-material-property-updated",{materialId:e,property:t,value:r}));else throw new Error(`Property not found: ${t} in material: ${e}`)}catch(o){throw this.handleError({type:"runtime",message:`Failed to set material property: ${t} for material: ${e}`,originalError:o}),o}}getMaterialProperty(e,t){const{NodeMaterial:r}=he.getCore(),i=this.activeMaterials.get(e);if(!i)throw new Error(`Material not found: ${e}`);try{if(t.startsWith("inputBlocks.")&&i instanceof r){const s=t.substring(12);return this.getInputBlockValue(e,s)}const a=t.split(".");let o=i;for(const s of a){if(!s||typeof o!="object"||o===null||!(s in o))return;o=o[s]}return o}catch(a){this.handleError({type:"runtime",message:`Failed to get material property: ${t} for material: ${e}`,originalError:a});return}}setMaterialState(e,t){const r=this.findTemplateForMaterial(e);if(!(r!=null&&r.materialStates)){w.warn("shader-manager","dev",`No material states defined for material: ${e}`);return}const i=r.materialStates.find(a=>a.state===t);if(!i)throw new Error(`Material state not found: ${t} for material: ${e}`);try{const{NodeMaterial:a}=he.getCore(),o=this.activeMaterials.get(e);if(!o)throw new Error(`Material not found: ${e}`);if(i.properties&&this.applyMaterialProperties(o,i.properties),i.inputBlocks&&o instanceof a)for(const s of i.inputBlocks)this.setInputBlockValue(e,s.blockName,s.value);if(i.textureOverrides)for(const s of i.textureOverrides)this.linkTextureToNodeMaterial(e,s.blockName,s.textureName);this.materialStates.set(e,t),w.log("shader-manager","dev",`Set material state: ${t} for material: ${e}`),this.eventManager.emit(new Pe("shader","shader-material-state-changed",{materialId:e,state:t,previousState:this.materialStates.get(e)}))}catch(a){throw this.handleError({type:"runtime",message:`Failed to set material state: ${t} for material: ${e}`,originalError:a}),a}}getCurrentMaterialState(e){return this.materialStates.get(e)}setInputBlockValue(e,t,r){const{NodeMaterial:i}=he.getCore(),a=this.activeMaterials.get(e);if(!(a instanceof i))throw new Error(`NodeMaterial not found: ${e}`);try{const o=a.getInputBlockByPredicate(s=>s.name===t);if(o){const s=o.value;o.value=r,w.log("shader-manager","dev",`[INPUT-BLOCK] ${e}.${t}: ${gs(s)} → ${gs(r)}`),this.eventManager.emit(new Pe("shader","shader-input-block-updated",{materialId:e,blockName:t,value:r}))}else throw new Error(`Input block not found: ${t} in material: ${e}`)}catch(o){throw this.handleError({type:"runtime",message:`Failed to set input block value: ${t} for material: ${e}`,originalError:o}),o}}getInputBlockValue(e,t){const{NodeMaterial:r}=he.getCore(),i=this.activeMaterials.get(e);if(!(i instanceof r))throw new Error(`NodeMaterial not found: ${e}`);const a=i.getInputBlockByPredicate(o=>o.name===t);return a==null?void 0:a.value}animateProperty(e){const t=`anim_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r={id:t,target:e.target,property:e.property,keyframes:e.keyframes,duration:e.duration,easing:e.easing,loop:e.loop,autoReverse:e.autoReverse,startTime:performance.now(),isActive:!0,isReversed:!1};return this.activeAnimations.set(t,r),w.log("shader-manager","dev",`Started animation: ${t} for ${e.target}.${e.property}`),this.eventManager.emit(new Pe("shader","shader-animation-started",{animationId:t,target:e.target,property:e.property,duration:e.duration})),t}stopAnimation(e){const t=this.activeAnimations.get(e);t&&(t.isActive=!1,this.activeAnimations.delete(e),w.log("shader-manager","dev",`Stopped animation: ${e}`),this.eventManager.emit(new Pe("shader","shader-animation-stopped",{animationId:e})))}pauseAnimation(e){const t=this.activeAnimations.get(e);t&&(t.isActive=!1,w.log("shader-manager","dev",`Paused animation: ${e}`),this.eventManager.emit(new Pe("shader","shader-animation-paused",{animationId:e})))}resumeAnimation(e){const t=this.activeAnimations.get(e);t&&(t.isActive=!0,t.startTime=performance.now(),w.log("shader-manager","dev",`Resumed animation: ${e}`),this.eventManager.emit(new Pe("shader","shader-animation-resumed",{animationId:e})))}disposeMaterial(e){const t=this.activeMaterials.get(e);t&&(t.dispose(),this.activeMaterials.delete(e),this.materialStates.delete(e),this.materialToTemplate.delete(e),w.log("shader-manager","dev",`Disposed material: ${e}`),this.eventManager.emit(new Pe("shader","shader-material-disposed",{materialId:e})))}disposeAllMaterials(){for(const[e]of this.activeMaterials)this.disposeMaterial(e)}onFrame(e,t){if(this.updateAnimations(t),this.dirtyMaterials.size>0&&this.autoRebuildEnabled){const r=performance.now();(!this.lastRebuildAttempt||r-this.lastRebuildAttempt>this.autoRebuildThrottleMs)&&(this.lastRebuildAttempt=r,this.rebuildDirtyMaterials())}this.fsm&&this.fsmInitialized&&e.shaderManager===this&&(this.fsm.step(e),!this.hasTriggeredStartLoading&&this.fsm.getState()==="ready"&&(this.hasTriggeredStartLoading=!0,this.eventManager.emit(new Pe("shaderManager","start-loading",{timestamp:performance.now()})),w.log("shader-manager","dev","Triggered start-loading event after FSM reached ready state")))}getCurrentFSMState(){var e;return(e=this.fsm)==null?void 0:e.getState()}isFSMInitialized(){return this.fsmInitialized}triggerFSMEvent(e,t){this.fsm&&this.eventManager.emit(new Pe("shaderManager",e,t))}getFSMDebugInfo(){var e;return{initialized:this.fsmInitialized,currentState:(e=this.fsm)==null?void 0:e.getState(),hasDefinitions:this.fsm!==null}}updateAnimations(e){const t=performance.now();for(const[r,i]of this.activeAnimations){if(!i.isActive)continue;const a=(t-i.startTime)/1e3,o=Math.min(a/i.duration,1),s=this.applyEasing(o,i.easing),c=i.autoReverse&&i.isReversed?1-s:s,u=this.interpolateKeyframes(i.keyframes,c);this.applyAnimatedValue(i.target,i.property,u),o>=1&&(i.loop?(i.autoReverse&&(i.isReversed=!i.isReversed),i.startTime=t):this.stopAnimation(r))}}applyEasing(e,t){if(!t)return e;switch(t){case"easeInOutSine":return-(Math.cos(Math.PI*e)-1)/2;case"easeInOutCubic":return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2;default:return e}}interpolateKeyframes(e,t){if(e.length===0)return 0;if(e.length===1)return e[0].value;let r=e[0],i=e[e.length-1];for(let o=0;o<e.length-1;o++)if(t>=e[o].time&&t<=e[o+1].time){r=e[o],i=e[o+1];break}const a=(t-r.time)/(i.time-r.time);return typeof r.value=="number"&&typeof i.value=="number"?r.value+(i.value-r.value)*a:a<.5?r.value:i.value}applyAnimatedValue(e,t,r){try{const{NodeMaterial:i}=he.getCore(),a=this.activeMaterials.get(e);if(!a)return;if(t.startsWith("inputBlocks.")&&a instanceof i){const u=t.substring(12);this.setInputBlockValue(e,u,r);return}const o=t.split(".");let s=a;for(let u=0;u<o.length-1;u++){const h=o[u];if(!h)break;if(s=s[h],!s)return}const c=o[o.length-1];c&&s&&typeof s=="object"&&Object.prototype.hasOwnProperty.call(s,c)&&(s[c]=r)}catch(i){w.warn("shader-manager","dev",`Failed to apply animated value: ${e}.${t}`,i)}}applyMaterialProperties(e,t){for(const[r,i]of Object.entries(t))try{const a=r.split(".");let o=e;for(let c=0;c<a.length-1;c++){const u=a[c];if(!u||typeof o!="object"||o===null||!(u in o)){o=void 0;break}o=o[u]}const s=a[a.length-1];o&&s&&(o[s]=i)}catch(a){w.warn("shader-manager","dev",`Failed to apply property: ${r}`,a)}}findTemplateForMaterial(e){const t=this.materialToTemplate.get(e);if(t)return this.materialTemplates.get(t)}handleError(e){w.error("shader-manager","dev",`${e.type} error: ${e.message}`,e.originalError),this.eventManager.emit(new Pe("shaderManager","error",{type:e.type,message:e.message,context:e.context}))}generateExternalId(e,t,r){const i=a=>a.replace(/[^a-zA-Z0-9_-]/g,"_").replace(/_{2,}/g,"_");if(t){let a=i(t.trim());if(a.length===0&&(a=`${e}_${Math.random().toString(36).slice(2,8)}`),!r||!r(a))return a;let o=1;for(;r(`${a}_${o}`);)o++;return`${a}_${o}`}return`${e}_${Math.random().toString(36).slice(2,10)}`}registerExternalMaterial(e,t){for(const[i,a]of this.activeMaterials.entries())if(a===e)return i;const r=t??this.generateExternalId("extMat",e.name,i=>this.activeMaterials.has(i));return this.activeMaterials.set(r,e),w.log("shader-manager","dev",`[EXTERNAL] Registered material '${r}' (class=${e.getClassName()})`),this.eventManager.emit(new Pe("shader","shader-external-material-registered",{materialId:r,name:e.name,className:e.getClassName()})),r}registerExternalTexture(e,t){for(const[i,a]of this.textureAssets.entries())if(a.texture===e)return i;const r=t??this.generateExternalId("extTex",e.name,i=>this.textureAssets.has(i));return this.textureAssets.set(r,{name:r,texture:e,loadedTexture:!0,samplingMode:e.samplingMode??void 0}),w.log("shader-manager","dev",`[EXTERNAL] Registered texture '${r}' (name='${e.name??""}')`),this.eventManager.emit(new Pe("shader","shader-external-texture-registered",{textureId:r,name:e.name,hasAlpha:e.hasAlpha??!1})),r}isTextureCached(e){return this.contentManager.isTextureCached(e)}forceReloadTexture(e){this.contentManager.forceReloadTexture(e)}clearTextureCache(){this.contentManager.clearTextureCache()}getTextureCacheSize(){return this.contentManager.getTextureCacheSize()}getCachedTexturePaths(){return this.contentManager.getCachedTexturePaths()}getCacheInfo(){return this.contentManager.getCacheInfo()}markMaterialDirty(e){this.dirtyMaterials.add(e),w.log("shader-manager","dev",`Marked material as dirty: ${e}`)}markMaterialClean(e){this.dirtyMaterials.delete(e),w.log("shader-manager","dev",`Marked material as clean: ${e}`)}isMaterialDirty(e){return this.dirtyMaterials.has(e)}rebuildMaterial(e){if(!this.isMaterialDirty(e))return!1;const{NodeMaterial:t}=he.getCore(),r=this.activeMaterials.get(e);if(!r||!(r instanceof t))return w.warn("shader-manager","dev",`Cannot rebuild material ${e}: not found or not a NodeMaterial`),!1;try{return w.log("shader-manager","dev",`Rebuilding dirty NodeMaterial: ${e}`),r.build(!1),this.markMaterialClean(e),this.eventManager.emit(new Pe("shader","shader-material-rebuilt",{materialId:e})),w.log("shader-manager","dev",`Successfully rebuilt NodeMaterial: ${e}`),!0}catch(i){return w.error("shader-manager","dev",`Failed to rebuild NodeMaterial: ${e}`,i),!1}}rebuildDirtyMaterials(){const e=Array.from(this.dirtyMaterials);let t=0;if(e.length===0)return 0;w.log("shader-manager","dev",`Rebuilding ${e.length} dirty materials: ${e.join(", ")}`);for(const r of e)this.rebuildMaterial(r)&&t++;return w.log("shader-manager","dev",`Rebuild completed: ${t}/${e.length} materials successfully rebuilt`),this.eventManager.emit(new Pe("shader","shader-materials-batch-rebuilt",{requestedCount:e.length,rebuiltCount:t,rebuiltMaterials:e.slice(0,t)})),t}getDirtyMaterials(){return Array.from(this.dirtyMaterials)}forceRebuildMaterial(e){return this.markMaterialDirty(e),this.rebuildMaterial(e)}clearDirtyMaterials(){const e=this.dirtyMaterials.size;this.dirtyMaterials.clear(),w.log("shader-manager","dev",`Cleared ${e} dirty material flags`)}setAutoRebuildEnabled(e,t){this.autoRebuildEnabled=e,t!==void 0&&(this.autoRebuildThrottleMs=t),w.log("shader-manager","dev",`Auto-rebuild ${e?"enabled":"disabled"}${t!==void 0?` with ${t}ms throttle`:""}`),this.eventManager.emit(new Pe("shader","shader-auto-rebuild-state-changed",{enabled:e,throttleMs:this.autoRebuildThrottleMs}))}isAutoRebuildEnabled(){return this.autoRebuildEnabled}getAutoRebuildThrottleMs(){return this.autoRebuildThrottleMs}getAutoRebuildStatus(){return{enabled:this.autoRebuildEnabled,throttleMs:this.autoRebuildThrottleMs,dirtyMaterialsCount:this.dirtyMaterials.size,lastRebuildAttempt:this.lastRebuildAttempt}}async loadJson(e){return this.contentManager.loadJson(e)}}class OAe{constructor(){Object.defineProperty(this,"promise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resolve",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reject",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isResolved",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_isRejected",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.promise=new Promise((e,t)=>{this.resolve=r=>{this._isResolved||this._isRejected||(this._isResolved=!0,e(r))},this.reject=r=>{if(this._isResolved||this._isRejected)return;this._isRejected=!0;const i=r instanceof Error?r:new Error(String(r));t(i)}})}get isResolved(){return this._isResolved}get isRejected(){return this._isRejected}get isSettled(){return this._isResolved||this._isRejected}}function LAe(n,e,t){return class extends n{get isEnabled(){return this._isEnabled}set isEnabled(i){this._isEnabled!==i&&(this._isEnabled=i,this.markAllDefinesAsDirty(),this._enable(this._isEnabled))}get noiseScale(){return this._noiseScale}set noiseScale(i){this._noiseScale!==i&&(this._noiseScale=i,this.markAllDefinesAsDirty())}get noiseSpeed(){return this._noiseSpeed}set noiseSpeed(i){this._noiseSpeed!==i&&(this._noiseSpeed=i,this.markAllDefinesAsDirty())}isCompatible(i){switch(i){case t.GLSL:return!0;default:return!1}}constructor(i){super(i,"Wave",100,{WAVE:!1}),Object.defineProperty(this,"_isEnabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_time",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_noiseScale",{enumerable:!0,configurable:!0,writable:!0,value:8e-4}),Object.defineProperty(this,"_noiseSpeed",{enumerable:!0,configurable:!0,writable:!0,value:.0025})}prepareDefines(i,a,o){const s=i;s.WAVE=this._isEnabled}getUniforms(){return{ubo:[{name:"waveTime",size:1,type:"float"},{name:"noiseScale",size:1,type:"float"},{name:"noiseSpeed",size:1,type:"float"}],vertex:`#ifdef WAVE
                  uniform float waveTime;
                  uniform float noiseScale;
                  uniform float noiseSpeed;
              #endif`}}bindForSubMesh(i,a,o,s){this._isEnabled&&(this._time=e.Now,i.updateFloat("waveTime",this._time),i.updateFloat("noiseScale",this._noiseScale),i.updateFloat("noiseSpeed",this._noiseSpeed))}getClassName(){return"WavePluginMaterial"}markAllDefinesAsDirty(){this._material.markAsDirty()}getCustomCode(i,a){if(a===t.WGSL)throw Error("not supported so far :-)");return i==="vertex"?{CUSTOM_VERTEX_UPDATE_POSITION:`
              #ifdef WAVE

              #define VERTICAL_FALLOFF_CLAMP 0.0
              #define VERTICAL_FALLOFF_POWER 3.0
                vec2 falloff = mix(vec2(1.0, -1.0), vec2(-1.0, 1.0), uv);

                float noiseX = falloff.y * sin(falloff.x * VERTICAL_FALLOFF_POWER + waveTime * noiseSpeed) * noiseScale;
                float noiseY = falloff.x * sin(falloff.y * VERTICAL_FALLOFF_POWER + waveTime * noiseSpeed * 1.12345) * noiseScale;
                positionUpdated.x += noiseX;
                positionUpdated.y += noiseY;
              #endif
          `}:null}}}class DAe{constructor(e,t){Object.defineProperty(this,"outlineMesh",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"movementNode",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"audioInputTarget",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"actmi",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.actmi=e,this.debug=t}getCharacterSettings(e){var r;const t=e??0;if(!((r=this.actmi)!=null&&r.characterSettings[t]))throw new Error("No characters found");return this.actmi.characterSettings[t]}async load(e,t){const r=[],{ImportMeshAsync:i,RegisterMaterialPlugin:a,PrecisionDate:o,MaterialPluginBase:s,ShaderLanguage:c}=he.getCore();for(const h of t.meshPaths){w.log("babylon","dev",`Loading mesh from path: ${h}`);const f=i(h,e);r.push(f)}const u=LAe(s,o,c);return a("Wave",h=>new u(h)),Promise.all(r)}setup(e,t){var x;const{MorphTargetManager:r}=he.getCore();r.ConstantTargetCountForTextureMode=32;const i=[];this.movementNode=e.getTransformNodeByName("Species_Char");const a=e.getTransformNodeByName("Ctrl_Head"),o=ad(e,"Geo_Body"),s=ad(e,"Geo_Body_Outline_primitive0");this.outlineMesh=s;const c=e.getMaterialByName("Face_Eyes_Darker"),u=e.getMaterialByName("Face_Brows_Black"),h=e.getMaterialByName("Face_Mouth_Darker"),f=e.getMaterialByName("Face_Blush"),p=ad(e,"Geo_Body_Outline_primitive1");i.push(p);for(const _ of e.meshes)_.renderingGroupId=2;o&&(o.renderingGroupId=1),s&&(s.renderingGroupId=1),k();const g=e.getAnimationGroupByName("Base_Pose");g&&(g.stop(),i.push(g));const v=e.getAnimationGroupByName("Idle_01_Basic");v&&v.start(!1,1);const{PBRMaterial:y,Engine:b,Color3:C,Vector3:S,Scalar:E}=he.getCore(),{Clamp:T}=he.getMath();if(a&&o&&o.material instanceof y&&s&&s.material instanceof y&&c&&u&&h&&f){c.disableLighting=!0,h.disableLighting=!0,u.disableLighting=!0,u.environmentIntensity=0,f.alpha=.1,a.animations=[];const _=o.material.pluginManager,R=_==null?void 0:_.getPlugin("Wave"),z=s.material.pluginManager,j=z==null?void 0:z.getPlugin("Wave");R&&j&&(R.isEnabled=!0,j.isEnabled=!0),o.material.iridescence.isEnabled=!1,o.material.environmentIntensity=0,o.material.emissiveTexture&&(o.material.emissiveTexture.level=1.5),s.material.environmentIntensity=0,s.material.alphaMode=b.ALPHA_PREMULTIPLIED_PORTERDUFF,s.material.emissiveTexture&&(s.material.emissiveTexture.level=1.5);const J=ad(e,"BackgroundPlane"),D=e.getTransformNodeByName(((x=t.transformNodes)==null?void 0:x.shadowParent)??""),F=J==null?void 0:J.material;J&&F&&D&&(J.name="BlobShadow",J.renderingGroupId=0,F.name="BlobShadowMat",F.primaryColor=C.FromHexString("#746A91"),F.alphaMode=b.ALPHA_PREMULTIPLIED_PORTERDUFF,F.opacityFresnel=!1,e.onBeforeRenderObservable.add(()=>{F.alpha=Math.max(T((1-D.absolutePosition.y*5)*.75),.1),J.scaling=D.scaling,J.position=new S(D.absolutePosition.x,-.2,0)})),e.onBeforeRenderObservable.add(()=>{const ie=1*(e.deltaTime*.001);this.outlineMesh.scaling.x=E.MoveTowards(this.outlineMesh.scaling.x,1+this.audioInputTarget*.25,ie),this.outlineMesh.scaling.z=E.MoveTowards(this.outlineMesh.scaling.z,1+this.audioInputTarget*.25,ie)});for(const ie of i)ie==null||ie.dispose()}function A(_){return _===o}function I(){var R;const _=e.pick(e.pointerX,e.pointerY,A);_.hit&&window.dispatchEvent(new CustomEvent("meshClicked",{detail:(R=_.pickedMesh)==null?void 0:R.name}))}function k(){const _=e,R=_.environmentTexture;if(!R){w.log("babylon","dev","No environment texture found");return}"rotationY"in R&&(R.rotationY=4.4),_.imageProcessingConfiguration.toneMappingEnabled=!1,_.imageProcessingConfiguration.exposure=1,_.imageProcessingConfiguration.contrast=1,_.environmentIntensity=1,_.onPointerDown=()=>I()}this.debug}onAudioInputVolumeChanged(e){this.audioInputTarget=e}moveToPosition(e){w.log("babylon","dev",`Moving Lumi to position: ${e.x}, ${e.y}, ${e.z}`);const{Vector3:t}=he.getCore();this.movementNode.position=new t(e.x,e.y,e.z)}}class jAe extends VEe{constructor(e,t,r){super(e,r),Object.defineProperty(this,"characterManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"contentManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sceneIsReady",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentState",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"characterSetup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onStateChangeObservable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isInPreviewMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"eventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"environmentManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interactionManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shaderManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"effectsManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"poiManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDebug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"readyDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new OAe}),this.sceneIsReady=!1,this.isDebug=r??!1,this.onStateChangeObservable=null,t&&(this.flags=t),this.characterSetup=hIe,this.eventManager=new BEe,this.contentManager=new fIe,this.setupAppearanceEventListeners(),this.environmentManager=null,this.characterManager=null,this.interactionManager=null,this.shaderManager=null,this.effectsManager=null,this.poiManager=null}async initScene(e,t){var y,b,C;tt.addTimingMark("loading","initScene-start",!1);const r=t;await super.initScene(e,r);const i=await this.contentManager.loadActmi(r);tt.addTimingMark("loading","load-actmi",!0,"initScene-start");const a={};for(const S of this.flags)a[S]=!0;this.characterSetup=new DAe(i,this.isDebug);const o=this.characterSetup.getCharacterSettings();this.characterManager=new dIe(this.scene,this.eventManager,this.characterSetup,o,a,this.isDebug);const s=o.shaderStateMachine;if(this.shaderManager=new NAe(this.scene,this.eventManager,this.contentManager,s),!this.engine||!this.scene)return Promise.reject(new Error("Engine or Scene or Setting is not defined"));this.environmentManager=new zIe(this.scene,this.eventManager,i);const c=this.environmentManager.stage;if(this.interactionManager=new VIe(this.scene,this.eventManager),((y=i.effectsSettings)==null?void 0:y.enabled)??!1){this.effectsManager=new _Ie({scene:this.scene,eventManager:this.eventManager,contentManager:this.contentManager,analyticsEnabled:this.isDebug});const S=(C=(b=i.effectsSettings)==null?void 0:b.defaultEffects)==null?void 0:C.emissionParticles;if(S!=null&&S.enabled&&S.path)try{await this.effectsManager.loadEffect("emissionParticles",S.path)}catch(E){w.warn("effects","dev","[AppearanceScene] Failed to load emissionParticles effect",E)}w.log("effects","dev","[AppearanceScene] ParticleEffectsManager initialized and effects loaded")}else this.effectsManager=null,w.log("effects","dev","[AppearanceScene] ParticleEffectsManager disabled by configuration");this.poiManager=QIe({initialPosition:{x:0,y:0,z:0},movementSpeed:2,detectionRadius:5,updateInterval:16,debug:this.isDebug}),this.camera=this.createCamera(this.scene,c);const{Color4:h}=he.getCore();this.scene.clearColor=new h(0,0,0,0),tt.addTimingMark("loading","managers-initialized",!1);const{behaviors:f,animationStates:p}=await this.contentManager.loadCharacterDependencies(this.characterManager.currentCharacter,this.characterSetup,this.scene);tt.addTimingMark("loading","load-dependencies",!0,"managers-initialized"),this.setMeshVisibility(!1);const{Observable:g}=he.getCore();this.onStateChangeObservable=new g,this.characterSetup.setup(this.scene,this.characterManager.currentCharacter,this.onStateChangeObservable),this.characterManager.updateCharacter(i.characterSettings[0]);const v={app:this,engine:this.engine,scene:this.scene,camera:this.camera,animator:this.characterManager.actAnimator??null,environmentManager:this.environmentManager,interactionManager:this.interactionManager,shaderManager:this.shaderManager,effectsManager:this.effectsManager,poiManager:this.poiManager};return this.characterManager.initializeAnimationAndBehavior(p,f,v),this.startFrameLoop(v),this.scene}async waitForReady(){return this.readyDeferred.promise}getMeshesByNameOrGroup(e){if(!this.scene)return[];const{meshGroups:t}=this.characterSetup.getCharacterSettings(),r=Array.isArray(e)?e:[e],i=[];for(const o of r)if(t!=null&&t[o]){const s=t[o];for(const c of s){const u=ad(this.scene,c);u&&i.push(u)}}else{const s=ad(this.scene,o);s&&i.push(s)}return Array.from(new Map(i.map(o=>[o.id,o])).values())}setMeshVisibility(e,t){if(!this.scene)return;if(w.log("scene","dev","setVisibility",e),!t){for(const i of this.scene.meshes)i.isVisible=e;return}const r=this.getMeshesByNameOrGroup(t);for(const i of r)i.isVisible=e}createCamera(e,t){if(this.engine===null)return null;const{Vector3:r,ArcRotateCamera:i}=he.getCore(),a=t.cameraTarget.length===3?r.FromArray(t.cameraTarget):r.Zero(),o=t.cameraAlpha,s=t.cameraBeta,c=t.cameraRadius,u=t.cameraFov,h=new i("Main Camera",o,s,c,a,e);return h.fov=u,h.minZ=0,h}updateCharacter(e=0){var t;(t=this.characterManager)==null||t.updateCharacter(e)}async importAnimations(e,t,r=!1){var s,c;if(!this.scene)throw new Error("Scene is not initialized");const{existingAnims:i,meshData:a,wasAlreadyLoaded:o}=await this.contentManager.importMeshWithDependencies(this.scene,e??"");if(w.log("scene","dev","Imported animations count: ",this.scene.animationGroups.length),r){(s=this.characterManager)==null||s.updateCharacter(t);return}(c=this.characterManager)==null||c.importAnimations(i,a,t,o)}startFrameLoop(e){if(!this.scene)return;const t=()=>{var i,a,o,s,c;if(!this.scene||!((i=this.characterManager)!=null&&i.actAnimator))return;if(!this.sceneIsReady)if(this.scene.isReady())this.sceneIsReady=!0,this.characterManager.initializeFace(),this.readyDeferred.resolve(),w.log("scene","dev","Scene ready - Deferred resolved");else return;w.incrementTick();const r=this.engine?this.engine.getDeltaTime():0;this.eventManager.onFrame(r),(a=this.environmentManager)==null||a.onFrame(r),(o=this.shaderManager)==null||o.onFrame(e,r),(s=this.effectsManager)==null||s.update(performance.now(),r),(c=this.poiManager)==null||c.update(),this.characterManager.onFrame(e,r,this.isInPreviewMode)};this.scene.onBeforeAnimationsObservable.add(t)}setState(e){return new Promise(t=>{if(this.isInPreviewMode){t();return}this.currentState=e,this.eventManager.emit({system:"app",name:e,payload:void 0}),t()})}testState(e){return new Promise(t=>{var a;if(!((a=this.characterManager)!=null&&a.fsmBehavior)){w.warn("babylon","dev","[AppearanceScene] FSM behavior not initialized, cannot test state"),t();return}const r=this.engine?this.engine.getDeltaTime():0,i={app:this,engine:this.engine,scene:this.scene,camera:this.camera,animator:this.characterManager.actAnimator??null,environmentManager:this.environmentManager,interactionManager:this.interactionManager,shaderManager:this.shaderManager,effectsManager:this.effectsManager,poiManager:this.poiManager};this.characterManager.fsmBehavior.testState(e,i,r),t()})}getNextPossibleStates(){var e;return(e=this.characterManager)!=null&&e.fsmBehavior?this.characterManager.fsmBehavior.getNextPossibleStates():(w.warn("babylon","dev","[AppearanceScene] FSM behavior not initialized, cannot get next possible states"),[])}async playAnimationPreview(e){var t;if(w.log("babylon","dev",`[AppearanceScene] Playing animation preview for key: ${e}`),this.isInPreviewMode=!0,!((t=this.characterManager)!=null&&t.animationStateMachine)){w.warn("babylon","dev","[AppearanceScene] Animation state machine not initialized, cannot play preview");return}if(!this.characterManager.actAnimator){w.warn("babylon","dev","[AppearanceScene] Animator not initialized, cannot play preview");return}try{const r=this.characterManager.animationStateMachine.getAnimationStates(),i=this.lookupAnimationDefinition(e,r);if(!i){w.warn("babylon","dev",`[AppearanceScene] Animation definition not found for key: ${e}`);return}const a=i.animationSequence;if(!a||a.length===0){w.warn("babylon","dev",`[AppearanceScene] No animation sequence found for key: ${e}`);return}const o=a[0];if(!(o!=null&&o.animationList)){w.warn("babylon","dev",`[AppearanceScene] No animation list found in first step for key: ${e}`);return}const s=this.getTransitionDuration(o.transition??"medium");let c=1;typeof o.loopCount=="number"?c=Math.min(o.loopCount,3):o.loopCount==="forever"?c=3:o.loopCount==="list"?c="list":c=1,w.log("babylon","dev",`[AppearanceScene] Playing animation: ${o.animationList} with transition: ${s}s, loops: ${c}`),await this.characterManager.actAnimator.playRandomPromise(o.animationList,s,c,o.easing),w.log("babylon","dev",`[AppearanceScene] Animation preview completed for key: ${e}`)}catch(r){w.error("babylon","dev",`[AppearanceScene] Error playing animation preview for key: ${e}`,r)}}lookupAnimationDefinition(e,t){let r=t;if(e.includes("/")){const i=e.split("/");for(const a of i)if(r&&typeof r=="object")r=r[a];else return null}else r=t[e];return r&&typeof r=="object"&&"animationSequence"in r?r:null}getTransitionDuration(e){switch(e){case"none":return 0;case"short":return .1;case"medium":return .25;case"long":return .5;case"extraLong":return 1;default:return .25}}setOnAppEventCallback(e){const t=e;this.eventManager.subscribe("app",r=>{typeof e=="function"?t(r):w.warn("babylon","dev","[AppearanceScene] setOnAppEventCallback: callback is not a function")})}setEventCallback(e,t){const r=t;this.eventManager.subscribe(e,i=>{typeof t=="function"?r(i):w.warn("babylon","dev","[AppearanceScene] setEventCallback: callback is not a function")})}moveToPosition(e,t){var g,v;if(!this.engine||!this.camera||!this.scene)return;const{engine:r}=this;if(e.length<=1)return;const{Vector2:i,Vector3:a,Matrix:o}=he.getCore(),{Lerp:s}=he.getMath(),c=r.getRenderWidth(),u=r.getRenderHeight(),h=new i(s(0,c,e[0]??0),s(0,u,e[1]??0)),f=new a(h.x,h.y,e[2]??0),p=a.Unproject(f,r.getRenderWidth(),r.getRenderHeight(),o.Identity(),this.scene.getViewMatrix(),this.scene.getProjectionMatrix());(v=(g=this.characterSetup).moveToPosition)==null||v.call(g,p,t)}setCameraDistance(e){const{ArcRotateCamera:t}=he.getCore();!this.camera||!(this.camera instanceof t)||(this.camera.radius=e)}interruptAnimation(){var t,r;w.log("babylon","dev",`[AppearanceScene] Interrupting animation, preview mode: ${this.isInPreviewMode}`);const e=(r=(t=this.characterManager)==null?void 0:t.actAnimator)==null?void 0:r.getCurrentAnimation();e&&(e.weight=0,e.stop()),this.isInPreviewMode&&(w.log("babylon","dev","[AppearanceScene] Exiting preview mode and re-evaluating state"),this.isInPreviewMode=!1,this.reevaluateState().catch(i=>{w.error("babylon","dev","[AppearanceScene] Error re-evaluating state after preview:",i)}))}async reevaluateState(){var r;w.log("babylon","dev","[AppearanceScene] Re-evaluating state from inputs");let e=null,t=!1;if((r=this.characterManager)!=null&&r.fsmBehavior)try{const i=this.characterManager.fsmBehavior.getCurrentFsmKey(),a=this.characterManager.fsmBehavior.getState();i&&a&&(e=`${i}/${a}`,t=!0,w.log("babylon","dev",`[AppearanceScene] Found active FSM state: ${e}, will force re-enter`))}catch(i){w.warn("babylon","dev","[AppearanceScene] Error getting FSM state:",i)}!e&&this.currentState&&(e=this.currentState,w.log("babylon","dev",`[AppearanceScene] Using stored current state: ${e}`)),e||(e="onboarding",w.log("babylon","dev",`[AppearanceScene] Falling back to default state: ${e}`)),w.log("babylon","dev",`[AppearanceScene] Re-evaluated to state: ${e}`),t&&e?(w.log("babylon","dev",`[AppearanceScene] Force re-entering FSM state to restart animations: ${e}`),await this.testState(e)):await this.setState(e)}onAnimationUpdated(e){}onAudioInputVolumeChanged(e){var t,r;(r=(t=this.characterSetup).onAudioInputVolumeChanged)==null||r.call(t,e)}onAudioOutputVolumeChanged(e){var t,r;(r=(t=this.characterSetup).onAudioOutputVolumeChanged)==null||r.call(t,e)}async updateAppearance(e){try{if(w.log("babylon","dev","[APPEARANCE-SCENE] ENTRY POINT: Starting appearance update",{mainColor:e.body.mainColor,secondaryColor:e.body.secondaryColor,props:e.props,hasShaderManager:!!this.shaderManager,hasEventManager:!!this.eventManager}),!this.shaderManager)throw w.error("babylon","dev","[APPEARANCE-SCENE] CRITICAL ERROR: ShaderManager is not initialized"),new Error("ShaderManager is not initialized");w.log("babylon","dev","[APPEARANCE-SCENE] EMITTING EVENT: appearance.updateAppearance",{eventSystem:"appearance",eventName:"updateAppearance",payloadKeys:Object.keys(e)}),this.eventManager.emit({system:"appearance",name:"updateAppearance",payload:e}),w.log("babylon","dev","[APPEARANCE-SCENE] EVENT EMITTED: Waiting for event processing completion"),await new Promise(t=>{(()=>{setTimeout(()=>{w.log("babylon","dev","[APPEARANCE-SCENE] EVENT PROCESSING: Timeout completed, resolving promise"),t()},10)})()}),w.log("babylon","dev","[APPEARANCE-SCENE] SUCCESS: Appearance update completed via event-driven architecture")}catch(t){throw w.error("babylon","dev","[APPEARANCE-SCENE] ERROR: Failed to update appearance",{error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0,mainColor:e.body.mainColor,secondaryColor:e.body.secondaryColor}),this.eventManager.emit({system:"appearance",name:"updateAppearance-error",payload:{error:t instanceof Error?t.message:String(t),appearanceData:e}}),t}}setupAppearanceEventListeners(){try{w.log("babylon","dev","[AppearanceScene] Setting up simplified appearance event listeners - processing delegated to dedicated event handlers"),w.log("babylon","dev","[AppearanceScene] Appearance event listeners set up successfully (delegated to event handlers)")}catch(e){w.error("babylon","dev","[AppearanceScene] Error setting up appearance event listeners:",e)}}registerPOIDiscoveryProvider(e){var t;(t=this.poiManager)==null||t.getDiscoveryManager().registerProvider({id:`external-${Date.now()}`,name:"External Provider",provider:e})}unregisterPOIDiscoveryProvider(e){var t;(t=this.poiManager)==null||t.getDiscoveryManager().unregisterProvider(e)}queryPOIsInBounds(e){return this.poiManager?this.poiManager.getRegistry().queryPOIs({center:{x:0,y:0,z:0},bounds:e}):[]}getNearestPOI(e){if(!this.poiManager)return null;const t=this.poiManager.findNearbyPOIs(e,1e3);return t.length>0?t[0]??null:null}setPOIAssistantEnabled(e){this.poiManager&&(e?this.poiManager.initialize().catch(t=>{w.error("babylon","dev","[AppearanceScene] Failed to enable POI system:",t)}):this.poiManager.shutdown())}getPOIAssistantEnabled(){var e;return((e=this.poiManager)==null?void 0:e.getStatus().initialized)??!1}navigateToPOI(e,t){if(!this.poiManager)return w.warn("poi-navigation","dev","POI Manager not available for navigation"),!1;try{const r=this.poiManager.getRegistry().getPOI(e);if(!r)return w.warn("poi-navigation","dev",`POI with ID '${e}' not found`),t!=null&&t.onError&&this.eventManager.emit({system:"poi-assistant",name:t.onError,payload:{error:`POI '${e}' not found`,poiId:e}}),!1;const i=r.bounds3D,a={x:i.x+i.width/2,y:i.y+i.height/2,z:i.z+i.depth/2},o=this.poiManager.getNavigationSystem();return t!=null&&t.speedCategory?this.poiManager.setMovementSpeedByCategory(t.speedCategory):(t==null?void 0:t.speed)!==void 0&&(this.poiManager.addSpeedCategory("_temp",{name:"Temporary Speed",speed:t.speed,description:"Temporary speed setting"}),this.poiManager.setMovementSpeedByCategory("_temp")),o.setPosition(a),t!=null&&t.onComplete&&this.eventManager.emit({system:"poi-assistant",name:t.onComplete,payload:{poiId:e,targetPosition:a,poi:r}}),w.log("poi-navigation","dev",`Successfully navigated to POI: ${e}`),!0}catch(r){return w.error("poi-navigation","dev",`Error navigating to POI '${e}':`,r),t!=null&&t.onError&&this.eventManager.emit({system:"poi-assistant",name:t.onError,payload:{error:String(r),poiId:e}}),!1}}navigateToPOIByCategory(e,t){if(!this.poiManager)return w.warn("poi-navigation","dev","POI Manager not available for navigation"),!1;try{const r=this.poiManager.getRegistry().queryPOIs({center:{x:0,y:0,z:0},category:e,limit:1,sortByDistance:!0});if(r.length===0)return w.warn("poi-navigation","dev",`No POI found with category '${e}'`),t!=null&&t.onError&&this.eventManager.emit({system:"poi-assistant",name:t.onError,payload:{error:`No POI found with category '${e}'`,category:e}}),!1;const i=r[0];if(!i)return!1;const a=i.bounds3D,o={x:a.x+a.width/2,y:a.y+a.height/2,z:a.z+a.depth/2},s=this.poiManager.getNavigationSystem();return t!=null&&t.speedCategory?this.poiManager.setMovementSpeedByCategory(t.speedCategory):(t==null?void 0:t.speed)!==void 0&&(this.poiManager.addSpeedCategory("_temp",{name:"Temporary Speed",speed:t.speed,description:"Temporary speed setting"}),this.poiManager.setMovementSpeedByCategory("_temp")),s.setPosition(o),t!=null&&t.onComplete&&this.eventManager.emit({system:"poi-assistant",name:t.onComplete,payload:{category:e,targetPosition:o,poi:i}}),w.log("poi-navigation","dev",`Successfully navigated to POI by category: ${e}`),!0}catch(r){return w.error("poi-navigation","dev",`Error navigating to POI by category '${e}':`,r),t!=null&&t.onError&&this.eventManager.emit({system:"poi-assistant",name:t.onError,payload:{error:String(r),category:e}}),!1}}navigateToPOIByTag(e,t){if(!this.poiManager)return w.warn("poi-navigation","dev","POI Manager not available for navigation"),!1;try{const r=this.poiManager.getRegistry().queryPOIs({center:{x:0,y:0,z:0},tags:[e],limit:1,sortByDistance:!0});if(r.length===0)return w.warn("poi-navigation","dev",`No POI found with tag '${e}'`),t!=null&&t.onError&&this.eventManager.emit({system:"poi-assistant",name:t.onError,payload:{error:`No POI found with tag '${e}'`,tag:e}}),!1;const i=r[0];if(!i)return!1;const a=i.bounds3D,o={x:a.x+a.width/2,y:a.y+a.height/2,z:a.z+a.depth/2},s=this.poiManager.getNavigationSystem();return t!=null&&t.speedCategory?this.poiManager.setMovementSpeedByCategory(t.speedCategory):(t==null?void 0:t.speed)!==void 0&&(this.poiManager.addSpeedCategory("_temp",{name:"Temporary Speed",speed:t.speed,description:"Temporary speed setting"}),this.poiManager.setMovementSpeedByCategory("_temp")),s.setPosition(o),t!=null&&t.onComplete&&this.eventManager.emit({system:"poi-assistant",name:t.onComplete,payload:{tag:e,targetPosition:o,poi:i}}),w.log("poi-navigation","dev",`Successfully navigated to POI by tag: ${e}`),!0}catch(r){return w.error("poi-navigation","dev",`Error navigating to POI by tag '${e}':`,r),t!=null&&t.onError&&this.eventManager.emit({system:"poi-assistant",name:t.onError,payload:{error:String(r),tag:e}}),!1}}navigateToPosition(e,t){if(!this.poiManager)return w.warn("poi-navigation","dev","POI Manager not available for navigation"),!1;try{const r=this.poiManager.getNavigationSystem();return t!=null&&t.speedCategory?this.poiManager.setMovementSpeedByCategory(t.speedCategory):(t==null?void 0:t.speed)!==void 0&&(this.poiManager.addSpeedCategory("_temp",{name:"Temporary Speed",speed:t.speed,description:"Temporary speed setting"}),this.poiManager.setMovementSpeedByCategory("_temp")),r.setPosition(e),t!=null&&t.onComplete&&this.eventManager.emit({system:"poi-assistant",name:t.onComplete,payload:{targetPosition:e}}),w.log("poi-navigation","dev",`Successfully navigated to position: (${e.x}, ${e.y}, ${e.z})`),!0}catch(r){return w.error("poi-navigation","dev","Error navigating to position:",r),t!=null&&t.onError&&this.eventManager.emit({system:"poi-assistant",name:t.onError,payload:{error:String(r),targetPosition:e}}),!1}}}class UAe extends HTMLElement{constructor(){super(),Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"appearanceScene",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"audioAnimationSyncHandler",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isFirstTime",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleResize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;(e=this.engine)==null||e.resize()}}),this.attachShadow({mode:"open"})}async connectedCallback(){try{tt.startTiming("loading",{component:"appearance-component",isFirstTime:this.isFirstTime});const e=this.getAttribute("first-time");e!==null&&(this.isFirstTime=e==="true"),this.renderCanvas(),tt.onMounted(this.isFirstTime),tt.addTimingMark("loading","babylon-init",!1),await this.initBabylon(),tt.addTimingMark("loading","babylon-ready",!0,"babylon-init"),window.addEventListener("resize",this.handleResize),this.dispatchEvent(new CustomEvent("appearance-ready"))}catch(e){tt.endTiming("loading",{success:!1,error:e instanceof Error?e.message:"Unknown error"}),console.error("AppearanceComponent: Error during initialization:",e)}}disconnectedCallback(){window.removeEventListener("resize",this.handleResize),this.disposeBabylon(),tt.reset()}renderCanvas(){this.shadowRoot&&(this.shadowRoot.innerHTML="",this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.display="block",this.canvas.id="appearance-canvas",this.shadowRoot.appendChild(this.canvas),console.log("AppearanceComponent: Canvas created"),w.log("AppearanceComponent","dev","Canvas created"))}async initBabylon(){if(console.log("AppearanceComponent: Initializing Babylon"),!this.canvas){console.error("AppearanceComponent: No canvas found");return}try{await he.loadLibraries(),tt.addTimingMark("loading","babylon-library-loaded"),tt.onBabylonLibrariesLoaded();const{Engine:e}=he.getCore();this.engine=new e(this.canvas,!0),console.log("AppearanceComponent: Engine created"),w.log("AppearanceComponent","dev","Engine created");const r=1/Math.min(window.devicePixelRatio||1,2);this.engine.setHardwareScalingLevel(r),this.engine.adaptToDeviceRatio=!0,tt.addTimingMark("loading","engine-initialized");const i=this.hasAttribute("debug");this.appearanceScene=new jAe(this.engine,[],i)}catch(e){throw console.error("AppearanceComponent: Error in initBabylon:",e),e}}disposeBabylon(){var e,t;(e=this.engine)==null||e.stopRenderLoop(),this.appearanceScene=null,(t=this.engine)==null||t.dispose(),this.engine=null}init(e){if(w.sessionStart(),!this.canvas||!this.engine||!this.appearanceScene){console.log("AppearanceComponent: Engine not initialized","canvas:",this.canvas,"engine:",this.engine,"appearanceScene:",this.appearanceScene),w.error("AppearanceComponent","dev","Engine not initialized.");return}tt.addTimingMark("loading","init-start",!1);const t=e;console.log("AppearanceComponent: init arg:",t),w.log("AppearanceComponent","dev",JSON.stringify(t)),this.appearanceScene.initScene(this.canvas,t).then(i=>{var a,o;return tt.addTimingMark("loading","scene-initialized",!0,"init-start"),tt.onSceneInitialized(cT),(a=this.engine)==null||a.runRenderLoop(()=>{i.render()}),this.connectSyncHandlerIfReady(),(o=this.appearanceScene)==null?void 0:o.waitForReady()}).then(()=>{tt.addTimingMark("loading","scene-ready",!0,"scene-initialized"),tt.endTiming("loading",{success:!0}),tt.onAppearanceRendered(cT),console.log("AppearanceComponent: Appearance Loading complete"),w.log("AppearanceComponent","dev","Appearance Loading complete"),this.dispatchEvent(new CustomEvent("load-complete"))}).catch(i=>{tt.endTiming("loading",{success:!1,error:i instanceof Error?i.message:"Unknown error"}),w.error("AppearanceComponent","dev","Error initializing appearance scene:",i)})}setState(e){var t;(t=this.appearanceScene)==null||t.setState(e)}testState(e){var t;(t=this.appearanceScene)==null||t.testState(e)}getNextPossibleStates(){var e;return((e=this.appearanceScene)==null?void 0:e.getNextPossibleStates())??[]}setAnimationState(e){var t;w.warn("AppearanceComponent","dev","setAnimationState is deprecated, use setState instead."),(t=this.appearanceScene)==null||t.setState(e)}setOnAppEventCallback(e){var t;(t=this.appearanceScene)==null||t.setOnAppEventCallback(e)}setCameraDistance(e){var t;(t=this.appearanceScene)==null||t.setCameraDistance(e)}moveToScreenPosition(e,t){var r;(r=this.appearanceScene)==null||r.moveToPosition(e,t)}setAudioAnimationSyncHandler(e){this.audioAnimationSyncHandler=e,this.connectSyncHandlerIfReady()}connectSyncHandlerIfReady(){var t,r;if(!this.audioAnimationSyncHandler)return;const e=(r=(t=this.appearanceScene)==null?void 0:t.characterManager)==null?void 0:r.facialManager;e&&e.setSyncHandler(this.audioAnimationSyncHandler)}async updateAppearance(e){if(!this.appearanceScene)throw new Error("AppearanceScene is not initialized");return this.appearanceScene.updateAppearance(e)}}customElements.define("appearance-component",UAe);class zF{}class FAe extends zF{isValidData(e){return!!e.poseDiffusion}processFrame(e,t){return BAe(e,t??null)}interpolate(e,t,r){const i=he.getMath(),{Lerp:a}=i;return{type:"spda2e",expression:{viseme:new Array(28).fill(0).map((s,c)=>a(e.expression.viseme[c]??0,t.expression.viseme[c]??0,r))}}}}function vs(n,e){if(e>=n.length)throw new Error("index out of range");return n[e]===void 0?0:n[e]}function BAe(n,e){const t={type:"spda2e",expression:{viseme:new Array(28).fill(0)}},{poseDiffusion:r}=n;if(r.length<97)return w.warn("lip-sync","dev","Invalid frame length for A2E frame",n),t;const i=t.expression.viseme;if(i[12]=vs(r,78),i[16]=vs(r,43),i[17]=vs(r,43),i[21]=vs(r,72),i[23]=.5*vs(r,52)+.5*vs(r,53),i[24]=.75*vs(r,76),i[26]=.75*vs(r,76),e!==null){const a=e.expression.viseme;for(let o=0;o<i.length;o+=1)i[o]=lT(a[o]??0,i[o]??0,0,.3)}return t}class HAe extends zF{isValidData(e){return!!e.viseme}processFrame(e,t){return VAe(e,t??null)}interpolate(e,t,r){return GAe(e,t,r)}}const $Ae=["Viseme_Neutral","Viseme_AI","Viseme_E","Viseme_U","Viseme_CDG","Viseme_WQ","Viseme_O","Viseme_L","Viseme_ShCh","Viseme_FV","Viseme_MBP"],zAe=[0,1,1,6,2,3,4,5,6,1,6,1,2,5,7,4,8,7,9,4,4,10];function VAe(n,e=null){const t=he.getCore(),{Quaternion:r,Vector3:i}=t,a=.3,o=.5,s=1,c=["eye_BlinkUp","eye_Squint","eye_RSquare"],u=[.5,.2,.2];r.RotationAxis(i.Right(),Math.PI/4).conjugate(),new i(s,s,s),new i(-1,-1,-1);const f={type:"vasa",pose:{translation:new i(0,0,0),rotation:r.Identity()},expression:{eyes_open_ratio:0,eye_BlinkUp:0,eye_Squint:0,eye_RSquare:0,eyebrow_value:0,eyebrow_height:0,eyebrow_bend:0,viseme:new Array(11).fill(0),viseme22_idx:0,viseme11_idx:0}},p=n.eyesOpenRatio[0]??0;f.expression.eyes_open_ratio=p;{const g=Math.round(n.viseme[0]??0),v=zAe[g]??0;f.expression.viseme[v]=1,e!==null&&e.expression.viseme22_idx!==g&&(f.expression.viseme[v]=.9),f.expression.viseme22_idx=g,f.expression.viseme11_idx=v}if(e!==null){for(const[S,E]of c.entries()){const T=u[S]??0;f.expression[E]=lT(e.expression[E],f.expression[E],0,T)}const g=f.expression.viseme,v=e.expression.viseme;if((g[10]??0)<1e-6)for(let S=0;S<$Ae.length;S+=1)g[S]=lT(v[S]??0,g[S]??0,0,a);const b=f.pose.translation,C=e.pose.translation;f.pose.translation=new i(b.x*o+C.x*(1-o),b.y*o+C.y*(1-o),b.z*o+C.z*(1-o))}return f}function GAe(n,e,t){const r=he.getCore(),i=he.getMath(),{Vector3:a,Quaternion:o}=r,{Lerp:s}=i;return{type:"vasa",pose:{translation:a.Lerp(n.pose.translation,e.pose.translation,t),rotation:o.Slerp(n.pose.rotation,e.pose.rotation,t)},expression:{eyes_open_ratio:0,eye_BlinkUp:s(n.expression.eye_BlinkUp,e.expression.eye_BlinkUp,t),eye_Squint:s(n.expression.eye_Squint,e.expression.eye_Squint,t),eye_RSquare:s(n.expression.eye_RSquare,e.expression.eye_RSquare,t),eyebrow_value:0,eyebrow_height:s(n.expression.eyebrow_height,e.expression.eyebrow_height,t),eyebrow_bend:s(n.expression.eyebrow_bend,e.expression.eyebrow_bend,t),viseme:new Array(11).fill(0).map((u,h)=>s(n.expression.viseme[h]??0,e.expression.viseme[h]??0,t)),viseme22_idx:0,viseme11_idx:0}}}class od{static get(e){switch(e){case"easeInOutCubic":return t=>od.easeInOutCubic(t);default:return t=>od.linear(t)}}static clampToUnitRange(e){return Math.min(Math.max(e,0),1)}static linear(e){return od.clampToUnitRange(e)}static easeInOutCubic(e){return od.clampToUnitRange(e<.5?4*e**3:1-(-2*e+2)**3/2)}}const KAe=6e3,qAe=12,WAe=.5,cO=.04;function YAe(n){return new Promise(e=>{setTimeout(e,n)})}function QAe(n){switch(n){case"vasa":return new HAe;case"spda2e":return new FAe;default:throw new Error(`Unsupported model type: ${n}`)}}class JAe{constructor(e="spda2e"){Object.defineProperty(this,"modelType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frameProcessor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frames",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"currentAudioTimeProvider",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"appearanceReady",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"enableFrameAppend",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"animationPreparedDeferred",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frameOffsetTimeAvailable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"currentFrameIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.setModelType(e),this.reset()}setModelType(e){this.modelType=e,this.frameProcessor=QAe(e)}setReady(){this.appearanceReady=!0,this.checkAnimationSync()}startTurn(){w.log("lip-sync","dev","AudioAnimationSyncHandler: Starting turn"),this.reset(),this.enableFrameAppend=!0}interruptTurn(){w.log("lip-sync","dev","AudioAnimationSyncHandler: Interrupting turn"),this.reset()}finishTurn(){var e;w.log("lip-sync","dev","AudioAnimationSyncHandler: Finishing turn"),this.appearanceReady&&((e=this.animationPreparedDeferred)==null||e.resolve())}addFrame({frame:e,offsetInMilliseconds:t}){if(!e||!this.frameProcessor.isValidData(e)){w.error("lip-sync","dev","AudioAnimationSyncHandler: Invalid frame data",e);return}w.log("lip-sync","dev","AudioAnimationSyncHandler: Adding frame",this.frames.length),this.modelType!==e.model&&this.setModelType(e.model);const r=this.frames[this.frames.length-1],i=this.frameProcessor.processFrame(e,r);i.offset=t&&t/1e3,this.frames.push(i),this.frameOffsetTimeAvailable=this.frames.every(({offset:a})=>!Number.isNaN(a)),this.checkAnimationSync()}getCurrentFrame(){var f;if(!this.enableFrameAppend||this.frames.length===0||!this.currentAudioTimeProvider)return null;const e=this.currentAudioTimeProvider(),t=this.getCurrentFrameIndex();if(t<0||t>=this.frames.length-1)return null;const r=Math.ceil(t),i=r-1,a=this.frames[i],o=this.frames[r];if(!a||!o)return null;let s=0;if(this.frameOffsetTimeAvailable){const p=o.offset-a.offset;s=(this.playbackTime-a.offset)/p}else s=t-i;const c=this.frameProcessor.interpolate(a,o,s),u=this.frameOffsetTimeAvailable?(f=this.frames[this.frames.length-1])==null?void 0:f.offset:this.frames.length*cO,h=ZAe(e,u??0,WAe);return{data:c,blendWeight:h}}setCurrentAudioTimeProvider(e){this.currentAudioTimeProvider=e}get playbackTime(){var e;return((e=this.currentAudioTimeProvider)==null?void 0:e.call(this))??0}getCurrentFrameIndex(){if(this.frameOffsetTimeAvailable){let e=this.currentFrameIndex;for(;e<this.frames.length;e+=1){this.currentFrameIndex=e;const t=this.frames[e];if((t==null?void 0:t.offset)!==void 0&&t.offset!==null&&t.offset>=this.playbackTime)break}return e}return Math.round(this.playbackTime/cO)}getAnimationPreparedPromise(){var e;return this.animationPreparedDeferred||(this.initializeAnimationSync(),this.checkAnimationSync()),((e=this.animationPreparedDeferred)==null?void 0:e.promise)??Promise.resolve()}get frameCount(){return this.frames.length}initializeAnimationSync(){let e,t;const r=new Promise((o,s)=>{e=o,t=s}),i=YAe(KAe),a=Promise.race([r,i]).finally(()=>{this.animationPreparedDeferred=void 0});this.animationPreparedDeferred={promise:a,resolve:e,reject:t}}checkAnimationSync(){var e;this.appearanceReady&&this.frameCount>qAe&&((e=this.animationPreparedDeferred)==null||e.resolve())}reset(){this.frames=[],this.enableFrameAppend=!1,this.currentFrameIndex=0,this.animationPreparedDeferred&&(this.animationPreparedDeferred.reject(),this.animationPreparedDeferred=void 0)}}function ZAe(n,e,t=0){let r=1;return n<t&&(r=n/t),n>e-t&&(r=Math.max(0,(e-n)/t)),od.get("easeInOutCubic")(r)}class VF{constructor(){B(this,"audioContext");B(this,"audioAnalyser")}get isInitialized(){return this.audioContext!==void 0&&this.audioContext.state!=="closed"}async initialize({sampleRate:e}){this.audioContext&&await this.cleanup();try{this.audioContext=new AudioContext({sampleRate:e}),this.audioAnalyser=this.audioContext.createAnalyser()}catch(t){const r=t instanceof Error?t.message:String(t);throw new Error(`Failed to initialize audio context: ${r}`)}}async cleanup(){this.audioContext&&this.audioContext.state!=="closed"&&await this.audioContext.close(),this.audioContext=void 0,this.audioAnalyser=void 0}}const uT=24e3,Zb=24e3,XAe=1;function eke(n){const e=atob(n),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i+=1)r[i]=e.charCodeAt(i);return r.buffer}function tke(n){let e="";const t=new Uint8Array(n),r=t.byteLength;for(let i=0;i<r;i+=1){const a=t[i];typeof a=="number"&&(e+=String.fromCharCode(a))}return btoa(e)}function e7e(n){if(!n.every(e=>Number.isInteger(e)&&e>=0&&e<=255))throw new Error("All bytes must be integers between 0 and 255");return new Uint8Array(n).buffer}function GF(n){const e=eke(n),t=new Int16Array(e),r=new Float32Array(t.length);for(let i=0;i<t.length;i+=1)r[i]=t[i]/32768;return r}function nke(n){const e=n<0?n*32768:n*32767;return Math.max(-32768,Math.min(32767,e))}function rke(n){let e=0;for(const t of n){const r=t-128;e+=r*r}return Math.sqrt(e/n.length)}function KF(n){return n/Qp}function t7e(n){return`${KF(n)}x`}function n7e(n,e){const t=document.createElement("a");t.href=n,t.download=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}function r7e(n){const e=Math.floor(n/60),t=n%60;return`${e}:${t.toString().padStart(2,"0")}`}function lO(n,e){_t.emit(`voice:audio-${e}-volume-changed`,n)}function ike(n,e,t){if(e===t)return n;const r=n.length,i=e/t,a=Math.ceil(r/i),o=new Float32Array(a);for(let s=0;s<a;s+=1){const c=s*i,u=Math.floor(c),h=u+1,f=n[u]??0,p=n[h]??0,g=c-u;o[s]=f*(1-g)+p*g}return o}class qF{constructor(e){B(this,"mode");B(this,"volumeUpdateRaf",-1);B(this,"audioAnalyser");B(this,"volume",Bz(0));this.mode=e}startTracking(e){this.audioAnalyser&&this.stopTracking(),this.audioAnalyser=e,this.trackVolume()}trackVolume(){if(!this.audioAnalyser){this.stopTracking();return}const e=new Uint8Array(this.audioAnalyser.frequencyBinCount);this.audioAnalyser.getByteTimeDomainData(e);const t=rke(e);Math.abs(t-this.volume.get())>XAe&&(this.volume.set(t),lO(t,this.mode)),this.volumeUpdateRaf=requestAnimationFrame(()=>{this.trackVolume()})}stopTracking(){this.volumeUpdateRaf!==-1&&(cancelAnimationFrame(this.volumeUpdateRaf),this.volumeUpdateRaf=-1),this.audioAnalyser=void 0,this.volume.set(0),lO(0,this.mode)}}const ake="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/call_ending-BxIIadI4.mp3",oke="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/call_opening-CKuCznU5.mp3";function i7e(){return ee("use-appearance-component-package")}function ske(){return $e("use-appearance-component-package")}class cke{constructor(e={}){B(this,"options");B(this,"antiAliasFilter");this.options={windowSize:e.windowSize??1024,overlap:e.overlap??.7,tolerance:e.tolerance??200,useAntiAlias:e.useAntiAlias??!0,correlationWindowMultiplier:e.correlationWindowMultiplier??1.5,useSampleRateAwareScaling:e.useSampleRateAwareScaling??!1,useFirstFrameCompensation:e.useFirstFrameCompensation??!0},this.options.useAntiAlias&&this.initAntiAliasFilter()}initAntiAliasFilter(){this.antiAliasFilter=new Float32Array([.03,.09,.2,.36,.2,.09,.03])}getSampleRateScaling(e){if(!this.options.useSampleRateAwareScaling||!e)return 1;const r=e/24e3;return Math.max(.5,Math.min(2,r))}process(e,t=1,r){const i=this.getSampleRateScaling(r),{tolerance:a}=this.options;let{windowSize:o}=this.options;const{overlap:s}=this.options,{useAntiAlias:c}=this.options;if(this.options.useSampleRateAwareScaling&&i!==1&&(o=Math.round(o*i),o=Math.max(256,Math.min(4096,o))),Math.abs(t-1)<.001)return e;const u=c?this.applyAntiAliasFilter(e):e,h=Math.round(o*(1-s)),f=Math.round(h*t),p=Math.ceil(u.length/t),g=new Float32Array(p),v=this.createImprovedWindow(o),y=Math.min(o,u.length,p);this.overlapAddFrameEnhanced(u,0,g,0,v,y);let b=0,C=0;for(;b<p-o&&!(C>=u.length-o-a);){const S=this.findBestMatchEnhanced(u,C,g,b,o,a);this.overlapAddFrameEnhanced(u,S,g,b,v,o),b+=h,C+=f}return g}applyAntiAliasFilter(e){if(!this.antiAliasFilter||this.antiAliasFilter.length===0)return e;const t=new Float32Array(e.length),r=this.antiAliasFilter.length,i=Math.floor(r/2);for(let a=0;a<e.length;a+=1){let o=0;for(let s=0;s<r;s+=1){const c=a-i+s;c>=0&&c<e.length&&(o+=(e[c]??0)*(this.antiAliasFilter[s]??0))}t[a]=o}return t}createImprovedWindow(e){const t=new Float32Array(e);for(let r=0;r<e;r+=1){const i=2*Math.PI*r/(e-1),a=.5*(1-Math.cos(i)),o=.04*Math.cos(2*i);t[r]=a-o}return t}setOptions(e){this.options={...this.options,...e}}overlapAddFrameEnhanced(e,t,r,i,a,o){const s=Math.min(i+o,r.length),c=Math.min(o,e.length-t,s-i),u=i===0,h=this.options.useFirstFrameCompensation??!0;let f=1;if(u&&h){const{windowSize:p,overlap:g}=this.options;p>=1700&&g>=.8?f=1.5:p>=1400&&g>=.75?f=1.15:p>=1200&&g>=.7?f=1.25:f=1.2}for(let p=0;p<c;p+=1){const g=e[t+p]??0,v=a[p]??0,y=i+p;let b=1;i>0&&p<o*.1&&(b=p/(o*.1));let C=1;if(u&&h){const S=Math.max(.1,1-p/o*.9);C=1+(f-1)*S}typeof r[y]=="number"&&(r[y]+=g*v*b*C)}}findOptimalStartPosition(e,t,r,i){const a=Math.min(i,r/4),o=Math.max(0,t-a),s=Math.min(e.length-r,t+a);let c=t,u=-1/0;for(let h=o;h<=s;h+=1){let f=0,p=0,g=0,v=0;const y=Math.min(r,512);for(let k=0;k<y;k+=1)if(h+k<e.length){const x=e[h+k]??0;f+=x*x,p+=Math.abs(x),k>0&&v*x<0&&(g+=1),v=x}const b=Math.sqrt(f/y),C=p/y,S=C>0?b/C:0,E=b*.6,T=S*.3,A=g>0?Math.min(1,10/g)*.1:0,I=E+T+A;I>u&&(u=I,c=h)}return c}findBestMatchEnhanced(e,t,r,i,a,o){if(i===0)return this.findOptimalStartPosition(e,t,a,o);const s=Math.max(0,t-o),c=Math.min(e.length-a,t+o),u=Math.floor(a*(this.options.correlationWindowMultiplier??1.5)),h=Math.min(u,a),f=new Float32Array(h),p=Math.max(0,i-h);let g=0,v=0,y=0;for(let S=0;S<h;S+=1){const E=p+S;if(E<r.length){f[S]=r[E]??0;const T=f[S]??0;g+=T*T,S>0&&y*T<0&&(v+=1),y=T}}let b=t,C=-1/0;for(let S=s;S<=c;S+=1){let E=0,T=0,A=0,I=0;for(let j=0;j<h;j+=1)if(S+j<e.length&&p+j<r.length){const J=e[S+j]??0;E+=(f[j]??0)*J,T+=J*J,j>0&&I*J<0&&(A+=1),I=J}const k=g>0&&T>0?E/Math.sqrt(g*T):0,x=Math.abs(A-v),_=Math.max(A,v),R=_>0?1-x/_:1,z=k*.8+R*.2;z>C&&(C=z,b=S)}return b}}const lke={windowSize:2048,overlap:.5,tolerance:128,useAntiAlias:!0,correlationWindowMultiplier:1.6,useFirstFrameCompensation:!0},uke={windowSize:1792,overlap:.5,tolerance:300,useAntiAlias:!0,correlationWindowMultiplier:1.8,useFirstFrameCompensation:!0},dke={windowSize:1280,overlap:.65,tolerance:280,useAntiAlias:!0,correlationWindowMultiplier:1.6,useFirstFrameCompensation:!0},hke={windowSize:1536,overlap:.75,tolerance:300,useAntiAlias:!0,correlationWindowMultiplier:1.6,useFirstFrameCompensation:!0};function fke(n){switch(n){case 1.5:return hke;case 1.25:return dke;case 1.1:return uke;case .8:return lke;case 1:default:return}}const uO=new cke;function pke(n,e,t){const r=fke(e);return r?(uO.setOptions(r),uO.process(n,e,t)):n}function dT(){return/firefox/i.test(navigator.userAgent)}function WF(n,e,t=1){const r=typeof n=="string"?GF(n):n;let i=r;t!==1&&(i=pke(r,t,Zb));const a=e.createBuffer(1,i.length,Zb);a.getChannelData(0).set(i);const o=e.createBufferSource();return o.buffer=a,o}async function mke(n,e,t,r,i){const a=r&&await r();let o=8192;$e("audio-buffer-size-4096")?o=4096:$e("audio-buffer-size-2048")&&(o=2048);const s=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0,autoGainControl:!0,sampleRate:dT()?void 0:uT,...a}}),c=s.getAudioTracks()[0];c&&(c.onended=f=>{i==null||i(f)});const u=e.createMediaStreamSource(s),h=e.createScriptProcessor(o,1,1);return u.connect(t),t.connect(h),h.connect(e.destination),h.onaudioprocess=f=>{let p=f.inputBuffer.getChannelData(0);dT()&&(p=ike(p,e.sampleRate,uT));const g=new Int16Array(p.length);for(let y=0;y<p.length;y+=1){const b=p[y];typeof b=="number"&&(g[y]=nke(b))}const v=tke(g.buffer);n(v)},s}async function dO(n,e){const t=await Promise.race([oA(e),new Promise(r=>{try{const i=new Audio(n);i.addEventListener("ended",()=>r(i),{once:!0}),i.play()}catch{}})]);t==null||t.remove()}const gke=Zb*2;class vke{constructor(){B(this,"audioBuffer",[]);B(this,"totalBufferSize",0);B(this,"lastProcessOptions",null)}addAudioData(e){if(!e)return!1;const t=GF(e),r=t.length;return r===0?!1:(this.audioBuffer.push({audioData:t,bufferSize:r}),this.totalBufferSize+=r,this.totalBufferSize>=gke)}getLastProcessOptions(){return this.lastProcessOptions}setLastProcessOptions(e){this.lastProcessOptions=e}mergeAudioChunks(){const e=new Float32Array(this.totalBufferSize);let t=0;for(const r of this.audioBuffer){const{audioData:i}=r;e.set(i,t),t+=i.length}return e}getAudioData(){if(this.audioBuffer.length===0)return null;if(this.audioBuffer.length===1){const e=this.audioBuffer[0];return e?e.audioData:null}return this.mergeAudioChunks()}clearBuffer(){this.audioBuffer=[],this.totalBufferSize=0}}function bke(n,e,t){e.setLastProcessOptions(n),e.addAudioData(n.data)&&YF(e,t)}function yke(n,e){YF(n,e)}function YF(n,e){const t=n.getAudioData(),r=n.getLastProcessOptions();!t||!r||(e(WF(t,r.audioContext,r.playbackRate)),n.clearBuffer())}const a7e={lmks_rest:"lmksRest",frames:"frames",expr:"expr",neck_pose:"neckPose",jaw_pose:"jawPose",eyes_pose:"eyesPose",eyes_open_ratio:"eyesOpenRatio",rotation:"rotation",translation:"translation",lmks:"lmks"};class Cke{constructor(e,t){B(this,"lmksRest");B(this,"frames");this.lmksRest=e,this.frames=t}}class Ske{constructor(e,t){B(this,"exp");B(this,"pose");this.exp=e,this.pose=t}isValid(){return this.exp.dtype!==""&&this.exp.data.length>0||this.pose.dtype!==""&&this.pose.data.length>0}}const{EPSILON:hT}=Number,wke=["Viseme_Neutral","Viseme_AI","Viseme_E","Viseme_U","Viseme_CDG","Viseme_WQ","Viseme_O","Viseme_L","Viseme_ShCh","Viseme_FV","Viseme_MBP"],Eke=[0,1,1,6,2,3,4,5,6,1,6,1,2,5,7,4,8,7,9,4,4,10],Os={enablePose:!1,enableNeck:!1,enableEye:!1,enableEyebrow:!1};function o7e(n){Os.enablePose=n,Os.enableNeck=n,Os.enableEye=n,Os.enableEyebrow=n}function Tke(n,e=null){const{Quaternion:t,Vector3:r}=oo.getCore(),i=.3,a=.5,o=30/360*Math.PI,s=1,c=.01,u=["eye_BlinkUp","eye_Squint","eye_RSquare"],h=[.5,.2,.2],f=.5,p=.3,g=t.RotationAxis(r.Right(),Math.PI/4),v=g.conjugate(),y=new r(s,s,s),b=new r(-1,-1,-1),C={pose:{translation:new r(0,0,0),rotation:t.Identity()},expression:{eyes_open_ratio:0,eye_BlinkUp:0,eye_Squint:0,eye_RSquare:0,eyebrow_value:0,eyebrow_height:0,eyebrow_bend:0,viseme:new Array(11).fill(0),viseme22_idx:0,viseme11_idx:0},offset:n.offset??null};if(Os.enablePose){let E=hO(n.rotation);if(Os.enableNeck){const k=hO(n.neckPose);E.multiplyInPlace(k)}E=g.multiplyToRef(E,E).multiplyToRef(v,E);let[T,A]=Ake(E);A>o&&(A=o),C.pose.rotation=t.RotationAxis(T,A);const I=r.FromArray(n.translation);r.ClampToRef(I,b,y,I),C.pose.translation=I}const S=n.eyesOpenRatio[0]??0;if(C.expression.eyes_open_ratio=S,Os.enableEye&&e!==null){let E=0,T=0,A=0;if(e.expression.eye_BlinkUp>0)S<.9&&(E=1,T=0,A=0);else if(e.expression.eye_Squint>0)S<.9&&(E=0,T=f,A=0);else if(e.expression.eye_RSquare>0)S>1.1&&(E=0,T=0,A=p);else{const I=e.expression.eyes_open_ratio;S<.75&&I<.8?(E=1,T=0,A=0):S<.8&&I<.85?(E=0,T=f,A=0):S>1.1&&(E=0,T=0,A=p)}C.expression.eye_BlinkUp=E,C.expression.eye_Squint=T,C.expression.eye_RSquare=A}if(Os.enableEyebrow){const E=n.viseme.slice(1,4);C.expression.eyebrow_value=n.viseme[2]??0,C.expression.eyebrow_height=XM(((E[1]??0)-0)*2)*c,C.expression.eyebrow_bend=XM((0-(E[1]??0))*3)}{const E=Math.round(n.viseme[0]??0),T=Eke[E]??0;C.expression.viseme[T]=1,e!==null&&e.expression.viseme22_idx!==E&&(C.expression.viseme[T]=.9),C.expression.viseme22_idx=E,C.expression.viseme11_idx=T}if(e!==null){for(const[x,_]of u.entries()){const R=h[x]??0;C.expression[_]=fO(e.expression[_],C.expression[_],0,R)}const E=C.expression.viseme,T=e.expression.viseme;if((E[10]??0)<1e-6)for(let x=0;x<wke.length;x+=1)E[x]=fO(T[x]??0,E[x]??0,0,i);const I=C.pose.translation,k=e.pose.translation;C.pose.translation=new r(I.x*a+k.x*(1-a),I.y*a+k.y*(1-a),I.z*a+k.z*(1-a))}return C}function Ike(n){const{TmpVectors:e,Vector3:t}=oo.getCore(),r=e.Vector3[0];r.fromArray(n);const i=r.length();return i<hT?[t.Up(),0]:[r.scale(1/i),i]}function hO(n){const{Quaternion:e}=oo.getCore(),[t,r]=Ike(n);return e.RotationAxis(t,r)}function Ake(n){const{Vector3:e}=oo.getCore(),t=n.lengthSquared();Math.abs(t-1)>hT&&n.normalize();const r=Math.acos(n.w),i=r*2,a=Math.sin(r),o=Math.abs(a)<5e-4?1:a,s=new e(n.x/o,n.y/o,n.z/o);return s.lengthSquared()<hT&&(s.y=1),[s,i]}function fO(n,e,t,r){return Math.abs(e-n)<t?n:n<e?Math.min(n+r,e):Math.max(n-r,e)}function kke(n,e,t){const{Vector3:r,Quaternion:i}=oo.getCore(),{Lerp:a}=oo.getMath();return{pose:{translation:r.Lerp(n.pose.translation,e.pose.translation,t),rotation:i.Slerp(n.pose.rotation,e.pose.rotation,t)},expression:{eyes_open_ratio:0,eye_BlinkUp:a(n.expression.eye_BlinkUp,e.expression.eye_BlinkUp,t),eye_Squint:a(n.expression.eye_Squint,e.expression.eye_Squint,t),eye_RSquare:a(n.expression.eye_RSquare,e.expression.eye_RSquare,t),eyebrow_value:0,eyebrow_height:a(n.expression.eyebrow_height,e.expression.eyebrow_height,t),eyebrow_bend:a(n.expression.eyebrow_bend,e.expression.eyebrow_bend,t),viseme:new Array(11).fill(0).map((s,c)=>a(n.expression.viseme[c]??0,e.expression.viseme[c]??0,t)),viseme22_idx:0,viseme11_idx:0}}}const xke=3.141592653589793,pO="System.Single, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089";function _ke(n){const e=[],t=[],r=(s,c)=>{if(c>=s.length)throw new Error("index out of range");return s[c]===void 0?0:s[c]};for(const{frame:s,offset:c}of n){if(s.length<97)return console.log("Invalid frame length"),null;const u=new Array(28).fill(0);u[12]=r(s,78),u[16]=r(s,43),u[17]=r(s,43),u[21]=r(s,72),u[23]=.5*r(s,52)+.5*r(s,53),u[24]=.75*r(s,76),u[26]=.75*r(s,76),e.push({exp:u,offset:c});const h=[[-1*r(s,88)+xke,-1*r(s,89),r(s,90)],[0,r(s,92),-1*r(s,91)],[0,r(s,95),-1*r(s,94)]];t.push(h)}const i={dtype:pO,shape:[e.length,16],data:e,isColumnMajor:!1},a={dtype:pO,shape:[t.length,3,3],data:t,isColumnMajor:!1};return new Ske(i,a)}class Mke{constructor(e){B(this,"activeModel",null);B(this,"a2eAnimationData",null);B(this,"vasaAnimationData",null);B(this,"vasaExpFrames",[]);B(this,"frameOffsetTimeAvailable",!1);B(this,"currentFrameIndex",0);this.getPlayTime=e}get fps(){return this.activeModel==="spda2e"?EW:this.activeModel==="vasa"?TW:25}get frameCount(){return this.activeModel==="spda2e"&&this.a2eAnimationData?this.a2eAnimationData.exp.data.length:this.activeModel==="vasa"&&this.vasaAnimationData?this.vasaAnimationData.frames.length:0}get playbackTime(){return this.getPlayTime()}reset(){this.activeModel=null,this.a2eAnimationData=null,this.vasaAnimationData=null,this.vasaExpFrames=[],this.frameOffsetTimeAvailable=!1,this.currentFrameIndex=0}setFrameData({frame:e,offsetInMilliseconds:t}){e&&(this.activeModel=e.model,e.model==="spda2e"&&this.setA2EFrame(e.poseDiffusion,t),e.model==="vasa"&&this.setVasaFrameData(e,t))}setA2EFrame(e,t){if(!(e!=null&&e.length))return;const r=_ke([{frame:e,offset:t}]);if(r){if(!this.a2eAnimationData){this.a2eAnimationData=r;return}this.a2eAnimationData.exp.data.push(...r.exp.data),this.a2eAnimationData.pose.data.push(...r.pose.data),this.frameOffsetTimeAvailable=this.a2eAnimationData.exp.data.every(({offset:i})=>!Number.isNaN(i))}}setVasaFrameData(e,t){if(!e)return;const r={...e,offset:t};if(!this.vasaAnimationData){this.vasaAnimationData=new Cke([],[r]);return}this.vasaExpFrames.push(Tke(r,this.vasaExpFrames.at(-1))),this.vasaAnimationData.frames.push(r),this.frameOffsetTimeAvailable=this.vasaAnimationData.frames.every(({offset:i})=>!Number.isNaN(i))}getCurrentFrameIndex(e){if(this.frameOffsetTimeAvailable){let t=this.currentFrameIndex;for(;t<e.length;t+=1){this.currentFrameIndex=t;const r=e[t];if((r==null?void 0:r.offset)!==void 0&&r.offset!==null&&r.offset/1e3>=this.playbackTime)break}return t}return Math.round(this.playbackTime/(1/this.fps))}getCurrentA2EFrame(){if(!this.a2eAnimationData)return null;const e=this.a2eAnimationData.exp.data;return this.currentFrameIndex=this.getCurrentFrameIndex(e),e[this.currentFrameIndex]??null}getCurrentVasaFrame(){if(!this.vasaAnimationData)return null;const{frames:e,lmksRest:t}=this.vasaAnimationData;this.currentFrameIndex=this.getCurrentFrameIndex(e);const r=e[this.currentFrameIndex];return r?{frame:r,lmksRest:t}:null}getCurrentVasaExpFrame(){if(!this.vasaAnimationData)return null;this.currentFrameIndex=this.getCurrentFrameIndex(this.vasaExpFrames);const e=this.vasaExpFrames[this.currentFrameIndex-1],t=this.vasaExpFrames[this.currentFrameIndex];if(e&&t&&this.playbackTime<(t.offset??1/0)/1e3){const r=this.playbackTime-(e.offset??0)/1e3;return kke(e,t,r)}return t??null}}class Rke extends EventTarget{constructor(){super(...arguments);B(this,"audioContextManager",new VF);B(this,"volumeTracker",new qF("input"));B(this,"audioStream",null);B(this,"isMuted",!1)}get volume(){return this.volumeTracker.volume}get audioContext(){return this.audioContextManager.audioContext}get isInputMuted(){return this.isMuted}set isInputMuted(t){this.toggleMute(t)}async startAudioCapture(t){this.audioContextManager.isInitialized&&this.stopAudioCapture();try{await this.audioContextManager.initialize({sampleRate:dT()?void 0:uT})}catch(s){throw this.dispatchEvent(new CustomEvent("error",{detail:s})),s}const r=()=>{this.stopAudioCapture(),this.dispatchEvent(new CustomEvent("audioTrackEnded"))},i=s=>{this.dispatchEvent(new CustomEvent("audioData",{detail:s}))},{audioContext:a,audioAnalyser:o}=this.audioContextManager;a&&o&&(this.audioStream=await mke(i,a,o,t,r),this.isInputMuted&&this.toggleMute(!0),this.volumeTracker.startTracking(o))}stopAudioCapture(){if(this.audioStream){for(const t of this.audioStream.getTracks())t.stop();this.audioStream=null}this.volumeTracker.stopTracking(),this.audioContextManager.cleanup()}toggleMute(t=!this.isMuted){if(this.audioStream)for(const r of this.audioStream.getTracks())r.enabled=!t;this.isMuted!==t&&(this.isMuted=t,this.dispatchEvent(new CustomEvent("muteStateChanged",{detail:t})))}}class Pke extends EventTarget{constructor(){super(...arguments);B(this,"audioContextManager",new VF);B(this,"volumeTracker",new qF("output"));B(this,"outputGainNode",null);B(this,"outputSourceNodes",new Set);B(this,"audioDuration",0);B(this,"nextBufferTime",0);B(this,"audioOffset",0);B(this,"currentPlaybackRate",1);B(this,"bufferManager",new vke);B(this,"startJinglePromise");B(this,"animationSyncPromise");B(this,"audioStarted",!1);B(this,"audioChunksLoadDone",!1)}get audioContext(){return this.audioContextManager.audioContext}get audioPlaying(){var t;return((t=this.audioContext)==null?void 0:t.state)==="running"}get audioEnded(){return this.audioChunksLoadDone&&this.outputSourceNodes.size===0}get playbackTime(){if(!this.audioContext||this.audioContext.state==="closed")return 1/0;const{currentTime:t,outputLatency:r}=this.audioContext;return(t-r-this.audioOffset)*this.currentPlaybackRate}get volume(){return this.volumeTracker.volume}async initialize(t=Qp){var r;this.audioContextManager.isInitialized&&this.stopAudioPlayback(),this.currentPlaybackRate=KF(t);try{await this.audioContextManager.initialize({sampleRate:Zb}),(r=this.audioContext)==null||r.suspend()}catch(i){throw this.dispatchEvent(new CustomEvent("error",{detail:i})),i}this.audioDuration=0,this.nextBufferTime=0,this.audioOffset=0,this.audioStarted=!1,this.audioChunksLoadDone=!1,this.animationSyncPromise=void 0,this.setUpOutputVolumeTracking()}setUpOutputVolumeTracking(){const{audioContext:t,audioAnalyser:r}=this.audioContextManager;!t||!r||(this.outputGainNode=t.createGain(),this.outputGainNode.connect(r),r.connect(t.destination),this.volumeTracker.startTracking(r))}appendAudioData(t){if(!this.audioContext||!this.outputGainNode)return;const r={data:t,audioContext:this.audioContext,playbackRate:this.currentPlaybackRate};if(this.currentPlaybackRate!==1)bke(r,this.bufferManager,this.appendAudioSource.bind(this));else{const i=WF(t,this.audioContext);this.appendAudioSource(i)}}appendAudioSource(t){var a;if(!this.audioContext||!this.outputGainNode||!t.buffer)return;this.outputSourceNodes.add(t),t.connect(this.outputGainNode),t.addEventListener("ended",()=>{var o;this.outputSourceNodes.delete(t),this.outputSourceNodes.size===0&&(this.audioChunksLoadDone?this.stopAudioPlayback():(o=this.audioContext)==null||o.suspend())}),this.nextBufferTime<this.audioContext.currentTime&&(this.audioOffset+=this.audioContext.currentTime-this.nextBufferTime,this.nextBufferTime=this.audioContext.currentTime),t.start(this.nextBufferTime);const r=t.buffer.length/t.buffer.sampleRate;this.nextBufferTime+=r,this.audioDuration+=r;const{Animation:i}=sn;!this.audioStarted&&!this.animationSyncPromise&&(this.animationSyncPromise=(a=i.getAnimationSyncPromise())==null?void 0:a.finally(()=>{this.animationSyncPromise=void 0})),this.startPlayback()}async startPlayback(){if(this.startJinglePromise??this.animationSyncPromise){const t=sn.currentTurnIndex,r=Promise.all([this.startJinglePromise,this.animationSyncPromise]);try{await r}catch(i){i instanceof Error&&(`${i.message}`,void 0)}if(t!==sn.currentTurnIndex)return}this.audioContext&&this.audioContext.state!=="closed"&&(this.audioContext.resume(),this.audioStarted||(this.audioStarted=!0,this.dispatchEvent(new CustomEvent("audioStart"))))}setAudioDone(){this.audioChunksLoadDone=!0,yke(this.bufferManager,this.appendAudioSource.bind(this))}stopAudioPlayback(){for(const t of this.outputSourceNodes)t.stop();this.bufferManager.clearBuffer(),this.outputSourceNodes.clear(),this.setAudioDone(),this.volumeTracker.stopTracking(),this.audioContextManager.cleanup(),this.audioStarted&&(this.audioStarted=!1,this.dispatchEvent(new CustomEvent("audioEnd")))}async playCallStartJingle(){this.startJinglePromise||(this.startJinglePromise=dO(oke,3e3).finally(()=>{this.startJinglePromise=void 0})),await this.startJinglePromise}async playCallEndJingle(){await dO(ake,3e3)}}class Nke extends EventTarget{constructor(){super(...arguments);B(this,"isAnimationEnabled",!1);B(this,"frameManager",new Mke(()=>sn.AudioOut.playbackTime));B(this,"syncHandler",new JAe);B(this,"isUseAppearanceComponent",!1);B(this,"animationSyncDeferred");B(this,"appearanceReady",!1)}get currentA2EFrame(){return this.shouldAnimationPlay?this.frameManager.getCurrentA2EFrame():null}get currentVasaFrame(){return this.shouldAnimationPlay?this.frameManager.getCurrentVasaFrame():null}get currentVasaExpFrame(){return this.shouldAnimationPlay?this.frameManager.getCurrentVasaExpFrame():null}get animationEnded(){return sn.AudioOut.audioEnded}get shouldAnimationPlay(){return this.isAnimationEnabled&&!this.animationEnded&&sn.AudioOut.audioStarted}initialize(t=!1){this.stopAnimation(),this.isAnimationEnabled=t,this.isUseAppearanceComponent=ske(),this.isUseAppearanceComponent&&(this.syncHandler.setCurrentAudioTimeProvider(()=>sn.AudioOut.playbackTime),this.syncHandler.startTurn())}stopAnimation(){if(this.isUseAppearanceComponent){this.syncHandler.interruptTurn();return}this.frameManager.reset(),this.isAnimationEnabled=!1,this.animationSyncDeferred&&this.animationSyncDeferred.reject()}getAnimationSyncPromise(){var t;if(this.isAnimationEnabled)return this.isUseAppearanceComponent?this.syncHandler.getAnimationPreparedPromise():(this.animationSyncDeferred||(this.initializeAnimationSync(),this.checkAnimationSyncPromise()),(t=this.animationSyncDeferred)==null?void 0:t.promise)}initializeAnimationSync(){let t,r;const i=new Promise((s,c)=>{t=s,r=c}),a=oA(IW),o=Promise.race([i,a]).finally(()=>{this.animationSyncDeferred=void 0});this.animationSyncDeferred={promise:o,resolve:t,reject:r}}checkAnimationSyncPromise(){var t;this.appearanceReady&&this.frameManager.frameCount>AW&&((t=this.animationSyncDeferred)==null||t.resolve())}setAnimationDone(){var t;this.isUseAppearanceComponent?this.syncHandler.finishTurn():this.appearanceReady&&((t=this.animationSyncDeferred)==null||t.resolve())}setAppearanceReady(){this.appearanceReady=!0,this.checkAnimationSyncPromise()}setFrameData(t){!this.isAnimationEnabled||!t.frame||(this.isUseAppearanceComponent?this.syncHandler.addFrame(t):(this.frameManager.setFrameData(t),this.checkAnimationSyncPromise()))}}const Lc=class Lc{constructor(){B(this,"AudioIn",new Rke);B(this,"AudioOut",new Pke);B(this,"Animation",new Nke);B(this,"currentTurnIndex",0)}static getInstance(){return Lc.instance||(Lc.instance=new Lc),Lc.instance}};B(Lc,"instance",null);let fT=Lc;const sn=fT.getInstance(),mO=48,gO=50;function vO(n){const{isNested:e}=n,[t,r]=m.useState(1),[i,a]=m.useState(1),o=m.useRef(void 0),s=m.useRef(void 0),c=Vp(g=>{o.current=g.width,s.current=g.height,r((o.current+mO)/o.current),a((s.current+mO)/s.current)},{initialize:!0}),{volume:u}=sn.AudioOut,h=D5(u,u9),f=Rd(h,[0,gO],[1,t]),p=Rd(h,[0,gO],[1,i]);return d.jsx(_e.div,{className:"absolute inset-0",ref:c,initial:ct,animate:{...Rt,transition:{delay:f9}},exit:ct,children:d.jsx(_e.div,{className:X("absolute inset-0 flex items-center justify-center overflow-hidden rounded-6xl",e?"-scale-x-100 rounded-5xl blur-lg":"bg-stone-100/30 bg-blend-luminosity backdrop-blur-xl after:absolute after:inset-px after:rounded-6xl after:border after:border-transparent dark:bg-midnight-800/30"),layout:!0,style:{scaleX:f,scaleY:p},children:d.jsx(_e.div,{className:X("absolute -inset-16 aspect-square bg-gradient-audio-output-light bg-blend-saturation saturate-150 dark:bg-gradient-audio-output-dark dark:saturate-100",e?"animate-spin-slower opacity-20 dark:opacity-30":"animate-spin-slow opacity-40 dark:opacity-50")})})})}function Oke(n){const{dynamicHeight:e}=n;return d.jsx(_e.div,{className:X("t-bottom-fade absolute bottom-0 mx-4 box-content w-bottom-fade rounded-lg pt-bottom-fade",e?"h-bottom-fade":"h-composer"),initial:ct,animate:Rt,exit:ct,transition:Uk,children:d.jsx(eu,{isBottomFade:!0})})}function Lke(n,e){const{children:t,className:r,margins:i,data:a,size:o="regular",onButtonRef:s}=n,c=a.isDisabled?"":a.title,u=o==="small";return d.jsx(_e.div,{className:ke("relative shrink-0",i??"my-1",u?"h-9":"h-10",a.isVisible&&!u&&"size-10",a.isVisible&&u&&"size-9",!a.isVisible&&"overflow-hidden"),layout:!0,initial:!1,ref:e,children:d.jsx(_e.button,{type:"button",className:ke("absolute flex items-center justify-center rounded-xl fill-foreground-750",u?"size-9 p-1":"size-10 p-2",nl["subtle-dimmed"],"disabled:active:bg-transparent disabled:active:bg-none",r),layout:"position",disabled:!a.isVisible||a.isDisabled,"aria-hidden":!a.isVisible,"aria-label":c,title:c,onClick:a.onClick,"data-testid":a.testId,"aria-expanded":typeof a.ariaExpanded=="boolean"?a.ariaExpanded:void 0,ref:s,children:t})})}const sa=m.forwardRef(Lke);function Dke(){return N(FI).map(e=>e.id)}function QF(n){if(n.length===0)throw new Error("Array must have at least one element");return Math.floor(Math.random()*n.length)}function s7e(n,e){if(n.length===1)throw new Error("Array must have at least two elements");let t;do t=QF(n);while(t===e);return t}function jke(n){if(n.length!==0)return n[QF(n)]}function Uke(n){const e=[...n];for(let t=n.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1)),i=e[t];i&&e[r]&&(e[t]=e[r],e[r]=i)}return e}function c7e(n,e){if(n.length!==e.length)return!1;const t=[...n].sort(),r=[...e].sort();return t.every((i,a)=>i===r[a])}const Fke=m.lazy(()=>$(()=>import("./character-DHQl6qtp.js"),__vite__mapDeps([338,1,2,339])).then(n=>({default:n.Character})));function Bke(){const[n,e]=Je(om),{createConversation:t}=xk(),[r,i]=m.useState(!1),a=pe(c3),o=pe(Gc),s=Dke(),c=m.useRef(null),u=N(po);m.useEffect(()=>{if(c.current===null){const y=jke(s);y&&(c.current=y)}},[s]);const{t:h}=Ce();m.useEffect(()=>{r&&c.current&&H.trackEvent({name:"system",data:{eventName:"characterPromotionShown",eventInfo_characterId:c.current}})},[r]),m.useEffect(()=>{const y=localStorage.getItem(Lq);i(!y&&u.length>=10&&u.length<14)},[n,u.length]);function f(y){switch(y){case"mica":return"mica-head";case"aqua":return"aqua-head";case"erin":return"erin-head";default:return"mica-head"}}async function p(){c.current&&(o("clicking"),H.trackEvent({name:"interaction",data:{eventName:"characterPromotionClicked",eventInfo_characterId:c.current}}),a(!0),Rre({settingName:"characterId",oldValue:"",newValue:c.current}),H.setSettings({userSettingCharacterId:c.current}),await Promise.all([xr({path:"/user/settings",args:{options:{method:"PATCH"},body:{preferredCharacter:c.current}}})]))}const g=m.useCallback(async()=>{i(!1)},[]),v=m.useCallback(async()=>{c.current&&(i(!1),a(!0),e(c.current),await t())},[a,e,t]);return r?d.jsx("div",{className:"pointer-events-auto absolute -top-40 end-4 size-56 pb-2",onClick:p,onKeyDown:async y=>{y.key==="Enter"&&await p()},role:"button",tabIndex:0,"aria-label":h("characterAnimation.characterOptInAriaLabelText"),children:d.jsx(Fke,{className:"outline-none",characterId:f(c.current),onCharacterDismissed:g,onCharacterClicked:v})}):null}const JF="0px 0px 0px 1px rgb(255, 255, 255) inset",ZF="0px 0px 0px 1px rgba(255, 255, 255, 0.08) inset",Hke="0px 10px 24px 0px rgba(0, 0, 0, 0.18)",$ke="0px 42px 30px 0px rgba(0, 0, 0, 0.06)",zke="0px 16px 48px -2px rgba(244, 190, 146, 0.18)",Vke="0px 16px 48px -2px rgba(0, 0, 0, 0.25)",Gke="0px 16px 24px -2px rgba(0, 0, 0, 0.1)",Kke="0px 16px 24px -2px rgba(0, 0, 0, 0.25)",qke=28,Wke=32,Yke=24,Qke=26,Jke="relative flex grow flex-col overflow-hidden before:absolute before:inset-0 before:rounded-3xl before:border-2 before:border-stroke-350",l7e="bg-white/90 dark:bg-midnight-900/80",Zke="w-auto rounded-3xl contrast-more:border-2",Xke="bg-gradient-to-b from-white/90 to-white/0 dark:from-black/30 dark:to-midnight-800/10",exe="bg-white/90 dark:bg-midnight-850/60";function kx(n){const{title:e,onClick:t,appearDelay:r=zV,appearDuration:i=Ei.audio.unavailable,className:a}=n;return d.jsx(_e.div,{layout:"position",initial:"initial",animate:"animate",className:"relative flex h-12 shrink-0 items-center",variants:{initial:{...ct,scale:.9},animate:{...Rt,scale:1,transition:{...d9,delay:r,duration:i}}},children:d.jsx("button",{type:"button",onClick:t,title:e,className:X("min-w-44",lp,nl.strong,KT["40-base"],qT["40-base"],fy,"rounded-2xl before:rounded-2xl",a),children:e})})}function Bg(n){const{children:e,className:t}=n;return d.jsx(_e.div,{className:t,initial:ct,animate:Rt,exit:ct,transition:{delay:h9},children:e})}const txe={initial:ct,animate:Rt};function nxe(n){const{titleKey:e,textKey:t,buttonTextKey:r,button:i,cancelButton:a,onClick:o,closeDialogCallback:s}=n,{t:c}=Ce(),u=c(e),h=c(i.textKey);return d.jsxs(d.Fragment,{children:[d.jsx(_e.div,{layout:!0,variants:txe,initial:"initial",animate:"animate",role:"dialog","aria-label":u,tabIndex:-1,children:d.jsxs("div",{className:"m-3 text-center text-foreground-800",children:[d.jsx("p",{className:"py-3",children:u}),d.jsx("p",{className:"text-xs",children:c(t)}),r&&d.jsx("div",{className:"mx-auto flex w-full max-w-xs justify-around px-5 py-3 text-accent-600",children:d.jsx("button",{onClick:o,type:"button",className:"text-xs",children:c(r)})})]})}),d.jsxs(_e.div,{className:"relative mx-0.5 my-1 flex w-full items-center justify-center gap-2 px-2 align-middle",onClick:s,children:[a&&d.jsx(Ee,{variant:"rect",title:c(a.textKey),className:"relative my-3 flex h-10 max-w-40 items-center justify-center py-3 dark:bg-black/40 dark:hover:bg-black/40",onClick:a.onClick,children:c(a.textKey)}),d.jsx(Ee,{variant:"rect",title:h,className:"relative my-3 flex h-10 max-w-40 items-center justify-center py-3 dark:bg-black/40 dark:hover:bg-black/40",onClick:i.onClick,children:h})]})]})}function lu(n){const[e,t]=Je(mte),r=!!e[n],i=m.useCallback(()=>{const a={...e,[n]:new Date().toISOString()};t(a)},[e,n,t]);return{alreadyShown:r,dismissCoachmark:i}}const Rm="smartmode",u7e="pagesEditThisResponse",d7e="galleryDetailPrompt",XF="vision";function rxe(){const n=Ih(),{alreadyShown:e}=lu(Rm),t=ee("smart-mode-default");return{isSmartModeCoachmarkVisible:n&&!e&&!t}}function ixe(){const{alreadyShown:n}=lu(XF),e=dr(Vq,l.number()),t=24*60*60*1e3*60,r=!e||Date.now()-e>t,{isSmartModeCoachmarkVisible:i}=rxe();return{shouldShowVisionCoachmark:!n&&r&&!i}}function eB(n){const{renderReferenceElement:e,children:t,className:r,placement:i,offset:a,isOpen:o=!0,portalId:s,withArrow:c=!1,arrowClassName:u="dark:fill-black fill-white",animation:h="none",onOutsideEvent:f,onInsideEvent:p,invokeOnce:g=!0}=n,v=m.useRef(null),{refs:y,x:b,y:C,strategy:S,context:E,placement:T}=qp({open:o,placement:i??"right",middleware:[nh(a??1),Wp({fallbackAxisSideDirection:"end"}),rh(),L5({element:v})],whileElementsMounted:th});fo({onOutsideEvent:()=>{f==null||f()},invokeOnce:g,elements:[y.floating]});const A=NT(E),I=OT(E),k=LT(E),x=wh(),{getReferenceProps:_,getFloatingProps:R}=DT([A,I,k]),z=N(qi),j=axe(h,T);return d.jsxs(d.Fragment,{children:[e==null?void 0:e({ref:y.setReference,..._()},o),o&&d.jsx(cy,{id:s,children:d.jsxs(_e.div,{ref:y.setFloating,style:{position:S,top:`${C}px`,[x?"insetInlineEnd":"insetInlineStart"]:`${b}px`,boxShadow:z==="dark"?"0px 0px 0px 1px rgba(255, 255, 255, 0.08) inset":void 0},...j,...R({}),className:X("flex rounded-2xl p-4 shadow-xl",$t.coachmark,SK,c&&"!overflow-visible",r),onClick:p,children:[t,c?d.jsx(Hz,{ref:v,context:E,tipRadius:3,strokeWidth:2,className:u}):null]})})]})}function axe(n,e){switch(n){case"bounce":return oxe(e);case"none":return{};default:return{}}}function oxe(n){const t=n.startsWith("top")||n.startsWith("bottom"),r=n.startsWith("top")||n.startsWith("left")?-1:1;return t?{animate:{y:`${r*10}px`,transition:_P}}:{animate:{x:`${r*10}px`,transition:_P}}}function sxe({triggerComponent:n,offset:e=10,onInsideEvent:t}){const{t:r}=Ce(),{shouldShowVisionCoachmark:i}=ixe(),{dismissCoachmark:a}=lu(XF),o=s=>{s.stopPropagation(),a()};return d.jsx(eB,{className:"max-w-48 cursor-pointer bg-black dark:bg-midnight-150",arrowClassName:"dark:fill-midnight-150 fill-black",isOpen:i,placement:"top-end",offset:e,withArrow:!0,renderReferenceElement:s=>d.jsx("div",{ref:s.ref,className:"relative",children:n}),portalId:"composer-container",onInsideEvent:()=>{t==null||t(),a()},children:d.jsxs("div",{className:"flex max-w-[160px] flex-col gap-0.5 bg-black text-white dark:bg-midnight-150 dark:text-black",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("div",{className:"text-2xs-strong",children:r("composer.chatModes.vision.coachmarkTitle")}),d.jsx("button",{onClick:o,type:"button",children:d.jsx(vr,{className:"size-4"})})]}),d.jsx("div",{className:"text-2xs",children:r("composer.chatModes.vision.description")})]})})}function xx(){const n=ee("composer-v4");return!Ai("kill-composer-v4")&&n}function bO({config:n}){const{t:e}=Ce(),t=xx(),r=Jl(),i=ee("vision-coachmark");if(n)switch(n.mode){case"stop":return d.jsx(Ee,{testId:"stop-button",color:"accent",variant:"circle",size:t?"36-sm":"40-base",className:t?"":"my-1","aria-label":e("composer.stopButton"),title:e("composer.stopButton"),onClick:()=>n.onClick(),children:d.jsx("div",{className:"size-3.5 rounded bg-accent-550 contrast-more:border-2 dark:bg-accent-150"})});case"submit":return d.jsx(Ee,{testId:"submit-button",color:"strong",variant:"square",size:t?"36-sm":"40-base",className:ke(t?"rounded-2xl":"my-1 rounded-submitButton"),"aria-label":e("userInput.submitButtonText"),title:e("userInput.submitButtonText"),onClick:()=>n.onClick(),disabled:n.disabled,children:d.jsx(Em,{className:"size-6"})});case"microphone":{if(r)return;const a=d.jsx(sa,{data:{title:e("composer.startAudioCall"),testId:"audio-call-button",onClick:()=>n.onClick(),isVisible:!0},className:nl["subtle-dimmed-inverted"],size:t?"small":"regular",margins:t?"my-0":"my-1",children:d.jsx(Tx,{className:"size-6","aria-hidden":!0})});return i?d.jsx(sxe,{triggerComponent:a,offset:0}):a}default:return}}function cxe(n){var a;const{item:e,onClick:t}=n,r=N(lt),i=m.useRef(void 0);return m.useEffect(()=>{r&&i.current!==r&&e.onImpression&&(i.current=r,e.onImpression(r))},[r,e]),d.jsxs(Ee,{title:e.title,"aria-label":e.title,variant:"rect",color:"subtle-dimmed-inverted",onClick:t,size:"40-base",alignment:"start",className:"min-w-[230px] px-3 py-2",testId:e.testId,children:[d.jsx("div",{className:"size-6 min-w-6",children:e.icon}),d.jsxs("div",{className:"grow text-left",children:[d.jsxs("div",{className:"line-clamp-1 inline-flex gap-1.5 text-xs",children:[e.title,(a=e.tags)==null?void 0:a.map(o=>d.jsx("div",{className:"flex items-center",children:d.jsx(tp,{color:o.color,children:d.jsx("span",{className:"leading-4",children:o.label})},o.label)},o.label))]}),d.jsx("p",{className:"line-clamp-1 leading-4 text-foreground-600 text-2xs dark:text-foreground-700",children:e.description})]})]},e.key)}const lxe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/dismiss-BcarQlxK.svg";function uxe(n){const{renderTrigger:e,renderSurface:t,containerClassNames:r,color:i="default",onOutsideEvent:a,placement:o="bottom",floatingOffset:s=10}=n,[c,u]=m.useState(!1),h=m.useRef(null),f=m.useRef(null),{refs:p,floatingStyles:g,context:v}=qp({placement:o,strategy:"fixed",middleware:[nh(s),Wp(),rh()],whileElementsMounted:th,open:c,onOpenChange:u}),y=m.useCallback(C=>{C.stopPropagation(),C.preventDefault(),u(S=>!S)},[]),b=m.useCallback(()=>{u(!1),a==null||a()},[a]);return fo({onOutsideEvent:b,elements:[p.floating,h],includeScroll:!0,invokeOnce:!0}),rs(C=>{C.key==="Escape"&&c&&b()}),d.jsxs("div",{ref:p.setReference,className:X("relative",r==null?void 0:r.trigger),children:[e({openPopover:y,isOpen:c,ref:h}),uy.createPortal(d.jsx(Mn,{children:c&&d.jsx(ly,{context:v,modal:!0,returnFocus:!0,initialFocus:f,children:d.jsx(_e.div,{ref:p.setFloating,className:ke("rounded-2xl p-3 shadow-lg",i==="thin"?Ms:Ea,r==null?void 0:r.surface,$t.modal),style:{...g,...FT},role:"dialog",tabIndex:-1,initial:"initial",animate:"animate",exit:"exit",variants:{initial:ct,animate:Rt,exit:{...ct,transition:{duration:Ei.default}}},transition:{duration:Ei.default,ease:"easeInOut"},children:d.jsx("div",{className:X("pointer-events-auto relative max-h-expanded-section overflow-visible",$t.modal),children:t({closePopover:b,isOpen:c,focusRef:f})})})})}),document.getElementById("popoverPortal")??document.body)]})}function _x(n){const{items:e,value:t,defaultValue:r,onSelect:i,onReset:a,onMenuClick:o,disabled:s,showDefaultItemInDropdown:c=!1}=n,u=N(lt),h=m.useRef(void 0),{selectedItem:f,dropdownItems:p,selectedNonDefault:g}=m.useMemo(()=>({selectedItem:e.find(v=>v.key===t),dropdownItems:c?e:e.filter(v=>v.key!==r),selectedNonDefault:t!==r}),[e,t,r,c]);return m.useEffect(()=>{u&&h.current!==u&&f&&f.onImpression&&(h.current=u,f.onImpression(u))},[u,f]),d.jsx(uxe,{color:"default",renderTrigger:({openPopover:v})=>f&&d.jsxs(Ee,{title:f.key,"aria-label":f.title,variant:"rect",size:"36-sm",disabled:s,color:g?"composer-selected":"subtle-dimmed",className:ke("h-9 select-none gap-x-1 rounded-2xl border border-black/8 dark:border-white/8",f.isIconEnabledInButton?"pe-3 ps-2":"px-3"),onClick:y=>{var b;o==null||o(),(b=f.beforeClick)==null||b.call(f,u??""),g?a():v(y)},testId:f.testId,children:[g?d.jsx(Qn,{url:lxe,className:"size-4"}):f.isIconEnabledInButton&&f.icon,d.jsx("span",{className:"text-xs",children:f.buttonTitle??f.title}),!g&&f.isChevronEnabledInButton&&d.jsx(Xl,{className:"size-4 rotate-90"})]}),renderSurface:({closePopover:v})=>d.jsx("div",{className:"flex flex-col",children:p.map(y=>d.jsx(cxe,{item:y,onClick:b=>{var C;(C=y.beforeClick)==null||C.call(y,u??""),i(y.key),v(b)}},y.key))}),containerClassNames:{surface:"p-1 border-white/25 dark:border-slate-600/25 shadow-tinted-xl"},placement:"bottom-start",floatingOffset:4})}_x.displayName="ComposerDropdownButton";function tB({triggerComponent:n,offset:e=10,onInsideEvent:t}){const{t:r}=Ce(),i=wh(),{alreadyShown:a,dismissCoachmark:o}=lu(Rm),s=J9(),c=u=>{u.stopPropagation(),o()};return d.jsx(eB,{className:"max-w-48 cursor-pointer bg-black dark:bg-midnight-150",arrowClassName:"dark:fill-midnight-150 fill-black",isOpen:!a,placement:i?"left":"right",offset:e,withArrow:!0,renderReferenceElement:u=>d.jsx(_e.div,{ref:u.ref,className:"relative",children:n}),portalId:"composer-container",onInsideEvent:()=>{t==null||t(),o()},children:d.jsxs("div",{className:"flex max-w-[160px] flex-col gap-0.5 bg-black text-white dark:bg-midnight-150 dark:text-black",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("div",{className:"text-2xs-strong",children:r("composer.chatModes.smart.coachmarkTitle")}),d.jsx("button",{onClick:c,type:"button",children:d.jsx(vr,{className:"size-4"})})]}),d.jsx("div",{className:"text-2xs",children:s.coachmarkDescription})]})})}const nB="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/quick-pVrRG7df.svg",rB="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/smart-Ccvst-g_.svg",dxe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/think-DxNkOoJG.svg";function iB(){const n=N(zl),e=$e("kill-composer-reasoning-button");return!n&&e}function hxe(n,e){H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionElement:"composerCreateButton",eventInfo_impressionScenario:n??"off",eventInfo_conversationId:e}})}function fxe(n,e){H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionElement:"composerThinkButton",eventInfo_impressionScenario:n?"thinkDeeperOn":"thinkDeeperOff",eventInfo_conversationId:e}})}function pxe(n){H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionElement:"composerScreenshotButton",eventInfo_conversationId:n}})}function mxe(n,e){H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:"composerCreateButton",eventInfo_clickScenario:gxe(n),eventInfo_conversationId:e}})}function gxe(n){if(!n)return"showDrawer";switch(n){case"actions":return"exitActions";case"image":return"exitImage";case"podcast":return"exitPodcast";case"researchReport":return"exitResearchReport";case"quiz":return"exitQuiz";default:return"showDrawer"}}function vxe(n,e){H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:"composerThinkButton",eventInfo_clickScenario:n?"disableThinkDeeper":"enableThinkDeeper",eventInfo_conversationId:e}})}function bxe(n){H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:"composerScreenshotButton",eventInfo_conversationId:n}})}function yxe(n){const{disabled:e=!1}=n,t=Cxe(),r=Ih(),i=ee("smart-mode-default"),[a,o]=Je(Cn),{dismissCoachmark:s}=lu(Rm),c=m.useCallback(h=>{(h==="chat"||h==="smart"||h==="reasoning")&&(o(h),h==="smart"&&s())},[o,s]),u=d.jsx(_x,{items:t,onSelect:c,value:a,defaultValue:ni(),showDefaultItemInDropdown:!0,onReset:()=>{o(ni())},disabled:e,onMenuClick:()=>nt({source:"composerChatModeDropdownButton",pageName:"chatPage",customData:JSON.stringify({currentMode:a})})});return r&&!i?d.jsx(tB,{triggerComponent:u,offset:10}):u}function yO(n){return e=>fxe(n,e)}function CO(n){return e=>vxe(n,e)}function Cxe(){const{t:n}=Ce("translation"),e=Ih(),t=J9(),r=ee("model-in-mode-name"),i=ee("smart-mode-default"),a=[],o={key:"smart",title:t.title,icon:d.jsx(Qn,{url:rB,className:"size-6"}),description:t.description,testId:"composer-chat-mode-smart-button",tags:[{label:n("common.new"),color:"accent"}]};e&&i&&a.push(o);const s={key:"chat",title:n(r?"composer.chatModes.chat.titleWithModel":"composer.chatModes.chat.title"),buttonTitle:n(r?"composer.chatModes.chat.buttonTitleWithModel":"composer.chatModes.chat.buttonTitle"),icon:d.jsx(Qn,{url:nB,className:"size-5"}),description:n("composer.chatModes.chat.description"),testId:"composer-chat-mode-quick-button",onImpression:yO(!1),beforeClick:CO(!1),tags:[{label:n("composer.chatModes.chat.latency"),color:"neutral"}],isChevronEnabledInButton:!0,isIconEnabledInButton:!1};a.push(s);const c={key:"reasoning",title:X5,icon:d.jsx(Qn,{url:dxe,className:"size-6"}),description:n("composer.chatModes.reasoning.description"),testId:"composer-chat-mode-reasoning-button",onImpression:yO(!0),beforeClick:CO(!0),tags:[{label:n("composer.chatModes.reasoning.latency"),color:"neutral"}]};return iB()||a.push(c),e&&!i&&a.push(o),a}const Sxe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/research-DamIycj6.svg",wxe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/study-CBb74c5C.svg",Exe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/think-deeper-C6Ziv8bd.svg",aB="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/checklist-BDS7QRqm.svg",Txe=["chat","reasoning","research"],h7e=["copy","regenerate"];function oB(){const n=ee("deep-research"),e=ee("deep-research-nano"),t=fr(),r=N(zl);return n&&(r||!1||!r&&t&&e)&&!me.instance().config().disableDeepResearch}function Ixe({containerRef:n,items:e,itemRefs:t,initialFocusedId:r,onEscape:i,onEnter:a}){const[o,s]=m.useState(r);return rs(c=>{var p,g;const{current:u}=n;if(!u||!u.contains(document.activeElement))return;const h=e.findIndex(({id:v})=>v===o);let f=h;switch(c.key){case"Escape":i==null||i(),c.preventDefault();break;case"ArrowDown":f=Math.min(h+1,e.length-1),c.preventDefault();break;case"ArrowUp":f=Math.max(h-1,0),c.preventDefault();break;case"Enter":o&&(a==null||a(o));break}if(f!==h){const v=(p=e[f])==null?void 0:p.id;v&&(s(v),(g=t.current[v])==null||g.focus())}}),{focusedItemId:o,setFocusedItemId:s}}const Axe=[];function kxe(){const[n,e]=Je(Cn),t=ix(),{t:r}=Ce(),{dismissCoachmark:i}=lu(Rm),a=ee("smart-mode-default"),o=S=>{nt({source:"composerChatModeMenu",customData:JSON.stringify({currentMode:n,newMode:S})}),e(S),au({msg:r("actions.screenReaderSwitchPrefix",{chatMode:Up({chatMode:S})})}),S==="smart"&&i()},s=oB(),c=Ih(),u=ee("study-mode"),h=Jl(),f=iB();let p=Axe.concat(c&&a?["smart"]:[],["chat"],f?[]:["reasoning"],c&&!a?["smart"]:[],u?["study"]:[],s?["research"]:[],t?["computerUse"]:[]);h&&(p=p.filter(S=>Txe.includes(S)));const g=m.useRef(null),v=m.useRef({}),y=p.map(S=>({id:S})),{focusedItemId:b,setFocusedItemId:C}=Ixe({containerRef:g,items:y,itemRefs:v,initialFocusedId:n,onEnter:S=>o(S)});return d.jsx("div",{className:"pointer-events-auto relative flex flex-col gap-1 rounded-2xl text-xs contrast-more:border-2","data-testid":"composer-mode-menu",role:"radiogroup",ref:g,tabIndex:-1,children:p.map(S=>d.jsx(_xe,{chatMode:S,isSelected:n===S,onSelect:o,focusedItemId:b,setFocusedItemId:C,itemRefs:v},S))})}const xxe={chat:d.jsx(Qn,{url:nB,className:"size-5"}),reasoning:d.jsx(Qn,{url:Exe,className:"size-5"}),research:d.jsx(Qn,{url:Sxe,className:"size-5"}),computerUse:d.jsx(Qn,{url:aB,className:"size-5"}),smart:d.jsx(Qn,{url:rB,className:"size-5"}),study:d.jsx(Qn,{url:wxe,className:"size-5"})};function _xe(n){const{chatMode:e,isSelected:t,onSelect:r,focusedItemId:i,setFocusedItemId:a,itemRefs:o}=n,{t:s}=Ce(),c=m.useRef(null);m.useEffect(()=>{o.current[e]=c.current},[e,o]);const u=e==="smart"||e==="study",h=e!=="smart"&&e!=="study";return d.jsxs("button",{type:"button",ref:c,title:Up({chatMode:e}),onClick:()=>r(e),className:X("flex items-center justify-between gap-4 rounded-xl px-4 py-2",nl["subtle-dimmed"]),"data-testid":`${e}-mode-option`,role:"radio","aria-checked":t,tabIndex:e===i?0:-1,onFocus:()=>a(e),children:[d.jsxs("div",{className:"flex items-center gap-4",children:[xxe[e],d.jsxs("div",{className:"pe-4 text-left",children:[d.jsxs("div",{className:"flex items-center gap-1.5",children:[d.jsxs("div",{children:[" ",Up({chatMode:e})," "]}),u&&d.jsx(tp,{color:"accent",children:d.jsx("span",{children:s("common.new")})}),e==="computerUse"&&d.jsx(tp,{color:"accent",children:d.jsx("span",{children:s("settings.labs.title")})}),h&&d.jsx(tp,{children:d.jsx("span",{children:s(`composer.chatModes.${e}.latency`)})})]}),d.jsx("div",{className:"text-foreground-600 text-2xs dark:text-foreground-700",children:uye(e)})]})]}),d.jsx(Mxe,{isSelected:t})]})}function Mxe(n){const{isSelected:e}=n;return d.jsx("div",{className:X("flex size-5 items-center justify-center rounded-full border-2",e?"border-foreground-800":"border-foreground-450"),children:e&&d.jsx("div",{className:"size-2.5 rounded-full bg-foreground-800 contrast-more:border-2"})})}function Rxe(n){const{isChatModeMenuOpen:e,onRef:t,onClick:r,disableChatModeSwitcher:i}=n,{t:a}=Ce(),o=N(Cn),s=c=>{nt({source:"composerChatModeSwitcher",customData:JSON.stringify({currentMode:o,isOpen:e})}),r(c)};return d.jsx(_e.div,{layout:"position",initial:!1,children:d.jsxs(Ee,{testId:"chat-mode-switcher",title:a(e?"composer.chatModes.closeModeMenu":"composer.chatModes.openModeMenu"),onClick:s,color:"subtle-dimmed",ref:t,className:"my-1 border border-black/8",disabled:!i,"aria-haspopup":"menu","aria-expanded":e,children:[d.jsx("span",{className:"text-xs",children:Up({chatMode:o,forceExcludeModelName:!0})}),d.jsx(Xl,{className:X("size-4",e?"-rotate-90":"rotate-90")})]})})}function Pxe(){const n=m.useRef(null);return{captureFocus:()=>{document.activeElement instanceof HTMLElement&&(n.current=document.activeElement)},restoreFocus:()=>{n.current&&n.current.focus()}}}function Nxe({disableChatModeSwitcher:n}){const[e,t]=Je(SC),r=Ih(),i=ee("smart-mode-default"),{captureFocus:a,restoreFocus:o}=Pxe(),s=m.useCallback(c=>{t(u=>c?(a(),"chatMode"):u==="chatMode"?(setTimeout(()=>{o()},0),null):u)},[t,a,o]);return d.jsx(RC,{isOpen:e==="chatMode",onIsOpenChange:s,renderTrigger:(c,u)=>{const h=d.jsx(Rxe,{isChatModeMenuOpen:u,onRef:c.ref,onClick:c.onClick,disableChatModeSwitcher:n});return r&&!i?d.jsx(tB,{triggerComponent:h,offset:10,onInsideEvent:()=>{s(!0)}}):h},options:{placement:"top-start",offset:{mainAxis:10,crossAxis:-12},hideOnMenuClick:!0},className:ke(Ea,"p-2"),children:d.jsx(kxe,{})})}function Oxe({state:n}){const{t:e}=Ce(),t=Bt(),r=Ta(),i=pe(ri),a=pe(ch),o=pe(Ny),s=xx();return d.jsx(sa,{data:{title:e("composer.goToHome"),testId:"home-button",onClick:async()=>{i(null),a(!1),o(void 0),bn({source:"homeButton"}),await r({to:"/",from:t})},isVisible:n!=="hidden",isDisabled:n==="disabled"},size:s?"small":"regular",children:d.jsx(kh,{className:"size-6","aria-hidden":!0})})}const sB=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 24",fill:"currentColor",...n},m.createElement("path",{d:"M12.5 2C18.0228 2 22.5 6.47715 22.5 12C22.5 17.5228 18.0228 22 12.5 22C6.97715 22 2.5 17.5228 2.5 12C2.5 6.47715 6.97715 2 12.5 2ZM12.5 3.5C7.80558 3.5 4 7.30558 4 12C4 16.6944 7.80558 20.5 12.5 20.5C17.1944 20.5 21 16.6944 21 12C21 7.30558 17.1944 3.5 12.5 3.5ZM12.5 7C12.9142 7 13.25 7.33579 13.25 7.75V11.25H16.75C17.1642 11.25 17.5 11.5858 17.5 12C17.5 12.4142 17.1642 12.75 16.75 12.75H13.25V16.25C13.25 16.6642 12.9142 17 12.5 17C12.0858 17 11.75 16.6642 11.75 16.25V12.75H8.25C7.83579 12.75 7.5 12.4142 7.5 12C7.5 11.5858 7.83579 11.25 8.25 11.25H11.75V7.75C11.75 7.33579 12.0858 7 12.5 7Z"})),f7e=Object.freeze(Object.defineProperty({__proto__:null,default:sB},Symbol.toStringTag,{value:"Module"})),Mx=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",...n},m.createElement("path",{d:"M17.75 3A3.25 3.25 0 0 1 21 6.25v11.5A3.25 3.25 0 0 1 17.75 21H6.25A3.25 3.25 0 0 1 3 17.75V6.25A3.25 3.25 0 0 1 6.25 3h11.5Zm.58 16.401-5.805-5.686a.75.75 0 0 0-.966-.071l-.084.07-5.807 5.687c.182.064.378.099.582.099h11.5c.203 0 .399-.035.58-.099l-5.805-5.686L18.33 19.4ZM17.75 4.5H6.25A1.75 1.75 0 0 0 4.5 6.25v11.5c0 .208.036.408.103.594l5.823-5.701a2.25 2.25 0 0 1 3.02-.116l.128.116 5.822 5.702c.067-.186.104-.386.104-.595V6.25a1.75 1.75 0 0 0-1.75-1.75Zm-2.498 2a2.252 2.252 0 1 1 0 4.504 2.252 2.252 0 0 1 0-4.504Zm0 1.5a.752.752 0 1 0 0 1.504.752.752 0 0 0 0-1.504Z"})),p7e=Object.freeze(Object.defineProperty({__proto__:null,default:Mx},Symbol.toStringTag,{value:"Module"})),cB=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 24",fill:"currentColor",...n},m.createElement("path",{d:"M12.5 2C18.0228 2 22.5 6.47715 22.5 12C22.5 17.5228 18.0228 22 12.5 22C6.97715 22 2.5 17.5228 2.5 12C2.5 6.47715 6.97715 2 12.5 2ZM15.7197 8.96967L11.25 13.4393L9.28033 11.4697C8.98744 11.1768 8.51256 11.1768 8.21967 11.4697C7.92678 11.7626 7.92678 12.2374 8.21967 12.5303L10.7197 15.0303C11.0126 15.3232 11.4874 15.3232 11.7803 15.0303L16.7803 10.0303C17.0732 9.73744 17.0732 9.26256 16.7803 8.96967C16.4874 8.67678 16.0126 8.67678 15.7197 8.96967Z"})),m7e=Object.freeze(Object.defineProperty({__proto__:null,default:cB},Symbol.toStringTag,{value:"Module"}));function lB(n){return m.useCallback(e=>{if(e.key==="Enter"&&!e.shiftKey||e.key===" "){e.preventDefault();try{const t=n(e);t instanceof Promise&&t.catch(console.error)}catch(t){console.error("Error in useEnterOrSpaceKeyDown:",t)}}},[n])}const uB=(n={})=>{const{circular:e,axis:t,memorizeCurrent:r=!0,tabbable:i,ignoreDefaultKeydown:a,unstable_hasDefault:o}=n;return wC($z),$b({mover:{cyclic:!!e,direction:Lxe(t??"vertical"),memorizeCurrent:r,tabbable:i,hasDefault:o},...a&&{focusable:{ignoreKeydown:a}}})};function Lxe(n){switch(n){case"horizontal":return Vh.Horizontal;case"grid":return Vh.Grid;case"grid-linear":return Vh.GridLinear;case"both":return Vh.Both;case"vertical":default:return Vh.Vertical}}function Dxe(n){const e=n.children[0];return e instanceof HTMLElement?e:null}function jxe(n,e=!0){m.useEffect(()=>{if(e&&n.current){const t=Dxe(n.current);t&&t.focus()}},[n,e])}const cc=n=>d.jsx(Fxe,{...n});cc.Motion=m.forwardRef(Uxe);function Uxe(n,e){const{children:t,axis:r="vertical",circular:i=!0,tabbable:a,autoFocus:o=!1,...s}=n,c=uB({axis:r,circular:i,tabbable:a}),u=m.useRef(null);return m.useImperativeHandle(e,()=>u.current,[]),gx(u,o),ee("a11y-keyboard-navigation")?d.jsx(_e.div,{ref:u,...c,...s,children:t}):d.jsx(_e.div,{ref:u,...s,children:t})}function Fxe(n){const{children:e,axis:t="vertical",circular:r,tabbable:i,autoFocus:a=!1,...o}=n,s=uB({axis:t,circular:r,tabbable:i}),c=m.useRef(null);return jxe(c,a),ee("a11y-keyboard-navigation")?d.jsx("div",{ref:c,...s,...o,children:e}):d.jsx("div",{ref:c,...o,children:e})}const SO="ms-auto me-[2px] size-6 flex-none";function Bxe(n,e){const{tab:t,onClick:r,showHighlight:i,showActionIcon:a=!0,onFocus:o,className:s,fallbackIcon:c,titleExtra:u,testId:h}=n,[f,p]=m.useState(!1),{t:g}=Ce(),v=m.useCallback(()=>{r==null||r({...t,addedToTabSelection:!t.addedToTabSelection})},[r,t]),y=lB(v),b=f||!t.favIconUrl,C=c??Mx;return d.jsxs(cc.Motion,{className:ke(" box-border flex w-full cursor-pointer flex-row items-center rounded-lg p-1.5 active:bg-black/3 safe-hover:bg-black/5 dark:active:bg-white/5 dark:safe-hover:bg-black/30",i&&"bg-black/5 dark:bg-white/8","forced-colors:focus:outline forced-colors:focus:outline-2 forced-colors:focus:outline-black dark:forced-colors:focus:outline-white","contrast-more:focus:outline contrast-more:focus:outline-2 contrast-more:focus:outline-black dark:contrast-more:focus:outline-white",s),onClick:v,tabIndex:0,onKeyDown:y,ref:e,onFocus:o,tabbable:!0,"aria-label":t.title,"data-testid":h,children:[d.jsx("div",{className:"relative flex size-4 flex-none flex-row items-center rounded-lg bg-black/5",children:b?d.jsx(C,{className:"size-full"}):d.jsx("img",{src:t.favIconUrl,alt:g("composer.multiTabs.tabFavIconAltText"),className:"size-full rounded-[1px] object-cover",onError:()=>{p(!0)}})}),d.jsxs("span",{className:"font-ligatures-none me-7 ms-2 max-h-full truncate text-foreground-850 text-xs",children:[u??t.title,d.jsx("span",{})]}),a&&(t.addedToTabSelection?d.jsx(cB,{className:SO}):d.jsx(sB,{className:SO}))]})}const Hxe=m.forwardRef(Bxe);function $xe(n,e){const{groupTitle:t,tab:r,onClick:i,showHighlight:a,showActionIcon:o,onFocus:s,className:c,fallbackIcon:u,titleExtra:h,testId:f}=n;return d.jsxs(d.Fragment,{children:[t?d.jsx("span",{className:"font-semibold text-foreground-850 text-xs",children:t}):null,d.jsx(Hxe,{ref:e,tab:r,onClick:i,showHighlight:a,showActionIcon:o,onFocus:s,className:c,fallbackIcon:u,titleExtra:h,testId:f})]})}const zxe=m.forwardRef($xe),dB=n=>m.createElement("svg",{viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M6.5 2C4.01472 2 2 4.01472 2 6.5V11.5002C1.39278 11.0441 1 10.3179 1 9.5V6.5C1 3.46243 3.46243 1 6.5 1H9.5C10.3179 1 11.0441 1.39278 11.5002 2H6.5ZM4.06095 6.3954C4.34069 5.02835 5.55025 4 7 4H13.5002C13.0441 3.39278 12.3179 3 11.5 3H7C4.79086 3 3 4.79086 3 7V11.5C3 12.3179 3.39278 13.0441 4 13.5002V7C4 6.79289 4.02099 6.59069 4.06095 6.3954ZM5 7.5C5 6.11929 6.11929 5 7.5 5H12.5C13.8807 5 15 6.11929 15 7.5V12.5C15 13.8807 13.8807 15 12.5 15H7.5C6.11929 15 5 13.8807 5 12.5V7.5ZM7.5 6C6.67157 6 6 6.67157 6 7.5V12.5C6 13.3284 6.67157 14 7.5 14H12.5C13.3284 14 14 13.3284 14 12.5V7.5C14 6.67157 13.3284 6 12.5 6H7.5Z"})),g7e=Object.freeze(Object.defineProperty({__proto__:null,default:dB},Symbol.toStringTag,{value:"Module"})),hB=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M12 4.5C16.1421 4.5 19.5 7.85786 19.5 12C19.5 16.1421 16.1421 19.5 12 19.5C7.85786 19.5 4.5 16.1421 4.5 12C4.5 11.6236 4.52772 11.2538 4.58123 10.8923C4.64845 10.4382 4.31609 10 3.85708 10C3.48623 10 3.161 10.2562 3.10471 10.6228C3.03576 11.0718 3 11.5317 3 12C3 16.9706 7.02944 21 12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C9.69494 3 7.59227 3.86656 6 5.29168V4.25C6 3.83579 5.66421 3.5 5.25 3.5C4.83579 3.5 4.5 3.83579 4.5 4.25V7.25C4.5 7.66421 4.83579 8 5.25 8H8.25C8.66421 8 9 7.66421 9 7.25C9 6.83579 8.66421 6.5 8.25 6.5H6.90093C8.23907 5.25883 10.0309 4.5 12 4.5ZM12.5 7.75C12.5 7.33579 12.1642 7 11.75 7C11.3358 7 11 7.33579 11 7.75V12.25C11 12.6642 11.3358 13 11.75 13H14.75C15.1642 13 15.5 12.6642 15.5 12.25C15.5 11.8358 15.1642 11.5 14.75 11.5H12.5V7.75Z"})),v7e=Object.freeze(Object.defineProperty({__proto__:null,default:hB},Symbol.toStringTag,{value:"Module"}));function Rx(){const n=N(_pe),e=ee("edge-multi-tabs-history");return n&&e}const Xb={ADD:"add"};function Px(n){return n.sourceType==="history"}function Nx(n){return n.sourceType==="opened"}function Vxe(n){return Nx(n)?(n.id??0).toString():n.url??""}function fB(n){return n.sourceType===void 0||n.sourceType===null}function Gxe(n,e){const t=new Set(n.map(i=>i.id)),r=new Set(e.map(i=>i.id));if(t.size!==r.size)return!0;for(const i of t)if(!r.has(i))return!0;return!1}function Kxe(n){const{text:e}=n;return e?d.jsx("span",{className:"-ms-0.5 h-8 leading-8 text-foreground-850 text-xs",role:"status",children:e}):null}function qxe(n){if(fB(n))return dB;if(Px(n))return hB}function wO(n,e=!1){const t=re("composer.multiTabs.openTabs");if(Px(n)){const r=re("composer.multiTabs.recentlyClosedTabs"),i=re("composer.multiTabs.historyTabs");return e?r:i}return Nx(n)?t:""}function Wxe(n,e){let t=!1,r=!1;return i=>{if(n){if(Px(i)&&!t)return t=!0,wO(i,e);if(Nx(i)&&!r)return r=!0,wO(i,e)}}}function Yxe(n){const{tabs:e,onItemClick:t,highlightedIndex:r,activeMenuItemRef:i,onItemFocus:a,emptyStateText:o,isUseRecentHistoryEnabled:s=!1}=n,c=Rx(),u=N(Cm);if(e.length===0)return d.jsx(Kxe,{text:o});const h=Wxe(c,s);return d.jsx(d.Fragment,{children:e.map((f,p)=>d.jsx(zxe,{tab:f,onClick:t,showHighlight:r===p,onFocus:()=>a==null?void 0:a(p),showActionIcon:!u,className:ke(!u&&"py-2"),ref:p===r?i:null,groupTitle:h(f),fallbackIcon:qxe(f),testId:`multi-tabs-menu-item-${p}`},Vxe(f)))})}function Qxe(n){const{highlightedIndex:e,activeMenuItemRef:t,onMenuItemClick:r,onFocus:i,tabs:a,emptyStateText:o,isUseRecentHistoryEnabled:s=!1}=n,c=N(Cm);return d.jsxs("div",{className:ke("relative flex w-full overflow-hidden",c?"mb-0 mt-3":"my-3"),children:[d.jsx("div",{className:ke("t-custom-scrollbar flex w-full flex-col gap-y-1 overflow-y-auto overflow-x-hidden px-0.5 py-0.5"),"data-testid":"multi-tabs-menu-items-container",children:d.jsx(Yxe,{tabs:a,onItemClick:r,highlightedIndex:e,activeMenuItemRef:t,onItemFocus:i,emptyStateText:o,isUseRecentHistoryEnabled:s})}),a.length>=4&&c&&d.jsx("div",{className:ke("pointer-events-none absolute inset-x-0 bottom-0 h-8 rounded-b-lg px-4","bg-gradient-composer-tabs-menu-mask-light dark:bg-gradient-composer-tabs-menu-mask-dark")})]})}function Jxe(n){const{mode:e,disabled:t,onClick:r}=n,{t:i}=Ce(),a=i("composer.multiTabs.browserTabMenuShareButton"),o=i("composer.multiTabs.browserTabMenuShareButtonForUpdate"),s=e===Xb.ADD?a:o;return d.jsx(Ee,{title:s,className:"mx-auto mt-auto w-full flex-none",disabled:t,testId:"multi-tabs-share-button",onClick:r,color:"strong",size:"48-lg","aria-label":s,children:s})}function Zxe(n){const{mode:e,onClose:t}=n,r=N(Cm),{t:i}=Ce(),a=Rx(),o=i("common.closeText"),s=m.useMemo(()=>a?e===Xb.ADD?i("composer.multiTabs.browserTabMenuTitleWithHistory"):i("composer.multiTabs.browserTabMenuTitleForUpdateWithHistory"):e===Xb.ADD?i("composer.multiTabs.browserTabMenuTitle"):i("composer.multiTabs.browserTabMenuTitleForUpdate"),[a,e,i]);return d.jsxs("div",{className:"flex w-full items-center justify-between pt-2",children:[d.jsx("span",{className:"text-foreground-900 text-xs",children:s}),!r&&d.jsx(Ee,{color:"subtle-dimmed",title:o,size:"32-xs",onClick:t,"aria-label":o,children:d.jsx(vr,{className:"size-5 cursor-pointer"})})]})}const EO="";function Xxe(n){const{onChange:e,defaultValue:t}=n,{t:r}=Ce(),[i,a]=m.useState(t??EO),o=m.useRef(null),s=Rx(),c=()=>{var g;(g=o.current)==null||g.focus(),a(EO)},u=lB(c),h=m.useCallback(g=>{a(g.target.value)},[]);m.useEffect(()=>{e==null||e(i)},[e,i]),m.useEffect(()=>{o.current&&requestAnimationFrame(()=>{var g;(g=o.current)==null||g.focus()})},[o]);const f=r(s?"composer.multiTabs.browserTabMenuSearchPlaceholderWithHistory":"composer.multiTabs.browserTabMenuSearchPlaceholder"),p=r("composer.multiTabs.browserTabMenuSearchClear");return d.jsxs("div",{className:"mt-3 flex h-8 w-full flex-row items-center rounded-3xl bg-white/60 dark:bg-black/60",children:[d.jsx(vx,{className:"mx-2 size-4"}),d.jsx("input",{type:"text",id:"browser-tab-search",autoComplete:"off",spellCheck:!1,autoCorrect:"off",className:"w-full flex-1 rounded-lg bg-transparent py-2 text-sm focus:outline-none",placeholder:f,"aria-label":f,onChange:h,value:i,maxLength:100,ref:o}),i&&d.jsx("div",{role:"button",tabIndex:0,className:"me-1 ms-auto h-6 cursor-pointer rounded-xl border border-midnight-250 bg-midnight-200 px-3 py-1 text-foreground-800 text-2xs dark:border-white/50 dark:bg-white/5",onKeyDown:u,onClick:c,"aria-label":p,children:p})]})}function e_e(n,e=1e3){const t=m.useRef();return t.current=n,m.useMemo(()=>cU((...a)=>{var o;(o=t.current)==null||o.call(t,...a)},e),[e])}const t_e={id:-1,title:"",addedToTabSelection:!1,isInSearchResult:!0,sourceType:null,active:!1,highlighted:!1,pinned:!1,selected:!1,incognito:!1,autoDiscardable:!0,discarded:!1,index:-1,windowId:-1,groupId:-1};function n_e(n={}){return{...t_e,...n}}const gv=20,r_e=n_e({sourceType:null});function i_e(n,e){const{t}=Ce(),r=m.useMemo(()=>n.filter(c=>c.isInSearchResult),[n]),i=m.useMemo(()=>{const s=Math.min(r.length,gv);return e&&s>1&&s<gv?{...r_e,title:t("composer.multiTabs.allTabs",{count:s}),isInSearchResult:!0}:null},[r.length,t,e]),a=m.useCallback(()=>n.map(s=>({...s,addedToTabSelection:r.slice(0,gv).some(c=>c.id===s.id)})),[r,n]),o=m.useMemo(()=>i?[i,...r]:r,[r,i]);return{appearedTabs:r,getUpdatedTabsBySpecialTab:a,specialTab:i,appearedTabsWithSpecialTab:o}}function a_e(n){const e=m.useRef(0),t=m.useCallback(async()=>{const r=window.innerHeight;r!==e.current&&(e.current=r,await n(r))},[n]);Vp(t,{initialize:!0},document.documentElement)}const o_e=.2,s_e=.2,c_e=594,l_e=46,u_e=360,d_e=240;function h_e(){_t.emit("edge:try-grow-content-height",c_e)}function f_e(n){const e=new Map;for(const t of n)t.id&&t.addedToTabSelection&&e.set(t.id.toString(),t);return e}function p_e(n){const{styles:e,onRef:t,onSave:r,onClose:i=()=>{},outsideClickElements:a=[],originElement:o,mode:s=Xb.ADD}=n,[c,u]=Je(Js),h=m.useRef(new Map(c)),f=m.useRef(null),[p,g]=m.useState([]),[v,y]=m.useState(0),b=m.useRef(null),{t:C}=Ce(),S=m.useDeferredValue([...p]),E=N(Cm),{appearedTabsWithSpecialTab:T,getUpdatedTabsBySpecialTab:A}=i_e(S,E),[I,k]=m.useState(!1),x=h.current,[_,R]=m.useState(0),[z,j]=m.useState(!1),J=m.useCallback(()=>{if(f.current&&o&&o.current){const le=o.current.getBoundingClientRect();R(le.top-l_e)}},[R,o]);a_e(()=>{h_e(),J()}),m.useEffect(()=>{j(!1);async function le(){const{tabs:De}=await lpe.run({});if(De&&De.length>0){const We=[];for(const be of De)be.id&&We.push({...be,addedToTabSelection:x.has(be.id.toString()),isInSearchResult:!0,sourceType:"opened"});g(We)}}le().catch(console.error).finally(()=>{j(!0)})},[x]),m.useLayoutEffect(()=>{f.current&&z&&J()},[J,z]);const D=m.useMemo(()=>p.filter(le=>le.addedToTabSelection),[p]),F=m.useMemo(()=>D.length>gv,[D]),ie=m.useCallback(le=>{t==null||t(le),f.current=le},[t]),U=m.useCallback(le=>{const De=f_e(le);u(De);const We=Array.from(De.values()),be=Gxe(We,[...x.values()]);r==null||r(We,be)},[x,r,u]),W=m.useCallback(()=>{F||U(p)},[F,U,p]),ue=m.useCallback(le=>{g(De=>De.map(be=>be.id===le.id?le:be))},[]),te=e_e(m.useCallback(le=>{g(De=>De.map(We=>({...We,isInSearchResult:We.title?We.title.toLowerCase().includes(le.toLowerCase().trim()):!0})))},[]),aCe),Z=m.useCallback(le=>{y(De=>le==="up"?De>0?De-1:T.length-1:De<T.length-1?De+1:0)},[y,T]);m.useEffect(()=>{b.current&&v>=0&&b.current.scrollIntoView({block:"nearest"})},[v,b]);const Q=m.useCallback(le=>{let De=[];fB(le)?De=A():De=p.map(We=>We.id===le.id?{...le,addedToTabSelection:!0}:We),g(De),U(De)},[A,U,p]),Ie=m.useCallback(le=>{var De;if(["ArrowUp","ArrowDown"].includes(le.code))le.preventDefault(),Z(le.code==="ArrowUp"?"up":"down");else if(le.code==="Enter"){le.preventDefault();const We=T[v];We&&Q({...We,addedToTabSelection:!0})}else le.code==="Tab"&&((De=f.current)==null||De.focus())},[Z,v,T,Q]);m.useEffect(()=>(_t.on("multi-tabs:search",te),_t.on("multi-tabs:key-down",Ie),()=>{_t.off("multi-tabs:search",te),_t.off("multi-tabs:key-down",Ie)}),[Ie,te]),fo({onOutsideEvent:i,elements:[f,...a],invokeOnce:!1,shouldAttachListeners:I}),m.useEffect(()=>{k(!0)},[]);const Ve=m.useMemo(()=>E?d_e:u_e,[E]),ce=m.useMemo(()=>({maxHeight:`${_>Ve?Ve:_}px`,...e}),[_,Ve,e]);return d.jsxs(cc.Motion,{className:ke($t.modal,"pointer-events-auto relative z-40 box-border flex max-h-[400px] w-full flex-col rounded-b-6xl rounded-t-4xl border border-white p-4 shadow-lg backdrop-blur-2xl backdrop-saturate-150 contrast-more:border-2 dark:border-white/10","bg-gradient-composer-tabs-menu-light dark:bg-gradient-composer-tabs-menu-dark","bg-blend-normal","forced-colors:bg-stroke-150 dark:forced-colors:bg-midnight-850","contrast-more:bg-stroke-150 dark:contrast-more:bg-midnight-850",E?"px-4 pb-1.5 pt-4":"p-4"),style:ce,tabbable:!0,tabIndex:0,ref:ie,"data-testid":"composer-multi-tabs-menu",initial:"start",animate:"end",variants:{start:ct,end:{...Rt,transition:{duration:o_e,delay:s_e}}},children:[d.jsx(Zxe,{mode:s,onClose:i}),!E&&d.jsx(Xxe,{onChange:te}),d.jsx(Qxe,{highlightedIndex:v,onFocus:y,activeMenuItemRef:b,onMenuItemClick:E?Q:ue,tabs:T,emptyStateText:p.length===0?C("composer.multiTabs.noTabsOpen"):C("composer.multiTabs.noTabsFound")}),!E&&d.jsx(Jxe,{mode:s,disabled:F,onClick:W})]})}const pB=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{id:"Shape",d:"M2 6.25C2 4.45507 3.45507 3 5.25 3H18.75C20.5449 3 22 4.45507 22 6.25V12H20.5V6.25C20.5 5.2835 19.7165 4.5 18.75 4.5H5.25C4.2835 4.5 3.5 5.2835 3.5 6.25V15.75C3.5 16.7165 4.2835 17.5 5.25 17.5H11V19H5.25C3.45507 19 2 17.5449 2 15.75V6.25ZM14 13C12.8954 13 12 13.8954 12 15V20C12 21.1046 12.8954 22 14 22H21C22.1046 22 23 21.1046 23 20V15C23 13.8954 22.1046 13 21 13H14Z",fill:"currentColor"})),b7e=Object.freeze(Object.defineProperty({__proto__:null,default:pB},Symbol.toStringTag,{value:"Module"}));function m_e(n){const{onClick:e}=n,{t}=Ce();return d.jsx(sa,{data:{title:t("videoCard.pictureInPicture.miniPlayer"),testId:"trigger-picture-in-picture",isVisible:!0,onClick:e},children:d.jsx(pB,{className:"size-6","aria-hidden":!0})})}function g_e(n){const{title:e,onClick:t,appearDelay:r,appearDuration:i,voiceAvailabilityStatus:a,payflowSkuType:o}=n,s=UC(),c=N(En);return m.useEffect(()=>{c!=null&&c.accountType&&H.trackEvent({name:"interaction",data:{eventName:"payflowEntryImpression",eventInfo_loginProvider:c.accountType,eventInfo_actionButton:"GetCopilotPro",eventInfo_payflowEntryPoint:"VoiceLimit",eventInfo_payflowType:s?"ProSubPaywall":"UniPux",eventInfo_payflowSkuType:o,eventInfo_upsellReason:a,eventInfo_upsellEntryStyle:"Button"}})},[a,o,s,c==null?void 0:c.accountType]),d.jsx(kx,{className:"mx-2",title:e,onClick:t,appearDelay:r,appearDuration:i})}function Mc(n){return n instanceof Error?{errorCode:n.toString(),errorDetails:n.message}:{errorCode:"unknown",errorDetails:String(n)}}function _h(n,e,t){const r={eventInfo_payflowEntryPoint:e.payflowEntryPoint,eventInfo_upsellReason:e.upsellReason,eventInfo_loginProvider:e.loginProvider,eventInfo_payflowType:"DIME",eventInfo_payflowInstanceId:e.payflowInstanceId,eventInfo_curatedSubscription:e.curatedSubscription,eventInfo_correlationId:e.correlationId,eventInfo_dimeMarket:e.dimeMarket,eventInfo_campaignId:e.campaignId};let i;switch(n){case"payflowEnter":i={eventName:"payflowEnter",...r,eventInfo_upsellEntryStyle:(t==null?void 0:t.eventInfo_upsellEntryStyle)||"Banner"};break;case"payflowLoginClick":i={eventName:"payflowLoginClick",...r};break;case"dimeCheckoutRendering":i={eventName:"dimeCheckoutRendering",...r};break;case"dimeCheckoutSuccess":i={eventName:"dimeCheckoutSuccess",...r};break;case"dimeCheckoutClosed":i={eventName:"dimeCheckoutClosed",...r};break;case"dimeCheckoutError":i={eventName:"dimeCheckoutError",eventInfo_errorCode:(t==null?void 0:t.eventInfo_errorCode)??"",eventInfo_errorDetails:(t==null?void 0:t.eventInfo_errorDetails)??"",...r};break;default:i={eventName:"unknown",...r};break}H.trackEvent({name:"interaction",data:i})}function v_e(n){_h("payflowEnter",n,{eventInfo_upsellEntryStyle:"Banner"})}function y7e(n){_h("payflowLoginClick",n)}function b_e(n){_h("dimeCheckoutRendering",n)}function y_e(n){_h("dimeCheckoutSuccess",n)}function C_e(n){_h("dimeCheckoutClosed",n)}function C7e(n){H.trackEvent({name:"interaction",data:{eventName:"manageSubPageActionClick",eventInfo_loginProvider:n.loginProvider,eventInfo_curatedSubscription:n.curatedSubscription,eventInfo_actionTarget:n.actionTarget}})}function S7e(n){H.trackEvent({name:"interaction",data:{eventName:"manageSubFREShown",eventInfo_loginProvider:n.loginProvider,eventInfo_curatedSubscription:n.curatedSubscription}})}function w7e(n){H.trackEvent({name:"interaction",data:{eventName:"manageSubPageLoaded",eventInfo_loginProvider:n.loginProvider,eventInfo_curatedSubscription:n.curatedSubscription,eventInfo_willShowFre:n.willShowFre,eventInfo_willShowProDeprecation:n.willShowProDeprecation,eventInfo_upgradeButtonShown:n.upgradeButtonShown,eventInfo_upgradeButtonTarget:n.upgradeButtonTarget,eventInfo_manageButtonShown:n.manageButtonShown,eventInfo_manageButtonTarget:n.manageButtonTarget,eventInfo_cancelButtonShown:n.cancelButtonShown,eventInfo_cancelButtonTarget:n.cancelButtonTarget,eventInfo_proAutoRenewOn:n.proAutoRenewOn}})}function xw(n){_h("dimeCheckoutError",n,{eventInfo_errorCode:n.errorCode,eventInfo_errorDetails:n.errorDetails})}function Al({scenario:n,duration:e=0,customData:t}){zo({feature:"subscriptions",scenario:n,duration:e,customData:t?JSON.stringify(t):void 0})}function ey({errorCode:n,errorDetails:e,scenario:t,customData:r}){Zn({feature:"subscriptions",scenario:t,errorType:n,errorMessage:e,customData:r?JSON.stringify(r):void 0})}const S_e="https://content.lifecycle.office.net/dime/v1/dime.js";function w_e(){return new Promise((n,e)=>{const t=performance.now(),r=document.createElement("script");r.src=S_e,r.type="text/javascript",r.async=!0,r.onload=()=>{Al({scenario:"loadDimeScript",duration:performance.now()-t}),n()},r.onerror=()=>{const i=new Error("Failed to load Dime script");ey({...Mc(i),scenario:"loadDimeScript",customData:{duration:performance.now()-t}}),e(i)},document.head.appendChild(r)})}const TO=new Kl(w_e);async function E_e({language:n,market:e,sessionId:t}){var a;const r={language:n,market:e,sessionId:t},i=performance.now();try{const[o]=await Promise.all([dpe(),TO.get()]);Al({scenario:"prepareDimeInitialization",duration:performance.now()-i,customData:r});const s=new window.Dime({language:n,market:e,sessionId:t,partnerId:"cmc",authHint:o==null?void 0:o.username,userInfo:{puid:(a=o==null?void 0:o.idTokenClaims)==null?void 0:a.puid}});return Al({scenario:"initializeDime",duration:performance.now()-i,customData:r}),s}catch(o){return TO.reset(),ey({...Mc(o),scenario:"initializeDime",customData:{...r,duration:performance.now()-i}}),null}}const _w=new Kl(n=>E_e(n));var $c,Ed;class T_e{constructor(){ln(this,$c,yp("payflowCorrelationId")??crypto.randomUUID());ln(this,Ed);B(this,"ensureDime",async({language:e,market:t})=>{const r=performance.now(),i={language:e,market:t,sessionId:fe(this,$c)};fe(this,Ed)&&e!==fe(this,Ed)&&(_w.reset(),Al({scenario:"resetDimeForLanguageChange",customData:i})),Vt(this,Ed,e);const a=await _w.get({language:e,market:t,sessionId:fe(this,$c)});return Al({scenario:"ensureDime",duration:performance.now()-r,customData:i}),a});B(this,"overrideSessionId",e=>{_w.reset(),Vt(this,$c,e)})}get sessionId(){return fe(this,$c)}}$c=new WeakMap,Ed=new WeakMap;const Hg=new T_e,mB="https://go.microsoft.com/fwlink/?linkid=2281226&client=cmc&ocid=cmme6wdx8nv",I_e="sapphire://payment",IO="cmme6wdx8nv",pT="cmmquw3utd3",A_e="cmmjacjzqcs";function gB(n){const{urlParams:e}=me.instance().config().proSubscription;if(!e)return mB;const{client:t}=e,{linkid:r,ocid:i,language:a,market:o}=n,s=new URL("https://go.microsoft.com/fwlink/");return s.searchParams.append("linkid",r),s.searchParams.append("client",t),s.searchParams.append("ocid",i),o&&s.searchParams.append("market",o),a&&s.searchParams.append("language",a),s.toString()}function vB(n,e){var i,a;const{urlParams:t}=me.instance().config().proSubscription;if(!t)return IO;const{ocids:r}=t;return(e?(i=r[n])==null?void 0:i.freeTrial:(a=r[n])==null?void 0:a.buy)??IO}function AO(n,e,t,r){var u;const{urlParams:i}=me.instance().config().proSubscription;if(!i)return mB;const{ocids:a}=i,o=vB(n,e),s=r??((u=a[n])==null?void 0:u.market);return gB({linkid:e?"2243582":"2281226",ocid:o,language:t,market:s})}function k_e(n,e,t){return gB({linkid:"2281226",ocid:n??A_e,language:e,market:t})}function x_e(n){const{ocid:e}=n,t=new URL("https://aka.ms/AA84f4p");return t.searchParams.append("ocid",e),t.toString()}function __e(n){var r;const{m365UrlParams:e}=me.instance().config().proSubscription;if(!e)return pT;const{ocids:t}=e;return((r=t[n])==null?void 0:r.buy)??pT}const M_e="https://account.microsoft.com/services/copilot/details",R_e="https://account.microsoft.com/services/microsoft365/details",E7e="https://account.microsoft.com/";function T7e({entryPoint:n,isPro:e}){const{manageRefId:t}=me.instance().config().proSubscription,r=`copilot.${t}.${n}`,i=new URL(e?M_e:R_e);return i.searchParams.append("ref",r),i.hash="billing",i.toString()}function kO(n){me.instance().config().subscribeInNewWindow?tu(n):Ch(n)}function ty(n){const{payflowEntryPoint:e,skuType:t,upsellReason:r,beforeNavigate:i,entryStyle:a,preferPremium:o=!1,enableDimePreload:s=!1}=n,c=Bt(),u=Ta(),h=ee("pro-sub-dime"),f=ee("cmc-m365-sku"),p=h||f,g=UC(),v=me.instance().config().proSubscription.enabled,y=N(Dy),b=N(_r),{i18n:{resolvedLanguage:C}}=Ce(),S=N(En),E=pe(ri),T=N(qi),A=N(H3),I=N($3),{shouldRedirectMobile:k,redirectMobileSource:x}=Tte(I??null),_=pe(C3),R=m.useMemo(()=>f?wte(A,o):"gopremium",[f,o,A]),z=m.useMemo(()=>p?"DIME":g?"ProSubPaywall":"UniPux",[p,g]);m.useEffect(()=>{p&&s&&R&&(async()=>{const te=await Hg.ensureDime({language:C??"en-US",market:b}),Z={language:C,market:b,sessionId:Hg.sessionId,experiences:R};if(te){const Q=performance.now();try{await te.preload({experiences:[R]}),Al({scenario:"preloadDime",duration:performance.now()-Q,customData:Z})}catch(Ie){ey({...Mc(Ie),scenario:"preloadDime",customData:{...Z,duration:performance.now()-Q}})}}else ey({...Mc(new Error("Dime not a valid instance")),scenario:"preloadDime",customData:Z})})()},[C,b,R,p,s]);const j=m.useMemo(()=>f?__e(e):h?vB(e,y):pT,[f,e,h,y]),J=m.useCallback(()=>{switch(e){case"VoiceLimit":return UL()?I_e:v?AO(e,y,"",b):"";default:return AO(e,y,"",b)}},[v,y,e,b]),D=m.useCallback(async()=>{const ue=crypto.randomUUID();if(H.trackEvent({name:"interaction",data:{eventName:"payflowEnter",eventInfo_payflowCorrelationId:ue,eventInfo_loginProvider:(S==null?void 0:S.accountType)??"unknown",eventInfo_payflowEntryPoint:e,eventInfo_payflowType:g?"ProSubPaywall":"UniPux",eventInfo_payflowSkuType:t,eventInfo_upsellReason:r,eventInfo_upsellEntryStyle:a}}),g)i&&typeof i=="function"&&i(),await u({to:`/pro/subscribe?payflow-correlationId=${ue}&entry-point=${e}`,from:c});else{const te=J();kO(te)}},[a,g,c,e,t,r,S==null?void 0:S.accountType,i,J,u]),F=m.useCallback(()=>{const ue=f?x_e({ocid:j}):k_e(j,"",b);Al({scenario:"redirectToExternalUpsell",customData:{url:ue}}),kO(ue)},[f,j,b]),ie=m.useMemo(()=>({payflowEntryPoint:e,upsellReason:r??"unknown",loginProvider:(S==null?void 0:S.accountType)??"unknown",curatedSubscription:(I==null?void 0:I.tier)??"unknown",campaignId:j,dimeMarket:b??"unknown",correlationId:Hg.sessionId}),[e,r,S==null?void 0:S.accountType,I==null?void 0:I.tier,j,b]),U=m.useCallback(async ue=>{const te={...ie,payflowInstanceId:ue};v_e({...te});const Z=await Hg.ensureDime({language:Ite(C??"en-US"),market:b});if(!R)throw new Error("No dime experience available");if(Z)try{b_e({...te}),(await Z.launch({experience:R,theme:T??"light",campaignId:j},()=>{y_e({...te})})).status==="Success"?Sm():C_e({...te})}catch(Q){xw({...te,...Mc(Q)}),F()}else xw({...te,...Mc(new Error("Dime not a valid instance"))}),F()},[C,b,T,R,j,ie,F]);return{handleSubscription:m.useCallback(async()=>{if(f&&k&&x!==null){_({source:x,entryStyle:a,upsellReason:r,payflowEntryPoint:e});return}if((!g||p)&&(S==null?void 0:S.provider)==="auth0"){NI("parsedPayflowEntryPoint",e),E("upsell-microsoft-account-for-pro-subscription");return}if(p){const ue=crypto.randomUUID();try{await U(ue)}catch(te){xw({...ie,...Mc(te),payflowInstanceId:ue}),F()}}else D()},[f,k,x,g,p,S==null?void 0:S.provider,_,a,r,e,E,U,ie,F,D]),shouldUseDime:p,payflowType:z}}function bB(n){const{provider:e="microsoft",scenario:t,from:r}=n,i=xl(),a=Ta(),{login:o}=Sh();return m.useCallback(async()=>{if(t&&bn({source:"signin",scenario:t}),i){await a({from:r,to:"/login"});return}await o({provider:e})},[r,a,i,o,e,t])}function P_e(){const{t:n}=Ce(),e=N(Df),t=fr(),r=N(jy),i=me.instance().config().proSubscription.enabled,a=N(Dy),o=i&&a&&!r,s=xl(),c=N(En),u=pe(ri),h=bB({scenario:"voice",from:"/"}),{handleSubscription:f,payflowType:p}=ty({payflowEntryPoint:"VoiceLimit",skuType:o?"FreeTrial":"1Mo-Paid",upsellReason:e,entryStyle:"Button"});if(m.useEffect(()=>{r&&(c!=null&&c.accountType)&&H.trackEvent({name:"interaction",data:{eventName:"payflowHiddenEntryImpressionForTeenUser",eventInfo_loginProvider:c.accountType,eventInfo_actionButton:"GetCopilotPro",eventInfo_payflowEntryPoint:"VoiceLimit",eventInfo_payflowType:p,eventInfo_payflowSkuType:o?"FreeTrial":"1Mo-Paid",eventInfo_upsellReason:e}})},[e,r,t,o,p,c==null?void 0:c.accountType]),!r)return t?d.jsx(g_e,{voiceAvailabilityStatus:e,payflowSkuType:o?"FreeTrial":"1Mo-Paid",title:n(o?"voice.freeTrialToPro":"voice.v2.subscribeToPro"),onClick:async()=>{if(s&&(c==null?void 0:c.provider)==="auth0"){u("upsell-microsoft-account-for-pro-subscription");return}bn({source:"subscribeCopilotPro",scenario:"voice"}),await f()}}):d.jsx(kx,{className:"mx-2",title:n("voice.signUpOrLogin"),onClick:h})}const N_e="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/settings-B9ohU3kQ.svg",yB=n=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M6.74707 3.99954H10.2113C10.6255 3.99954 10.9613 4.33533 10.9613 4.74954C10.9613 5.12924 10.6791 5.44303 10.313 5.49269L10.2113 5.49954H6.74707C5.55621 5.49954 4.58143 6.4247 4.50226 7.59549L4.49707 7.74954V17.2495C4.49707 18.4404 5.42223 19.4152 6.59302 19.4944L6.74707 19.4995H16.2478C17.4387 19.4995 18.4134 18.5744 18.4926 17.4036L18.4978 17.2495V16.7518C18.4978 16.3375 18.8336 16.0018 19.2478 16.0018C19.6275 16.0018 19.9413 16.2839 19.991 16.65L19.9978 16.7518V17.2495C19.9978 19.2538 18.4254 20.8908 16.447 20.9943L16.2478 20.9995H6.74707C4.74281 20.9995 3.1058 19.4272 3.00227 17.4487L2.99707 17.2495V7.74954C2.99707 5.74528 4.56943 4.10827 6.54791 4.00474L6.74707 3.99954H10.2113H6.74707ZM14.5011 6.5194V3.74954C14.5011 3.12557 15.2078 2.78949 15.688 3.13934L15.7702 3.20828L21.7648 8.95828C22.0446 9.22663 22.0701 9.65765 21.8412 9.95561L21.7649 10.0407L15.7703 15.7926C15.32 16.2246 14.5881 15.9472 14.5082 15.3584L14.5011 15.2514V12.5261L14.1576 12.5562C11.7579 12.8065 9.45784 13.8874 7.24302 15.8169C6.72391 16.2691 5.92078 15.8415 6.00616 15.1584C6.67094 9.83884 9.45282 6.90684 14.2017 6.53904L14.5011 6.5194V3.74954V6.5194ZM16.0011 5.50818V7.24954C16.0011 7.66375 15.6653 7.99954 15.2511 7.99954C11.3777 7.99954 8.97704 9.67567 7.9398 13.1567L7.86074 13.4353L8.21293 13.1985C10.4494 11.7367 12.7988 10.9995 15.2511 10.9995C15.6308 10.9995 15.9446 11.2817 15.9942 11.6478L16.0011 11.7495V13.4924L20.1623 9.49963L16.0011 5.50818Z",fill:"currentColor"})),I7e=Object.freeze(Object.defineProperty({__proto__:null,default:yB},Symbol.toStringTag,{value:"Module"}));function Ox(){const n=N(xpe),e=ee("edge-multi-tabs-reverse");return n&&!e}const O_e=dt();function L_e(){const n=Ox(),[e,t]=m.useState("add"),[r,i]=m.useState(!1),[a,o]=m.useState(!1),[s,c]=m.useState(!1),[u,h]=Je(Cm),f=pe(Js),{refs:p,floatingStyles:g}=P5({placement:"top-start",strategy:"absolute",whileElementsMounted:th,middleware:[nh(()=>({mainAxis:6,crossAxis:0})),rh({padding:12}),M5({apply({rects:E,elements:T}){Object.assign(T.floating.style,{width:`${E.reference.width}px`})}})]}),v=m.useCallback(async E=>{const{isTrigger:T,keyword:A}=E;h(T),T&&(_t.emit("multi-tabs:search",A),t("add")),o(T)},[h,o]),y=m.useCallback(()=>{u&&(h(!1),_t.emit("mention:cancel","ignore")),o(!1)},[u,h]),b=m.useCallback(()=>{u&&(_t.emit("mention:cancel","remove"),h(!1)),o(!1),c(!0),i(!0),_t.emit("edge:maybe-fetch-page-context","onSaveMultiTabs")},[u,h]),C=m.useCallback(E=>n&&a&&u?(_t.emit("multi-tabs:key-down",E),!0):!1,[u,n,a]),S=()=>u&&a&&n;return m.useEffect(()=>{const E=O_e.sub(lt,()=>{o(!1),c(!1),h(!1),f(new Map)});return()=>{E()}},[f,h]),m.useEffect(()=>{const E=()=>{i(!1)};return _t.on("edge:multi-tabs-context-fetched-complete",E),()=>{_t.off("edge:multi-tabs-context-fetched-complete",E)}},[]),{isMultiTabsMenuExpanded:a,floatingStyles:g,edgeTabMenuRefs:p,setIsMultiTabsMenuExpanded:o,isShowMultiTabsPreviewCard:s,setIsShowMultiTabsPreviewCard:c,handleMentionEvent:v,isMentionTriggered:u,handleMultiTabsMenuSaveBtnEvent:b,handleMultiTabsMenuCloseBtnEvent:y,handleUserInputEnterEvent:S,handleUserInputKeydownEvent:C,multiTabsMenuMode:e,setMultiTabsMenuMode:t,isFetchingTabsPageContext:r}}function D_e(){const{contentPageType:n}=ts(),e=N(Tm),t=m.useCallback(()=>{nt({pageName:n,source:"streamlinedComposer",scenario:"clickComposer",customData:JSON.stringify({isChatSidePaneOpened:e})})},[n,e]),r=m.useCallback(()=>{nt({pageName:n,source:"newsComposerInput",scenario:"newsClickNavigateToChat",customData:JSON.stringify({isChatSidePaneOpened:e})})},[n,e]);return{trackConsumptionPageComposerClick:t,trackConsumptionPageComposerSubmit:r}}const CB=O(0),SB=O(),wB=O(),A7e=O({}),k7e=O({lastPosition:0,wasPlaying:!1}),Mh="daily";function x7e(){H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:"personalizeButton",eventInfo_clickScenario:"",eventInfo_pageName:Mh}})}function _7e(n){H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:"TopicSettings_Select",eventInfo_clickScenario:n,eventInfo_pageName:Mh}})}function M7e(n){H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:"TopicSettings_UnSelect",eventInfo_clickScenario:n,eventInfo_pageName:Mh}})}function R7e(n){H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:"TopicSettings_Save",eventInfo_clickScenario:n.join(","),eventInfo_pageName:Mh}})}function P7e(){H.trackEvent({name:"interaction",data:{eventName:"copilotClick",eventInfo_clickSource:"TopicSettings_Later",eventInfo_clickScenario:"",eventInfo_pageName:Mh}})}const mT={Podcast:"podcastPlayer",DailyBriefing:"dailyBriefingPlayer"},ip={Daily:Mh,Podcast:"podcast"},bs={Skip:"skip",Rewind:"rewind",Play:"play",Pause:"pause",Next:"next",Previous:"previous",Playback:"playback",Mute:"mute",Unmute:"unmute",Expand:"expand",Collapse:"collapse"};function Sc(n,e,t){nt({source:n,pageName:n===mT.Podcast?ip.Podcast:ip.Daily,scenario:e,customData:t})}function EB(n){const{url:e,podcastId:t,schema:r,includeTranscripts:i=!1}=n;return Tn(e,r,{query:{podcastId:t,includeTranscripts:String(i)}}).then(a=>a.data)}function j_e(n,e,t,r,i){return r&&t?{url:`/sharing/podcasts/${t}`,schema:Lv}:n?e?{url:`/podcasts/${e}/${n}`,schema:Lv}:{url:"/daily-briefing",podcastId:n,includeTranscripts:i,schema:zD}:null}function U_e(){const{podcastId:n,podcastType:e,shareId:t}=PT({strict:!1}),r=N(SB),i=n??r,a=NC(),o=!!n||a,c=ee("db-transcript")&&!o,u=pe(wB),{data:h,isLoading:f,error:p}=Zl(j_e(i,e,t,o,c),EB);m.useEffect(()=>{if(h&&o){const y=Lv.parse(h);u(y.podcastId)}},[h,o,u]);const g=()=>o?e?`${ip.Podcast}.${e}`:ip.Podcast:ip.Daily;if(h&&o){const y=Lv.parse(h),{isAvailable:b,podcastId:C,chapters:S,playback:{positionInSeconds:E,chapterId:T}}=y,A=t?`/sharing/podcasts/${t}/Files`:`/podcasts/${e}/${C}/Files`,I=S.map(({id:_,title:R,image:z,audio:j})=>({id:_,title:R,image:{landscape:{...z.landscape,url:`${A}/${z.landscape.name}`},portrait:{...z.portrait,url:`${A}/${z.portrait.name}`}},audio:j})),k={isAvailable:b,podcastId:C,chapters:I.map(_=>({..._,audio:{default:{url:`${A}/${_.audio.name}`,duration:_.audio.duration,transcript:null}},transitionMusic:null,sources:[]})),playback:{position:E,chapterId:T}},x={...y,chapters:I};return{data:k,podcastData:x,isPodcast:o,isLoading:f,error:p,pageImpressionKey:g()}}return{data:!o&&h?zD.parse(h):void 0,isPodcast:o,isLoading:f,error:p,pageImpressionKey:g()}}function N7e(){const{data:n}=Zl({url:"/daily-briefing/topics",schema:$D},EB);return{data:n}}async function O7e(n,e){await xr({path:"/daily-briefing/topics/unfollow",args:{body:{ids:e}}}),await xr({path:"/daily-briefing/topics/follow",args:{body:{ids:n}}})}const F_e=1;function B_e(){const n=Ta(),e=pe(ri),t=pe(SB),[r,i]=Je(CB),{firstStoryId:a}=R5({strict:!1}),o=ee("db-autoplay"),s=m.useCallback(async()=>{await n({from:"/daily",to:"/"}),t(void 0),e(null)},[t,e,n]),c=m.useCallback(async f=>{if(o&&a){const p=f.split(",");if(p.length>=2){p[F_e]=a;const g=p.join(",");t(g)}else t(f)}else t(f);i(0),e("daily-briefing-player"),await n({from:"/",to:"/daily",search:{firstStoryId:a}})},[t,o,a,i,e,n]),u=m.useCallback(async()=>{i(r),await n({from:"/daily",to:"/topic-selection"}),e(null)},[e,i,r,n]),h=m.useCallback(async()=>{i(r),e("daily-briefing-player"),await n({from:"/topic-selection",to:"/daily"})},[r,i,e,n]);return{navigateToDailyBriefing:c,navigateToTopicSelection:u,exitDailyBriefing:s,returnToDailyBriefing:h,currentChapterIndex:r}}function H_e({media:n,thresholds:e,key:t}){const r=m.useRef(0),i=m.useRef([]),a=m.useRef(new Set);return m.useEffect(()=>{i.current=(e==null?void 0:e.sort((o,s)=>o.seconds-s.seconds))??[]},[e]),m.useEffect(()=>{r.current=0,a.current=new Set;let o=null;if(!n)return()=>{};function s(){o=performance.now()}function c(p){if(o!==null){const g=(performance.now()-o)/1e3;r.current+=g,o=p?performance.now():null,f()}}function u(){c(!1)}function h(){c(!0)}const f=()=>{for(let p=0;p<i.current.length;p+=1){const g=i.current[p];g&&r.current>=g.seconds&&!a.current.has(p)&&(a.current.add(p),g.callback())}};return n.addEventListener("playing",s),n.addEventListener("pause",u),n.addEventListener("ended",u),n.addEventListener("timeupdate",h),()=>{n.removeEventListener("playing",s),n.removeEventListener("pause",u),n.removeEventListener("ended",u),n.removeEventListener("timeupdate",h)}},[n,t]),{totalTimePlayedRef:r}}function ap(n){if(!n)return NaN;const e=n.split(":");if(e.length!==2)return NaN;const[t,r]=e,i=Number(t),a=Number(r);return i<0||a<0||a>=60?NaN:i*60+a}function $_e(n,e,t,r){var i,a;return n===t.length-1&&e===r.length-1?1/0:e===r.length-1?ap((i=t[n+1])==null?void 0:i.startTime):ap((a=r[e+1])==null?void 0:a.startTime)}function z_e(n){let e=-1;return n.map((r,i,a)=>{var o;return{...r,startTime:ap(r.startTime),endTime:i<a.length-1?ap((o=a[i+1])==null?void 0:o.startTime):1/0,words:r.words.map((s,c,u)=>(e+=1,{...s,startTime:ap(s.startTime),endTime:$_e(i,c,a,u),index:e}))}})}function TB(n,e,t){return{DailyBriefing:`${e}|${t}`,Podcast:e}[n]}function xO(n,e,t){const r=TB(n,e,t);r&&xr({path:`/media/${n}/${r}/playback/completed`,args:{}}).catch(i=>{$L(i)})}function V_e(n,e,t,r){const i=TB(n,t,r);i&&xr({path:`/media/${n}/${i}/playback`,args:{options:{method:"PATCH"},body:{positionInSeconds:e}}}).catch(a=>{$L(a)})}function Mw(n,e){const t=Object.keys(e);if(t.length!==0)return typeof n<"u"&&t.includes(n)?e[n]:Object.values(e)[0]}const G_e=5,K_e=5e3;function IB(){var ye,ae;const{exitDailyBriefing:n}=B_e(),{data:e,isPodcast:t,pageImpressionKey:r}=U_e(),i=t?mT.Podcast:mT.DailyBriefing,a=N(wB),o=N(am),s=m.useMemo(()=>e?t?e.chapters.map(q=>{var ze;return[((ze=q.audio.default)==null?void 0:ze.duration)??0]}):e.chapters.map(q=>{var ze;const Te=[((ze=Mw(o,q.audio))==null?void 0:ze.duration)??0];return q.transitionMusic&&Te.push(q.transitionMusic.duration),Te}):[],[e,t,o]),[c,u]=Je(CB),h=m.useRef(null),[f,p]=m.useState(!1),g=c<s.length-1,v=c>0,y=m.useRef(performance.now()),b=m.useRef(performance.now()),C=m.useMemo(()=>{var q;return(q=e==null?void 0:e.chapters[c])!=null&&q.id?e.chapters[c].id:a&&a.split(",")[c]},[e==null?void 0:e.chapters,c,a]),S=m.useMemo(()=>e?t?e.chapters.map(q=>{var Te;return[((Te=q.audio.default)==null?void 0:Te.url)??""]}):e.chapters.map(q=>{var ze;const Te=[((ze=Mw(o,q.audio))==null?void 0:ze.url)??""];return q.transitionMusic&&Te.push(q.transitionMusic.url),Te}):[],[e,o,t]),[E,T]=m.useState(0),[A,I]=m.useState([]),[k,x]=m.useState(null),_=JSON.stringify({podcastId:a,eventInfo_chapterId:(ye=e==null?void 0:e.chapters[c])==null?void 0:ye.id,eventInfo_chapterPlayDuration:performance.now()-y.current}),[R,z]=Je(Ege),j=m.useCallback(()=>{z(q=>{const Te=!q,ze=Te?bs.Mute:bs.Unmute;return Sc(i,ze,_),Te})},[_,i,z]);H_e({media:k,key:C,thresholds:[{seconds:G_e,callback:()=>{if(C&&!A.includes(C)){try{xr({path:`/daily-briefing/${C}/viewed`,args:{analytics:{anonymousPath:"/daily-briefing/*/viewed"}}})}catch{}I([...A,C])}}}]}),m.useEffect(()=>{if(!k||!f)return;const q=setInterval(()=>{const Te=k.currentTime;V_e("DailyBriefing",Te,a,C)},K_e);return()=>{clearInterval(q)}},[k,f,C,a]);function J(){var q;p(!0),(q=h.current)==null||q.playAnimation(),k==null||k.play(),Sc(i,bs.Play,_)}function D(){var q;p(!1),(q=h.current)==null||q.pauseAnimation(),k==null||k.pause(),Sc(i,bs.Pause,_)}function F(q){if(k){const Te=Math.min(k.currentTime+q,k.duration);k.currentTime=Te,Sc(i,bs.Skip,JSON.stringify({seconds:q}))}}function ie(q){if(k){const Te=Math.max(k.currentTime-q,0);k.currentTime=Te,Sc(i,bs.Rewind,JSON.stringify({seconds:q}))}}function U(){var q,Te,ze;xO("DailyBriefing",a,C),e!=null&&e.chapters&&H.trackEvent({name:"system",data:{eventName:"chapterPlayDuration",eventInfo_podcastId:a,eventInfo_chapterIndex:c,eventInfo_isCompleted:c===e.chapters.length-1,eventInfo_publisherName:(Te=(q=e.chapters[c])==null?void 0:q.sources)==null?void 0:Te.map(ht=>ht.publisherName).join(","),eventInfo_impressionElement:r,eventInfo_customData:JSON.stringify({eventInfo_chapterId:(ze=e.chapters[c])==null?void 0:ze.id,eventInfo_chapterPlayDuration:performance.now()-y.current})}})}function W(){xO("Podcast",a),H.trackEvent({name:"system",data:{eventName:"podcastPlayDuration",eventInfo_isCompleted:!0,eventInfo_podcastId:a,eventInfo_podcastPlayDuration:performance.now()-b.current,eventInfo_impressionElement:r}})}function ue(){k&&(k.currentTime=0)}function te(q){U(),y.current=performance.now(),ue(),Se(-1),T(0),u(q)}function Z(){g&&(te(c+1),Sc(i,bs.Next,_))}function Q(){v&&(te(c-1),Sc(i,bs.Previous,_))}function Ie(q){k&&(k.playbackRate=q/100)}function Ve(q){const ze=(vS.indexOf(q)+1)%vS.length;return vS[ze]??Qp}function ce(){p(!0);const q=S[c]??[];E<q.length-1?T(Te=>Te+1):q.length-1===E&&g?Z():(De(),n())}function le(){y.current=performance.now(),b.current=performance.now()}function De(){t?W():U()}const We=ee("db-transcript"),be=ee("db-transcript-word"),Me=We&&!t,xe=m.useMemo(()=>{if(!Me)return[];const q=e==null?void 0:e.chapters[c];if(!q)return[];const Te=Mw(o,q.audio);return z_e((Te==null?void 0:Te.transcript)??[])},[Me,o,e==null?void 0:e.chapters,c]),M=m.useMemo(()=>xe.flatMap(q=>q.words),[xe]),Y=m.useMemo(()=>s[c]??[],[s,c]),Se=pe(Tge),P=m.useCallback(q=>{if(be){const ze=M.find(ht=>q>=ht.startTime&&q<ht.endTime);return(ze==null?void 0:ze.index)??-1}return xe.findIndex(ze=>q>=ze.startTime&&q<ze.endTime)},[xe,M,be]),ne=m.useCallback(q=>{const Te=q.currentTarget;let{currentTime:ze}=Te;for(let vt=0;vt<E;vt+=1){const Ye=Y[vt];Ye&&(ze+=Ye)}if(ze===0)return;const ht=P(ze);Se(ht)},[Y,E,P,Se]);return m.useEffect(()=>{if(!(!Me||!k))return k.addEventListener("timeupdate",ne),()=>{k.removeEventListener("timeupdate",ne)}},[k,ne,Me]),{isPlaying:f,currentChapterId:C,currentChapterIndex:c,chapterDurations:s,currentChapterPartIndex:E,audioElement:k,setAudioElement:x,audioChaptersProgressBarRef:h,currentChapterAudioSrc:((ae=S[c])==null?void 0:ae[E])??"",isPlayerMuted:R,currentChapterTranscript:xe,play:e?J:void 0,pause:e?D:void 0,skipForward:e?q=>F(q):()=>{},skipBack:e?q=>ie(q):()=>{},goToNextChapter:g?Z:void 0,goToPreviousChapter:v?Q:void 0,getNextPlaybackSpeed:e?q=>Ve(q):void 0,applyPlaybackRate:e?q=>Ie(q):()=>{},onChapterEnded:ce,resetAllTimers:le,trackPlayerEndEvents:De,togglePlayerMuted:j}}function q_e(){const{currentChapterId:n}=IB();return m.useMemo(()=>{if(n)return{type:"dailyBriefing",chapterId:n}},[n])}function W_e(n){const[e,t]=m.useState(0);return m.useEffect(()=>{if(!n)return()=>{};const r=s=>{s.preventDefault(),t(c=>c+1)},i=s=>{s.preventDefault(),t(c=>Math.max(0,c-1))},a=s=>{s.preventDefault(),t(0)},o=()=>{document.hidden&&t(0)};return window.addEventListener("dragenter",r,!0),window.addEventListener("dragleave",i,!0),window.addEventListener("drop",a,!0),document.addEventListener("visibilitychange",o),()=>{window.removeEventListener("dragenter",r,!0),window.removeEventListener("dragleave",i,!0),window.removeEventListener("drop",a,!0),document.removeEventListener("visibilitychange",o)}},[n]),e>0}async function Y_e(n,e){try{const t=await n.arrayBuffer(),r=new Uint8Array(t),i=await Tn("/attachments",GX,{options:{method:"POST",headers:{"Content-Type":Qo(n)},body:new Blob([r]),signal:e}}).then(a=>a.data);if("errorCode"in i)throw new Error(i.errorCode);return i.url}catch(t){throw console.error("Error uploading image",t),t}}async function Q_e(n,e){try{const t=new FormData;n.type!==""?t.append("file",n):t.append("file",new File([n],n.name,{type:Qo(n)}),n.name);const r=await Tn("/attachments",KD,{options:{method:"POST",body:t,signal:e}}).then(i=>i.data);if("errorCode"in r)throw new Error(r.errorCode);return r.id}catch(t){throw console.error("Error uploading document",t),t}}async function J_e(n,e){try{const t=await Tn("/attachments/onedrive",KD,{options:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n.id}),signal:e}}).then(r=>r.data);if("errorCode"in t)throw new Error(t.errorCode);return t.id}catch(t){throw console.error("Error uploading OneDrive file",t),t}}async function Z_e(n,e){switch(n.kind){case"local-file":return Q_e(n.file,e);case"onedrive":return J_e(n.item,e);default:{const t=n;throw new Error(`Unhandled upload kind: ${t}`)}}}async function X_e(n){const{uploadTasks:e,signal:t,onSuccess:r,onError:i,onFinish:a,scenario:o}=n,s=e.map(async c=>{const u=c.upload;try{if(c.type==="document"){const f={content:{type:"document",attachmentId:await Z_e(c.upload,t)},item:{type:"document",partId:c.partId,fileName:c.metadata.name,contentType:c.metadata.contentType},size:c.metadata.size,type:c.metadata.contentType},p={id:c.id,file:c.upload.file,scenario:o,processing:!1,attachment:f};r(p)}else{const h=await Y_e(u.file,t),f={content:{type:"image",url:h},item:{type:"image",url:h},size:c.metadata.size,type:c.metadata.contentType},p={id:c.id,file:u.file,scenario:o,processing:!1,attachment:f};r(p)}}catch(h){i&&i(h,c)}finally{a()}return null});return Promise.all(s)}function L7e(n,e){const t=e.split(".").pop()??"";return`/attachments/${n}.${t}`}function _O(n){switch(n.kind){case"local-file":{const{file:e}=n;return{name:e.name,contentType:Qo(e),size:e.size}}case"onedrive":{const{item:e}=n;return{name:e.name,contentType:cx(e.name),size:e.size}}default:{const e=n;throw new Error(`Unhandled upload kind: ${e}`)}}}function eMe(n){const[e,t]=Je(V9),{t:r}=Ce(),i=m.useRef(new Set),a=m.useRef(0),o=pe(nu),s=m.useCallback(()=>{for(const g of i.current)g.abort();i.current.clear()},[]);m.useEffect(()=>()=>{s()},[s]);const c=m.useCallback((g,v)=>{o({isOpen:!0,scenario:v??null,reason:g})},[o]),u=m.useCallback(()=>{c("fileUpload")},[c]),h=m.useCallback(()=>{t([],n),a.current=0,s()},[s,t,n]),f=m.useCallback(async g=>{const{uploads:v,scenario:y,onError:b,replaceExisting:C=!1,shouldUploadImageAsDocument:S}=g;C&&h();const E=[],T=[];for(const I of v){const k=_O(I),x=xm(k.contentType),_=cSe();if(x||S){const R=String(a.current);a.current+=1,E.push({id:_,upload:I,partId:R,metadata:k,type:"document"}),T.push({id:_,file:I.file,scenario:y,processing:!0})}else E.push({id:_,upload:I,metadata:k,type:"image"}),T.push({id:_,file:I.file,scenario:y,processing:!0})}t(I=>[...I,...T],n);const A=new AbortController;i.current.add(A),await X_e({signal:A.signal,uploadTasks:E,onSuccess:I=>{var k;if(t(x=>x.map(_=>_.id===I.id?I:_),n),(k=I.attachment)!=null&&k.item){const{type:x}=I.attachment.item;au({msg:r(x==="image"?"fileUpload.uploadedImage":"fileUpload.uploadedFile")})}},onError:(I,k)=>{if(I instanceof Error&&I.message==="not-signed-in")throw h(),u(),I;const x={id:k.id,file:k.upload.file,scenario:y,processing:!1,error:I};t(_=>_.map(R=>R.id===k.id?x:R),n),b&&b(I,k.upload)},onFinish:()=>{i.current.delete(A)}})},[h,u,t,n,r]),p=m.useCallback(g=>{t(v=>{const y=[...v];return y.splice(g,1),y},n)},[t,n]);return{uploadedAttachments:e,isUploadingAttachments:e.some(g=>g.processing===!0),clearAttachments:h,uploadAttachments:f,getUploadMetadata:_O,removeAttachmentByIndex:p}}function tMe(n,e,t,r){const{t:i}=Ce(),{clearAttachments:a,uploadAttachments:o,getUploadMetadata:s,isUploadingAttachments:c,uploadedAttachments:u,removeAttachmentByIndex:h}=eMe(),f=N(ac),{maxFilesPerMessage:p}=f,g=N(xh),v=m.useCallback(async S=>{const{uploads:E,scenario:T,replaceExisting:A=!0,supportedMimeTypes:I=g}=S,k=u.filter(({error:x})=>!x).length;if(!A&&k+E.length>p){e({title:i("composer.errors.multi.tooManyFiles.title",{maxFiles:p}),message:i("composer.errors.multi.tooManyFiles.message")});return}for(const x of E){const _=rSe(x.file,{supportedMimeTypes:I});if(_){e(_),t();return}}n();try{await o({uploads:E,scenario:T,replaceExisting:A,onError:(x,_)=>{if(x instanceof Error){e(DU(x.message));const{name:R,size:z}=s(_);sSe({name:R,size:z,message:x.message,kind:_.kind})}else e({title:i("composer.errors.default.title"),message:i("composer.errors.default.message")})}})}catch(x){x instanceof Error&&x.message==="not-signed-in"?r():e({title:i("composer.errors.default.title"),message:i("composer.errors.default.message")})}},[u,n,e,i,t,o,s,r,p,g]),y=m.useCallback(async S=>{const{rawFiles:E,scenario:T,replaceExisting:A=!0,supportedMimeTypes:I=g}=S;if(E.length===0)return;const k=[];for(const x of E)k.push({file:iSe(x),kind:"local-file"});await v({uploads:k,scenario:T,replaceExisting:A,supportedMimeTypes:I})},[v,g]),b=m.useCallback(()=>{a(),t()},[a,t]),C=m.useCallback(S=>{u.length===1?b():h(S)},[h,u,b]);return{processUploadedFiles:v,processUploadedLocalFiles:y,isUploadingAttachments:c,uploadedAttachments:u,resetFileUpload:b,removeAttachment:C}}function HC(){var r;const n=N(Vr)==="side-by-side",e=Nn({breakpoint:"sm"}),t=!!((r=me.instance().config().actions)!=null&&r.alwaysLayoutChatDetailsOverChat);return n&&(e||t)}function AB(n){return n.map(e=>{if(e.author==="human"||!e.content.find(s=>s.type==="citation"))return e;const r=e.content.find(s=>s.type==="text");if(!r)return e;const i=e.content.filter(s=>s.type==="citation").sort((s,c)=>s.position-c.position),{text:a,citationMetadata:o}=nMe(r.text,i);return r.text=a,r.citations=o,e})}function nMe(n,e){if(!e)return{text:n,citationMetadata:[]};let t=n;const r=[];let i=0;const a=new Map;for(const s of e){const c=s.url;if(!a.has(c)){i+=1;const u=`${i}`;a.set(c,u),r.push({index:u,title:s.title,url:s.url,iconUrl:s.iconUrl??null,publisher:s.publisher??null,snippet:s.snippet??null})}}const o=e.map((s,c)=>({citation:s,originalIndex:c})).sort((s,c)=>{const u=c.citation.position-s.citation.position;return u!==0?u:c.originalIndex-s.originalIndex}).map(s=>s.citation);for(const s of o){const c=s.url,u=a.get(c);u!==void 0&&(t=oG(t,H9(u,s.url),s.position))}return{text:t,citationMetadata:r}}function rMe(){const n=o9(),{conversationId:e}=PT({strict:!1}),{data:t,error:r,isLoading:i}=j5({queryKey:["sharePage",e],queryFn:()=>iMe(`/conversations/shares/${e}`),staleTime:1/0,enabled:n&&!!e});return{data:t,error:r,isLoading:i}}async function iMe(n){const{data:e,response:t}=await Tn(n,Fee,{parseOptions:{safe:!0},analytics:{anonymousPath:"/conversations/shares/*"}});if(t.status>=400&&t.status<500)throw new aMe(t.status.toString());return{...e,messages:AB(e.messages.reverse())}}class aMe extends Error{}function oMe(){const n=o9(),{isMediaViewerOpen:e}=ts(),t=N(ri),r=ee("share-continue-v2"),{error:i}=rMe();return n?i?!1:r||e||!!t:!0}const sMe={h550:"550",h600:"600",h760:"760"};function ny(n){const{breakpoint:e}=n,t=sMe[e];return!$k(`(min-height: ${t}px)`)}function cMe(){var r;const n=Bt(),e=ee("cmc-landing"),t=!!((r=me.instance().config().landingPage)!=null&&r.enableLandingRoute);return e&&t&&n.endsWith("/landing")}const lMe=O(),uMe=/\/(?:.*\/)?(ar|vi|gm)-([a-zA-Z0-9]{6,10})/,dMe="gemSnapshotKey";function hMe(){const n=N(lMe),{contentPageType:e}=ts();return m.useMemo(()=>{if(!(!n||!e))try{const t=n.pathname.match(uMe),r=(t==null?void 0:t[2])??null;if(!r)return;switch(e){case"newsGem":{const i=n.searchParams.get(dMe);return i?{type:"newsGem",gemId:r,snapshotKey:i}:void 0}case"newsArticle":return{type:"news",articleId:r};default:return}}catch{return}},[n,e])}function fMe(){const n=Ta(),e=sy();return m.useCallback(async()=>{await n({to:"/agents",params:{},from:e.state.location.pathname})},[n,e.state.location.pathname])}function pMe(){const n=Ai("kill-domain-referrer");return m.useCallback(e=>tu(e,{preventReferrer:n}),[n])}function mMe(){var h,f,p;const n=ee("cross-promo-popup"),e=(p=(f=(h=me.instance().config().crossPromotion)==null?void 0:h.aggressive)==null?void 0:f.popup)==null?void 0:p.secondDay,t=Pn(o1),r=!qb(t,Iv),i=Pn(sI),a=!qb(i,2*Iv),o=Pn(Rv),s=qk(o,2),c=N(HI);return m.useMemo(()=>!!(r&&n&&a&&s&&e&&(c===!0?!1:c!==void 0)),[e,n,a,s,r,c])}function sd(n){const{name:e,status:t,eventName:r,source:i,isMobile:a}=n;H.trackEvent({name:e,data:{eventName:r,eventInfo_source:i,eventInfo_isMobilePlatform:a,eventInfo_status:t}})}function kB(){const[n,e]=Je(Mo),t=ee("cross-promo-popup"),r=ee("top-banner-cross-promo-desktop");let i="setting";(t||(n==null?void 0:n.type)==="popup")&&(i="popup"),r&&(i="topBanner"),(n==null?void 0:n.type)==="card"&&(i="bottomRightCard");const a=pe(ri);return m.useCallback(()=>{const o=Date.now().toString();br(sI,o);const s=Pn(Rv);br(Rv,(parseInt(s??"0",10)+1).toString()),sd({name:"interaction",status:"Dismissed",eventName:"crossPromotionStripCard",source:i}),a(null),e(null)},[i,a,e])}function gMe(){return ee("allowanonymoususershare")}function vMe({conversationId:n,messageId:e,scenario:t,trackShareClick:r=()=>{}}){const i=N(lt),a=n??i,o=gMe(),s=pe(kF),c=m.useRef(null),u=m.useCallback(()=>{if(!a){W1e({conversationId:"",messageId:e,errorName:"conversationNotFound",errorMessage:"Conversation ID is missing"});return}s({conversationId:a,action:"share",messageId:e,scenario:t,onClose:()=>{setTimeout(()=>{var p;(p=c.current)==null||p.focus()},0)}}),r()},[a,e,t,s,r]),h=T9({callback:u,onShowSignIn:r,signInScenario:"loggedOutSharing",signInReason:"shareMessage"});return{shareClickHandler:m.useMemo(()=>o?u:h,[o,u,h]),shareRef:c}}function xB(n){m.useEffect(()=>{const e=()=>{n()};return Dt.on("languageChanged",e),()=>{Dt.off("languageChanged",e)}},[n])}function _B(n){const{onStartComplete:e}=n;m.useEffect(()=>{const t=()=>{e(),_t.off("app:start-complete",t)};return _t.on("app:start-complete",t),()=>{_t.off("app:start-complete",t)}},[e])}const Lx=1e3*60*60,bMe={revalidateOnFocus:!1,refreshInterval:Lx};async function yMe(n,e,t){return Tn(n,Wee,{query:{"api-version":"2",supportedWidgets:e.join(","),...t?{intent:t}:{}},options:{method:"GET",headers:{"Content-Type":"application/json"}},analytics:{anonymousPath:n}}).then(r=>r.data)}function CMe(n){return n?["conversation-starter"]:["conversation-starter","feature-discovery","kickstarter","image-generation","conversation-starter-prompted-greeting","categorized-conversation-starter"]}function SMe(n){var e;if(n.length>0){if(((e=n[0])==null?void 0:e.type)==="textAndGreeting")return n;const t=n[0];if(t)return[t]}}function wMe(n){const e=n.toLowerCase();return Zee.includes(e)}function EMe(){var f;const n=pe(V3),[e,t]=m.useState(!1),r=m.useMemo(()=>{const p=lW();if(p&&wMe(p))return p},[]),i=pe(Uy),a=Ai("kill-landing-widgets"),o=!!((f=me.instance().config().landingPage)!=null&&f.shouldFetchWidgetsData);_B({onStartComplete:()=>{t(!0)}});const{data:s,isLoading:c,error:u,mutate:h}=Zl(e&&o?"/activation/widgets":null,p=>yMe(p,CMe(a),r),bMe);i(c),xB(h),m.useEffect(()=>{if(s!=null&&s.widgets){const p=SMe(s.widgets);n(p)}},[s,n]),m.useEffect(()=>{u&&(H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"widgets",eventInfo_errorMessage:`${u}`,eventInfo_details:"Widget API error"}}),i(!1),n(void 0))},[u,n,i])}function TMe(){const n=N(WI),e=sm(),{isCompatibleLandingRoute:t}=Th(),r=n&&e&&t;return m.useMemo(()=>{if(r)return{type:"greeting",greetingMessage:n}},[n,r])}const IMe=(n,e)=>{var t,r,i,a;if(n==="light"){const o=(r=(t=me.instance().config().composer)==null?void 0:t.shadowBoxStyleOverride)==null?void 0:r.outerLargeBoxShadowLight;if(o)return o;if(e)return zke}else if(n==="dark"){const o=(a=(i=me.instance().config().composer)==null?void 0:i.shadowBoxStyleOverride)==null?void 0:a.outerLargeBoxShadowDark;if(o)return o;if(e)return Vke}return Hke},AMe=(n,e)=>{var t,r,i,a;if(n==="light"){const o=(r=(t=me.instance().config().composer)==null?void 0:t.shadowBoxStyleOverride)==null?void 0:r.outerSmallBoxShadowLight;if(o)return o;if(e)return Gke}else if(n==="dark"){const o=(a=(i=me.instance().config().composer)==null?void 0:i.shadowBoxStyleOverride)==null?void 0:a.outerSmallBoxShadowDark;if(o)return o;if(e)return Kke}return $ke},kMe=n=>n==="dark"?ZF:JF;function xMe(n,e,t){const r=dt();return new Promise((i,a)=>{let o=null;e(r.get(n))&&i(r.get(n));const s=r.sub(n,()=>{const u=r.get(n);e(u)&&(s(),i(u))}),c=()=>{s(),o&&clearTimeout(o)};o=setTimeout(()=>{c(),a(new Error("Timeout waiting for atom to be ready"))},t)})}function _Me(n){return n.some(e=>e.author==="human"&&e.content.some(t=>t.type==="image"||t.type==="document"))}function D7e(n){var t,r;const e=n.filter(i=>i.author==="human");if(e.length===1){const i=(r=(t=e[0])==null?void 0:t.content.find(a=>a.type==="image"||a.type==="document"))==null?void 0:r.type;return i==="image"?"image":i==="document"?"file":void 0}return _Me(n)?"image|file":void 0}function MMe(n){const t=new URL(n).pathname.split("/").filter(Boolean);return t[t.length-1]??null}async function MO(){Y1e();const n=dt(),e=MMe(window.location.href);let t;n.set(HE,!0);try{const r=await RMe(`/conversations/shares/${e}/continue`),{id:i,title:a}=r.conversation;t=i;const o=new Date().toISOString(),s={id:i,updatedAt:o,isNew:!1,title:a,history:[],streamingState:"idle",continuedAt:o};n.set(Sn,c=>{const u=new Map(c);return u.set(i,s),u}),n.set(lt,i),await NMe(i)}catch(r){throw Is({title:Dt.t("composer.errors.continue.title"),message:Dt.t("composer.errors.continue.message")}),Q1e({shareId:e??"",conversationId:t,error:r instanceof Error?r:new Error(String(r))}),r}finally{n.set(HE,!1)}}async function RMe(n){return(await Tn(n,Bee,{options:{method:"POST"}})).data}const PMe=1e4;async function NMe(n){await xMe(Sn,e=>{const t=e.get(n);return((t==null?void 0:t.history)??[]).length>0},PMe)}function OMe(n,e,t){if(!n||!e)return!1;const r=n.getTime(),i=e.getTime(),a=t?t.getTime():null;return i<=r||a===null?!1:a<=r}function MB(){return`Copilot_${el(new Date,"yyyyMMdd_HHmmss")}`}async function j7e(n,e){const t=MB(),i=await(await fetch(n)).blob(),a=URL.createObjectURL(i),o=document.createElement("a");o.href=a,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)}function LMe(n){n.target instanceof HTMLImageElement&&URL.revokeObjectURL(n.target.src)}async function DMe(n,e=!1){try{const t=await wa(n,{analytics:{anonymousPath:"/attachments/*.png"}});return e&&t.status!==200?null:await t.blob()}catch{return null}}async function jMe(n,e=!1){try{const t=await DMe(n,e);return t?URL.createObjectURL(t):null}catch{return null}}function gT(n,e){const t=cn(n),r=cn(e);return t.getTime()>r.getTime()}function ry(n){const e=cn(n);return e.setHours(0,0,0,0),e}function Dx(n,e){const t=ry(n),r=ry(e);return+t==+r}function iy(n,e){return lI(n,-e)}const UMe=11,FMe=7,BMe=2,HMe=10,$Me=21,zMe=21,VMe=10,RO=l.object({daysActive:l.array(l.coerce.date())}),vT=l.object({result:l.enum(["dismissed","positive","negative"]),date:l.coerce.date(),dismissCounter:l.number()});function GMe(n){const e=new Date;let t=n;return n.some(r=>Dx(r,e))||(t=[...n,e]),t.length>VMe?t.slice(-10):t}function KMe(){const n=dr(dM,RO),e=(n==null?void 0:n.daysActive)??[],t=GMe(e),r=iy(new Date,FMe),i=t.filter(a=>gT(a,r)||Dx(a,r)).length;return t!==e&&ca(dM,RO,{daysActive:t}),i}function qMe(){const n=dr(s1,vT);if(!n)return!1;const e=n.result==="positive",t=n.result==="negative"&&gT(n.date,iy(new Date,zMe)),r=n.result==="dismissed"&&gT(n.date,iy(new Date,n.dismissCounter>5?$Me:HMe));return e||t||r}function WMe(n,e){let t="popUpDismiss";e==="negative"?t="appThumbDown":e==="positive"&&(t="appThumbUp"),bn({source:t,conversationId:n});const r=dr(s1,vT),i=(r==null?void 0:r.result)==="dismissed"?r.dismissCounter:0,a={result:e,date:new Date,dismissCounter:e==="dismissed"?i+1:0};ca(s1,vT,a)}function $C({className:n,style:e}){return d.jsx("div",{className:X("animate-[shimmer_2s_infinite] bg-black/5 bg-gradient-to-r dark:bg-white/5","from-transparent via-background-150 to-transparent","bg-[length:50%_100%] bg-no-repeat",n),style:e})}function YMe(n){const{isImageOrVideo:e}=n;return d.jsx("div",{className:"flex flex-col gap-3 px-4",children:d.jsx($C,{className:X("w-full",e?"h-[144px] sm:h-[176px]":"h-[300px]"),style:{clipPath:"var(--clip-path-squircle-36)"}})})}function PO(n){const{type:e,length:t}=n;if(e==="ads")return d.jsx("div",{});const r=e==="image"||e==="video",i=r&&t===1;return d.jsx(Gk,{size:"md",stroke:!0,className:X("relative flex",i?"w-[300px]":"w-full","flex-col py-3 transition-opacity duration-300 ease-in-out"),children:d.jsx(YMe,{isImageOrVideo:r})})}function U7e(n){if(n.type==="image")return n.images.length;if(n.type==="video")return n.videos.length}function QMe(n){var y;const{uploadedFile:e,onRemove:t,scenario:r,isUploading:i,role:a}=n,{t:o}=Ce(),[s,c]=m.useState(null),[u,h]=m.useState(!1),f=o(r==="screenshot"?"composer.screenshotAdded":"composer.uploadedImageAltText");m.useEffect(()=>{const b=URL.createObjectURL(e);return h(!1),c(b),()=>{URL.revokeObjectURL(b)}},[e]);const p=b=>{h(!0),b.target instanceof HTMLImageElement&&URL.revokeObjectURL(b.target.src)},g=m.useCallback(()=>{t==null||t(),au({msg:o("fileUpload.imageRemoved")})},[t,o]);if(!s)return null;const v=(y=me.instance().config().composer)==null?void 0:y.smallAttachmentCard;return d.jsxs(_e.div,{className:X("relative max-w-fit shrink-0",{"mx-1 mt-2 h-[58px]":v,"h-32":!v}),layout:"position",initial:ct,animate:u?Rt:ct,exit:ct,transition:{delay:h9},role:a,children:[d.jsx(_e.img,{className:X("w-auto rounded-xl border border-black/8 object-contain shadow-inner dark:border-white/8",{"h-[58px]":v,"h-32":!v}),src:s,role:"presentation","aria-label":f,alt:f,onLoad:p,onError:p,draggable:!1}),d.jsx(Tl,{msg:f}),t&&d.jsx(_e.button,{type:"button",title:o("fileUpload.removeImageWithName",{name:e.name}),"aria-label":o("fileUpload.removeImageWithName",{name:e.name}),onClick:g,className:"absolute end-0.5 top-0.5 m-1 rounded-full border border-black/20 bg-white fill-black p-1 text-black",children:d.jsx(vr,{className:"size-3","aria-hidden":!0})}),i&&d.jsxs(On,{className:"absolute inset-0 grid place-items-center bg-white/80 dark:bg-white/45",children:[d.jsx(m.Suspense,{fallback:d.jsx("div",{"aria-hidden":!0}),children:d.jsx(Et,{type:"spinnerThemed",className:"size-11"})}),d.jsx(Tl,{msg:o("fileUpload.uploadingImage"),type:"polite"})]})]})}const jx=m.memo(n=>{const{attachment:e,onRemove:t,role:r}=n,{file:i,processing:a,error:o,scenario:s}=e;if(o||!i)return null;const c=Qo(i);return xm(c)?d.jsx(lx,{onRemove:t,filename:i.name,fileType:c,isUploading:a,role:r}):d.jsx(QMe,{uploadedFile:i,onRemove:t,scenario:s,isUploading:a,role:r})});jx.displayName="AttachmentItem";function JMe(n){const e=m.useRef(null);m.useEffect(()=>{e.current=document.activeElement;const t=n==null?void 0:n.current;return()=>{t?t.focus():e.current&&e.current.focus()}},[n])}function ZMe(n){const{fileName:e,fileType:t,role:r}=n,i=t!==""?t:cx(e);return xm(i)?d.jsx(lx,{filename:e,fileType:i,role:r}):null}const XMe=[{canHandle:n=>n.startsWith("https://"),getImageSrc:n=>n,shouldReleaseOnLoad:!1},{canHandle:n=>n.startsWith("/attachments"),getImageSrc:n=>jMe(n),shouldReleaseOnLoad:!0}];function eRe(n){return XMe.find(e=>e.canHandle(n))??null}function tRe({url:n}){const{t:e}=Ce(),[t,r]=m.useState(null),[i,a]=m.useState(!1);return m.useEffect(()=>{if(!n){r(null);return}const o=eRe(n);if(!o){r(null);return}(async()=>{const c=await o.getImageSrc(n);r(c),a(o.shouldReleaseOnLoad)})()},[n]),t?d.jsx("img",{className:"block h-full overflow-hidden rounded-2xl bg-background-static-250 object-cover object-center shadow-inner dark:bg-background-static-900",alt:e("chat.uploadedImageAltText"),src:t,onLoad:i?LMe:void 0}):null}function nRe(){const{t:n}=Ce();return d.jsx("div",{className:"flex w-fit justify-end",children:d.jsx("div",{className:"flex h-32 w-44 items-center justify-center rounded-xl border border-stroke-250 bg-accent-200 px-4 py-2 dark:bg-accent-250",children:d.jsx("span",{className:"text-center text-foreground-450 text-sm",children:n("share.imagePlaceholder")})})})}function RB(n){const{messageItem:e,isForSharing:t,imageClassName:r,role:i}=n,a=!Ai("kill-share-c2");if(e.type==="document")return d.jsx(ZMe,{fileType:e.contentType,fileName:e.fileName,role:i});const o=e.type==="image"&&e.url.startsWith("/attachments");return a&&t&&o?d.jsx(nRe,{}):e.type==="image"?d.jsx("div",{className:ke("inline-block h-full max-w-[min(80%,256px)] align-top",r),role:i,children:d.jsx("div",{className:"h-full w-fit min-w-0",children:d.jsx(tRe,{url:e.url})})}):null}function PB(n){const{onRemove:e,onClose:t,messages:r=[],attachments:i=[],isForSharing:a,restoreFocusRef:o}=n;JMe(o);const{t:s}=Ce();return i.length===0&&r.length===0?null:d.jsxs(bo,{isOpen:!0,fullBleed:!0,className:"max-h-[580px] min-h-[480px] w-full justify-between p-6 sm:w-[640px]",onClose:t,dialogName:s("userInput.filePreviewModalTitle"),children:[d.jsx("h1",{className:"w-full shrink-0 text-center leading-8 text-xl",children:s("userInput.filePreviewModalTitle")}),d.jsx("div",{className:"max-h-[450px] min-h-0 flex-1 overflow-y-auto p-4",children:d.jsx("div",{role:"list",className:"flex flex-wrap content-start gap-x-2 gap-y-1",children:i.length>0?i.map((c,u)=>d.jsx(jx,{attachment:c,onRemove:()=>e==null?void 0:e(u),role:"listitem"},`attachment-${u}`)):r.map((c,u)=>d.jsx(RB,{messageItem:c,imageClassName:"h-32",role:"listitem",isForSharing:a},`message-${u}`))})}),d.jsx(Ee,{color:"strong",className:"w-full shrink-0",title:s("common.dismiss"),onClick:t,children:s("common.dismiss")})]})}function rRe(n){const{attachments:e,onRemove:t,onVisibilityChange:r}=n,{t:i}=Ce(),a=m.useRef(null),o=m.useCallback(b=>{const C=e[b];C!=null&&C.file&&t(b)},[e,t]),s=m.useMemo(()=>e.filter(b=>!b.error),[e]),c=m.useMemo(()=>s.slice(0,Av),[s]),u=m.useMemo(()=>s.slice(Av),[s]),h=u.filter(b=>b.processing).length,[f,p]=m.useState(!1),g=m.useCallback(()=>{au({msg:i("userInput.seeAll"),type:"polite"}),p(!0),r==null||r(!0)},[p,i,r]),v=m.useCallback(()=>{p(!1),r==null||r(!1)},[p,r]),y=h>0?i("userInput.uploadingProcess",{uploadingCount:h,totalCount:u.length}):i("userInput.seeAll");return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"relative flex max-h-64 min-w-0 max-w-full flex-wrap gap-2 overflow-y-auto overflow-x-hidden px-1",children:[c.map((b,C)=>d.jsx(jx,{attachment:b,onRemove:()=>o(e.indexOf(b))},b.id??`file-${C}`)),u.length>0&&d.jsx(Ee,{ref:a,"aria-label":y,title:y,color:"overlay-dimmed-inverted",onClick:g,className:"flex h-32 cursor-pointer items-center justify-center rounded-xl border-none px-3.5 py-1 text-xs",children:h>0?d.jsxs(d.Fragment,{children:[d.jsx(Et,{className:"size-6"}),i("userInput.uploadingProcess",{uploadingCount:h,totalCount:u.length})]}):d.jsx(d.Fragment,{children:i("userInput.seeAll")})})]}),f&&d.jsx(PB,{onClose:v,attachments:e,onRemove:t,restoreFocusRef:a})]})}function iRe(n){const{imgAlt:e,imgSrc:t,text:r,className:i,onClick:a,fetchPriority:o}=n,[s,c]=m.useState(!1);return d.jsx("div",{className:"aspect-[155/190] w-full min-w-[100px] max-w-full sm:w-[155px] sm:min-w-[120px] sm:max-w-[155px]",children:d.jsxs("button",{className:ke("relative flex h-full w-full flex-col items-center gap-2 rounded-lg bg-white p-2 shadow-md transition-all duration-[400ms] ease-[cubic-bezier(0,0,0,1)] hover:scale-[1.025] hover:shadow-lg dark:bg-slate-700",i),onClick:a,type:"button",children:[!s&&d.jsx($C,{className:"aspect-square w-full rounded-md"}),d.jsx("img",{className:ke("aspect-square w-full rounded-md object-cover",s?"opacity-100":"opacity-0"),src:t,alt:e,onLoad:()=>c(!0),onError:()=>c(!1),fetchPriority:o}),d.jsx("div",{className:"flex w-full flex-1 items-center justify-center px-2",children:d.jsx("p",{className:"truncate text-center text-xs-strong",children:r})})]})})}function NO(n){const{className:e,text:t,imgSrc:r,imgAlt:i,variant:a,onClick:o,fetchPriority:s}=n,[c,u]=m.useState(!1);return d.jsx("div",{className:ke("max-w-full drop-shadow-md transition-shadow hover:drop-shadow-lg sm:min-w-[120px]",a==="kickstarter"&&"aspect-[166/200] w-[166px] sm:max-w-[166px]",a==="feature-discovery"&&"aspect-[155/200] w-[155px] sm:max-w-[155px]"),children:d.jsxs(Gk,{interactable:!0,stroke:!0,onClick:o,className:ke("relative h-full w-full transition-transform duration-[400ms] ease-[cubic-bezier(0,0,0,1)] hover:scale-[1.025]",e),children:[!c&&d.jsx($C,{className:"absolute size-full"}),d.jsx("img",{src:r,alt:i,className:ke("absolute size-full object-cover",c?"opacity-100":"opacity-0"),onLoad:()=>u(!0),onError:()=>u(!1),fetchPriority:s}),c&&d.jsx("div",{className:"absolute z-10 flex size-full flex-col px-4 py-5",children:d.jsx("p",{className:X("mt-auto line-clamp-2 overflow-hidden text-center text-xs-strong",a==="feature-discovery"&&"text-white/80",a==="kickstarter"&&"text-white"),children:t})})]})})}const aRe={deepLink:"deepLink",prefillComposer:"chatBox",sendMessage:"chat"};function oRe(n){const{className:e,onWidgetClick:t}=n,r=Nn({breakpoint:"md"}),i=Aa(),a=N(Yo),o=i&&a&&!r,s=m.useRef(null),c=N(Vl),u=dy(s,{once:!0,amount:"all"});m.useEffect(()=>{u&&c&&"items"in c&&nc({page:"chatPage",scenario:"widgets",element:c.id,customData:JSON.stringify({visibleItems:c.items.map(p=>p.id)})})},[u,c]);const h=p=>{const{prompt:g,id:v,actionType:y,uri:b,widgetName:C,source:S}=p,E=y==="deepLink"?JSON.stringify({uri:b}):void 0;nt({pageName:"chatPage",sectionName:"widgets",scenario:C,source:v,destination:aRe[y],customData:E}),t({actionType:y,id:v,prompt:g,uri:b,source:S})},f=p=>{const g=new URL(p);return g.searchParams.set("o","7"),g.searchParams.set("rm","3"),g.toString()};return!c||c.type!=="textAndImage"?null:d.jsx("div",{className:ke("grid w-full grid-cols-2 gap-6 px-2 sm:flex sm:items-center",o&&"scrollbar-container justify-start overflow-x-auto bp-960:justify-center bp-960:overflow-x-hidden",!o&&"sm:justify-center",e),ref:s,children:c.items.map((p,g)=>{const{id:v,text:y}=p,{type:b}=p.action,C="prompt"in p.action?p.action.prompt:void 0,S="uri"in p.action?p.action.uri:void 0,{altText:E,url:T}=p.thumbnail,A={actionType:b,id:v,prompt:C,uri:S,widgetName:c.id,source:"widgets"},I=g%2===0?"-rotate-2 hover:rotate-0":"rotate-2 hover:rotate-0";switch(c.id){case"kickstarter":return d.jsx(NO,{text:y,imgSrc:f(T),imgAlt:E,variant:"kickstarter",onClick:()=>h(A),className:I,fetchPriority:"high"},v);case"feature-discovery":return d.jsx(NO,{text:y,imgSrc:f(T),imgAlt:E,variant:"feature-discovery",onClick:()=>h(A),className:I,fetchPriority:"high"},v);case"image-generation":return d.jsx(iRe,{text:y,imgSrc:f(T),imgAlt:E,className:I,onClick:()=>h(A),fetchPriority:"high"},v);default:return null}})})}function sRe(n){const[e,t]=m.useState(!1),{tab:r,className:i=""}=n,{t:a}=Ce();return e||!r.favIconUrl?d.jsx(Mx,{className:X("size-5",i)}):d.jsx("img",{src:r.favIconUrl,alt:a("composer.multiTabs.tabFavIconAltText"),className:X("size-4 rounded bg-white",i),onError:()=>{t(!0)}})}function cRe(n){try{return new URL(n).hostname.replace(/^www\./,"")}catch{return null}}function lRe(n,e=5){const t=new Set;for(const r of n){if(t.size>=e)break;if(r.url){const i=cRe(r.url);i&&t.add(i)}}return Array.from(t).join(", ")}function uRe(n,e=5){const t=new Set;for(const r of n){if(t.size>=e)break;r.title&&t.add(r.title)}return Array.from(t).join(", ")}function dRe(n){const{tabs:e}=n,t=m.useMemo(()=>uRe(e,5),[e]),r=e.length-1;return d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"min-w-0 truncate font-semibold text-foreground-750 text-xs",children:t}),r>0&&d.jsxs("span",{className:"ms-1 font-semibold text-foreground-750 text-xs",children:["+",r]})]})}function hRe(n){const{tabs:e}=n,t=m.useMemo(()=>lRe(e,5),[e]);return d.jsx("span",{className:"truncate text-foreground-750 opacity-60 text-2xs",children:t})}function fRe(n,e){return`${n.id}-${n.url??""}-${e}`}function NB(n){const{tabs:e,onRemove:t,showRemoveIcon:r,onClick:i,isLoading:a=!1}=n,{t:o}=Ce(),s=m.useMemo(()=>e.slice(0,3),[e]),c=h=>{h.stopPropagation(),t==null||t()},u=h=>{h.stopPropagation(),i==null||i()};return d.jsxs(_e.div,{className:"relative flex h-[58px] w-full flex-row items-center justify-center gap-2 overflow-hidden rounded-xl border border-black/8 bg-white/90 p-3 dark:border-white/8 dark:bg-midnight-800/80",layout:"position",initial:ct,animate:Rt,exit:ct,onClick:u,children:[d.jsx("div",{className:X("flex h-5 min-w-5 flex-none items-center justify-center rounded bg-white/90 dark:bg-midnight-800/80"),children:s.map((h,f)=>d.jsx(sRe,{tab:h,className:X(f>0&&"-ms-[6px]")},fRe(h,f)))}),d.jsxs("div",{className:"me-7 flex min-w-0 flex-1 flex-col",children:[d.jsx(dRe,{tabs:e}),d.jsx(hRe,{tabs:e})]}),a&&d.jsx(On,{className:"absolute inset-0 grid place-items-center bg-white/80 dark:bg-white/45","data-testid":"multi-tabs-loading",children:d.jsx(m.Suspense,{fallback:d.jsx("div",{"aria-hidden":!0}),children:d.jsx(Et,{type:"spinnerThemed",className:"size-11"})})}),r&&d.jsx("button",{type:"button",title:o("composer.removeImage"),"aria-label":o("composer.removeImage"),onClick:c,tabIndex:0,className:"absolute end-0.5 top-0.5 m-1 rounded-full p-1 text-foreground-850 safe-hover:bg-black/5 dark:safe-hover:bg-black/30",children:d.jsx(vr,{className:"size-3"})})]})}function pRe({onClick:n,showRemoveIcon:e=!0,isLoading:t=!1}){const[r,i]=Je(Js),a=m.useMemo(()=>Array.from(r.values()),[r]);return r.size===0?null:d.jsx("div",{className:"flex min-h-[60px] cursor-pointer flex-col gap-2","data-testid":"manual-multi-tabs-preview-card",children:d.jsx(NB,{showRemoveIcon:e,tabs:a,onRemove:()=>{i(new Map)},onClick:n,isLoading:t})})}const OB=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M11.7498 3C12.1295 3 12.4434 3.28201 12.4931 3.64808L12.5 3.74985L12.5012 11H19.7543C20.1685 11 20.5043 11.3358 20.5043 11.75C20.5043 12.1297 20.2221 12.4435 19.8561 12.4932L19.7543 12.5H12.5012L12.5032 19.7491C12.5033 20.1633 12.1676 20.4993 11.7534 20.4993C11.3737 20.4993 11.0598 20.2173 11.0101 19.8512L11.0032 19.7494L11.0012 12.5H3.7522C3.33798 12.5 3.0022 12.1642 3.0022 11.75C3.0022 11.3703 3.28435 11.0565 3.65043 11.0068L3.7522 11H11.0012L11 3.75015C10.9999 3.33594 11.3356 3 11.7498 3Z"})),F7e=Object.freeze(Object.defineProperty({__proto__:null,default:OB},Symbol.toStringTag,{value:"Module"}));function mRe({onRef:n,onClick:e,onButtonRef:t}){const{t:r}=Ce(),i=N(SC);return d.jsx(sa,{data:{title:r("common.open"),testId:"plus-button",isVisible:!0,ariaExpanded:i==="plus",onClick:e},ref:n,onButtonRef:t,children:d.jsx(OB,{className:"size-6","aria-hidden":!0})})}const LB=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.92188 11.8237H19.4529C19.4529 11.8237 19.4529 9.89366 19.4529 9.6831C18.6246 6.41578 15.6854 4 12.1862 4C9.56739 4 7.26337 5.35396 5.92188 7.4044C5.92188 8.82754 5.92188 11.8237 5.92188 11.8237Z",fill:"#0364B8"}),m.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.15227 8.30349L9.15203 8.30431C8.23597 7.73294 7.1565 7.40234 6.00013 7.40234C5.97439 7.40234 5.94909 7.404 5.92344 7.40431C2.64519 7.44587 0 10.1364 0 13.4511C0 14.7371 0.399257 15.9285 1.07801 16.9086H14.1906V11.3459L9.15227 8.30349Z",fill:"#0078D4"}),m.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.4514 9.68327C19.3425 9.67596 19.233 9.6709 19.1223 9.6709C18.4357 9.6709 17.7825 9.81469 17.1899 10.073L14.1875 11.3461V16.9176H23.4143C23.7861 16.2237 23.9974 15.4296 23.9974 14.5855C23.9974 11.9828 21.9902 9.85405 19.4514 9.68327Z",fill:"#1490DF"}),m.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.1602 14.3467L17.9151 13.5949L15.0613 11.8716L14.1907 11.3459L11.8941 12.3202L7.49635 14.1859L5.52123 15.0238L1.07812 16.9087C2.16256 18.4747 3.96212 19.5 6.00025 19.5H19.1255C20.9807 19.5 22.5937 18.4551 23.4175 16.9175L19.1602 14.3467Z",fill:"#28A8EA"})),B7e=Object.freeze(Object.defineProperty({__proto__:null,default:LB},Symbol.toStringTag,{value:"Module"})),DB=n=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("g",null,m.createElement("path",{id:"Shape",d:"M11.7717 3.74212C14.1132 1.39853 17.9121 1.39853 20.2553 3.74168C22.5384 6.02474 22.5969 9.68995 20.4309 12.0439L20.2428 12.2413L11.4427 21.0395L11.4062 21.0697C9.94492 22.3865 7.69092 22.3417 6.28355 20.9344C4.96453 19.6153 4.84241 17.5527 5.9172 16.096C5.94054 16.0506 5.96879 16.0068 6.002 15.9657L6.05556 15.9061L6.14247 15.8183L6.28355 15.6704L6.28647 15.6733L13.7222 8.21901C13.9881 7.95239 14.4047 7.92763 14.6986 8.14509L14.7829 8.2176C15.0495 8.48351 15.0742 8.90014 14.8568 9.19404L14.7843 9.27826L7.18966 16.8913C6.47202 17.7669 6.5219 19.0612 7.3393 19.8786C8.16836 20.7077 9.48801 20.7472 10.3638 19.997L19.1965 11.1666C20.952 9.40894 20.952 6.5597 19.1946 4.80234C17.4922 3.0999 14.765 3.0467 12.9986 4.64274L12.8307 4.80234L12.8181 4.81665L3.28179 14.353C2.9889 14.6459 2.51403 14.6459 2.22113 14.353C1.95487 14.0867 1.93066 13.67 2.14852 13.3764L2.22113 13.2923L11.77 3.74168L11.7717 3.74212Z",fill:"currentColor"}))),H7e=Object.freeze(Object.defineProperty({__proto__:null,default:DB},Symbol.toStringTag,{value:"Module"})),jB=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",...n},m.createElement("path",{fill:"currentColor",d:"M6.3 3A3.2 3.2 0 0 0 3 6.3v11.4C3 19.6 4.5 21 6.3 21h11.4c1.8 0 3.3-1.5 3.3-3.3V6.3C21 4.5 19.5 3 17.7 3H6.3ZM4.5 6.3c0-1 .8-1.8 1.8-1.8h11.4c1 0 1.8.8 1.8 1.8v11.4c0 1-.8 1.8-1.8 1.8H6.3c-1 0-1.8-.8-1.8-1.8V6.3ZM8 7.5c-.3 0-.5.2-.5.5v2.3a.8.8 0 0 1-1.5 0V8c0-1.1.9-2 2-2h2.3a.8.8 0 0 1 0 1.5H8Zm0 9a.5.5 0 0 1-.5-.5v-2.3a.8.8 0 0 0-1.5 0V16c0 1.1.9 2 2 2h2.3a.8.8 0 0 0 0-1.5H8ZM16.5 8c0-.3-.2-.5-.5-.5h-2.3a.8.8 0 0 1 0-1.5H16a2 2 0 0 1 2 2v2.3a.8.8 0 0 1-1.5 0V8Zm-.5 8.5c.3 0 .5-.2.5-.5v-2.3a.8.8 0 0 1 1.5 0V16a2 2 0 0 1-2 2h-2.3a.8.8 0 0 1 0-1.5H16Z"})),$7e=Object.freeze(Object.defineProperty({__proto__:null,default:jB},Symbol.toStringTag,{value:"Module"})),UB=n=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",...n},m.createElement("path",{d:"M3 5.75A2.75 2.75 0 0 1 5.75 3h12.5A2.75 2.75 0 0 1 21 5.75v6.272a6.471 6.471 0 0 0-1.5-.709V5.75c0-.69-.56-1.25-1.25-1.25H5.75c-.69 0-1.25.56-1.25 1.25v12.5c0 .69.56 1.25 1.25 1.25h5.563c.173.534.412 1.037.709 1.5H5.75A2.75 2.75 0 0 1 3 18.25V5.75ZM23 17.5a5.5 5.5 0 1 0-11 0 5.5 5.5 0 0 0 11 0Zm-5 .5.001 2.503a.5.5 0 1 1-1 0V18h-2.505a.5.5 0 0 1 0-1H17v-2.5a.5.5 0 1 1 1 0V17h2.497a.5.5 0 0 1 0 1H18Z"})),z7e=Object.freeze(Object.defineProperty({__proto__:null,default:UB},Symbol.toStringTag,{value:"Module"})),pf=X("flex w-full flex-row items-center gap-2");function gRe(n){const{startNewChatDisabled:e,startNewConversation:t,selectFile:r,selectOneDriveFile:i,takeScreenshot:a,selectUserOpenedTabs:o,uploadButtonDisabled:s=!1}=n,c=m.useRef(null),{t:u}=Ce(),h=N(Bl),f=N(lt),p=m.useRef(void 0);return gx(c),m.useEffect(()=>{a&&p.current!==f&&pxe(f)},[f,a]),d.jsxs(cc,{className:"pointer-events-auto relative flex flex-col rounded-2xl contrast-more:border-2","data-testid":"composer-plus-menu",role:"menu",circular:!0,children:[d.jsx(Ee,{role:"menuitem",variant:"rect",color:"subtle-dimmed-inverted",className:"ps-3.5",title:u("composer.startNewChat"),onClick:t,testId:"new-chat-button",ref:c,disabled:e,children:d.jsxs("div",{className:pf,children:[d.jsx(PC,{className:"size-5"}),u("composer.startNewChatShort")]})}),r&&!h&&d.jsx(Ee,{role:"menuitem",variant:"rect",color:"subtle-dimmed-inverted",title:u("composer.upload"),disabled:s,testId:"file-upload-button",onClick:g=>{g.preventDefault(),r()},children:d.jsxs("div",{className:pf,children:[d.jsx(DB,{className:"size-6"})," ",u("composer.upload")]})}),a&&d.jsx(Ee,{role:"menuitem",variant:"rect",color:"subtle-dimmed-inverted",title:u("composer.takeScreenshot"),onClick:g=>{g.preventDefault(),g.stopPropagation(),a(),bxe(f)},children:d.jsxs("div",{className:pf,children:[d.jsx(jB,{className:"size-6"}),u("composer.takeScreenshotShort")]})}),i&&d.jsx(Ee,{role:"menuitem",variant:"rect",color:"subtle-dimmed-inverted",title:u("composer.addFromOneDrive"),onClick:g=>{g.preventDefault(),g.stopPropagation(),i()},children:d.jsxs("div",{className:pf,children:[d.jsx(LB,{className:"size-6"}),u("composer.addFromOneDrive")]})}),o&&d.jsx(Ee,{role:"menuitem",variant:"rect",testId:"add-tabs-button",color:"subtle-dimmed-inverted",title:u("composer.multiTabs.addTab"),onClick:g=>{g.preventDefault(),g.stopPropagation(),o()},children:d.jsxs("div",{className:pf,children:[d.jsx(UB,{className:"size-6"}),u("composer.multiTabs.addTab")]})})]})}function vRe(){const[n,e]=m.useState(!1);return m.useEffect(()=>{async function t(){const{uiOverrides:{showScreenshotButton:r=()=>Promise.resolve(!1)}={}}=me.instance().config(),i=await r();e(i)}t().catch(()=>{})},[]),n}function bRe({startNewChatDisabled:n,uploadButtonDisabled:e=!1,onStartNewConversation:t,onSelectFileIfEnabled:r,onSelectOneDriveFileIfEnabled:i,onTakeScreenshot:a,onSelectUserOpenedTabsIfEnabled:o,onRef:s}){const[c,u]=Je(SC),h=vRe(),p=`plus-menu-${sm()}`,g=c==="plus";return d.jsx(RC,{isOpen:g,onIsOpenChange:v=>u(y=>v?"plus":y==="plus"?null:y),renderTrigger:v=>d.jsx(mRe,{onRef:v.ref,onButtonRef:s,onClick:y=>{v.onClick(y),nt({source:"composerPlusButton",pageName:"chatPage",customData:JSON.stringify({isOpen:g})})}}),options:{placement:"top-start",offset:{mainAxis:10,crossAxis:-12},hideOnMenuClick:!0},className:ke(Ea,"p-2"),children:d.jsx(gRe,{startNewChatDisabled:n,uploadButtonDisabled:e,startNewConversation:t,selectFile:r,selectOneDriveFile:i,takeScreenshot:h?a:void 0,selectUserOpenedTabs:o})},p)}function FB(){const n=G9(),e=N(lt),t=N(BI),r=m.useCallback(async({url:a,args:o,conversationId:s})=>{const c=await Tn(a,t3,{query:o,analytics:{anonymousPath:"/conversations/*/history"},parseOptions:{safe:!0}}).then(u=>u.data);return c.results.length>0&&(c.results=AB(c.results),n(s,u=>{var h;u.length===0&&yRe((h=c.results.at(0))==null?void 0:h.createdAt),c.results.reverse(),u.unshift(...c.results)})),c},[n]);return Vk(r,(a,o)=>{if(!e||t!=null&&t.prompt||!(o!=null&&o.next)&&a>0)return null;const s={url:`/conversations/${e}/history`,conversationId:e};return o!=null&&o.next&&(s.args={cursor:o.next}),s})}function yRe(n){try{const e=Fe(ai),t=e==null?void 0:e.updatedAt;if(!n||!t)return;const r=new Date(t),i=new Date(n);(r.getTime()-i.getTime())/1e3/60>1&&H.trackEvent({name:"system",data:{eventName:"historyUpdatedAtDiscrepancy",eventInfo_conversationId:e.id,eventInfo_conversationUpdatedAt:t,eventInfo_lastMessageCreatedAt:n}})}catch{}}const CRe=3,SRe=10,wRe=3,OO={SUCCESS:"success",FAILED:"failed"};function ERe({toggleVoiceChat:n,enabled:e=!1}){const t=m.useRef(n);t.current=n;const r=m.useRef({hasAudio:!0,hasText:!0,retryCount:0,consecutiveErrors:0,isFirstTurn:!0}),[i,a]=m.useState(!1),o=N(lt),s=m.useCallback(g=>{const v=r.current;let y="initialAutoRetry";i?y="userManualRetry":v.isFirstTurn?y="initialAutoRetry":v.consecutiveErrors>0&&(y="backendAutoRecover");const b=JSON.stringify({retryCount:v.retryCount,consecutiveErrors:v.consecutiveErrors});H.trackEvent({name:"system",data:{eventName:"voiceRecoveryEventData",eventInfo_result:g,eventInfo_scenario:y,eventInfo_customData:b,eventInfo_conversationId:o??""}})},[i,o]),c=m.useCallback(async()=>{t.current("end",{force:!0}),await Wk(),t.current("start",{force:!0}),r.current.isFirstTurn=!0,r.current.retryCount+=1},[]),u=m.useCallback(()=>{s(OO.FAILED),t.current("end",{force:!0}),r.current.retryCount=0,r.current.consecutiveErrors=0,a(!0)},[s,a]),h=m.useCallback(()=>{(r.current.retryCount>0||r.current.consecutiveErrors>0||i)&&s(OO.SUCCESS),r.current.retryCount=0,r.current.consecutiveErrors=0,a(!1)},[a,s,i]),f=m.useCallback(()=>{const g=r.current;if(!i&&g.isFirstTurn&&g.retryCount<SRe){c();return}if(!(!g.isFirstTurn&&!i&&(g.consecutiveErrors+=1,g.consecutiveErrors<wRe))){if(i&&g.retryCount<CRe){c();return}u()}},[i,c,u]);return{voiceRecoveryHandler:m.useCallback(g=>{if(e)switch(g.event){case"startMessage":r.current.hasAudio=!1,r.current.hasText=!1;break;case"appendText":r.current.hasText=!0;break;case"audio":r.current.hasAudio=!0,h();break;case"done":r.current.hasText&&!r.current.hasAudio&&f(),r.current.isFirstTurn=!1;break}},[h,f,e]),isNoAudioErrorVisible:e?i:!1}}const oy=class oy{constructor(){B(this,"readyTime",0);B(this,"startCallTime",0);B(this,"startMessageTime",0);B(this,"mostRecentTokenTime",0);B(this,"interruptAudioTime",0);B(this,"speechEndTime",0);B(this,"currentConversationId","");B(this,"currentCallId","");B(this,"currentMessageId","");B(this,"introComplete",!1);B(this,"receivedTranscript",!1);B(this,"receivedText",!1);B(this,"receivedAudio",!1);B(this,"receivedFirstToken",!1);B(this,"receivedLastToken",!1);B(this,"receivedFirstAnimation",!1);B(this,"hasAudioStarted",!1);B(this,"scenario")}static getInstance(){return this.instance||(this.instance=new oy),this.instance}onBeforeStartCall(e){this.readyTime=performance.now(),this.scenario=e?"appearance":void 0}onStartCall(e){this.interruptAudioTime=0,this.speechEndTime=0,this.introComplete=!1,this.startCallTime=performance.now(),this.currentConversationId=e,this.currentCallId=crypto.randomUUID(),H.trackEvent({name:"interaction",data:{eventName:"copilotCompose",eventInfo_conversationId:this.currentConversationId,eventInfo_inputMethod:"voice",eventInfo_landingPage:H.getLandingPage(),eventInfo_scenario:this.scenario}}),H.trackEvent({name:"interaction",data:{eventName:"audioStartSent",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_duration:this.startCallTime-this.readyTime,eventInfo_scenario:this.scenario}})}onStartMessage(e){this.receivedTranscript=!1,this.receivedText=!1,this.receivedAudio=!1,this.receivedFirstToken=!1,this.receivedLastToken=!1,this.receivedFirstAnimation=!1,this.hasAudioStarted=!1,this.currentMessageId=e,this.startMessageTime=performance.now(),zv.onStartMessage(e,this.startMessageTime),this.speechEndTime&&H.trackEvent({name:"system",data:{eventName:"copilotAudioReqtoResp",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_messageId:this.currentMessageId,eventInfo_duration:this.startMessageTime-this.speechEndTime,eventInfo_scenario:this.scenario}}),H.trackEvent({name:"system",data:{eventName:"copilotAudioStartMessage",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_messageId:this.currentMessageId,eventInfo_scenario:this.scenario,eventInfo_firstTurn:!this.introComplete}})}onTranscriptReceived(){this.receivedTranscript=!0}onTextReceived(e){e===this.currentMessageId&&(this.receivedText=!0)}onAudioInterrupt(){this.interruptAudioTime=performance.now()}onAudioReceived(){this.receivedAudio=!0,!(!this.introComplete||!this.currentMessageId)&&(this.mostRecentTokenTime=performance.now(),this.receivedFirstToken||(this.receivedFirstToken=!0,this.startMessageTime&&H.trackEvent({name:"system",data:{eventName:"copilotAudioResptoReceived",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_messageId:this.currentMessageId,eventInfo_duration:this.mostRecentTokenTime-this.startMessageTime,eventInfo_scenario:this.scenario}}),this.speechEndTime&&H.trackEvent({name:"system",data:{eventName:"copilotAudioFirstTokenReceived",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_messageId:this.currentMessageId,eventInfo_duration:this.mostRecentTokenTime-this.speechEndTime,eventInfo_scenario:this.scenario}})))}onSpeechEndDetected(){this.speechEndTime=performance.now(),zv.onSpeechEndDetected(this.speechEndTime),this.interruptAudioTime&&H.trackEvent({name:"system",data:{eventName:"copilotAudioInput",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_duration:this.speechEndTime-this.interruptAudioTime,eventInfo_scenario:this.scenario}})}onCallUIEventReceived(){const e=performance.now(),t=this.speechEndTime?e-this.speechEndTime:void 0;H.trackEvent({name:"system",data:{eventName:"callUIEventReceived",eventInfo_scenario:"adaptiveUI",eventInfo_conversationId:this.currentConversationId,eventInfo_duration:t}})}onCharacterAnimationReceived(){this.receivedFirstAnimation||(this.receivedFirstAnimation=!0,H.trackEvent({name:"system",data:{eventName:"copilotAudioCharacterAnimationReceived",eventInfo_conversationId:this.currentConversationId,eventInfo_duration:performance.now()-this.speechEndTime,eventInfo_messageId:this.currentMessageId,eventInfo_callId:this.currentCallId,eventInfo_scenario:this.scenario}}))}onMessageDone(e){const{messageId:t,voiceType:r}=e;if(H.trackEvent({name:"system",data:{eventName:"copilotAudioMessageDone",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_messageId:t,eventInfo_scenario:this.scenario,eventInfo_firstTurn:!this.introComplete,eventInfo_transcriptReceived:this.receivedTranscript,eventInfo_textReceived:this.receivedText,eventInfo_audioReceived:this.receivedAudio}}),!this.introComplete){this.introComplete=!0,H.trackEvent({name:"system",data:{eventName:"copilotAudioCallSetUp",eventInfo_duration:performance.now()-this.readyTime,eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_responseVoiceType:r,eventInfo_scenario:this.scenario}});return}!this.receivedLastToken&&t===this.currentMessageId&&(this.receivedLastToken=!0,this.speechEndTime&&H.trackEvent({name:"system",data:{eventName:"copilotAudioLastTokenReceived",eventInfo_conversationId:this.currentConversationId,eventInfo_messageId:t,eventInfo_callId:this.currentCallId,eventInfo_duration:this.mostRecentTokenTime-this.speechEndTime,eventInfo_scenario:this.scenario}}),H.trackEvent({name:"system",data:{eventName:"copilotResponseRender",eventInfo_inputMethod:"voice",eventInfo_responseMethod:"voice",eventInfo_conversationId:this.currentConversationId,eventInfo_messageId:this.currentMessageId,eventInfo_responseVoiceType:r,eventInfo_landingPage:H.getLandingPage(),eventInfo_scenario:this.scenario}}))}onEndCall(e){const t=performance.now()-this.startCallTime;H.trackEvent({name:"system",data:{eventName:"copilotAudioCallEnd",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_duration:t,eventInfo_numMessages:e,eventInfo_scenario:this.scenario}}),this.currentCallId=""}onAudioStartFailed(e){H.trackEvent({name:"system",data:{eventName:"copilotAudioStartFailed",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_duration:performance.now()-this.startCallTime,eventInfo_reason:e,reason:e,eventInfo_scenario:this.scenario}})}onAudioStartTimeout(e){H.trackEvent({name:"system",data:{eventName:"copilotAudioStartTimeout",eventInfo_conversationId:this.currentConversationId,eventInfo_duration:e,eventInfo_scenario:this.scenario}})}onTerminated(e){H.trackEvent({name:"system",data:{eventName:"copilotAudioTerminated",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_duration:performance.now()-this.startCallTime,eventInfo_reason:e,reason:e,eventInfo_scenario:this.scenario}})}onError(e){H.trackEvent({name:"system",data:{eventName:"copilotAudioError",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_duration:performance.now()-this.startCallTime,eventInfo_errorCode:e,eventInfo_scenario:this.scenario}})}onAudioStart(){if(!this.hasAudioStarted){this.hasAudioStarted=!0;const e=Math.round(performance.now()-(this.speechEndTime||this.startMessageTime));H.trackEvent({name:"system",data:{eventName:"copilotAudioStart",eventInfo_conversationId:this.currentConversationId,eventInfo_callId:this.currentCallId,eventInfo_messageId:this.currentMessageId,eventInfo_duration:e,eventInfo_scenario:this.scenario}})}}};B(oy,"instance");let bT=oy;const TRe=null;function IRe(n){return n instanceof Error&&(n.name==="NotFoundError"||n.name==="OverconstrainedError")}function ARe({initAudio:n,getAudioConstraints:e,onCallTerminated:t,onSpeechEndDetected:r,keepAudioInputAlive:i=!1,shouldRefetchHistory:a=!0,isVoiceRecoveryEnabled:o=!1}){const s=pe(Gc),c=pe(hte),u=pe($l),h=ee("voice-call-jingles"),f=pe(ete),p=N(lt),g=N(Ry),v=N(am),y=pe(Df),b=pe(tte),C=pe(ol),S=pe(ch),E=ee("voice-speed"),T=N(Hte),A=G9(),{refetch:I}=FB(),{showBoundary:k}=H5(),{isLivingPortraitEnabled:x}=ZI(),_=N(c4),R=pe(I9),z=m.useRef("inactive"),j=m.useRef(0),[J,D]=m.useState(!n),F=bT.getInstance();m.useEffect(()=>{n||(D(!0),y("waiting-for-user-interaction"))},[n,D,y]),m.useEffect(()=>{sn.AudioIn.toggleMute(J)},[J]);const ie=m.useCallback(async()=>{p&&(A(p,xe=>xe.splice(0)),await I())},[I,p,A]),U=m.useCallback(()=>{sn.AudioOut.stopAudioPlayback(),Es()&&sn.Animation.stopAnimation()},[]),W=m.useCallback(async xe=>{z.current="ending",sn.AudioIn.stopAudioCapture(),U(),D(!1),xe.sendAudioEnd(),f("idle"),Fe(Df)==="available"&&(h&&sn.AudioOut.playCallEndJingle(),a&&await ie(),F.onEndCall(j.current),j.current=0,S(!0))},[U,f,h,a,F,S,ie]),ue=m.useCallback(async xe=>{const{AudioIn:M}=sn,Y=P=>{P instanceof CustomEvent&&typeof P.detail=="string"&&xe.sendAudio(P.detail)},Se=async()=>{i&&z.current==="active"&&ue(xe),M.removeEventListener("audioData",Y),M.removeEventListener("audioTrackEnded",Se)};try{await M.startAudioCapture(e),M.addEventListener("audioData",Y),M.addEventListener("audioTrackEnded",Se)}catch(P){P instanceof Error&&(P.name==="NotAllowedError"||P.name==="NotSupportedError")?(y("microphone-denied"),await W(xe),H.trackEvent({name:"system",data:{eventName:"copilotNoMicrophoneAccess"}})):IRe(P)?(y("microphone-not-found"),await W(xe),H.trackEvent({name:"system",data:{eventName:"copilotMicrophoneNotFound"}})):k(new Error(`Error starting audio capture: ${P}`))}},[i,e,y,W,k]),te=m.useCallback(xe=>{const M=xe==="mute";D(M),xn(wge,M)},[]),Z=m.useCallback(async xe=>{sn.currentTurnIndex+=1,sn.AudioIn.audioContext||ue(xe);const M=E?T:Qp;await sn.AudioOut.initialize(M),sn.Animation.initialize(Es()),Fe($I)&&Fe(nx)&&te("mute")},[T,E,ue,te]),Q=m.useCallback(()=>{if(x)return"portrait";const xe=me.instance().config().audioConfigClientType;if(xe)return xe;if(Es())return"character"},[x]),Ie=m.useCallback(async(xe,M)=>{var ne;if(!M||!n||z.current==="ending")return;y("checking-availability"),b(null);const{sendAudioStart:Y}=xe,Se=Q();Y(M,{voice:x&&_?_.voiceId:v??((ne=g[0])==null?void 0:ne.id)},Se),sn.currentTurnIndex=0;const P=1e4;setTimeout(()=>{Fe(Df)==="checking-availability"&&z.current==="active"&&F.onAudioStartTimeout(P)},P),F.onStartCall(M),h&&await sn.AudioOut.playCallStartJingle(),rd("onStartVoiceChat")},[n,y,v,g,F,b,h,Q,x,_]),Ve=m.useCallback(async(xe,M)=>{await W(xe),t(M)},[W,t]),ce=m.useRef(null),le=m.useCallback(xe=>M=>{var Y,Se;switch(M.event){case"startMessage":{const{messageId:P}=M;if(F.onStartMessage(P),U(),z.current==="inactive")break;Z(xe),y("available"),f("listening");break}case"transcriptEvent":{F.onTranscriptReceived();break}case"appendText":{const{messageId:P}=M;F.onTextReceived(P);break}case"audioStartFailed":{const{reason:P}=M,{success:ne}=A3.safeParse(P);y(ne?P:"error"),F.onAudioStartFailed(P);break}case"audioTimeRemaining":{const{seconds:P}=M;b(P);break}case"audio":{if(z.current==="inactive")break;F.onAudioReceived(),sn.AudioOut.appendAudioData(M.audio);break}case"characterAnimation":{F.onCharacterAnimationReceived(),Es()&&sn.Animation.setFrameData(M);break}case"callUI":{const{callUI:P}=M,ne=Fe(Rf);P?Array.isArray(P.topics)?(P.selectedIndex??(P.selectedIndex=-1),xn(Rf,P)):xn(Rf,{...ne??{},...P,topics:(ne==null?void 0:ne.topics)??null}):xn(Rf,null),F.onCallUIEventReceived();break}case"characterEmotion":{Es()&&c({emotion:M.emotion,bodyReaction:M.bodyReaction});break}case"interruptAudio":{f("listening"),s("listening"),F.onAudioInterrupt(),U(),c(null),_t.emit("portrait:interrupt-audio");break}case"speechEndDetected":{F.onSpeechEndDetected(),s("thinking"),r==null||r();break}case"callTerminated":{Ve(xe,M.reason),F.onTerminated(M.reason);break}case"error":{const{errorCode:P}=M;switch(P){case"over-turn-limit":{C(0);break}case"character-out-of-capacity":{xe.setCallType("standard");break}}z.current==="active"&&F.onError(P);break}case"done":{const{messageId:P}=M;j.current+=1,sn.AudioOut.setAudioDone(),sn.Animation.setAnimationDone(),F.onMessageDone({messageId:P,voiceType:v??((Y=g[0])==null?void 0:Y.id)});break}case"banned":{const{expiresAt:P}=M,ne=Dk(P);ne&&(jk(ne,"voice",P),U(),W(xe));break}case"callTypeChanged":{const{callType:P}=M;P==="standard"&&u(void 0);break}}try{(Se=ce.current)==null||Se.call(ce,M)}catch{}},[F,U,Z,y,f,b,c,s,r,Ve,C,v,g,W,u]),De=m.useCallback(()=>xe=>{switch(xe.event){case"callEnded":{z.current="inactive";break}}},[]),We=m.useCallback(async(xe,M)=>{const{force:Y=!1}=M??{},Se=Fe(lt);if(xe==="start"&&z.current!=="inactive"&&!Y||(xe==="start"&&F.onBeforeStartCall(Es()),xe==="end"&&z.current==="inactive"&&!Y))return;z.current=xe==="start"&&n?"active":"inactive",zv.onVoiceChatToggled(xe,Se);const P=await go({useMockConnection:!!TRe});xe==="start"?(P.setOnEvent(le(P)),await Ie(P,Se)):(P.setOnEvent(De()),await W(P))},[n,F,le,Ie,De,W]),{voiceRecoveryHandler:be,isNoAudioErrorVisible:Me}=ERe({toggleVoiceChat:We,enabled:o});return ce.current=be,m.useEffect(()=>{const{AudioOut:xe}=sn,M=()=>{R(!0),f("responding"),s("responding"),F.onAudioStart()},Y=()=>{R(!1),f("listening"),s("listening")};return xe.addEventListener("audioStart",M),xe.addEventListener("audioEnd",Y),()=>{xe.removeEventListener("audioStart",M),xe.removeEventListener("audioEnd",Y)}},[s,R,f,F]),{toggleVoiceChat:We,toggleMute:te,isInputMuted:J,inputVolume:sn.AudioIn.volume,isNoAudioErrorVisible:Me}}const V7e="https://picassostaticassetsstg.azureedge.net/character/try-now/lumi_intro_394_222";function LO(n,e){if(!n)return!1;const t=dr(Fq,l.boolean())??dr(Bq,l.boolean());return!e&&!t}function DO(n,e,t){return n?!e&&t===OC&&!dr(Uq,l.boolean()):!1}function kRe({isAudioCall:n,onCallTerminated:e,onMute:t,onUnmute:r}){const i=Bt(),a=Z3(),[o,s]=yC(),c=o==="audioCall",[u,h]=m.useState(!1),f=N($l),p=ee("appearance-try-now-modal"),g=N($I),v=N(nx),y=N(hCe),b=ee("appearance-discoverability"),C=N(LC),{state:S,setState:E}=Xk({defaultValue:!c}),{toggleVoiceChat:T,toggleMute:A,inputVolume:I,isInputMuted:k}=ARe({initAudio:S,onCallTerminated:e}),x=m.useRef(T);x.current=T,m.useEffect(()=>{n?!c&&!LO(p,f)&&!g&&!DO(b,y,C)&&x.current("start"):x.current("end")},[i,n,c,x,f,g,p,b,v,y,C]);const _=m.useCallback(()=>{T("start"),S&&!u&&(h(!0),A("unmute"))},[T,S,u,A]),R=m.useCallback(()=>{s(),E(!0),T("end")},[s,E,T]),z=m.useCallback(()=>{E(!0),A(k?"unmute":"mute"),k?r==null||r():t==null||t()},[E,A,k,t,r]);m.useEffect(()=>{n&&c&&S&&_()},[S,n,c,_]);const j=m.useCallback(async(F=!1)=>{(!n||F)&&await J()!=="NotSupported"||(await a({talk:!0}),!LO(p,f)&&!DO(b,y,C)&&_())},[b,y,n,p,a,f,_,C]);m.useEffect(()=>{c&&j(!0)},[c,j]);async function J(){return(await Zfe.run({onAudioCall:async()=>"NotSupported"})).onAudioCall()}const D=m.useCallback(F=>{const{toLocation:ie}=F,U=ie.pathname;n&&!U.endsWith("/talk")&&x.current("end")},[n]);return Nk(D),{launchAudioCall:j,startAudioCallIfNotStartedAlready:_,endAudioCall:R,toggleAudioInput:z,inputVolume:I,isInputMuted:k,isAudioDeepLink:c,canInitAudio:S}}const BB=crypto.randomUUID();function xRe(){return{sdk:"8.0",messaging:{origin:window.location.origin,channelId:BB},accessibility:{showFocusOnLoad:!1,enableFocusTrap:!0},authentication:{},entry:{oneDrive:{recent:{}}},typesAndSources:{mode:"files",filters:nSe(),pivots:{oneDrive:!0,recent:!0,photos:!1}}}}function _Re(){const n=new URLSearchParams({app:"CMC",scenario:"AnalyzeDoc",filePicker:JSON.stringify(xRe()),locale:Dt.resolvedLanguage??"en-US"});return`${HB}/picker?${n}`}const HB="https://onedrive.live.com";async function $B(){const n=await hpe();return(n==null?void 0:n.accessToken)??""}function MRe(n){return n!==null&&typeof n=="object"&&"type"in n&&n.type==="initialize"&&"channelId"in n&&typeof n.channelId=="string"}function RRe({port:n,onClose:e,onPick:t,setIsLoading:r,onError:i}){return async a=>{let o;switch(a.data.type){case"notification":a.data.data.notification==="page-loaded"&&r(!1);break;case"command":switch(n.postMessage({type:"acknowledge",id:a.data.id}),a.data.data.command){case"authenticate":o=await $B(),typeof o<"u"?n.postMessage({type:"result",id:a.data.id,data:{result:"token",token:o}}):(n.postMessage({type:"result",id:a.data.id,data:{result:"error",error:{code:"authTokenError",message:"Could not get OneDrive authentication token."}}}),r(!1),i(),e());break;case"close":e();break;case"pick":a.data.data.items!==void 0&&a.data.data.items.length>0&&a.data.data.items[0]!==void 0&&(t(a.data.data.items[0]),n.postMessage({type:"result",id:a.data.id,data:{result:"success"}}),e());break;default:r(!1),n.postMessage({result:"error",error:{code:"unsupportedCommand",message:a.data.data.command},isExpected:!0}),i(),e();break}break}}}function PRe({onClose:n,onPick:e,onError:t}){const r=m.useRef(null),{t:i}=Ce(),[a,o]=m.useState(!0);return m.useEffect(()=>{var f;const s=()=>{const p={title:i("composer.errors.attachmentOneDrive.title"),message:i("composer.errors.attachmentOneDrive.message")};t(p),H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"submitMessage",eventInfo_errorMessage:p.message,eventInfo_details:"Error submitting message"}})},c=(f=r.current)==null?void 0:f.contentWindow;let u,h;return c&&(async()=>{const g=c.document.createElement("form");g.method="POST",g.action=_Re(),c.document.body.appendChild(g);const v=c.document.createElement("input");v.type="hidden",v.name="access_token",v.value=await $B(),g.appendChild(v),window.addEventListener("message",y=>{if(y.origin&&y.origin===HB){const b=y.data;if(MRe(b)&&b.channelId===BB){if([h]=y.ports,!h){o(!1),s(),n();return}u=RRe({port:h,onClose:n,onPick:e,onError:s,setIsLoading:o}),h.addEventListener("message",u),h.start(),h.postMessage({type:"activate"})}}}),g.submit()})(),()=>{u&&window.removeEventListener("message",u),h&&h.close()}},[n,e,t,i]),d.jsxs(bo,{isOpen:!0,onClose:n,className:"flex h-[90vh] max-h-[680px] w-[90vw] max-w-[1080px]",fullBleed:!0,children:[a&&d.jsxs("div",{className:"flex size-full items-center justify-center","aria-live":"polite",role:"status","aria-label":i("oneDrive.pickerLoading"),children:[d.jsx("span",{className:"sr-only",children:i("oneDrive.pickerLoading")}),d.jsx(Et,{className:"size-20"})]}),d.jsx("iframe",{title:i("onedrive.filePicker"),ref:r,hidden:a,width:"100%",height:"100%"})]})}const NRe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/add-BTcFT5ig.svg",ORe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/image-zMo0jLdY.svg",LRe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/podcast-BQmBU8ew.svg",DRe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/quiz-mPcJG41j.svg",jRe="https://studiostaticassetsprod.azureedge.net/bundle-cmc/assets/research-i8a7tpJF.svg";function URe(){const n=pe(J8),{t:e}=Ce("translation",{keyPrefix:"composer.create"});return{setComposerCreateModeWithPrefill:m.useCallback(r=>{n(r);let i="";switch(r){case"image":i=e("image.prompt");break;case"podcast":i=e("podcast.prompt");break;case"researchReport":i=e("researchReport.prompt");break;case"quiz":i=e("quiz.prompt");break;case"actions":i=e("actions.prompt");break}i&&ep({prompt:i,prefillSource:"create"})},[n,e])}}const jO="create";function FRe(n){const{disabled:e=!1}=n,t=N(KI),r=N(Ly),[i,a]=Je(Cn),o=N(hr),s=N(Dy),c=fr(),u=pe(nu),h=UC(),{handleSubscription:f}=ty({payflowEntryPoint:"PodcastLimit",skuType:s?"FreeTrial":"1Mo-Paid",upsellReason:"",entryStyle:"Button"}),{handleSubscription:p}=ty({payflowEntryPoint:"DeepResearchLimit",skuType:s?"FreeTrial":"1Mo-Paid",upsellReason:"",entryStyle:"Button"}),g=BRe({remainingPodcastGeneration:t,remainingResearchReportGeneration:r,isPro:(o==null?void 0:o.isPro)??!1}),[v,y]=Je(J8),b=Zk(),C=m.useRef(b),S=m.useRef(!1);m.useEffect(()=>{C.current.length>0&&(S.current=!0),C.current=b},[b]);const{setComposerCreateModeWithPrefill:E}=URe(),T=m.useCallback(I=>{switch(I){case"image":E("image");break;case"podcast":if(!c&&t===0){u({isOpen:!0,scenario:"podcast",reason:"createPodcast"});return}if(!(o!=null&&o.isPro)&&t===0){if(!h)return;f();return}E("podcast");break;case"researchReport":if(!c&&r===0){u({isOpen:!0,scenario:"researchReport",reason:"createResearchReport"});return}if(!(o!=null&&o.isPro)&&r===0){if(!h)return;p();return}E("researchReport"),a("research");break;case"quiz":E("quiz");break;case"actions":E("actions"),a("computerUse");break;default:E(null);break}},[E,o,t,r,h,f,p,c,u,a]),A=m.useCallback(()=>{y(null),XE(),a(ni())},[y,a]);return m.useEffect(()=>{b.length===0&&S.current&&i!=="research"&&i!=="computerUse"&&A()},[b,A,i]),d.jsx(_x,{items:g,onSelect:T,value:v??jO,defaultValue:jO,onReset:A,disabled:e,onMenuClick:()=>nt({source:"composerCreateButton",pageName:"chatPage"})})}function Mu(n){return e=>{hxe(n,e)}}function Ru(n){return e=>{mxe(n,e)}}function BRe({remainingPodcastGeneration:n,remainingResearchReportGeneration:e,isPro:t}){const r=ee("podcast-in-create-drawer"),i=oB(),a=ix(),o=r,s=i,c=ee("quiz-in-create-drawer"),{t:u}=Ce("translation",{keyPrefix:"composer.create"});return m.useMemo(()=>{const f={key:"create",title:u("buttonTitle"),icon:d.jsx(Qn,{url:NRe,className:"size-5"}),description:u("buttonDescription"),testId:"composer-create-button",onImpression:Mu(null),beforeClick:Ru(null),isIconEnabledInButton:!0},p={key:"image",title:u("image.title"),icon:d.jsx(Qn,{url:ORe,className:"size-6"}),description:u("image.description"),testId:"composer-create-image-button",onImpression:Mu("image"),beforeClick:Ru("image")};function g(){return{key:"podcast",title:u("podcast.title"),icon:d.jsx(Qn,{url:LRe,className:"size-6"}),description:u("podcast.description"),testId:"composer-create-podcast-button",onImpression:Mu("podcast"),beforeClick:Ru("podcast"),tags:n!==null&&t===!1?[{label:u("podcast.remainingCalls",{remainingCalls:n.toString()}),color:n>0?"neutral":"accent"}]:void 0}}function v(){return{key:"researchReport",title:u("researchReport.title"),icon:d.jsx(Qn,{url:jRe,className:"size-6"}),description:u("researchReport.description"),testId:"composer-create-research-report-button",onImpression:Mu("researchReport"),beforeClick:Ru("researchReport"),tags:e!==null&&t===!1?[{label:u("researchReport.remainingCalls",{remainingCalls:e.toString()}),color:e>0?"neutral":"accent"}]:void 0}}function y(){return{key:"quiz",title:u("quiz.title"),icon:d.jsx(Qn,{url:DRe,className:"size-6"}),description:u("quiz.description"),testId:"composer-create-quiz-button",onImpression:Mu("quiz"),beforeClick:Ru("quiz")}}function b(){return{key:"actions",title:u("actions.title"),icon:d.jsx(Qn,{url:aB,className:"size-6"}),description:u("actions.description"),testId:"composer-create-actions-button",onImpression:Mu("actions"),beforeClick:Ru("actions"),tags:t===!1?[{label:u("actions.labsTag"),color:"accent"}]:void 0}}return[f,p,s?v():void 0,o?g():void 0,c?y():void 0,a?b():void 0].filter(C=>C!==void 0)},[n,t,u,a,o,s,e,c])}const zB=dt(),Ux=O(null),Fx=O(null);function VB(n){zB.set(Ux,n)}function GB(n){zB.set(Fx,n)}function HRe(n,e){var o;const t={eventInfo_inputLength:n.length};let r=t;const i=Fe(Ux);if(i){const{source:s,type:c,prompt:u}=i;s==="widgets"?r={...t,widget:c,widgetPromptLength:u.length}:r={...t,pill:c,pillPromptLength:u.length}}const a=Fe(Fx);return a&&(r={...r,autoCompleteLength:a.prompt.length}),(e==null?void 0:e.length)!==0&&((o=e==null?void 0:e[0])!=null&&o.scenario)&&(r={...r,uploadFileScenario:e[0].scenario}),JSON.stringify(r)}function $Re(n){const e=Fe(Ux),t=Fe(Fx),r=e==null?void 0:e.prompt.trim(),i=n.trim(),a=t==null?void 0:t.prompt.trim(),o=t==null?void 0:t.prefix.trim(),s=i.toLowerCase()===(a==null?void 0:a.toLowerCase());return!s&&!e?null:s?!r||!i.toLowerCase().includes(r.toLowerCase())?"autoComplete":o&&o.length>r.length?(e==null?void 0:e.source)==="widgets"?"widgetWithTextAndAutoComplete":"pillWithTextAndAutoComplete":(o==null?void 0:o.length)===r.length?(e==null?void 0:e.source)==="widgets"?"widgetWithAutoComplete":"pillWithAutoComplete":"autoComplete":!r||!i.toLowerCase().includes(r.toLowerCase())?null:i.length>r.length?(e==null?void 0:e.source)==="widgets"?"widgetWithText":"pillWithText":(e==null?void 0:e.source)==="widgets"?"widget":"pill"}function zRe(){VB(null),GB(null)}function VRe(n){const{categories:e,onClose:t,selectedCategoryIndex:r,handleCategoryClick:i}=n,{t:a}=Ce(),o=m.useRef(null),s=dy(o,{amount:"all"});return m.useEffect(()=>{s&&nc({page:"chatPage",element:"chatStarterPillCategory",customData:JSON.stringify({visibleItems:e.map(c=>c.id)})})},[s,e]),d.jsx(sF,{onClose:t,className:"px-3",children:d.jsxs("div",{className:"flex w-full flex-col items-center gap-4",ref:o,children:[d.jsx("h1",{className:"mt-2 px-3 text-md-strong",children:a("widgets.categorySelectorModalHeader")}),d.jsx("ul",{className:"flex w-full list-none flex-col items-center",role:"list",children:e.map((c,u)=>d.jsx("li",{className:"w-full",children:d.jsx(Ee,{className:"w-full",variant:"rect",color:"subtle-dimmed-inverted",title:c.label,onClick:()=>i(u),children:d.jsxs("span",{className:"flex w-full items-center justify-between",children:[d.jsx("span",{className:"truncate text-start",children:c.label}),r===u&&d.jsx(Ex,{className:"ms-2 size-4 shrink-0 text-foreground-600 contrast-more:text-current"})]})})},c.id))})]})})}const GRe="contrast-more:outline contrast-more:after:border-2 contrast-more:after:absolute contrast-more:after:pointer-events-none contrast-more:after:w-2/3 contrast-more:after:h-2/3",KRe="text-stone-550 active:text-stone-350 dark:text-slate-400 active:dark:text-slate-450",qRe="bg-white/30 safe-hover:bg-black/3 active:bg-black/2 dark:bg-black/3 dark:safe-hover:bg-white/5 dark:active:bg-white/3",WRe="border-[1px] border-black/8 dark:border-white/8",YRe=`${KRe} ${qRe} ${WRe}`;function KB(n){const{children:e,isSelected:t,className:r,onClick:i,disabled:a,unselectedColorClass:o,variant:s="standard",testId:c}=n,{focusable:u}=ih({autoRestoreFocus:!0,forceFocus:!0});let h;return t?h=nl.strong:s==="flat"?h=YRe:h=nl[o??"overlay-dimmed-inverted"],d.jsx("button",{disabled:a,type:"button",ref:u.ref,className:ke("shadow-none dark:shadow-none",lp,KT["40-base"],qT["40-base"],qw["40-base"],fy,h,r,t&&GRe),onClick:i,"aria-pressed":t,"data-spatial-focus-key":u.focusKey,"data-testid":c,children:e})}function QRe(n){const{text:e,onClick:t,className:r,testId:i}=n;return d.jsx(KB,{isSelected:!1,variant:"flat",className:ke("min-w-fit",r),onClick:t,testId:i,children:d.jsx("span",{className:"px-1 text-xs",children:e})})}const JRe=1e3;function Bx(){var h;const n=!!((h=me.instance().config().landingPage)!=null&&h.enablePromptedGreetings),e=ee("intent-image-gen-prompted-greeting"),t=ee("qa-intent-image-gen-prompted-greeting"),r=ee("intent-f1-prompted-greeting"),i=ee("qa-intent-f1-prompted-greeting"),a=ee("intent-school-prompted-greeting"),o=ee("qa-intent-school-prompted-greeting"),s=ee("conversation-starter-prompted-greeting-c1"),c=ee("qa-conversation-starter-prompted-greeting-c1"),u=ee("qa-conversation-starter-prompted-greeting-debug");return n&&(e||t||r||i||a||o||s||c||u)}function ZRe(){const[n,e]=Je(G3),t=Bx();return m.useEffect(()=>{let r;return t?(e(!1),r=window.setTimeout(()=>{e(!0)},JRe)):e(!1),()=>{r&&clearTimeout(r)}},[e,t]),n}const XRe=(n,e)=>{var t;return!n||e===void 0?null:n.type==="categories"?((t=n.categories[e])==null?void 0:t.items)??[]:n.type==="text"||n.type==="textAndGreeting"?n.items:null};function e2e(n){const{className:e,onWidgetClick:t,pageName:r="chatPage",widgetSource:i,starterPromptsData:a,shouldStackChips:o,shouldCenterChips:s,containerId:c="",selectedCategory:u,onCategoryClick:h}=n,f=m.useRef(null),p=dy(f,{once:!0,amount:"all"}),g=Nn({breakpoint:"sm"});m.useEffect(()=>{p&&nc({page:r,scenario:i,element:"chatStarterPills"})},[p,i,r]);const v=y=>{const{prompt:b,id:C,actionType:S,uri:E,source:T,text:A,index:I}=y;nt({pageName:r,source:i,scenario:C,customData:JSON.stringify({prompt:b,text:A,index:I,category:u==null?void 0:u.id})}),t({actionType:S,id:C,prompt:b,uri:E,source:T})};return d.jsxs(On,{role:"list","aria-label":"",className:ke("flex w-full gap-2 px-1 py-1 sm:flex-wrap sm:py-4",o?"mb-3 flex-col items-end space-y-1 sm:flex-row":"scrollbar-container max-h-[110px] overflow-x-auto overflow-y-hidden",s?"sm:justify-center":"sm:justify-start",e),id:c,ref:f,children:[u&&g&&d.jsx(Ee,{onClick:h,title:u.label,className:"min-w-fit",color:"overlay-dimmed-inverted",children:d.jsxs("span",{className:"flex items-center gap-2",children:[u.label,d.jsx(Xl,{className:"size-4 -rotate-90"})]})}),a.map((y,b)=>{const{id:C,text:S}=y,{type:E}=y.action,T="prompt"in y.action?y.action.prompt:void 0,A="uri"in y.action?y.action.uri:void 0;return d.jsx(QRe,{text:S,onClick:()=>v({prompt:T,uri:A,id:C,actionType:E,source:"pills",text:S,index:b}),className:X(o&&"w-auto min-w-min max-w-[80%] text-start"),testId:`starter-prompt-${C}`},C)})]})}function t2e(n){var b;const{className:e,onWidgetClick:t,pageName:r="chatPage",selectedCategory:i,selectedCategoryIndex:a,onCategoryClick:o}=n,s=N(Vl),c=Bx(),u=N(G3),{isAppearanceOnHomeEnabled:h}=Th(),f=h||(s==null?void 0:s.type)==="categories",p=N(WI),g=(b=me.instance().config().landingPage)==null?void 0:b.stackStarterChipsForSmallScreens;let v="";p?v=p:i&&(v=i.id);const y=XRe(s,a);return c&&!u||!y?null:d.jsx(e2e,{onWidgetClick:t,className:e,pageName:r,starterPromptsData:y,widgetSource:(s==null?void 0:s.source)??"chatStarterPills",shouldStackChips:g,shouldCenterChips:f,containerId:v,selectedCategory:i,onCategoryClick:o})}const n2e=m.lazy(()=>$(()=>import("./starter-prompt-category-B2JvHO2f.js"),__vite__mapDeps([340,1,2])));function r2e(n){const{className:e,onWidgetClick:t,pageName:r="chatPage"}=n,i=N(Vl),a=Nn({breakpoint:"sm"}),[o,s]=Je(Jte),[c,u]=m.useState(!1),h=v=>{var y;v!==o&&(s(v),nt({source:"chatStarterPillCategory",pageName:"chatPage",destination:f?(y=f[v])==null?void 0:y.id:void 0})),u(!1)},f=i&&i.type==="categories"?i.categories.map(v=>({id:v.id,label:v.label})):void 0,p=f&&!a,g=c&&f&&a;return!i||!["text","textAndGreeting","categories"].includes(i.type)?null:d.jsxs("div",{className:ke("mx-auto flex w-full flex-col gap-3 px-2",e),children:[p&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"mt-2 h-8 w-full"}),children:d.jsx(n2e,{categories:f,handleCategoryClick:h,selectedCategoryIndex:o,className:"mt-2"})}),d.jsx(t2e,{onWidgetClick:t,pageName:r,selectedCategory:f?f[o]:void 0,selectedCategoryIndex:o,onCategoryClick:f?()=>u(!0):void 0}),g&&d.jsx(VRe,{categories:f,handleCategoryClick:h,selectedCategoryIndex:o,onClose:()=>u(!1)})]})}const i2e=m.lazy(()=>$(()=>import("./product-purchase-Cp20rw-c.js"),__vite__mapDeps([341,1,2,287,283,318,319,301,320,321,322,323])).then(n=>({default:n.ProductPurchase}))),a2e=64,o2e=8,s2e={opacity:0,translateY:a2e},c2e={opacity:1,scale:1,translateY:0},Pu="size-6",l2e=m.lazy(()=>$(()=>import("./upsell-block-CkGnGMls.js"),__vite__mapDeps([342,1,2,343]))),u2e=m.lazy(()=>$(()=>import("./price-tracking-block-B5K_sYOd.js").then(n=>n.p),__vite__mapDeps([344,1,2,293,345,296,346,299,298])).then(n=>({default:n.PriceTrackingBlock}))),d2e=m.lazy(()=>$(()=>import("./composer-auto-complete-Cy83IhAV.js"),__vite__mapDeps([347,1,2]))),h2e=m.lazy(()=>$(()=>import("./composer-actions-prompt-suggestions-DomfoesL.js"),__vite__mapDeps([348,1,2,349,350,351,352,353,354,355,356,357,358])).then(n=>({default:n.ComposerActionsPromptSuggestions}))),f2e=m.lazy(()=>$(()=>import("./voice-options-DxKAvKoJ.js").then(n=>n.v),__vite__mapDeps([278,1,2,279]))),p2e=m.lazy(()=>$(()=>import("./think-deeper-pro-subscription-hDXfmPU2.js"),__vite__mapDeps([359,1,2]))),m2e=m.lazy(()=>$(()=>import("./over-task-quota-BFOIsIm4.js"),__vite__mapDeps([360,1,2,361])).then(n=>({default:n.OverTaskQuota}))),g2e=m.lazy(()=>$(()=>import("./computer-use-task-closed-Dl3CM-hL.js"),__vite__mapDeps([362,1,2,363,364,365,366,367,368,369,370,371,372,373,361])).then(n=>({default:n.ComputerUseTaskClosed}))),v2e=m.lazy(()=>$(()=>import("./safety-risk-card-CR5qMAr_.js"),__vite__mapDeps([374,1,2,375,361])).then(n=>({default:n.SafetyRiskCard}))),b2e=m.lazy(()=>$(()=>import("./add-to-page-BBg4g_V0.js"),__vite__mapDeps([376,1,2])).then(n=>({default:n.AddToPage}))),y2e=m.lazy(()=>$(()=>import("./cross-selling-strip-consumer-jnqe5IKe.js"),__vite__mapDeps([377,1,2,343]))),C2e=m.lazy(()=>$(()=>import("./composer-prompt-review-Szsl-CCa.js"),__vite__mapDeps([378,1,2,303]))),Rw=m.lazy(()=>$(()=>import("./composer-action-CG02A44b.js"),__vite__mapDeps([361,1,2]))),S2e=m.lazy(()=>$(()=>import("./biometric-consent-DFbXqkYc.js"),__vite__mapDeps([379,1,2])).then(n=>({default:n.BiometricConsent}))),w2e=m.lazy(()=>$(()=>Promise.resolve().then(()=>wEe),void 0)),E2e=m.lazy(()=>$(()=>import("./daily-briefing-chat-DuP34kXl.js"),__vite__mapDeps([380,1,2,381,382])).then(n=>({default:n.DailyBriefingChat}))),T2e=m.lazy(()=>$(()=>import("./composer-sign-in-lfBDodYC.js"),__vite__mapDeps([383,1,2,384]))),I2e=m.lazy(()=>$(()=>import("./daily-briefing-composer-player-ClMn_5OM.js"),__vite__mapDeps([385,1,2,372,367,368,369,370,382])));function A2e(){var M_,R_;const{t:n}=Ce(),{isLivingPortraitEnabled:e}=ZI(),t=ee("image-copy-paste"),r=N(Bl),i=ee("pay-native-checkout"),a=ee("shopping-card"),o=Im(),s=ee("anonymousattachmentupload"),c=ee("onedrive-file-upload"),u=ee("ds-editprompt"),h=ee("ds-new-progress"),f=!Ok(),p=N(P3),g=ee("multi-file-upload"),v=ee("dr-nano-single-file-upload"),y=Jl(),b=Ta(),C=Z3(),S=fMe(),E=Bt(),T=N(En),A=Aa(),I=N(Yo),k=Nn({breakpoint:"sm"}),x=ny({breakpoint:"h760"}),_=ny({breakpoint:"h600"}),R=kC(),z=cCe(),j=Zk(),J=sCe(),[D,F]=m.useState(null),ie=pe(s3),[U,W]=Je(nu),ue=N(vge),te=N(bge),Z=N(rte),Q=N(f3),Ie=N(Xee),Ve=N(HE),[ce,le]=m.useState(!1),De=Ie||ce,{startConversationDisabled:We}=xk(),be=N(qi),[Me,xe]=m.useState(!1),[M,Y]=Je(ri),Se=pe(Epe),[P,ne]=Je(tne),[ye,ae]=Je(ym),q=pe(d3),Te=N(Mo),ze=(Te==null?void 0:Te.type)==="popup",ht=mMe(),vt=ze||ht,Ye=kB(),st=(M_=me.instance().config().composer)==null?void 0:M_.enableAppShadow,{isPlaying:Ot,pause:Yt,resetAllTimers:on}=IB(),In=q_e(),zn=TMe(),V=hMe(),we=fr(),Re=m.useRef(null),Ue=m.useRef(null),Xe=m.useRef(null),mt=m.useRef(null),[qe,K]=m.useState(!1),[oe,ge]=m.useState(null),Le=m.useCallback(ve=>{ge(ve)},[ge]),Ge=m.useCallback(()=>{K(!1)},[K]),ot=ee("imagegenv3"),gt=ee("logged-out-sharing"),ut=ee("remove-prefill-space-after-prompt-cmc"),{isMediaViewerOpen:ft,closeMediaViewer:tr,isPictureInPictureSupported:Vn,triggerPictureInPicture:Rr,showOneLineComposerWhenMediaViewerOpen:An,contentComposerType:Ji,contentPageType:ka}=ts(),{trackConsumptionPageComposerClick:xi,trackConsumptionPageComposerSubmit:du}=D_e(),Pr=Fme(),Nm=Ji===zb.IMAGE_VIEWER,Rh=Ji===zb.CLOSE_BUTTON,Ph=pe(CC),Ln=E.endsWith("/talk"),Gn=E.endsWith("/daily"),hu=ee("1s-dbchat"),Om=ee("db-transcript"),Lm=ee("discover-composer-off"),Zi=NC(),at=Gn||Zi,G=cMe(),je=TC(),Qe=E.startsWith("/chats")&&!Ln,zt=E.startsWith("/shares"),nr=ka==="weather",Fn=N(Df),{login:Sr}=Sh(),pr=M==="dialog",yo=i&&M==="checkout",mr=oMe(),[Nr,Dm]=Je(Cn),[s$,c$]=m.useState(!1),Xi=Ox(),{isCentralComposerEnabled:l$,isAutoSuggestEnabled:u$,isStarterPromptsEnabled:d$,isWidgetSectionEnabled:h$,isAppearanceOnHomeEnabled:f$,overrideUserInputPlaceholderFromWidget:p$}=Th(),{floatingStyles:m$,edgeTabMenuRefs:KC,isMultiTabsMenuExpanded:g$,setIsMultiTabsMenuExpanded:Wx,multiTabsMenuMode:v$,setMultiTabsMenuMode:Yx,handleMentionEvent:b$,handleMultiTabsMenuSaveBtnEvent:Qx,handleMultiTabsMenuCloseBtnEvent:Jx,handleUserInputEnterEvent:y$,handleUserInputKeydownEvent:Zx,isMentionTriggered:Xx,isFetchingTabsPageContext:e_}=L_e(),t_=N(Zbe),Nh=Nr==="computerUse",fu=l$&&(!M||M==="biometric-consent"),n_=u$&&!M&&!Nh,r_=J==="autosuggest"&&n_,i_=m.useId(),C$=N(YI),S$=pe(Tm),w$=d$&&(!M||M==="biometric-consent")&&!Nh&&!C$&&(!_||k),E$=fu&&h$&&!Nh&&!k&&!x,Oh=m.useRef(null),T$=pMe(),I$=!Ln&&!Gn&&!Zi&&!fu&&!yo&&!nr;let a_=!0;const qC=(je||Qe||G||zt)&&(!M||M==="biometric-consent")&&!(ft&&!An);qC&&((R_=me.instance().config().composer)!=null&&R_.disableTextInput)&&(a_=!1);const o_=yo,WC=N(Mk),s_=N(ate),[YC,c_]=Je(Ape),jm=N(kpe);ee("multiple-research-tasks-in-conversation");const pu=ave(),Lh=N(Vr),lc=Lh==="side-by-side"&&(pu==null?void 0:pu.type)==="computerUse"&&Qe,l_=HC(),Um=lc&&!O9(pu.status),Dh=lc&&uve(pu),A$=lc&&dve(pu),k$=!E.endsWith("/agents")&&!Gn&&!G&&!zt&&!f$&&!ft&&!y,Fm=jm&&!0&&!h,u_=Dh||lc||Gn||Fm||ft,x$=m.useCallback(()=>{const ve=[];if(Ue.current){const rt=Ue.current.getTextAreaRef();rt.current&&ve.push(rt)}return ve},[Ue]),d_=!(ft&&!An)&&!Ln&&(!M||M==="daily-briefing-chat"),Bm=Z||!d_||Um||Dh||A$||Fm,[_$,M$]=m.useState(!1),QC=W_e(d_),jh=N(Ipe),as=N(Tpe),[Co,h_]=Je(Q8),JC=xl(),{dismissCoachmark:f_}=lu(Rm),Uh=M==="prompt-sign-in"||M==="prompt-3p-sign-in"||M==="prompt-location"||M==="prompt-review"||M==="confirm-link-navigation"||M==="cross-promo-card"||M==="shopping-upsell-card"||M==="shopping-price-tracking"||M==="add-to-page"||M==="safety-risk-card"||M==="computer-use-task-closed"||M==="over-task-quota"||M==="daily-briefing-chat"||M==="upsell-microsoft-account-for-pro-subscription"||M==="biometric-consent",p_=!Ln&&M!=="daily-briefing-player"&&M!=="audioSettings"&&M!=="reasoning-mode-pro-subscription"&&M!=="checkout"&&!Uh&&!(ft&&!An),R$=m.useCallback(ve=>{Is(ve)},[]),P$=()=>{var rt;const ve=((rt=me.instance().config().composer)==null?void 0:rt.homeButtonState)??"enabled";return ve!=="enabled"?ve:je?"disabled":"enabled"},N$=m.useCallback(()=>{var ve;(ve=Ue.current)==null||ve.focus(),Tc(!0)},[]),O$=m.useCallback(()=>{Xe.current&&(Xe.current.value="")},[]),mu=m.useCallback((ve,rt)=>{W({isOpen:!0,scenario:rt??null,reason:ve})},[W]),L$=m.useCallback(()=>{mu("fileUpload")},[mu]),{processUploadedFiles:m_,processUploadedLocalFiles:os,isUploadingAttachments:D$,uploadedAttachments:gu,resetFileUpload:j$,removeAttachment:ZC}=tMe(N$,Is,O$,L$),U$=N(Jbe),ea=gu.filter(({error:ve})=>!ve),XC=(ea.length>0||QC)&&!Ln,g_=ea.length>0||t_,F$=D$||Xi&&e_,v_=!!(j.trim().length>0||g_)&&!Bm,b_=!!((D&&D.length>0)===!0||F$||De||Ve||j.trim().length===0&&Nr==="computerUse"),B$=ee("file-upload-config"),Fh=N(ac),H$=g&&ea.length>=Fh.maxFilesPerMessage,[$$,z$]=m.useMemo(()=>{const{reason:ve}=U;return ve?[n(`signInPrompt.${ve}Header`,n("signInPrompt.header")),n(`signInPrompt.${ve}Text`,n("signInPrompt.text"))]:[n("signInPrompt.header"),n(gt?"signInPrompt.textV2":"signInPrompt.textV3")]},[gt,U,n]),[y_,V$]=m.useState({onSubmitCallback:null,onCancelCallback:null}),G$=m.useCallback(()=>{var ve;Qx(),(ve=Ue.current)==null||ve.focus()},[Qx]),K$=m.useCallback(()=>{var ve;Xx||(ve=Re.current)==null||ve.focus(),Jx()},[Jx,Xx]),q$=m.useCallback(async()=>new Promise(ve=>{if(Fe(O3)||ea.length===0){ve(!0);return}Y("biometric-consent"),V$({onSubmitCallback:()=>{Y(null),ve(!0)},onCancelCallback:()=>{Y(null),ve(!1)}})}),[ea,Y]),W$=m.useCallback(ve=>{var Jt;if(!Zx(ve)&&ve.key==="ArrowDown"&&(Jt=Ue.current)!=null&&Jt.contains(document.activeElement)&&Oh.current){ve.preventDefault();const Lt=Oh.current.querySelector("button");Lt&&Lt.focus()}},[Zx]),eS=async ve=>{var rt,Jt;if(zt&&await MO(),!v_||!j&&!g_||b_){await eo.onSubmitMessageBlocked();return}if(!(ot&&!await q$())){if(h&&Nr==="research"&&jm){const Lt=Fe(lt);if(Lt){Tf(n("error.researchTaskNotAllowedWhileRunningAnother"),Lt),Dm(ni());return}}f_(),XE(),oz?(Jt=Ue.current)==null||Jt.focus():(rt=Ue.current)==null||rt.blur(),await hz(ve??j)}},Y$=m.useCallback(async()=>{await C()},[C]),tS=N(I9),{launchAudioCall:nS,startAudioCallIfNotStartedAlready:rS,endAudioCall:Bh,toggleAudioInput:Q$,inputVolume:J$,isInputMuted:Z$,isAudioDeepLink:X$,canInitAudio:ez}=kRe({isAudioCall:Ln,onCallTerminated:Y$,onMute:()=>bn({source:"audioCall",scenario:"mute"})});m.useEffect(()=>{ue&&(Y(JC?"prompt-3p-sign-in":"prompt-sign-in"),U.isOpen&&W({...U,isOpen:!1,reason:U.reason??(Z?"overTurnLimit":null)}),Tc(!0))},[Y,W,ue,U,JC,Z]),m.useEffect(()=>{te&&("geolocation"in navigator?setTimeout(()=>{Y("prompt-location"),Tc(!0),br("hasBeenPromptedForLocation","true"),H.trackEvent({name:"interaction",data:{eventName:"locationPrompt",eventInfo_action:"seen"}})},HV):H.trackEvent({name:"system",data:{eventName:"geolocationUnavailable"}}))},[Y,te]),m.useEffect(()=>{at?Y("daily-briefing-player"):vt?(Tc(!0),Y("cross-promo-card")):Y(Dh?"safety-risk-card":Um?"computer-use-task-closed":null)},[Y,vt,Um,Dh,at]);const iS=m.useRef(null),Hm=Vp(ve=>{const rt=document.getElementById("app");rt&&(Se(ve.height),rt.style.setProperty("--composer-container-height",`${ve.height}px`))}),tz=Vp(ve=>{Hm.current&&(ve.height===0?Hm.current.style.removeProperty("--composer-attachments-height"):Hm.current.style.setProperty("--composer-attachments-height",`${ve.height+o2e}px`))}),nz=()=>{Qr(),ne(void 0)},C_=()=>{Me&&(rS(),xe(!1))},Qr=()=>{if(Gn&&M==="daily-briefing-chat"&&(Y("daily-briefing-player"),XE()),M==="prompt-3p-sign-in"&&(Zi||Gn)&&Y("daily-briefing-player"),!(Z||Gn||Zi||Dh)){if(Um){Y("computer-use-task-closed");return}if(pr&&(as!=null&&as.closeDialogCallback)){as.closeDialogCallback();return}M==="prompt-review"&&WMe(Fe(lt),"dismissed"),M==="cross-promo-card"&&Ye(),M==="audioSettings"&&C_(),Y(null),M==="prompt-sign-in"&&U.scenario&&W({isOpen:!1,scenario:null})}},aS=m.useCallback(async()=>{Bh(),Ph("bottom"),e?await b({to:"/labs/portrait",from:E}):await C()},[Bh,Ph,e,b,E,C]);m.useEffect(()=>{me.instance().config().endAudioOnVisibilityHidden&&!s_&&(Ot?Yt==null||Yt():Ln&&aS())},[aS,Ln,Ot,Yt,s_]);const S_={title:n("composer.endAudioCall"),icon:d.jsx(vr,{className:Pu,"aria-hidden":!0}),isVisible:!0,onClick:aS},rz=P_e(),w_=()=>{Gn||Zi?Yt==null||Yt():Ln&&Bh(),xe(!0)},$m=pe(SC),oS=(["chat","reasoning","smart","study"].includes(Nr)||Nr==="research"&&v)&&!lc&&!_$,iz=N(xh),si=Nr==="research"?Fh.document.mimeTypes:iz,az=NU(si);m.useEffect(()=>{for(const[ve,rt]of gu.entries())sx(rt.file,{supportedMimeTypes:si})||ZC(ve)},[si,gu,ZC]);const oz=Yk(),ci=xx(),zm=ci&&(Nr==="chat"||Nr==="smart"||Nr==="research"||Nr==="computerUse"),Hh=ci&&!Ln&&!ft,$h=m.useCallback(()=>{$m(null)},[$m]);m.useEffect(()=>{$h()},[p_,$h]),m.useEffect(()=>{dv(j&&WC?"autosuggest":Nh&&(!j||zm)?"actions-autosuggest":"starter-prompts")},[WC,j,zm,Nh]),fo({onOutsideEvent:()=>{Qr()},elements:[iS],includeScroll:!1,invokeOnce:!1}),fo({onOutsideEvent:Pf,elements:[iS,Oh],includeScroll:!1,invokeOnce:!1});const E_={title:n("composer.closeVoiceSettings"),icon:d.jsx(vr,{className:Pu,"aria-hidden":!0}),isVisible:!0,onClick:x_},Vm={title:n("imageCard.composer.closeImageViewer"),icon:d.jsx(vr,{className:Pu,"aria-hidden":!0}),isVisible:!0,onClick:tr},sS=N(IC),{shareClickHandler:sz}=vMe({messageId:sS==null?void 0:sS.messageId,scenario:"shareAsLinkSingleImage",trackShareClick:()=>q1e({scenario:"shareAsLinkSingleImage",pageName:"imageDetailPage"})}),T_={title:n("imageCard.composer.shareImageViewer"),icon:d.jsx(yB,{className:Pu,"aria-hidden":!0}),isVisible:!0,onClick:sz},I_={title:n("imageCard.composer.downloadImageViewer"),icon:d.jsx(ox,{className:Pu,"aria-hidden":!0}),isVisible:!0,onClick:async()=>{if((Pr==null?void 0:Pr.type)==="image")try{await UU({url:Pr.url,fileName:MB()})}catch(ve){const rt=ve instanceof Error?ve.message:"unknown error on downloading image";nT(rt)}}},cz=ve=>{var Lt;Tc(!0),o&&oU("idle");const{relatedTarget:rt}=ve;((Lt=Oh.current)==null?void 0:Lt.contains(rt))||setTimeout(()=>Pf(),100)},lz=ve=>{n_&&ve&&x9(ve)},A_=m.useCallback(async ve=>{const{actionType:rt,id:Jt,prompt:Lt,uri:li,source:uc}=ve;switch(rt){case"prefillComposer":{if(Lt){Jt&&VB({prompt:Lt,type:Jt,source:uc});const Km=ut?Lt:`${Lt} `;ep({prompt:Km,prefillSource:uc==="widgets"?"widget":"starterPill"})}break}case"sendMessage":{if(Lt)try{le(!0),await eo.submitMessage({text:Lt,inputMethod:"text"})}finally{le(!1)}break}case"deepLink":{li&&li==="copilotn://voiceCall"&&await nS();break}}},[ut,nS]),uz=(ve,rt)=>{GB({prompt:ve,prefix:rt}),eS(ve)},k_=m.useCallback(ve=>{ep({prompt:ve,prefillSource:"promptPassThrough"}),ae(null),q(null)},[ae,q]);m.useEffect(()=>{((ye==null?void 0:ye.source)==="promptInUrl"||(ye==null?void 0:ye.source)==="edgeOnAskCopilot")&&k_(ye.prompt)},[ye,k_]);const cS=m.useCallback((ve,rt)=>{const{scenario:Jt,reasonIfSignInError:Lt}=rt;ve.message==="not-signed-in"?mu(Lt,Jt):Is(DU(ve.message))},[mu]),dz=ee("local-agents"),hz=async ve=>{var uc,Km,P_,N_;const rt=$Re(ve),Jt=HRe(ve,gu),Lt=ve.trim(),li=Nr==="research"&&u?{research:{awaitUserConfirmation:!0}}:void 0;if(M!=="daily-briefing-chat"&&(j$(),Tc(!0),dU(!1),ie(!0),Y(null)),Pf(),dz){if(Lt.startsWith("/agent")){await S();return}if(E.endsWith("/agents"))return}ft&&An?(S$(!0),du()):M!=="daily-briefing-chat"&&!y&&await C();try{le(!0);let ss;In&&(ss=In),zn&&(ss=zn),V&&(ss=V),await eo.submitMessage({text:Lt,filesWithAttachment:gu,inputMethod:"text",scenario:rt??void 0,customData:Jt??void 0,reference:ss,context:li})}catch(ss){if(ss instanceof Error){let O_={};ea.length>0&&(O_={eventInfo_uploadFileSize:((Km=(uc=ea[0])==null?void 0:uc.file)==null?void 0:Km.size)??0,eventInfo_uploadFileType:((N_=(P_=ea[0])==null?void 0:P_.file)==null?void 0:N_.type)??"",eventInfo_numDocumentsUploaded:ea.length}),H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"submitMessage",eventInfo_errorMessage:ss.message,eventInfo_details:"Error submitting message",...O_}}),cS(ss,{reasonIfSignInError:"fileUpload"})}else H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"submitMessage",eventInfo_errorMessage:"Unknown error",eventInfo_details:"Error submitting message"}}),Is({title:n("composer.errors.default.title"),message:n("composer.errors.default.message")})}finally{le(!1),zRe()}},zh=m.useCallback(ve=>{const rt=!we&&!s;return rt&&mu("fileUpload",ve),rt},[we,s,mu]),fz=m.useCallback(()=>{var ve;zh()||(ve=Xe.current)==null||ve.click()},[zh]);m.useEffect(()=>{if(Bm||!t)return()=>{};const ve=async rt=>{const{file:Jt,error:Lt}=aSe(rt);(Jt??Lt)&&(rt.preventDefault(),Lt?cS(Lt,{reasonIfSignInError:"fileUpload"}):Jt&&os({rawFiles:[Jt],scenario:"pasteUpload",replaceExisting:!g,supportedMimeTypes:si}))};return document.addEventListener("paste",ve),()=>document.removeEventListener("paste",ve)},[os,Bm,t,cS,g,si]),m.useEffect(()=>{YC!==null&&(os({rawFiles:[YC],scenario:"fileUpload",replaceExisting:!g,supportedMimeTypes:si}),c_(null))},[YC,os,c_,g,si]),m.useEffect(()=>{oe&&!qe&&(m_({uploads:[{kind:"onedrive",item:oe,file:new File([],oe.name)}],scenario:"fileUpload",replaceExisting:!g,supportedMimeTypes:si}),ge(null))},[oe,ge,qe,m_,g,si]),m.useEffect(()=>{Gn&&on()},[Gn]);function pz(ve){const rt=Array.from(ve.target.files??[]),Jt=rt[0];if(rt.length===0||!Jt)return;os({rawFiles:g?rt:[Jt],scenario:"fileUpload",replaceExisting:!g,supportedMimeTypes:si})}const mz=ve=>{if(!oS||(ve.preventDefault(),zh()))return;$h();const rt=ve.dataTransfer.files[0],Jt=Array.from(ve.dataTransfer.files);rt&&os({rawFiles:g?Jt:[rt],scenario:"fileUpload",replaceExisting:!g,supportedMimeTypes:si})};function x_(){c$(!0),Y(ve=>ve==="audioSettings"?(C_(),null):"audioSettings")}async function gz(){zt&&await MO(),bn({source:"audioCallButton"}),await nS()}m.useEffect(()=>{const ve=rt=>rt==="start"?rS():Bh();return _t.on("composer:request-voice",ve),()=>{_t.off("composer:request-voice",ve)}},[Bh,rS]),m.useEffect(()=>{const ve=()=>{var rt;(rt=Ue.current)==null||rt.focus()};return _t.on("composer:focus-input",ve),()=>{_t.off("composer:focus-input",ve)}},[]);const vz=m.useCallback(()=>{var ve;(ve=Ue.current)==null||ve.focus()},[Ue]),bz=iu(vz),yz=m.useCallback(async()=>{if(zh())return;$h();const{file:ve,error:rt}=await Qfe.run({});ve?os({rawFiles:[ve],scenario:"screenshot",replaceExisting:!g,supportedMimeTypes:si}):rt&&Is(rt)},[$h,zh,os,g,si]),Cz=async()=>{Qr(),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(async ve=>{const{latitude:rt,longitude:Jt,accuracy:Lt}=ve.coords;H.trackEvent({name:"interaction",data:{eventName:"locationPrompt",eventInfo_action:"shared",eventInfo_locationAccuracy:Lt}}),await xr({path:"/user/location",args:{body:{latitude:rt,longitude:Jt,accuracyInMeters:Lt,provider:Lt<100?"gps":"wifi"}}})},ve=>{H.trackEvent({name:"interaction",data:{eventName:"locationPrompt",eventInfo_action:"denied",eventInfo_error:{code:ve.code,message:ve.message}}}),Is({title:n("composer.errors.location.title"),message:n("composer.errors.location.message")})},{enableHighAccuracy:!0})},Sz=bB({from:"/",scenario:"voice"}),wz=()=>{const ve=d.jsx(sa,{className:"end-0",data:S_,children:S_.icon});if(M==="dismiss-audio-call-only")return ve;switch(Fn){case"requires-account":case"signed-out":return d.jsxs(d.Fragment,{children:[ve,d.jsx(kx,{className:"mx-2",title:n("voice.signUpOrLogin"),onClick:Sz})]});case"time-expired-non-pro":case"time-expired-month-non-pro":return d.jsxs(d.Fragment,{children:[ve,rz]});case"time-expired":case"checking-availability":case"error":case"not-in-flight":case"throttled":case"throttled-non-pro":case"region-not-available":case"time-expired-month":case"microphone-denied":case"microphone-not-found":return ve;case"waiting-for-user-interaction":case"available":return d.jsx(_e.div,{className:X(M!=="audioSettings"&&"flex"),children:M==="audioSettings"?d.jsx(sa,{className:"end-0",data:E_,children:E_.icon}):d.jsxs(d.Fragment,{children:[ve,d.jsx(DEe,{className:"mx-2",inputVolume:J$,isMuted:Z$,isOutputPlaying:tS,coachUserUnmute:X$&&!ez&&!s$,onClick:Q$}),!e&&d.jsx(Bg,{children:d.jsx(sa,{className:"start-0",data:{title:n("composer.voiceSettings"),isVisible:!0,onClick:x_},children:d.jsx(Qn,{url:N_e,className:Pu,"aria-hidden":!0})})})]})});default:return Fn}},Ez=()=>ea.length>0?n("userInput.messageRequiredPlaceholderText"):QC?oS?B$?n("userInput.fileUploadLimit",{imageSizeLimit:Fh.image.maxBytes/(1024*1024),documentSizeLimit:Fh.document.maxBytes/(1024*1024),maxCount:Fh.maxFilesPerMessage}):n("userInput.imageDropPreviewPlaceHolderText"):n("userInput.fileDropNotSupportedPlaceHolderText",{chatMode:Up({chatMode:Nr})}):zt?n("userInput.continueConversationInputPlaceholderText"):p!=null&&p.name&&o?n("userInput.characterPlaceholderText",{character:p.name}):Fm?n("research.placeholder"):hu&&Gn?n(M==="daily-briefing-chat"?"userInput.dailyChatInputPlaceholderText":"userInput.dailyComposerInputPlaceholderText"):Xi?n("userInput.placeholderTextWithMention"):p$??n("userInput.placeholderText"),lS=({enableActionButtons:ve})=>{var li;const rt=(li=me.instance().config().composer)==null?void 0:li.smallAttachmentCard,Lt=M==="daily-briefing-player"&&hu&&Gn?"":void 0;return d.jsxs(d.Fragment,{children:[d.jsxs(_e.div,{className:X("w-full",{"mt-2 h-auto min-h-32 px-2":XC&&!Xi&&!rt,"mt-2 h-[58px] px-2":XC&&!Xi&&rt,"h-auto":Xi,"h-0":!XC&&!Xi}),ref:tz,layout:!0,children:[U$&&d.jsx(rRe,{onRemove:ZC,attachments:gu,onVisibilityChange:M$}),Xi&&t_&&d.jsx(_e.div,{className:"z-10 mt-2 w-full px-2","data-testid":"browser-tabs-preview",children:d.jsx(pRe,{onClick:()=>{Yx("update"),Wx(!0)},isLoading:e_})})]}),d.jsx(Jk,{ref:Ue,className:X("w-auto grow",ci&&!Gn&&"mt-1"),disabled:Bm,disabledClassName:Lt,inputValue:j,errorMessage:D,onClick:async()=>{k$&&(je&&nt({source:"composerInput",scenario:"clickNavigateToChat",pageName:"discover"}),await C()),ft&&An&&xi()},onBlur:cz,onChange:uc=>{hU({text:uc,attachments:ea}),f_()},onFocus:lz,onEnter:async()=>{y$()||await eS()},onKeyDown:W$,onMentionIfEnabled:Xi?b$:void 0,setInput:ZE,setError:F,placeholder:Ez(),characterLimit:Q,rightButtons:ve?[d.jsx(bO,{config:__()},"composer-action-button")]:void 0,testId:"composer-input","aria-autocomplete":"both","aria-controls":r_?i_:void 0})]})},__=()=>{if(De||Fm)return{mode:"stop",onClick:eo.stopMessage};if(v_)return{mode:"submit",disabled:b_,onClick:eS};if(!r&&!u_)return{mode:"microphone",onClick:gz}};function Gm(ve){return ve?Wke:qke}function Tz(ve){return ve?Qke:Yke}const Iz=({showChatModeSwitcherButton:ve,homeButtonState:rt,enableInputActionButtons:Jt})=>{const Lt=ci?"to-stone-400/8 from-stone-400/5 dark:from-midnight-800/65 dark:to-midnight-800/65":"from-stone-400/10 to-white/35 dark:from-slate-700/35 dark:to-midnight-800/65";return d.jsx(_e.div,{className:X("relative max-h-full w-expanded-composer max-w-chat bg-gradient-to-b p-1.5",Lt),layout:!0,style:{borderRadius:Gm(Hh),boxShadow:be==="dark"?ZF:JF},ref:KC.setReference,children:d.jsxs(_e.div,{className:X(ci?exe:Xke),layout:!0,style:{borderRadius:Tz(Hh)},children:[d.jsx(_e.div,{className:X(Jke,Zke,QC?"before:opacity-100 before:delay-100 before:duration-200":"before:opacity-0"),layout:!0,onDragOver:li=>li.preventDefault(),onDrop:li=>mz(li),children:lS({enableActionButtons:Jt})}),!Jt&&d.jsxs(_e.div,{className:X("relative bottom-0 flex justify-between pb-0.5",ci?"pe-2.5 ps-1.5":"px-2"),layout:!0,children:[d.jsxs("div",{className:"flex gap-1",children:[d.jsx(Oxe,{state:rt}),d.jsxs("div",{className:ke("flex gap-2",ci&&"items-center"),children:[ve&&d.jsx(Nxe,{disableChatModeSwitcher:!u_}),zm&&d.jsx(FRe,{disabled:De||jm}),ci&&d.jsx(yxe,{disabled:De||jm})]})]}),d.jsxs("div",{className:"flex gap-2",children:[!ci&&d.jsx(bRe,{startNewChatDisabled:We,onStartNewConversation:bz,onSelectFileIfEnabled:oS?fz:void 0,uploadButtonDisabled:H$,onSelectOneDriveFileIfEnabled:(T==null?void 0:T.provider)==="microsoft"&&c?()=>{K(!0),$m(null)}:void 0,onTakeScreenshot:yz,onSelectUserOpenedTabsIfEnabled:Xi?()=>{$m(null),Yx("add"),Wx(!0)}:void 0,onRef:li=>{Re.current=li}}),d.jsx(bO,{config:__()})]})]})]})})},Az=async()=>{U.scenario&&(bn({source:"signin",scenario:U.scenario}),W({isOpen:!1,scenario:null})),JC?await b({from:"/conversations",to:"/login"}):await Sr({provider:"microsoft"})};return!mr||!a_||je&&Lm&&!ft?null:d.jsxs(d.Fragment,{children:[o_&&d.jsx("div",{className:X("fixed inset-0 size-full bg-stone-850/30 backdrop-blur-[10px] dark:bg-midnight-850/70")}),d.jsxs("div",{"data-testid":"composer",ref:Hm,className:X("pointer-events-none absolute bottom-0 flex",fu&&"sm:bottom-1/2 sm:translate-y-1/2 sm:pt-36",$t.composer,Lh==="side-by-side"&&Qe&&A&&!l_&&"mb-2",Lh==="side-by-side"&&Qe&&!l_&&"w-1/4 min-w-chat-side-by-side",Lh==="side-by-side"&&Qe&&"end-0 pe-1",(Lh==="chat-only"||k||!Qe)&&"w-full"),children:[d.jsx("input",{type:"file",accept:az.join(","),className:"hidden",ref:Xe,onChange:pz,"aria-hidden":"true",multiple:g}),d.jsx(Mn,{children:I$&&d.jsx(Oke,{dynamicHeight:M===null&&!je})}),d.jsxs(_e.div,{className:X("relative flex w-full flex-col-reverse items-center px-3 sm:flex-col",fu?"sm:mb-0":"sm:mb-8",st?"mb-3":"mb-4",(Gn||Zi)&&"min-w-72"),initial:f?"enter":!1,animate:"animate",variants:{enter:s2e,animate:c2e},transition:Uk,style:FT,children:[E$&&d.jsx(On,{className:"pointer-events-auto flex h-[250px] w-full max-w-chat justify-center px-2 pb-4",initial:f?"initial":!1,children:d.jsx(oRe,{onWidgetClick:A_})}),d.jsxs(U5,{transition:z?xme:{duration:0},children:[d.jsxs(_e.div,{className:X("relative max-h-full min-h-composer min-w-16 max-w-chat rounded-5xl",Xi&&"z-40",A&&I&&!fu&&!R&&"md:top-2"),children:[o&&p_&&d.jsx(Bke,{}),d.jsx(_e.div,{className:"absolute inset-0",layout:!0,style:{borderRadius:Gm(Hh),boxShadow:IMe(be,ci)}}),d.jsx(Mn,{children:tS&&d.jsx(vO,{})}),d.jsx(_e.div,{className:X("relative",AK),layout:!0,style:{borderRadius:Gm(Hh),boxShadow:AMe(be,ci)},children:d.jsxs(_e.div,{className:X("pointer-events-auto relative flex flex-col overflow-hidden contrast-more:border-2",pr&&"max-w-72",o_&&Ms),"data-testid":"composer-content",ref:iS,layout:!0,style:{borderRadius:Gm(Hh),boxShadow:kMe(be)},children:[d.jsx(Mn,{children:tS&&d.jsx(vO,{isNested:!0})}),d.jsxs(Mn,{children:[M&&M!=="daily-briefing-player"&&M!=="dismiss-audio-call-only"&&d.jsxs(_e.div,{className:X(!pr&&!Uh&&M!=="reasoning-mode-pro-subscription"&&"border-b border-black/10 dark:border-white/10",M==="reasoning-mode-pro-subscription"&&"sm:w-think-deeper-pro-subscription",M==="audioSettings"&&"w-settings",Uh&&M!=="daily-briefing-chat"&&"w-prompt-sign-in",Uh&&(M==="computer-use-task-closed"||M==="safety-risk-card")&&"max-w-single-image",M==="daily-briefing-chat"&&(I?"min-w-chat-side-by-side bp-960:max-w-full lg:w-expanded-composer":"w-expanded-composer")),layout:!0,children:[M!=="dialog"&&d.jsxs(_e.div,{"data-testid":"audio-settings-dialog",className:X("t-custom-scrollbar max-h-expanded-section overflow-auto",M==="audioSettings"&&"px-2 py-4"),layout:!0,initial:ct,animate:{...Rt,transition:{delay:Ei.default}},ref:mt,children:[d.jsx(Mn,{children:Uh&&d.jsxs(Bg,{children:[M==="biometric-consent"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{"aria-hidden":!0}),children:d.jsx(S2e,{onSubmit:y_.onSubmitCallback,onCancel:y_.onCancelCallback})}),M==="prompt-sign-in"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(Rw,{header:$$,text:z$,primaryAction:{title:n("common.loginText"),onClick:Az},testid:"prompt-sign-in-composer-action",secondaryAction:Z?void 0:{onClick:Qr,title:n("common.maybeLater"),testid:"maybe-later-button"},onClose:Qr})}),M==="prompt-3p-sign-in"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(T2e,{dismiss:Qr})}),M==="upsell-microsoft-account-for-pro-subscription"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(w2e,{dismiss:Qr,source:"Composer"})}),M==="daily-briefing-chat"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(E2e,{dismiss:Qr,inputUI:lS({enableActionButtons:!0})})}),M==="prompt-location"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(Rw,{header:n("locationPermission.header"),text:n("locationPermission.text"),primaryAction:{title:n("locationPermission.share"),onClick:Cz},secondaryAction:{onClick:Qr,title:n("common.maybeLater")},onClose:Qr})}),M==="confirm-link-navigation"&&(Co==null?void 0:Co.url)&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(Rw,{showImage:!1,header:n("composer.linkConfirmation.header"),text:n("composer.linkConfirmation.text",{url:Co.url}),primaryAction:{title:n("common.continue"),onClick:()=>{Co.url&&(bn({source:"linkNavigationConfirmButton",conversationId:Co.conversationId,messageId:Co.messageId,destination:tl(Co.url)}),T$(Ls(tl(Co.url))),Qr(),h_(void 0))}},secondaryAction:{onClick:()=>{Qr(),h_(void 0)},title:n("common.cancel")},onClose:Qr,restoreFocusOnUnmount:!0})}),M==="prompt-review"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(C2e,{})}),M==="cross-promo-card"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(y2e,{variant:"aggressive"})}),a&&M==="shopping-upsell-card"&&d.jsx(m.Suspense,{fallback:d.jsx(PO,{}),children:d.jsx(l2e,{onDismiss:()=>Y(null)})}),M==="shopping-price-tracking"&&P&&d.jsx(m.Suspense,{fallback:d.jsx(PO,{}),children:d.jsx(u2e,{content:P.data,messageId:P.messageId,cardType:P.cardType,onConfirm:()=>Y("shopping-upsell-card"),onCancel:nz})}),M==="add-to-page"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(b2e,{onClose:Qr})}),M==="safety-risk-card"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(v2e,{})}),M==="computer-use-task-closed"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(g2e,{})}),M==="over-task-quota"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(m2e,{})})]})}),M==="audioSettings"&&d.jsx(Bg,{children:d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(f2e,{onVoiceSelected:w_,onVoiceSpeedChange:w_})})}),M==="reasoning-mode-pro-subscription"&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(p2e,{})}),yo&&d.jsx(Bg,{children:d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex max-h-expanded-section w-prompt-sign-in flex-col overflow-auto rounded-t-5xl p-5 sm:w-checkout-composer",children:d.jsx("div",{className:"flex h-expanded-composer-fallback items-center justify-center",children:d.jsx(Et,{className:"size-12"})})}),children:d.jsx(i2e,{})})})]}),pr&&jh&&as&&d.jsx(nxe,{titleKey:jh.titleKey,textKey:jh.textKey,buttonTextKey:jh.buttonTextKey,onClick:jh.onClick,button:as.button,cancelButton:as.cancelButton,closeDialogCallback:as.closeDialogCallback})]}),(Gn&&M!=="daily-briefing-chat"||Zi)&&d.jsx(m.Suspense,{fallback:d.jsx("div",{className:ke("flex h-composer items-center justify-center",Om&&Gn?"w-daily-briefing-lg":"w-daily-briefing"),children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(I2e,{isPodcast:Zi,inputUI:hu&&!Zi?lS({enableActionButtons:!1}):void 0})}),Ln&&(!M||M==="audioSettings"||M==="dismiss-audio-call-only")&&d.jsx("div",{className:"flex justify-center p-2",children:wz()}),qC&&Iz({showChatModeSwitcherButton:!ci,homeButtonState:lc||ci?"hidden":P$(),enableInputActionButtons:ft&&An||zm&&lc}),ft&&Rh&&d.jsxs(_e.div,{className:X("relative flex max-h-full max-w-chat justify-center",!M&&"p-2",!pr&&"h-composer"),layout:!0,children:[d.jsx(sa,{data:Vm,children:Vm.icon}),Vn&&d.jsx(m_e,{onClick:Rr})]}),ft&&Nm&&d.jsxs(_e.div,{className:X("relative flex max-h-full max-w-chat justify-center",!M&&"p-2",!pr&&"h-composer"),layout:!0,children:[d.jsx(sa,{data:Vm,children:Vm.icon}),(Pr==null?void 0:Pr.type)==="image"&&Pr.shareable&&d.jsx(sa,{data:T_,children:T_.icon}),(Pr==null?void 0:Pr.type)==="image"&&Pr.downloadable&&d.jsx(sa,{data:I_,children:I_.icon})]}),qe&&d.jsx(PRe,{onPick:Le,onClose:Ge,onError:R$})]})]})})]}),fu&&d.jsxs(On,{id:J,className:X("pointer-events-auto flex h-[150px] w-full max-w-chat flex-none items-end px-2 sm:flex-initial sm:items-start",$t.composerBottomSlot),delay:.2,initial:f?"initial":!1,children:[r_&&d.jsx(m.Suspense,{fallback:null,children:d.jsx(d2e,{id:i_,dataResponse:WC,onClick:(ve,rt)=>uz(ve,rt),onHighlight:ve=>ZE(ve),onDismiss:Pf,className:"mb-3 sm:mb-0 sm:mt-3",ref:Oh})}),J==="actions-autosuggest"&&d.jsx(m.Suspense,{fallback:null,children:d.jsx(h2e,{onClick:ve=>ep({prompt:ve,prefillSource:"action"})})}),J==="starter-prompts"&&w$&&d.jsx(r2e,{className:"sm:mt-8",onWidgetClick:A_})]}),Xi&&g$&&qC&&d.jsx(p_e,{onSave:G$,styles:m$,onRef:KC.setFloating,onClose:K$,outsideClickElements:x$(),mode:v$,originElement:KC.reference})]})]})]})]})}function k2e(n){const{isChecked:e,label:t,description:r,className:i,onChange:a,accessory:o,disabled:s,testId:c}=n,u=m.useId(),[h,f]=m.useState(!1),p=()=>f(!0),g=()=>f(!1),{focusable:v}=ih({autoRestoreFocus:!0,forceFocus:!0});let y=e?"bg-system-green-400":"bg-black/20 dark:bg-white/20";return s&&(y="bg-black/20 after:bg-white/40 dark:bg-white/20 dark:after:bg-black/40"),d.jsxs("label",{className:X("flex items-center justify-between gap-4",!s&&"cursor-pointer",i),htmlFor:u,ref:v.ref,"data-testid":c,children:[d.jsxs("div",{className:"flex flex-1 flex-col",children:[d.jsx("span",{className:"text-foreground-800 text-sm",children:t}),r&&d.jsx("span",{className:"font-medium text-foreground-450 text-xs",children:r})]}),d.jsxs("span",{className:"flex flex-row items-center gap-2",children:[o,d.jsx("input",{id:u,type:"checkbox",title:t,checked:e,onChange:b=>a(b.target.checked),onFocus:p,onBlur:g,className:"sr-only",disabled:s}),d.jsx("div",{className:X("relative h-6 w-10 rounded-full","after:absolute after:start-[2px] after:top-[2px] after:size-5 after:rounded-full after:transition-all contrast-more:forced-color-adjust-none",y,!s&&"after:bg-white after:shadow-switch after:hover:scale-110 after:active:w-6",e&&"after:translate-x-4",e&&!s&&"after:active:translate-x-3",h&&"outline")})]})]})}function x2e(){const n=Ai("kill-cookie-banner"),e=N(_r),[t,r]=Je(zI),[i,a]=m.useState("main"),o=_l(),[s,c]=m.useState(()=>o.analytics),[u,h]=m.useState(o.advertising),[f,p]=m.useState(o.socialMedia),g=AC(e),v=!!uI(),[y,b]=Je(v9),C=!n&&(!!y||g&&!v&&!t);if(m.useEffect(()=>{C&&H.trackEvent({name:"system",data:{eventName:"cookieBannerShown",eventInfo_region:e}})},[e,C]),!C)return null;const S=T=>{H.trackEvent({name:"interaction",data:{eventName:"cookieBannerChoice",eventInfo_analytics:T.analytics,eventInfo_advertising:T.advertising,eventInfo_socialMedia:T.socialMedia}}),Qq(T),a("main"),b(void 0),r(!0)},E=y==="more-options";return d.jsxs("div",{className:"pointer-events-none absolute inset-x-0 top-0 flex w-full justify-center p-3",children:[d.jsx("div",{className:"absolute top-0 h-3.5 w-full bg-stone-150 opacity-90 dark:bg-midnight-850"}),d.jsx("div",{className:X("relative w-full max-w-cookie-banner rounded-xl border border-black/5 shadow-xl dark:border-black/40",Ea,$t.modal),children:d.jsxs("div",{className:"pointer-events-auto relative max-h-[90vh] overflow-auto p-5",id:"cookie-banner",children:[y!=="more-options"&&i==="main"&&d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsx("h3",{className:"text-md",children:re("cookies.heading")}),d.jsxs("div",{className:"flex flex-col gap-x-8 gap-y-6 text-2xs sm:flex-row",children:[d.jsxs("div",{className:"flex flex-col gap-x-5 gap-y-4 text-2xs sm:flex-row",children:[d.jsx("p",{children:re("cookies.bannerIntro")}),d.jsxs("p",{children:[re("cookies.bannerExplanation"),d.jsx(to,{href:Xd,title:re("cookies.privacyLink"),className:"ps-1 underline",children:re("cookies.privacyLink")})]})]}),d.jsxs("div",{className:"flex min-w-44 shrink-0 grow flex-col gap-2",children:[d.jsx(Ee,{variant:"rect",size:"32-xs",onClick:()=>S({analytics:!0,advertising:!0,socialMedia:!0}),title:re("cookies.accept"),testId:"cookie-banner-accept-button",children:re("cookies.accept")}),d.jsx(Ee,{variant:"rect",size:"32-xs",onClick:()=>S({analytics:!1,advertising:!1,socialMedia:!1}),title:re("cookies.reject"),testId:"cookie-banner-reject-button",children:re("cookies.reject")}),d.jsx(Ee,{variant:"rect",color:"subtle-dimmed",size:"32-xs",onClick:()=>{a("more-options")},title:re("cookies.moreOptions"),testId:"cookie-banner-options-button",children:re("cookies.moreOptions")})]})]})]}),(y==="more-options"||i==="more-options")&&d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{className:"flex items-center",children:[!E&&d.jsx(Ee,{title:re("common.backText"),variant:"circle",color:"subtle-dimmed",size:"32-xs",onClick:()=>a("main"),children:d.jsx(Xl,{className:"rotate-180"})}),d.jsx("h3",{className:X({"ps-3":!E},"text-md"),children:re("cookies.moreOptionsHeading")})]}),d.jsx("p",{className:"py-3 text-2xs",children:re("cookies.essentialCookiesExplanation")}),d.jsx(Pw,{label:re("cookies.advertisingLabel"),explanation:re("cookies.advertisingDescription"),isChecked:u,onChange:()=>h(T=>!T),testId:"cookie-banner-advertising-option"}),d.jsx(Pw,{label:re("cookies.analyticsLabel"),explanation:re("cookies.analyticsDescription"),isChecked:s,onChange:()=>c(T=>!T),testId:"cookie-banner-analytics-option"}),d.jsx(Pw,{label:re("cookies.socialMediaLabel"),explanation:re("cookies.socialMediaDescription"),isChecked:f,onChange:()=>p(T=>!T),testId:"cookie-banner-social-option"}),d.jsx("div",{className:"flex justify-end",children:d.jsx(Ee,{variant:"rect",size:"36-sm",className:"w-fit px-7",onClick:()=>{S({analytics:s,advertising:u,socialMedia:f})},title:re("cookies.savePreferences"),testId:"cookie-banner-save",children:re("cookies.savePreferences")})})]})]})})]})}function Pw(n){const{label:e,explanation:t,isChecked:r,onChange:i,testId:a}=n;return d.jsxs(d.Fragment,{children:[d.jsx(eh,{horizontalMargin:!1}),d.jsx(k2e,{label:e,className:"w-full py-2 pe-1",isChecked:r,onChange:i,testId:a}),d.jsx("p",{className:"pb-4 pt-1 text-2xs",children:t})]})}function _2e(){const[n,e]=m.useState(!0),t=N(Mo),r=kB(),i=m.useMemo(()=>t==null?void 0:t.images,[t]),a=m.useMemo(()=>({title:t==null?void 0:t.title,subTitle:t==null?void 0:t.subTitle}),[t]),s=N(qi)==="dark"?i==null?void 0:i.dark:i==null?void 0:i.light,c=a;m.useEffect(()=>{sd({name:"interaction",status:"Shown",eventName:"crossPromotionStripCard",source:"bottomRightCard"})},[]);const u=()=>{e(!1),r()};return t===null||!n?null:d.jsx(On,{mode:"sync",className:"fixed bottom-5 end-5 z-[1000]",children:d.jsxs("div",{className:X("flex h-32 w-96 flex-col justify-center rounded-5xl border border-white bg-background-100 p-3 dark:border-white/5 dark:bg-background-250"),children:[d.jsxs("div",{className:"flex items-center",children:[s&&d.jsx("img",{src:s,alt:re("crossSelling.imageAlt"),className:"size-24 rounded-lg object-cover"}),d.jsxs("div",{className:"me-6 ms-3",children:[d.jsx("div",{className:"mb-1 text-sm",children:d.jsx("strong",{children:c.title})}),d.jsx("div",{className:"text-sm",children:c.subTitle})]})]}),d.jsx("div",{className:"absolute end-1.5 top-1.5 flex self-start",children:d.jsx(Ee,{title:re("common.closeText"),variant:"square",color:"subtle-dimmed","aria-label":re("common.closeText"),onClick:u,className:"flex size-8 items-center justify-center p-1.5",children:d.jsx(vr,{className:"m-0 size-5 self-center p-0"})})})]})})}function UO({icon:n,text:e,buttonText:t,buttonColor:r,buttonOnClick:i,className:a=""}){return d.jsxs("div",{className:X("flex items-center justify-between",a),children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"flex size-10 items-center justify-center rounded-[8.5px] border border-black/10 bg-background-200 dark:border-white/10",children:d.jsx("div",{className:"m-1 size-6",children:n})}),d.jsx("p",{className:"text-base",children:e})]}),d.jsx(Ee,{className:"h-10 w-24",color:r,title:t,"aria-label":t,variant:"rect",onClick:i,children:t})]})}const qB=n=>m.createElement("svg",{viewBox:"0 0 192 192",xmlns:"http://www.w3.org/2000/svg",fill:"none",...n},m.createElement("circle",{cx:96,cy:96,r:74,stroke:"currentColor",strokeWidth:12}),m.createElement("ellipse",{cx:96,cy:96,stroke:"currentColor",strokeWidth:12,rx:30,ry:74}),m.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:12,d:"M28 72h136M28 120h136"})),G7e=Object.freeze(Object.defineProperty({__proto__:null,default:qB},Symbol.toStringTag,{value:"Module"})),M2e="https://ercz.adj.st/home?network=1g17o7tz&campaign=1gl0zo0u&adj_t=1gl0zo0u&adj_deep_link=sapphirecopilot%3A%2F%2Fhome%3Fnetwork%3D1g17o7tz%26campaign%3D1gl0zo0u&adj_redirect_android=https%3A%2F%2Fplay.google.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dcom.microsoft.copilot&adj_redirect_ios=https%3A%2F%2Fapps.apple.com%2Fus%2Fapp%2Fmicrosoft-copilot%2Fid6472538445%3Fct%3DCMC_Copilot_ContinueChatting%26pt%3D80423";function R2e(){const n=Yk(),e=FL(),t=UL(),r=fW(),i=m.useRef(null),[a,o]=m.useState(!1),s=N(Oy),c=N(Gl),u=N(h3);m.useEffect(()=>{if(!u||!s||c||n||t||r||!e){o(!1);return}const p=Pn(cM),g=Pn(AS),v=!qb(p,3*Iv),y=qk(g,3);v||y?(o(!0),sd({name:"system",status:"Shown",eventName:"copilotMobileCrossSelling"})):sd({name:"system",status:"TriggeredButSnoozed",eventName:"copilotMobileCrossSelling"})},[c,n,t,r,s,u,e]);const h=()=>{br(cM,Date.now().toString());const p=Pn(AS);br(AS,`${parseInt(p??"0",10)+1}`),o(!1),sd({name:"interaction",status:"Dismissed",eventName:"copilotMobileCrossSelling"})},f=()=>{tu(M2e),o(!1),sd({name:"interaction",status:"Clicked",eventName:"copilotMobileCrossSelling"})};return a?d.jsx(On,{mode:"sync",className:X("relative",$t.modal),children:d.jsx("div",{className:"fixed inset-0 grid bg-stone-850/30 dark:bg-midnight-850/70",children:d.jsx("div",{ref:i,className:"mb-0 h-fit w-full self-end justify-self-center rounded-t-3xl border border-white/10 bg-background-200 p-2 contrast-more:border-2 md:mb-5 md:w-fit md:rounded-3xl",children:d.jsxs("div",{className:"mx-3 mb-6 mt-3 flex flex-col gap-4",children:[d.jsx("div",{className:"text-md md:text-center",children:re("crossSelling.header")}),d.jsx(UO,{icon:d.jsx(kh,{}),text:re("crossSelling.copilotApp"),buttonText:re("common.open"),buttonColor:"strong",buttonOnClick:f,className:"gap-14"}),d.jsx(UO,{icon:d.jsx(qB,{}),text:re("crossSelling.browser"),buttonText:re("common.continue"),buttonColor:"subtle-bright",buttonOnClick:h,className:"gap-14"})]})})})}):null}const WB=n=>m.createElement("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("g",{id:"Dots Horizontal"},m.createElement("path",{id:"Shape",d:"M5 8C5 8.55229 4.55228 9 4 9C3.44772 9 3 8.55229 3 8C3 7.44772 3.44772 7 4 7C4.55228 7 5 7.44772 5 8ZM9 8C9 8.55229 8.55229 9 8 9C7.44772 9 7 8.55229 7 8C7 7.44772 7.44772 7 8 7C8.55229 7 9 7.44772 9 8ZM12 9C12.5523 9 13 8.55229 13 8C13 7.44772 12.5523 7 12 7C11.4477 7 11 7.44772 11 8C11 8.55229 11.4477 9 12 9Z",fill:"currentColor"}))),K7e=Object.freeze(Object.defineProperty({__proto__:null,default:WB},Symbol.toStringTag,{value:"Module"}));function P2e(n){const{className:e}=n,{t}=Ce(),[r,i]=m.useState(!1),a=C9(),o=pe(Yo),s=m.useRef(null),c=m.useCallback(u=>{s.current=u},[]);return d.jsx(RC,{isOpen:r,onIsOpenChange:i,renderTrigger:u=>d.jsx(Ee,{ref:h=>{u.ref(h),c(h)},onClick:u.onClick,color:"subtle-dimmed-inverted",variant:"square",size:"28-xxs",title:t("edgeHeader.dropdownMenuButtonTitle"),className:"ms-auto",testId:"header-dropdown","aria-haspopup":"menu","aria-expanded":r,children:d.jsx(WB,{className:"size-5"})}),options:{overrideZIndex:$t.header,placement:"bottom-end",offset:{mainAxis:4,crossAxis:0},hideOnMenuClick:!0},className:ke(Ea,"flex p-1",e),children:d.jsxs(cc,{axis:"vertical",className:"flex flex-col items-start gap-1",role:"menu",circular:!0,children:[a&&d.jsx(Ee,{variant:"rect",color:"subtle-dimmed-inverted",className:"w-full justify-start text-sm",onClick:()=>{o(!0),nt({source:"sidebarHeader"})},title:t("edgeHeader.conversationHistory"),testId:"header-conversation-history-button",role:"menuitem",children:t("edgeHeader.conversationHistory")}),d.jsx(Ee,{variant:"rect",color:"subtle-dimmed-inverted",className:"w-full justify-start text-sm",onClick:u=>{u.stopPropagation(),o(!1),Ope("menu",{onPopPageCallback:()=>{var h;(h=s.current)==null||h.focus()}})},title:t("settings.settings"),testId:"header-settings-button",role:"menuitem",children:t("settings.settings")}),d.jsx(Ee,{variant:"rect",color:"subtle-dimmed-inverted",className:"w-full justify-start text-sm",onClick:()=>{_t.emit("edge:header-command","sendFeedback")},title:t("settings.feedbackButton"),testId:"header-feedback-button",role:"menuitem",children:t("settings.feedbackButton")})]})})}const YB=n=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M16.2425 2.93189L21.0682 7.75765C22.3955 9.08491 22.0324 11.3224 20.3535 12.1619L15.4826 14.5973C15.3073 14.685 15.1732 14.8379 15.1092 15.0232L13.6699 19.1895C13.3684 20.0622 12.2574 20.3181 11.6045 19.6653L8.50002 16.5607L4.06074 21.0001H3L3.00008 19.9394L7.43936 15.5001L4.33487 12.3956C3.682 11.7427 3.93791 10.6317 4.81061 10.3302L8.97688 8.89096C9.16223 8.82694 9.31512 8.69287 9.40281 8.51748L11.8382 3.6466C12.6777 1.96772 14.9152 1.60462 16.2425 2.93189ZM20.0076 8.81831L15.1818 3.99255C14.5785 3.38924 13.5614 3.55429 13.1799 4.31742L10.7445 9.18829C10.4814 9.71446 10.0227 10.1167 9.46666 10.3087L5.67812 11.6175L12.3826 18.322L13.6914 14.5335C13.8835 13.9774 14.2857 13.5188 14.8118 13.2557L19.6827 10.8202C20.4458 10.4387 20.6109 9.42161 20.0076 8.81831Z",fill:"currentColor"})),q7e=Object.freeze(Object.defineProperty({__proto__:null,default:YB},Symbol.toStringTag,{value:"Module"})),QB=n=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M3.28035 2.21967C2.98746 1.92678 2.51258 1.92677 2.21968 2.21966C1.92678 2.51255 1.92677 2.98742 2.21967 3.28032L8.12461 9.18526L4.81064 10.3301C3.93794 10.6315 3.68202 11.7426 4.3349 12.3954L7.43942 15.4999L3.00009 19.9392L3.00001 20.9999H4.06077L8.50009 16.5605L11.6046 19.665C12.2575 20.3179 13.3686 20.062 13.67 19.1893L14.8148 15.8755L20.7196 21.7803C21.0125 22.0732 21.4874 22.0732 21.7803 21.7803C22.0732 21.4874 22.0732 21.0126 21.7803 20.7197L3.28035 2.21967ZM13.6353 14.696L12.3827 18.3218L5.67816 11.6174L9.30412 10.3648L13.6353 14.696ZM19.6829 10.8201L15.8957 12.7137L17.0137 13.8317L20.3537 12.1617C22.0326 11.3223 22.3957 9.08476 21.0684 7.75751L16.2426 2.93179C14.9153 1.60453 12.6778 1.96763 11.8383 3.6465L10.1684 6.98637L11.2864 8.10441L13.18 4.31731C13.5616 3.55419 14.5786 3.38914 15.1819 3.99244L20.0078 8.81817C20.6111 9.42146 20.446 10.4385 19.6829 10.8201Z",fill:"currentColor"})),W7e=Object.freeze(Object.defineProperty({__proto__:null,default:QB},Symbol.toStringTag,{value:"Module"}));function N2e(n){const{isPinned:e,showCloseButton:t,showPinButton:r,className:i}=n,{t:a}=Ce();return d.jsxs("div",{className:ke("flex items-center",i),"data-testid":"header-controls",children:[d.jsx(P2e,{}),r&&d.jsx(Ee,{variant:"square",color:"subtle-dimmed-inverted",size:"28-xxs",onClick:()=>{_t.emit("edge:header-command","togglePinState")},title:a(e?"edgeHeader.unpinButtonTitle":"edgeHeader.pinButtonTitle"),testId:"header-pin-button",children:e?d.jsx(QB,{className:"size-5"}):d.jsx(YB,{className:"size-5"})}),t&&d.jsx(Ee,{variant:"square",color:"subtle-dimmed-inverted",size:"28-xxs",onClick:()=>{_t.emit("edge:header-command","closePane")},title:a(e?"edgeHeader.closeButtonAsPinnedTitle":"edgeHeader.closeButtonAsUnpinnedTitle"),testId:"header-close-button",children:d.jsx(vr,{className:"size-5"})})]})}function O2e({pixelUrl:n,onComplete:e}){return m.useEffect(()=>{const t=setTimeout(()=>{e()},3e3);return()=>{clearTimeout(t)}},[n,e]),d.jsx("img",{className:"hidden",src:n,width:"1",height:"1",alt:"",referrerPolicy:"no-referrer-when-downgrade",onLoad:e,onError:e})}function L2e(){const n=ee("ads-pixels"),[e,t]=Je(g3),r=N(zI),i=N(_r),a=(i&&hy.includes(i))===!0,o=m.useMemo(()=>_l(),[r]),s=!a||o.advertising;if(!n||!s)return null;const c=Object.values(e).filter(u=>u.isMounted).map(u=>u.url);return d.jsx("div",{className:"absolute start-[-9999px] top-[-9999px] size-px overflow-hidden",children:c.map(u=>d.jsx(O2e,{pixelUrl:u,onComplete:()=>t(h=>h[u]?{...h,[u]:{...h[u],isMounted:!1}}:h)},u))})}const mf=typeof HTMLElement<"u"&&"showPopover"in HTMLElement.prototype&&typeof HTMLElement.prototype.showPopover=="function";function D2e(){const n=m.useRef(null),e=m.useCallback(()=>{const i=n.current;if(i&&mf)try{i.showPopover()}catch(a){Zn({feature:"toast",scenario:"showPopoverToast",errorMessage:a instanceof Error?a.message:void 0})}},[]),t=m.useCallback(()=>{const i=n.current;if(i&&mf)try{i.hidePopover()}catch(a){Zn({feature:"toast",scenario:"hidePopoverToast",errorMessage:a instanceof Error?a.message:void 0})}},[]),r=eT(()=>{t(),e()},50);return m.useEffect(()=>{if(e(),mf){const i=requestAnimationFrame(()=>{r()});return()=>cancelAnimationFrame(i)}return()=>{}},[e,r]),m.useEffect(()=>{if(!mf)return()=>{};const i=new MutationObserver(()=>{document.querySelectorAll("dialog[open]").length>0&&requestAnimationFrame(r)});return i.observe(document.documentElement,{childList:!0,subtree:!0,attributeFilter:["open"]}),()=>i.disconnect()},[r]),{toastRef:n,supportsPopover:mf}}function j2e({onClick:n}){return d.jsx("div",{className:"absolute end-0 top-0 z-10 p-1 rtl:right-auto",children:d.jsx(Ee,{title:re("product.dismiss"),"aria-label":re("product.dismiss"),variant:"rect",color:"subtle-bright-inverted",size:"32-xs",onClick:n,children:d.jsx(vr,{className:"size-4"})})})}const U2e=["overflow-hidden","rounded-3xl","border","border-solid","border-white/20","shadow-lg","backdrop-blur-[30px]","bg-acrylic-default-tint-light/95","dark:bg-acrylic-default-tint-dark/95"];function F2e(n){const{title:e,subtitle:t,dismiss:r,link:i,dismissable:a=!0,className:o,Icon:s,iconClassName:c,isRTL:u,onClick:h,onActiveChange:f,customColorTheme:p,intent:g="info"}=n,v=N(qi),y=p??v,[b,C]=m.useState(!1),[S,E]=m.useState(!1),T=b||S,{toastRef:A,supportsPopover:I}=D2e();m.useEffect(()=>{f==null||f(T)},[T,f]);const k=t??i?d.jsxs(d.Fragment,{children:[typeof t=="string"?`${t} `:t,i&&d.jsx("span",{className:"font-sans font-normal leading-5 text-accent-450 underline text-sm dark:text-accent-600",role:"button",tabIndex:0,"aria-label":i,children:i})]}):null,x="top-5 start-1/2 -translate-x-1/2",_=me.instance().config(),R=(I?_.toastPopoverNotificationPositioning:_.toastNotificationPositioning)??x,z=I?{popover:"manual"}:{};return d.jsx("div",{"data-theme":y,className:ke("pointer-events-none",I?"fixed m-0 overflow-visible bg-transparent":"absolute",$t.toastNotification,R,o),onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),onFocus:()=>E(!0),onBlur:()=>E(!1),ref:A,...z,children:d.jsx(Mn,{children:d.jsxs(_e.div,{className:X("pointer-events-auto","relative",U2e,h&&"cursor-pointer"),initial:{opacity:0,y:-40,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-40,scale:.98},transition:{type:"spring",stiffness:400,damping:30},onClick:h,children:[a&&d.jsx(j2e,{onClick:r}),d.jsx("div",{className:X("flex","flex-col","items-center","justify-center","py-2","ps-2","pe-1.5",{"w-[min(381px,100vw)]":!!k}),children:d.jsxs("div",{className:X("relative flex w-full items-center p-0",{"gap-x-3":s,"flex-row-reverse":s&&u}),children:[s&&d.jsx("div",{className:"flex size-16 shrink-0 items-center justify-center rounded-xl border border-black/10 dark:border-white/10",children:d.jsx(s,{className:c})}),d.jsxs("div",{className:X("flex flex-1 flex-col justify-center py-1",{"ps-4":!s&&k,"pe-10":a&&(k??e),"px-4":!k}),children:[d.jsx("header",{className:X("flex w-full overflow-hidden",{"items-center":!!k,"items-center justify-center":!k}),children:d.jsx("h2",{className:X("font-sans text-foreground-750 text-sm-strong",{"text-base-strong":!!k,"text-sm":!k},g==="error"&&"text-system-red-550"),children:e})}),k&&d.jsx("p",{className:"w-full font-sans font-normal leading-5 text-foreground-700 text-sm",children:k}),d.jsx(Tl,{msg:`${e??""} ${typeof t=="string"?t:""}`,type:"assertive"})]})]})})]})},e)})}function B2e(){const[n,e]=Je(Ia),t=wh(),[r,i]=m.useState(!1),[a,o]=m.useState(!1),s=m.useCallback(()=>{n!=null&&n.trackingArgs&&nt({source:"toastNotification",scenario:n.trackingArgs.scenario,customData:n.trackingArgs.customData})},[n]),c=m.useCallback(()=>{e(null)},[e]),u=m.useCallback(()=>{var f;if(!(n!=null&&n.action))return;s();const{action:h}=n;h(),c(),(f=n.onClick)==null||f.call(n)},[n,s,c]);return m.useEffect(()=>{let h;return o(!1),i(!1),n!=null&&n.dismissAfter&&(h=window.setTimeout(()=>o(!0),n.dismissAfter)),()=>clearTimeout(h)},[n]),m.useEffect(()=>{a&&!r&&c()},[a,r,c]),n?d.jsx(F2e,{title:n.title,subtitle:n.subtitle,link:n.link,dismissable:n.dismissable,className:n.className,Icon:n.iconProvider??n.Icon,iconClassName:n.iconClassName,intent:n.intent,dismiss:h=>{var f;h==null||h.stopPropagation(),(f=n.onDismiss)==null||f.call(n),c()},isRTL:t,onClick:n.action?u:void 0,onActiveChange:i,customColorTheme:n.customColorTheme}):null}function H2e(){var i;const n=ee("top-banner-upgrade-surface-app"),e=(i=me.instance().config().uiOverrides)==null?void 0:i.showUpgradeAppTopBanner,t=n&&e;m.useEffect(()=>{t&&H.trackEvent({name:"system",data:{eventName:"upgradeSurfaceApp",eventInfo_status:"Shown"}})},[t]);const r=()=>{H.trackEvent({name:"interaction",data:{eventName:"upgradeSurfaceApp",eventInfo_status:"Clicked"}}),tu("macappstore://apps.apple.com/app/id6738511300")};return t?d.jsxs("div",{className:"pointer-events-none absolute inset-x-0 top-0 flex w-full justify-center p-3",children:[d.jsx("div",{className:"absolute top-0 h-3.5 w-full bg-stone-150 opacity-90 dark:bg-midnight-850"}),d.jsx("div",{className:X("relative w-full max-w-cookie-banner rounded-xl border border-black/5 shadow-xl dark:border-black/40",Ea,$t.modal),children:d.jsx("div",{className:"pointer-events-auto relative max-h-[90vh] overflow-auto p-5",id:"cookie-banner",children:d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsx("h3",{className:"text-md",children:re("upgradeSurface.heading")}),d.jsxs("div",{className:"flex flex-col gap-x-8 gap-y-6 text-2xs sm:flex-row",children:[d.jsxs("div",{className:"flex flex-col gap-x-5 gap-y-4 text-2xs sm:flex-row",children:[d.jsx("p",{children:re("upgradeSurface.primaryDescription")}),d.jsx("p",{children:re("upgradeSurface.secondaryDescription")})]}),d.jsx("div",{className:"flex min-w-44 shrink-0 grow flex-col justify-center gap-2",children:d.jsx(Ee,{variant:"rect",size:"32-xs",onClick:r,title:re("upgradeSurface.buttonText"),children:re("upgradeSurface.buttonText")})})]})]})})})]}):null}const $2e=m.lazy(()=>$(()=>Promise.resolve().then(()=>ax),void 0)),z2e=m.lazy(()=>$(()=>import("./settings-wrapper-CuzgNwki.js"),__vite__mapDeps([386,1,2,295,276]))),V2e=m.lazy(()=>$(()=>import("./media-viewer-Bp7TRql3.js").then(n=>n.m),__vite__mapDeps([387,1,2,388,389])).then(n=>({default:n.MediaViewer}))),G2e=m.lazy(()=>$(()=>import("./picture-in-picture-Dn4A5EJf.js"),__vite__mapDeps([390,1,2,369,370,391,392,393,394,395])).then(n=>({default:n.PictureInPicture}))),K2e=m.lazy(()=>$(()=>import("./composer-large-screen-DPfyTO3a.js"),__vite__mapDeps([396,1,2,279,397])));function q2e(n){const{children:e,sidebar:t,customLayout:r}=n,i=Bt(),{isPictureInPictureOpen:a}=g9(),o=me.instance().config().appLayout,s=N(Mo),c=(s==null?void 0:s.type)==="card",u=N(EU),h=$Ce(),f=N(RCe),p=HCe();return d.jsxs(d.Fragment,{children:[p&&d.jsx("div",{className:ke("pointer-events-none sticky top-0 w-full",$t.header),children:d.jsx("div",{className:"pointer-events-auto absolute end-2 top-2",children:d.jsx(N2e,{isPinned:f,showCloseButton:u,showPinButton:h})})}),d.jsxs(_Ce,{sidebar:t,children:[r?e:d.jsxs(rx,{className:"flex-1",children:[e,d.jsx(JB,{}),d.jsx(ZB,{}),d.jsx(XB,{})]}),d.jsx(B2e,{}),a&&d.jsx(m.Suspense,{fallback:d.jsx(YCe,{}),children:d.jsx(G2e,{})})]}),o.showMobileCrossSelling&&i.startsWith("/chats")&&!i.endsWith("/talk")&&d.jsx(R2e,{}),c&&d.jsx(_2e,{}),o.showCookieBanner&&d.jsx(x2e,{}),d.jsx(H2e,{}),d.jsx(kEe,{}),d.jsx("div",{id:"inAppFeedbackOcv"}),d.jsx("div",{id:"popoverPortal"}),d.jsx(L2e,{})]})}function JB(){const{isMediaViewerOpen:n}=ts();return n?d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"pointer-events-auto absolute inset-0 flex items-center justify-center",children:d.jsx($2e,{type:"spinnerThemed",className:"size-12"})}),children:d.jsx(V2e,{})}):null}function ZB(){const n=UCe(),e=FCe();return d.jsxs(d.Fragment,{children:[n&&d.jsx(A2e,{}),e&&d.jsx(m.Suspense,{fallback:null,children:d.jsx(K2e,{})})]})}function XB(){const n=me.instance().config().appLayout,e=BCe({showSettings:n.showSettings,showSettingsRelyOnChatDetailLayout:n.showSettingsRelyOnChatDetailLayout}),t=Aa();return e?d.jsx(m.Suspense,{fallback:null,children:d.jsx(z2e,{className:X("top-6",t&&"-me-1 -mt-3")})}):null}function W2e(){const{t:n}=Ce(),e=N(U3);let t="main";Pn(a1)&&e==="permanent"&&(t="confirm-submission");const[r,i]=m.useState(t),[a,o]=m.useState(""),[s,c]=m.useState(!1),u=!a||a.trim().length===0||s,h=e==="permanent"?n("composer.userBan.permanent"):n("composer.userBan.temporary",{duration:n(e==="1-hr"?"composer.userBan.duration1Hr":"composer.userBan.duration24Hr")}),f=n(e==="permanent"?"composer.userBan.banMessagePermanent":"composer.userBan.banMessageTemporary"),p=async()=>{if(!u){bn({source:"submitBanAppeal"}),c(!0);try{await xr({path:"/user/bans/appeal",args:{body:{appealText:`APPEAL: ${a}`}}}),i("confirm-submission"),br(a1,new Date().toISOString())}catch(g){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"submitBanAppeal",eventInfo_errorMessage:`${g}`,eventInfo_details:"Error submitting ban appeal"}})}c(!1)}};return d.jsxs("main",{className:"relative size-full",children:[d.jsx(eu,{forceGradient:!0}),d.jsxs(On,{id:r,className:"relative z-10 m-auto flex h-dvh max-w-[540px] flex-col items-center justify-center gap-3 p-12 text-center",children:[r==="main"&&d.jsxs(d.Fragment,{children:[d.jsx("h1",{className:"text-3xl",children:h}),d.jsx("p",{children:f}),e==="permanent"&&d.jsx(Ee,{color:"strong",size:"56-xl",className:"mt-6 w-full",title:n("composer.userBan.submitAppeal"),onClick:()=>i("submit-appeal"),children:n("composer.userBan.submitAppeal")}),d.jsx(Tl,{msg:`${h}. ${f}`})]}),r==="submit-appeal"&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex w-full items-center pb-4",children:[d.jsx(Ee,{variant:"square",color:"subtle-dimmed-inverted",size:"32-xs",title:n("common.backText"),onClick:()=>i("main"),children:d.jsx(Em,{className:"size-5 -rotate-90"})}),d.jsx("h2",{className:"grow pe-8",children:n("composer.userBan.submitAppeal")})]}),d.jsx("textarea",{className:"h-[240px] w-full resize-none rounded-xl bg-background-100 p-4 placeholder:text-foreground-650 contrast-more:border-2 dark:text-white",onChange:g=>o(g.target.value),disabled:s,placeholder:n("composer.userBan.submitAppealPlaceholder")}),d.jsx(Ee,{color:"strong",className:"w-full",size:"56-xl",title:n("common.submitText"),onClick:p,disabled:u,children:n("common.submitText")})]}),r==="confirm-submission"&&d.jsxs(d.Fragment,{children:[d.jsx("h1",{className:"text-3xl",children:n("composer.userBan.appealSubmitted")}),d.jsx("p",{children:n("composer.userBan.appealSubmittedDescription")}),d.jsx(Tl,{msg:`${n("composer.userBan.appealSubmitted")}, ${n("composer.userBan.appealSubmittedDescription")}`})]})]})]})}class Y2e{generateClientEventId(e){if(this.shouldLogForEventName(e.data.eventName))return crypto.randomUUID()}onBeforeTrackEvent(e){this.logEventIfNeededNonBlocking(e,"prepared")}eventsSent(e){for(const t of e)this.logEventIfNeededNonBlocking(t,"success")}eventsDiscarded(e,t){for(const r of e)this.logEventIfNeededNonBlocking(r,this.getStatusFromDiscardedReason(t))}logEventIfNeededNonBlocking(e,t){this.logEventIfNeeded(e,t).catch(()=>{})}async logEventIfNeeded(e,t){var r,i,a,o,s,c,u,h;this.shouldLogForEventName((r=e.data)==null?void 0:r.eventName)&&await wa("/client-telemetry",{options:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:(i=e.data)==null?void 0:i.eventInfo_clientEventId,eventName:(a=e.data)==null?void 0:a.eventName,status:t,retryCount:"sendAttempt"in e?e.sendAttempt:0,appInfoName:(o=e.data)==null?void 0:o.appName,userId:(s=e.data)==null?void 0:s.userPicassoId,userMuid:(c=e.data)==null?void 0:c.userMuid,conversationId:(u=e.data)==null?void 0:u.eventInfo_conversationId,messageId:(h=e.data)==null?void 0:h.eventInfo_messageId,isSdkInitialized:!0,clientTimestamp:e.time??new Date().toISOString()})}})}getStatusFromDiscardedReason(e){switch(e){case 1:return"nonRetryableStatus";case 2:return"invalidEvent";case 3:return"sizeLimitExceeded";case 4:return"killSwitch";case 5:return"queueFull";default:return"unknown"}}shouldLogForEventName(e){switch(e){case"copilotCompose":case"copilotResponseRender":case"copilotStart":return!0;default:return!1}}}const Q2e=.05,J2e=.1;function Z2e(){return me.instance().config().sentryDsnOverride??"https://323dd84fb4f632ccd95493debe9312e0@o4508134825000960.ingest.us.sentry.io/4508799962644480"}async function X2e(){const n=await $(()=>import("./vendor-BYCmmfc5.js").then(i=>i.am),__vite__mapDeps([1,2]));if(Ir("kill-sentry"))return;const t=[n.browserTracingIntegration(),n.tanstackRouterBrowserTracingIntegration(uu)],r=[];n.init({dsn:Z2e(),release:qq(),sampleRate:J2e,environment:"production",integrations:[...t,...r],tracesSampleRate:Q2e,profilesSampleRate:0}),n.setTag("surface","cmc")}function ePe(n){const e=N(_r);m.useEffect(()=>{H.ensureInitialized(tPe()),n&&(window.appEnd=performance.now(),performance.mark("startupTime-begin",{startTime:window.appStart}),performance.mark("startupTime-end",{startTime:window.appEnd}),performance.measure("startupTime","startupTime-begin","startupTime-end"),X2e().catch(console.error))},[n]),m.useEffect(()=>{n&&e&&setTimeout(()=>{rd("onPageLoad")},1e3)},[n,e])}function tPe(){return()=>$e("picasso-telemetry")?new Y2e:null}function nPe(){const n=N(M3),e=m.useRef(!1);m.useEffect(()=>{n&&!e.current&&(H.trackEvent({name:"system",data:{eventName:"copilotStart",eventInfo_duration:window.appEnd-window.appStart,eventInfo_landingPage:H.getLandingPage()}}),e.current=!0)},[n])}function rPe(n){m.useEffect(()=>(document.addEventListener("visibilitychange",n),()=>{document.removeEventListener("visibilitychange",n)}),[n])}function iPe(){rPe(()=>{document.visibilityState==="visible"?H.trackEvent({name:"system",data:{eventName:"copilotVisible",eventInfo_landingPage:H.getLandingPage()}}):H.trackEvent({name:"system",data:{eventName:"copilotBackground"}})})}function eH(){return dr(c1,l.boolean().nullable())===!0}function aPe(){return dr(NL,l.boolean().nullable())===!0}function oPe(){return dr(Mv,l.boolean().nullable())===!0}function sPe(){return uu.state.location.pathname==="/login"}function tH(n){for(const e of n)if(e.tenantId===Tv)return e;return n[0]}function op(n){return ua(n)?"AAD":"MSA"}function cPe(){const[n,e]=m.useState(!1),t=pe(En),r=pe(la),i=N(E4);return m.useEffect(()=>{if(n||eH())return;function o(c){var u;if(c===null){t(null),H.setUserAccountType(void 0);return}t({id:((u=c.idTokenClaims)==null?void 0:u.oid)??"",tenantId:c.tenantId,provider:"microsoft",accountType:op(c.tenantId)}),H.setUserAccountType(op(c.tenantId))}async function s(){try{const{msal:c}=await Er.get();H.trackEvent({name:"system",data:{eventName:"copilotMsalInit",eventInfo_initTrigger:"hook",eventInfo_timing:performance.now()-window.appStart}}),e(!0);const{monitorAccountChangesAcrossTabs:u,enableAuth0:h}=me.instance().config();u&&c.enableAccountStorageEvents(),c.addEventCallback(async f=>{if(H8(f),(f.eventType===de.LOGIN_SUCCESS||f.eventType===de.ACQUIRE_TOKEN_SUCCESS)&&f.payload&&"account"in f.payload&&f.payload.account){const{account:p}=f.payload,g=c.getActiveAccount();(!g||g.homeAccountId!==p.homeAccountId)&&(c.setActiveAccount(p),o(p))}else if(f.eventType===de.LOGOUT_SUCCESS){const p=tH(c.getAllAccounts());c.setActiveAccount(p??null),o(p??null)}else f.eventType===de.ACCOUNT_ADDED?r({reason:"login"}):f.eventType===de.ACCOUNT_REMOVED&&r({reason:"logout"})}),h&&u&&Ff.addEventListener("message",f=>{const p=i3.safeParse(f.data);if(!p.success)return;const{eventName:g}=p.data;g==="auth0.accountAdded"?r({reason:"login"}):g==="auth0.accountRemoved"&&r({reason:"logout"})})}catch(c){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"MsalInitError",eventInfo_details:"hook",eventInfo_errorMessage:c instanceof Error?c.message:""}})}}s().catch(console.error)},[n,r,t]),i===!0?i:n}async function lPe(){const n=dt();async function e(){return await Wo.instance().getAccountFromProviders()!==null}function t(){return aPe()?!oPe():!1}function r(a){var o;if(a===null){n.set(En,null),H.setUserAccountType(void 0);return}n.set(En,{id:((o=a.idTokenClaims)==null?void 0:o.oid)??"",tenantId:a.tenantId,provider:"microsoft",accountType:op(a.tenantId)}),H.setUserAccountType(op(a.tenantId))}async function i(){try{me.instance().config().enableAuth0&&await Ni.get();const{msal:a}=await Er.get();H.trackEvent({name:"system",data:{eventName:"copilotMsalInit",eventInfo_initTrigger:"DCL",eventInfo_timing:performance.now()-window.appStart}});const o=Kre();a.addEventCallback(async f=>{if(H8(f),o){f.eventType===de.ACCOUNT_ADDED?n.set(la,{reason:"login"}):f.eventType===de.ACCOUNT_REMOVED&&n.set(la,{reason:"logout"});return}if((f.eventType===de.LOGIN_SUCCESS||f.eventType===de.ACQUIRE_TOKEN_SUCCESS)&&f.payload&&"account"in f.payload&&f.payload.account){const{account:p}=f.payload,g=a.getActiveAccount();(!g||g.homeAccountId!==p.homeAccountId)&&(Ds({authWorkflowAccountType:"microsoft",apiName:"msal:differentAccountLogin",extraInfo:{eventInfo_eventType:f.eventType}}),a.setActiveAccount(p),r(p))}else if(f.eventType===de.LOGOUT_SUCCESS){const p=tH(a.getAllAccounts());a.setActiveAccount(p??null),r(p??null)}else f.eventType===de.ACCOUNT_ADDED?n.set(la,{reason:"login"}):f.eventType===de.ACCOUNT_REMOVED&&n.set(la,{reason:"logout"})});let s=!1;if(M1()){const f=Wo.instance();await f.initAuthAccount(),s=!!await f.getAccountFromProviders()}else s=await e();n.set(E4,!0);const{monitorAccountChangesAcrossTabs:u,enableAuth0:h}=me.instance().config();if(u&&a.enableAccountStorageEvents(),!s&&t()){const f=performance.now();try{const p=await a.ssoSilent($K),g=performance.now()-f,v=op(p.account.tenantId)==="MSA";v||X0({message:"SSO Silent returned an AAD account",errorCode:"unexpected_account_type"}),ca(Mv,l.boolean(),!0),sPe()&&X0({message:"User is on login page, skipping account update",errorCode:"sso_on_login_page"}),v?(a.setActiveAccount(p.account),r(p.account),qfe({accountUpdate:!0,accountType:"MSA",message:"Account set by MSAL silent SSO",duration:g}),_t.emit("auth:account-set-by-msal-sso")):await a.logoutRedirect({account:p.account,onRedirectNavigate:()=>!1})}catch(p){X0({message:p instanceof Error?p.message:"Unknown error",errorCode:p instanceof Mt?p.errorCode:""})}}h&&u&&Ff.addEventListener("message",f=>{const p=i3.safeParse(f.data);if(!p.success)return;const{eventName:g}=p.data;g==="auth0.accountAdded"?n.set(la,{reason:"login"}):g==="auth0.accountRemoved"&&n.set(la,{reason:"logout"})})}catch(a){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"MsalInitError",eventInfo_details:"DCL",eventInfo_errorMessage:a instanceof Error?a.message:""}})}}return i()}function uPe(){const n=sW(),e=pe(om);n&&(r=>kW.includes(r))(n)&&e(n)}function dPe(){const n=N(En),e=ee("account-change-chat-reset");m.useEffect(()=>{e&&Wk()},[n,e])}function hPe(){_B({onStartComplete:()=>{n()}});const n=()=>{try{const t="n59ae4ieqq";if(Ir("kill-clarity")||!e(t))return()=>{};window.clarity||(window.clarity=function(...o){window.clarity&&(window.clarity.q=window.clarity.q??[]).push(o)});const i=document.createElement("script");return i.type="text/javascript",i.async=!0,i.src=`/cl/tag/${t}`,document.body.appendChild(i),window.clarity("signal",async a=>{if(a.type==="cl_dtrs"&&a.value){const o=$e("clarity-http-endpoint"),s=Fe(lt);try{if(o)await xr({path:"/clarity/signal",args:{body:{token:a.value,conversationId:s}}});else{const{sendChallengeResponse:c}=await go();c({method:"clarity",token:a.value,conversationId:s})}H.trackEvent({name:"system",data:{eventName:"copilotFeatureSuccess",eventInfo_feature:"Clarity",eventInfo_scenario:`Clarity signal event sent via ${o?"API":"WebSocket"}`,eventInfo_customData:JSON.stringify(a)}})}catch(c){H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"ClaritySignalError",eventInfo_details:`Failed to send clarity via ${o?"API":"WebSocket"}`,eventInfo_errorMessage:c instanceof Error?c.message:"Unknown clarity signal error"}})}}}),window.clarity("metadata",()=>{$E({surface:"cmc"});const a=Fe(B3);a!==null&&$E({isNewUser:a.toString()})},!1,!0),()=>{delete window.clarity,i.remove()}}catch(t){return H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"useClarity",eventInfo_details:"Error loading Clarity",eventInfo_errorMessage:`${t}`}}),()=>{}}},e=t=>t.trim()!==""}function Nw(n){if(me.instance().config().persistThemeChoice){const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";n!==t?(br(Ps,n),Pv(Ps,n)):(ur(Ps),LL(Ps))}document.documentElement.setAttribute("data-theme",n),_t.emit("theme:color-applied",n)}function fPe(){const n=Dd(Ps),e=Pn(Ps);return n??e??null}function pPe(){const{persistThemeChoice:n,enforceTheme:e}=me.instance().config(),[t,r]=Je(qi);m.useEffect(()=>{const i=window.matchMedia("(prefers-color-scheme: dark)"),a=s=>{const c=s.matches?"dark":"light";r(c),Nw(c),n&&(ur(Ps),LL(Ps))};let o=n?fPe():"";return o!=="dark"&&o!=="light"&&(o=i.matches?"dark":"light"),e&&(o=e),r(o),Nw(o),i.addEventListener("change",a),()=>{i.removeEventListener("change",a)}},[r,n,e]),m.useEffect(()=>{t&&Nw(t)},[t])}const mPe={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshInterval:Lx};function gPe(n){return function(t){return Tn(t,MX,n?{query:{"api-version":"2"}}:void 0).then(r=>r.data)}}function Ra(n){return Array.isArray(n)?Li(n):{positive:Li(n.positive),negative:Li(n.negative)}}function Li(n){const e=n,t=e.slice(0,-1),r=e.slice(-1);return[...Uke(t),...r]}function vPe(n){return{newsArticle:Li(n.newsArticle),newsVideo:Li(n.newsVideo),newsGem:Li(n.newsGem),chat:Li(n.chat),dailyBriefing:Li(n.dailyBriefing),podcast:Li(n.podcast),default:Li(n.default)}}function bPe(){const n=ee("adspositivefeedbacksurvey"),e=ee("discover-feedback-shuffle"),t=ee("file-upload-config"),r=gPe(n),{data:i,mutate:a}=Zl("/config",r,mPe),o=pe(Ry),s=pe(l3),c=pe(f3),u=pe(kbe),h=pe(xbe),f=pe(_be),p=pe(UI),g=pe(FI),v=pe(u3),y=pe(ac),b=pe(nte);xB(a),m.useEffect(()=>{if(i){if(o(i.voices),s(i.signInPrompts),c(i.maxTextMessageLength),u(i.maxPageContentLength),f(i.pageLimit),h(i.maxPageTitleLength),i.characters&&g(i.characters),i.feedbackOptions.text=Li(i.feedbackOptions.text),i.feedbackOptions.image=Li(i.feedbackOptions.image),i.feedbackOptions.discover&&e&&(i.feedbackOptions.discover=vPe(i.feedbackOptions.discover)),i.feedbackOptions.card.local=Ra(i.feedbackOptions.card.local),i.feedbackOptions.card.ads=Ra(i.feedbackOptions.card.ads),i.feedbackOptions.card.video=Ra(i.feedbackOptions.card.video),i.feedbackOptions.card.image=Ra(i.feedbackOptions.card.image),i.feedbackOptions.card.shopping=Ra(i.feedbackOptions.card.shopping),i.feedbackOptions.card.recipe=Ra(i.feedbackOptions.card.recipe),i.feedbackOptions.card.sports=Ra(i.feedbackOptions.card.sports),i.feedbackOptions.card.finance=Ra(i.feedbackOptions.card.finance),i.feedbackOptions.card.quiz=Ra(i.feedbackOptions.card.quiz),i.feedbackOptions.card.weather=Ra(i.feedbackOptions.card.weather),p(i.feedbackOptions),v(i.messagePreview),t){const C=I=>{const k={};for(const x of I)x in Uo&&Uo[x]&&(k[x]=Uo[x]);return k},S=C(i.attachments.image.mimeTypes),E=C(i.attachments.document.mimeTypes),T=Fe(PU),A=(I,k)=>({maxBytes:I.maxBytes??k.maxBytes,mimeTypes:Object.keys(I.mimeTypes??{}).length?I.mimeTypes??{}:k.mimeTypes});y({maxFilesPerMessage:i.attachments.maxFilesPerMessage||T.maxFilesPerMessage,image:A({maxBytes:i.attachments.image.maxBytes,mimeTypes:S},T.image),document:A({maxBytes:i.attachments.document.maxBytes,mimeTypes:E},T.document)})}b(i.portraits??[])}},[i,s,o,c,u,h,p,g,f,v,y,t,b,e])}function yPe(){m.useEffect(()=>{if(window.ReportingObserver===void 0)return()=>{};const n=new ReportingObserver(e=>{for(const t of e){if(t.type!=="csp-violation"||!t.body)continue;const{body:r}=t,{blockedURL:i,documentURL:a,effectiveDirective:o,disposition:s}=r;console.error("Reporting CSP violation",{blockedURL:i,documentURL:a,effectiveDirective:o,disposition:s}),H.trackEvent({name:"system",data:{eventName:"copilotCSPViolation",eventInfo_blockedURL:i,eventInfo_documentURL:a,eventInfo_effectiveDirective:o,eventInfo_disposition:s}})}},{buffered:!0,types:["csp-violation"]});return n.observe(),()=>{n.disconnect()}},[])}function CPe(){const n=ee("custom-1ds"),e=N(_r);m.useEffect(()=>{if(!n||!me.instance().config().enableCustom1DS)return jL(),()=>{};if(!e)return()=>{};const t=()=>{if(window.oneDS){const{ApplicationInsights:a}=window.oneDS;return new a}},r=()=>{var c;window.OneDsAzureAnalytics=window.OneDsAzureAnalytics??t();function a(){var h;return!!!((h=window.OneDsAzureAnalytics)!=null&&h.getCookieMgr().get("MSCC"))}const o={adobe:a(),google:a()},s={instrumentationKey:"c72e6b24df604532a6282edd268b4ba4-9cdee1fe-5d2f-4626-9620-dbad9b53a8e5-8065",channelConfiguration:{eventsLimitInMem:50,autoFlushEventsLimit:1},propertyConfiguration:{userConsentCookieName:Ty.name,gpcDataSharingOptIn:DL(),callback:{userConsentDetails:()=>{if(!hy.includes(e))return{Required:!0,Analytics:!0,SocialMedia:!0,Advertising:!0};const u=_l();return{Required:Object.values(u).includes(!0),Analytics:u.analytics,SocialMedia:u.socialMedia,Advertising:u.advertising}}}},webAnalyticsConfiguration:{coreData:{appId:"JS:Copilot_microsoft_com"},cookiesToCollect:["_mkto_trk"],urlCollectQuery:!0,syncMuid:a()},extensionConfig:{IdSyncPlugin:o}};window.postConsAzure1DSInit||((c=window.OneDsAzureAnalytics)==null||c.initialize(s,[]),window.postConsAzure1DSInit=!0)},i=document.createElement("script");return i.src="https://az416426.vo.msecnd.net/scripts/c/ms.analytics-web-4.min.js",i.async=!0,i.onload=r,document.head.appendChild(i),()=>{document.head.removeChild(i)}},[n,e])}function SPe(n){const{handler:e}=TU({deferred:!0}),{handler:t}=kU({deferred:!0}),{passthroughType:r,prompt:i}=xU(),a=m.useCallback(c=>{H.setLandingPage("chatWithPartialPromptPassthrough"),e(c)},[e]),o=m.useCallback(c=>{H.setLandingPage("chatWithFullPromptPassthrough"),t(c)},[t]),s=m.useCallback(()=>{if(i&&r)switch(r){case"partial":a(i);break;case"full":o(i);break}},[o,a,r,i]);m.useEffect(()=>{n&&s()},[n,s])}function wPe(){const n=Bt(),e=m.useRef(!1),t=N(hr),[r,i]=Je($l),a=_4();m.useEffect(()=>{n.startsWith("/chats")&&Rn("appearance-talk")==="1"&&(e.current=!0)},[n]),m.useEffect(()=>{a&&t&&e.current&&(e.current=!1,i(im))},[t,e,r,i,a])}function EPe(){const n=N(lt),e=N(M3),t=ee("adsidsync"),r=N(_r),i=fr(),a=AC(r),o=N(zI),s=Jl();m.useEffect(()=>{const{adsEnabled:c,enforceAdsOptOutOfPersonalization:u}=me.instance().config(),h=c&&!s;if(n&&e&&t){const f=uI(),g=_l().advertising;if(H.trackEvent({name:"system",data:{eventName:"copilotAdsSignal",eventInfo_scenario:"syncAdvertisingId",eventInfo_conversationId:n,eventInfo_additionalData:JSON.stringify({isAdsEnabled:h,isAdPersonalizationEnabled:g,isAuthenticated:i,isGdprPlusRegion:a,isChoiceCookieEmpty:!f})}}),!h)return;const v=new URLSearchParams;if(v.append("cpid",e),v.append("cvid",n),i&&v.append("cp","1"),f){if(a&&!g)return;g&&!u?v.append("ps","1"):v.append("ps","0")}else{if(a)return;v.append("ps","1")}const y=`https://c.bing.com/cp?${v}`,b=performance.now();fetch(y,{method:"GET",mode:"no-cors",credentials:"include"}).then(C=>{const S=performance.now();R4(y,"GET",S-b,C.clone())}).catch(C=>{H.trackEvent({name:"system",data:{eventName:"copilotWebError",eventInfo_errorType:"adsError",eventInfo_errorMessage:"Ads Id Sync failed with error",eventInfo_details:`Ads Id Sync failed: ${C}`}})})}},[o,n,r,a,t,e,i,s])}function TPe(n){const e=N(En),t=N(Oy),r=N(jy),i=N(zl),a=N(Dy),{upsellFromAuth0:o}=me.instance().config().proSubscription,c=fr()&&(e==null?void 0:e.provider)==="microsoft",u=ee("cmc-m365-sku"),h=yp("shouldStartSubscription"),f=yp("parsedPayflowEntryPoint")??"Unknown",p=Bt(),g=m.useRef(!1),{handleSubscription:v}=ty({payflowEntryPoint:f,skuType:a?"FreeTrial":"1Mo-Paid",upsellReason:"",entryStyle:"Redirect"});m.useEffect(()=>{if(h&&u&&c&&!p.startsWith("/subscription/start")){kM("shouldStartSubscription"),setTimeout(()=>{v()},0);return}if(!(o!=null&&o.navigateToProSubPageAfterLogin))return;const y=sessionStorage.getItem(Ww);if(!y)return;async function b(C){const[,S]=C.split("-");if(S==="link"){const E=performance.now(),{getAuth0AccessToken:T,auth0:A}=await Ni.get(),I=await T(up);if(!I){Zn({feature:"accountLinkAuth0WithMSA",errorType:"LinkStartedWithoutAuth0Token"});return}try{await xr({path:"/user/link",args:{body:{token:I}}})}catch(k){k instanceof Error&&Zn({feature:"accountLinkAuth0WithMSA",errorType:k.name,errorMessage:k.message,exception:k.stack})}finally{A.logout({openUrl:!1}),zo({feature:"accountLinkAuth0WithMSA",duration:performance.now()-E}),i||await v()}}}if(n&&!g.current&&t){if(g.current=!0,sessionStorage.removeItem(Ww),kM("parsedPayflowEntryPoint"),(e==null?void 0:e.accountType)!=="MSA"||r)return;b(y)}},[n,v,o,e,i,r,t,p,c,u,h])}function IPe(n){const{isEnabled:e,onIntercept:t}=n;m.useEffect(()=>{if(!e)return()=>{};const r=o=>Z8(o)?(t(o.toString()),!0):!1,i=o=>{const s=o.target.closest("a");s&&s instanceof HTMLAnchorElement&&r(s.href)&&o.preventDefault()},a=window.open;return window.open=function(...s){return s.length>0&&typeof s[0]=="string"&&!r(s[0])?a.apply(window,s):null},document.addEventListener("click",i),()=>{window.open=a,document.removeEventListener("click",i)}},[e,t])}function APe(){m.useEffect(()=>{const n=Pn(o1),e=Date.now();n||br(o1,e.toString())},[])}function kPe(){m.useEffect(()=>{},[])}function xPe(n){const[e,t]=m.useState(!1),r=c9();return m.useEffect(()=>{e||!n||r({enablePageRedirect:!0,overwriteData:!1}).then(i=>{i&&t(!0)}).catch(console.error)},[r,e,n]),m.useEffect(()=>{const i=()=>{r({enablePageRedirect:!1,overwriteData:!0,eventDriven:!0}).catch(console.error)};return _t.on("auth:account-set-by-msal-sso",i),()=>{_t.off("auth:account-set-by-msal-sso",i)}},[r]),{appInitialized:e}}let nH=-1;const Pm=n=>{addEventListener("pageshow",e=>{e.persisted&&(nH=e.timeStamp,n(e))},!0)},Zs=(n,e,t,r)=>{let i,a;return o=>{e.value>=0&&(o||r)&&(a=e.value-(i??0),(a||i===void 0)&&(i=e.value,e.delta=a,e.rating=((s,c)=>s>c[1]?"poor":s>c[0]?"needs-improvement":"good")(e.value,t),n(e)))}},rH=n=>{requestAnimationFrame(()=>requestAnimationFrame(()=>n()))},Hx=()=>{const n=performance.getEntriesByType("navigation")[0];if(n&&n.responseStart>0&&n.responseStart<performance.now())return n},zC=()=>{const n=Hx();return(n==null?void 0:n.activationStart)??0},Xs=(n,e=-1)=>{const t=Hx();let r="navigate";return nH>=0?r="back-forward-cache":t&&(document.prerendering||zC()>0?r="prerender":document.wasDiscarded?r="restore":t.type&&(r=t.type.replace(/_/g,"-"))),{name:n,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:r}},Ow=new WeakMap;function iH(n,e){return Ow.get(n)||Ow.set(n,new e),Ow.get(n)}const VC=(n,e,t={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(n)){const r=new PerformanceObserver(i=>{Promise.resolve().then(()=>{e(i.getEntries())})});return r.observe({type:n,buffered:!0,...t}),r}}catch{}},aH=n=>{let e=!1;return()=>{e||(n(),e=!0)}};let cd=-1;const FO=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,ay=n=>{document.visibilityState==="hidden"&&cd>-1&&(cd=n.type==="visibilitychange"?n.timeStamp:0,_Pe())},BO=()=>{addEventListener("visibilitychange",ay,!0),addEventListener("prerenderingchange",ay,!0)},_Pe=()=>{removeEventListener("visibilitychange",ay,!0),removeEventListener("prerenderingchange",ay,!0)},oH=()=>{var n;return cd<0&&(cd=(document.prerendering||(n=globalThis.performance.getEntriesByType("visibility-state").filter(t=>t.name==="hidden")[0])==null?void 0:n.startTime)??FO(),BO(),Pm(()=>{setTimeout(()=>{cd=FO(),BO()})})),{get firstHiddenTime(){return cd}}},GC=n=>{document.prerendering?addEventListener("prerenderingchange",()=>n(),!0):n()},HO=[1800,3e3],MPe=(n,e={})=>{GC(()=>{const t=oH();let r,i=Xs("FCP");const a=VC("paint",o=>{for(const s of o)s.name==="first-contentful-paint"&&(a.disconnect(),s.startTime<t.firstHiddenTime&&(i.value=Math.max(s.startTime-zC(),0),i.entries.push(s),r(!0)))});a&&(r=Zs(n,i,HO,e.reportAllChanges),Pm(o=>{i=Xs("FCP"),r=Zs(n,i,HO,e.reportAllChanges),rH(()=>{i.value=performance.now()-o.timeStamp,r(!0)})}))})};let sH=0,Lw=1/0,$g=0;const RPe=n=>{for(const e of n)e.interactionId&&(Lw=Math.min(Lw,e.interactionId),$g=Math.max($g,e.interactionId),sH=$g?($g-Lw)/7+1:0)};let yT;const $O=()=>yT?sH:performance.interactionCount??0,PPe=()=>{"interactionCount"in performance||yT||(yT=VC("event",RPe,{type:"event",buffered:!0,durationThreshold:0}))};let zO=0;class NPe{constructor(){B(this,"u",[]);B(this,"l",new Map);B(this,"m");B(this,"p")}v(){zO=$O(),this.u.length=0,this.l.clear()}P(){const e=Math.min(this.u.length-1,Math.floor(($O()-zO)/50));return this.u[e]}h(e){var i,a;if((i=this.m)==null||i.call(this,e),!e.interactionId&&e.entryType!=="first-input")return;const t=this.u.at(-1);let r=this.l.get(e.interactionId);if(r||this.u.length<10||e.duration>t.T){if(r?e.duration>r.T?(r.entries=[e],r.T=e.duration):e.duration===r.T&&e.startTime===r.entries[0].startTime&&r.entries.push(e):(r={id:e.interactionId,entries:[e],T:e.duration},this.l.set(r.id,r),this.u.push(r)),this.u.sort((o,s)=>s.T-o.T),this.u.length>10){const o=this.u.splice(10);for(const s of o)this.l.delete(s.id)}(a=this.p)==null||a.call(this,r)}}}const cH=n=>{const e=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?n():(e(n=aH(n)),document.addEventListener("visibilitychange",n,{once:!0}))},VO=[200,500],OPe=(n,e={})=>{globalThis.PerformanceEventTiming&&"interactionId"in PerformanceEventTiming.prototype&&GC(()=>{PPe();let t,r=Xs("INP");const i=iH(e,NPe),a=s=>{cH(()=>{for(const u of s)i.h(u);const c=i.P();c&&c.T!==r.value&&(r.value=c.T,r.entries=c.entries,t())})},o=VC("event",a,{durationThreshold:e.durationThreshold??40});t=Zs(n,r,VO,e.reportAllChanges),o&&(o.observe({type:"first-input",buffered:!0}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(a(o.takeRecords()),t(!0))}),Pm(()=>{i.v(),r=Xs("INP"),t=Zs(n,r,VO,e.reportAllChanges)}))})};let LPe=class{constructor(){B(this,"m")}h(e){var t;(t=this.m)==null||t.call(this,e)}};const GO=[2500,4e3],DPe=(n,e={})=>{GC(()=>{const t=oH();let r,i=Xs("LCP");const a=iH(e,LPe),o=c=>{e.reportAllChanges||(c=c.slice(-1));for(const u of c)a.h(u),u.startTime<t.firstHiddenTime&&(i.value=Math.max(u.startTime-zC(),0),i.entries=[u],r())},s=VC("largest-contentful-paint",o);if(s){r=Zs(n,i,GO,e.reportAllChanges);const c=aH(()=>{o(s.takeRecords()),s.disconnect(),r(!0)});for(const u of["keydown","click","visibilitychange"])addEventListener(u,()=>cH(c),{capture:!0,once:!0});Pm(u=>{i=Xs("LCP"),r=Zs(n,i,GO,e.reportAllChanges),rH(()=>{i.value=performance.now()-u.timeStamp,r(!0)})})}})},KO=[800,1800],CT=n=>{document.prerendering?GC(()=>CT(n)):document.readyState!=="complete"?addEventListener("load",()=>CT(n),!0):setTimeout(n)},jPe=(n,e={})=>{let t=Xs("TTFB"),r=Zs(n,t,KO,e.reportAllChanges);CT(()=>{const i=Hx();i&&(t.value=Math.max(i.responseStart-zC(),0),t.entries=[i],r(!0),Pm(()=>{t=Xs("TTFB",0),r=Zs(n,t,KO,e.reportAllChanges),r(!0)}))})},UPe=n=>{const t=performance.getEntriesByType("navigation")[0],r=t==null?void 0:t.type;let i;const a=navigator;a.connection&&typeof a.connection.effectiveType=="string"&&(i=a.connection.effectiveType);const o={eventName:n.name,eventInfo_duration:n.value,eventInfo_navigationType:r,eventInfo_connectionType:i};H.trackEvent({name:"system",data:o});try{const s=`web-vitals-${n.name}`;performance.mark(s),performance.measure(`web-vitals-measure-${n.name}`)}catch{}};let qO=!1;function FPe(){const n=pe(y3);if(typeof window>"u"||qO)return;qO=!0;let e=!1;const t=i=>{UPe(i),n(a=>({...a,[i.name.toLowerCase()]:i.value}))},r=i=>{e||(e=!0,t(i))};jPe(t),MPe(t),DPe(r,{reportAllChanges:!0}),OPe(t)}function BPe(){m.useEffect(()=>(window.addEventListener("unhandledrejection",gM),()=>{window.removeEventListener("unhandledrejection",gM)}),[])}function HPe(){const n=Zp(Sn);return m.useCallback(t=>{n(r=>{for(const{id:i,title:a,updatedAt:o,characterId:s,continuedAt:c}of t){const u=r.get(i);u?(u.title=a,u.updatedAt=o,u.characterId=s??null,u.continuedAt=c):r.set(i,{id:i,title:a,updatedAt:o,characterId:s??null,streamingState:"idle",history:[],continuedAt:null})}})},[n])}function $Pe(){const n=HPe(),e=pe(My);return m.useCallback(async({url:r,args:i,isFirstPage:a})=>{const o=await Tn(r,qX,{query:i}).then(s=>s.data);if(o.results.length>0){const s=o.results.map(c=>({...c,history:[],streamingState:"idle"}));n(s),e(!0)}else a&&e(!1);return o},[n,e])}function zPe(n,e){if(!(e!=null&&e.next)&&n>0)return null;const t={url:"/conversations",isFirstPage:n===0};return e!=null&&e.next&&(t.args={cursor:e.next}),t}function VPe(){const n=$Pe();return Vk(n,zPe)}const GPe="aster";function KPe(){const n=pe(_r),e=pe(qte),t=!Ai("kill-picasso-id-on-start");return m.useCallback(async()=>{const r=await Tn("/user",VD,{parseOptions:{safe:!0},query:{"api-version":"2"}}).then(c=>c.data),{id:i,anid:a,isHistoryMigrationPending:o}=r;H.setAnid(a);const s=H.getPicassoId();return s!==null&&s!==i&&H.trackEvent({name:"health",data:{eventName:"userIdMismatch",eventInfo_customData:JSON.stringify({existingPicassoId:s,newPicassoId:i,origin:"user"})}}),t||H.setPicassoId(i),e(o),n(r.regionCode),r},[t,e,n])}function qPe(){const n=N(En),e=N(Gl),{refetch:t}=VPe(),r=KPe(),i=pe(hr),a=pe(ol),o=pe(am),s=pe(R3),c=pe(N3),u=pe(VI),h=pe(GI),f=pe(zte),p=pe(dte),g=pe(O3),v=pe(Vte),y=pe(L3),b=pe(x3),C=pe(KI),S=pe(Ly),E=pe(Gte),T=Im(),A=ee("account-change-chat-reset"),I=yC()[0]==="audioCall";m.useEffect(()=>{(async()=>{const x=Promise.all([r(),Tn("/user/settings",VX).then(Y=>Y.data),t()]),_=Wo.instance().getUserInfo(),[{id:R,firstName:z,isPro:j,inEeaPlusRegion:J,isEligibleForFreeTrial:D,phoneLink:F,ageGroup:ie,allowedToggles:U,remainingCalls:W,subscriptions:ue,accountTier:te},{preferredVoice:Z,preferredCharacter:Q,optOutOfTraining:Ie,optInToVoiceTraining:Ve,optOutOfPersonalization:ce,optOutOfPhoneConnection:le,optInToGenerativeUI:De,allowBiometricDataUse:We,allowOneDriveAccess:be,allowBrowserActions:Me,features:xe}]=await x;if(H.setIsAad(e),i({id:R,firstName:z,isPro:j&&!e,inEeaPlusRegion:J,isEligibleForFreeTrial:D,phoneLink:F,ageGroup:ie,allowedToggles:U,subscriptions:ue,accountTier:te,isStudent:void 0}),b(z??void 0),!A&&!I&&await Wk(),o(Z||GPe),T&&Q){const Y=zL(Q);s(Y)}c(Ie),u(Ve),h(ce),f(!!le),p(!!De),g(!!We),v(!!be),y(Me),E((xe==null?void 0:xe.suggestedFollowups)??!0),W&&(C(W.podcastGeneration),S(W.research)),H.setSettings({userSettingVoiceType:Z??void 0,userConsentPersonalization:!ce,userConsentModelTraining:!Ie,userSettingBrowserActions:Me??void 0,userSubscription:j?"pro":"free",accountTier:te??void 0,activeSubscriptions:(ue==null?void 0:ue.map(Y=>Y.tier).join(","))??void 0});const M=await _;if(M){const{mail:Y,givenName:Se,imgSrc:P,isStudent:ne}=M;i(ye=>ye&&{...ye,givenName:Se,email:Y,imgSrc:P,isStudent:ne}),Se&&!z&&b(Se),e||a(null)}})().catch(console.error)},[n,A,i,a,t,c,o,T,f,p,u,h,g,v,y,r,e,s,I,b,C,S,E])}function WPe(n={}){const{isAppInitialized:e=!1}=n,t=window.appStart;return m.useEffect(()=>!e||!t?()=>{}:(window.addEventListener("beforeunload",tR),()=>{window.removeEventListener("beforeunload",tR)}),[e,t]),{startTime:t}}const Q7e="userConnectors",YPe="/connections";async function QPe(){const{data:n}=await Tn(YPe,Qee,{options:{method:"GET",headers:{"Content-Type":"application/json"}}});return n.connections}function JPe(){const n=fr(),e=ee("google-drive-connector"),t=n&&e,r=pe(gte),{data:i,error:a,isLoading:o}=j5({queryKey:["userConnectors"],queryFn:QPe,enabled:t});return m.useEffect(()=>{i!==void 0&&r(i)},[i,r]),{isLoading:o,error:!!a,data:o||!i?null:i}}const ZPe=l.object({isMobileAppInstalled:l.boolean()}),XPe="/user/install-status";async function eNe(){try{return(await Tn(XPe,ZPe,{options:{method:"GET"}})).data.isMobileAppInstalled}catch(n){throw console.error("Failed to fetch mobile app install status:",n),n}}function tNe(){const n=pe(HI),{data:e,error:t,isLoading:r,mutate:i}=Zl("mobileAppInstallStatus",eNe,{revalidateOnFocus:!1,revalidateOnReconnect:!1,dedupingInterval:6e4});return m.useEffect(()=>{e!==void 0&&n(e)},[e,n]),{isMobileAppInstalled:e,isLoading:r,error:t||null,refetch:i}}const nNe="/user/narrative";function WO(n,e){var t;return(t=n.filter(r=>r.name===e)[0])==null?void 0:t.url}function J7e(n){const{background1:e,background2:t,background3:r}=n,a=[t,e,r].filter(s=>typeof s=="object"&&"light"in s&&"dark"in s);if(a.length===0)return[];const o=[];for(let s=0;s<a.length;s+=1){const c=a[s],u=a[(s+1)%a.length];!c||!u||(o.push({type:"gradient",from:c,to:u}),o.push({type:"solid",color:u}))}return o}function Z7e(n,e,t){const r=n[e%n.length];return r?r.type==="gradient"?`linear-gradient(to bottom, ${t?`#${r.from.dark}`:`#${r.from.light}`}, ${t?`#${r.to.dark}`:`#${r.to.light}`})`:t?`#${r.color.dark}`:`#${r.color.light}`:"var(--background-color)"}function X7e(n,e){return e==="wavy-shape"?WO(n,"hero-image-wavy-tablet"):WO(n,`hero-image-${e}-tablet`)}const rNe=l.object({from:l.string()});function iNe(n){return rNe.safeParse(n).success}function e8e(n){return iNe(n)?n.from:"/"}const t8e={start:{...ct,y:300},end:{...Rt,y:0}},n8e={duration:_me,ease:Mme},aNe={revalidateOnFocus:!1,shouldRetryOnError:!1,refreshInterval:Lx};async function oNe(n){const{data:e,response:t}=await Tn(n,nX,{options:{method:"GET",headers:{"Content-Type":"application/json"}},query:{"api-version":"2"}});if(!t.ok)return null;const{id:r,sections:i,theme:a,masks:o,font:s,fontHandwriting:c}=e;return{id:r,sections:i.filter(u=>u.type!=="shareDefault"),config:{theme:a,masks:o,font:s,...c?{fontHandwriting:c}:{}}}}function sNe(){const n=fr(),e=ee("memory-narrative"),t=n&&e,{data:r,error:i,isLoading:a}=Zl(t?nNe:null,oNe,aNe);return{isLoading:a,error:i,data:a||!r?null:r}}function cNe(){typeof window<"u"&&(Object.defineProperty(window,"APP_VERSION",{value:cI()}),Object.defineProperty(window,"APP_SURFACE",{value:"cmc"}))}const lNe=new zz({defaultOptions:{queries:{retry:0,refetchOnWindowFocus:!1}}});function uNe({sidebar:n,customLayout:e=!1}){APe(),yC(),uPe(),OCe(),Upe();const t=cPe(),{appInitialized:r}=xPe(t);EMe(),SPe(r),pPe(),BPe();const i=_F(),a=pe(Py);IPe({isEnabled:i,onIntercept:a});const o=N(la);WPe({isAppInitialized:r}),iPe(),sye(),CPe(),wPe();const s=N(Cp);return ePe(r),FPe(),dPe(),TPe(r),kPe(),hPe(),yPe(),EPe(),s==="user-banned"?d.jsx(W2e,{}):s==="age-verification"?d.jsx(Xme,{}):s?d.jsx(Hk,{}):!r||!t?null:o?d.jsx(p9,{accountActionRequired:o}):d.jsx(Vz,{client:lNe,children:d.jsx(U5,{reducedMotion:"user",children:d.jsx(dNe,{children:d.jsx(q2e,{sidebar:n,customLayout:e,children:d.jsx(Gz,{})})})})})}function dNe(n){const{children:e}=n;return qPe(),JPe(),tNe(),sNe(),bPe(),rCe(),nPe(),e}function hNe(n){const{sidebar:e,customLayout:t,onError:r=HL}=n;return d.jsxs(B5,{fallback:d.jsx(Hk,{}),onError:r,children:[d.jsx(vSe,{}),d.jsx(uNe,{sidebar:e,customLayout:t,onError:r})]})}cNe();document.addEventListener("DOMContentLoaded",()=>{eH()&&setTimeout(()=>lPe(),0)});const $x=new Set;function fNe(n=!1){return Pn(i1)!==null&&!n?!1:(ur(Ey),ur(Ld),bNe(),br(i1,"true"),!0)}function lH(){return parseInt(Pn(Ey)??"0",10)}function pNe(){return new Date(Pn(Ld)??new Date().toISOString())}function mNe(n){Pn(Ld)||br(Ld,n)}function gNe(n){let e;try{e=lH()}catch{e=0}e<Gw&&(e+=1,br(Ey,`${e}`),$x.add(n),e===Gw&&mNe(new Date().toISOString()))}function vNe(n){n&&($x.has(n)||gNe(n))}function bNe(){$x.clear()}function yNe(){const n=fr(),e=pe(F3);m.useEffect(()=>{n&&fNe()&&e(!0)},[n,e])}function CNe(){const n=Jl(),[e,t]=Je(OI),r=iu();m.useEffect(()=>{!n&&e&&t(void 0),n&&!e&&r({createConversationParams:{isPrivate:!0}})},[n,e,t,r])}a9();function SNe(){yNe(),CNe();const n=ee("discover-with-pane-layout"),e=ee("pages-layout-v2"),t=ee("chat-layout-v2"),r=Bt();let i=!1;return(e&&r.startsWith("/pages")||n&&r.startsWith("/discover")||t&&r.startsWith("/chats"))&&(i=!0),d.jsx(hNe,{customLayout:i})}const wNe=l.object({"prompt-branch":l.string().optional(),"use-sxs":l.union([l.boolean(),l.string()]).transform(n=>typeof n=="string"?n==="true":n).optional(),branch:l.string().optional()}),kt=Kz({component:SNe,validateSearch:rV(wNe),search:{middlewares:[qz(["prompt-branch","use-sxs","branch"])]}}),uH=m.lazy(()=>$(()=>import("./discover-BTthi2yd.js").then(n=>n.d),__vite__mapDeps([398,1,2,399,400,401,402,403,404,405,406,407,408,409,370,410,411,397,412,413,414,415,322,323,416,417]))),ENe=Tt("/")({component:()=>d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-full items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(uH,{})})}),TNe=Tt("/discover")({component:()=>d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-full items-center justify-center",children:d.jsx(Et,{className:"size-12"})}),children:d.jsx(uH,{})})}),INe=100,YO=.3,ANe=2*Pa,kNe="bottom-[60px] sm:bottom-[120px] h-[50px]",dH="min-h-[60px] sm:min-h-[120px]",hH="min-h-[calc(100dvh-60px-var(--chat-details-container-height)-var(--composer-container-height)-(2*var(--layout-offset-y)))] sm:min-h-[calc(100dvh-120px-var(--composer-container-height)-(2*var(--layout-offset-y)))]",xNe="min-h-[calc(100dvh-48px-var(--chat-details-container-height)-var(--composer-container-height)-(2*var(--layout-offset-y)))] sm:min-h-[calc(100dvh-48px-var(--composer-container-height)-(2*var(--layout-offset-y)))]",_Ne="min-h-[calc(100dvh-80px-var(--chat-details-container-height)-var(--composer-container-height)-(2*var(--layout-offset-y)))] sm:min-h-[calc(100dvh-80px-var(--composer-container-height)-(2*var(--layout-offset-y)))]",MNe="bottom-[var(--character-component-height)] h-[50px]",RNe="min-h-[calc(100dvh-var(--character-component-height)-var(--composer-container-height)-(2*var(--layout-offset-y)))]";function PNe(n,e,t,r,i){const[a,o]=Je(s3),s=m.useCallback(()=>{o(T=>!T)},[o]),c=Aa(),u=m.useMemo(()=>({variants:{start:{opacity:0},exiting:{opacity:0,y:-100,transition:{duration:.2,y:{duration:.3}}}},initial:"start",animate:a?"exiting":"default"}),[a]),h=m.useMemo(()=>({initial:{opacity:0,y:INe},animate:{opacity:1,y:0,transition:{duration:.4,y:{duration:YO}}},exit:{opacity:0,y:-100,transition:{duration:.2,y:{duration:YO}}},onAnimationStart:T=>{typeof T=="object"&&!Array.isArray(T)&&T.opacity===1&&(setTimeout(()=>n(),10),o(!1))}}),[n,o]),f=t?MNe:kNe,p=t?`min-h-[${r}px]`:dH,{highlighted:g,backstage:v}=ONe(i,a),y=LNe(t,v,g),b=m.useRef(null),{scrollYProgress:C}=Wz({target:b,container:e,offset:["end start","start start"]}),S=Rd(C,[ANe/100,1],[0,1]);return{toggleMessagesAreExiting:s,backstageMessagesProps:u,highlightedMessagesProps:h,opacity:c?S:C,sentinelRef:b,sentinelClasses:f,backstageClasses:p,highlightedClasses:y,highlighted:g,backstage:v}}function NNe(n){const e=fH(n);if(!e)return[];const t=n.at(-2),r=[];zs(t)&&r.push(t),zs(e)&&r.push(e);const i=n.at(-3);if((i==null?void 0:i.author)==="human"&&r.length===2)return[i,...r];const a=e.author==="human",o=!a&&(t==null?void 0:t.author)==="ai";return a||o?[e]:n.slice(-2)}function fH(n){return n.at(-1)}function ONe(n,e){const t=NNe(n),r=n.slice(0,-(t.length+(e?2:0)));return{highlighted:t,backstage:r}}function LNe(n,e,t){return n?RNe:me.instance().config().smallAnochorTopWithoutHeader&&t.length>0?e.length===0?_Ne:xNe:hH}function pH(){return X(Fp("pageContainer")??"px-6","mx-auto w-full max-w-chat")}function DNe(n){const{children:e,onClick:t,title:r,className:i,spatialNavigationAutofocus:a=!0,disabled:o=!1,testId:s,hoverVariant:c=!1}=n,[u,h]=m.useState(!1),[f,p]=m.useState(!1),g=()=>h(!0),v=()=>h(!1),y=()=>p(!0),b=()=>p(!1),C=u||f&&c?"acrylic-thin-inverted":"acrylic-thin";return d.jsx(Ee,{disabled:o,variant:"pill",color:C,size:"64-xxl",testId:s,className:X("w-conversations items-center justify-center",i),onClick:t,onFocus:g,onBlur:v,onMouseEnter:y,onMouseLeave:b,title:r,spatialNavigationAutofocus:a,children:e})}async function ST(n,e,t){try{await xr({path:`/conversations/${n}/react`,args:{body:{[t]:e},analytics:{anonymousPath:"/conversations/*/react"}}})}catch{}}async function mH(n,e,t){try{await xr({path:`/conversations/${n}/feedback`,args:{body:{types:Array.from(e),text:t},analytics:{anonymousPath:"/conversations/*/feedback"}}})}catch{}}const gH=n=>m.createElement("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M6 2C6.4075 2 6.77654 2.16302 7.04688 2.42676L7.05273 2.4248C7.70431 2.14511 8.40698 2 9.11816 2H14.7871C15.7302 2 16.5456 2.65891 16.7432 3.58105L17.9492 9.20801C17.9832 9.36686 18 9.52895 18 9.69141C18 10.9663 16.9663 12 15.6914 12H12.1904C12.3947 12.6629 12.5 13.3526 12.5 14.0469V14.668C12.5 15.6352 12.2133 16.581 11.6768 17.3857C11.4528 17.7215 11.0952 17.9399 10.7002 17.9893L10.5293 18H10.4775C9.66177 18 9 17.3382 9 16.5225V15.1719C8.9999 13.8855 8.54907 12.6397 7.72559 11.6514L6.91895 10.6836C6.66492 10.8811 6.34669 11 6 11H3.5C2.67157 11 2 10.3284 2 9.5V3.5C2 2.67157 2.67157 2 3.5 2H6ZM9.11816 3C8.55774 3 8.0038 3.11128 7.48828 3.32617C7.49488 3.38327 7.5 3.44114 7.5 3.5V9.5C7.5 9.59759 7.48948 9.69276 7.47168 9.78516L8.49316 11.0107C9.46653 12.1788 9.9999 13.6514 10 15.1719V16.5225C10 16.7859 10.2141 17 10.4775 17H10.5293L10.6221 16.9883C10.7122 16.9655 10.7919 16.9101 10.8447 16.8311C11.2717 16.1906 11.5 15.4377 11.5 14.668V14.0469C11.5 13.4073 11.3966 12.7718 11.1943 12.165L11.0254 11.6582C11.0223 11.6489 11.0211 11.6392 11.0186 11.6299C11.0142 11.6139 11.0105 11.5977 11.0078 11.5811C11.0046 11.5614 11.0028 11.542 11.002 11.5225C11.0016 11.515 11 11.5075 11 11.5C11 11.4948 11.0008 11.4896 11.001 11.4844C11.0016 11.4643 11.0038 11.4445 11.0068 11.4248C11.0089 11.4113 11.0106 11.3979 11.0137 11.3848C11.0179 11.3671 11.0242 11.3501 11.0303 11.333C11.0355 11.3184 11.0404 11.3039 11.0469 11.29C11.0531 11.2765 11.0609 11.2639 11.0684 11.251C11.077 11.236 11.0856 11.221 11.0957 11.207C11.1052 11.1939 11.1162 11.1821 11.127 11.1699C11.1369 11.1587 11.1463 11.147 11.1572 11.1367C11.17 11.1246 11.1841 11.1143 11.1982 11.1035C11.2105 11.0942 11.2223 11.0844 11.2354 11.0762C11.2399 11.0733 11.2443 11.0701 11.249 11.0674L11.3057 11.0391C11.3117 11.0365 11.318 11.0346 11.3242 11.0322C11.3301 11.03 11.3358 11.0274 11.3418 11.0254C11.3508 11.0224 11.3601 11.021 11.3691 11.0186C11.3852 11.0142 11.4014 11.0106 11.418 11.0078C11.4376 11.0045 11.457 11.0029 11.4766 11.002C11.4844 11.0016 11.4921 11 11.5 11H15.6914C16.414 11 17 10.414 17 9.69141C17 9.59931 16.99 9.50704 16.9707 9.41699L15.7656 3.79004C15.6667 3.32914 15.2585 3 14.7871 3H9.11816ZM3.5 3C3.22386 3 3 3.22386 3 3.5V9.5C3 9.77614 3.22386 10 3.5 10H6C6.27614 10 6.5 9.77614 6.5 9.5V3.5C6.5 3.22386 6.27614 3 6 3H3.5Z",fill:"currentColor"})),r8e=Object.freeze(Object.defineProperty({__proto__:null,default:gH},Symbol.toStringTag,{value:"Module"})),vH=n=>m.createElement("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M10.7002 2.01074C11.0952 2.06005 11.4528 2.2785 11.6768 2.61426C12.2133 3.41901 12.5 4.36484 12.5 5.33203V5.95312C12.5 6.64737 12.3947 7.33709 12.1904 8H15.6914C16.9663 8 18 9.03369 18 10.3086C18 10.471 17.9832 10.6331 17.9492 10.792L16.7432 16.4189C16.5456 17.3411 15.7302 18 14.7871 18H9.11816C8.40698 18 7.70431 17.8549 7.05273 17.5752L7.04688 17.5723C6.7765 17.8363 6.40775 18 6 18H3.5C2.67157 18 2 17.3284 2 16.5V10.5C2 9.67157 2.67157 9 3.5 9H6C6.34648 9 6.665 9.11814 6.91895 9.31543L7.72559 8.34863C8.54907 7.36035 8.9999 6.11453 9 4.82812V3.47754C9 2.66177 9.66177 2 10.4775 2H10.5293L10.7002 2.01074ZM3.5 10C3.22386 10 3 10.2239 3 10.5V16.5C3 16.7761 3.22386 17 3.5 17H6C6.27614 17 6.5 16.7761 6.5 16.5V10.5C6.5 10.2239 6.27614 10 6 10H3.5ZM10.4775 3C10.2141 3 10 3.21405 10 3.47754V4.82812C9.9999 6.34856 9.46653 7.82122 8.49316 8.98926L7.47168 10.2139C7.48959 10.3066 7.5 10.4021 7.5 10.5V16.5C7.5 16.5585 7.4948 16.6161 7.48828 16.6729C8.00389 16.8878 8.55762 17 9.11816 17H14.7871C15.2585 17 15.6667 16.6709 15.7656 16.21L16.9707 10.583C16.99 10.493 17 10.4007 17 10.3086C17 9.58598 16.414 9 15.6914 9H11.5C11.4921 9 11.4844 8.99743 11.4766 8.99707C11.457 8.99614 11.4376 8.99451 11.418 8.99121C11.4013 8.98845 11.3852 8.98483 11.3691 8.98047C11.3602 8.97803 11.3507 8.97757 11.3418 8.97461C11.3357 8.97258 11.3302 8.96904 11.3242 8.9668C11.307 8.96032 11.2906 8.95259 11.2744 8.94434C11.261 8.93755 11.2479 8.93071 11.2354 8.92285C11.2217 8.91426 11.2091 8.90437 11.1963 8.89453C11.1828 8.88414 11.1695 8.87392 11.1572 8.8623C11.146 8.85165 11.1362 8.83977 11.126 8.82812C11.1156 8.81623 11.1049 8.80477 11.0957 8.79199C11.0856 8.77799 11.077 8.76309 11.0684 8.74805C11.0609 8.73511 11.0531 8.72253 11.0469 8.70898C11.0393 8.69254 11.0331 8.67555 11.0273 8.6582C11.0225 8.64364 11.0172 8.62925 11.0137 8.61426C11.0106 8.60113 11.0089 8.58772 11.0068 8.57422C11.0038 8.55451 11.0016 8.53476 11.001 8.51465C11.0008 8.50978 11 8.50491 11 8.5C11 8.49212 11.0016 8.48435 11.002 8.47656C11.0029 8.45704 11.0045 8.43757 11.0078 8.41797C11.0106 8.40136 11.0142 8.38516 11.0186 8.36914C11.021 8.36013 11.0224 8.35077 11.0254 8.3418L11.1943 7.83496C11.3966 7.22817 11.5 6.59274 11.5 5.95312V5.33203C11.5 4.56227 11.2717 3.80943 10.8447 3.16895C10.7919 3.08985 10.7122 3.03448 10.6221 3.01172L10.5293 3H10.4775Z",fill:"currentColor"})),i8e=Object.freeze(Object.defineProperty({__proto__:null,default:vH},Symbol.toStringTag,{value:"Module"}));function bH(n){const{titleText:e,subtitleText:t,positiveButtonText:r,negativeButtonText:i,positiveButtonTitle:a,negativeButtonTitle:o,modalHeaderText:s,onPositiveClick:c,onNegativeClick:u,isModalOpen:h,onModalClose:f,modalContent:p,className:g="",isDebugAudioRecorderEnabled:v=!1}=n;return d.jsxs("div",{className:g,children:[d.jsx("div",{className:"relative w-full pb-6 after:absolute after:mt-3 after:w-full after:border-b after:border-stroke-300"}),d.jsx("h2",{className:"mt-5 text-foreground-600 text-xs",children:d.jsx("strong",{children:e})}),d.jsx("p",{className:"mt-1 text-foreground-600 text-xs",children:t}),d.jsxs("div",{className:X("mt-3.5 grid w-fit min-w-72 grid-rows-1 gap-2",v?"grid-cols-3":"grid-cols-2"),children:[d.jsxs(Ee,{onClick:c,title:a,variant:"rect",size:"36-sm",children:[d.jsx(vH,{className:"size-5"})," ",r]}),d.jsxs(Ee,{onClick:u,title:o,variant:"rect",size:"36-sm",children:[d.jsx(gH,{className:"size-5"})," ",i]}),v&&d.jsx(Ee,{onClick:async()=>{const{AUDIO_RECORDER:y}=await $(async()=>{const{AUDIO_RECORDER:b}=await import("./audio-recorder-BSuABAbc.js");return{AUDIO_RECORDER:b}},__vite__mapDeps([418,1,2]));await y.download()},title:"Download audio debug",variant:"rect",size:"36-sm",children:"Download audio debug"})]}),h&&d.jsx(bo,{isOpen:!0,onClose:f,headerText:s,className:"w-full max-w-[400px]",children:p})]})}function jNe(){}function UNe({inputValue:n,handleChange:e,className:t=""}){const[r,i]=m.useState(""),{t:a}=Ce();return Ai("kill-free-form-text")?null:d.jsx(Jk,{disabled:!1,className:ke(t,"max-h-[8rem] grow-0 basis-[8rem] !items-start overflow-auto rounded-xl border-2 border-stone-700 bg-black/5 px-0.5"),inputValue:n,characterLimit:eG,autoFocus:!1,setInput:s=>{e(s)},placeholder:a("chat.feedback.placeholder"),errorMessage:r,setError:i,onEnter:jNe,isMultiLines:!0})}function yH(n){const{feedbackOptions:e,onSubmit:t}=n,{t:r}=Ce(),[i,a]=m.useState(new Set),[o,s]=m.useState(""),c=i.size===0,u=f=>{a(p=>{const g=new Set(p);return i.has(f)?g.delete(f):g.add(f),g})},h=async()=>{t(i,o),a(new Set)};return e?d.jsxs("div",{className:"flex flex-col gap-2 pt-2",children:[d.jsx("ul",{role:"list",className:"mt-0 flex list-none flex-col gap-2",children:e.map(f=>d.jsx("li",{children:d.jsx(AF,{label:f.label,setChecked:()=>u(f.type),checked:i.has(f.type)})},f.type))}),c?null:d.jsx(UNe,{inputValue:o,handleChange:s}),d.jsx(Ee,{title:r("chat.feedback.submitFeedbackButton"),size:"48-lg",color:"strong",className:"mt-4 max-h-12",disabled:c,onClick:h,children:r("chat.feedback.submitFeedbackButton")})]}):null}function FNe(n){var C,S;const{className:e}=n,t=N(UI),[r,i]=Je(Ny),[a,o]=m.useState(!1),[s,c]=m.useState(),u=ee("ads-showroom-picasso-feedback"),{t:h}=Ce(),f=E=>{bn({source:"feedback",scenario:yW[E],conversationId:r==null?void 0:r.conversationId,additionalData:{brandId:r==null?void 0:r.brandId,brandName:(r==null?void 0:r.brandName)??""}})},p=()=>{o(!1),i(void 0)},g=async E=>{r!=null&&r.conversationId&&u&&await ST(r.conversationId,E,"showroomReaction")},v=()=>{var E;f("thumbs-up"),c("thumbs-up"),(E=t==null?void 0:t.showroom)!=null&&E.positive?o(!0):p(),g("thumbs-up")},y=()=>{var E;f("thumbs-down"),c("thumbs-down"),(E=t==null?void 0:t.showroom)!=null&&E.negative?o(!0):p(),g("thumbs-down")},b=async(E,T)=>{p(),r&&H.trackEvent({name:"interaction",data:{eventName:"copilotSubmitFineConversationFeedback",eventInfo_fineFeedbackTypes:Array.from(E).join(","),eventInfo_conversationId:r.conversationId,eventInfo_additionalData:JSON.stringify({brandId:r.brandId,brandName:r.brandName,reactionType:s})}}),r!=null&&r.conversationId&&E.size>0&&mH(r.conversationId,E,T)};return d.jsx(bH,{titleText:h("ads.showroomFeedbackTitle",{brand:r==null?void 0:r.brandName}),subtitleText:h("ads.showroomFeedbackDescription"),positiveButtonText:h("ads.showroomFeedbackPositive"),negativeButtonText:h("ads.showroomFeedbackNegative"),positiveButtonTitle:h("reviewPrompt.positive"),negativeButtonTitle:h("reviewPrompt.negative"),modalHeaderText:h("ads.showroomFeedbackModalTitle"),onPositiveClick:v,onNegativeClick:y,isModalOpen:a,onModalClose:p,modalContent:d.jsx(yH,{onSubmit:b,feedbackOptions:s==="thumbs-up"?((C=t==null?void 0:t.showroom)==null?void 0:C.positive)??void 0:(S=t==null?void 0:t.showroom)==null?void 0:S.negative}),className:e,isDebugAudioRecorderEnabled:!1})}function BNe(n){const{onSubmit:e}=n,{t}=Ce(),[r,i]=m.useState(!1),a=async o=>{i(!0),await e(o),i(!1)};return d.jsxs("div",{children:[d.jsx("p",{children:t("voice.feedback.reviewReason")}),d.jsx(Ee,{title:t("voice.feedback.okay"),size:"48-lg",color:"strong",className:"mt-4 max-h-12 w-full",disabled:r,onClick:()=>a(!0),children:t("voice.feedback.okay")}),d.jsx(Ee,{title:t("voice.feedback.noThanks"),size:"48-lg",color:"default",className:"mt-3 w-full",onClick:()=>a(!1),children:t("voice.feedback.noThanks")})]})}function HNe({className:n}){const e=N(lt),t=N(UI),r=pe(ch),[i,a]=Je(VI),[o,s]=m.useState(),c=ee("debug-audio-recorder")&&!1,u=Tre(),{t:h}=Ce(),f=()=>{bn({source:"voiceFeedback",scenario:"thumbsUp",conversationId:e,destination:u?"appearance":void 0}),e&&ST(e,"thumbs-up","audioReaction"),r(!1),_t.emit("feedback:ai-message-reaction","positive")},p=()=>{bn({source:"voiceFeedback",scenario:"thumbsDown",conversationId:e,destination:u?"appearance":void 0}),e&&ST(e,"thumbs-down","audioReaction"),s("feedback-options")},g=()=>{s(null),r(!1)},v=async(C,S)=>{nt({source:"voiceFeedback",scenario:"feedbackSubmit",conversationId:e,destination:u?"appearance":void 0,customData:JSON.stringify({selectedOptionsCount:C.size,feedbackTypes:[...C].join(",")})}),e&&C.size>0&&mH(e,C,S),i?g():s("review-request")},y=async C=>{C&&(a(!0),await z9({optInToVoiceTraining:!0})),g()},b=()=>o==="feedback-options"?d.jsx(yH,{onSubmit:v,feedbackOptions:u?t==null?void 0:t.appearance:t==null?void 0:t.call}):o==="review-request"?d.jsx(BNe,{onSubmit:y}):null;return d.jsx(bH,{titleText:h(u?"voice.feedback.howWasAppearanceChat":"voice.feedback.howWasVoiceChat"),subtitleText:h("voice.feedback.giveFeedback"),positiveButtonText:h("voice.feedback.good"),negativeButtonText:h("voice.feedback.bad"),positiveButtonTitle:h("reviewPrompt.positive"),negativeButtonTitle:h("reviewPrompt.negative"),modalHeaderText:h(o==="feedback-options"?"voice.feedback.chooseWhatHappened":"voice.feedback.canMicrosoftReview"),onPositiveClick:f,onNegativeClick:p,isModalOpen:!!o,onModalClose:g,modalContent:b(),className:n,isDebugAudioRecorderEnabled:c})}const $Ne=m.lazy(()=>$(()=>import("./index.es-DAxxNzWm.js"),__vite__mapDeps([329,2,1]))),zNe=MU();function VNe({onAnimationClicked:n}){const e=m.useRef(null),{t}=Ce(),[r,i]=m.useState(null);m.useEffect(()=>{zNe.load("../../assets/lottie/character-thinking-cloud-animation.json").then(i).catch(()=>i(null))},[]),m.useEffect(()=>{const s=e.current;return s&&r&&s.playSegments([0,67],!0),()=>{s&&r&&s.playSegments([350,370],!0)}},[r]);const a=()=>{var c,u;(c=e.current)==null||c.playSegments([320,345],!0),(u=e.current)==null||u.pause(),n();const s=document.getElementById(Qk);s==null||s.focus()},o=s=>{s.key==="Enter"&&a()};return d.jsx("div",{children:d.jsx(m.Suspense,{fallback:d.jsx("div",{}),children:d.jsx($Ne,{lottieRef:e,role:"button",tabIndex:0,"aria-label":t("characterAnimation.characterThinkingCloudAriaLabelText"),title:t("characterAnimation.characterThinkingCloudAriaLabelText"),animationData:r,loop:!1,onMouseDown:a,onMouseEnter:()=>{var s;return(s=e.current)==null?void 0:s.playSegments([275,295],!0)},onMouseLeave:()=>{var s;return(s=e.current)==null?void 0:s.playSegments([296,315],!0)},onKeyDown:o,onComplete:()=>{var s;return(s=e.current)==null?void 0:s.playSegments([68,274],!0)}})})})}const QO=1,GNe=m.lazy(()=>$(()=>import("./character-DHQl6qtp.js"),__vite__mapDeps([338,1,2,339])).then(n=>({default:n.Character})));function KNe({animatingMessageId:n,isStreamingMessage:e,displayedCharacterId:t,setCharacterComponentHeight:r}){const i=ee("characterspeech"),[a,o]=m.useState(0),[s,c]=m.useState(!1),[u,h]=Je(Gc),f=N(po),p=()=>{o(0),c(!1)};m.useEffect(()=>{let y;return i&&u==="idle"&&(y=setInterval(()=>{o(b=>b<QO?b+1:b),f.length>0&&a===QO&&!e&&(c(!0),H.trackEvent({name:"system",data:{eventName:"characterTalkToMeDisplayed",eventInfo_conversationId:Fe(lt),eventInfo_characterId:t}}))},1e3)),()=>clearInterval(y)},[u,t,f.length,i,a,e]),m.useEffect(()=>{i&&u!=="idle"&&u!=="hovering"&&p()},[u,i]);const g=async()=>{p(),h("responding"),await eo.submitMessage({command:{type:"promptCharacterSpeech"},inputMethod:"promptCharacterSpeech"}),H.trackEvent({name:"interaction",data:{eventName:"characterTalkToMeClicked",eventInfo_conversationId:Fe(lt),eventInfo_characterId:t}})};function v(){switch(t){case"aqua":return"translate-x-9";case"mica":return"translate-x-14";case"erin":return"translate-x-16";default:throw new Error("Invalid characterId provided to getTranslateXClass")}}return d.jsx(B5,{fallback:d.jsx(Hk,{}),onError:_W(n,t),children:d.jsxs("div",{"data-testid":"character-div",className:X("sticky top-0 h-2/5 min-h-[40vh] w-full bg-gradient-chat-light-character dark:bg-midnight-850 dark:bg-none",$t.babylonCharacter),style:{maskImage:"linear-gradient(to bottom, #000 95%, transparent 100%)"},children:[d.jsx(Mn,{children:s&&d.jsx(_e.div,{className:X("absolute start-1/2 top-12 size-36",v()),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:1},children:d.jsx(VNe,{onAnimationClicked:g})})}),d.jsx(m.Suspense,{fallback:d.jsx("div",{className:"flex h-full items-center justify-center",children:d.jsx(Et,{type:"spinnerThemed",className:"size-12"})}),children:d.jsx(GNe,{characterId:t,setCharacterComponentHeight:r})})]})})}function qNe({className:n}){const{t:e}=Ce();return d.jsxs("div",{className:ke("flex items-center gap-2",n),children:[d.jsx(Et,{type:"reasoning",className:"size-11"}),d.jsxs("div",{className:"flex flex-col text-sm",children:[d.jsx("span",{children:e("chat.reasoningLoading.title")}),d.jsx("span",{className:"text-foreground-450 dark:text-foreground-600",children:e("chat.reasoningLoading.description")})]})]})}function WNe(n){const{isActive:e,animationDuration:t="5s",children:r,className:i,...a}=n;return d.jsx("div",{className:ke(e&&"bg-gradient-to-l from-foreground-800 via-foreground-300 to-foreground-800 bg-[size:200%_100%] bg-clip-text text-transparent",i),style:{...e&&{animation:`shimmer-reverse ${t} linear infinite 0.5s`}},...a,children:r})}const YNe="rounded-2xl border border-stroke-250 p-3";function QNe(n){const{title:e}=n,{t}=Ce(),r=t("chat.reasoningLoading.title"),i=e&&e.trim()!==""?e:r;return d.jsx("div",{className:"text-base",children:d.jsx(WNe,{isActive:!0,children:i})})}function JNe(){return d.jsx(_e.div,{initial:ct,animate:Rt,className:X("w-max",YNe),children:d.jsx(QNe,{})})}function zx(n){const{loadingType:e}=n;switch(e){case"spinner":return d.jsx(Et,{type:"spinnerThemed",className:"absolute -ms-2.5 -mt-2 size-11"});case"thinking-card":return d.jsx(JNe,{});case"reasoning-chat":return d.jsx(qNe,{className:"absolute -ms-2.5 -mt-2 w-max"});default:return null}}function Vx(){const n=N(Cn),e=N(mne),t=ee("think-deeper-cot");switch(n){case"chat":case"computerUse":case"study":case"research":return e?null:"spinner";case"reasoning":return t?"thinking-card":"reasoning-chat";case"smart":return null;default:return null}}function CH(n){const{delay:e,className:t}=n,{t:r}=Ce(),i=ee("announce-loading"),a=m.useId(),o=N(Cn),s=Vx();return s?d.jsxs(_e.div,{"aria-hidden":!0,className:ke("relative size-7",t),initial:"start",animate:"end",variants:{start:{...ct},end:{...Rt,transition:{delay:e}}},children:[i&&d.jsx(Tl,{id:a,timeout:3e3,msg:r(o==="reasoning"?"chat.reasoning":"chat.loading"),type:"polite"}),d.jsx(zx,{loadingType:s})]}):null}const ZNe=m.lazy(()=>$(()=>import("./actions-chat-detail-C4a7wVi5.js"),__vite__mapDeps([419,1,2,420,421,325,422,423,410,375])).then(n=>({default:n.ActionsChatDetail}))),XNe=m.lazy(()=>$(()=>import("./showroom-chat-detail-Cera3-JX.js"),__vite__mapDeps([424,1,2])).then(n=>({default:n.ShowroomChatDetail})));function eOe(){const n=N(Hl);return d.jsx("div",{className:"flex size-full items-center justify-center",children:n?d.jsx(m.Suspense,{fallback:d.jsx(JO,{}),children:d.jsx(XNe,{})}):d.jsx(m.Suspense,{fallback:d.jsx(JO,{}),children:d.jsx(ZNe,{})})})}function JO(){return d.jsx("div",{className:"flex size-full items-center justify-center",children:d.jsx(Et,{className:"size-12"})})}const Dw=376,jw="0.5rem";function SH(n){const{children:e}=n,t=N(Vr),r=Aa(),i=t==="side-by-side",a=HC(),o=t==="side-by-side"&&!a,s=r?"bg-stone-150":"bg-gradient-chat-light",c=Vp(h=>{const f=document.getElementById("app");f&&f.style.setProperty("--chat-details-container-height",a?`${h.height}px`:null)}),u=()=>t==="detail-only"?"0px":o?`max(${Dw}px, 25%)`:"100%";return d.jsxs("div",{className:X("flex size-full max-h-[100vh] min-h-0",a&&"flex-col",i&&"bg-sidebar-light dark:bg-sidebar-dark",r&&i&&"pb-2"),style:o?{gap:jw}:void 0,children:[t!=="chat-only"&&d.jsx(_e.div,{ref:c,className:X("rounded-lg",a&&"h-fit",i&&"shadow-lg","dark:bg-midnight-850 dark:bg-none",s),initial:{width:o?`calc(100% - ${jw} - max(${Dw}px, 25%))`:"100%"},animate:{width:o?`calc(100% - ${jw} - max(${Dw}px, 25%))`:"100%"},transition:Vi,children:d.jsx(eOe,{})}),d.jsx(_e.div,{className:X(t==="detail-only"&&"hidden",i&&s,a?"h-[calc(100vh-var(--chat-details-container-height))]":"h-full",i&&"rounded-lg pb-px shadow-lg dark:bg-midnight-850 dark:bg-none"),initial:{width:u()},animate:{width:u()},transition:Vi,children:e})]})}function ZO(n){const e=cn(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}function vv(n,e){const t=ry(n),r=ry(e),i=+t-ZO(t),a=+r-ZO(r);return Math.round((i-a)/fme)}function sp(n,e){const t=cn(n),r=cn(e),i=t.getTime()-r.getTime();return i<0?-1:i>0?1:i}function tOe(n,e){const t=cn(n),r=cn(e),i=t.getFullYear()-r.getFullYear(),a=t.getMonth()-r.getMonth();return i*12+a}function nOe(n){const e=cn(n);return e.setHours(23,59,59,999),e}function rOe(n){const e=cn(n),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function iOe(n){const e=cn(n);return+nOe(e)==+rOe(e)}function aOe(n,e){const t=cn(n),r=cn(e),i=sp(t,r),a=Math.abs(tOe(t,r));let o;if(a<1)o=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-i*a);let s=sp(t,r)===-i;iOe(cn(n))&&a===1&&sp(n,r)===1&&(s=!1),o=i*(a-Number(s))}return o===0?0:o}function oOe(n,e){const t=cn(n),r=cn(e);return t.getFullYear()-r.getFullYear()}function sOe(n,e){const t=cn(n),r=cn(e),i=sp(t,r),a=Math.abs(oOe(t,r));t.setFullYear(1584),r.setFullYear(1584);const o=sp(t,r)===-i,s=i*(a-+o);return s===0?0:s}function cOe(n,e){const t=cn(n),r=cn(e);return t.getFullYear()===r.getFullYear()&&t.getMonth()===r.getMonth()}function lOe(n,e){const t=e==null?void 0:e.weekStartsOn,r=cn(n),i=r.getDay(),a=(i<t?7:0)+i-t;return r.setDate(r.getDate()-a),r.setHours(0,0,0,0),r}function uOe(n,e,t){const r=vv(n,e),i=lOe(e,{weekStartsOn:1}),a=vv(i,e),o=vv(iy(i,7),e),s=el(n,"EEEE"),c=t(`dates.weekdays.${s.toLowerCase()}`),u=t(`dates.months.${el(n,"MMMM").toLowerCase()}Abbr`),h=el(n,"d"),f=t("dates.dayMonthDate",{day:c,month:u,date:h});return r>=1?f:r>=0?`${t("dates.today")}`:r>=-1?`${t("dates.yesterday")}`:r>=a?c:r>=o?t("dates.previousDay",{day:c}):f}function dOe(n,e,t){const r=vv(e,n);if(r===0)return t("dates.today");if(r<=1)return t("dates.yesterday");if(r<7)return t("dates.weekThis");if(cOe(n,e))return t("dates.monthThis");if(aOe(e,n)<12){const o=el(n,"MMMM").toLowerCase();return t(`dates.months.${o}`)}const a=sOe(e,n);return a===1?t("dates.yearAgo"):t("dates.yearsAgoPlural",{count:a})}function hOe(n,e){return uOe(n,new Date,e)}function a8e(n,e){return dOe(n,new Date,e)}function o8e(n){const e=Math.max(0,n),t=Math.floor(e/60),r=e%60;return`${t}:${r<10?"0":""}${r}`}function fOe(n){const{date:e,className:t}=n,{t:r}=Ce();return d.jsxs("div",{className:X("flex items-center",t),children:[d.jsx("span",{className:"opacity-70 text-xs-strong","data-testid":"date-divider",children:hOe(e,r)}),d.jsx(eh,{verticalMargin:!1,color:"accent",className:"mt-px grow"})]})}function pOe(){const n=fr(),e=N(N3),t=N(VI),r=N(GI),i=N(Bl),a=N(Wte),o=!!N(Yte),s=!!N(Qte),c=!!(tT({key:"shouldShowTextModelTrainingSettings",default:!0})&&o),u=!!(tT({key:"shouldShowVoiceModelTrainingSettings",default:!0})&&s),h=ee("view-settings-disclaimer"),f=c||u,p=!f||e&&!t,g=lH(),[v,y]=Je(F3),[b,C]=m.useState(!1);m.useEffect(()=>{if((f||a)&&n&&!i){if(v){C(!0),y(!1);return}if(g<Gw){C(!0);return}let T;try{T=pNe()}catch{T=new Date}const A=m9(T,6),I=new Date;I>A&&(C(!0),br(Ld,I.toISOString()))}},[n,f,i,g,a,v,y]);const S=()=>p===void 0||r===void 0||a===void 0?null:i||!n?"chat.unauthenticatedDisclaimer":!a||!b?"chat.firstTurnDisclaimerBase":!p&&!r?h?"chat.firstTurnDisclaimerPersonalizationTrainingViewSettings":"chat.firstTurnDisclaimerPersonalizationTraining":p&&!r?h?"chat.firstTurnPersonalizationDisclaimerViewSettings":"chat.firstTurnPersonalizationDisclaimer":r&&!p?h?"chat.firstTurnTrainingDisclaimerViewSettings":"chat.firstTurnTrainingDisclaimer":"chat.firstTurnDisclaimerBase";return(()=>{var A,I,k;let T=S();return T?(A=me.instance().config().uiOverrides)!=null&&A.hideTrainingDisclaimer?"chat.firstTurnDisclaimerBase":(T=((k=(I=me.instance().config()).textOverrides)==null?void 0:k.call(I,T))??T,T):null})()}const Gx="text-foreground-450 text-xs dark:text-foreground-600",mOe="underline",XO={settingsLink:d.jsx(wm,{pages:["menu","account","privacy"],className:X(Gx,mOe),clickSource:"disclaimerSettingsLink"}),learnMoreLink:d.jsx(ET,{link:Vb})},e5={termsLink:d.jsx(ET,{link:jp}),privacyLink:d.jsx(ET,{link:Xd})},gOe={settingsLink:d.jsx(wm,{pages:["menu","account","privacy"],className:X(Gx),disableLink:!0})};function wT(n){const{forceVisible:e,disableDisclaimerSettingsLink:t,className:r,testId:i,shouldUpdateNewConversationCount:a}=n,o=pOe(),s=N(ai),c=s==null?void 0:s.id,h=((s==null?void 0:s.isNew)??e)&&o;if(m.useEffect(()=>{!a||!h||!c||vNe(c)},[a,h,c]),!h)return null;const f=p=>{switch(p){case"chat.unauthenticatedDisclaimer":return d.jsxs(d.Fragment,{children:[d.jsx(Fr,{i18nKey:"chat.firstTurnDisclaimerBase"})," ",d.jsx(Fr,{i18nKey:p,components:{termsLink:e5.termsLink,privacyLink:e5.privacyLink}})]});case"chat.firstTurnTrainingDisclaimer":case"chat.firstTurnPersonalizationDisclaimer":case"chat.firstTurnDisclaimerPersonalizationTraining":case"chat.firstTurnTrainingDisclaimerViewSettings":case"chat.firstTurnPersonalizationDisclaimerViewSettings":case"chat.firstTurnDisclaimerPersonalizationTrainingViewSettings":return d.jsxs(d.Fragment,{children:[d.jsx(Fr,{i18nKey:"chat.firstTurnPersonalizationDisclaimerBase"})," ",d.jsx(Fr,{i18nKey:p,components:{settingsLink:t?gOe.settingsLink:XO.settingsLink}})]});case"chat.edge.firstTurnPersonalizationDisclaimer":case"chat.edge.firstTurnPersonalizationSettingsDisclaimer":return d.jsxs(d.Fragment,{children:[d.jsx(Fr,{i18nKey:"chat.firstTurnPersonalizationDisclaimerBase"})," ",d.jsx(Fr,{i18nKey:p,components:{learnMoreLink:XO.learnMoreLink,bold:d.jsx("strong",{})}})]});case"chat.firstTurnDisclaimerBase":case"chat.firstTurnPersonalizationDisclaimerBase":case"chat.tv.firstTurnDisclaimer":return d.jsx(Fr,{i18nKey:p});default:return null}};return d.jsx(On,{id:o,mode:"wait",className:X("space-y-8 pb-8",Gx,r),"data-testid":i,children:f(o)})}function ET(n){const{children:e,link:t,className:r}=n;return d.jsx(to,{className:X("underline",r),href:t,title:"",children:e})}function wH(n){const{customBottomDisclaimer:e}=n,t=ee("async-disclaimer-text"),r=Zk(),[i,a]=m.useState(!t);return m.useEffect(()=>{r&&r.length>0&&a(!0)},[r]),e||(i?d.jsx(On,{className:"absolute bottom-0 flex max-w-chat justify-center px-6 text-center","data-testid":"bottom-disclaimer",children:d.jsx(wT,{shouldUpdateNewConversationCount:!0})}):null)}function vOe(){return d.jsx("div",{"aria-hidden":!0,className:"flex size-full flex-col items-center justify-center"})}const Nu="absolute animate-dot-ellipsis size-2 rounded-full bg-background-450";function bOe(n){const{className:e}=n;return d.jsxs("div",{className:ke("flex items-center justify-center gap-3",e),children:[d.jsxs("div",{className:"relative flex items-center justify-center",children:[d.jsx("div",{className:Nu,style:{animationDelay:"0ms"}}),d.jsx("div",{className:Nu,style:{animationDelay:"30ms"}})]}),d.jsxs("div",{className:"relative flex items-center justify-center",children:[d.jsx("div",{className:Nu,style:{animationDelay:"100ms"}}),d.jsx("div",{className:Nu,style:{animationDelay:"130ms"}})]}),d.jsxs("div",{className:"relative flex items-center justify-center",children:[d.jsx("div",{className:Nu,style:{animationDelay:"200ms"}}),d.jsx("div",{className:Nu,style:{animationDelay:"230ms"}})]})]})}function yOe(n){const{text:e,staggerChildren:t=.018,delayChildren:r=0,initialOpacity:i=0}=n;return d.jsx(_e.div,{variants:{show:{transition:{staggerChildren:t,delayChildren:r}}},initial:"hidden",animate:"show",children:ux(e).map((a,o)=>d.jsx(_e.span,{variants:{hidden:{opacity:i},show:{opacity:1,transition:{duration:BU}}},children:a},o))})}const COe={sm:"text-md",md:"text-xl",lg:"text-3xl"},t5=25;function SOe(n){const{subheading:e}=n;return d.jsx("h2",{className:"mt-4 text-foreground-800 text-base",children:e})}function wOe(n){const{className:e,fontSize:t="lg"}=n,r=N(Uy),i=N(_3),{t:a}=Ce(),{greetingKey:o,widgetGreeting:s,widgetSubheading:c}=Q3(),{isCentralComposerEnabled:u,isGreetingCentered:h}=Th(),f=Bx(),p=ZRe(),g=i&&i.length>t5?`${i.slice(0,t5)}…`:i,v=o?a(o,{name:g}):"";return f?d.jsx("div",{className:ke(e,"flex w-full flex-col items-start justify-start gap-2 sm:mb-6 sm:h-[100px] sm:justify-end"),children:d.jsx("div",{className:"flex justify-start sm:min-h-8",children:!p||r?d.jsx("div",{className:"ms-2 mt-6 flex size-full sm:mt-0",children:d.jsx(bOe,{className:"flex-1"})}):d.jsxs("div",{className:"flex flex-col items-start gap-2",children:[d.jsxs(On,{className:"flex items-center gap-2 text-foreground-550 dark:text-foreground-750",id:s??v,children:[d.jsx("p",{className:"text-xs-strong",children:a("common.copilotText")}),d.jsx("p",{className:"text-xs",children:el(new Date,"h:mm aa")})]}),d.jsx("h1",{className:"text-lg",children:d.jsx(EH,{text:s??v},s)})]})})}):d.jsxs("div",{className:ke("flex w-full flex-col items-start justify-start sm:mb-8 sm:h-[100px] sm:justify-end",h&&"sm:items-center",!u&&"sm:justify-start",COe[t],c&&"sm:mb-4",e),"data-testid":"launch-greeting",children:[d.jsx("h1",{children:v}),c&&d.jsx(SOe,{subheading:c})]})}const EH=m.memo(n=>{const{text:e}=n;return d.jsx(yOe,{text:e,staggerChildren:.02,delayChildren:.1},e)});EH.displayName="AnimatedTextMemo";function EOe(n){const{customLaunchGreeting:e,className:t}=n;return e||d.jsx(wOe,{className:t,fontSize:"md"})}function TOe(n){const{className:e}=n,t=N(Bl),r="top-disclaimer";return t?d.jsx(wT,{forceVisible:!0,className:e,testId:r,shouldUpdateNewConversationCount:!0}):d.jsx(wT,{className:e,testId:r,shouldUpdateNewConversationCount:!0})}function IOe({characterId:n,className:e}){const t=N(ai),[r,i]=Je(c3),{t:a}=Ce();return m.useEffect(()=>{(t==null?void 0:t.isNew)===!1&&i(!1)},[i,t==null?void 0:t.isNew]),t!=null&&t.isNew?d.jsxs(On,{id:"character-disclaimer",mode:"wait",className:X("pb-2 text-stone-550/90 text-xs dark:text-slate-250/60",e),children:[a("characterAnimation.characterDisclaimerTextV2",{characterName:xW(n,a)})," ",r&&d.jsx(Fr,{i18nKey:"characterAnimation.characterSettingDisclaimerText",components:{settingsLink:d.jsx(wm,{pages:["menu","character-options"],className:"text-stone-550/90 underline text-xs dark:text-slate-250/60"})}})]}):null}function AOe(){return d.jsx(Gk,{size:"sm",stroke:!0,className:"flex h-[172px] w-[324px] cursor-pointer flex-col p-4",children:d.jsx("div",{className:"flex flex-1",children:d.jsx($C,{className:"size-full",style:{clipPath:"var(--clip-path-squircle-36)"}})})})}const kOe=m.lazy(()=>$(()=>import("./contextual-shopping-card-hN7TcC-r.js"),__vite__mapDeps([425,1,2,426,298,293,294,295,427,345,296,346,287,297,428,429,430,431,432,433,415,322,323])).then(n=>({default:n.AnimatedContextualShoppingCard})));function TH(n){const{customLaunchGreeting:e,chatItemClasses:t}=n,{isCentralComposerEnabled:r,isWidgetSectionEnabled:i,isAppearanceOnHomeEnabled:a,isGreetingCentered:o}=Th(),s=Nn({breakpoint:"sm"}),c=ny({breakpoint:"h760"}),u=ny({breakpoint:"h600"}),h=ee("appr-home-toggle"),f=N($te),p=a&&(!h||!f)&&!u,g=Im(),v=sm(),y=N(jI),b=N(ane),C=!Ok(),S=g&&y!==null,E=_U(),{launchGreetingShown:T,widgetSubheading:A}=Q3(),I=N(b3),{showShoppingCardInNewChat:k,shoppingProductMetadata:x,isCopilotOpenedViaEdgeCTAs:_}=QI(),R=!_&&!b&&!S&&!T&&v&&!E,j=me.instance().config().smallScreenShowTopDisclaimerAfterSendingMessage??!1?!v:!R,J=S||s&&j,F=N(Cn)==="computerUse",ie=i&&!F&&!s&&!c,U=R&&"pb-2",W=m.lazy(()=>a?$(()=>import("./appearance-chat-Coi1tSbn.js"),__vite__mapDeps([434,1,2])).then(te=>({default:te.AppearanceChat})):Promise.resolve({default:()=>null})),ue=d.jsxs(On,{delay:.2,initial:C?"initial":!1,className:ke(r?"mt-2 flex flex-col items-start text-pretty pe-0 sm:absolute sm:inset-x-0 sm:inset-y-0 sm:mx-auto sm:mt-0 sm:max-w-chat sm:px-4 sm:pb-[calc(var(--composer-container-height))]":U,k&&"mx-auto mt-2 max-w-sm sm:relative sm:mt-6 sm:max-w-md sm:px-4",p&&s&&"grow",ie&&!A&&"sm:pb-[calc(var(--composer-container-height)-64px)]",ie&&A&&"sm:pb-[calc(var(--composer-container-height)-32px)]"),children:[p&&r&&d.jsx("div",{className:ke("order-2 flex w-full flex-col items-center justify-center sm:absolute sm:h-[calc(50%-60px-var(--composer-container-height)/2)]",s&&"grow"),children:d.jsx(m.Suspense,{fallback:d.jsx(vOe,{}),children:d.jsx(W,{voiceAppearanceId:im})})}),d.jsxs("div",{className:"order-1 flex w-full flex-col gap-2 sm:top-0 sm:h-full sm:justify-center",children:[R&&d.jsx(EOe,{customLaunchGreeting:e,className:ke(o?"sm:text-center":"sm:ps-2")}),S&&d.jsx(IOe,{characterId:y}),k&&x&&!I&&d.jsx(m.Suspense,{fallback:d.jsx(AOe,{}),children:d.jsx(kOe,{content:x})}),J&&d.jsx(TOe,{})]})]},"chat-welcome");return t?d.jsx("div",{className:t,children:ue}):ue}function xOe(n){const{content:e}=n;return d.jsx("div",{className:"text-center text-foreground-450 text-xs dark:text-foreground-600",children:e})}const n5=10,_Oe=0,MOe=.2;function ROe({onClick:n,shouldShowScrollToBottomButton:e,bottomButtonClass:t=""}){const{t:r}=Ce(),i=N(Vr),a=HC(),o=i==="side-by-side"&&!a;return d.jsx(Mn,{children:e&&d.jsx(_e.div,{className:ke("pointer-events-none absolute flex justify-center",$t.chatScrollToBottomButton,o?"end-0 w-1/4 min-w-chat-side-by-side":"inset-x-0",t),initial:{...ct,y:n5},animate:{...Rt,y:_Oe},exit:{...ct,y:n5},transition:{duration:MOe},children:d.jsx(Ee,{color:"acrylic",variant:"circle",size:"36-sm",title:r("chat.scrollToBottom"),onClick:n,className:"pointer-events-auto border-none shadow-xl",children:d.jsx("span",{className:ke("relative rounded-full bg-white/40 p-2 shadow-xl hover:bg-white hover:p-[9px] dark:bg-background-350/60","after:absolute after:inset-0 after:rounded-full after:shadow-xl","before:absolute before:-inset-px before:rounded-full before:border before:border-black/8"),children:d.jsx(Em,{className:"size-5 rotate-180 fill-foreground-900 dark:fill-white"})})})})})}const r5=m.lazy(()=>$(()=>import("./ai-message-CLMTDRmz.js").then(n=>n.h),__vite__mapDeps([435,1,2,327,295,325,428,436,397,437,402,438,439,407,440])));function POe(n){const{message:e,animatingMessageIds:t,conversationId:r,sideBySideComparisonId:i,isStreamingComplete:a,shouldAnimate:o,reactionsToDisable:s,isLastMessage:c}=n,{t:u}=Ce(),h=pe(Ia),f=Vx();if(!r)return null;if(!t4(e))return d.jsx(_e.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.25},children:d.jsx(m.Suspense,{fallback:f&&d.jsx(zx,{loadingType:f}),children:d.jsx(r5,{message:e,isStreamingComplete:a,shouldAnimate:!1,reactionsToDisable:s,isLastMessage:c})})});if(!i)return null;const{left:p,right:g}=e,v=C=>!(t!=null&&t.has(C.id))&&!C.sideBySideConfig.isStreamingComplete,y=(C,S)=>{Lbe({sideBySideComparisonId:i,sideBySideConfig:S}),eo.selectSideBySideMessage({selectedMessageId:C,sideBySideComparisonId:i}),Cne(r,C),h({title:u("chat.sideBySide.selectedResponseToastTitle"),subtitle:u("chat.sideBySide.selectedResponseToastSubtitle"),dismissAfter:2e3})},b=d.jsx(CH,{delay:.5,className:"mt-2"});return d.jsxs("div",{className:"flex w-full flex-col items-center gap-6 pb-4",children:[d.jsx("p",{children:u("chat.sideBySide.preambleMessage")}),d.jsx("div",{className:"flex flex-col justify-center gap-6 @5xl/chat:w-[100cqw] @5xl/chat:flex-row @5xl/chat:items-stretch @5xl/chat:px-6",children:[p,g].map(C=>d.jsxs("div",{className:"flex min-h-24 flex-col rounded-2xl border-[0.5px] border-black/12 bg-white/45 p-6 @5xl/chat:min-w-[480px] @5xl/chat:max-w-[600px] @5xl/chat:flex-[1_1_600px] dark:bg-midnight-350/10",children:[d.jsx("div",{className:"flex-1",children:v(C)?b:d.jsx(m.Suspense,{fallback:b,children:d.jsx(r5,{message:C,isStreamingComplete:a,shouldAnimate:o,reactionsToDisable:"all",isLastMessage:!0,groupHasTopMargin:!1,isInSideBySide:!0})})}),a&&d.jsx(_e.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.5},children:d.jsx(Ee,{size:"36-sm",className:"mx-auto mt-6",title:u("chat.actions.selectResponse"),color:"strong",onClick:()=>y(C.id,C.sideBySideConfig),children:u("chat.actions.selectResponse")})})]},C.id))})]})}const IH=n=>m.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("mask",{id:"mask0_12117_44960",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:0,y:0,width:20,height:20},m.createElement("path",{d:"M7.19253 7.24894C7.46962 6.94112 7.94384 6.91617 8.25172 7.1932L10.7517 9.44267C10.9098 9.58487 11 9.78745 11 10C11 10.2126 10.9098 10.4152 10.7517 10.5574L8.25172 12.8068C7.94384 13.0839 7.46962 13.0589 7.19253 12.7511C6.91543 12.4433 6.94039 11.9692 7.24827 11.6922L8.29553 10.7499H4.75C4.33579 10.7499 4 10.4141 4 10C4 9.58591 4.33579 9.2502 4.75 9.2502H8.29553L7.24828 8.30789C6.94039 8.03086 6.91543 7.55675 7.19253 7.24894ZM20 15.2506C20 16.7691 18.7688 18 17.25 18L2.75 18C1.23122 18 0 16.7691 0 15.2506V4.74937C0 3.23093 1.23122 2 2.75 2H17.25C18.7688 2 20 3.23094 20 4.74937L20 15.2506ZM17.25 16.5003C17.9404 16.5003 18.5 15.9408 18.5 15.2506L18.5 4.74937C18.5 4.05917 17.9404 3.49966 17.25 3.49966L13.9958 3.49966L13.9958 16.5003H17.25ZM12.4958 16.5003L12.4958 3.49966L2.75 3.49965C2.05965 3.49965 1.5 4.05917 1.5 4.74937L1.5 15.2506C1.5 15.9408 2.05964 16.5003 2.75 16.5003L12.4958 16.5003Z",fill:"currentColor"})),m.createElement("g",{mask:"url(#mask0_12117_44960)"},m.createElement("rect",{width:24,height:24,transform:"translate(-2 -2)",fill:"currentColor"}))),s8e=Object.freeze(Object.defineProperty({__proto__:null,default:IH},Symbol.toStringTag,{value:"Module"}));function NOe(){const n=!Ai("kill-share-c2"),e=Bt(),t=N(ai),r=N(Bl),i=Jl();return!!(!r&&n&&e.startsWith("/chats")&&!e.endsWith("/talk")&&(t!=null&&t.history.length)&&!i)}function AH(){const{t:n}=Ce(),e=Nn({breakpoint:"md"}),t=Nn({breakpoint:"sm"}),r=Nn({breakpoint:"xl"}),i=N(Vr)==="side-by-side",a=N(Yo),o=N(Tm),s=Bt(),c=pe(Vr),u=HC(),h=i&&!t&&s.startsWith("/chats"),f=NOe()&&r,p=(e||!a||h||f)&&!u&&!o,g=m.useCallback(()=>{c("detail-only")},[c]);return d.jsx("div",{className:X("sticky top-0 z-20 w-full"),children:d.jsx(Mn,{children:p&&d.jsx(_e.div,{className:"absolute h-16 w-full rounded-lg bg-stone-150/90 backdrop-blur-md dark:bg-midnight-850/80",initial:"initial",animate:"animate",exit:"exit",variants:{initial:ct,animate:Rt,exit:ct},transition:Vi,"data-testid":"sticky-header",children:h&&d.jsx(_e.div,{initial:ct,animate:Rt,exit:{transition:{duration:0},...ct},transition:Vi,children:d.jsx(Ee,{title:n("actions.hideDetails"),color:"subtle-dimmed",variant:"square",size:"36-sm",className:"ms-3.5 mt-1.5",onClick:g,children:d.jsx(IH,{className:"size-5"})})})})})})}function OOe(n){const{query:e,messageId:t,index:r,onClick:i}=n,a=N(lt),o=()=>{bn({source:"suggestionChip",conversationId:a,messageId:t}),H.trackEvent({name:"interaction",data:{eventName:"copilotSuggestionFollowupSelection",eventInfo_messageId:t,eventInfo_conversationId:a??"",eventInfo_suggestionIndex:r}}),i()};return d.jsx(KB,{isSelected:!1,variant:"flat",className:"max-w-[80%] text-start sm:max-w-fit",onClick:o,children:d.jsx("span",{className:"p-1",children:e})})}function LOe(n){const{mostRecentMessageId:e,className:t}=n,r=N(lt),i=N(ute),a=i&&e===i.messageId;return m.useEffect(()=>{a&&H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionPage:"chat",eventInfo_messageId:e,eventInfo_impressionScenario:"suggestionReceived",eventInfo_conversationId:r??""}})},[a,e,r]),d.jsx("div",{className:X("mt-auto",t),children:a&&d.jsx(DOe,{suggestions:i.suggestions,messageId:i.messageId,conversationId:r??""})})}function DOe({suggestions:n,messageId:e,conversationId:t}){const r=m.useRef(null),i=dy(r,{amount:"all",once:!0});return m.useEffect(()=>{i&&H.trackEvent({name:"system",data:{eventName:"copilotImpression",eventInfo_impressionPage:"chat",eventInfo_messageId:e,eventInfo_impressionScenario:"suggestionRender",eventInfo_conversationId:t}})},[i,e,t]),d.jsx(On,{ref:r,duration:Ei.suggestions,className:"flex flex-col items-end gap-3 pb-8",children:n.map((a,o)=>d.jsx(OOe,{index:o,messageId:e,onClick:()=>eo.submitMessage({text:a,inputMethod:"suggestion"}),query:a},a))})}const jOe="answerCards.ariaLabel.numberOfLocalResultsSingle",UOe="answerCards.ariaLabel.numberOfLocalResultsPlural";function FOe(n){let e="";for(const r of n.entities){if(e+=r.name,r.category&&(e+=`, ${r.category}`),r.price&&(e+=`, ${BOe(r.price)}`),r.reviews[0]){const i=r.reviews[0];e+=", ",e+=re("answerCards.ariaLabel.ratedByReviewer",{rating:i.rating,reviewCount:i.count,reviewProvider:i.providerName})}r.phoneNumber&&(e+=", ",e+=re("answerCards.ariaLabel.phoneNumber",{phoneNumber:r.phoneNumber})),r.location.address&&(e+=", ",e+=re("answerCards.ariaLabel.address",{address:r.location.address})),e+=". "}const t=n.entities.length===1?jOe:UOe;return re(t,{count:n.entities.length,resultSummary:e})}function BOe(n){switch(n.length){case 1:return re("answerCards.ariaLabel.inexpensivePrices");case 2:return re("answerCards.ariaLabel.averagePrices");default:return re("answerCards.ariaLabel.expensivePrices")}}function HOe(n){const{content:e,announce:t}=n;let r;for(const i of e){switch(i.type){case"text":r=i.text;break;case"image":i.url?r=re("chat.imageGenerated",{prompt:i.prompt??""}):r=re("chat.imageGenerating");break;case"page":break;case"citation":break;case"card":r=$Oe(i.card);break;case"error":r=i.text;break;case"task":break;case"deleted":break;case"chainOfThought":break;case"chainOfThoughtGroup":break;case"document":break;case"activity":break;case"memorySignal":r=i.text;break;case"indicator-ai-response":r=i.text;break}r&&t({msg:r})}}function $Oe(n){switch(n.type){case"localEntity":return FOe(n);case"healthcareEntity":return"";case"ads":case"weather":case"weatherTemperatureHourly":case"weatherTemperatureDaily":case"weatherPrecipitationHourly":case"weatherPrecipitationDaily":case"image":case"person":case"phoneImages":case"phoneLinking":case"phoneAlarm":case"phoneTimer":case"phoneSendMessage":case"video":case"sportsSchedule":case"sportsGame":case"safetyHelpline":case"shopping":case"shoppingProducts":case"shoppingCurated":case"job":case"inlineVideo":case"quiz":case"financeChart":case"generativeUI":case"recipe":case"mediaSpotlight":case"inlineImage":case"m365":case"file":case"computerUseFeedback":case"document":case"flashcard":case"consent":case"newsCarousel":return"";default:return""}}function zOe(n,e){const t=m.useRef();m.useEffect(()=>{var i;if(e==="streaming")return;const r=n.at(-1);r&&r.author==="ai"&&r.id!==((i=t.current)==null?void 0:i.id)&&(HOe({content:r.content,announce:au}),t.current=r)},[n,e])}function VOe(n){const{colorTheme:e}=n,{t}=Ce();return d.jsx("video",{src:e==="dark"?gU:vU,title:t("settings.appearanceIconAlt"),className:"size-16 rounded-lg",autoPlay:!0,loop:!0,muted:!0})}const GOe=n=>{const{t:e}=Ce(),t=pe(Ia),r=pe($l),i=N(qi),[a,o]=Je(LC);m.useEffect(()=>{if(n){const s=a?null:{title:e("settings.appearanceDiscoveryToastTitle"),subtitle:d.jsxs(d.Fragment,{children:[e("settings.appearanceDiscoveryToastSubtitle")," ",d.jsx("span",{className:"text-link-350 underline",children:e("settings.appearanceDiscoveryToastTryIt")})]}),iconProvider:()=>VOe({colorTheme:i}),action:async()=>{o(OC),r(im),await XI({talk:!0})},onDismiss:()=>{o(tx)}};t(s)}},[n,t,r,e,i,a,o])};function KOe(n){m.useEffect(()=>{if(n.current){const e=r=>{var a,o,s,c,u;if(r.target&&r.target instanceof Element&&r.target.closest('[data-formatless-copy="false"]'))return;const i=window.getSelection();if(i!=null&&i.rangeCount){let h=document.createElement("div");const f=i.getRangeAt(0),{startContainer:p,endContainer:g}=f;h.appendChild(f.cloneContents());const v=(a=p.parentElement)==null?void 0:a.closest("pre"),y=(o=g.parentElement)==null?void 0:o.closest("pre"),b=!!v&&!!y&&v===y,C=!!((s=p.parentElement)!=null&&s.closest("table"))&&!qOe(f),S=h.getElementsByTagName("*");for(const I of S)I.getAttribute("data-copy")==="false"?I.remove():(I.removeAttribute("style"),I.removeAttribute("class"),I.removeAttribute("initial"),I.removeAttribute("animate"),I.removeAttribute("variants"),I.removeAttribute("custom"));if(b){const I=document.createElement("pre");I.appendChild(h),h=I}if(C){const I=document.createElement("table"),k=Array.from(h.children);for(const x of k)I.appendChild(x);h=I}h.style.position="absolute",h.style.left="-9999px",document.body.appendChild(h);const E=window.getSelection(),T=document.createRange();T.selectNodeContents(h),E==null||E.removeAllRanges(),E==null||E.addRange(T);const A=(E==null?void 0:E.toString())??"";E==null||E.removeAllRanges(),E==null||E.addRange(f),document.body.removeChild(h),h.removeAttribute("style"),(c=r.clipboardData)==null||c.setData("text/plain",A),(u=r.clipboardData)==null||u.setData("text/html",b||C?h.outerHTML:h.innerHTML)}r.preventDefault()},t=n.current;return t.addEventListener("copy",e),()=>{t.removeEventListener("copy",e)}}return()=>{}},[n])}function qOe(n){var a,o,s,c;const{startContainer:e,endContainer:t}=n,r=((a=e.parentElement)==null?void 0:a.closest("td"))??((o=e.parentElement)==null?void 0:o.closest("th")),i=((s=t.parentElement)==null?void 0:s.closest("td"))??((c=t.parentElement)==null?void 0:c.closest("th"));return!!(r&&i&&r===i)}const WOe=typeof document<"u"?m.useLayoutEffect:m.useEffect;function YOe(n,e){const t=m.useRef(0),r=m.useRef(0);m.useEffect(()=>{const{current:i}=e,a=()=>{if(i){const o=i.scrollHeight-i.scrollTop;r.current=o}};return i==null||i.addEventListener("scroll",a,{passive:!0}),a(),()=>{i==null||i.removeEventListener("scroll",a)}},[e]),WOe(()=>{const{current:i}=e;i&&i.scrollTop+r.current!==i.scrollHeight&&(t.current===0?setTimeout(()=>{i.scrollTop=i.scrollHeight},100):i.scrollTop=i.scrollHeight-r.current,t.current=n)},[n,e])}function QOe(n,e){const t=Ai("kill-review-prompt"),i=!!me.instance().config().promptForReviews&&!t,a=pe(ri),o=m.useCallback(async c=>{if(!i)return;const{shown:u}=await Jfe.run({});if(u)return;const f=KMe()>=BMe,p=c>UMe;(f||p)&&!qMe()&&(a("prompt-review"),H.trackEvent({name:"system",data:{eventName:"inAppSurveyPopUp",eventInfo_triggerType:p?"longChat":"activeDays"}}))},[i,a]),s=m.useRef(!1);m.useEffect(()=>{e&&(s.current=!0)},[e]),m.useEffect(()=>{e||!s.current||o(n)},[n,e,o])}function JOe(n){return m.useCallback(({behavior:t="smooth",delay:r=0})=>{setTimeout(()=>{n.current&&n.current.scrollTo({top:n.current.scrollHeight,behavior:t})},r)},[n])}const ZOe=.1;function XOe(n){const{chatRef:e,hasMessages:t=!0}=n,r=m.useRef(null),[i,a]=m.useState(!1),o=m.useCallback(s=>{const c=s[0];c&&a(!c.isIntersecting&&t)},[t]);return m.useEffect(()=>{if(!e.current||!r.current)return()=>{};const s=new IntersectionObserver(o,{root:e.current,threshold:ZOe});return s.observe(r.current),()=>{s.disconnect()}},[e,o]),m.useEffect(()=>{t||a(!1)},[t]),{bottomRef:r,shouldShowScrollToBottomButton:i}}function e5e(){const n=N(om),e=Zp(Sn),t=N(LI);m.useEffect(()=>{e(r=>{if(t){const i=r.get(t);i&&(i.characterId=n)}})},[t,n,e])}async function t5e(n,e){const t=eA(e);if(t){const{message:r,part:i}=t;if(!i.task)return;const a=await go();a.setConversationIdByMessageId({messageId:r.id,conversationId:n}),a.setMessageIdByTaskId({taskId:i.task.id,messageId:r.id})}}const n5e=window.requestIdleCallback||function(e){const t=Date.now();return setTimeout(()=>{e({didTimeout:!1,timeRemaining(){return Math.max(0,50-(Date.now()-t))}})},1)},kH=n=>m.createElement("svg",{viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M2 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v7a2 2 0 0 1-1.164 1.818 1.497 1.497 0 0 0-.275-.379l-.446-.446A1 1 0 0 0 17 13V6a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5v1H4a2 2 0 0 1-2-2V6Zm8.854 4.146A.5.5 0 0 0 10 10.5v7a.5.5 0 0 0 .91.287l1.571-2.245 2.943.452a.5.5 0 0 0 .43-.848l-5-5ZM11 15.915v-4.207l3.066 3.067-1.74-.268a.5.5 0 0 0-.486.207l-.84 1.2Z"})),c8e=Object.freeze(Object.defineProperty({__proto__:null,default:kH},Symbol.toStringTag,{value:"Module"})),xH=n=>m.createElement("svg",{viewBox:"0 0 64 64",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n},m.createElement("path",{d:"M32.0007 5.33301C46.7282 5.33301 58.6673 17.2721 58.6673 31.9997C58.6673 46.7273 46.7282 58.6663 32.0007 58.6663C17.2731 58.6663 5.33398 46.7273 5.33398 31.9997C5.33398 17.2721 17.2731 5.33301 32.0007 5.33301ZM32.0007 8.66634C19.114 8.66634 8.66732 19.113 8.66732 31.9997C8.66732 44.8863 19.114 55.333 32.0007 55.333C44.8873 55.333 55.334 44.8863 55.334 31.9997C55.334 19.113 44.8873 8.66634 32.0007 8.66634ZM23.7105 21.3663L23.8458 21.4878L32.0007 29.6437L40.1555 21.4878C40.763 20.8803 41.7227 20.8398 42.3772 21.3663L42.5125 21.4878C43.12 22.0953 43.1605 23.0551 42.634 23.7095L42.5125 23.8449L34.3567 31.9997L42.5125 40.1545C43.12 40.762 43.1605 41.7217 42.634 42.3762L42.5125 42.5115C41.905 43.119 40.9453 43.1595 40.2908 42.633L40.1555 42.5115L32.0007 34.3557L23.8458 42.5115C23.2383 43.119 22.2786 43.1595 21.6241 42.633L21.4888 42.5115C20.8813 41.904 20.8408 40.9443 21.3673 40.2898L21.4888 40.1545L29.6447 31.9997L21.4888 23.8449C20.8813 23.2374 20.8408 22.2776 21.3673 21.6232L21.4888 21.4878C22.0963 20.8803 23.0561 20.8398 23.7105 21.3663Z"})),l8e=Object.freeze(Object.defineProperty({__proto__:null,default:xH},Symbol.toStringTag,{value:"Module"})),i5="size-5",a5="flex w-full items-center justify-end gap-1.5 text-foreground-450 dark:text-slate-400";function r5e({type:n}){const{t:e}=Ce();switch(n){case"takeTaskControl":return d.jsxs("div",{className:a5,children:[d.jsx(kH,{className:i5}),e("actions.tookControl")]});case"cancelTask":return d.jsxs("div",{className:a5,children:[d.jsx(xH,{className:i5}),e("actions.cancelledTask")]});case"createPage":case"appendToPage":case"promptCharacterSpeech":default:return null}}function i5e(n){const{text:e}=n;return d.jsx("div",{className:"flex w-full flex-col items-end","data-content":"user-message",children:d.jsx("div",{className:X("font-ligatures-none h-fit max-w-[80%] self-end whitespace-pre-wrap break-words rounded-2xl bg-accent-250/60 px-5 py-3 dark:bg-accent-200",ho("userMessage")??"text-base"),children:e})})}const _H=n=>(wC(Yz),$b({groupper:{tabbability:a5e(n==null?void 0:n.tabBehavior)},focusable:{ignoreKeydown:n==null?void 0:n.ignoreDefaultKeydown}})),a5e=n=>{switch(n){case"unlimited":return dS.Unlimited;case"limited":return dS.Limited;case"limited-trap-focus":return dS.LimitedTrapFocus;default:return}},MH=m.forwardRef((n,e)=>{const{children:t,tabBehavior:r="limited-trap-focus",ignoreDefaultKeydown:i,...a}=n,o=_H({tabBehavior:r,ignoreDefaultKeydown:i});return ee("a11y-keyboard-navigation")?d.jsx(_e.div,{ref:e,...o,...a,tabIndex:0,children:t}):d.jsx(_e.div,{...a,ref:e,children:t})});MH.displayName="FocusableGroupMotion";function o5e(n){const{children:e,tabBehavior:t="limited-trap-focus",ignoreDefaultKeydown:r,...i}=n,a=_H({tabBehavior:t,ignoreDefaultKeydown:r});return ee("a11y-keyboard-navigation")?d.jsx("div",{...a,...i,tabIndex:0,role:"article",children:e}):d.jsx("div",{...i,children:e})}const RH=n=>d.jsx(o5e,{...n});RH.Motion=MH;function s5e({tabs:n=[]}){return n.length===0?null:d.jsx(cc,{className:"flex min-h-[60px] flex-col gap-2",tabbable:!0,tabIndex:0,children:d.jsx(NB,{showRemoveIcon:!1,tabs:n})})}function c5e(n){var b;const{message:e,className:t,isForSharing:r}=n,{t:i}=Ce(),o=!!N(Hl),s=Ox(),c=ee("a11y-keyboard-navigation"),u=i(c?"chat.userSaid":"chat.user"),h=e.content.filter(C=>C.type==="document"||C.type==="image"),[f,p]=m.useState(!1),g=h.slice(0,Av),v=m.useCallback(()=>{au({msg:i("userInput.seeAll"),type:"polite"}),p(!0)},[i,p]),y=h.length>Av;return d.jsxs(RH,{className:X("space-y-1",t),id:`${e.id}-user-message`,"aria-labelledby":`${e.id}-user-message`,children:[d.jsxs("div",{className:"relative space-y-3",children:[d.jsx("h2",{className:"sr-only","aria-label":u,"data-copy":"false",children:u}),h.length>0&&d.jsxs("div",{className:"flex h-32 w-full flex-row justify-end gap-2 overflow-hidden",children:[g.map((C,S)=>d.jsx(RB,{messageItem:C,isForSharing:r},`file-${S}`)),y&&d.jsx(Ee,{"aria-label":i("userInput.seeAll"),title:i("userInput.seeAll"),color:"overlay-dimmed-inverted",onClick:v,children:i("userInput.seeAll")}),f&&d.jsx(PB,{onClose:()=>p(!1),messages:h,isForSharing:r})]}),e.content.map((C,S)=>C.type==="browserTabs"?s&&Qve(C.tabs)?d.jsx(s5e,{tabs:C.tabs},S):null:C.type==="text"?d.jsx(i5e,{text:C.text},S):C.type==="command"?d.jsx(r5e,{type:C.command.type},S):(C.type==="document",null)),e.emojiReaction&&d.jsx("div",{className:"absolute -bottom-3 end-3",children:e.emojiReaction})]}),!o&&((b=e.brand)==null?void 0:b.brandLogo)&&d.jsx("div",{className:"w-full px-3 text-right text-foreground-600 text-xs",children:i("ads.aboutBrand",{brand:e.brand.brandLogo.businessName})})]},e.id)}const l5e=m.lazy(()=>$(()=>import("./ai-message-CLMTDRmz.js").then(n=>n.h),__vite__mapDeps([435,1,2,327,295,325,428,436,397,437,402,438,439,407,440]))),u5e=1.5,o5="inline-block w-full space-y-8",Kx="max-w-chat w-full";function TT(n){var K,oe,ge;const{className:e,conversationContainerClassName:t="mb-[var(--composer-container-height)]",bottomButtonClassName:r="bottom-[calc(var(--composer-container-height)+1rem)]",customLaunchGreeting:i,customBottomDisclaimer:a,enableHighlightedClasses:o=!0,enableBackstageClasses:s=!0,disableStickyHeader:c=!1,disableSuggestions:u=!1,disableScrollToBottomButton:h=!1,reactionsToDisable:f}=n,{loader:p}=FB(),g=N(po),v=N(ai),y=N(jI),b=N(Ny),C=Nn({breakpoint:"sm"}),S=pe(Cn),E=Vx(),T=ee("sticky-conversation-mode"),I=Im()&&y!==null,k=ee("share-continue-v2"),x=!Ok();m.useEffect(()=>{T&&S(yp("sticky-conversation-mode")??ni())},[T,S]);const _=v==null?void 0:v.sideBySideComparisonId,R=!!_,[z,j]=m.useState(0);e5e();const J=m.useRef(null),D=JOe(J);YOe(g.length,J),KOe(J);const{isContextualShoppingCardExpanded:F,showShoppingCardInNewChat:ie}=QI();wU({scrollableRef:J,source:"chat",customData:{conversationId:v==null?void 0:v.id,...F&&{isContextualShoppingCardExpanded:F}}});const[U]=yx({...p,disabled:!!p.error}),{backstageMessagesProps:W,highlightedMessagesProps:ue,sentinelRef:te,sentinelClasses:Z,backstageClasses:Q,highlightedClasses:Ie,opacity:Ve,highlighted:ce,backstage:le}=PNe(()=>D({behavior:"instant",delay:me.instance().config().scrollToBottomDelay}),J,I,z,g),De=Rd(Ve,Le=>Le<.5?"none":"auto"),We=()=>D({behavior:"smooth"}),{bottomRef:be,shouldShowScrollToBottomButton:Me}=XOe({chatRef:J,hasMessages:g.length>0&&!h}),M=N(DI).get((v==null?void 0:v.id)??""),Y=!!(M!=null&&M.size),Se=M==null?void 0:M.values().next().value,P=N(ch);m.useEffect(()=>{v!=null&&v.id&&(t5e(v.id,g),n5e(()=>{$(()=>import("./ai-message-CLMTDRmz.js").then(Le=>Le.h),__vite__mapDeps([435,1,2,327,295,325,428,436,397,437,402,438,439,407,440]))}))},[v==null?void 0:v.id,g]),zOe(g,v==null?void 0:v.streamingState);const ne=fH(ce),ye=(ne==null?void 0:ne.author)==="human"&&ne.id===""||(v==null?void 0:v.streamingState)==="streaming",ae=!!N(Ef),q=N(dd),Te=m.useMemo(()=>{if((ne==null?void 0:ne.author)!=="ai")return!1;const Le=ne.content.at(-1);return(Le==null?void 0:Le.type)==="image"&&Le.status==="generating"},[ne]),ze=ye&&!Y||ae||q,{disableMultiturn:ht}=me.instance().config(),vt=(oe=(K=me.instance().config().styleOverrides)==null?void 0:K.width)==null?void 0:oe.chat;QOe(g.length,ye);const Ye=Aa(),st=sm(),Ot=!I&&!C&&st,Yt=N(Tm),on=s&&!(ie&&!C)&&!Yt,{isMediaViewerOpen:In}=ts(),zn=ee("chat-refactor-max-width"),V=zn?pH():void 0,we=zn?"w-full":Kx,Re=(v==null?void 0:v.streamingState)==="idle",Ue=!u&&!R,Xe=ze&&!R&&!Te,mt=ee("appearance-discoverability");GOe(mt);const qe=(Le,Ge=!1,ot,gt=!1)=>Le.map((ut,ft)=>{const tr=new Date(ut.createdAt),Vn=ft>0?Le[ft-1]:ot,Rr=Vn&&new Date(Vn.createdAt),An=!Rr||!Dx(tr,Rr),Ji=k&&OMe(v!=null&&v.continuedAt?new Date(v.continuedAt):null,tr,Rr);let ka;return hne(ut)?ka=d.jsx(POe,{message:ut,conversationId:v==null?void 0:v.id,animatingMessageIds:M,sideBySideComparisonId:_,isStreamingComplete:Re,shouldAnimate:Ge,reactionsToDisable:f,isLastMessage:gt&&ft===Le.length-1}):ut.author==="ai"?ka=d.jsx(m.Suspense,{fallback:E&&d.jsx(zx,{loadingType:E}),children:d.jsx(l5e,{message:ut,isStreamingComplete:Re,shouldAnimate:Ge,reactionsToDisable:f,isLastMessage:gt&&ft===Le.length-1})}):ka=d.jsx(c5e,{message:ut,className:V}),d.jsxs(m.Fragment,{children:[Ji&&d.jsx(xOe,{content:re("chat.continuedConversationDisclaimer")}),An&&!ht&&d.jsx(fOe,{date:tr,className:V}),ka]},ut.id)});return d.jsx(SH,{children:d.jsxs("div",{className:ke("scrollbar-stable flex size-full flex-col items-center overflow-y-auto overflow-x-hidden overscroll-contain text-foreground-800 @container/chat sm:min-w-chat-side-by-side",(v==null?void 0:v.id)&&L9(v.id)&&"t-custom-scrollbar",me.instance().config().showScrollbarOnHover&&"scrollbar-container",In&&!Yt&&"invisible",e),ref:J,"data-testid":"chat-page",children:[!c&&d.jsx(AH,{}),p.hasNextPage&&d.jsx("div",{ref:U}),I&&d.jsx(KNe,{animatingMessageId:Se,isStreamingMessage:ye,displayedCharacterId:y,setCharacterComponentHeight:j}),d.jsx(cc.Motion,{circular:!1,tabbable:!0,initial:x?"start":!1,animate:"end",variants:{start:ct,end:{...Rt,transition:{duration:.2,delay:.2}}},className:ke(t,"grow",!zn&&(Fp("pageContainer")??"px-6"),we,vt),layout:"position",transition:Vi,"data-content":"conversation","data-copy":"false",children:d.jsxs(m.Suspense,{fallback:d.jsx("div",{"aria-hidden":!0}),children:[d.jsxs(_e.div,{className:ke("relative",Ye||!c?"pt-10":"pt-6",le.length>0&&o5,on&&Q),variants:W.variants,initial:x?W.initial:!1,animate:W.animate,style:{opacity:g.length>0?Ve:0,pointerEvents:De},children:[d.jsx("div",{className:ke("absolute -z-10 w-full",Z),ref:te}),qe(le)]}),d.jsxs("div",{className:ke(o&&Ie,"flex flex-col"),"data-testid":"highlighted-chats",children:[d.jsx(Mn,{mode:"wait",initial:!1,children:d.jsxs(d.Fragment,{children:[d.jsx(TH,{customLaunchGreeting:i,chatItemClasses:V}),ce.length>0&&d.jsxs(_e.div,{className:ke(ht?"pb-24":"pb-6",o5),initial:ue.initial,animate:ue.animate,exit:ue.exit,onAnimationStart:ue.onAnimationStart,children:[qe(R?dne(ce,_):ce,Y,le[le.length-1]??void 0,!0),d.jsx(m.Suspense,{fallback:d.jsx("div",{"aria-hidden":!0}),children:Xe&&d.jsx(CH,{delay:u5e,className:V})}),d.jsx(On,{children:P&&d.jsx(HNe,{className:V})}),d.jsx(On,{children:b&&b.visible&&d.jsx(FNe,{className:V})})]},(ge=ce[0])==null?void 0:ge.createdAt)]})}),Ue&&d.jsx(LOe,{mostRecentMessageId:ne==null?void 0:ne.id,className:V}),d.jsx("div",{ref:be,style:{height:0,overflow:"hidden"}}),d.jsx(ROe,{shouldShowScrollToBottomButton:Me,onClick:We,bottomButtonClass:r}),ht&&!ze&&uy.createPortal(d.jsx(DNe,{title:re("tv.chat.moveToMultiturn"),onClick:()=>{const Le=new URL(window.location.origin);Le.searchParams.set("wtv","1"),Le.searchParams.set("oem","lg-multiturn"),Le.searchParams.set("form","LGTVTR"),Ch(Le.toString())},hoverVariant:!0,className:ke("fixed bottom-6 start-1/2 z-10 -translate-x-1/2 px-8 transition-opacity duration-300",Me?"pointer-events-none opacity-0":"opacity-100"),children:re("tv.chat.moveToMultiturn")}),document.body)]})]})}),Ot&&d.jsx(wH,{customBottomDisclaimer:a})]})})}const u8e=Object.freeze(Object.defineProperty({__proto__:null,CHAT_WIDTH_CLASSES:Kx,default:TT},Symbol.toStringTag,{value:"Module"}));function PH(n){var y,b;const{className:e,conversationContainerClassName:t="mb-[var(--composer-container-height)]",customLaunchGreeting:r,customBottomDisclaimer:i,disableStickyHeader:a=!1,enableBackstageClasses:o=!0,enableHighlightedClasses:s=!0}=n,c=ee("chat-refactor-max-width"),u=Nn({breakpoint:"sm"}),h=Aa(),f=!u,p=(b=(y=me.instance().config().styleOverrides)==null?void 0:y.width)==null?void 0:b.chat,g=c?pH():void 0,v=c?"w-full":Kx;return d.jsx(SH,{children:d.jsxs("div",{className:ke("scrollbar-stable flex size-full flex-col items-center overflow-y-auto overflow-x-hidden overscroll-contain text-foreground-800 sm:min-w-chat-side-by-side",me.instance().config().showScrollbarOnHover&&"scrollbar-container",e),"data-testid":"landing-page",children:[!a&&d.jsx(AH,{}),d.jsx(cc.Motion,{circular:!1,tabbable:!0,initial:"start",animate:"end",variants:{start:ct,end:{...Rt,transition:{duration:.2,delay:.2}}},className:ke(t,"grow",!c&&(Fp("pageContainer")??"px-6"),v,p),layout:"position",transition:Vi,children:d.jsxs(m.Suspense,{fallback:d.jsx("div",{"aria-hidden":!0}),children:[d.jsx("div",{className:ke("relative",h||!a?"pt-10":"pt-6",o&&dH)}),d.jsx("div",{className:ke("flex",s&&hH),children:d.jsx(Mn,{mode:"wait",initial:!1,children:d.jsx(TH,{customLaunchGreeting:r,chatItemClasses:g})})})]})}),f&&d.jsx(wH,{customBottomDisclaimer:i})]})})}const d5e=Tt("/")({component:PH});Tt("/w/landing")({component:PH});function h5e(n){const{text:e,shouldAnimate:t,title:r}=n,i=mF(!1),[a,o]=m.useState(0),s=m.useMemo(()=>{const c=i(),u=px(e);return Hp(u,c,()=>{o(a+1)})},[i,a,e]);return d.jsxs(d.Fragment,{children:[r&&d.jsx("span",{className:"text-foreground-600 text-sm",children:d.jsx("strong",{children:r})}),d.jsx("div",{className:"text-foreground-600 text-sm",children:d.jsx(Bp,{blocks:s,shouldAnimate:t})})]})}function f5e(n){const{items:e,shouldAnimate:t}=n,{t:r}=Ce();return d.jsxs("div",{className:"space-y-4 ps-2",children:[e==null?void 0:e.map((i,a)=>d.jsx("div",{className:"flex h-full flex-col",children:d.jsxs(s5,{isLastStep:!1,shouldAnimate:t,children:[i.type==="chainOfThought"&&d.jsx(h5e,{title:i.title,text:i.text,shouldAnimate:t}),i.type==="activity"&&d.jsx(p5e,{activity:i.activity})]})},a)),d.jsx(s5,{isLastStep:!0,shouldAnimate:t,children:d.jsx("span",{className:"text-foreground-600 text-sm",children:d.jsx("strong",{children:r("chat.chainOfThought.done")})})})]})}function p5e(n){const{activity:e}=n;return d.jsx("div",{className:"flex flex-col gap-4 overflow-y-auto",children:d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsx("h3",{children:e.title}),e.artifacts.map((t,r)=>d.jsx(oF,{artifact:t},r))]})})}function m5e(n){return n?d.jsx(bx,{className:"relative bottom-1 size-4 text-background-900"}):d.jsx("div",{className:"size-2 rounded-full bg-foreground-800"})}function s5(n){const{isLastStep:e,shouldAnimate:t,children:r}=n;return d.jsxs(_e.div,{className:"relative grid grid-cols-[auto,1fr] items-start gap-4",initial:t?"start":"end",animate:"end",variants:{start:ct,end:i=>({...Rt,transition:{delay:i,ease:"easeInOut",duration:1.2}})},children:[d.jsxs("div",{className:"relative mt-2 flex h-full w-2 flex-col items-center",children:[m5e(e),!e&&d.jsx("div",{className:"absolute bottom-0 top-4 w-0.5 bg-neutral-300"})]}),d.jsx("div",{className:"min-w-0 flex-1",children:r})]})}function g5e(n){const{chainOfThoughtItems:e}=n,{t}=Ce();return d.jsxs("div",{className:"flex h-full flex-col",children:[d.jsx("h2",{className:"p-6 text-base",children:t("chat.chainOfThought.title")}),d.jsx("div",{className:"flex-1 overflow-auto p-4",children:d.jsx(KSe,{config:{shouldCollapseCode:!0},children:d.jsx(f5e,{items:e,shouldAnimate:!1})})})]})}function IT(n){xn(NH,n)}function v5e(){return N(NH)}const NH=O(null),b5e=l.union([l.literal(!0),l.literal(!1)]);l.object({enabled:b5e.optional()});function y5e(){const n=v5e(),{t:e}=Ce(),t=Nn({breakpoint:"md"});return n?t?d.jsx(Gi,{isOpen:!!n,onClose:()=>IT(null),className:"max-h-[80vh] w-full max-w-md p-4",trapFocus:!0,children:d.jsx("div",{className:"h-full overflow-auto",children:d.jsx(c5,{panelData:n})})}):d.jsx(rx,{className:"ms-2.5 w-96 shrink-0",children:d.jsxs("div",{className:"size-full overflow-auto",children:[d.jsx(Ee,{title:e("common.closeText"),className:"absolute end-2 top-2",size:"32-xs",variant:"circle",onClick:()=>IT(null),children:d.jsx(vr,{className:"size-4"})}),d.jsx(c5,{panelData:n})]})}):null}function c5(n){const{panelData:e}=n;switch(e.type){case"devModeMessageInfo":return iL;case"chainOfThought":return d.jsx(g5e,{chainOfThoughtItems:e.data.chainOfThoughtItems});case"__TODO___REPLACE_ME__":throw new Error("ConversationPanelContent: Unimplemented type")}return null}const C5e=Qz("/chats/$conversationId");function S5e(n){const{disableStickyHeader:e,reactionsToDisable:t}=n,{conversationId:r}=C5e.useParams(),i=ee("chat-layout-v2"),a=pe(lt),o=ee("conversation-id-sync");return m.useEffect(()=>{o&&a(r)},[r,a,o]),m.useEffect(()=>()=>{IT(null)},[]),i?d.jsxs(d.Fragment,{children:[d.jsxs(rx,{className:"relative h-full flex-1 overflow-hidden will-change-auto",children:[d.jsx(TT,{disableStickyHeader:e,reactionsToDisable:t}),d.jsx(JB,{}),d.jsx(ZB,{}),d.jsx(XB,{})]}),d.jsx(y5e,{})]}):d.jsx(TT,{disableStickyHeader:e,reactionsToDisable:t})}const w5e=Tt("/chats/$conversationId")({component:S5e}),E5e=Tt("/topic-selection")(),T5e=Tt("/login")(),I5e=Tt("/library")(),A5e=Tt("/gaming")(),k5e=Tt("/gallery")(),x5e=Tt("/discover")(),_5e=Tt("/daily")(),M5e=Tt("/agents")(),R5e=Tt("/referrals/")(),P5e=Tt("/labs_/")(),N5e=Tt("/subscription/start")(),O5e=Tt("/subscription/manage")(),L5e=Tt("/shares/$conversationId")(),D5e=Tt("/referrals/rules")(),j5e=Tt("/pro/subscribe")(),U5e=Tt("/pages/$pageId")(),F5e=Tt("/memory/narrative")(),B5e=Tt("/gallery/$galleryItemId")(),H5e=Tt("/connector/callback")(),$5e=Tt("/chats/private")(),z5e=Tt("/campaigns/$campaignId")(),V5e=Tt("/labs_/portrait/")(),G5e=Tt("/labs_/career-coach/")(),K5e=Tt("/labs_/audio-expression/")(),q5e=Tt("/shares/podcasts/$shareId")(),W5e=Tt("/shares/pages/$shareId")(),Y5e=Tt("/shares/3d-generations/$shareId")(),Q5e=Tt("/pro/redeem/$redeemCode")(),J5e=Tt("/pro/ewallet/return")(),Z5e=Tt("/podcasts/$podcastType/$podcastId")(),X5e=Tt("/labs_/portrait/talk")(),eLe=Tt("/labs_/experiments/$experimentAlias")(),tLe=Tt("/chats_/$conversationId/talk")(),nLe=Tt("/labs_/experiments/3d-generations/")(),rLe=Tt("/labs_/experiments/3d-generations/my-creations")(),iLe=E5e.update({id:"/topic-selection",path:"/topic-selection",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./topic-selection.lazy-CdR_KxSR.js"),__vite__mapDeps([441,1,2])).then(n=>n.Route)),aLe=T5e.update({id:"/login",path:"/login",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./login.lazy-9FBkvvWL.js"),__vite__mapDeps([442,1,2,384])).then(n=>n.Route)),oLe=I5e.update({id:"/library",path:"/library",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./library.lazy-EQH5tEnn.js"),__vite__mapDeps([443,1,2,437])).then(n=>n.Route)),sLe=A5e.update({id:"/gaming",path:"/gaming",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./gaming.lazy-C6uR7s9W.js"),__vite__mapDeps([444,1,2,313,314])).then(n=>n.Route)),OH=k5e.update({id:"/gallery",path:"/gallery",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./gallery.lazy-1GLAMTi8.js"),__vite__mapDeps([445,1,2,446])).then(n=>n.Route)),cLe=x5e.update({id:"/discover",path:"/discover",getParentRoute:()=>kt}).lazy(()=>$(()=>Promise.resolve().then(()=>BDe),void 0).then(n=>n.Route)),lLe=_5e.update({id:"/daily",path:"/daily",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./daily.lazy-B_jExv77.js"),__vite__mapDeps([447,1,2,448,449,450,412,451,452,453,454,455,372,456,440,400])).then(n=>n.Route)),uLe=M5e.update({id:"/agents",path:"/agents",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./agents.lazy-cbhczogO.js"),__vite__mapDeps([457,1,2])).then(n=>n.Route)),dLe=ENe.update({id:"/",path:"/",getParentRoute:()=>kt}),hLe=R5e.update({id:"/referrals/",path:"/referrals/",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./index.lazy-CNfyqa1j.js"),__vite__mapDeps([458,1,2,302,301,300,304,459,460,461,462,463,464])).then(n=>n.Route)),fLe=P5e.update({id:"/labs_/",path:"/labs/",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./index.lazy-BdHxjyc2.js"),__vite__mapDeps([465,1,2,466,467,468,469,470,471,456])).then(n=>n.Route)),pLe=N5e.update({id:"/subscription/start",path:"/subscription/start",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./subscription.start.lazy-BXHMJ-Nz.js"),__vite__mapDeps([472,1,2])).then(n=>n.Route)),mLe=O5e.update({id:"/subscription/manage",path:"/subscription/manage",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./subscription.manage.lazy-C08MW6if.js"),__vite__mapDeps([473,1,2,282,325])).then(n=>n.Route)),gLe=L5e.update({id:"/shares/$conversationId",path:"/shares/$conversationId",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./shares._conversationId.lazy-BgjgJkrw.js"),__vite__mapDeps([474,1,2])).then(n=>n.Route)),vLe=D5e.update({id:"/referrals/rules",path:"/referrals/rules",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./rules.lazy-BsjnkSUs.js"),__vite__mapDeps([475,1,2,301,304,460,305,476])).then(n=>n.Route)),bLe=j5e.update({id:"/pro/subscribe",path:"/pro/subscribe",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./pro.subscribe.lazy-DQfNPLJ0.js"),__vite__mapDeps([477,1,2,320,321,322,323,478,479,371,480,481,482,483,286,287,292,484,485,486,289,487,295,488,312,489,490,491,319,301,492,493,494,495,496,313,314,497,498])).then(n=>n.Route)),yLe=U5e.update({id:"/pages/$pageId",path:"/pages/$pageId",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./pages._pageId.lazy-DUelTzVl.js"),__vite__mapDeps([499,1,2,500,438,501,502,503,504,505,506,507,508,509,381,510,402,451,327,511,512])).then(n=>n.Route)),CLe=F5e.update({id:"/memory/narrative",path:"/memory/narrative",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./memory.narrative.lazy-4F7d776S.js"),__vite__mapDeps([513,1,2,315])).then(n=>n.Route)),SLe=B5e.update({id:"/$galleryItemId",path:"/$galleryItemId",getParentRoute:()=>OH}).lazy(()=>$(()=>import("./gallery._galleryItemId.lazy-TeUZ9jtE.js"),__vite__mapDeps([514,1,2,515,516,517,446,518,335,387,388,389,391,392,393,394,395])).then(n=>n.Route)),wLe=H5e.update({id:"/connector/callback",path:"/connector/callback",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./connector.callback.lazy-z7usjpkH.js"),__vite__mapDeps([519,1,2,281])).then(n=>n.Route)),ELe=$5e.update({id:"/chats/private",path:"/chats/private",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./chats.private.lazy-BYz4vHP9.js"),__vite__mapDeps([520,1,2])).then(n=>n.Route)),TLe=z5e.update({id:"/campaigns/$campaignId",path:"/campaigns/$campaignId",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./campaigns._campaignId.lazy-Dw5u-0R_.js"),__vite__mapDeps([521,1,2])).then(n=>n.Route)),ILe=d5e.update({id:"/w/landing",path:"/w/landing",getParentRoute:()=>kt}),ALe=w5e.update({id:"/chats/$conversationId",path:"/chats/$conversationId",getParentRoute:()=>kt}),kLe=V5e.update({id:"/labs_/portrait/",path:"/labs/portrait/",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./index.lazy-MxHJ-6X0.js"),__vite__mapDeps([522,1,2])).then(n=>n.Route)),xLe=G5e.update({id:"/labs_/career-coach/",path:"/labs/career-coach/",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./index.lazy-B4IbhNf9.js"),__vite__mapDeps([523,1,2])).then(n=>n.Route)),_Le=K5e.update({id:"/labs_/audio-expression/",path:"/labs/audio-expression/",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./index.lazy-D3_ZPNwd.js"),__vite__mapDeps([524,1,2,313,314,525,369,370,367,368,372])).then(n=>n.Route)),MLe=q5e.update({id:"/shares/podcasts/$shareId",path:"/shares/podcasts/$shareId",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./shares.podcasts._shareId.lazy-Cx4_re_x.js"),__vite__mapDeps([526,1,2,440,417,454,455])).then(n=>n.Route)),RLe=W5e.update({id:"/shares/pages/$shareId",path:"/shares/pages/$shareId",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./shares.pages._shareId.lazy-BB-6mrjp.js"),__vite__mapDeps([527,1,2,512,500,438,501,502,503,504,505,506,507,508,509,381,510,402,451,327,511,528])).then(n=>n.Route)),PLe=Y5e.update({id:"/shares/3d-generations/$shareId",path:"/shares/3d-generations/$shareId",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./shares.3d-generations._shareId.lazy-CeSO_8QC.js"),__vite__mapDeps([529,1,2,530,312,466,531,532])).then(n=>n.Route)),NLe=Q5e.update({id:"/pro/redeem/$redeemCode",path:"/pro/redeem/$redeemCode",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./pro.redeem._redeemCode.lazy-imHRWvT0.js"),__vite__mapDeps([533,1,2])).then(n=>n.Route)),OLe=J5e.update({id:"/pro/ewallet/return",path:"/pro/ewallet/return",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./pro.ewallet.return.lazy-DoqCe-8t.js"),__vite__mapDeps([534,1,2,479,371])).then(n=>n.Route)),LLe=Z5e.update({id:"/podcasts/$podcastType/$podcastId",path:"/podcasts/$podcastType/$podcastId",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./podcasts._podcastType._podcastId.lazy-OvLz0Rpc.js"),__vite__mapDeps([535,1,2,448,449,450,412,451,452,453,454,455,372,456,440,400])).then(n=>n.Route)),DLe=X5e.update({id:"/labs_/portrait/talk",path:"/labs/portrait/talk",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./talk.lazy-ByTbS8jw.js"),__vite__mapDeps([536,1,2,537,538,539,540,456])).then(n=>n.Route)),jLe=eLe.update({id:"/labs_/experiments/$experimentAlias",path:"/labs/experiments/$experimentAlias",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./experiments._experimentAlias.lazy-DltToVGk.js").then(n=>n.e),__vite__mapDeps([541,1,2,456,369,370,466,467,468,469,470,471])).then(n=>n.Route)),ULe=tLe.update({id:"/chats_/$conversationId/talk",path:"/chats/$conversationId/talk",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./chats_._conversationId.talk.lazy-BtIA4mJc.js"),__vite__mapDeps([542,1,2,537,538,539,540,456])).then(n=>n.Route)),FLe=nLe.update({id:"/labs_/experiments/3d-generations/",path:"/labs/experiments/3d-generations/",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./my-creations.lazy-Jl84Myq0.js").then(n=>n.i),__vite__mapDeps([543,1,2,530,312,466,544,525,379,518,335,314,449,450,412,545])).then(n=>n.Route)),BLe=rLe.update({id:"/labs_/experiments/3d-generations/my-creations",path:"/labs/experiments/3d-generations/my-creations",getParentRoute:()=>kt}).lazy(()=>$(()=>import("./my-creations.lazy-Jl84Myq0.js").then(n=>n.m),__vite__mapDeps([543,1,2,530,312,466,544,525,379,518,335,314,449,450,412,545])).then(n=>n.Route)),HLe={GalleryGalleryItemIdLazyRoute:SLe},$Le=OH._addFileChildren(HLe),zLe={IndexRoute:dLe,AgentsLazyRoute:uLe,DailyLazyRoute:lLe,DiscoverLazyRoute:cLe,GalleryLazyRoute:$Le,GamingLazyRoute:sLe,LibraryLazyRoute:oLe,LoginLazyRoute:aLe,TopicSelectionLazyRoute:iLe,ChatsConversationIdRoute:ALe,WLandingRoute:ILe,CampaignsCampaignIdLazyRoute:TLe,ChatsPrivateLazyRoute:ELe,ConnectorCallbackLazyRoute:wLe,MemoryNarrativeLazyRoute:CLe,PagesPageIdLazyRoute:yLe,ProSubscribeLazyRoute:bLe,ReferralsRulesLazyRoute:vLe,SharesConversationIdLazyRoute:gLe,SubscriptionManageLazyRoute:mLe,SubscriptionStartLazyRoute:pLe,LabsIndexLazyRoute:fLe,ReferralsIndexLazyRoute:hLe,ChatsConversationIdTalkLazyRoute:ULe,LabsExperimentsExperimentAliasLazyRoute:jLe,LabsPortraitTalkLazyRoute:DLe,PodcastsPodcastTypePodcastIdLazyRoute:LLe,ProEwalletReturnLazyRoute:OLe,ProRedeemRedeemCodeLazyRoute:NLe,Shares3dGenerationsShareIdLazyRoute:PLe,SharesPagesShareIdLazyRoute:RLe,SharesPodcastsShareIdLazyRoute:MLe,LabsAudioExpressionIndexLazyRoute:_Le,LabsCareerCoachIndexLazyRoute:xLe,LabsPortraitIndexLazyRoute:kLe,LabsExperiments3dGenerationsMyCreationsLazyRoute:BLe,LabsExperiments3dGenerationsIndexLazyRoute:FLe},VLe=kt._addFileChildren(zLe)._addFileTypes(),uu=Jz({routeTree:VLe});function GLe(){return d.jsx(Zz,{router:uu})}(function(){const n="onabort onactivate onactivateinvisible onafterprint onafterupdate onanimationcancel onanimationend onanimationiteration onanimationstart onariarequest onauxclick onbeforeactivate onbeforecopy onbeforecut onbeforedeactivate onbeforeeditfocus onbeforepaste onbeforeprint onbeforeunload onbegin onblur onbounce oncancel oncanplay oncanplaythrough oncellchange onchange onclick onclose oncommand oncontextmenu oncontrolselect oncopy oncuechange oncut ondataavailable ondatasetchanged ondatasetcomplete ondblclick ondeactivate ondrag ondragdrop ondragend ondragenter ondragexit ondragleave ondragover ondragstart ondrop ondurationchange onemptied onend onended onerror onerrorupdate onexit onfilterchange onfinish onfocus onfocusin onfocusout onformdata onfullscreenchange onfullscreenerror ongotpointercapture onhelp oninput oninvalid onkeydown onkeypress onkeyup onlayoutcomplete onload onloadeddata onloadedmetadata onloadend onloadstart onlosecapture onlostpointercapture onmediacomplete onmediaerror onmessage onmousedown onmouseenter onmouseleave onmousemove onmouseout onmouseover onmouseup onmousewheel onmove onmoveend onmovestart onmozfullscreenchange onmozfullscreenerror onmscontentzoom onmsgesturechange onmsgesturedoubletap onmsgestureend onmsgesturehold onmsgesturestart onmsgesturetap onmsgotpointercapture onmsinertiastart onmslostpointercapture onmsmanipulationstatechanged onmspointercancel onmspointerdown onmspointerenter onmspointerleave onmspointermove onmspointerout onmspointerover onmspointerup onoffline ononline onoutofsync onoverscroll onpaste onpause onplay onplaying onpointercancel onpointerdown onpointerenter onpointerleave onpointermove onpointerout onpointerover onpointerrawupdate onpointerup onprogress onpropertychange onratechange onreadystatechange onrepeat onreset onresize onresizeend onresizestart onresume onreverse onrowdelete onrowenter onrowexit onrowinserted onscroll onscrollend onsearch onseek onseeked onseeking onselect onselectionchange onselectstart onshow onstalled onstart onstop onstorage onsubmit onsuspend onsynchrestored ontimeerror ontimeupdate ontoggle ontrackchange ontransitioncancel ontransitionend ontransitionrun ontransitionstart onunload onurlflip onvolumechange onwaiting onwebkitanimationend onwebkitanimationiteration onwebkitanimationstart onwebkitfullscreenchange onwebkitfullscreenerror onwebkittransitionend onwheel".split(" ");function e(){if(typeof window<"u"){const f=[];for(const p in HTMLElement.prototype)p.slice(0,2)==="on"&&f.push(p);return f}return n}const t=typeof window<"u",r=()=>{throw new TypeError("undefined conversion")},i=()=>null,{toLowerCase:a,toUpperCase:o}=String.prototype;function s(){throw new TypeError("Illegal constructor")}function c(){throw new TypeError("Illegal constructor")}const{l:u}=function(){function f(be){let Me=J.get(be);return Me===void 0&&(Me=E(null),J.set(be,Me)),Me}function p(be){const Me=k(be);if(Me==null||k(Me)!==x)throw Error();for(const xe of I(Me))T(be,xe,{value:be[xe]});return be}function g(be,Me){A(be.prototype),delete be.name,T(be,"name",{value:Me})}function v(be){return Me=>Me instanceof be&&J.has(Me)}function y(be,Me){function xe(Y,Se){const P=Me[Se]||(be=="default"?i:r),ne=A(new Y(j,be));return A({[Se](ye,...ae){if(ye=P(""+ye,...ae),ye==null){if(be=="default")return ye;ye=""}return ye=""+ye,ae=A(E(ne)),f(ae).v=ye,ae}}[Se])}const M=E(s.prototype);for(const Y of I(De))M[Y]=xe(De[Y],Y);return T(M,"name",{value:be,writable:!1,configurable:!1,enumerable:!0}),A(M)}function b(be,Me,xe,M="",Y=""){if(be=o.apply(String(be)),(M=Y||M)||(M="http://www.w3.org/1999/xhtml"),M=_.apply(ce,[M])?ce[M]:null){if(_.apply(M,[be])&&M[be]&&_.apply(M[be][Me],[xe])&&M[be][Me][xe])return M[be][Me][xe];if(_.apply(M,["*"])&&_.apply(M["*"][Me],[xe])&&M["*"][Me][xe])return M["*"][Me][xe]}}function C(){return U}const{assign:S,create:E,defineProperty:T,freeze:A,getOwnPropertyNames:I,getPrototypeOf:k,prototype:x}=Object,{hasOwnProperty:_}=x,{forEach:R,push:z}=Array.prototype,j=Symbol(),J=p(new WeakMap),D=p([]),F=p([]);let ie=!0,U=null,W=!1;class ue{constructor(Me,xe){if(Me!==j)throw Error("cannot call the constructor");T(this,"policyName",{value:xe,enumerable:!0})}toString(){return f(this).v}valueOf(){return f(this).v}}class te extends ue{}g(te,"TrustedScriptURL");class Z extends ue{}g(Z,"TrustedHTML");class Q extends ue{}g(Q,"TrustedScript"),g(ue,"TrustedType");const Ie=A(E(new Z(j,"")));f(Ie).v="";const Ve=A(E(new Q(j,"")));f(Ve).v="";const ce={"http://www.w3.org/1999/xhtml":{EMBED:{attributes:{src:te.name}},IFRAME:{attributes:{srcdoc:Z.name}},OBJECT:{attributes:{data:te.name,codebase:te.name}},SCRIPT:{attributes:{src:te.name,text:Q.name},properties:{innerText:Q.name,textContent:Q.name,text:Q.name}},"*":{attributes:{},properties:{innerHTML:Z.name,outerHTML:Z.name}}},"http://www.w3.org/2000/svg":{"*":{attributes:{},properties:{}}}};var le={codebase:"codeBase",formaction:"formAction"};!t||"srcdoc"in HTMLIFrameElement.prototype||delete ce["http://www.w3.org/1999/xhtml"].IFRAME.attributes.srcdoc;for(const be of Object.keys(ce["http://www.w3.org/1999/xhtml"])){ce["http://www.w3.org/1999/xhtml"][be].properties||(ce["http://www.w3.org/1999/xhtml"][be].properties={});for(const Me of Object.keys(ce["http://www.w3.org/1999/xhtml"][be].attributes))ce["http://www.w3.org/1999/xhtml"][be].properties[le[Me]?le[Me]:Me]=ce["http://www.w3.org/1999/xhtml"][be].attributes[Me]}for(const be of e())ce["http://www.w3.org/1999/xhtml"]["*"].attributes[be]="TrustedScript",ce["http://www.w3.org/2000/svg"]["*"].attributes[be]="TrustedScript";const De={createHTML:Z,createScriptURL:te,createScript:Q},We=De.hasOwnProperty;return le=E(c.prototype),S(le,{createPolicy:function(be,Me){if(!be.match(/^[-#a-zA-Z0-9=_/@.%]+$/g))throw new TypeError("Policy "+be+" contains invalid characters.");if(W&&F.indexOf(be)===-1&&F.indexOf("*")===-1)throw new TypeError("Policy "+be+" disallowed.");if(be==="default"&&U)throw new TypeError("Policy "+be+" already exists.");if(W&&!ie&&D.indexOf(be)!==-1)throw new TypeError("Policy "+be+" exists.");D.push(be);const xe=E(null);if(Me&&typeof Me=="object")for(const M of I(Me))We.call(De,M)&&(xe[M]=Me[M]);else console.warn("trustedTypes.createPolicy "+be+" was given an empty policy");return A(xe),Me=y(be,xe),be==="default"&&(U=Me),Me},h:v(Z),j:v(te),i:v(Q),c:function(be,Me,xe="",M=""){return Me=a.apply(String(Me)),b(be,"attributes",Me,xe,M)||null},f:function(be,Me,xe=""){return b(be,"properties",String(Me),xe)||null},g:function(be=""){if(!be)try{be=document.documentElement.namespaceURI}catch{be="http://www.w3.org/1999/xhtml"}return(be=ce[be])?JSON.parse(JSON.stringify(be)):{}},a:Ie,b:Ve,o:U,TrustedHTML:Z,TrustedScriptURL:te,TrustedScript:Q}),T(le,"defaultPolicy",{get:C,set:()=>{}}),{l:A(le),w:function(be,Me){W=!0,F.length=0,R.call(be,xe=>{z.call(F,""+xe)}),ie=Me,D.length=0},m:function(){W=!1},s:C,u:function(){U=null,D.splice(D.indexOf("default"),1)}}}();if(typeof window<"u"&&(window.TrustedTypes&&typeof window.trustedTypes>"u"&&(window.trustedTypes=Object.freeze(window.TrustedTypes)),typeof window.trustedTypes>"u")){var h=Object.create(c.prototype);Object.assign(h,{isHTML:u.h,isScriptURL:u.j,isScript:u.i,createPolicy:u.createPolicy,getAttributeType:u.c,getPropertyType:u.f,getTypeMapping:u.g,emptyHTML:u.a,emptyScript:u.b,_isPolyfill_:!0}),Object.defineProperty(h,"defaultPolicy",Object.getOwnPropertyDescriptor(u,"defaultPolicy")||{}),window.trustedTypes=Object.freeze(h),window.TrustedHTML=u.TrustedHTML,window.TrustedScriptURL=u.TrustedScriptURL,window.TrustedScript=u.TrustedScript,window.TrustedTypePolicy=s,window.TrustedTypePolicyFactory=c}}).call(void 0);/*! @license DOMPurify 3.2.4 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.4/LICENSE */const{entries:LH,setPrototypeOf:l5,isFrozen:KLe,getPrototypeOf:qLe,getOwnPropertyDescriptor:WLe}=Object;let{freeze:Kr,seal:Ki,create:DH}=Object,{apply:AT,construct:kT}=typeof Reflect<"u"&&Reflect;Kr||(Kr=function(e){return e});Ki||(Ki=function(e){return e});AT||(AT=function(e,t,r){return e.apply(t,r)});kT||(kT=function(e,t){return new e(...t)});const zg=qr(Array.prototype.forEach),YLe=qr(Array.prototype.lastIndexOf),u5=qr(Array.prototype.pop),gf=qr(Array.prototype.push),QLe=qr(Array.prototype.splice),bv=qr(String.prototype.toLowerCase),Uw=qr(String.prototype.toString),d5=qr(String.prototype.match),vf=qr(String.prototype.replace),JLe=qr(String.prototype.indexOf),ZLe=qr(String.prototype.trim),ia=qr(Object.prototype.hasOwnProperty),Dr=qr(RegExp.prototype.test),bf=XLe(TypeError);function qr(n){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return AT(n,e,r)}}function XLe(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kT(n,t)}}function xt(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:bv;l5&&l5(n,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){const a=t(i);a!==i&&(KLe(e)||(e[r]=a),i=a)}n[i]=!0}return n}function eDe(n){for(let e=0;e<n.length;e++)ia(n,e)||(n[e]=null);return n}function Ic(n){const e=DH(null);for(const[t,r]of LH(n))ia(n,t)&&(Array.isArray(r)?e[t]=eDe(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=Ic(r):e[t]=r);return e}function yf(n,e){for(;n!==null;){const r=WLe(n,e);if(r){if(r.get)return qr(r.get);if(typeof r.value=="function")return qr(r.value)}n=qLe(n)}function t(){return null}return t}const h5=Kr(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Fw=Kr(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Bw=Kr(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),tDe=Kr(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Hw=Kr(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),nDe=Kr(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),f5=Kr(["#text"]),p5=Kr(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),$w=Kr(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),m5=Kr(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Vg=Kr(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),rDe=Ki(/\{\{[\w\W]*|[\w\W]*\}\}/gm),iDe=Ki(/<%[\w\W]*|[\w\W]*%>/gm),aDe=Ki(/\$\{[\w\W]*/gm),oDe=Ki(/^data-[\-\w.\u00B7-\uFFFF]+$/),sDe=Ki(/^aria-[\-\w]+$/),jH=Ki(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),cDe=Ki(/^(?:\w+script|data):/i),lDe=Ki(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),UH=Ki(/^html$/i),uDe=Ki(/^[a-z][.\w]*(-[.\w]+)+$/i);var g5=Object.freeze({__proto__:null,ARIA_ATTR:sDe,ATTR_WHITESPACE:lDe,CUSTOM_ELEMENT:uDe,DATA_ATTR:oDe,DOCTYPE_NAME:UH,ERB_EXPR:iDe,IS_ALLOWED_URI:jH,IS_SCRIPT_OR_DATA:cDe,MUSTACHE_EXPR:rDe,TMPLIT_EXPR:aDe});const Cf={element:1,text:3,progressingInstruction:7,comment:8,document:9},dDe=function(){return typeof window>"u"?null:window},hDe=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(r=t.getAttribute(i));const a="dompurify"+(r?"#"+r:"");try{return e.createPolicy(a,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+a+" could not be created."),null}},v5=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function FH(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:dDe();const e=at=>FH(at);if(e.version="3.2.4",e.removed=[],!n||!n.document||n.document.nodeType!==Cf.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const r=t,i=r.currentScript,{DocumentFragment:a,HTMLTemplateElement:o,Node:s,Element:c,NodeFilter:u,NamedNodeMap:h=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:f,DOMParser:p,trustedTypes:g}=n,v=c.prototype,y=yf(v,"cloneNode"),b=yf(v,"remove"),C=yf(v,"nextSibling"),S=yf(v,"childNodes"),E=yf(v,"parentNode");if(typeof o=="function"){const at=t.createElement("template");at.content&&at.content.ownerDocument&&(t=at.content.ownerDocument)}let T,A="";const{implementation:I,createNodeIterator:k,createDocumentFragment:x,getElementsByTagName:_}=t,{importNode:R}=r;let z=v5();e.isSupported=typeof LH=="function"&&typeof E=="function"&&I&&I.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:j,ERB_EXPR:J,TMPLIT_EXPR:D,DATA_ATTR:F,ARIA_ATTR:ie,IS_SCRIPT_OR_DATA:U,ATTR_WHITESPACE:W,CUSTOM_ELEMENT:ue}=g5;let{IS_ALLOWED_URI:te}=g5,Z=null;const Q=xt({},[...h5,...Fw,...Bw,...Hw,...f5]);let Ie=null;const Ve=xt({},[...p5,...$w,...m5,...Vg]);let ce=Object.seal(DH(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),le=null,De=null,We=!0,be=!0,Me=!1,xe=!0,M=!1,Y=!0,Se=!1,P=!1,ne=!1,ye=!1,ae=!1,q=!1,Te=!0,ze=!1;const ht="user-content-";let vt=!0,Ye=!1,st={},Ot=null;const Yt=xt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let on=null;const In=xt({},["audio","video","img","source","image","track"]);let zn=null;const V=xt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),we="http://www.w3.org/1998/Math/MathML",Re="http://www.w3.org/2000/svg",Ue="http://www.w3.org/1999/xhtml";let Xe=Ue,mt=!1,qe=null;const K=xt({},[we,Re,Ue],Uw);let oe=xt({},["mi","mo","mn","ms","mtext"]),ge=xt({},["annotation-xml"]);const Le=xt({},["title","style","font","a","script"]);let Ge=null;const ot=["application/xhtml+xml","text/html"],gt="text/html";let ut=null,ft=null;const tr=t.createElement("form"),Vn=function(G){return G instanceof RegExp||G instanceof Function},Rr=function(){let G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(ft&&ft===G)){if((!G||typeof G!="object")&&(G={}),G=Ic(G),Ge=ot.indexOf(G.PARSER_MEDIA_TYPE)===-1?gt:G.PARSER_MEDIA_TYPE,ut=Ge==="application/xhtml+xml"?Uw:bv,Z=ia(G,"ALLOWED_TAGS")?xt({},G.ALLOWED_TAGS,ut):Q,Ie=ia(G,"ALLOWED_ATTR")?xt({},G.ALLOWED_ATTR,ut):Ve,qe=ia(G,"ALLOWED_NAMESPACES")?xt({},G.ALLOWED_NAMESPACES,Uw):K,zn=ia(G,"ADD_URI_SAFE_ATTR")?xt(Ic(V),G.ADD_URI_SAFE_ATTR,ut):V,on=ia(G,"ADD_DATA_URI_TAGS")?xt(Ic(In),G.ADD_DATA_URI_TAGS,ut):In,Ot=ia(G,"FORBID_CONTENTS")?xt({},G.FORBID_CONTENTS,ut):Yt,le=ia(G,"FORBID_TAGS")?xt({},G.FORBID_TAGS,ut):{},De=ia(G,"FORBID_ATTR")?xt({},G.FORBID_ATTR,ut):{},st=ia(G,"USE_PROFILES")?G.USE_PROFILES:!1,We=G.ALLOW_ARIA_ATTR!==!1,be=G.ALLOW_DATA_ATTR!==!1,Me=G.ALLOW_UNKNOWN_PROTOCOLS||!1,xe=G.ALLOW_SELF_CLOSE_IN_ATTR!==!1,M=G.SAFE_FOR_TEMPLATES||!1,Y=G.SAFE_FOR_XML!==!1,Se=G.WHOLE_DOCUMENT||!1,ye=G.RETURN_DOM||!1,ae=G.RETURN_DOM_FRAGMENT||!1,q=G.RETURN_TRUSTED_TYPE||!1,ne=G.FORCE_BODY||!1,Te=G.SANITIZE_DOM!==!1,ze=G.SANITIZE_NAMED_PROPS||!1,vt=G.KEEP_CONTENT!==!1,Ye=G.IN_PLACE||!1,te=G.ALLOWED_URI_REGEXP||jH,Xe=G.NAMESPACE||Ue,oe=G.MATHML_TEXT_INTEGRATION_POINTS||oe,ge=G.HTML_INTEGRATION_POINTS||ge,ce=G.CUSTOM_ELEMENT_HANDLING||{},G.CUSTOM_ELEMENT_HANDLING&&Vn(G.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ce.tagNameCheck=G.CUSTOM_ELEMENT_HANDLING.tagNameCheck),G.CUSTOM_ELEMENT_HANDLING&&Vn(G.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ce.attributeNameCheck=G.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),G.CUSTOM_ELEMENT_HANDLING&&typeof G.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ce.allowCustomizedBuiltInElements=G.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),M&&(be=!1),ae&&(ye=!0),st&&(Z=xt({},f5),Ie=[],st.html===!0&&(xt(Z,h5),xt(Ie,p5)),st.svg===!0&&(xt(Z,Fw),xt(Ie,$w),xt(Ie,Vg)),st.svgFilters===!0&&(xt(Z,Bw),xt(Ie,$w),xt(Ie,Vg)),st.mathMl===!0&&(xt(Z,Hw),xt(Ie,m5),xt(Ie,Vg))),G.ADD_TAGS&&(Z===Q&&(Z=Ic(Z)),xt(Z,G.ADD_TAGS,ut)),G.ADD_ATTR&&(Ie===Ve&&(Ie=Ic(Ie)),xt(Ie,G.ADD_ATTR,ut)),G.ADD_URI_SAFE_ATTR&&xt(zn,G.ADD_URI_SAFE_ATTR,ut),G.FORBID_CONTENTS&&(Ot===Yt&&(Ot=Ic(Ot)),xt(Ot,G.FORBID_CONTENTS,ut)),vt&&(Z["#text"]=!0),Se&&xt(Z,["html","head","body"]),Z.table&&(xt(Z,["tbody"]),delete le.tbody),G.TRUSTED_TYPES_POLICY){if(typeof G.TRUSTED_TYPES_POLICY.createHTML!="function")throw bf('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof G.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw bf('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');T=G.TRUSTED_TYPES_POLICY,A=T.createHTML("")}else T===void 0&&(T=hDe(g,i)),T!==null&&typeof A=="string"&&(A=T.createHTML(""));Kr&&Kr(G),ft=G}},An=xt({},[...Fw,...Bw,...tDe]),Ji=xt({},[...Hw,...nDe]),ka=function(G){let je=E(G);(!je||!je.tagName)&&(je={namespaceURI:Xe,tagName:"template"});const Qe=bv(G.tagName),zt=bv(je.tagName);return qe[G.namespaceURI]?G.namespaceURI===Re?je.namespaceURI===Ue?Qe==="svg":je.namespaceURI===we?Qe==="svg"&&(zt==="annotation-xml"||oe[zt]):!!An[Qe]:G.namespaceURI===we?je.namespaceURI===Ue?Qe==="math":je.namespaceURI===Re?Qe==="math"&&ge[zt]:!!Ji[Qe]:G.namespaceURI===Ue?je.namespaceURI===Re&&!ge[zt]||je.namespaceURI===we&&!oe[zt]?!1:!Ji[Qe]&&(Le[Qe]||!An[Qe]):!!(Ge==="application/xhtml+xml"&&qe[G.namespaceURI]):!1},xi=function(G){gf(e.removed,{element:G});try{E(G).removeChild(G)}catch{b(G)}},du=function(G,je){try{gf(e.removed,{attribute:je.getAttributeNode(G),from:je})}catch{gf(e.removed,{attribute:null,from:je})}if(je.removeAttribute(G),G==="is")if(ye||ae)try{xi(je)}catch{}else try{je.setAttribute(G,"")}catch{}},Pr=function(G){let je=null,Qe=null;if(ne)G="<remove></remove>"+G;else{const Fn=d5(G,/^[\r\n\t ]+/);Qe=Fn&&Fn[0]}Ge==="application/xhtml+xml"&&Xe===Ue&&(G='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+G+"</body></html>");const zt=T?T.createHTML(G):G;if(Xe===Ue)try{je=new p().parseFromString(zt,Ge)}catch{}if(!je||!je.documentElement){je=I.createDocument(Xe,"template",null);try{je.documentElement.innerHTML=mt?A:zt}catch{}}const nr=je.body||je.documentElement;return G&&Qe&&nr.insertBefore(t.createTextNode(Qe),nr.childNodes[0]||null),Xe===Ue?_.call(je,Se?"html":"body")[0]:Se?je.documentElement:nr},Nm=function(G){return k.call(G.ownerDocument||G,G,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Rh=function(G){return G instanceof f&&(typeof G.nodeName!="string"||typeof G.textContent!="string"||typeof G.removeChild!="function"||!(G.attributes instanceof h)||typeof G.removeAttribute!="function"||typeof G.setAttribute!="function"||typeof G.namespaceURI!="string"||typeof G.insertBefore!="function"||typeof G.hasChildNodes!="function")},Ph=function(G){return typeof s=="function"&&G instanceof s};function Ln(at,G,je){zg(at,Qe=>{Qe.call(e,G,je,ft)})}const Gn=function(G){let je=null;if(Ln(z.beforeSanitizeElements,G,null),Rh(G))return xi(G),!0;const Qe=ut(G.nodeName);if(Ln(z.uponSanitizeElement,G,{tagName:Qe,allowedTags:Z}),G.hasChildNodes()&&!Ph(G.firstElementChild)&&Dr(/<[/\w]/g,G.innerHTML)&&Dr(/<[/\w]/g,G.textContent)||G.nodeType===Cf.progressingInstruction||Y&&G.nodeType===Cf.comment&&Dr(/<[/\w]/g,G.data))return xi(G),!0;if(!Z[Qe]||le[Qe]){if(!le[Qe]&&Om(Qe)&&(ce.tagNameCheck instanceof RegExp&&Dr(ce.tagNameCheck,Qe)||ce.tagNameCheck instanceof Function&&ce.tagNameCheck(Qe)))return!1;if(vt&&!Ot[Qe]){const zt=E(G)||G.parentNode,nr=S(G)||G.childNodes;if(nr&&zt){const Fn=nr.length;for(let Sr=Fn-1;Sr>=0;--Sr){const pr=y(nr[Sr],!0);pr.__removalCount=(G.__removalCount||0)+1,zt.insertBefore(pr,C(G))}}}return xi(G),!0}return G instanceof c&&!ka(G)||(Qe==="noscript"||Qe==="noembed"||Qe==="noframes")&&Dr(/<\/no(script|embed|frames)/i,G.innerHTML)?(xi(G),!0):(M&&G.nodeType===Cf.text&&(je=G.textContent,zg([j,J,D],zt=>{je=vf(je,zt," ")}),G.textContent!==je&&(gf(e.removed,{element:G.cloneNode()}),G.textContent=je)),Ln(z.afterSanitizeElements,G,null),!1)},hu=function(G,je,Qe){if(Te&&(je==="id"||je==="name")&&(Qe in t||Qe in tr))return!1;if(!(be&&!De[je]&&Dr(F,je))){if(!(We&&Dr(ie,je))){if(!Ie[je]||De[je]){if(!(Om(G)&&(ce.tagNameCheck instanceof RegExp&&Dr(ce.tagNameCheck,G)||ce.tagNameCheck instanceof Function&&ce.tagNameCheck(G))&&(ce.attributeNameCheck instanceof RegExp&&Dr(ce.attributeNameCheck,je)||ce.attributeNameCheck instanceof Function&&ce.attributeNameCheck(je))||je==="is"&&ce.allowCustomizedBuiltInElements&&(ce.tagNameCheck instanceof RegExp&&Dr(ce.tagNameCheck,Qe)||ce.tagNameCheck instanceof Function&&ce.tagNameCheck(Qe))))return!1}else if(!zn[je]){if(!Dr(te,vf(Qe,W,""))){if(!((je==="src"||je==="xlink:href"||je==="href")&&G!=="script"&&JLe(Qe,"data:")===0&&on[G])){if(!(Me&&!Dr(U,vf(Qe,W,"")))){if(Qe)return!1}}}}}}return!0},Om=function(G){return G!=="annotation-xml"&&d5(G,ue)},Lm=function(G){Ln(z.beforeSanitizeAttributes,G,null);const{attributes:je}=G;if(!je||Rh(G))return;const Qe={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ie,forceKeepAttr:void 0};let zt=je.length;for(;zt--;){const nr=je[zt],{name:Fn,namespaceURI:Sr,value:pr}=nr,yo=ut(Fn);let mr=Fn==="value"?pr:ZLe(pr);if(Qe.attrName=yo,Qe.attrValue=mr,Qe.keepAttr=!0,Qe.forceKeepAttr=void 0,Ln(z.uponSanitizeAttribute,G,Qe),mr=Qe.attrValue,ze&&(yo==="id"||yo==="name")&&(du(Fn,G),mr=ht+mr),Y&&Dr(/((--!?|])>)|<\/(style|title)/i,mr)){du(Fn,G);continue}if(Qe.forceKeepAttr||(du(Fn,G),!Qe.keepAttr))continue;if(!xe&&Dr(/\/>/i,mr)){du(Fn,G);continue}M&&zg([j,J,D],Dm=>{mr=vf(mr,Dm," ")});const Nr=ut(G.nodeName);if(hu(Nr,yo,mr)){if(T&&typeof g=="object"&&typeof g.getAttributeType=="function"&&!Sr)switch(g.getAttributeType(Nr,yo)){case"TrustedHTML":{mr=T.createHTML(mr);break}case"TrustedScriptURL":{mr=T.createScriptURL(mr);break}}try{Sr?G.setAttributeNS(Sr,Fn,mr):G.setAttribute(Fn,mr),Rh(G)?xi(G):u5(e.removed)}catch{}}}Ln(z.afterSanitizeAttributes,G,null)},Zi=function at(G){let je=null;const Qe=Nm(G);for(Ln(z.beforeSanitizeShadowDOM,G,null);je=Qe.nextNode();)Ln(z.uponSanitizeShadowNode,je,null),Gn(je),Lm(je),je.content instanceof a&&at(je.content);Ln(z.afterSanitizeShadowDOM,G,null)};return e.sanitize=function(at){let G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},je=null,Qe=null,zt=null,nr=null;if(mt=!at,mt&&(at="<!-->"),typeof at!="string"&&!Ph(at))if(typeof at.toString=="function"){if(at=at.toString(),typeof at!="string")throw bf("dirty is not a string, aborting")}else throw bf("toString is not a function");if(!e.isSupported)return at;if(P||Rr(G),e.removed=[],typeof at=="string"&&(Ye=!1),Ye){if(at.nodeName){const pr=ut(at.nodeName);if(!Z[pr]||le[pr])throw bf("root node is forbidden and cannot be sanitized in-place")}}else if(at instanceof s)je=Pr("<!---->"),Qe=je.ownerDocument.importNode(at,!0),Qe.nodeType===Cf.element&&Qe.nodeName==="BODY"||Qe.nodeName==="HTML"?je=Qe:je.appendChild(Qe);else{if(!ye&&!M&&!Se&&at.indexOf("<")===-1)return T&&q?T.createHTML(at):at;if(je=Pr(at),!je)return ye?null:q?A:""}je&&ne&&xi(je.firstChild);const Fn=Nm(Ye?at:je);for(;zt=Fn.nextNode();)Gn(zt),Lm(zt),zt.content instanceof a&&Zi(zt.content);if(Ye)return at;if(ye){if(ae)for(nr=x.call(je.ownerDocument);je.firstChild;)nr.appendChild(je.firstChild);else nr=je;return(Ie.shadowroot||Ie.shadowrootmode)&&(nr=R.call(r,nr,!0)),nr}let Sr=Se?je.outerHTML:je.innerHTML;return Se&&Z["!doctype"]&&je.ownerDocument&&je.ownerDocument.doctype&&je.ownerDocument.doctype.name&&Dr(UH,je.ownerDocument.doctype.name)&&(Sr="<!DOCTYPE "+je.ownerDocument.doctype.name+`>
`+Sr),M&&zg([j,J,D],pr=>{Sr=vf(Sr,pr," ")}),T&&q?T.createHTML(Sr):Sr},e.setConfig=function(){let at=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Rr(at),P=!0},e.clearConfig=function(){ft=null,P=!1},e.isValidAttribute=function(at,G,je){ft||Rr({});const Qe=ut(at),zt=ut(G);return hu(Qe,zt,je)},e.addHook=function(at,G){typeof G=="function"&&gf(z[at],G)},e.removeHook=function(at,G){if(G!==void 0){const je=YLe(z[at],G);return je===-1?void 0:QLe(z[at],je,1)[0]}return u5(z[at])},e.removeHooks=function(at){z[at]=[]},e.removeAllHooks=function(){z=v5()},e}var b5=FH(),cp=class{constructor(n,e,t,r,i,a){B(this,"type",3);B(this,"name","");B(this,"prefix","");B(this,"value","");B(this,"suffix","");B(this,"modifier",3);this.type=n,this.name=e,this.prefix=t,this.value=r,this.suffix=i,this.modifier=a}hasCustomName(){return this.name!==""&&typeof this.name!="number"}},fDe=/[$_\p{ID_Start}]/u,pDe=/[$_\u200C\u200D\p{ID_Continue}]/u,xT=".*";function mDe(n,e){return/^[\x00-\x7F]*$/.test(n)}function BH(n,e=!1){let t=[],r=0;for(;r<n.length;){let i=n[r],a=function(o){if(!e)throw new TypeError(o);t.push({type:"INVALID_CHAR",index:r,value:n[r++]})};if(i==="*"){t.push({type:"ASTERISK",index:r,value:n[r++]});continue}if(i==="+"||i==="?"){t.push({type:"OTHER_MODIFIER",index:r,value:n[r++]});continue}if(i==="\\"){t.push({type:"ESCAPED_CHAR",index:r++,value:n[r++]});continue}if(i==="{"){t.push({type:"OPEN",index:r,value:n[r++]});continue}if(i==="}"){t.push({type:"CLOSE",index:r,value:n[r++]});continue}if(i===":"){let o="",s=r+1;for(;s<n.length;){let c=n.substr(s,1);if(s===r+1&&fDe.test(c)||s!==r+1&&pDe.test(c)){o+=n[s++];continue}break}if(!o){a(`Missing parameter name at ${r}`);continue}t.push({type:"NAME",index:r,value:o}),r=s;continue}if(i==="("){let o=1,s="",c=r+1,u=!1;if(n[c]==="?"){a(`Pattern cannot start with "?" at ${c}`);continue}for(;c<n.length;){if(!mDe(n[c])){a(`Invalid character '${n[c]}' at ${c}.`),u=!0;break}if(n[c]==="\\"){s+=n[c++]+n[c++];continue}if(n[c]===")"){if(o--,o===0){c++;break}}else if(n[c]==="("&&(o++,n[c+1]!=="?")){a(`Capturing groups are not allowed at ${c}`),u=!0;break}s+=n[c++]}if(u)continue;if(o){a(`Unbalanced pattern at ${r}`);continue}if(!s){a(`Missing pattern at ${r}`);continue}t.push({type:"REGEX",index:r,value:s}),r=c;continue}t.push({type:"CHAR",index:r,value:n[r++]})}return t.push({type:"END",index:r,value:""}),t}function HH(n,e={}){let t=BH(n);e.delimiter??(e.delimiter="/#?"),e.prefixes??(e.prefixes="./");let r=`[^${Mi(e.delimiter)}]+?`,i=[],a=0,o=0,s=new Set,c=S=>{if(o<t.length&&t[o].type===S)return t[o++].value},u=()=>c("OTHER_MODIFIER")??c("ASTERISK"),h=S=>{let E=c(S);if(E!==void 0)return E;let{type:T,index:A}=t[o];throw new TypeError(`Unexpected ${T} at ${A}, expected ${S}`)},f=()=>{let S="",E;for(;E=c("CHAR")??c("ESCAPED_CHAR");)S+=E;return S},p=S=>S,g=e.encodePart||p,v="",y=S=>{v+=S},b=()=>{v.length&&(i.push(new cp(3,"","",g(v),"",3)),v="")},C=(S,E,T,A,I)=>{let k=3;switch(I){case"?":k=1;break;case"*":k=0;break;case"+":k=2;break}if(!E&&!T&&k===3){y(S);return}if(b(),!E&&!T){if(!S)return;i.push(new cp(3,"","",g(S),"",k));return}let x;T?T==="*"?x=xT:x=T:x=r;let _=2;x===r?(_=1,x=""):x===xT&&(_=0,x="");let R;if(E?R=E:T&&(R=a++),s.has(R))throw new TypeError(`Duplicate name '${R}'.`);s.add(R),i.push(new cp(_,R,g(S),x,g(A),k))};for(;o<t.length;){let S=c("CHAR"),E=c("NAME"),T=c("REGEX");if(!E&&!T&&(T=c("ASTERISK")),E||T){let I=S??"";e.prefixes.indexOf(I)===-1&&(y(I),I=""),b();let k=u();C(I,E,T,"",k);continue}let A=S??c("ESCAPED_CHAR");if(A){y(A);continue}if(c("OPEN")){let I=f(),k=c("NAME"),x=c("REGEX");!k&&!x&&(x=c("ASTERISK"));let _=f();h("CLOSE");let R=u();C(I,k,x,_,R);continue}b(),h("END")}return i}function Mi(n){return n.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function y5(n){return n&&n.ignoreCase?"ui":"u"}function gDe(n,e,t){return $H(HH(n,t),e,t)}function ld(n){switch(n){case 0:return"*";case 1:return"?";case 2:return"+";case 3:return""}}function $H(n,e,t={}){t.delimiter??(t.delimiter="/#?"),t.prefixes??(t.prefixes="./"),t.sensitive??(t.sensitive=!1),t.strict??(t.strict=!1),t.end??(t.end=!0),t.start??(t.start=!0),t.endsWith="";let r=t.start?"^":"";for(let s of n){if(s.type===3){s.modifier===3?r+=Mi(s.value):r+=`(?:${Mi(s.value)})${ld(s.modifier)}`;continue}e&&e.push(s.name);let c=`[^${Mi(t.delimiter)}]+?`,u=s.value;if(s.type===1?u=c:s.type===0&&(u=xT),!s.prefix.length&&!s.suffix.length){s.modifier===3||s.modifier===1?r+=`(${u})${ld(s.modifier)}`:r+=`((?:${u})${ld(s.modifier)})`;continue}if(s.modifier===3||s.modifier===1){r+=`(?:${Mi(s.prefix)}(${u})${Mi(s.suffix)})`,r+=ld(s.modifier);continue}r+=`(?:${Mi(s.prefix)}`,r+=`((?:${u})(?:`,r+=Mi(s.suffix),r+=Mi(s.prefix),r+=`(?:${u}))*)${Mi(s.suffix)})`,s.modifier===0&&(r+="?")}let i=`[${Mi(t.endsWith)}]|$`,a=`[${Mi(t.delimiter)}]`;if(t.end)return t.strict||(r+=`${a}?`),t.endsWith.length?r+=`(?=${i})`:r+="$",new RegExp(r,y5(t));t.strict||(r+=`(?:${a}(?=${i}))?`);let o=!1;if(n.length){let s=n[n.length-1];s.type===3&&s.modifier===3&&(o=t.delimiter.indexOf(s)>-1)}return o||(r+=`(?=${a}|${i})`),new RegExp(r,y5(t))}var ws={delimiter:"",prefixes:"",sensitive:!0,strict:!0},vDe={delimiter:".",prefixes:"",sensitive:!0,strict:!0},bDe={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function yDe(n,e){return n.length?n[0]==="/"?!0:!e||n.length<2?!1:(n[0]=="\\"||n[0]=="{")&&n[1]=="/":!1}function zH(n,e){return n.startsWith(e)?n.substring(e.length,n.length):n}function CDe(n,e){return n.endsWith(e)?n.substr(0,n.length-e.length):n}function VH(n){return!n||n.length<2?!1:n[0]==="["||(n[0]==="\\"||n[0]==="{")&&n[1]==="["}var GH=["ftp","file","http","https","ws","wss"];function KH(n){if(!n)return!0;for(let e of GH)if(n.test(e))return!0;return!1}function SDe(n,e){if(n=zH(n,"#"),e||n==="")return n;let t=new URL("https://example.com");return t.hash=n,t.hash?t.hash.substring(1,t.hash.length):""}function wDe(n,e){if(n=zH(n,"?"),e||n==="")return n;let t=new URL("https://example.com");return t.search=n,t.search?t.search.substring(1,t.search.length):""}function EDe(n,e){return e||n===""?n:VH(n)?YH(n):WH(n)}function TDe(n,e){if(e||n==="")return n;let t=new URL("https://example.com");return t.password=n,t.password}function IDe(n,e){if(e||n==="")return n;let t=new URL("https://example.com");return t.username=n,t.username}function ADe(n,e,t){if(t||n==="")return n;if(e&&!GH.includes(e))return new URL(`${e}:${n}`).pathname;let r=n[0]=="/";return n=new URL(r?n:"/-"+n,"https://example.com").pathname,r||(n=n.substring(2,n.length)),n}function kDe(n,e,t){return qH(e)===n&&(n=""),t||n===""?n:QH(n)}function xDe(n,e){return n=CDe(n,":"),e||n===""?n:qx(n)}function qH(n){switch(n){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function qx(n){if(n==="")return n;if(/^[-+.A-Za-z0-9]*$/.test(n))return n.toLowerCase();throw new TypeError(`Invalid protocol '${n}'.`)}function _De(n){if(n==="")return n;let e=new URL("https://example.com");return e.username=n,e.username}function MDe(n){if(n==="")return n;let e=new URL("https://example.com");return e.password=n,e.password}function WH(n){if(n==="")return n;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(n))throw new TypeError(`Invalid hostname '${n}'`);let e=new URL("https://example.com");return e.hostname=n,e.hostname}function YH(n){if(n==="")return n;if(/[^0-9a-fA-F[\]:]/g.test(n))throw new TypeError(`Invalid IPv6 hostname '${n}'`);return n.toLowerCase()}function QH(n){if(n===""||/^[0-9]*$/.test(n)&&parseInt(n)<=65535)return n;throw new TypeError(`Invalid port '${n}'.`)}function RDe(n){if(n==="")return n;let e=new URL("https://example.com");return e.pathname=n[0]!=="/"?"/-"+n:n,n[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function PDe(n){return n===""?n:new URL(`data:${n}`).pathname}function NDe(n){if(n==="")return n;let e=new URL("https://example.com");return e.search=n,e.search.substring(1,e.search.length)}function ODe(n){if(n==="")return n;let e=new URL("https://example.com");return e.hash=n,e.hash.substring(1,e.hash.length)}var Td,jr,ar,dn,zc,Id,pi,Ad,kd,xd,Oe,Kn,JH,_T,Of,yv,Ri,MT,ZH,Cv,XH,e$,Sv,Ku,Ac,t$,n$,r$,i$,Oa,a$,k5,LDe=(k5=class{constructor(n){ln(this,Oe);ln(this,Td);ln(this,jr,[]);ln(this,ar,{});ln(this,dn,0);ln(this,zc,1);ln(this,Id,0);ln(this,pi,0);ln(this,Ad,0);ln(this,kd,0);ln(this,xd,!1);Vt(this,Td,n)}get result(){return fe(this,ar)}parse(){for(Vt(this,jr,BH(fe(this,Td),!0));fe(this,dn)<fe(this,jr).length;Vt(this,dn,fe(this,dn)+fe(this,zc))){if(Vt(this,zc,1),fe(this,jr)[fe(this,dn)].type==="END"){if(fe(this,pi)===0){Ke(this,Oe,_T).call(this),Ke(this,Oe,Ac).call(this)?Ke(this,Oe,Kn).call(this,9,1):Ke(this,Oe,Ku).call(this)?Ke(this,Oe,Kn).call(this,8,1):Ke(this,Oe,Kn).call(this,7,0);continue}else if(fe(this,pi)===2){Ke(this,Oe,Of).call(this,5);continue}Ke(this,Oe,Kn).call(this,10,0);break}if(fe(this,Ad)>0)if(Ke(this,Oe,n$).call(this))Vt(this,Ad,fe(this,Ad)-1);else continue;if(Ke(this,Oe,t$).call(this)){Vt(this,Ad,fe(this,Ad)+1);continue}switch(fe(this,pi)){case 0:Ke(this,Oe,MT).call(this)&&Ke(this,Oe,Of).call(this,1);break;case 1:if(Ke(this,Oe,MT).call(this)){Ke(this,Oe,a$).call(this);let n=7,e=1;Ke(this,Oe,ZH).call(this)?(n=2,e=3):fe(this,xd)&&(n=2),Ke(this,Oe,Kn).call(this,n,e)}break;case 2:Ke(this,Oe,Cv).call(this)?Ke(this,Oe,Of).call(this,3):(Ke(this,Oe,Sv).call(this)||Ke(this,Oe,Ku).call(this)||Ke(this,Oe,Ac).call(this))&&Ke(this,Oe,Of).call(this,5);break;case 3:Ke(this,Oe,XH).call(this)?Ke(this,Oe,Kn).call(this,4,1):Ke(this,Oe,Cv).call(this)&&Ke(this,Oe,Kn).call(this,5,1);break;case 4:Ke(this,Oe,Cv).call(this)&&Ke(this,Oe,Kn).call(this,5,1);break;case 5:Ke(this,Oe,r$).call(this)?Vt(this,kd,fe(this,kd)+1):Ke(this,Oe,i$).call(this)&&Vt(this,kd,fe(this,kd)-1),Ke(this,Oe,e$).call(this)&&!fe(this,kd)?Ke(this,Oe,Kn).call(this,6,1):Ke(this,Oe,Sv).call(this)?Ke(this,Oe,Kn).call(this,7,0):Ke(this,Oe,Ku).call(this)?Ke(this,Oe,Kn).call(this,8,1):Ke(this,Oe,Ac).call(this)&&Ke(this,Oe,Kn).call(this,9,1);break;case 6:Ke(this,Oe,Sv).call(this)?Ke(this,Oe,Kn).call(this,7,0):Ke(this,Oe,Ku).call(this)?Ke(this,Oe,Kn).call(this,8,1):Ke(this,Oe,Ac).call(this)&&Ke(this,Oe,Kn).call(this,9,1);break;case 7:Ke(this,Oe,Ku).call(this)?Ke(this,Oe,Kn).call(this,8,1):Ke(this,Oe,Ac).call(this)&&Ke(this,Oe,Kn).call(this,9,1);break;case 8:Ke(this,Oe,Ac).call(this)&&Ke(this,Oe,Kn).call(this,9,1);break}}fe(this,ar).hostname!==void 0&&fe(this,ar).port===void 0&&(fe(this,ar).port="")}},Td=new WeakMap,jr=new WeakMap,ar=new WeakMap,dn=new WeakMap,zc=new WeakMap,Id=new WeakMap,pi=new WeakMap,Ad=new WeakMap,kd=new WeakMap,xd=new WeakMap,Oe=new WeakSet,Kn=function(n,e){var t,r,i;switch(fe(this,pi)){case 0:break;case 1:fe(this,ar).protocol=Ke(this,Oe,Oa).call(this);break;case 2:break;case 3:fe(this,ar).username=Ke(this,Oe,Oa).call(this);break;case 4:fe(this,ar).password=Ke(this,Oe,Oa).call(this);break;case 5:fe(this,ar).hostname=Ke(this,Oe,Oa).call(this);break;case 6:fe(this,ar).port=Ke(this,Oe,Oa).call(this);break;case 7:fe(this,ar).pathname=Ke(this,Oe,Oa).call(this);break;case 8:fe(this,ar).search=Ke(this,Oe,Oa).call(this);break;case 9:fe(this,ar).hash=Ke(this,Oe,Oa).call(this);break}fe(this,pi)!==0&&n!==10&&([1,2,3,4].includes(fe(this,pi))&&[6,7,8,9].includes(n)&&((t=fe(this,ar)).hostname??(t.hostname="")),[1,2,3,4,5,6].includes(fe(this,pi))&&[8,9].includes(n)&&((r=fe(this,ar)).pathname??(r.pathname=fe(this,xd)?"/":"")),[1,2,3,4,5,6,7].includes(fe(this,pi))&&n===9&&((i=fe(this,ar)).search??(i.search=""))),Ke(this,Oe,JH).call(this,n,e)},JH=function(n,e){Vt(this,pi,n),Vt(this,Id,fe(this,dn)+e),Vt(this,dn,fe(this,dn)+e),Vt(this,zc,0)},_T=function(){Vt(this,dn,fe(this,Id)),Vt(this,zc,0)},Of=function(n){Ke(this,Oe,_T).call(this),Vt(this,pi,n)},yv=function(n){return n<0&&(n=fe(this,jr).length-n),n<fe(this,jr).length?fe(this,jr)[n]:fe(this,jr)[fe(this,jr).length-1]},Ri=function(n,e){let t=Ke(this,Oe,yv).call(this,n);return t.value===e&&(t.type==="CHAR"||t.type==="ESCAPED_CHAR"||t.type==="INVALID_CHAR")},MT=function(){return Ke(this,Oe,Ri).call(this,fe(this,dn),":")},ZH=function(){return Ke(this,Oe,Ri).call(this,fe(this,dn)+1,"/")&&Ke(this,Oe,Ri).call(this,fe(this,dn)+2,"/")},Cv=function(){return Ke(this,Oe,Ri).call(this,fe(this,dn),"@")},XH=function(){return Ke(this,Oe,Ri).call(this,fe(this,dn),":")},e$=function(){return Ke(this,Oe,Ri).call(this,fe(this,dn),":")},Sv=function(){return Ke(this,Oe,Ri).call(this,fe(this,dn),"/")},Ku=function(){if(Ke(this,Oe,Ri).call(this,fe(this,dn),"?"))return!0;if(fe(this,jr)[fe(this,dn)].value!=="?")return!1;let n=Ke(this,Oe,yv).call(this,fe(this,dn)-1);return n.type!=="NAME"&&n.type!=="REGEX"&&n.type!=="CLOSE"&&n.type!=="ASTERISK"},Ac=function(){return Ke(this,Oe,Ri).call(this,fe(this,dn),"#")},t$=function(){return fe(this,jr)[fe(this,dn)].type=="OPEN"},n$=function(){return fe(this,jr)[fe(this,dn)].type=="CLOSE"},r$=function(){return Ke(this,Oe,Ri).call(this,fe(this,dn),"[")},i$=function(){return Ke(this,Oe,Ri).call(this,fe(this,dn),"]")},Oa=function(){let n=fe(this,jr)[fe(this,dn)],e=Ke(this,Oe,yv).call(this,fe(this,Id)).index;return fe(this,Td).substring(e,n.index)},a$=function(){let n={};Object.assign(n,ws),n.encodePart=qx;let e=gDe(Ke(this,Oe,Oa).call(this),void 0,n);Vt(this,xd,KH(e))},k5),zw=["protocol","username","password","hostname","port","pathname","search","hash"],ys="*";function C5(n,e){if(typeof n!="string")throw new TypeError("parameter 1 is not of type 'string'.");let t=new URL(n,e);return{protocol:t.protocol.substring(0,t.protocol.length-1),username:t.username,password:t.password,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search!==""?t.search.substring(1,t.search.length):void 0,hash:t.hash!==""?t.hash.substring(1,t.hash.length):void 0}}function To(n,e){return e?Lf(n):n}function Sf(n,e,t){let r;if(typeof e.baseURL=="string")try{r=new URL(e.baseURL),e.protocol===void 0&&(n.protocol=To(r.protocol.substring(0,r.protocol.length-1),t)),!t&&e.protocol===void 0&&e.hostname===void 0&&e.port===void 0&&e.username===void 0&&(n.username=To(r.username,t)),!t&&e.protocol===void 0&&e.hostname===void 0&&e.port===void 0&&e.username===void 0&&e.password===void 0&&(n.password=To(r.password,t)),e.protocol===void 0&&e.hostname===void 0&&(n.hostname=To(r.hostname,t)),e.protocol===void 0&&e.hostname===void 0&&e.port===void 0&&(n.port=To(r.port,t)),e.protocol===void 0&&e.hostname===void 0&&e.port===void 0&&e.pathname===void 0&&(n.pathname=To(r.pathname,t)),e.protocol===void 0&&e.hostname===void 0&&e.port===void 0&&e.pathname===void 0&&e.search===void 0&&(n.search=To(r.search.substring(1,r.search.length),t)),e.protocol===void 0&&e.hostname===void 0&&e.port===void 0&&e.pathname===void 0&&e.search===void 0&&e.hash===void 0&&(n.hash=To(r.hash.substring(1,r.hash.length),t))}catch{throw new TypeError(`invalid baseURL '${e.baseURL}'.`)}if(typeof e.protocol=="string"&&(n.protocol=xDe(e.protocol,t)),typeof e.username=="string"&&(n.username=IDe(e.username,t)),typeof e.password=="string"&&(n.password=TDe(e.password,t)),typeof e.hostname=="string"&&(n.hostname=EDe(e.hostname,t)),typeof e.port=="string"&&(n.port=kDe(e.port,n.protocol,t)),typeof e.pathname=="string"){if(n.pathname=e.pathname,r&&!yDe(n.pathname,t)){let i=r.pathname.lastIndexOf("/");i>=0&&(n.pathname=To(r.pathname.substring(0,i+1),t)+n.pathname)}n.pathname=ADe(n.pathname,n.protocol,t)}return typeof e.search=="string"&&(n.search=wDe(e.search,t)),typeof e.hash=="string"&&(n.hash=SDe(e.hash,t)),n}function Lf(n){return n.replace(/([+*?:{}()\\])/g,"\\$1")}function DDe(n){return n.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function jDe(n,e){e.delimiter??(e.delimiter="/#?"),e.prefixes??(e.prefixes="./"),e.sensitive??(e.sensitive=!1),e.strict??(e.strict=!1),e.end??(e.end=!0),e.start??(e.start=!0),e.endsWith="";let t=".*",r=`[^${DDe(e.delimiter)}]+?`,i=/[$_\u200C\u200D\p{ID_Continue}]/u,a="";for(let o=0;o<n.length;++o){let s=n[o];if(s.type===3){if(s.modifier===3){a+=Lf(s.value);continue}a+=`{${Lf(s.value)}}${ld(s.modifier)}`;continue}let c=s.hasCustomName(),u=!!s.suffix.length||!!s.prefix.length&&(s.prefix.length!==1||!e.prefixes.includes(s.prefix)),h=o>0?n[o-1]:null,f=o<n.length-1?n[o+1]:null;if(!u&&c&&s.type===1&&s.modifier===3&&f&&!f.prefix.length&&!f.suffix.length)if(f.type===3){let p=f.value.length>0?f.value[0]:"";u=i.test(p)}else u=!f.hasCustomName();if(!u&&!s.prefix.length&&h&&h.type===3){let p=h.value[h.value.length-1];u=e.prefixes.includes(p)}u&&(a+="{"),a+=Lf(s.prefix),c&&(a+=`:${s.name}`),s.type===2?a+=`(${s.value})`:s.type===1?c||(a+=`(${r})`):s.type===0&&(!c&&(!h||h.type===3||h.modifier!==3||u||s.prefix!=="")?a+="*":a+=`(${t})`),s.type===1&&c&&s.suffix.length&&i.test(s.suffix[0])&&(a+="\\"),a+=Lf(s.suffix),u&&(a+="}"),s.modifier!==3&&(a+=ld(s.modifier))}return a}var Fa,Vc,_d,or,aa,Md,x5,UDe=(x5=class{constructor(n={},e,t){ln(this,Fa);ln(this,Vc,{});ln(this,_d,{});ln(this,or,{});ln(this,aa,{});ln(this,Md,!1);try{let r;if(typeof e=="string"?r=e:t=e,typeof n=="string"){let s=new LDe(n);if(s.parse(),n=s.result,r===void 0&&typeof n.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.");n.baseURL=r}else{if(!n||typeof n!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");if(r)throw new TypeError("parameter 1 is not of type 'string'.")}typeof t>"u"&&(t={ignoreCase:!1});let i={ignoreCase:t.ignoreCase===!0};Vt(this,Fa,Sf({pathname:ys,protocol:ys,username:ys,password:ys,hostname:ys,port:ys,search:ys,hash:ys},n,!0)),qH(fe(this,Fa).protocol)===fe(this,Fa).port&&(fe(this,Fa).port="");let o;for(o of zw){if(!(o in fe(this,Fa)))continue;let s={},c=fe(this,Fa)[o];switch(fe(this,_d)[o]=[],o){case"protocol":Object.assign(s,ws),s.encodePart=qx;break;case"username":Object.assign(s,ws),s.encodePart=_De;break;case"password":Object.assign(s,ws),s.encodePart=MDe;break;case"hostname":Object.assign(s,vDe),VH(c)?s.encodePart=YH:s.encodePart=WH;break;case"port":Object.assign(s,ws),s.encodePart=QH;break;case"pathname":KH(fe(this,Vc).protocol)?(Object.assign(s,bDe,i),s.encodePart=RDe):(Object.assign(s,ws,i),s.encodePart=PDe);break;case"search":Object.assign(s,ws,i),s.encodePart=NDe;break;case"hash":Object.assign(s,ws,i),s.encodePart=ODe;break}try{fe(this,aa)[o]=HH(c,s),fe(this,Vc)[o]=$H(fe(this,aa)[o],fe(this,_d)[o],s),fe(this,or)[o]=jDe(fe(this,aa)[o],s),Vt(this,Md,fe(this,Md)||fe(this,aa)[o].some(u=>u.type===2))}catch{throw new TypeError(`invalid ${o} pattern '${fe(this,Fa)[o]}'.`)}}}catch(r){throw new TypeError(`Failed to construct 'URLPattern': ${r.message}`)}}test(n={},e){let t={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof n!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof n>"u")return!1;try{typeof n=="object"?t=Sf(t,n,!1):t=Sf(t,C5(n,e),!1)}catch{return!1}let r;for(r of zw)if(!fe(this,Vc)[r].exec(t[r]))return!1;return!0}exec(n={},e){let t={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof n!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof n>"u")return;try{typeof n=="object"?t=Sf(t,n,!1):t=Sf(t,C5(n,e),!1)}catch{return null}let r={};e?r.inputs=[n,e]:r.inputs=[n];let i;for(i of zw){let a=fe(this,Vc)[i].exec(t[i]);if(!a)return null;let o={};for(let[s,c]of fe(this,_d)[i].entries())if(typeof c=="string"||typeof c=="number"){let u=a[s+1];o[c]=u}r[i]={input:t[i]??"",groups:o}}return r}static compareComponent(n,e,t){let r=(s,c)=>{for(let u of["type","modifier","prefix","value","suffix"]){if(s[u]<c[u])return-1;if(s[u]!==c[u])return 1}return 0},i=new cp(3,"","","","",3),a=new cp(0,"","","","",3),o=(s,c)=>{let u=0;for(;u<Math.min(s.length,c.length);++u){let h=r(s[u],c[u]);if(h)return h}return s.length===c.length?0:r(s[u]??i,c[u]??i)};return!fe(e,or)[n]&&!fe(t,or)[n]?0:fe(e,or)[n]&&!fe(t,or)[n]?o(fe(e,aa)[n],[a]):!fe(e,or)[n]&&fe(t,or)[n]?o([a],fe(t,aa)[n]):o(fe(e,aa)[n],fe(t,aa)[n])}get protocol(){return fe(this,or).protocol}get username(){return fe(this,or).username}get password(){return fe(this,or).password}get hostname(){return fe(this,or).hostname}get port(){return fe(this,or).port}get pathname(){return fe(this,or).pathname}get search(){return fe(this,or).search}get hash(){return fe(this,or).hash}get hasRegExpGroups(){return fe(this,Md)}},Fa=new WeakMap,Vc=new WeakMap,_d=new WeakMap,or=new WeakMap,aa=new WeakMap,Md=new WeakMap,x5);globalThis.URLPattern||(globalThis.URLPattern=UDe);let o$;function d8e(n){o$=n}function FDe(){var n,e;typeof window<"u"&&(window.copilotTrustedTypesPolicy=(n=window.trustedTypes)==null?void 0:n.createPolicy("copilotPolicy",{createHTML:t=>b5.sanitize(t)}),(e=window.trustedTypes)==null||e.createPolicy("default",{createScriptURL:t=>{const r=/^\/cl\//,i=new URLPattern({protocol:"https",hostname:"*.clarity.ms"}),a=new URLPattern({protocol:"https",hostname:"*.cloudflare.com"}),o=new URLPattern({protocol:"https",hostname:"bat.bing.com"}),s=new URLPattern({protocol:"https",hostname:"az416426.vo.msecnd.net"}),c=new URLPattern({protocol:"https",hostname:"fpt.dfp.microsoft.com"}),u=new URLPattern({protocol:"https",hostname:"assets.msn.com"}),h=new URLPattern({protocol:"https",hostname:"content.lifecycle.office.net"}),f=new URLPattern({protocol:"https",hostname:"*.paypal.com"}),p=new URLPattern({protocol:"https",hostname:"*.paypalobjects.com"});if(r.test(t)||i.test(t)||a.test(t)||o.test(t)||s.test(t)||c.test(t)||u.test(t)||h.test(t)||f.test(t)||p.test(t)||t===o$)return t;throw new Error(`Unsafe script URL "${t}" blocked by CSP.`)},createHTML:t=>b5.sanitize(t)}))}FDe();Xz.createRoot(document.getElementById("app")).render(d.jsx(kl.StrictMode,{children:d.jsx(GLe,{})}));const BDe=Object.freeze(Object.defineProperty({__proto__:null,Route:TNe},Symbol.toStringTag,{value:"Module"}));export{Dt as $,N_e as A,Ee as B,TT as C,bo as D,G9 as E,On as F,lt as G,ct as H,t6e as I,H as J,Fe as K,to as L,Qn as M,f4e as N,_4 as O,aL as P,i7e as Q,$E as R,Tl as S,Fr as T,B5 as U,_W as V,Hk as W,nc as X,nt as Y,$t as Z,$ as _,z4e as a,Sne as a$,me as a0,qi as a1,gx as a2,re as a3,Ir as a4,Tn as a5,E3e as a6,T3e as a7,xr as a8,w3e as a9,oje as aA,_t as aB,xl as aC,fr as aD,nu as aE,hge as aF,QDe as aG,YDe as aH,FL as aI,Mo as aJ,Pn as aK,Rv as aL,sI as aM,kB as aN,sd as aO,tu as aP,br as aQ,o3e as aR,qk as aS,qb as aT,Iv as aU,xk as aV,CB as aW,ai as aX,A7e as aY,Q3 as aZ,ime as a_,ny as aa,rs as ab,Ea as ac,cte as ad,Dy as ae,En as af,jy as ag,ty as ah,X5 as ai,lte as aj,zl as ak,ee as al,CEe as am,SEe as an,ave as ao,Xfe as ap,GP as aq,tA as ar,eo as as,zje as at,gge as au,cge as av,yx as aw,Jje as ax,_be as ay,tI as az,AF as b,dpe as b$,mT as b0,Mh as b1,wT as b2,ZF as b3,JF as b4,qke as b5,Yke as b6,Jke as b7,l7e as b8,Zke as b9,ts as bA,go as bB,Em as bC,CSe as bD,L3 as bE,ste as bF,bM as bG,vM as bH,R9 as bI,Ex as bJ,mx as bK,hF as bL,oo as bM,Jh as bN,A4e as bO,Ms as bP,Ls as bQ,g3e as bR,$3 as bS,_r as bT,e4e as bU,v_e as bV,NI as bW,Gi as bX,xF as bY,y7e as bZ,HL as b_,Xke as ba,Sh as bb,Bt as bc,py as bd,WT as be,YT as bf,Vi as bg,en as bh,O4e as bi,P4e as bj,j4e as bk,hr as bl,fF as bm,Sge as bn,T9 as bo,lN as bp,oc as bq,yF as br,au as bs,Z5 as bt,bn as bu,vo as bv,Rf as bw,Fpe as bx,Zge as by,el as bz,X as c,Sx as c$,Ia as c0,kF as c1,R3e as c2,$o as c3,L3e as c4,O3e as c5,ca as c6,D3e as c7,s3e as c8,dr as c9,Uke as cA,vH as cB,gH as cC,WMe as cD,Ch as cE,$e as cF,M3 as cG,H3 as cH,gp as cI,Gc as cJ,Im as cK,kW as cL,Lq as cM,FI as cN,e_e as cO,Vp as cP,I4e as cQ,_3 as cR,Pk as cS,tT as cT,$k as cU,BCe as cV,fo as cW,VE as cX,Z4e as cY,wK as cZ,Ope as c_,d3e as ca,$s as cb,Zn as cc,Xd as cd,jp as ce,O6e as cf,L6e as cg,D6e as ch,uEe as ci,gEe as cj,wa as ck,Xge as cl,wh as cm,cU as cn,aCe as co,Gu as cp,p3 as cq,_m as cr,C1e as cs,r1e as ct,Pd as cu,rne as cv,Ai as cw,iI as cx,XDe as cy,H3e as cz,Nn as d,Vde as d$,OB as d0,wge as d1,_re as d2,sn as d3,Fq as d4,jq as d5,TF as d6,B_e as d7,N7e as d8,c7e as d9,D8 as dA,Ihe as dB,gue as dC,fc as dD,Pb as dE,xs as dF,Nt as dG,C7 as dH,ml as dI,sde as dJ,Ks as dK,lE as dL,kr as dM,U4e as dN,cE as dO,C2 as dP,Ck as dQ,gde as dR,fE as dS,Hue as dT,yfe as dU,khe as dV,Ahe as dW,bg as dX,She as dY,d8 as dZ,Gde as d_,M7e as da,_7e as db,O7e as dc,R7e as dd,P7e as de,yp as df,cm as dg,Rn as dh,Zl as di,k3e as dj,Zp as dk,IC as dl,Nk as dm,JMe as dn,eu as dp,e3e as dq,Bl as dr,NOe as ds,vMe as dt,q1e as du,TC as dv,cMe as dw,FT as dx,yB as dy,n7 as dz,Aa as e,X4e as e$,Yde as e0,b9 as e1,k2e as e2,EK as e3,UI as e4,yH as e5,E4e as e6,Y5 as e7,e6e as e8,Epe as e9,WB as eA,ibe as eB,Vk as eC,P3e as eD,VPe as eE,bB as eF,Sn as eG,ya as eH,LI as eI,qte as eJ,F3e as eK,OI as eL,kC as eM,ix as eN,X3 as eO,Ixe as eP,r4 as eQ,e4 as eR,a8e as eS,hOe as eT,zb as eU,HOe as eV,WNe as eW,j7e as eX,ox as eY,cc as eZ,kh as e_,xme as ea,ACe as eb,K1e as ec,G4e as ed,K4e as ee,oA as ef,Dx as eg,uxe as eh,HN as ei,o8e as ej,ch as ek,Ny as el,Hte as em,Yk as en,IB as eo,k7e as ep,Qp as eq,t7e as er,Bg as es,sa as et,Sc as eu,bs as ev,ip as ew,eh as ex,RC as ey,$G as ez,W4e as f,UT as f$,gCe as f0,Fp as f1,Kx as f2,c5e as f3,Uk as f4,c2e as f5,s2e as f6,$6e as f7,KOe as f8,oMe as f9,Tje as fA,KN as fB,pU as fC,M3e as fD,J5 as fE,Lx as fF,g9 as fG,zme as fH,Th as fI,wU as fJ,Nre as fK,q4e as fL,u3e as fM,Og as fN,w as fO,x3e as fP,yje as fQ,Sje as fR,Cje as fS,Bd as fT,$l as fU,Z3 as fV,im as fW,tne as fX,lB as fY,QI as fZ,YI as f_,rMe as fa,FB as fb,H6e as fc,aMe as fd,P9 as fe,U_e as ff,BK as fg,Sm as fh,ih as fi,po as fj,wCe as fk,Age as fl,BL as fm,p3e as fn,m3e as fo,pW as fp,e5 as fq,pje as fr,hje as fs,Eje as ft,wje as fu,dje as fv,lge as fw,Pxe as fx,vje as fy,bje as fz,p1 as g,n1e as g$,OG as g0,tl as g1,Tge as g2,Aje as g3,x7e as g4,fy as g5,SB as g6,NC as g7,eT as g8,iie as g9,KT as gA,qT as gB,qw as gC,Mje as gD,iy as gE,R4e as gF,vv as gG,BOe as gH,zr as gI,sF as gJ,V4e as gK,ame as gL,f3 as gM,IMe as gN,Jk as gO,bO as gP,lu as gQ,d7e as gR,eB as gS,bF as gT,ege as gU,h4e as gV,u4e as gW,d4e as gX,TSe as gY,mF as gZ,FG as g_,e3 as ga,Ht as gb,sve as gc,ove as gd,hY as ge,iu as gf,$je as gg,W1e as gh,wC as gi,p4e as gj,D7e as gk,U6e as gl,j6e as gm,N3e as gn,F6e as go,MMe as gp,B6e as gq,t3 as gr,AB as gs,_Me as gt,Qwe as gu,DNe as gv,vp as gw,WW as gx,Pje as gy,Rje as gz,$C as h,MB as h$,B4e as h0,F4e as h1,Ry as h2,n4e as h3,am as h4,KB as h5,Rre as h6,vS as h7,tp as h8,Bye as h9,Ete as hA,S7e as hB,vCe as hC,mme as hD,hme as hE,sp as hF,cn as hG,ZO as hH,Q4e as hI,Y4e as hJ,aOe as hK,EC as hL,qB as hM,G3e as hN,bbe as hO,Df as hP,I9 as hQ,ARe as hR,b6e as hS,uF as hT,Oke as hU,vO as hV,Qje as hW,NF as hX,GT as hY,DEe as hZ,Zfe as h_,y3e as ha,Vr as hb,Dv as hc,HC as hd,dve as he,lve as hf,xH as hg,kH as hh,O9 as hi,LMe as hj,DMe as hk,wP as hl,B3e as hm,u6e as hn,b5 as ho,CK as hp,Yp as hq,w7e as hr,Tte as hs,C3 as ht,C7e as hu,T7e as hv,l3e as hw,J3e as hx,Z3e as hy,Q3e as hz,Et as i,Hge as i$,UU as i0,nT as i1,URe as i2,xn as i3,XM as i4,M4e as i5,x4e as i6,_4e as i7,Tke as i8,Cke as i9,rI as iA,Fo as iB,XT as iC,rl as iD,wi as iE,nMe as iF,ux as iG,BU as iH,S3e as iI,A3e as iJ,I3e as iK,bI as iL,n3e as iM,EP as iN,Cn as iO,Uje as iP,Fje as iQ,xje as iR,kje as iS,_je as iT,Oje as iU,Nje as iV,Dje as iW,Lje as iX,Hl as iY,Cp as iZ,mve as i_,kke as ia,Os as ib,o7e as ic,a7e as id,k4e as ie,hte as ig,zv as ih,C3e as ii,d8e as ij,Fk as ik,AH as il,AL as im,nI as io,Di as ip,Bo as iq,Ba as ir,He as is,my as it,il as iu,pn as iv,Br as iw,Hr as ix,vy as iy,Hi as iz,Xl as j,Dn as j$,$ge as j0,jje as j1,L4e as j2,nR as j3,D4e as j4,Kge as j5,yOe as j6,RH as j7,n8e as j8,t8e as j9,f3e as jA,Dd as jB,IO as jC,TEe as jD,w3 as jE,FC as jF,KSe as jG,f5e as jH,H4e as jI,px as jJ,Hp as jK,QNe as jL,Bp as jM,Zwe as jN,IT as jO,R4 as jP,UNe as jQ,u7e as jR,aje as jS,Jl as jT,z6e as jU,iL as jV,h7e as jW,yW as jX,F9 as jY,sc as jZ,ni as j_,Mme as ja,_me as jb,sNe as jc,J7e as jd,Z7e as je,X7e as jf,WO as jg,e8e as jh,MP as ji,Ag as jj,E7e as jk,$ke as jl,Hke as jm,n7e as jn,eke as jo,e7e as jp,r7e as jq,AK as jr,T4e as js,cB as jt,sB as ju,RY as jv,AO as jw,fte as jx,kO as jy,h3e as jz,Ei as k,JDe as k$,m4e as k0,Hje as k1,PO as k2,U7e as k3,L7e as k4,tve as k5,nve as k6,b1e as k7,Rg as k8,T1e as k9,LO as kA,V7e as kB,Bq as kC,DI as kD,ete as kE,ZI as kF,Tre as kG,KDe as kH,WDe as kI,qDe as kJ,Tm as kK,A2e as kL,V3e as kM,zo as kN,vx as kO,J4e as kP,lp as kQ,Ege as kR,N3 as kS,GI as kT,Gfe as kU,lMe as kV,xB as kW,UCe as kX,rx as kY,g4e as kZ,i4e as k_,bx as ka,rve as kb,N9 as kc,Is as kd,DU as ke,Sxe as kf,Tbe as kg,Cbe as kh,nbe as ki,pve as kj,pH as kk,EEe as kl,ho as km,tte as kn,r4e as ko,rke as kp,Zb as kq,QF as kr,s7e as ks,nx as kt,hCe as ku,LC as kv,OC as kw,Uq as kx,XI as ky,$I as kz,Rt as l,QV as l$,zte as l0,$te as l1,gte as l2,S3 as l3,Q7e as l4,L1e as l5,ZDe as l6,I4 as l7,$3e as l8,dte as l9,Wte as lA,l4e as lB,$4e as lC,IEe as lD,VI as lE,a4e as lF,o4e as lG,m3 as lH,F3 as lI,cEe as lJ,p6e as lK,fNe as lL,V6e as lM,c3e as lN,Oy as lO,c4e as lP,Yje as lQ,Wje as lR,Kb as lS,WE as lT,Kk as lU,Gje as lV,t4e as lW,s4e as lX,HI as lY,X3e as lZ,b3e as l_,z3e as la,K3e as lb,W3e as lc,q3e as ld,jd as le,mU as lf,Gb as lg,Dke as lh,om as li,R3 as lj,xW as lk,Vte as ll,r9 as lm,eme as ln,Sme as lo,nNe as lp,x3 as lq,Kye as lr,GDe as ls,Gte as lt,qve as lu,Vje as lv,Kje as lw,qje as lx,Yte as ly,Qte as lz,pme as m,y6e as m$,Y3e as m0,hI as m1,rje as m2,SK as m3,t3e as m4,$T as m5,n6e as m6,pMe as m7,fje as m8,jMe as m9,Xje as mA,xbe as mB,mje as mC,gje as mD,_3e as mE,lX as mF,jse as mG,N4e as mH,Lk as mI,G6e as mJ,r3e as mK,i3e as mL,a3e as mM,eje as mN,tje as mO,nje as mP,ije as mQ,Bje as mR,r6e as mS,i6e as mT,a6e as mU,o6e as mV,s6e as mW,c6e as mX,l6e as mY,ax as mZ,d6e as m_,Ije as ma,cSe as mb,_O as mc,X_e as md,f6e as me,qye as mf,sje as mg,xC as mh,eMe as mi,iSe as mj,rSe as mk,Qo as ml,Hs as mm,U3e as mn,kbe as mo,h6e as mp,rRe as mq,ex as mr,B2e as ms,v3e as mt,j3e as mu,fH as mv,uje as mw,lje as mx,cje as my,Zje as mz,vr as n,C6e as n0,S6e as n1,w6e as n2,E6e as n3,T6e as n4,I6e as n5,A6e as n6,k6e as n7,x6e as n8,_6e as n9,W7e as nA,r8e as nB,i8e as nC,s8e as nD,c8e as nE,l8e as nF,u8e as nG,M6e as na,R6e as nb,P6e as nc,N6e as nd,K6e as ne,q6e as nf,W6e as ng,Y6e as nh,Q6e as ni,J6e as nj,Z6e as nk,f7e as nl,p7e as nm,m7e as nn,g7e as no,v7e as np,b7e as nq,I7e as nr,F7e as ns,B7e as nt,H7e as nu,$7e as nv,z7e as nw,G7e as nx,K7e as ny,q7e as nz,nl as o,Gk as p,ke as q,ri as r,Yo as s,wB as t,Ce as u,Ta as v,O3 as w,ET as x,Vb as y,z9 as z};

//# debugId=2aea942c-17a2-5201-af2b-d35f2f5d239c
